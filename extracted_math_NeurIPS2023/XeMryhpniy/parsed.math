L_{0}
\{\mathbf{z}_{1},\mathbf{z}_{2},\mathbf{z}_{3}\}
\mathbf{z}_{1}
=
\mathbf{z}
\mathbf{z}_{1}
=
\hat{\mathbf{z}}
in
H
\times
W
\times
{\rm LE}
H
\times
W
\times
{\rm LE_{DM}}
\{\mathbf{z}_{1},\mathbf{z}_{2},\mathbf{z}_{3}\}
\mathbf{z}_{1}
=
\mathbf{z}
\mathbf{z}_{1}
=
\hat{\mathbf{z}}
in
H
\times
W
\times
{\rm LE}
H
\times
W
\times
{\rm LE_{DM}}
\mathbf{I}_{Blur}
\in
\mathbb{R}^{H\times W\times 3}
\mathbf{I}_{GT}
\in
\mathbb{R}^{H\times W\times 3}
\mathbf{z}
\in
\mathbb{R}^{N\times C^{\prime}}
H
W
N
C^{\prime}
\mathbf{z}
N
H
\times
W
\frac{H\times W}{N}
L
\mathbf{X}_{in}
\in
\mathbb{R}^{\hat{H}\times\hat{W}\times\hat{C}}
\mathbf{X}_{r}
\in
\mathbb{R}^{\hat{H}\hat{W}\times\hat{C}}
\hat{H}
\times
\hat{W}
\hat{C}
\mathbf{X}_{r}
\mathbf{Q}
\in
\mathbb{R}^{\hat{H}\hat{W}\times\hat{C}}
query
\mathbf{z}_{i}
\in
\mathbb{R}^{\hat{N}\times C^{\prime}}
\mathbf{K}
\in
\mathbb{R}^{\hat{N}\times\hat{C}}
key
\mathbf{V}
\in
\mathbb{R}^{\hat{N}\times\hat{C}}
value
\begin{gathered}\mathbf{Q}=\mathbf{W}_{Q}\mathbf{X}_{r},\mathbf{K}=\mathbf{W}_%
{K}\mathbf{z}_{i},\mathbf{V}=\mathbf{W}_{V}\mathbf{z}_{i},\\
{\rm Attention}(\mathbf{Q},\mathbf{K},\mathbf{V})={\rm SoftMax}({{\mathbf{Q}%
\mathbf{K}^{T}}}/{\sqrt{\hat{C}}})\cdot{\mathbf{V}},\end{gathered}
\mathbf{W}_{Q}
\in
\mathbb{R}^{\hat{C}\times\hat{C}}
\mathbf{W}_{K}
\in
\mathbb{R}^{C^{\prime}\times\hat{C}}
\mathbf{W}_{V}
\in
\mathbb{R}^{C^{\prime}\times\hat{C}}
\mathbf{X}_{in}
\mathbf{X}_{out}
\in
\mathbb{R}^{\hat{H}\times\hat{W}\times\hat{C}}
\{\mathbf{z}_{1},\mathbf{z}_{2},\mathbf{z}_{3}\}
\mathbf{z}_{1}
=
\mathbf{z}
\mathbf{z}
L_{1}
\begin{gathered}\mathcal{L}_{\text{deblur}}=\|\mathbf{I}_{DB}-\mathbf{I}_{GT}%
\|_{1},\end{gathered}
\mathbf{I}_{DB}
\mathbf{I}_{GT}
\mathbf{z}
\in
\mathbb{R}^{N\times C^{\prime}}
\mathbf{z}
T
q(\mathbf{z}_{1:T}\mid\mathbf{z}_{0})=\prod_{t=1}^{T}q(\mathbf{z}_{t}\mid%
\mathbf{z}_{t-1}),\quad q(\mathbf{z}_{t}\mid\mathbf{z}_{t-1})=\mathcal{N}(%
\mathbf{z}_{t};\sqrt{1-\beta_{t}}\mathbf{z}_{t-1},\beta_{t}\mathbf{I}),
t
=
1,\dots,T
\mathbf{z}_{t}
t
\mathbf{z}_{0}
=
\mathbf{z}
\beta_{1:T}
\in
(0,1)
\mathcal{N}
q(\mathbf{z}_{t}\mid\mathbf{z}_{0})=\mathcal{N}(\mathbf{z}_{t};\sqrt{\bar{%
\alpha}_{t}}\mathbf{z}_{0},(1-\bar{\alpha}_{t})\mathbf{I}),\quad\alpha=1-\beta%
_{t},\quad\bar{{\alpha}_{t}}=\prod_{i=1}^{t}\alpha_{i}.
T
\mathbf{z}_{T}
\mathbf{z}_{0}
\mathbf{z}_{t}
\mathbf{z}_{t-1}
q(\mathbf{z}_{t-1}\mid\mathbf{z}_{t},\mathbf{z}_{0})=\mathcal{N}(\mathbf{z}_{t%
-1};\bm{\mu}_{t}(\mathbf{z}_{t},\mathbf{z}_{0}),\frac{1-\bar{\alpha}_{t-1}}{1-%
\bar{\alpha}_{t}}\beta_{t}\mathbf{I}),\ \bm{\mu}_{t}(\mathbf{z}_{t},\mathbf{z}%
_{0})=\frac{1}{\sqrt{\alpha_{t}}}(\mathbf{z}_{t}-\frac{1-\alpha_{t}}{\sqrt{1-%
\bar{\alpha}_{t}}}\bm{\epsilon}),
\bm{\epsilon}
\mathbf{z}_{t}
\bm{\epsilon}_{\theta}
\bm{\epsilon}
{\rm LE_{DM}}
{\rm LE_{DM}}
\mathbf{I}_{Blur}
\mathbf{c}
\in
\mathbb{R}^{N\times C^{\prime}}
\mathbf{z}_{t}
\mathbf{c}
\bm{\epsilon}_{\theta}(\mathbf{z}_{t},\mathbf{c},t)
\bm{\epsilon}_{\theta}
1
-
\alpha_{t}
\bm{z}_{t-1}=\frac{1}{\sqrt{\alpha_{t}}}(\bm{y}_{t}-\frac{1-\alpha_{t}}{\sqrt{%
1-\bar{\alpha}_{t}}}\bm{\epsilon}_{\theta}(\mathbf{z}_{t},\mathbf{c},t))+\sqrt%
{1-\alpha_{t}}\bm{\epsilon}_{t},
\bm{\epsilon}_{t}
\sim
\mathcal{N}(0,\mathbf{I})
\mathbf{z}_{t}
T
\hat{\mathbf{z}}
\in
\mathbb{R}^{N\times C^{\prime}}
\mathbf{z}_{1}
=
\hat{\mathbf{z}}
\mathbb{R}^{N\times C^{\prime}}
\mathbb{R}^{H\times W\times C}
T
\bm{\epsilon}_{\theta}
\nabla_{\bm{\theta}}\|\bm{\epsilon}-\bm{\epsilon}_{\theta}(\sqrt{\bar{\alpha}_%
{t}}\mathbf{z}+\sqrt{1-\bar{\alpha}_{t}}\bm{\epsilon},\mathbf{c},t)\|_{2}^{2},
\mathbf{z}
\mathbf{c}
t
\in
[1,T]
\bm{\epsilon}
\sim
\mathcal{N}(0,\mathbf{I})
\mathbf{z}
\mathbf{z}
\mathbf{z}_{T}
T
T
\hat{\mathbf{z}}
\hat{\mathbf{z}}
\mathbf{z}_{1}
=
\hat{\mathbf{z}}
\mathcal{L}_{\text{deblur}}
\mathcal{L}_{\text{diffusion}}
\mathcal{L}_{\text{diffusion}}
=
\|\hat{\mathbf{z}}-\mathbf{z}\|_{1}
\mathbf{I}_{Blur}
\in
\mathbb{R}^{H\times W\times 3}
\mathbf{I}_{Blur}
\mathbf{c}
\in
\mathbb{R}^{N\times C^{\prime}}
{\rm LE_{DM}}
\hat{\mathbf{z}}
\in
\mathbb{R}^{N\times C^{\prime}}
T
\bm{\epsilon}
\sim
\mathcal{N}(0,\mathbf{I})
\mathbf{I}_{DB}
\in
\mathbb{R}^{H\times W\times 3}
\mathbf{I}_{Blur}
\hat{\mathbf{z}}
\times
\times
\times
\times
N
C^{\prime}
L
=
6
T
\beta_{1:T}
\beta_{1}
=
0.1
\beta_{T}
=
0.99
\beta_{1}
0.9
{\beta}_{2}
0.99
\times
\times
160^{2}
192^{2}
256^{2}
320^{2}
384^{2}
\times
\times
\times
\mathbf{z}_{1}
=
\mathbf{z}_{2}
=
\mathbf{z}_{3}
=
\mathbf{z}
\hat{\mathbf{z}}
T
T
\{1,2,4,8,16,32\}
T
T
\{1,2,4,8,16,32\}
\mathbf{z}
T
\{1,2,4,8,16,32\}
\beta_{1:T}
\beta_{1}
=
0.1
\beta_{T}
=
0.99
T
T
N
=
16
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
{\color[rgb]{0,0,0}\uparrow}
\times
\times
\times
\times
\times
\times
