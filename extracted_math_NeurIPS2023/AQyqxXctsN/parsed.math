\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\right]=\sum_{\mathbf{x}\in\Omega(\mathbf{X})}p(\mathbf{x})f(\mathbf{x}),
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\right]=\sum_{\mathbf{x}\in\Omega(\mathbf{X})}p(\mathbf{x})f(\mathbf{x}),
\mathbf{X}
(X_{1},\dots,X_{D})
D
p(\mathbf{X})
\mathbf{X}\sim p(\mathbf{X})
\mathbf{X}
p(\mathbf{X})
\Omega(\mathbf{X})
\mathbf{X}
\mathbf{x}=(x_{1},\dots,x_{D})
(X_{1},\dots,X_{D})
\mathbf{X}
\displaystyle p(\mathbf{X})=\prod_{d=1}^{D}p(X_{d}\mid\mathbf{X}_{<d}).
\displaystyle p(\mathbf{X})=\prod_{d=1}^{D}p(X_{d}\mid\mathbf{X}_{<d}).
\mathbf{X}_{<d}
(X_{1},\dots,X_{d-1})
\mathbf{X}_{>d}
(X_{d+1},\dots,X_{D})
\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\right].
\lambda
p(\mathbf{X})
f(\mathbf{X})
\Lambda
\lambda\in\Lambda
p(\mathbf{X})
f(\mathbf{X})
\Lambda
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]=\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[\partial_{%
\lambda}f(\mathbf{X})\right]+\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(\mathbf{X})\right].
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]=\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[\partial_{%
\lambda}f(\mathbf{X})\right]+\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(\mathbf{X})\right].
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]\approx\frac{1}{N}\sum_{n=1}^{N}\left(\partial_{\lambda}f(%
\mathbf{x}^{(n)})+f(\mathbf{x}^{(n)})\partial_{\lambda}\log p(\mathbf{x}^{(n)}%
)\right).
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]\approx\frac{1}{N}\sum_{n=1}^{N}\left(\partial_{\lambda}f(%
\mathbf{x}^{(n)})+f(\mathbf{x}^{(n)})\partial_{\lambda}\log p(\mathbf{x}^{(n)}%
)\right).
\mathbf{x}^{(n)}
n^{\text{th}}
p(\mathbf{X})
p(\mathbf{X})
\Lambda
\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})\right]
\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})\right]
\displaystyle\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}\mathbb{E}_{%
\mathbf{X}_{<d}\sim p(\mathbf{X}_{<d})}\left[\partial_{\lambda}p(x_{\delta}%
\mid\mathbf{X}_{<d})\mathbb{E}_{\mathbf{X}_{>d}\sim p(\mathbf{X}_{>d}\mid x_{%
\delta},\mathbf{X}_{<d})}\left[f(\mathbf{X}_{\neq d},x_{\delta})\right]\right]
\displaystyle\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}\mathbb{E}_{%
\mathbf{X}_{<d}\sim p(\mathbf{X}_{<d})}\left[\partial_{\lambda}p(x_{\delta}%
\mid\mathbf{X}_{<d})\mathbb{E}_{\mathbf{X}_{>d}\sim p(\mathbf{X}_{>d}\mid x_{%
\delta},\mathbf{X}_{<d})}\left[f(\mathbf{X}_{\neq d},x_{\delta})\right]\right]
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log p(\mathbf{X})\right]=\mathbb{E}_{\mathbf{X}\sim p(%
\mathbf{X})}\left[f(\mathbf{X})\partial_{\lambda}\log\prod_{d=1}^{D}p(X_{d}%
\mid\mathbf{X}_{<d})\right],
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log p(\mathbf{X})\right]
\displaystyle=\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log\prod_{d=1}^{D}p(X_{d}\mid\mathbf{X}_{<d})\right],
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right].
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right].
X_{d}
\displaystyle\sum_{d=1}^{D}\sum_{\mathbf{x}\in\Omega(\mathbf{X}_{\neq d})}\sum%
_{x_{\delta}\in\Omega(X_{d})}p(\mathbf{x}_{\neq d},x_{\delta})f(\mathbf{x}_{%
\neq d},x_{\delta})\partial_{\lambda}\log p(x_{\delta}\mid\mathbf{x}_{<d}).
\displaystyle\sum_{d=1}^{D}\sum_{\mathbf{x}\in\Omega(\mathbf{X}_{\neq d})}\sum%
_{x_{\delta}\in\Omega(X_{d})}p(\mathbf{x}_{\neq d},x_{\delta})f(\mathbf{x}_{%
\neq d},x_{\delta})\partial_{\lambda}\log p(x_{\delta}\mid\mathbf{x}_{<d}).
p(\mathbf{x}_{\neq d},x_{\delta})
p(\mathbf{x}_{>d}\mid x_{\delta},\mathbf{x}_{<d})p(x_{\delta}\mid\mathbf{x}_{<%
d})p(\mathbf{x}_{<d})
\partial_{\lambda}\log p(x_{\delta}\mid\mathbf{x}_{<d})
\partial_{\lambda}p(x_{\delta}\mid\mathbf{x}_{<d})
\partial_{\lambda}p(x_{\delta}\mid\mathbf{x}_{<d})
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]\approx\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}%
\frac{1}{N}\sum_{n_{d}=1}^{N}\partial_{\lambda}p(x_{\delta}\mid\mathbf{x}_{<d}%
^{(n_{d})}){f(\mathbf{x}_{<d}^{(n_{d})},x_{\delta},\mathbf{x}_{>d}^{(n_{d})})},
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]\approx\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}%
\frac{1}{N}\sum_{n_{d}=1}^{N}\partial_{\lambda}p(x_{\delta}\mid\mathbf{x}_{<d}%
^{(n_{d})}){f(\mathbf{x}_{<d}^{(n_{d})},x_{\delta},\mathbf{x}_{>d}^{(n_{d})})},
\mathbf{x}_{>d}^{(n_{d})}
x_{\delta}
\mathbf{x}_{<d}^{(n_{d})}
n_{d}
d
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]\approx\frac{1}{N}\sum_{n=1}^{N}f(\mathbf{x}^{(n)})%
\partial_{\lambda}\log p(\mathbf{x}^{(n)})\approx\sum_{d=1}^{D}\frac{1}{N}\sum%
_{n=1}^{N}f(\mathbf{x}^{(n)})\partial_{\lambda}\log p(x_{d}^{(n)}).
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]\approx\frac{1}{N}\sum_{n=1}^{N}f(\mathbf{x}^{(n)})%
\partial_{\lambda}\log p(\mathbf{x}^{(n)})\approx\sum_{d=1}^{D}\frac{1}{N}\sum%
_{n=1}^{N}f(\mathbf{x}^{(n)})\partial_{\lambda}\log p(x_{d}^{(n)}).
n_{d}
n
N\rightarrow\infty
\displaystyle\sum_{n=1}^{N}\mathbb{E}_{X_{d}\sim p(X_{d}\mid\mathbf{x}_{<d}^{(%
n)})}\left[f(\mathbf{x}_{<d}^{(n)},X_{d},\mathbf{x}_{>d}^{(n)})\partial_{%
\lambda}\log p(X_{d}{\mid}\mathbf{x}_{<d}^{(n)})\right]{=}\sum_{n=1}^{N}f(%
\mathbf{x}_{<d}^{(n)},x_{d}^{(n)},\mathbf{x}_{>d}^{(n)})\partial_{\lambda}\log
p%
(x_{d}^{(n)}).
\displaystyle\sum_{n=1}^{N}\mathbb{E}_{X_{d}\sim p(X_{d}\mid\mathbf{x}_{<d}^{(%
n)})}\left[f(\mathbf{x}_{<d}^{(n)},X_{d},\mathbf{x}_{>d}^{(n)})\partial_{%
\lambda}\log p(X_{d}{\mid}\mathbf{x}_{<d}^{(n)})\right]{=}\sum_{n=1}^{N}f(%
\mathbf{x}_{<d}^{(n)},x_{d}^{(n)},\mathbf{x}_{>d}^{(n)})\partial_{\lambda}\log
p%
(x_{d}^{(n)}).
X_{d}
\Omega(X_{d})
d
K=\max_{d}(\absolutevalue{\Omega(X_{d})})
1
D
K
N
\mathcal{O}(D\cdot K\cdot N)
\mathcal{O}(\log D+\log K+\log N)
D\cdot\max_{d}(\absolutevalue{\Omega(X_{d})})\cdot N
X_{i}
X_{i}
p(\mathbf{X})=\prod_{d=1}^{D}p_{d}(X_{d}).
D
\Lambda
p_{d}
p(\mathbf{X})
\Lambda
p(\mathbf{X})=\prod_{d=1}^{D}p_{d}(X_{d})
\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})\right]
\displaystyle\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}\partial_{\lambda}%
p_{d}(x_{\delta})\frac{1}{N}\sum_{n_{d}=1}^{N}f(\mathbf{x}_{\neq d}^{(n_{d})},%
x_{\delta}),
\displaystyle\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}\partial_{\lambda}%
p_{d}(x_{\delta})\frac{1}{N}\sum_{n_{d}=1}^{N}f(\mathbf{x}_{\neq d}^{(n_{d})},%
x_{\delta}),
\mathbf{x}_{\neq d}^{(n_{d})}
p(\mathbf{X}_{\neq d})
p(x_{\delta}\mid\mathbf{X}_{<d})
p_{d}(x_{\delta})
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]=\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}\mathbb{E}%
_{\mathbf{X}_{<d}\sim p(\mathbf{X}_{<d})}\left[\partial_{\lambda}p_{d}(x_{%
\delta})\mathbb{E}_{\mathbf{X}_{>d}\sim p(\mathbf{X}_{>d})}\left[f(\mathbf{X}_%
{\neq d},x_{\delta})\right]\right]
\displaystyle\partial_{\lambda}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
f(\mathbf{X})\right]
\displaystyle=\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}\mathbb{E}_{%
\mathbf{X}_{<d}\sim p(\mathbf{X}_{<d})}\left[\partial_{\lambda}p_{d}(x_{\delta%
})\mathbb{E}_{\mathbf{X}_{>d}\sim p(\mathbf{X}_{>d})}\left[f(\mathbf{X}_{\neq d%
},x_{\delta})\right]\right]
\displaystyle=\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}\partial_{\lambda%
}p_{d}(x_{\delta})\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{\neq d})}%
\left[f(\mathbf{X}_{\neq d},x_{\delta})\right]
\displaystyle=\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}\partial_{\lambda%
}p_{d}(x_{\delta})\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{\neq d})}%
\left[f(\mathbf{X}_{\neq d},x_{\delta})\right]
N
D-1
\mathbf{X}_{\neq d}
d
\displaystyle p(X_{1},X_{2},X_{3})=p_{1}(X_{1})p_{2}(X_{2})p_{3}(X_{3}),
\displaystyle p(X_{1},X_{2},X_{3})=p_{1}(X_{1})p_{2}(X_{2})p_{3}(X_{3}),
X_{1}
X_{2}
X_{3}
\Omega(X)=\{1,2,3\}
\displaystyle\sum_{d=1}^{3}\sum_{x_{\delta}\in\{1,2,3\}}\partial_{\lambda}p_{d%
}(x_{\delta})\frac{1}{N}\sum_{n_{d}=1}^{N}f(\mathbf{x}_{\neq i}^{(n_{d})},x_{%
\delta}).
\displaystyle\sum_{d=1}^{3}\sum_{x_{\delta}\in\{1,2,3\}}\partial_{\lambda}p_{d%
}(x_{\delta})\frac{1}{N}\sum_{n_{d}=1}^{N}f(\mathbf{x}_{\neq i}^{(n_{d})},x_{%
\delta}).
d=2
\displaystyle\partial_{\lambda}p_{2}(1)f(x_{1},1,x_{3})+\partial_{\lambda}p_{2%
}(2)f(x_{1},2,x_{3})+\partial_{\lambda}p_{2}(3)f(x_{1},3,x_{3}),
\displaystyle\partial_{\lambda}p_{2}(1)f(x_{1},1,x_{3})+\partial_{\lambda}p_{2%
}(2)f(x_{1},2,x_{3})+\partial_{\lambda}p_{2}(3)f(x_{1},3,x_{3}),
x_{1}
x_{3}
X_{1}
X_{3}
d\neq 2
\partial_{\lambda}p_{2}(x_{2})f(x_{1},x_{2},x_{3}).
D=1
X_{d}
\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{\neq d})}\left[f(\mathbf{X}_%
{\neq d},X_{d})\right]
1
\Lambda
f
\displaystyle\partial_{\theta}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
\sum_{d=1}^{D}\left|X_{d}-b_{d}\right|\right]
\displaystyle\partial_{\theta}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[%
\sum_{d=1}^{D}\left|X_{d}-b_{d}\right|\right]
\theta
p(\mathbf{X})=\prod_{d=1}^{D}p(X_{d})
b_{d}
\Omega(X_{d})
D
1000
D\cdot K
D=12
\absolutevalue{\Omega(X_{d})}=3
D=12
\absolutevalue{\Omega(X_{d})}=3
D=6
\absolutevalue{\Omega(X_{d})}=10
D=6
\absolutevalue{\Omega(X_{d})}=10
D=3
\absolutevalue{\Omega(X_{d})}=100
D=3
\absolutevalue{\Omega(X_{d})}=100
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[\frac{1}{D}\sum_{i%
=1}^{D}(X_{i}-0.499)^{2}\right],
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[\frac{1}{D}\sum_{i%
=1}^{D}(X_{i}-0.499)^{2}\right],
p(\mathbf{X})
D
p(X_{d}=1)=1
d
X_{d}
D
D=200
N
D\cdot K\cdot N
K=\max_{d}\absolutevalue{\Omega(X_{d})}
N
D\cdot K\cdot N
800
800
\approx 1.6
D
10^{D}
10D+1
0
9
D
\sum_{d=1}^{D}
D
10
D\cdot 10
D\cdot 10\cdot 10
D\cdot 10\cdot 10
16
4
8
12
16
f
99\%
x
4
8
12
16
f
99\%
x
D\times K
D
K
\left\{10,1,0.1,0.01\right\}
e^{-0.05}
\left\{10,5,1,0.1,0.01\right\}
5
1
0.01
0
1
255
0.5
0
0
1
105\times 105\times 3
28\times 28
28\times 28
784
384
256
200
200
200
256
384
784
1
e^{-0.01}
0.1
10^{-3}
10^{-4}
2
800
N
N
\lfloor 60000/N\rfloor
5
120
84
10
\displaystyle-\log P(\sum_{i}^{N}D_{i}=s)=-\log\mathbb{E}_{\bm{D}\sim p(\bm{D}%
)}\left[\mathbbm{1}_{\sum_{i}^{N}D_{i}=s}\right].
\displaystyle-\log P(\sum_{i}^{N}D_{i}=s)
\displaystyle=-\log\mathbb{E}_{\bm{D}\sim p(\bm{D})}\left[\mathbbm{1}_{\sum_{i%
}^{N}D_{i}=s}\right].
10^{-3}
p(\mathbf{X})=\prod_{d=1}^{D}p(X_{d}\mid\mathbf{X}_{<d})
\lambda\in\Lambda
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log p(\mathbf{X})\right]
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log p(\mathbf{X})\right]
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{%
\neq d})}\left[\mathbb{E}_{X_{d}\sim{p(X_{d}\mid\text{MB}(X_{d}))}}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right]\right]
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{%
\neq d})}\left[\mathbb{E}_{X_{d}\sim{p(X_{d}\mid\text{MB}(X_{d}))}}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right]\right]
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}_{<d}\sim p(\mathbf{X}_{<d})%
}\Bigg{[}\mathbb{E}_{X_{d}^{\prime}\sim p(X_{d}^{\prime}\mid\mathbf{X}_{<d})}%
\bigg{[}
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}_{<d}\sim p(\mathbf{X}_{<d})%
}\Bigg{[}\mathbb{E}_{X_{d}^{\prime}\sim p(X_{d}^{\prime}\mid\mathbf{X}_{<d})}%
\bigg{[}
\displaystyle\qquad\quad\mathbb{E}_{\mathbf{X}_{>d}\sim p(\mathbf{X}_{>d}\mid{%
X_{d}^{\prime}},\mathbf{X}_{<d})}\Big{[}\mathbb{E}_{X_{d}\sim{p(X_{d}\mid%
\mathbf{X}_{\neq d})}}\left[f(\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid%
\mathbf{X}_{<d})\right]\Big{]}\bigg{]}\Bigg{]}
\displaystyle\qquad\quad\mathbb{E}_{\mathbf{X}_{>d}\sim p(\mathbf{X}_{>d}\mid{%
X_{d}^{\prime}},\mathbf{X}_{<d})}\Big{[}\mathbb{E}_{X_{d}\sim{p(X_{d}\mid%
\mathbf{X}_{\neq d})}}\left[f(\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid%
\mathbf{X}_{<d})\right]\Big{]}\bigg{]}\Bigg{]}
\text{MB}(X_{d})
X_{d}
\displaystyle p(X_{d}\mid\text{MB}(X_{d}))=p(X_{d}\mid\mathbf{X}_{\neq d})=%
\frac{p(X_{d}\mid\mathbf{X}_{<d})\prod_{j>d}p(X_{j}\mid\mathbf{X}_{<j})}{\sum_%
{x_{\delta}\in\Omega(X_{d})}p(x_{\delta}\mid\mathbf{X}_{<d})\prod_{j>d}p(X_{j}%
\mid\mathbf{X}_{<j})}
\displaystyle p(X_{d}\mid\text{MB}(X_{d}))=p(X_{d}\mid\mathbf{X}_{\neq d})=%
\frac{p(X_{d}\mid\mathbf{X}_{<d})\prod_{j>d}p(X_{j}\mid\mathbf{X}_{<j})}{\sum_%
{x_{\delta}\in\Omega(X_{d})}p(x_{\delta}\mid\mathbf{X}_{<d})\prod_{j>d}p(X_{j}%
\mid\mathbf{X}_{<j})}
N
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log p(\mathbf{X})\right]\approx\frac{1}{N}\sum_{n=1}^{N}%
\sum_{d=1}^{D}\sum_{x_{\delta}\in\Omega(X_{d})}{p(x_{\delta}\mid\mathbf{x}_{%
\neq d}^{(n)})}f(\mathbf{x}_{\neq d}^{(n)},x_{\delta})\partial_{\lambda}\log p%
(x_{\delta}\mid\mathbf{x}_{<d}^{(n)})
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log p(\mathbf{X})\right]
\displaystyle\approx\frac{1}{N}\sum_{n=1}^{N}\sum_{d=1}^{D}\sum_{x_{\delta}\in%
\Omega(X_{d})}{p(x_{\delta}\mid\mathbf{x}_{\neq d}^{(n)})}f(\mathbf{x}_{\neq d%
}^{(n)},x_{\delta})\partial_{\lambda}\log p(x_{\delta}\mid\mathbf{x}_{<d}^{(n)})
\mathcal{O}(N\cdot D^{2}\cdot K)
K=\max_{d}(\mid\Omega(X_{d})\mid)
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log p(\mathbf{X})\right]=\mathbb{E}_{\mathbf{X}\sim p(%
\mathbf{X})}\left[f(\mathbf{X})\partial_{\lambda}\log\prod_{d=1}^{D}p(X_{d}%
\mid\mathbf{X}_{<d})\right]
\displaystyle\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log p(\mathbf{X})\right]
\displaystyle=\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(\mathbf{X})%
\partial_{\lambda}\log\prod_{d=1}^{D}p(X_{d}\mid\mathbf{X}_{<d})\right]
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right]
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right]
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{%
\neq d})}\left[\underbrace{\mathbb{E}_{X_{d}\sim p(X_{d}\mid\mathbf{X}_{\neq d%
})}\left[f(\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right%
]}_{\text{$=g(\mathbf{X}_{\neq d})$}}\right].
\displaystyle=\sum_{d=1}^{D}\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{%
\neq d})}\left[\underbrace{\mathbb{E}_{X_{d}\sim p(X_{d}\mid\mathbf{X}_{\neq d%
})}\left[f(\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right%
]}_{\text{$=g(\mathbf{X}_{\neq d})$}}\right].
p(X_{d}\mid\mathbf{X}_{\neq d})=p(X_{d}\mid\text{MB}(X_{d}))
\displaystyle\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{\neq d})}\left[%
g(\mathbf{X}_{\neq d})\right]
\displaystyle\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{\neq d})}\left[%
g(\mathbf{X}_{\neq d})\right]
\displaystyle\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{\neq d})}\left[%
g(\mathbf{X}_{\neq d})\right]=\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[g%
(\mathbf{X}_{\neq d})\right]
\displaystyle\mathbb{E}_{\mathbf{X}_{\neq d}\sim p(\mathbf{X}_{\neq d})}\left[%
g(\mathbf{X}_{\neq d})\right]
\displaystyle=\mathbb{E}_{\mathbf{X}\sim p(\mathbf{X})}\left[g(\mathbf{X}_{%
\neq d})\right]
\displaystyle=\mathbb{E}_{\mathbf{X}_{<d}\sim p(\mathbf{X}_{<d})}\mathbb{E}_{X%
_{d}^{\prime}\sim p(X_{d}^{\prime}\mid\mathbf{X}_{<d})}\mathbb{E}_{\mathbf{X}_%
{>d}\sim p(\mathbf{X}_{>d}\mid X_{d}^{\prime},\mathbf{X}_{<d})}\left[g(\mathbf%
{X}_{\neq d})\right]
\displaystyle=\mathbb{E}_{\mathbf{X}_{<d}\sim p(\mathbf{X}_{<d})}\mathbb{E}_{X%
_{d}^{\prime}\sim p(X_{d}^{\prime}\mid\mathbf{X}_{<d})}\mathbb{E}_{\mathbf{X}_%
{>d}\sim p(\mathbf{X}_{>d}\mid X_{d}^{\prime},\mathbf{X}_{<d})}\left[g(\mathbf%
{X}_{\neq d})\right]
N
\mathcal{O}(D)
\mathcal{O}(N\cdot D\cdot K)
\mathcal{O}(N\cdot D^{2}\cdot K)
\displaystyle\text{LEG}=\sum_{d=1}^{D}\mathbb{E}_{(\mathbf{X}_{<d},{\color[rgb%
]{0.9765625,0.25390625,0.265625}X_{d}^{\prime}},\mathbf{X}_{>d})\sim p(\mathbf%
{X}_{<d},{\color[rgb]{0.9765625,0.25390625,0.265625}X_{d}^{\prime}},\mathbf{X}%
_{>d})}\left[\mathbb{E}_{\mathbf{X}_{d}\sim{\color[rgb]{%
0.15234375,0.48828125,0.6328125}p(X_{d}\mid\mathbf{X}_{\neq d})}}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right]\right]
\displaystyle\text{LEG}=\sum_{d=1}^{D}\mathbb{E}_{(\mathbf{X}_{<d},{\color[rgb%
]{0.9765625,0.25390625,0.265625}X_{d}^{\prime}},\mathbf{X}_{>d})\sim p(\mathbf%
{X}_{<d},{\color[rgb]{0.9765625,0.25390625,0.265625}X_{d}^{\prime}},\mathbf{X}%
_{>d})}\left[\mathbb{E}_{\mathbf{X}_{d}\sim{\color[rgb]{%
0.15234375,0.48828125,0.6328125}p(X_{d}\mid\mathbf{X}_{\neq d})}}\left[f(%
\mathbf{X})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right]\right]
\displaystyle\text{CatLog}=\sum_{d=1}^{D}\mathbb{E}_{(\mathbf{X}_{<d},{\color[%
rgb]{0.9765625,0.25390625,0.265625}X_{d}},\mathbf{X}_{>d})\sim p(\mathbf{X}_{<%
d},{\color[rgb]{0.9765625,0.25390625,0.265625}X_{d}},\mathbf{X}_{>d})}\left[f(%
\mathbf{X}_{\neq d},X_{d})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right]
\displaystyle\text{CatLog}=\sum_{d=1}^{D}\mathbb{E}_{(\mathbf{X}_{<d},{\color[%
rgb]{0.9765625,0.25390625,0.265625}X_{d}},\mathbf{X}_{>d})\sim p(\mathbf{X}_{<%
d},{\color[rgb]{0.9765625,0.25390625,0.265625}X_{d}},\mathbf{X}_{>d})}\left[f(%
\mathbf{X}_{\neq d},X_{d})\partial_{\lambda}\log p(X_{d}\mid\mathbf{X}_{<d})\right]
\mathcal{O}(N\cdot D^{2}\cdot K)
\mathcal{O}(N\cdot D\cdot K)
p(X_{d}\mid\text{MB}(X_{d}))=p(X_{d}\mid\mathbf{X}_{\neq d})
