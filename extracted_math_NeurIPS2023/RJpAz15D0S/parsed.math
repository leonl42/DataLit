\times
(m,s,h)
m
s
h
l
l
(b,s,h)
b
s
h
X
K
V
Q
X
K=X\times W^{K}
V=X\times W^{V}
Q=X\times W^{Q}
W^{K}
W^{V}
W^{Q}
Q\times K^{T}
Z
Z_{ij}
i
j
Z
V
h\times 4h
4h\times h
24bsh^{2}\left(1+\frac{s}{6h}\right)
s
h
s\ll 6h
\Pr(x_{i}|x_{1:i-1})
x_{i}
x_{1},x_{2},\ldots,x_{i-1}
\Pr(x_{1}|\emptyset),\Pr(x_{2}|x_{1:1}),\Pr(x_{3}|x_{1:2}),\ldots,\Pr(x_{s}|x_%
{1:s-1})
x_{i}
x_{i}
\Pr(x_{i}|x_{1:i-1})
x_{i+1}
x_{1},x_{2},\ldots,x_{p}
p
\Pr(x_{p+1}|x_{1:p})
\Pr(x_{i+1}|x_{1:i})
i>p
p
o
o
o-1
o
p
\displaystyle t(\text{prompt size }p,\text{number of output tokens }o)=
\displaystyle t(\text{prompt size }p,\text{number of output tokens }o)=
\displaystyle\textsf{\small prompt\_encoding\_time}(p)+\textsf{\small output\_%
generation\_time}(o).
\displaystyle\textsf{\small prompt\_encoding\_time}(p)+\textsf{\small output\_%
generation\_time}(o).
\Pr(x_{i+1}|x_{1:i})
p
24bph^{2}l\left(1+\frac{p}{6h}\right)
l
p\ll 6h
24bph^{2}l
\theta_{pe}\cdot p
p
h
l
i
(i+1)^{\text{th}}
(i+1)^{\text{th}}
24bh^{2}l+4bihl=24bh^{2}l\left(1+\frac{i}{6h}\right)
i\ll 6h
h=12288
\theta_{og}
\displaystyle\textsf{\small prompt\_encoding\_time}(p)=\dfrac{\theta_{pe}\cdot
p%
}{\text{throughput}_{pe}(p)}
\displaystyle\textsf{\small prompt\_encoding\_time}(p)=\dfrac{\theta_{pe}\cdot
p%
}{\text{throughput}_{pe}(p)}
\displaystyle\textsf{\small output\_generation\_time}(o)=\sum_{\text{token }i}%
\dfrac{\theta_{og}}{\text{throughput}_{og}(i)}
\displaystyle\textsf{\small output\_generation\_time}(o)=\sum_{\text{token }i}%
\dfrac{\theta_{og}}{\text{throughput}_{og}(i)}
\text{throughput}_{og}
o
h
l
n
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
p
R^{2}
>0.999
\textsf{\small output\_generation\_time}(o)
o
p
p
p
p
o
\displaystyle t(\text{prompt size }p,\text{number of output tokens }o)=
\displaystyle t(\text{prompt size }p,\text{number of output tokens }o)=
\displaystyle\textsf{\small prompt\_encoding\_time}(p)+(o-1)\cdot g.
\displaystyle\textsf{\small prompt\_encoding\_time}(p)+(o-1)\cdot g.
p
o
p
y
p
\text{max\_context\_length}=
P=\{
\}
p
\textsf{\small total\_runtime}(p,o)-\textsf{\small prompt\_encoding\_time}(p)
o
y=\text{runtime difference}
x=o
g
\displaystyle t(\text{prompt size }p,\text{number of output tokens }o)=
\displaystyle t(\text{prompt size }p,\text{number of output tokens }o)=
\displaystyle\textsf{\small prompt\_encoding\_time}(p)+(o-1)\cdot g+\textsf{%
\small overhead}.
\displaystyle\textsf{\small prompt\_encoding\_time}(p)+(o-1)\cdot g+\textsf{%
\small overhead}.
\sim
\times
p=512
p=512
\times
\displaystyle t^{\text{idealized}}_{(m,s,h)}(\text{prompt size }p,\text{number%
 of output tokens }o)=
\displaystyle t^{\text{idealized}}_{(m,s,h)}(\text{prompt size }p,\text{number%
 of output tokens }o)=
\displaystyle\textsf{\small prompt\_encoding\_time}^{\text{idealized}}_{(m,s,h%
)}(p)+(o-1)\cdot g^{\text{idealized}}_{(m,s,h)}.
\displaystyle\textsf{\small prompt\_encoding\_time}^{\text{idealized}}_{(m,s,h%
)}(p)+(o-1)\cdot g^{\text{idealized}}_{(m,s,h)}.
\displaystyle t^{\text{denoised}}_{m\text{ on API }a}(\text{prompt size }p,%
\text{number of output tokens }o)=
\displaystyle t^{\text{denoised}}_{m\text{ on API }a}(\text{prompt size }p,%
\text{number of output tokens }o)=
\displaystyle\textsf{\small prompt\_encoding\_time}^{\text{denoised}}_{m\text{%
 on API }a}(p)+(o-1)\cdot g^{\text{denoised}}_{m\text{ on API }a}.
\displaystyle\textsf{\small prompt\_encoding\_time}^{\text{denoised}}_{m\text{%
 on API }a}(p)+(o-1)\cdot g^{\text{denoised}}_{m\text{ on API }a}.
\eta\geq 0
m
a
p
o
s^{*}
h^{*}
a
\displaystyle t^{\text{raw}}_{m\text{ on API }a}(p,o)\geq t^{\text{denoised}}_%
{m\text{ on API }a}(p,o)\geq t^{\text{idealized}}_{(m,s^{*},h^{*})}(p,o).
\displaystyle t^{\text{raw}}_{m\text{ on API }a}(p,o)
\displaystyle\geq
\displaystyle t^{\text{denoised}}_{m\text{ on API }a}(p,o)
\displaystyle\geq
\displaystyle t^{\text{idealized}}_{(m,s^{*},h^{*})}(p,o).
s^{*}
h^{*}
t^{\text{idealized}}_{(m,s,h)}\text{ (secs)}\times n_{\text{accelerator $h$}}%
\times c_{\text{accelerator $h$}}\text{ (\$/sec)}.
h
h
n_{\text{accelerator $h$}}
h
1
>1
c_{\text{accelerator $h$}}
h
h
h
c_{\text{accelerator}}
t^{\text{idealized}}_{(m,s,h)}\text{ (secs)}\times n_{\text{accelerator $h$}}%
\times p_{\text{accelerator $h$}}\text{ (W)}.
h
h
p_{\text{accelerator $h$}}
h
h
y=x
y=x
R^{2}
R^{2}
R^{2}
(p=512/1024/1536)
g
t_{(m,\text{ Megatron},\text{ A100})}^{\text{idealized}}
t_{m}^{\text{denoised}}
t_{(m,\text{ Megatron},\text{ A100})}^{\text{idealized}}
t_{m}^{\text{denoised}}
t_{(m,\text{ Megatron},\text{ A100})}^{\text{idealized}}
t_{m}^{\text{denoised}}
t_{(m,\text{ Megatron},\text{ A100})}^{\text{idealized}}
t_{m}^{\text{denoised}}
t_{(m,\text{ Megatron},\text{ A100})}^{\text{idealized}}
t_{m}^{\text{denoised}}
t_{(m,\text{ Megatron},\text{ A100})}^{\text{idealized}}
t_{m}^{\text{denoised}}
y=x
t_{(m,\text{ Megatron},\text{ A100})}^{\text{idealized}}
t_{m}^{\text{denoised}}
<2
(p,o)
\times
f_{1}(\text{accuracy},\text{idealized runtime})=\frac{\text{accuracy}}{\text{%
idealized runtime}}
f_{1}(\text{accuracy},\text{idealized runtime})=\frac{\text{accuracy}}{\text{%
idealized runtime}}
f_{2}(\text{accuracy},\text{idealized runtime})=\frac{\text{accuracy}}{\log(%
\text{idealized runtime})}
f_{2}(\text{accuracy},\text{idealized runtime})=\frac{\text{accuracy}}{\log(%
\text{idealized runtime})}
f_{1}(\text{accuracy},\text{idealized runtime})=\frac{\text{accuracy}}{\text{%
idealized runtime}}
f_{2}(\text{accuracy},\text{idealized runtime})=\frac{\text{accuracy}}{\log(%
\text{idealized runtime})}
X
X
{}_{\text{2}}
b
h
W_{i}^{K}
W_{i}^{V}
W_{i}^{Q}
n
s
X
(b,s,h)
(bs,h)\times(h,3h)
(bs,3h)
bn
(s,h/n)\times(h/n,s)
(bn,s,s)
bn
(s,s)\times(s,h/n)
(bn,s,h/n)
(bs,h)\times(h,h)
n
h
(bs,h)
(bs,h)\times(h,4h)
(bs,4h)\times(4h,h)
(bs,4h)
(bs,h)
(m,n)\times(n,k)
2mnk
24bsh^{2}\left(1+\frac{s}{6h}\right)
l
24bsh^{2}l\left(1+\frac{s}{6h}\right)
i
(i+1)^{\text{th}}
K
V
Q
(b,h)\times(h,3h)
bn
(1,h/n)\times(h/n,i)
Q
K
V
bn
(1,i)\times(i,h/n)
(b,h)\times(h,h)
(b,h)\times(h,4h)
(b,4h)\times(4h,h)
(i+1)^{\text{th}}
24bh^{2}l+4bihl=24bh^{2}l\left(1+\frac{i}{6h}\right)
