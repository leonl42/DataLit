\mathcal{T}_{Z}\circ\phi
\pi_{\alpha}
\mathcal{D}^{\mathrm{off}}
\pi_{Z}
\mathcal{D}^{\pi_{*}}
\phi
\pi_{Z}
\pi_{\alpha}
\mathcal{T}_{Z}\circ\phi
\pi_{\alpha}
\mathcal{D}^{\mathrm{off}}
\pi_{Z}
\mathcal{D}^{\pi_{*}}
\phi
\pi_{Z}
\pi_{\alpha}
\mathcal{M}:=\langle S,A,\mathcal{R},\mathcal{T},\mu,\gamma\rangle
S
A
\mathcal{R}:S\times A\to\mathbb{R}
\mathcal{T}:S\times A\to\Delta(S)
\Delta({\mathcal{X}})
{\mathcal{X}}
\mu\in\Delta(S)
\gamma\in[0,1)
\pi:S\to\Delta(A)
s_{0}\sim\mu
a_{t}\sim\pi(s_{t})
t\geq 0
\mathcal{R}(s_{t},a_{t})
s_{t+1}\sim\mathcal{T}(s_{t},a_{t})
\mathcal{R}
d^{\pi}(s)
\pi
d^{\pi}(s):=(1-\gamma)\sum_{t=0}^{\infty}\gamma^{t}\cdot\Pr\left[s_{t}=s|\pi,%
\mathcal{M}\right]
(s,a)\sim d^{\pi}
s\sim d^{\pi},a\sim\pi(s)
\pi_{*}
\mathcal{D}^{\pi_{*}}=\{(s_{i},a_{i})\}_{i=1}^{n}
s_{i}\sim d^{\pi}_{*}
a_{i}\sim\pi_{*}(s_{i})
\pi
\pi
\pi_{*}
\mathrm{Diff}(\pi,\pi_{*})=D_{\mathrm{TV}}(d^{\pi}\|d^{\pi}_{*}),
\pi
\pi_{*}
\pi
\mathcal{D}^{\pi_{*}}
J_{\mathrm{BC}}(\pi):=\mathbb{E}_{(s,a)\sim(d^{\pi_{*}},\pi_{*})}[-\log\pi(a|s%
)],
\mathrm{Diff}(\pi,\pi_{*})
\small\mathrm{Diff}(\pi,\pi_{*})\leq\frac{\gamma}{1-\gamma}\sqrt{\frac{1}{2}%
\mathbb{E}_{d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*}(s)\|\pi(s))]}=\frac{\gamma}{1%
-\gamma}\sqrt{\mathrm{const}(\pi_{*})+\frac{1}{2}J_{\mathrm{BC}}(\pi)}.
\mathcal{D}^{\pi_{*}}
\mathcal{D}^{\mathrm{off}}=\{(s_{i},a_{i},s_{i}^{\prime})\}_{i=1}^{m}
a_{i}\sim\mathrm{Unif}_{A}
(s,a,s^{\prime})\sim d^{\mathrm{off}}
\mathcal{D}^{\mathrm{off}}
s_{i}\sim d^{\mathrm{off}},a_{i}\sim\mathrm{Unif}_{A},s_{i}^{\prime}\sim%
\mathcal{T}(s_{i},a_{i}),
d^{\mathrm{off}}
d^{\mathrm{off}}
d^{\pi_{*}}(s)>0\Rightarrow d^{\mathrm{off}}(s)>0
s\in S
\mathcal{D}^{\mathrm{off}}
\eta>0
\frac{1}{|A|\eta}
\mathcal{D}^{\mathrm{off}}
\mathcal{D}^{\mathrm{off}}
(s,a,s^{\prime})
\mathcal{D}^{\mathrm{off}}
\overline{\mathcal{T}}:=\mathcal{T}_{Z}\circ\phi
\mathcal{D}^{\mathrm{off}}
\phi:S\times A\to Z
\mathcal{T}_{Z}:S\times Z\to\Delta(S)
\phi
\mathcal{T}_{Z}
\pi_{\alpha}
\pi_{Z}
\phi
\phi:S\times A\to Z
\mathcal{T}_{Z}:S\times Z\to\Delta(S)
\pi_{\alpha}:S\times Z\to\Delta(A)
\pi_{Z}:S\to\Delta(Z)
\displaystyle J_{\mathrm{T}}(\mathcal{T}_{Z},\phi):=\mathbb{E}_{(s,a)\sim d^{%
\mathrm{off}}}\left[D_{\mathrm{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s%
,a)))\right],
\displaystyle J_{\mathrm{T}}(\mathcal{T}_{Z},\phi)
\displaystyle:=\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm{KL}}(%
\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))\right],
J_{\mathrm{DE}}(\pi_{\alpha},\phi):=\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}[-%
\log\pi_{\alpha}(a|s,\phi(s,a))],
J_{\mathrm{BC},\phi}(\pi_{Z}):=\mathbb{E}_{(s,a)\sim(d^{\pi_{*}},\pi_{*})}[-%
\log\pi_{Z}(\phi(s,a)|s)].
\pi_{\alpha}\circ\pi_{Z}:S\to\Delta(A)
\pi_{*}
\mathrm{Diff}(\pi_{\alpha}\circ\pi_{Z},\pi_{*})\leq
\displaystyle C_{1}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm{KL}}(\mathcal{T}(s,a)%
\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}\kern-101.71417pt}}\hphantom{\sqrt{%
\vphantom{\displaystyle\frac{1}{2}\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left%
[D_{\mathrm{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}}}%
\frac{1}{2}\underbrace{\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm%
{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}_{\displaystyle={%
\color[rgb]{0,0,1}J_{\mathrm{T}}(\mathcal{T}_{Z},\phi)}}
\displaystyle C_{1}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm{KL}}(\mathcal{T}(s,a)%
\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}\kern-101.71417pt}}\hphantom{\sqrt{%
\vphantom{\displaystyle\frac{1}{2}\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left%
[D_{\mathrm{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}}}%
\frac{1}{2}\underbrace{\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm%
{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}_{\displaystyle={%
\color[rgb]{0,0,1}J_{\mathrm{T}}(\mathcal{T}_{Z},\phi)}}
\displaystyle+C_{2}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{\mathrm{KL}}(\pi_{\alpha^{%
*}}(s,z)\|\pi_{\alpha}(s,z))]}\kern-46.82202pt}}\hphantom{\sqrt{\vphantom{%
\displaystyle\frac{1}{2}\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{%
\mathrm{KL}}(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]}}}\frac{1}{2}%
\underbrace{\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{\mathrm{KL}}(%
\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]}_{\displaystyle\approx~{}\mathrm{%
const}(d^{\mathrm{off}},\phi)+{\color[rgb]{0,0,1}J_{\mathrm{DE}}(\pi_{\alpha},%
\phi)}}
\displaystyle+
\displaystyle C_{2}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{\mathrm{KL}}(\pi_{\alpha^{%
*}}(s,z)\|\pi_{\alpha}(s,z))]}\kern-46.82202pt}}\hphantom{\sqrt{\vphantom{%
\displaystyle\frac{1}{2}\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{%
\mathrm{KL}}(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]}}}\frac{1}{2}%
\underbrace{\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{\mathrm{KL}}(%
\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]}_{\displaystyle\approx~{}\mathrm{%
const}(d^{\mathrm{off}},\phi)+{\color[rgb]{0,0,1}J_{\mathrm{DE}}(\pi_{\alpha},%
\phi)}}
\displaystyle+C_{3}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{Z}(s))]}%
\kern-8.21957pt}}\hphantom{\sqrt{\vphantom{\displaystyle\frac{1}{2}\mathbb{E}_%
{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{Z}(s))]}}}\frac{1}{2}%
\underbrace{\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{%
Z}(s))]}_{\displaystyle=~{}\mathrm{const}(\pi_{*},\phi)+{\color[rgb]{1,0,0}J_{%
\mathrm{BC},\phi}(\pi_{Z})}},
\displaystyle+
\displaystyle C_{3}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{Z}(s))]}%
\kern-8.21957pt}}\hphantom{\sqrt{\vphantom{\displaystyle\frac{1}{2}\mathbb{E}_%
{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{Z}(s))]}}}\frac{1}{2}%
\underbrace{\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{%
Z}(s))]}_{\displaystyle=~{}\mathrm{const}(\pi_{*},\phi)+{\color[rgb]{1,0,0}J_{%
\mathrm{BC},\phi}(\pi_{Z})}},
C_{1}=\gamma|A|(1-\gamma)^{-1}(1+D_{\mathrm{\chi^{2}}}(d^{\pi_{*}}\|d^{\mathrm%
{off}})^{\frac{1}{2}})
C_{2}=\gamma(1-\gamma)^{-1}(1+D_{\mathrm{\chi^{2}}}(d^{\pi_{*}}\|d^{\mathrm{%
off}})^{\frac{1}{2}})
C_{3}=\gamma(1-\gamma)^{-1}
\pi_{\alpha^{*}}
d^{\mathrm{off}}
\phi
\pi_{\alpha^{*}}(a|s,z)=\frac{d^{\mathrm{off}}(s,a)\cdot\mathbbm{1}[z=\phi(s,a%
)]}{\sum_{a^{\prime}\in A}d^{\mathrm{off}}(s,a^{\prime})\cdot\mathbbm{1}[z=%
\phi(s,a^{\prime})]},
\pi_{*,Z}
\pi_{*}
Z
\phi
\pi_{*,Z}(z|s):=\sum_{a\in A,z=\phi(s,a)}\pi_{*}(a|s).
J_{\mathrm{T}}
J_{\mathrm{DE}}
J_{\mathrm{BC},\phi}
\mathcal{D}^{\pi_{*}}
\mathcal{D}^{\mathrm{off}}
|Z|
|A|
J_{\mathrm{BC},\phi}
J_{\mathrm{BC}}
\chi^{2}
D_{\mathrm{\chi^{2}}}(d^{\pi_{*}}\|d^{\mathrm{off}})
C_{1}
C_{2}
d^{\pi_{*}}
d^{\mathrm{off}}
J_{\mathrm{T}}
J_{\mathrm{DE}}
J_{\mathrm{T}}\rightarrow 0
\pi_{\alpha},\phi\rightarrow\operatorname*{arg\,min}J_{\mathrm{DE}}
\pi_{Z}
\pi
|Z|<|A|
\phi_{opt}:=\mathcal{OPT}_{\phi}(\mathcal{D}^{\mathrm{off}})
(\phi_{opt})
(\phi_{opt})
\pi_{Z}
\mathcal{D}^{\pi_{*}}
n
\pi_{opt,Z}
\phi_{opt}
\pi_{*}
\phi_{opt}:=\mathcal{OPT}_{\phi}(\mathcal{D}^{\mathrm{off}})
\pi_{opt,Z}
\phi_{opt}
\mathbb{E}_{\mathcal{D}^{\pi_{*}}}[\mathrm{Diff}(\pi_{opt,Z},\pi_{*})]\leq(%
\ref{eq:tabular-rep})(\phi_{opt})+(\ref{eq:tabular-dec})(\phi_{opt})+C_{3}%
\cdot\sqrt{\frac{|Z||S|}{n}},
C_{3}
|Z|=|A|
(\phi_{opt})
(\phi_{opt})
|Z|<|A|
\pi_{*,Z}
\pi_{*,Z}
\pi_{Z}
\pi_{Z}
\pi_{*,Z}
Z\subset\mathbb{R}^{d}
\pi_{\theta}(s)=\theta_{s}
\theta\in\mathbb{R}^{d\times|S|}
\theta
\pi_{*}
\mathcal{T}_{Z}(s^{\prime}|s,\phi(s,a))=w(s^{\prime})^{\top}\phi(s,a)
\theta:S\to\mathbb{R}^{d}
\theta_{s}=\pi_{*,Z}(s),\,\forall s\in S
\pi_{*}
\pi_{\theta}
\pi_{*}
\phi:S\times A\to Z
Z\subset\mathbb{R}^{d}
w:S\to\mathbb{R}^{d}
\mathcal{T}_{Z}(s^{\prime}|s,\phi(s,a))=w(s^{\prime})^{\top}\phi(s,a)
s,s^{\prime}\in S,a\in A
\pi_{\alpha}:S\times Z\to\Delta(A)
\pi:S\to\Delta(A)
\mathcal{M}
\pi_{\theta}:S\to\mathbb{R}^{d}
\theta\in\mathbb{R}^{d\times|S|}
\mathrm{Diff}(\pi_{\alpha}\circ\pi_{\theta},\pi_{*})\leq(\ref{eq:tabular-rep})%
(\mathcal{T}_{Z},\phi)+(\ref{eq:tabular-dec})(\pi_{\alpha},\phi)
\displaystyle+C_{4}\cdot\left\|\frac{\partial}{\partial\theta}\mathbb{E}_{s%
\sim d^{\pi_{*}},a\sim\pi_{*}(s)}[(\theta_{s}-\phi(s,a))^{2}]\right\|_{1},
\displaystyle+C_{4}\cdot\left\|\frac{\partial}{\partial\theta}\mathbb{E}_{s%
\sim d^{\pi_{*}},a\sim\pi_{*}(s)}[(\theta_{s}-\phi(s,a))^{2}]\right\|_{1},
C_{4}=\frac{1}{4}|S|\|w\|_{\infty}
\pi_{\theta}
\pi_{*}
\pi_{*,Z}
\theta_{s}
\pi_{\theta}
\phi(s,a)
\mathcal{T}_{Z}
\phi
J_{\mathrm{T}}(\mathcal{T}_{Z},\phi)=\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}%
\left[D_{\mathrm{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]
\pi_{\alpha}
\phi
J_{\mathrm{DE}}(\pi_{\alpha},\phi):=\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}[-%
\log\pi_{\alpha}(a|s,\phi(s,a))]
\pi_{\alpha}
\mathcal{T}_{Z}
\mathcal{T}_{Z}
\mathcal{T}_{Z}(s^{\prime}|s,\phi(s,a))
\mathcal{T}_{Z}(s^{\prime}|s,\phi(s,a))\propto\rho(s^{\prime})\text{exp}(-\|%
\phi(s,a)-\psi(s^{\prime})\|^{2}),
\rho
S
\rho
s^{\prime}
d^{\mathrm{off}}
\mathcal{T}_{Z}
\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm{KL}}(\mathcal{T}(s,a)%
\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]
\mathbb{E}_{d^{\mathrm{off}}}[-\log\mathcal{T}_{Z}(s^{\prime}|s,\phi(s,a)))]=%
\mathrm{const}(d^{\mathrm{off}})+\frac{1}{2}\mathbb{E}_{d^{\mathrm{off}}}[||%
\phi(s,a)-\psi(s^{\prime})||^{2}]\\
+\log\mathbb{E}_{\tilde{s}^{\prime}\sim\rho}[\exp\{-\frac{1}{2}||\phi(s,a)-%
\psi(\tilde{s}^{\prime})||^{2}\}].
\pi_{Z}
J_{\mathrm{BC},\phi}(\pi_{Z})=\mathbb{E}_{(s,a)\sim(d^{\pi_{*}},\pi_{*})}[-%
\log\pi_{Z}(\phi(s,a)|s)]
\phi
z\sim\pi_{Z}(s)
a\sim\pi_{\alpha}(s,z)
f,g
\overline{\mathcal{T}}(s^{\prime}|s,a)\propto\rho(s^{\prime})\exp\{-||f(s,a)-g%
(s^{\prime})||^{2}/2\}
\phi
\psi
f
g
\bar{\phi}(s,a)=\cos(Wf(s,a)+b)
W
b
f
\overline{\mathcal{T}}(s^{\prime}|s,a)\propto\rho(s^{\prime})\exp\{-||f(s,a)-g%
(s^{\prime})||^{2}/2\}\propto\bar{\psi}(s^{\prime})^{\top}\bar{\phi}(s,a).
\pi_{\theta}
\bar{\phi}
\left\|\frac{\partial}{\partial\theta}\mathbb{E}_{s\sim d^{\pi_{*}},a\sim\pi_{%
*}(s)}[(\theta_{s}-\bar{\phi}(s,a))^{2}]\right\|_{1}
\bar{\phi}
z=\pi_{\theta}(s)
a\sim\pi_{\alpha}(s,z)
\%
4
\mathcal{D}^{\mathrm{off}}
\mathcal{D}^{\pi_{*}}
\%
4
\mathcal{D}^{\mathrm{off}}
\mathcal{D}^{\pi_{*}}
t=10
n=10
\phi(s,a)
\psi(s^{\prime})
\pi_{\alpha}
\pi_{Z}
t=10
t=10
t=1
t=10
t=1
t=10
4
\mathcal{D}^{\mathrm{off}}
\mathcal{D}^{\pi_{*}}
10
25
4
\mathcal{D}^{\mathrm{off}}
\mathcal{D}^{\pi_{*}}
10
25
1\%
2.5\%
f(s,a)
g(s^{\prime})
\phi(s,a)=\cos(Wf(s,a)+b)
W,b
\pi_{Z}
\pi_{\theta}
10
4
80\%
\frac{1}{10}
20\%
4
80\%
\frac{1}{10}
20\%
6
\frac{1}{10}
20\%
80\%
4
6
5\%
80\%
\pi_{1}
\pi_{2}
\mathcal{M}
d^{\pi_{1}}(s)
d^{\pi_{2}}(s)
\pi_{1}
\pi_{2}
d^{\pi}(s):=(1-\gamma)\sum_{t=0}\gamma^{t}\cdot\Pr\left[s_{t}=s|\pi,\mathcal{M%
}\right]
\mathrm{Diff}(\pi_{2},\pi_{1})=D_{\mathrm{TV}}(d^{\pi_{2}}\|d^{\pi_{1}})
\mathrm{Diff}(\pi_{2},\pi_{1})\leq\frac{\gamma}{1-\gamma}\mathrm{Err}_{d^{\pi_%
{1}}}(\pi_{1},\pi_{2},\mathcal{T}),
\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\mathcal{T}):=\frac{1}{2}\sum_{s^{%
\prime}\in S}\left|\mathbb{E}_{s\sim d^{\pi_{1}},a_{1}\sim\pi_{1}(s),a_{2}\sim%
\pi_{2}(s)}[\mathcal{T}(s^{\prime}|s,a_{1})-\mathcal{T}(s^{\prime}|s,a_{2})]%
\right|.
\mathcal{T}\circ\pi_{1}\circ d^{\pi_{1}}
\mathcal{T}\circ\pi_{2}\circ d^{\pi_{1}}
D_{\mathrm{TV}}(d^{\pi_{2}}\|d^{\pi_{1}})
\mathrm{Diff}(\pi_{2},\pi_{1})=D_{\mathrm{TV}}(d^{\pi_{2}}\|d^{\pi_{1}})=\frac%
{1}{2}\mathbf{1}|(1-\gamma)(I-\gamma\mathcal{T}\Pi_{2})^{-1}\mu-(1-\gamma)(I-%
\gamma\mathcal{T}\Pi_{1})^{-1}\mu|,
\Pi_{1},\Pi_{2}
S\to S\times A
\Pi_{i}\nu(s,a)=\pi_{i}(a|s)\nu(s)
\mathbf{1}
|S|
d^{\pi_{1}}
(1-\gamma)(I-\gamma\mathcal{T}\Pi_{1})^{-1}\mu
\displaystyle\frac{1}{2}\mathbf{1}|(1-\gamma)(I-\gamma\mathcal{T}\Pi_{2})^{-1}%
((I-\gamma\mathcal{T}\Pi_{1})-(I-\gamma\mathcal{T}\Pi_{2}))(I-\gamma\mathcal{T%
}\Pi_{1})^{-1}\mu|
\displaystyle\frac{1}{2}\mathbf{1}|(1-\gamma)(I-\gamma\mathcal{T}\Pi_{2})^{-1}%
((I-\gamma\mathcal{T}\Pi_{1})-(I-\gamma\mathcal{T}\Pi_{2}))(I-\gamma\mathcal{T%
}\Pi_{1})^{-1}\mu|
\displaystyle=\gamma\cdot\frac{1}{2}\mathbf{1}|(I-\gamma\mathcal{T}\Pi_{2})^{-%
1}(\mathcal{T}\Pi_{2}-\mathcal{T}\Pi_{1})d^{\pi_{1}}|.
\displaystyle=
\displaystyle\gamma\cdot\frac{1}{2}\mathbf{1}|(I-\gamma\mathcal{T}\Pi_{2})^{-1%
}(\mathcal{T}\Pi_{2}-\mathcal{T}\Pi_{1})d^{\pi_{1}}|.
\gamma\cdot\frac{1}{2}\|(I-\gamma\mathcal{T}\Pi_{2})^{-1}\|_{1,\infty}\cdot%
\mathbf{1}|(\mathcal{T}\Pi_{2}-\mathcal{T}\Pi_{1})d^{\pi_{1}}|.
\mathcal{T}\Pi_{2}
\|(I-\gamma\mathcal{T}\Pi_{2})^{-1}\|_{1,\infty}\leq\sum_{t=0}^{\infty}\gamma^%
{t}\|\mathcal{T}\Pi_{2}\|_{1,\infty}=(1-\gamma)^{-1}
\frac{\gamma}{2(1-\gamma)}\mathbf{1}|(\mathcal{T}\Pi_{2}-\mathcal{T}\Pi_{1})d^%
{\pi_{1}}|=\frac{\gamma}{1-\gamma}\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},%
\mathcal{T}),
\mathcal{T}
\overline{\mathcal{T}}
\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\mathcal{T})
\pi_{1}
\pi_{2}
\mathcal{M}
\overline{\mathcal{T}}(\cdot|s,a)
\displaystyle\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\mathcal{T})\leq|A|%
\mathbb{E}_{(s,a)\sim(d^{\pi_{1}},\mathrm{Unif}_{A})}[D_{\mathrm{TV}}(\mathcal%
{T}(s,a)\|\overline{\mathcal{T}}(s,a))]+\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi%
_{2},\overline{\mathcal{T}}).
\displaystyle\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\mathcal{T})
\displaystyle\leq|A|\mathbb{E}_{(s,a)\sim(d^{\pi_{1}},\mathrm{Unif}_{A})}[D_{%
\mathrm{TV}}(\mathcal{T}(s,a)\|\overline{\mathcal{T}}(s,a))]+\mathrm{Err}_{d^{%
\pi_{1}}}(\pi_{1},\pi_{2},\overline{\mathcal{T}}).
\displaystyle\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\mathcal{T})=\frac{1}{%
2}\sum_{s^{\prime}\in S}\left|\mathbb{E}_{s\sim d^{\pi_{1}},a_{1}\sim\pi_{1}(s%
),a_{2}\sim\pi_{2}(s)}[\mathcal{T}(s^{\prime}|s,a_{1})-\mathcal{T}(s^{\prime}|%
s,a_{2})]\right|
\displaystyle\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\mathcal{T})
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\mathbb{E}_{s\sim d^{\pi_%
{1}},a_{1}\sim\pi_{1}(s),a_{2}\sim\pi_{2}(s)}[\mathcal{T}(s^{\prime}|s,a_{1})-%
\mathcal{T}(s^{\prime}|s,a_{2})]\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{a\in A}\mathbb{E}_{%
s\sim d^{\pi_{1}}}[\mathcal{T}(s^{\prime}|s,a)\pi_{1}(a|s)-\mathcal{T}(s,a)\pi%
_{2}(a|s)]\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{a\in A}\mathbb{E}_{%
s\sim d^{\pi_{1}}}[\mathcal{T}(s^{\prime}|s,a)\pi_{1}(a|s)-\mathcal{T}(s,a)\pi%
_{2}(a|s)]\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{a\in A}\mathbb{E}_{%
s\sim d^{\pi_{1}}}[(\mathcal{T}(s^{\prime}|s,a)-\overline{\mathcal{T}}(s^{%
\prime}|s,a))(\pi_{1}(a|s)-\pi_{2}(a|s))+\overline{\mathcal{T}}(s^{\prime}|s,a%
)(\pi_{1}(a|s)-\pi_{2}(a|s))]\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{a\in A}\mathbb{E}_{%
s\sim d^{\pi_{1}}}[(\mathcal{T}(s^{\prime}|s,a)-\overline{\mathcal{T}}(s^{%
\prime}|s,a))(\pi_{1}(a|s)-\pi_{2}(a|s))+\overline{\mathcal{T}}(s^{\prime}|s,a%
)(\pi_{1}(a|s)-\pi_{2}(a|s))]\right|
\displaystyle\leq\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{a\in A}\mathbb{E%
}_{s\sim d^{\pi_{1}}}[(\mathcal{T}(s^{\prime}|s,a)-\overline{\mathcal{T}}(s^{%
\prime}|s,a))(\pi_{1}(a|s)-\pi_{2}(a|s))]\right|+\mathrm{Err}_{d^{\pi_{1}}}(%
\pi_{1},\pi_{2},\overline{\mathcal{T}})
\displaystyle\leq\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{a\in A}\mathbb{E%
}_{s\sim d^{\pi_{1}}}[(\mathcal{T}(s^{\prime}|s,a)-\overline{\mathcal{T}}(s^{%
\prime}|s,a))(\pi_{1}(a|s)-\pi_{2}(a|s))]\right|+\mathrm{Err}_{d^{\pi_{1}}}(%
\pi_{1},\pi_{2},\overline{\mathcal{T}})
\displaystyle\leq\frac{1}{2}\sum_{s^{\prime}\in S}\sum_{a\in A}\mathbb{E}_{s%
\sim d^{\pi_{1}}}[\left|(\mathcal{T}(s^{\prime}|s,a)-\overline{\mathcal{T}}(s^%
{\prime}|s,a))(\pi_{1}(a|s)-\pi_{2}(a|s))\right|]+\mathrm{Err}_{d^{\pi_{1}}}(%
\pi_{1},\pi_{2},\overline{\mathcal{T}})
\displaystyle\leq\frac{1}{2}\sum_{s^{\prime}\in S}\sum_{a\in A}\mathbb{E}_{s%
\sim d^{\pi_{1}}}[\left|(\mathcal{T}(s^{\prime}|s,a)-\overline{\mathcal{T}}(s^%
{\prime}|s,a))(\pi_{1}(a|s)-\pi_{2}(a|s))\right|]+\mathrm{Err}_{d^{\pi_{1}}}(%
\pi_{1},\pi_{2},\overline{\mathcal{T}})
\displaystyle\leq|A|\mathbb{E}_{(s,a)\sim(d^{\pi_{1}},\mathrm{Unif}_{A})}[D_{%
\mathrm{TV}}(\mathcal{T}(s^{\prime}|s,a)\|\overline{\mathcal{T}}(s^{\prime}|s,%
a)|]+\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\overline{\mathcal{T}}),
\displaystyle\leq|A|\mathbb{E}_{(s,a)\sim(d^{\pi_{1}},\mathrm{Unif}_{A})}[D_{%
\mathrm{TV}}(\mathcal{T}(s^{\prime}|s,a)\|\overline{\mathcal{T}}(s^{\prime}|s,%
a)|]+\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\overline{\mathcal{T}}),
D_{\mathrm{TV}}(\mathcal{T}(s,a)\|\overline{\mathcal{T}}(s,a))=\frac{1}{2}\sum%
_{s^{\prime}\in S}|\mathcal{T}(s^{\prime}|s,a)-\overline{\mathcal{T}}(s^{%
\prime}|s,a)|
\phi:S\times A\to Z
\overline{\mathcal{T}}(s,a)=\mathcal{T}_{Z}(s,\phi(s,a))
\phi:S\times A\to Z
Z
\mathcal{T}_{Z}:S\times Z\to\Delta(S)
\overline{\mathcal{T}}(s,a)=\mathcal{T}_{Z}(s,\phi(s,a))
s\in S,a\in A
\pi_{1},\pi_{2}
\displaystyle\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\overline{\mathcal{T}}%
)]\leq\mathbb{E}_{s\sim d^{\pi_{1}}}[D_{\mathrm{TV}}(\pi_{1,Z}\|\pi_{2,Z})],
\displaystyle\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\overline{\mathcal{T}})]
\displaystyle\leq\mathbb{E}_{s\sim d^{\pi_{1}}}[D_{\mathrm{TV}}(\pi_{1,Z}\|\pi%
_{2,Z})],
\pi_{k,Z}(z|s)
\pi_{k}
Z
\displaystyle\pi_{k,Z}(z|s):=\sum_{a\in A,z=\phi(s,a)}\pi_{k}(a|s)
\displaystyle\pi_{k,Z}(z|s)
\displaystyle:=\sum_{a\in A,z=\phi(s,a)}\pi_{k}(a|s)
z\in Z,k\in\{1,2\}
\displaystyle\frac{1}{2}\sum_{s^{\prime}\in S}\left|\mathbb{E}_{s\sim d^{\pi_{%
1}},a_{1}\sim\pi_{1}(s),a_{2}\sim\pi_{2}(s)}[\overline{\mathcal{T}}(s^{\prime}%
|s,a_{1})-\overline{\mathcal{T}}(s^{\prime}|s,a_{2})]\right|
\displaystyle\frac{1}{2}\sum_{s^{\prime}\in S}\left|\mathbb{E}_{s\sim d^{\pi_{%
1}},a_{1}\sim\pi_{1}(s),a_{2}\sim\pi_{2}(s)}[\overline{\mathcal{T}}(s^{\prime}%
|s,a_{1})-\overline{\mathcal{T}}(s^{\prime}|s,a_{2})]\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{s\in S,a\in A}%
\mathcal{T}_{Z}(s^{\prime}|s,\phi(s,a))\pi_{1}(a|s)d^{\pi_{1}}(s)-\sum_{s\in S%
,a\in A}\mathcal{T}_{Z}(s^{\prime}|s,\phi(s,a))\pi_{2}(a|s)d^{\pi_{1}}(s)\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{s\in S,a\in A}%
\mathcal{T}_{Z}(s^{\prime}|s,\phi(s,a))\pi_{1}(a|s)d^{\pi_{1}}(s)-\sum_{s\in S%
,a\in A}\mathcal{T}_{Z}(s^{\prime}|s,\phi(s,a))\pi_{2}(a|s)d^{\pi_{1}}(s)\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{s\in S,z\in Z}%
\mathcal{T}_{Z}(s^{\prime}|s,z)\!\!\!\sum_{\begin{subarray}{c}a\in A,\\
\phi(s,a)=z\end{subarray}}\pi_{1}(a|s)d^{\pi_{1}}(s)-\sum_{s\in S,z\in Z}%
\mathcal{T}_{Z}(s^{\prime}|s,z)\sum_{\begin{subarray}{c}a\in A,\\
\phi(s,a)=z\end{subarray}}\pi_{2}(a|s)d^{\pi_{1}}(s)\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{s\in S,z\in Z}%
\mathcal{T}_{Z}(s^{\prime}|s,z)\!\!\!\sum_{\begin{subarray}{c}a\in A,\\
\phi(s,a)=z\end{subarray}}\pi_{1}(a|s)d^{\pi_{1}}(s)-\sum_{s\in S,z\in Z}%
\mathcal{T}_{Z}(s^{\prime}|s,z)\sum_{\begin{subarray}{c}a\in A,\\
\phi(s,a)=z\end{subarray}}\pi_{2}(a|s)d^{\pi_{1}}(s)\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{s\in S,z\in Z}%
\mathcal{T}_{Z}(s^{\prime}|s,z)\pi_{1,Z}(z|s)d^{\pi_{1}}(s)-\sum_{s\in S,z\in Z%
}\mathcal{T}_{Z}(s^{\prime}|s,z)\pi_{2,Z}(z|s)d^{\pi_{1}}(s)\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\sum_{s\in S,z\in Z}%
\mathcal{T}_{Z}(s^{\prime}|s,z)\pi_{1,Z}(z|s)d^{\pi_{1}}(s)-\sum_{s\in S,z\in Z%
}\mathcal{T}_{Z}(s^{\prime}|s,z)\pi_{2,Z}(z|s)d^{\pi_{1}}(s)\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\mathbb{E}_{s\sim d^{\pi_%
{1}}}\left[\sum_{z\in Z}\mathcal{T}_{Z}(s^{\prime}|s,z)(\pi_{1,Z}(z|s)-\pi_{2,%
Z}(z|s))\right]\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\mathbb{E}_{s\sim d^{\pi_%
{1}}}\left[\sum_{z\in Z}\mathcal{T}_{Z}(s^{\prime}|s,z)(\pi_{1,Z}(z|s)-\pi_{2,%
Z}(z|s))\right]\right|
\displaystyle\leq\frac{1}{2}\mathbb{E}_{s\sim d^{\pi_{1}}}\left[\sum_{z\in Z}%
\sum_{s^{\prime}\in S}\mathcal{T}_{Z}(s^{\prime}|s,z)\left|\pi_{1,Z}(z|s)-\pi_%
{2,Z}(z|s)\right|\right]
\displaystyle\leq\frac{1}{2}\mathbb{E}_{s\sim d^{\pi_{1}}}\left[\sum_{z\in Z}%
\sum_{s^{\prime}\in S}\mathcal{T}_{Z}(s^{\prime}|s,z)\left|\pi_{1,Z}(z|s)-\pi_%
{2,Z}(z|s)\right|\right]
\displaystyle=\frac{1}{2}\mathbb{E}_{s\sim d^{\pi_{1}}}\left[\sum_{z\in Z}%
\left|\pi_{1,Z}(z|s)-\pi_{2,Z}(z|s)\right|\right]
\displaystyle=\frac{1}{2}\mathbb{E}_{s\sim d^{\pi_{1}}}\left[\sum_{z\in Z}%
\left|\pi_{1,Z}(z|s)-\pi_{2,Z}(z|s)\right|\right]
\displaystyle=\mathbb{E}_{s\sim d^{\pi_{1}}}\left[D_{\mathrm{TV}}(\pi_{1,Z}\|%
\pi_{2,Z})\right],
\displaystyle=\mathbb{E}_{s\sim d^{\pi_{1}}}\left[D_{\mathrm{TV}}(\pi_{1,Z}\|%
\pi_{2,Z})\right],
d\in\Delta(S,A)
\phi:S\times A\to Z
\pi_{Z}:S\to\Delta(Z)
\pi_{\alpha^{*}}
d,\phi
\pi_{\alpha^{*}}(a|s,z)=\frac{d(s,a)\cdot\mathbbm{1}[z=\phi(s,a)]}{\sum_{a^{%
\prime}\in A}d(s,a^{\prime})\cdot\mathbbm{1}[z=\phi(s,a^{\prime})]},
\pi_{\alpha^{*},Z}
\pi_{\alpha^{*}}\circ\pi_{Z}
Z
\pi_{\alpha^{*},Z}(z|s):=\sum_{a\in A,z=\phi(s,a)}(\pi_{\alpha^{*}}\circ\pi_{Z%
})(a|s)=\sum_{a\in A,z=\phi(s,a)}\sum_{\tilde{z}\in Z}\pi_{\alpha^{*}}(a|s,%
\tilde{z})\pi_{Z}(\tilde{z}|s).
\pi_{\alpha^{*},Z}(z|s)=\pi_{Z}(z|s)
z\in Z
s\in S
\displaystyle\pi_{\alpha^{*},Z}(z|s)=\sum_{a\in A,z=\phi(s,a)}\sum_{\tilde{z}%
\in Z}\pi_{\alpha^{*}}(a|s,\tilde{z})\pi_{Z}(\tilde{z}|s)
\displaystyle\pi_{\alpha^{*},Z}(z|s)
\displaystyle=\sum_{a\in A,z=\phi(s,a)}\sum_{\tilde{z}\in Z}\pi_{\alpha^{*}}(a%
|s,\tilde{z})\pi_{Z}(\tilde{z}|s)
\displaystyle=\sum_{a\in A,z=\phi(s,a)}\sum_{\tilde{z}\in Z}\frac{d(s,a)\cdot%
\mathbbm{1}[\tilde{z}=\phi(s,a)]}{\sum_{a^{\prime}\in A}d(s,a^{\prime})\cdot%
\mathbbm{1}[\tilde{z}=\phi(s,a^{\prime})]}\pi_{Z}(\tilde{z}|s)
\displaystyle=\sum_{a\in A,z=\phi(s,a)}\sum_{\tilde{z}\in Z}\frac{d(s,a)\cdot%
\mathbbm{1}[\tilde{z}=\phi(s,a)]}{\sum_{a^{\prime}\in A}d(s,a^{\prime})\cdot%
\mathbbm{1}[\tilde{z}=\phi(s,a^{\prime})]}\pi_{Z}(\tilde{z}|s)
\displaystyle=\sum_{a\in A,z=\phi(s,a)}\frac{d(s,a)\cdot\mathbbm{1}[z=\phi(s,a%
)]}{\sum_{a^{\prime}\in A}d(s,a^{\prime})\cdot\mathbbm{1}[z=\phi(s,a^{\prime})%
]}\pi_{Z}(z|s)
\displaystyle=\sum_{a\in A,z=\phi(s,a)}\frac{d(s,a)\cdot\mathbbm{1}[z=\phi(s,a%
)]}{\sum_{a^{\prime}\in A}d(s,a^{\prime})\cdot\mathbbm{1}[z=\phi(s,a^{\prime})%
]}\pi_{Z}(z|s)
\displaystyle=\pi_{Z}(z|s)\sum_{a\in A,z=\phi(s,a)}\frac{d(s,a)\cdot\mathbbm{1%
}[z=\phi(s,a)]}{\sum_{a^{\prime}\in A}d(s,a^{\prime})\cdot\mathbbm{1}[z=\phi(s%
,a^{\prime})]}
\displaystyle=\pi_{Z}(z|s)\sum_{a\in A,z=\phi(s,a)}\frac{d(s,a)\cdot\mathbbm{1%
}[z=\phi(s,a)]}{\sum_{a^{\prime}\in A}d(s,a^{\prime})\cdot\mathbbm{1}[z=\phi(s%
,a^{\prime})]}
\displaystyle=\pi_{Z}(z|s),
\displaystyle=\pi_{Z}(z|s),
\pi_{Z}:S\to\Delta(Z)
Z
\pi_{\alpha}:S\times Z\to A
\pi_{\alpha,Z}
\pi_{\alpha}\circ\pi_{Z}
Z
\pi_{\alpha,Z}(z|s):=\sum_{a\in A,z=\phi(s,a)}(\pi_{\alpha}\circ\pi_{Z})(a|s)=%
\sum_{a\in A,z=\phi(s,a)}\sum_{\tilde{z}\in Z}\pi_{\alpha}(a|s,\tilde{z})\pi_{%
Z}(\tilde{z}|s).
s\in S
\displaystyle D_{\mathrm{TV}}(\pi_{Z}(s)\|\pi_{\alpha,Z}(s))\leq\max_{z\in Z}D%
_{\mathrm{TV}}(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z)),
\displaystyle D_{\mathrm{TV}}(\pi_{Z}(s)\|\pi_{\alpha,Z}(s))\leq\max_{z\in Z}D%
_{\mathrm{TV}}(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z)),
\pi_{\alpha^{*}}
d
\displaystyle D_{\mathrm{TV}}(\pi_{Z}(s)\|\pi_{\alpha,Z}(s))
\displaystyle D_{\mathrm{TV}}(\pi_{Z}(s)\|\pi_{\alpha,Z}(s))
\displaystyle=\frac{1}{2}\sum_{z\in Z}\left|\pi_{Z}(z|s)-\pi_{\alpha,Z}(z|s)\right|
\displaystyle=
\displaystyle\frac{1}{2}\sum_{z\in Z}\left|\pi_{Z}(z|s)-\pi_{\alpha,Z}(z|s)\right|
\displaystyle=\frac{1}{2}\sum_{z\in Z}\left|\pi_{Z}(z|s)-\sum_{a\in A,z=\phi(s%
,a)}\sum_{\tilde{z}\in Z}\pi_{\alpha}(a|s,\tilde{z})\pi_{Z}(\tilde{z}|s)\right|
\displaystyle=
\displaystyle\frac{1}{2}\sum_{z\in Z}\left|\pi_{Z}(z|s)-\sum_{a\in A,z=\phi(s,%
a)}\sum_{\tilde{z}\in Z}\pi_{\alpha}(a|s,\tilde{z})\pi_{Z}(\tilde{z}|s)\right|
\displaystyle=\frac{1}{2}\sum_{z\in Z}\left|\pi_{Z}(z|s)-\sum_{a\in A,z=\phi(s%
,a)}\sum_{\tilde{z}\in Z}\left(\pi_{\alpha}(a|s,\tilde{z})-\pi_{\alpha^{*}}(a|%
s,\tilde{z})+\pi_{\alpha^{*}}(a|s,\tilde{z})\right)\pi_{Z}(\tilde{z}|s)\right|
\displaystyle=
\displaystyle\frac{1}{2}\sum_{z\in Z}\left|\pi_{Z}(z|s)-\sum_{a\in A,z=\phi(s,%
a)}\sum_{\tilde{z}\in Z}\left(\pi_{\alpha}(a|s,\tilde{z})-\pi_{\alpha^{*}}(a|s%
,\tilde{z})+\pi_{\alpha^{*}}(a|s,\tilde{z})\right)\pi_{Z}(\tilde{z}|s)\right|
\displaystyle=\frac{1}{2}\sum_{z\in Z}\left|\sum_{a\in A,z=\phi(s,a)}\sum_{%
\tilde{z}\in Z}\left(\pi_{\alpha}(a|s,\tilde{z})-\pi_{\alpha^{*}}(a|s,\tilde{z%
})\right)\pi_{Z}(\tilde{z}|s)\right|~{}~{}~{}~{}~{}~{}~{}~{}~{}~{}~{}~{}~{}%
\text{(by Lemma~{}\ref{lem:marginal-opt})}
\displaystyle=
\displaystyle\frac{1}{2}\sum_{z\in Z}\left|\sum_{a\in A,z=\phi(s,a)}\sum_{%
\tilde{z}\in Z}\left(\pi_{\alpha}(a|s,\tilde{z})-\pi_{\alpha^{*}}(a|s,\tilde{z%
})\right)\pi_{Z}(\tilde{z}|s)\right|~{}~{}~{}~{}~{}~{}~{}~{}~{}~{}~{}~{}~{}%
\text{(by Lemma~{}\ref{lem:marginal-opt})}
\displaystyle\leq\frac{1}{2}\mathbb{E}_{\tilde{z}\sim\pi_{Z}(s)}\left[\sum_{z%
\in Z}\sum_{a\in A,z=\phi(s,a)}\left|\pi_{\alpha}(a|s,\tilde{z})-\pi_{\alpha^{%
*}}(a|s,\tilde{z})\right|\right]
\displaystyle\leq
\displaystyle\frac{1}{2}\mathbb{E}_{\tilde{z}\sim\pi_{Z}(s)}\left[\sum_{z\in Z%
}\sum_{a\in A,z=\phi(s,a)}\left|\pi_{\alpha}(a|s,\tilde{z})-\pi_{\alpha^{*}}(a%
|s,\tilde{z})\right|\right]
\displaystyle=\frac{1}{2}\mathbb{E}_{\tilde{z}\sim\pi_{Z}(s)}\left[\sum_{a\in A%
}\left|\pi_{\alpha}(a|s,\tilde{z})-\pi_{\alpha^{*}}(a|s,\tilde{z})\right|\right]
\displaystyle=
\displaystyle\frac{1}{2}\mathbb{E}_{\tilde{z}\sim\pi_{Z}(s)}\left[\sum_{a\in A%
}\left|\pi_{\alpha}(a|s,\tilde{z})-\pi_{\alpha^{*}}(a|s,\tilde{z})\right|\right]
\displaystyle=\mathbb{E}_{\tilde{z}\sim\pi_{Z}(s)}\left[D_{\mathrm{TV}}(\pi_{%
\alpha}(s,\tilde{z})\|,\pi_{\alpha^{*}}(s,\tilde{z}))\right]
\displaystyle=
\displaystyle\mathbb{E}_{\tilde{z}\sim\pi_{Z}(s)}\left[D_{\mathrm{TV}}(\pi_{%
\alpha}(s,\tilde{z})\|,\pi_{\alpha^{*}}(s,\tilde{z}))\right]
\displaystyle\leq\max_{z\in Z}D_{\mathrm{TV}}(\pi_{\alpha}(s,z)\|\pi_{\alpha^{%
*}}(s,z)),
\displaystyle\leq
\displaystyle\max_{z\in Z}D_{\mathrm{TV}}(\pi_{\alpha}(s,z)\|\pi_{\alpha^{*}}(%
s,z)),
\pi_{1,Z}
\pi_{1}
Z
\pi_{Z}
\pi_{\alpha}
\pi_{\alpha,Z}
\pi_{\alpha^{*},Z}
s\in S
D_{\mathrm{TV}}(\pi_{1,Z}(s)\|\pi_{\alpha,Z}(s))\leq\max_{z\in Z}D_{\mathrm{TV%
}}(\pi_{\alpha}(s,z)\|\pi_{\alpha^{*}}(s,z))+D_{\mathrm{TV}}(\pi_{1,Z}(s)\|\pi%
_{Z}(s)).
D_{\mathrm{TV}}(\pi_{1,Z}(s)\|\pi_{\alpha,Z}(s))\leq D_{\mathrm{TV}}(\pi_{Z}(s%
)\|\pi_{\alpha,Z}(s))+D_{\mathrm{TV}}(\pi_{1,Z}(s)\|\pi_{Z}(s)).
\rho_{1},\rho_{2}\in\Delta(S)
\rho_{1}(s)>0\Rightarrow\rho_{2}(s)>0
\mathbb{E}_{\rho_{1}}[h(s)]\leq(1+D_{\mathrm{\chi^{2}}}(\rho_{1}\|\rho_{2})^{%
\frac{1}{2}})\sqrt{\mathbb{E}_{\rho_{2}}[h(s)^{2}]}.
\displaystyle\mathbb{E}_{\rho_{1}}[h(s)]=\mathbb{E}_{\rho_{2}}[h(s)]+(\mathbb{%
E}_{\rho_{1}}[h(s)]-\mathbb{E}_{\rho_{2}}[h(s)])
\displaystyle\mathbb{E}_{\rho_{1}}[h(s)]
\displaystyle=\mathbb{E}_{\rho_{2}}[h(s)]+(\mathbb{E}_{\rho_{1}}[h(s)]-\mathbb%
{E}_{\rho_{2}}[h(s)])
\displaystyle=\mathbb{E}_{\rho_{2}}[h(s)]+\sum_{s\in S}\frac{\rho_{1}(s)-\rho_%
{2}(s)}{\rho_{2}(s)^{\frac{1}{2}}}\cdot\rho_{2}(s)^{\frac{1}{2}}h(s)
\displaystyle=\mathbb{E}_{\rho_{2}}[h(s)]+\sum_{s\in S}\frac{\rho_{1}(s)-\rho_%
{2}(s)}{\rho_{2}(s)^{\frac{1}{2}}}\cdot\rho_{2}(s)^{\frac{1}{2}}h(s)
\displaystyle\leq\mathbb{E}_{\rho_{2}}[h(s)]+\left(\sum_{s\in S}\frac{(\rho_{1%
}(s)-\rho_{2}(s))^{2}}{\rho_{2}(s)}\right)^{\frac{1}{2}}\cdot\left(\sum_{s\in S%
}\rho_{2}(s)h(s)^{2}\right)^{\frac{1}{2}}
\displaystyle\leq\mathbb{E}_{\rho_{2}}[h(s)]+\left(\sum_{s\in S}\frac{(\rho_{1%
}(s)-\rho_{2}(s))^{2}}{\rho_{2}(s)}\right)^{\frac{1}{2}}\cdot\left(\sum_{s\in S%
}\rho_{2}(s)h(s)^{2}\right)^{\frac{1}{2}}
\displaystyle=\mathbb{E}_{\rho_{2}}[h(s)]+D_{\mathrm{\chi^{2}}}(\rho_{1}\|\rho%
_{2})^{\frac{1}{2}}\cdot\sqrt{\mathbb{E}_{\rho_{2}}[h(s)^{2}]}.
\displaystyle=\mathbb{E}_{\rho_{2}}[h(s)]+D_{\mathrm{\chi^{2}}}(\rho_{1}\|\rho%
_{2})^{\frac{1}{2}}\cdot\sqrt{\mathbb{E}_{\rho_{2}}[h(s)^{2}]}.
\mathbb{E}_{\rho_{2}}[h(s)]\leq\mathbb{E}_{\rho_{2}}[\sqrt{h(s)^{2}}]\leq\sqrt%
{\mathbb{E}_{\rho_{2}}[h(s)^{2}]}
\pi_{2}:=\pi_{\alpha}\circ\pi_{Z}
\pi_{2,Z}(z|s)
\pi_{\alpha,Z}(z|s)=\sum_{a\in A,\phi(s,a)=z}(\pi_{\alpha}\circ\pi_{Z})(z|s)
\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\overline{\mathcal{T}})]\leq\mathbb%
{E}_{s\sim d^{\pi_{1}}}\left[\max_{z\in Z}D_{\mathrm{TV}}(\pi_{\alpha^{*}}(s,z%
)\|\pi_{\alpha}(s,z))+D_{\mathrm{TV}}(\pi_{1,Z}(s)\|\pi_{Z}(s))\right].
\displaystyle\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\mathcal{T})\leq|A|%
\mathbb{E}_{(s,a)\sim(d^{\pi_{1}},\mathrm{Unif}_{A})}[D_{\mathrm{TV}}(\mathcal%
{T}(s,a)\|\overline{\mathcal{T}}(s,a))]
\displaystyle\mathrm{Err}_{d^{\pi_{1}}}(\pi_{1},\pi_{2},\mathcal{T})
\displaystyle\leq|A|\mathbb{E}_{(s,a)\sim(d^{\pi_{1}},\mathrm{Unif}_{A})}[D_{%
\mathrm{TV}}(\mathcal{T}(s,a)\|\overline{\mathcal{T}}(s,a))]
\displaystyle+\mathbb{E}_{s\sim d^{\pi_{1}}}\left[\max_{z\in Z}D_{\mathrm{TV}}%
(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))\right]
\displaystyle+\mathbb{E}_{s\sim d^{\pi_{1}}}\left[\max_{z\in Z}D_{\mathrm{TV}}%
(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))\right]
\displaystyle+\mathbb{E}_{s\sim d^{\pi_{1}}}\left[D_{\mathrm{TV}}(\pi_{1,Z}(s)%
\|\pi_{Z}(s))\right].
\displaystyle+\mathbb{E}_{s\sim d^{\pi_{1}}}\left[D_{\mathrm{TV}}(\pi_{1,Z}(s)%
\|\pi_{Z}(s))\right].
\pi_{1}=\pi_{*}
\displaystyle\mathrm{Diff}(\pi_{\alpha}\circ\pi_{Z},\pi_{*})\leq\frac{\gamma|A%
|}{1-\gamma}\cdot\mathbb{E}_{(s,a)\sim(d^{\pi_{1}},\mathrm{Unif}_{A})}[D_{%
\mathrm{TV}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a))]
\displaystyle\mathrm{Diff}(\pi_{\alpha}\circ\pi_{Z},\pi_{*})
\displaystyle\leq\frac{\gamma|A|}{1-\gamma}\cdot\mathbb{E}_{(s,a)\sim(d^{\pi_{%
1}},\mathrm{Unif}_{A})}[D_{\mathrm{TV}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,%
\phi(s,a))]
\displaystyle+\frac{\gamma}{1-\gamma}\cdot\mathbb{E}_{s\sim d^{\pi_{*}}}[\max_%
{z\in Z}D_{\mathrm{TV}}(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]
\displaystyle+\frac{\gamma}{1-\gamma}\cdot\mathbb{E}_{s\sim d^{\pi_{*}}}[\max_%
{z\in Z}D_{\mathrm{TV}}(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]
\displaystyle+\frac{\gamma}{1-\gamma}\cdot\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{%
\mathrm{TV}}(\pi_{*,Z}(s)\|\pi_{Z}(s))].
\displaystyle+\frac{\gamma}{1-\gamma}\cdot\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{%
\mathrm{TV}}(\pi_{*,Z}(s)\|\pi_{Z}(s))].
D_{\mathrm{TV}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))^{2}\leq\frac{1%
}{2}D_{\mathrm{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))
\displaystyle\mathrm{Diff}(\pi_{\alpha}\circ\pi_{Z},\pi_{*})\leq C_{1}\cdot%
\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}\mathbb{E}_{(s,a)\sim d^{%
\mathrm{off}}}\left[D_{\mathrm{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s%
,a)))\right]}\kern-101.71417pt}}\hphantom{\sqrt{\vphantom{\displaystyle\frac{1%
}{2}\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm{KL}}(\mathcal{T}(s%
,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}}}\frac{1}{2}\underbrace{\mathbb{E}_%
{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm{KL}}(\mathcal{T}(s,a)\|\mathcal{T%
}_{Z}(s,\phi(s,a)))\right]}_{\displaystyle=J_{\mathrm{T}}(\mathcal{T}_{Z},\phi)}
\displaystyle\mathrm{Diff}(\pi_{\alpha}\circ\pi_{Z},\pi_{*})
\displaystyle\leq C_{1}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm{KL}}(\mathcal{T}(s,a)%
\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}\kern-101.71417pt}}\hphantom{\sqrt{%
\vphantom{\displaystyle\frac{1}{2}\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left%
[D_{\mathrm{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}}}%
\frac{1}{2}\underbrace{\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}\left[D_{\mathrm%
{KL}}(\mathcal{T}(s,a)\|\mathcal{T}_{Z}(s,\phi(s,a)))\right]}_{\displaystyle=J%
_{\mathrm{T}}(\mathcal{T}_{Z},\phi)}
\displaystyle+C_{2}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{\mathrm{KL}}(\pi_{\alpha^{%
*}}(s,z)\|\pi_{\alpha}(s,z))]}\kern-46.82202pt}}\hphantom{\sqrt{\vphantom{%
\displaystyle\frac{1}{2}\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{%
\mathrm{KL}}(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]}}}\frac{1}{2}%
\underbrace{\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{\mathrm{KL}}(%
\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]}_{\displaystyle\approx~{}\mathrm{%
const}(d^{\mathrm{off}},\phi)+J_{\mathrm{DE}}(\pi_{\alpha},\phi)}
\displaystyle+C_{2}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{\mathrm{KL}}(\pi_{\alpha^{%
*}}(s,z)\|\pi_{\alpha}(s,z))]}\kern-46.82202pt}}\hphantom{\sqrt{\vphantom{%
\displaystyle\frac{1}{2}\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{%
\mathrm{KL}}(\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]}}}\frac{1}{2}%
\underbrace{\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{\mathrm{KL}}(%
\pi_{\alpha^{*}}(s,z)\|\pi_{\alpha}(s,z))]}_{\displaystyle\approx~{}\mathrm{%
const}(d^{\mathrm{off}},\phi)+J_{\mathrm{DE}}(\pi_{\alpha},\phi)}
\displaystyle+C_{3}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{Z}(s))]}%
\kern-8.21957pt}}\hphantom{\sqrt{\vphantom{\displaystyle\frac{1}{2}\mathbb{E}_%
{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{Z}(s))]}}}\frac{1}{2}%
\underbrace{\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{%
Z}(s))]}_{\displaystyle=~{}\mathrm{const}(\pi_{*},\phi)+J_{\mathrm{BC},\phi}(%
\pi_{Z})},
\displaystyle+C_{3}\cdot\mathrlap{\sqrt{\phantom{\displaystyle\frac{1}{2}%
\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{Z}(s))]}%
\kern-8.21957pt}}\hphantom{\sqrt{\vphantom{\displaystyle\frac{1}{2}\mathbb{E}_%
{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{Z}(s))]}}}\frac{1}{2}%
\underbrace{\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{\mathrm{KL}}(\pi_{*,Z}(s)\|\pi_{%
Z}(s))]}_{\displaystyle=~{}\mathrm{const}(\pi_{*},\phi)+J_{\mathrm{BC},\phi}(%
\pi_{Z})},
C_{1}=\gamma|A|(1-\gamma)^{-1}(1+D_{\mathrm{\chi^{2}}}(d^{\pi_{*}}\|d^{\mathrm%
{off}})^{\frac{1}{2}})
C_{2}=\gamma(1-\gamma)^{-1}(1+D_{\mathrm{\chi^{2}}}(d^{\pi_{*}}\|d^{\mathrm{%
off}})^{\frac{1}{2}})
C_{3}=\gamma(1-\gamma)^{-1}
\max_{z\in Z}
\mathbb{E}_{s\sim d^{\mathrm{off}}}[\max_{z\in Z}D_{\mathrm{KL}}(\pi_{\alpha^{%
*}}(s,z)\|\pi_{\alpha}(s,z))]
\mathbb{E}_{(s,a)\sim d^{\mathrm{off}}}[D_{\mathrm{KL}}(\pi_{\alpha^{*}}(s,%
\phi(s,a))\|\pi_{\alpha}(s,\phi(s,a)))]
J_{\mathrm{DE}}(\pi_{\alpha},\phi)
\rho\in\Delta(\{1,\dots,k\})
\hat{\rho}_{n}
\rho
n
X\sim\rho
\mathbb{E}_{n}[D_{\mathrm{TV}}(\rho\|\hat{\rho}_{n})]\leq\frac{1}{2}\cdot\frac%
{1}{\sqrt{n}}\sum_{i=1}^{k}\sqrt{\rho(i)}\leq\frac{1}{2}\cdot\sqrt{\frac{k}{n}}.
\mathcal{D}:=\{(s_{i},a_{i})\}_{i=1}^{n}
x(s,a):=\rho(s)\pi(a|s)
\rho\in\Delta(S),\pi:S\to\Delta(A)
\hat{\rho}
\rho
\mathcal{D}
\hat{\pi}
\pi
\mathcal{D}
\mathbb{E}_{\mathcal{D}}[\mathbb{E}_{s\sim\rho}[D_{\mathrm{TV}}(\pi(s)\|\hat{%
\pi}(s))]]\leq\sqrt{\frac{|S||A|}{n}}.
\hat{x}
x
\mathcal{D}
\displaystyle\mathbb{E}_{s\sim\rho}[D_{\mathrm{TV}}(\pi(s)\|\hat{\pi}(s))]=%
\frac{1}{2}\sum_{s,a}\rho(s)\cdot|\pi(a|s)-\hat{\pi}(a|s)|
\displaystyle\mathbb{E}_{s\sim\rho}[D_{\mathrm{TV}}(\pi(s)\|\hat{\pi}(s))]
\displaystyle=\frac{1}{2}\sum_{s,a}\rho(s)\cdot|\pi(a|s)-\hat{\pi}(a|s)|
\displaystyle=\frac{1}{2}\sum_{s,a}\rho(s)\cdot\left|\frac{x(s,a)}{\rho(s)}-%
\frac{\hat{x}(s,a)}{\hat{\rho}(s)}\right|
\displaystyle=\frac{1}{2}\sum_{s,a}\rho(s)\cdot\left|\frac{x(s,a)}{\rho(s)}-%
\frac{\hat{x}(s,a)}{\hat{\rho}(s)}\right|
\displaystyle\leq\frac{1}{2}\sum_{s,a}\rho(s)\cdot\left|\frac{\hat{x}(s,a)}{%
\rho(s)}-\frac{\hat{x}(s,a)}{\hat{\rho}(s)}\right|+\frac{1}{2}\sum_{s,a}\rho(s%
)\cdot\left|\frac{\hat{x}(s,a)}{\rho(s)}-\frac{x(s,a)}{\rho(s)}\right|
\displaystyle\leq\frac{1}{2}\sum_{s,a}\rho(s)\cdot\left|\frac{\hat{x}(s,a)}{%
\rho(s)}-\frac{\hat{x}(s,a)}{\hat{\rho}(s)}\right|+\frac{1}{2}\sum_{s,a}\rho(s%
)\cdot\left|\frac{\hat{x}(s,a)}{\rho(s)}-\frac{x(s,a)}{\rho(s)}\right|
\displaystyle=\frac{1}{2}\sum_{s,a}\rho(s)\cdot\left|\frac{\hat{x}(s,a)}{\rho(%
s)}-\frac{\hat{x}(s,a)}{\hat{\rho}(s)}\right|+D_{\mathrm{TV}}(x\|\hat{x})
\displaystyle=\frac{1}{2}\sum_{s,a}\rho(s)\cdot\left|\frac{\hat{x}(s,a)}{\rho(%
s)}-\frac{\hat{x}(s,a)}{\hat{\rho}(s)}\right|+D_{\mathrm{TV}}(x\|\hat{x})
\displaystyle=\frac{1}{2}\sum_{s}\rho(s)\cdot\left|\frac{1}{\rho(s)}-\frac{1}{%
\hat{\rho}(s)}\right|\left(\sum_{a}\hat{x}(s,a)\right)+D_{\mathrm{TV}}(x\|\hat%
{x})
\displaystyle=\frac{1}{2}\sum_{s}\rho(s)\cdot\left|\frac{1}{\rho(s)}-\frac{1}{%
\hat{\rho}(s)}\right|\left(\sum_{a}\hat{x}(s,a)\right)+D_{\mathrm{TV}}(x\|\hat%
{x})
\displaystyle=\frac{1}{2}\sum_{s}\rho(s)\cdot\left|\frac{1}{\rho(s)}-\frac{1}{%
\hat{\rho}(s)}\right|\cdot\hat{\rho}(s)+D_{\mathrm{TV}}(x\|\hat{x})
\displaystyle=\frac{1}{2}\sum_{s}\rho(s)\cdot\left|\frac{1}{\rho(s)}-\frac{1}{%
\hat{\rho}(s)}\right|\cdot\hat{\rho}(s)+D_{\mathrm{TV}}(x\|\hat{x})
\displaystyle=D_{\mathrm{TV}}(\rho\|\hat{\rho})+D_{\mathrm{TV}}(x\|\hat{x}).
\displaystyle=D_{\mathrm{TV}}(\rho\|\hat{\rho})+D_{\mathrm{TV}}(x\|\hat{x}).
\mathrm{Diff}(\pi_{Z},\pi_{*})\leq(\ref{eq:tabular-rep})(\phi)+(\ref{eq:%
tabular-dec})(\phi)+C_{3}\cdot\mathbb{E}_{s\sim d^{\pi_{*}}}[D_{\mathrm{TV}}(%
\pi_{*,Z}(s)\|\pi_{Z}(s))],
C_{3}=\frac{\gamma}{1-\gamma}
\phi=\phi_{opt}
\pi_{Z}:=\pi_{opt,Z}
\theta_{s}
\theta
\displaystyle\frac{\partial}{\partial\theta_{s}}\mathbb{E}_{\tilde{s}\sim d^{%
\pi},a\sim\pi(\tilde{s})}[(\theta_{\tilde{s}}-\phi(\tilde{s},a))^{2}]
\displaystyle\frac{\partial}{\partial\theta_{s}}\mathbb{E}_{\tilde{s}\sim d^{%
\pi},a\sim\pi(\tilde{s})}[(\theta_{\tilde{s}}-\phi(\tilde{s},a))^{2}]
\displaystyle=-2\mathbb{E}_{a\sim\pi(s)}[d^{\pi}(s)\phi(s,a)]+2d^{\pi}(s)%
\theta_{s}
\displaystyle=-2\mathbb{E}_{a\sim\pi(s)}[d^{\pi}(s)\phi(s,a)]+2d^{\pi}(s)%
\theta_{s}
\displaystyle=-2\mathbb{E}_{a\sim\pi(s)}[d^{\pi}(s)\phi(s,a)]+2\mathbb{E}_{z=%
\theta_{s}}[d^{\pi}(s)\cdot z],
\displaystyle=-2\mathbb{E}_{a\sim\pi(s)}[d^{\pi}(s)\phi(s,a)]+2\mathbb{E}_{z=%
\theta_{s}}[d^{\pi}(s)\cdot z],
\displaystyle w(s^{\prime})^{\top}\frac{\partial}{\partial\theta_{s}}\mathbb{E%
}_{\tilde{s}\sim d^{\pi},a\sim\pi(\tilde{s})}[(\theta_{\tilde{s}}-\phi(\tilde{%
s},a))^{2}]
\displaystyle w(s^{\prime})^{\top}\frac{\partial}{\partial\theta_{s}}\mathbb{E%
}_{\tilde{s}\sim d^{\pi},a\sim\pi(\tilde{s})}[(\theta_{\tilde{s}}-\phi(\tilde{%
s},a))^{2}]
\displaystyle=-2\mathbb{E}_{a\sim\pi(s)}[d^{\pi}(s)\overline{\mathcal{T}}(s^{%
\prime}|s,a)]+2\mathbb{E}_{z=\theta_{s}}[d^{\pi}(s)w(s^{\prime})^{\top}z].
\displaystyle=-2\mathbb{E}_{a\sim\pi(s)}[d^{\pi}(s)\overline{\mathcal{T}}(s^{%
\prime}|s,a)]+2\mathbb{E}_{z=\theta_{s}}[d^{\pi}(s)w(s^{\prime})^{\top}z].
s\in S
\displaystyle\sum_{s\in S}w(s^{\prime})^{\top}\frac{\partial}{\partial\theta_{%
s}}\mathbb{E}_{\tilde{s}\sim d^{\pi},a\sim\pi(\tilde{s})}[(\theta_{\tilde{s}}-%
\phi(\tilde{s},a))^{2}]
\displaystyle\sum_{s\in S}w(s^{\prime})^{\top}\frac{\partial}{\partial\theta_{%
s}}\mathbb{E}_{\tilde{s}\sim d^{\pi},a\sim\pi(\tilde{s})}[(\theta_{\tilde{s}}-%
\phi(\tilde{s},a))^{2}]
\displaystyle=2\mathbb{E}_{s\sim d^{\pi},a\sim\pi(s),z=\theta_{s}}[-\overline{%
\mathcal{T}}(s^{\prime}|s,a)+\mathcal{T}_{Z}(s^{\prime}|s,z)]
\displaystyle=2\mathbb{E}_{s\sim d^{\pi},a\sim\pi(s),z=\theta_{s}}[-\overline{%
\mathcal{T}}(s^{\prime}|s,a)+\mathcal{T}_{Z}(s^{\prime}|s,z)]
\displaystyle\mathrm{Err}_{d^{\pi}}(\pi,\pi_{\theta},\overline{\mathcal{T}})=%
\frac{1}{2}\sum_{s^{\prime}\in S}\left|\mathbb{E}_{s\sim d^{\pi},a\sim\pi(s),z%
=\theta_{s}}[-\overline{\mathcal{T}}(s^{\prime}|s,a)+\mathcal{T}_{Z}(s^{\prime%
}|s,z)]\right|
\displaystyle\mathrm{Err}_{d^{\pi}}(\pi,\pi_{\theta},\overline{\mathcal{T}})
\displaystyle=\frac{1}{2}\sum_{s^{\prime}\in S}\left|\mathbb{E}_{s\sim d^{\pi}%
,a\sim\pi(s),z=\theta_{s}}[-\overline{\mathcal{T}}(s^{\prime}|s,a)+\mathcal{T}%
_{Z}(s^{\prime}|s,z)]\right|
\displaystyle=\frac{1}{4}\sum_{s^{\prime}\in S}\left|\sum_{s\in S}w(s^{\prime}%
)^{\top}\frac{\partial}{\partial\theta_{s}}\mathbb{E}_{\tilde{s}\sim d^{\pi},a%
\sim\pi(\tilde{s})}[(\theta_{\tilde{s}}-\phi(\tilde{s},a))^{2}]\right|
\displaystyle=\frac{1}{4}\sum_{s^{\prime}\in S}\left|\sum_{s\in S}w(s^{\prime}%
)^{\top}\frac{\partial}{\partial\theta_{s}}\mathbb{E}_{\tilde{s}\sim d^{\pi},a%
\sim\pi(\tilde{s})}[(\theta_{\tilde{s}}-\phi(\tilde{s},a))^{2}]\right|
\displaystyle\leq\frac{1}{4}|S|\|w\|_{\infty}\cdot\left\|\frac{\partial}{%
\partial\theta}\mathbb{E}_{s\sim d^{\pi},a\sim\pi(s)}[(\theta_{s}-\phi(s,a))^{%
2}]\right\|_{1}.
\displaystyle\leq\frac{1}{4}|S|\|w\|_{\infty}\cdot\left\|\frac{\partial}{%
\partial\theta}\mathbb{E}_{s\sim d^{\pi},a\sim\pi(s)}[(\theta_{s}-\phi(s,a))^{%
2}]\right\|_{1}.
\phi
256
64
256
64
256
512
\geq 64
8
10
8
t=10
256
\beta=0.1
\beta
0.1
0.0003
200
256
0.0001
1
3
200
10
\pi_{\alpha}\circ\pi_{Z}
10
4
n=10
10
25
10
25
\frac{1}{10}
20\%
80\%
80\%
\mathcal{D}^{\pi_{*}}
40
2
300
3
200
1
3000
53
200
4
200
6
80\%
80\%
4
80\%
5\%
4
80\%
5\%
