f(\bm{\cdot};\theta)
C
\theta
x
{X}
f(x;\theta)\in\mathbb{R}^{C}
f(x;\theta)_{c}
c
{\textbf{Z}}\coloneqq[{{z}}_{{1}},\hbox to10.00002pt{.\hss.\hss.},{{z}}_{{N}}]
N
{{z}}_{{i}}\coloneqq({{x}}_{{i}},{{y}}_{{i}})
{{x}}_{{i}}\in\mathcal{X}
{{y}}_{{i}}\in\mathcal{Y}\coloneqq[0,1]^{C}
K
\{\Phi_{k}\}_{k=1}^{K}
\Phi_{k}\subseteq[N]
\Phi_{k}\cap\Phi_{k^{\prime}}=\emptyset
k\neq k^{\prime}
\cup_{k=1}^{K}\Phi_{k}=[N].
\Phi_{k}
{{N}^{\prime}}
{{\textbf{Z}}^{\prime}}\coloneqq[{{{z}^{\prime}}}_{{1}},\hbox to10.00002pt{.%
\hss.\hss.},{{{z}^{\prime}}}_{{{{N}^{\prime}}}}]
{{{z}^{\prime}}}_{{i}}\coloneqq({{{x}^{\prime}}}_{{i}},{{{y}^{\prime}}}_{{i}})
{{{x}^{\prime}}}_{{i}}\in\mathcal{X},{{{y}^{\prime}}}_{{i}}\in\mathcal{Y}
\theta=\operatorname{argmin}_{\theta^{\prime}}\tfrac{1}{{{N}^{\prime}}}\sum_{i%
\leavevmode\resizebox{5.44446pt}{0.0pt}{=}1}^{{{N}^{\prime}}}L({{{z}^{\prime}}%
}_{{i}};\theta^{\prime})
L
z=(x,y)
x\in\mathcal{X},y=[y_{1},\hbox to10.00002pt{.\hss.\hss.},y_{C}]\in\mathcal{Y}
L(z;\theta)=-\textstyle\sum_{c}y_{c}\log p_{c}
p=[p_{1},\hbox to10.00002pt{.\hss.\hss.},p_{C}]
p_{c}\coloneqq\tfrac{\exp(f(x;\theta)_{c})}{\sum_{c^{\prime}}\exp(f(x;\theta)_%
{c^{\prime}}))}
p=\operatorname{softmax}(f(x;\theta))
z^{\prime}
z
z
z^{\prime}
I({{z}^{\prime}},{z})\coloneqq\nabla_{\theta}L({{z}^{\prime}};\theta)^{%
\intercal}H_{\theta}^{-1}\nabla_{\theta}L({z};\theta),
H_{\theta}
H_{\theta}\coloneqq 1/n\sum_{i=1}^{n}\nabla^{2}_{\theta}L(z;\theta)
H_{\theta}
H_{\theta}^{-1}
H_{\theta}
P
P
H_{\theta}
P
D
H_{\theta}
P\times P
\operatorname{FactorHessian}
H_{\theta}^{-1}
\displaystyle M,\lambda=\operatorname{FactorHessian}({{\textbf{Z}}^{\prime}},%
\Theta,P,D)\ \text{where}
\displaystyle M,\lambda=\operatorname{FactorHessian}({{\textbf{Z}}^{\prime}},%
\Theta,P,D)\ \text{where}
\displaystyle\hat{H}_{\theta}^{-1}\coloneqq M\lambda^{-1}M^{\intercal}\approx H%
_{\theta}^{-1},
\displaystyle\hat{H}_{\theta}^{-1}\coloneqq M\lambda^{-1}M^{\intercal}\approx H%
_{\theta}^{-1},
M\in\mathbb{R}^{|\theta|\times D}
\lambda\in\mathbb{R}^{D\times D}
|\theta|
\hat{H}_{\theta}^{-1}
H_{\theta}^{-1}
D
P
\Theta\coloneqq(L,f,\theta)
\hat{H}_{\theta}^{-1}
{{z}^{\prime}}
{z}
\displaystyle\hat{I}({{z}^{\prime}},{z})\coloneqq\nabla_{\theta}L({{z}^{\prime%
}};\theta)^{\intercal}\hat{H}_{\theta}^{-1}\nabla_{\theta}L({z};\theta).
\displaystyle\hat{I}({{z}^{\prime}},{z})
\displaystyle\coloneqq\nabla_{\theta}L({{z}^{\prime}};\theta)^{\intercal}\hat{%
H}_{\theta}^{-1}\nabla_{\theta}L({z};\theta).
{z}
E({z})
\displaystyle E({z})\coloneqq\{\hat{I}({{{z}^{\prime}}}_{{j}},z)\}_{j=1}^{{{N}%
^{\prime}}},
\displaystyle E({z})\coloneqq\{\hat{I}({{{z}^{\prime}}}_{{j}},z)\}_{j=1}^{{{N}%
^{\prime}}},
{\textbf{Z}},{{\textbf{Z}}^{\prime}},\Theta,P,D
D
M,\lambda\leftarrow\operatorname{FactorHessian}({{\textbf{Z}}^{\prime}},\Theta%
,P,D)
\mu_{i}\leftarrow\lambda^{-1/2}M^{\intercal}\nabla_{\theta}L(z_{i};\theta)
i=1,\hbox to10.00002pt{.\hss.\hss.},N
\bm{\mu}\leftarrow[\mu_{1},\hbox to10.00002pt{.\hss.\hss.},\mu_{N}]
\bm{\mu}
{\textbf{Z}},{{\textbf{Z}}^{\prime}},\Theta,P,D
K
{{\textbf{Z}}^{\prime}}
\Theta
P
D
\Phi
\bm{\mu}\leftarrow\operatorname{GetEmbeddings}({\textbf{Z}},{{\textbf{Z}}^{%
\prime}},\Theta,P,D)
[r_{1},\hbox to10.00002pt{.\hss.\hss.},r_{{N}}]\leftarrow\operatorname{K-Means%
}(\bm{\mu},K)
N
\{\{i\in[N]:r_{i}=k\}\ \text{for}\ k\in[K]\}
\{\Phi_{k}\}_{k=1}^{K}
\displaystyle\operatorname{argmin}_{\{\Phi_{k}\}_{k=1}^{K}}\textstyle\sum_{k}%
\textstyle\sum_{i,i^{\prime}\in\Phi_{k}}||E({{z}}_{{i}})-E({{z}}_{{i^{\prime}}%
})||^{2}.
\displaystyle\operatorname{argmin}_{\{\Phi_{k}\}_{k=1}^{K}}\textstyle\sum_{k}%
\textstyle\sum_{i,i^{\prime}\in\Phi_{k}}||E({{z}}_{{i}})-E({{z}}_{{i^{\prime}}%
})||^{2}.
{{N}^{\prime}}
\mu(z)
z
\displaystyle\mu(z)\coloneqq\lambda^{-1/2}M^{\intercal}\nabla_{\theta}L(z;\theta)
\displaystyle\mu(z)\coloneqq\lambda^{-1/2}M^{\intercal}\nabla_{\theta}L(z;\theta)
M
\lambda
{{z}^{\prime}}
{z}
\hat{I}({{z}^{\prime}},{z})=\mu({{z}^{\prime}})^{\intercal}\mu({z})
D
P
D
C>0
{{z}}_{{i}},{{z}}_{{j}}
||E({{z}}_{{i}})-E({{z}}_{{j}})||^{2}\leq C||\mu({{z}}_{{i}})-\mu({{z}}_{{j}})%
)||^{2}
\bm{\mu}\coloneqq[\mu({z}_{1}),\hbox to10.00002pt{.\hss.\hss.},\mu({z}_{{N}})]
\{\Phi_{k}\}
\displaystyle\textstyle\sum_{k}\textstyle\sum_{i,i^{\prime}\in\Phi_{k}}||E({{z%
}}_{{i}})-E({{z}}_{{i^{\prime}}})||^{2}\leq C\textstyle\sum_{k}\textstyle\sum_%
{i,i^{\prime}\in\Phi_{k}}||\mu({{z}}_{{i}})-\mu({{z}}_{{i^{\prime}}})||^{2}.
\displaystyle\textstyle\sum_{k}\textstyle\sum_{i,i^{\prime}\in\Phi_{k}}||E({{z%
}}_{{i}})-E({{z}}_{{i^{\prime}}})||^{2}\leq C\textstyle\sum_{k}\textstyle\sum_%
{i,i^{\prime}\in\Phi_{k}}||\mu({{z}}_{{i}})-\mu({{z}}_{{i^{\prime}}})||^{2}.
C>0
\mathcal{O}
P
P
P
\mathcal{O}
\times
\times
\operatorname{InfEmbed}
K
K
K
A
S
B
A
S
z=(x,y)
z^{\prime}=(x^{\prime},y^{\prime})
f
z,z^{\prime}
\displaystyle\nabla_{\theta}L(z;\theta)^{\intercal}\nabla_{\theta}L(z^{\prime}%
;\theta)=(y-p)^{\intercal}(y^{\prime}-p^{\prime})x^{\intercal}x^{\prime},
\displaystyle\nabla_{\theta}L(z;\theta)^{\intercal}\nabla_{\theta}L(z^{\prime}%
;\theta)=(y-p)^{\intercal}(y^{\prime}-p^{\prime})x^{\intercal}x^{\prime},
L
\theta
z
p\coloneqq[p_{1},\hbox to10.00002pt{.\hss.\hss.},p_{C}]=\operatorname{softmax}%
(f(x))
y
x
p^{\prime},y^{\prime},x^{\prime}
z^{\prime}
x^{\intercal}x^{\prime}
(y-p)^{\intercal}(y^{\prime}-p^{\prime})
(y-p)
(y^{\prime}-p^{\prime})
k
k
\Phi
[\mu(z^{\prime}_{1}),\dots,\mu(z^{\prime}_{N^{\prime}})]
v\coloneqq\sum_{i\in\Phi}\mu({z_{i}})
k
O
k
z^{\prime}
v^{\intercal}\mu({z^{\prime}})
O=\operatorname{argmin}_{O^{\prime}\subseteq[N^{\prime}],|O^{\prime}|=k}v^{%
\intercal}(\sum_{i\in O^{\prime}}\mu(z^{\prime}_{i^{\prime}}))
\nabla_{\theta}L(z;\theta)
M,\lambda^{1/2}
P=500
D=100
k=10
\operatorname{InfEmbed}
\operatorname{InfEmbed}
\operatorname{RuleFind}
40
\operatorname{RuleFind}
40
K=25
\operatorname{InfEmbed}
H_{\theta}
I({{z}^{\prime}},{z})\coloneqq\nabla_{\theta}L({{z}^{\prime}};\theta)^{%
\intercal}H_{\theta}^{-1}\nabla_{\theta}L({z};\theta),
H_{\theta}^{-1}
H_{\theta}
(q_{1},\hbox to10.00002pt{.\hss.\hss.},q_{D})
P
(b,H_{\theta}b,\hbox to10.00002pt{.\hss.\hss.},H_{\theta}^{P-1})
R
H_{\theta}
H_{\theta}=QRQ^{\intercal}
Q\coloneqq[q_{1},\hbox to10.00002pt{.\hss.\hss.},q_{P}]\in\mathbb{R}^{|\theta|%
\times P}
R\in\mathbb{R}^{P\times P}
P
H_{\theta}
R\approx V\lambda V^{\intercal}
R^{-1}\approx V\lambda^{-1}V^{\intercal}
V=[v_{1},\hbox to10.00002pt{.\hss.\hss.},v_{D}]\in\mathbb{R}^{P\times D}
v_{1},\hbox to10.00002pt{.\hss.\hss.},v_{D}
D
R
\lambda=\operatorname{diag}(\lambda_{1},\hbox to10.00002pt{.\hss.\hss.},%
\lambda_{D})
\lambda_{1},\hbox to10.00002pt{.\hss.\hss.},\lambda_{D}
D
R
R
P\times P
P=200
H_{\theta}^{-1}
\displaystyle\hat{H}_{\theta}^{-1}\coloneqq M\lambda^{-1}M^{\intercal},\ \text%
{where}\ M=QV
\displaystyle\hat{H}_{\theta}^{-1}
\displaystyle\coloneqq M\lambda^{-1}M^{\intercal},\ \text{where}\ M=QV
{{z}^{\prime}}
{z}
\displaystyle\hat{I}({{z}^{\prime}},{z})\coloneqq\nabla_{\theta}L({{z}^{\prime%
}};\theta)^{\intercal}\hat{H}_{\theta}^{-1}\nabla_{\theta}L({z};\theta).
\displaystyle\hat{I}({{z}^{\prime}},{z})
\displaystyle\coloneqq\nabla_{\theta}L({{z}^{\prime}};\theta)^{\intercal}\hat{%
H}_{\theta}^{-1}\nabla_{\theta}L({z};\theta).
\hat{H}_{\theta}^{-1}
\Theta\coloneqq(L,f,\theta)
\triangleright
{{\textbf{Z}}^{\prime}}
\Theta
P
D
{{\textbf{Z}}^{\prime}}
\Theta
P
D
H_{\theta}\leftarrow\sum_{i=1}^{N^{\prime}}\nabla_{\theta}^{2}L({{{z}^{\prime}%
}}_{{i}};\theta)
H_{\theta}
P
Q\in\mathbb{R}^{|\theta|\times P},R\in\mathbb{R}^{P\times P}
V,\lambda\leftarrow
D
R
M\leftarrow QV
M,\lambda
C
{{z}}_{{i}},{{z}}_{{j}}
||E({{z}}_{{i}})-E({{z}}_{{j}})||^{2}\leq C||\mu({{z}}_{{i}})-\mu({{z}}_{{j}})%
)||^{2}
\displaystyle||E({{{z}}_{{i}}})-E({{{z}}_{{j}}})||^{2}=\textstyle\sum_{n=1}^{N%
^{\prime}}(\hat{I}({{{{z}^{\prime}}}_{{n}}},{{z}}_{{i}})-\hat{I}({{{z}^{\prime%
}}}_{{n}},{{z}}_{{j}}))^{2}
\displaystyle||E({{{z}}_{{i}}})-E({{{z}}_{{j}}})||^{2}
\displaystyle=\textstyle\sum_{n=1}^{N^{\prime}}(\hat{I}({{{{z}^{\prime}}}_{{n}%
}},{{z}}_{{i}})-\hat{I}({{{z}^{\prime}}}_{{n}},{{z}}_{{j}}))^{2}
\displaystyle=\textstyle\sum_{n=1}^{N^{\prime}}(\mu({{{z}^{\prime}}}_{{n}})^{%
\intercal}\mu({{z}}_{{i}})-\mu({{{z}^{\prime}}}_{{n}})^{\intercal}\mu({{z}}_{{%
j}}))^{2}
\displaystyle=\textstyle\sum_{n=1}^{N^{\prime}}(\mu({{{z}^{\prime}}}_{{n}})^{%
\intercal}\mu({{z}}_{{i}})-\mu({{{z}^{\prime}}}_{{n}})^{\intercal}\mu({{z}}_{{%
j}}))^{2}
\displaystyle=\textstyle\sum_{n=1}^{N^{\prime}}(\mu({{{z}^{\prime}}}_{{n}})^{%
\intercal}(\mu({{z}}_{{i}})-\mu({{z}}_{{j}})))^{2}
\displaystyle=\textstyle\sum_{n=1}^{N^{\prime}}(\mu({{{z}^{\prime}}}_{{n}})^{%
\intercal}(\mu({{z}}_{{i}})-\mu({{z}}_{{j}})))^{2}
\displaystyle\leq\textstyle\sum_{n=1}^{N^{\prime}}||\mu({{{z}^{\prime}}}_{{n}}%
)||^{2}||\mu({{z}}_{{i}})-\mu({{z}}_{{j}})||^{2}
\displaystyle\leq\textstyle\sum_{n=1}^{N^{\prime}}||\mu({{{z}^{\prime}}}_{{n}}%
)||^{2}||\mu({{z}}_{{i}})-\mu({{z}}_{{j}})||^{2}
\displaystyle\leq C||\mu({{z}}_{{i}})-\mu({{z}}_{{j}})||^{2},\ \text{where}
\displaystyle\leq C||\mu({{z}}_{{i}})-\mu({{z}}_{{j}})||^{2},\ \text{where}
C\coloneqq\sum_{n=1}^{N^{\prime}}||\mu({{{z}^{\prime}}}_{{n}})||^{2}
i
j
\operatorname{InfEmbed}
K
K
K
A
S
B
A
S
\bm{\mu},A,S,B
\bm{\mu}
A
S
B
A
S
acc\leftarrow
\{\mu_{i}\}
size\leftarrow
\{\mu_{i}\}
acc\leq A
size\geq S
\{\bm{\mu}\}
size<S
\{\}
\bm{r}\leftarrow\operatorname{K-Means}(\bm{\mu},B)
\bm{r}_{k}\leftarrow\{\mu_{i}\}_{i:r_{i}=k}
k\in[B]
F=\{\}
k\in[B]
F\leftarrow F\cup\{\operatorname{RuleFind}(\{\mu_{i}\}_{i:r_{i}=b},A,S,B)\}
F
A,S,B,{\textbf{Z}},{{\textbf{Z}}^{\prime}},\Theta,P,D
\bm{\mu}\leftarrow\operatorname{GetEmbeddings}({\textbf{Z}},{{\textbf{Z}}^{%
\prime}},\Theta,P,D)
F\leftarrow\texttt{RuleFind}(\bm{\mu},A,S,B)
F
D=100
P=500
\operatorname{InfEmbed}
K=25
D=100
P=500
12282
1425
200
1
5
0.9
0.01
10
\gamma=0.1
[-1024,1024]
k=3
