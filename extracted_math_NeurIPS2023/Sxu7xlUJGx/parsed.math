p(x,z)=p(x\,|\,z)p(z)
x
z
\mathcal{L}(\phi)=\mathbb{E}_{q_{\phi}(z)}[\log p(x\,|\,z)]-{\mathrm{KL}}(q_{%
\phi}(z)\,\|\,p(z)),
q_{\phi}(z)
p(z\,|\,x)
q_{\phi}
\mathcal{L}(\phi)
\phi
p(x,z)=p(x\,|\,z)p(z)
x
z
p(z\,|\,x)
q_{\phi}(z)
\log p(x)\geq\mathcal{L}(\phi)=\mathbb{E}_{q_{\phi}(z)}\log\frac{p(x\,|\,z)p(z%
)}{q_{\phi}(z)}\to\max_{\phi}.
{\mathrm{KL}}(q_{\phi}(z)\,\|\,p(z\,|\,x))
q_{\phi}(z)
p(z\,|\,x)
p_{\theta}(z)
\phi
\theta
p(x\,|\,\theta)
q_{\phi}(z)
\varepsilon\sim p(\varepsilon)
z=f(\varepsilon,\phi)
p(z)
q_{\phi}(z)
q_{\phi}(z)=\int q_{\phi}(z\,|\,\psi)q_{\phi}(\psi)\,d\psi.
q_{\phi}(z\,|\,\psi)
\psi
q_{\phi}(\psi)
q_{\phi}(z)
q_{\phi}(\psi)
\psi
z
q_{\phi}(z)
\psi\sim q_{\phi}(\psi)
z
q_{\phi}(z\,|\,\psi)
\mathbb{E}_{z\sim q_{\phi}(z)}
q_{\phi}(z)=\int\delta(z-z^{\prime})q_{\phi}(z^{\prime})\,dz^{\prime}
q_{\phi}(z)
q_{\phi}(z)=\int q_{\phi}(z,\psi)\,d\psi
r_{\omega}(\psi\,|\,z)\approx q_{\phi}(\psi\,|\,z)
q_{\phi}(z,\psi)
r(z)=\frac{q_{\phi}(z)}{p_{\theta}(z)}
\theta
p_{\theta}(z)
\phi
\theta
p(x,z)
q_{\phi}(z)
\displaystyle q_{\phi}(z)=\int q_{\phi}(z\,|\,\psi)q_{\phi}(\psi)\,d\psi\approx
\displaystyle q_{\phi}(z)
\displaystyle=\int q_{\phi}(z\,|\,\psi)q_{\phi}(\psi)\,d\psi\approx
\displaystyle\approx\frac{1}{K}\sum_{k=1}^{K}q_{\phi}(z\,|\,\psi^{k}),\ \ \ %
\psi^{k}\sim q_{\phi}(\psi).
\displaystyle\approx\frac{1}{K}\sum_{k=1}^{K}q_{\phi}(z\,|\,\psi^{k}),\ \ \ %
\psi^{k}\sim q_{\phi}(\psi).
\overline{\mathcal{L}}^{q}_{K}\geq\overline{\mathcal{L}}^{q}_{K+1}\geq\mathcal%
{L}
\underline{\mathcal{L}}^{q}_{K}
K
\underline{\mathcal{L}}^{q}_{\infty}=\overline{\mathcal{L}}^{q}_{\infty}=%
\mathcal{L}
\displaystyle\overline{\mathcal{L}}^{q}_{K}=\mathbb{E}_{q_{\phi}(z)}\log{p(x\,%
|\,z)p(z)}-
\displaystyle\overline{\mathcal{L}}^{q}_{K}=\mathbb{E}_{q_{\phi}(z)}\log{p(x\,%
|\,z)p(z)}-
\displaystyle-\mathbb{E}_{\psi^{0..K}\sim q_{\phi}(\psi)}\mathbb{E}_{z\sim q_{%
\phi}(z\,|\,\psi^{0})}\log{\frac{1}{K}\sum_{k=1}^{K}q_{\phi}(z\,|\,\psi^{k})},
\displaystyle-\mathbb{E}_{\psi^{0..K}\sim q_{\phi}(\psi)}\mathbb{E}_{z\sim q_{%
\phi}(z\,|\,\psi^{0})}\log{\frac{1}{K}\sum_{k=1}^{K}q_{\phi}(z\,|\,\psi^{k})},
\displaystyle\underline{\mathcal{L}}^{q}_{K}=\mathbb{E}_{q_{\phi}(z)}\log{p(x%
\,|\,z)p(z)}-
\displaystyle\underline{\mathcal{L}}^{q}_{K}=\mathbb{E}_{q_{\phi}(z)}\log{p(x%
\,|\,z)p(z)}-
\displaystyle-\mathbb{E}_{\psi^{0..K}\sim q_{\phi}(\psi)}\mathbb{E}_{z\sim q_{%
\phi}(z\,|\,\psi^{0})}\log{\frac{1}{K+1}\sum_{k=0}^{K}q_{\phi}(z\,|\,\psi^{k})}.
\displaystyle-\mathbb{E}_{\psi^{0..K}\sim q_{\phi}(\psi)}\mathbb{E}_{z\sim q_{%
\phi}(z\,|\,\psi^{0})}\log{\frac{1}{K+1}\sum_{k=0}^{K}q_{\phi}(z\,|\,\psi^{k})}.
\underline{\mathcal{L}}^{q}_{K}
\underline{\mathcal{L}}^{q}_{0}
K
\underline{\mathcal{L}}^{q}_{K}
\underline{\mathcal{L}}^{q}_{K}
\mathcal{L}
\mathcal{L}
\underline{\mathcal{L}}^{q}_{K}
\underline{\mathcal{L}}^{q}_{K}
\mathcal{L}
K\to\infty
\underline{\mathcal{L}}^{q}_{K}\leq\underline{\mathcal{L}}^{q}_{K+1}\leq%
\mathcal{L}
\displaystyle\underline{\mathcal{L}}^{q}_{K}=\mathbb{E}_{\psi^{0..K}\sim q_{%
\phi}(\psi)}\mathbb{E}_{q_{\phi}^{K}(z\,|\,\psi^{0..K})}\log{\frac{p(x\,|\,z)p%
(z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}},
\displaystyle\underline{\mathcal{L}}^{q}_{K}=\mathbb{E}_{\psi^{0..K}\sim q_{%
\phi}(\psi)}\mathbb{E}_{q_{\phi}^{K}(z\,|\,\psi^{0..K})}\log{\frac{p(x\,|\,z)p%
(z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}},
\displaystyle\text{where }q_{\phi}^{K}(z\,|\,\psi^{0..K})=\frac{1}{K+1}\sum_{k%
=0}^{K}q_{\phi}(z\,|\,\psi^{k}).
\displaystyle\text{where }q_{\phi}^{K}(z\,|\,\psi^{0..K})=\frac{1}{K+1}\sum_{k%
=0}^{K}q_{\phi}(z\,|\,\psi^{k}).
\underline{\mathcal{L}}^{q}_{K}
q_{\phi}^{K}(z\,|\,\psi^{0},\dots,\psi^{K})
\psi^{0},\dots,\psi^{K}\sim q_{\phi}(\psi)
\underline{\mathcal{L}}^{p}_{K}
q_{\phi}(z)
p_{\theta}(z)=\int p_{\theta}(z|\zeta)p_{\theta}(\zeta)\,d\zeta
\displaystyle\begin{multlined}\underline{\mathcal{L}}^{p}_{K}=\mathbb{E}_{q_{%
\phi}(z)}\log{p(x\,|\,z)}-\\
-\mathbb{E}_{\zeta^{1..K}\sim p_{\theta}(\zeta)}\mathbb{E}_{q_{\phi}(z)}\log%
\frac{q_{\phi}(z)}{\frac{1}{K}\sum_{k=1}^{K}p_{\theta}(z\,|\,\zeta^{k})},\end{%
multlined}\underline{\mathcal{L}}^{p}_{K}=\mathbb{E}_{q_{\phi}(z)}\log{p(x\,|%
\,z)}-\\
-\mathbb{E}_{\zeta^{1..K}\sim p_{\theta}(\zeta)}\mathbb{E}_{q_{\phi}(z)}\log%
\frac{q_{\phi}(z)}{\frac{1}{K}\sum_{k=1}^{K}p_{\theta}(z\,|\,\zeta^{k})},
\displaystyle\underline{\mathcal{L}}^{p}_{K}\leq\underline{\mathcal{L}}^{p}_{K%
+1}\leq\underline{\mathcal{L}}^{p}_{\infty}=\mathcal{L}.
K
\underline{\mathcal{L}}^{p}_{K}\leq\mathcal{L}
\begin{multlined}\mathbb{E}_{\zeta^{1..K}\sim p_{\theta}(\zeta)}\mathbb{E}_{q_%
{\phi}(z)}\log{\frac{1}{K}\sum_{k=1}^{K}p_{\theta}(z\,|\,\zeta^{k})}\leq\\[-5.%
0pt]
\begin{aligned} &\leq\mathbb{E}_{q_{\phi}(z)}\log{\mathbb{E}_{\zeta^{1..K}\sim
p%
_{\theta}(\zeta)}\frac{1}{K}\sum_{k=1}^{K}p_{\theta}(z\,|\,\zeta^{k})}=\\
&=\mathbb{E}_{q_{\phi}(z)}\log{p_{\theta}(z)}.\end{aligned}\end{multlined}%
\mathbb{E}_{\zeta^{1..K}\sim p_{\theta}(\zeta)}\mathbb{E}_{q_{\phi}(z)}\log{%
\frac{1}{K}\sum_{k=1}^{K}p_{\theta}(z\,|\,\zeta^{k})}\leq\\[-5.0pt]
\begin{aligned} &\leq\mathbb{E}_{q_{\phi}(z)}\log{\mathbb{E}_{\zeta^{1..K}\sim
p%
_{\theta}(\zeta)}\frac{1}{K}\sum_{k=1}^{K}p_{\theta}(z\,|\,\zeta^{k})}=\\
&=\mathbb{E}_{q_{\phi}(z)}\log{p_{\theta}(z)}.\end{aligned}
K
\displaystyle\begin{multlined}{\mathrm{KL}}(q_{\phi}(z)\,\|\,p_{\theta}(z))=\\
=1+\sup_{g:\mathrm{dom}\,z\to\mathbb{R}}\left\{\mathbb{E}_{q_{\phi}(z)}g(z)-%
\mathbb{E}_{p_{\theta}(z)}e^{g(z)}\right\}\geq\\
\geq 1+\sup_{\eta}\left\{\mathbb{E}_{q_{\phi}(z)}g(z,\eta)-\mathbb{E}_{p_{%
\theta}(z)}e^{g(z,\eta)}\right\},\end{multlined}{\mathrm{KL}}(q_{\phi}(z)\,\|%
\,p_{\theta}(z))=\\
=1+\sup_{g:\mathrm{dom}\,z\to\mathbb{R}}\left\{\mathbb{E}_{q_{\phi}(z)}g(z)-%
\mathbb{E}_{p_{\theta}(z)}e^{g(z)}\right\}\geq\\
\geq 1+\sup_{\eta}\left\{\mathbb{E}_{q_{\phi}(z)}g(z,\eta)-\mathbb{E}_{p_{%
\theta}(z)}e^{g(z,\eta)}\right\},
\displaystyle\begin{multlined}\overline{\mathcal{L}}^{p}_{\eta}=\mathbb{E}_{q_%
{\phi}(z)}\log{p(x\,|\,z)}-\\
-1-\mathbb{E}_{q_{\phi}(z)}g(z,\eta)+\mathbb{E}_{p_{\theta}(z)}e^{g(z,\eta)}.%
\end{multlined}\overline{\mathcal{L}}^{p}_{\eta}=\mathbb{E}_{q_{\phi}(z)}\log{%
p(x\,|\,z)}-\\
-1-\mathbb{E}_{q_{\phi}(z)}g(z,\eta)+\mathbb{E}_{p_{\theta}(z)}e^{g(z,\eta)}.
\eta
g(z,\eta)
\eta
\eta^{*}=\arg\min_{\eta}\left[-\mathbb{E}_{q_{\phi}(z)}g(z,\eta)+\mathbb{E}_{p%
_{\theta}(z)}e^{g(z,\eta)}\right].
\begin{split}&\underline{\underline{\mathcal{L}}}_{K_{1},K_{2}}^{q,p}=\mathbb{%
E}_{q_{\phi}(z)}\log{p(x\,|\,z)}-\\
&-\mathbb{E}_{\psi^{0..K_{1}}\sim q_{\phi}(\psi)}\mathbb{E}_{q_{\phi}(z\,|\,%
\psi^{0})}\log\frac{1}{K_{1}+1}\sum_{k=0}^{K_{1}}q_{\phi}(z\,|\,\psi^{k})+\\
\end{split}
\begin{split}&+\mathbb{E}_{\zeta^{1..K_{2}}\sim p_{\theta}(\zeta)}\mathbb{E}_{%
q_{\phi}(z)}\log\frac{1}{K_{2}}\sum_{k=1}^{K_{2}}p_{\theta}(z\,|\,\zeta^{k}),%
\end{split}
\begin{split}\overline{{\mathcal{L}}}_{\eta}^{q,p}=&\mathbb{E}_{q_{\phi}(z)}%
\log{p(x\,|\,z)}-\\
&-1-\mathbb{E}_{q_{\phi}(z)}g(z,\eta)+\mathbb{E}_{p_{\theta}(z)}e^{g(z,\eta)}.%
\end{split}
\underline{\underline{\mathcal{L}}}_{K_{1},K_{2}}^{q,p}
K_{1}
K_{2}
\displaystyle\underline{\underline{\mathcal{L}}}_{K_{1},K_{2}}^{q,p}\leq%
\underline{\underline{\mathcal{L}}}_{K_{1}+1,K_{2}}^{q,p},\ \ \ \ \ \underline%
{\underline{\mathcal{L}}}_{K_{1},K_{2}}^{q,p}\leq\underline{\underline{%
\mathcal{L}}}_{K_{1},K_{2}+1}^{q,p},
\displaystyle\underline{\underline{\mathcal{L}}}_{K_{1},K_{2}}^{q,p}\leq%
\underline{\underline{\mathcal{L}}}_{K_{1}+1,K_{2}}^{q,p},\ \ 
\displaystyle\ \ \ \underline{\underline{\mathcal{L}}}_{K_{1},K_{2}}^{q,p}\leq%
\underline{\underline{\mathcal{L}}}_{K_{1},K_{2}+1}^{q,p},
\displaystyle\lim_{K_{1},K_{2}\to\infty}\underline{\underline{\mathcal{L}}}_{K%
_{1},K_{2}}^{q,p}=\mathcal{L}.
\displaystyle\lim_{K_{1},K_{2}\to\infty}
\displaystyle\underline{\underline{\mathcal{L}}}_{K_{1},K_{2}}^{q,p}=\mathcal{%
L}.
\overline{\mathcal{L}}_{K}^{q}
q_{\phi}(z)=\int q_{\phi}(z\,|\,\psi)q_{\phi}(\psi)\,d\psi
p_{\theta}(z)=\int p_{\theta}(z\,|\,\zeta)p_{\theta}(\zeta)\,d\zeta
\log p(x\,|\,z)
\phi
\theta
t\leftarrow 1
T
\psi^{0},\dots,\psi^{K_{1}}\sim q_{\phi}(\psi)
\zeta^{1},\dots,\zeta^{K_{2}}\sim p_{\theta}(\zeta)
z\sim q_{\phi}(z\,|\,\psi^{0})
L_{LH}\simeq\log p(x\,|\,z)
L_{E}\leftarrow-\log\frac{1}{K_{1}+1}\sum_{k=0}^{K_{1}}q_{\phi}(z\,|\,\psi^{k})
L_{CE}\leftarrow-\log\frac{1}{K_{2}}\sum_{k=1}^{K_{2}}p_{\theta}(z\,|\,\zeta^{%
k})
\hat{\underline{\underline{\mathcal{L}}}}_{K_{1},K_{2}}^{q,p}\leftarrow L_{LH}%
+L_{E}-L_{CE}
\nabla_{\phi}\hat{\underline{\underline{\mathcal{L}}}}_{K_{1},K_{2}}^{q,p}
\phi
\nabla_{\theta}\hat{\underline{\underline{\mathcal{L}}}}_{K_{1},K_{2}}^{q,p}
\theta
t\leftarrow 1
T
z\sim q_{\phi}(z)
z^{\prime}\sim p_{\theta}(z)
L\leftarrow-g(z,\eta)+e^{g(z^{\prime},\eta)}
-\nabla_{\eta}L
\eta
{\underline{\underline{\mathcal{L}}}}_{K_{1},K_{2}}^{q,p}
{\overline{\mathcal{L}}}_{\eta}^{q,p}
\phi,\theta,\eta,{\underline{\underline{\mathcal{L}}}}_{K_{1},K_{2}}^{q,p},%
\overline{{\mathcal{L}}}_{\eta}^{q,p}
p(z)
p^{*}(z)=\frac{1}{N}\sum_{n=1}^{N}q_{\phi}(z\,|\,x_{n}),
x_{n}
n=1,\dotsc,N
p^{Vamp}(z)=\frac{1}{K}\sum_{k=1}^{K}q_{\phi}(z\,|\,u_{k}).
K
q_{\phi}(z\,|\,u_{k})
\{u_{k}\}_{k=1}^{K}
p^{*}(z)
p^{*}(z)=\frac{1}{N}\sum_{n=1}^{N}q_{\phi}(z|x_{n})=\int q_{\phi}(z|x)p_{data}%
(x)dx.
\begin{multlined}\underline{\mathcal{L}}_{K}^{p}=\frac{1}{N}\sum_{n=1}^{N}%
\mathbb{E}_{q_{\phi}(z\,|\,x_{n})}\left[\log\frac{p(x_{n}\,|\,z)}{q_{\phi}(z\,%
|\,x_{n})}+\right.\\
\left.+\mathbb{E}_{u_{1..K}\sim p_{data}(x)}\log\frac{1}{K}\sum_{k=1}^{K}q_{%
\phi}(z\,|\,u_{k})\right].\end{multlined}\underline{\mathcal{L}}_{K}^{p}=\frac%
{1}{N}\sum_{n=1}^{N}\mathbb{E}_{q_{\phi}(z\,|\,x_{n})}\left[\log\frac{p(x_{n}%
\,|\,z)}{q_{\phi}(z\,|\,x_{n})}+\right.\\
\left.+\mathbb{E}_{u_{1..K}\sim p_{data}(x)}\log\frac{1}{K}\sum_{k=1}^{K}q_{%
\phi}(z\,|\,u_{k})\right].
u_{k}
p_{\theta}^{SI}(z)=\int p_{\theta}(z\,|\,\zeta)p_{\theta}(\zeta)\,d\zeta.
p_{\theta}(z\,|\,\zeta)=\mathcal{N}(z\,|\,\zeta,\mathrm{diag}(\sigma^{2}))
\zeta
\sigma_{j}^{2}
p_{\theta}(\zeta)
\theta
\varepsilon
\zeta
p(w)
p(w\,|\,\alpha)
\alpha
p(\alpha)
p(t,w,\alpha\,|\,x)=p(t\,|\,x,w)p(w\,|\,\alpha)p(\alpha).
q_{\phi}(w,\alpha)\approx p(w,\alpha\,|\,X_{tr},T_{tr})
(X_{tr},T_{tr})
q_{\phi}(w)=\int q_{\phi}(w,\alpha)\,d\alpha
p(t\,|\,x,X_{tr},T_{tr})
\begin{multlined}p(t\,|\,x,X_{tr},T_{tr})=\int p(t\,|\,x,w)p(w\,|\,X_{tr},T_{%
tr})\,dw=\\
\begin{aligned} &=\int p(t\,|\,x,w)\int p(w,\alpha\,|\,X_{tr},T_{tr})\,d\alpha%
\,dw\approx\\
&\approx\int p(t\,|\,x,w)\int q_{\phi}(w,\alpha)d\alpha\,dw=\\
&=\int p(t\,|\,x,w)q_{\phi}(w)\,dw.\end{aligned}\end{multlined}p(t\,|\,x,X_{tr%
},T_{tr})=\int p(t\,|\,x,w)p(w\,|\,X_{tr},T_{tr})\,dw=\\
\begin{aligned} &=\int p(t\,|\,x,w)\int p(w,\alpha\,|\,X_{tr},T_{tr})\,d\alpha%
\,dw\approx\\
&\approx\int p(t\,|\,x,w)\int q_{\phi}(w,\alpha)d\alpha\,dw=\\
&=\int p(t\,|\,x,w)q_{\phi}(w)\,dw.\end{aligned}
\mathcal{L}^{joint}(\phi)=\mathbb{E}_{q_{\phi}(w,\alpha)}\log\frac{p(t\,|\,x,w%
)p(w\,|\,\alpha)p(\alpha)}{q_{\phi}(w,\alpha)}.
q_{\phi}(w,\alpha)
q_{\phi}(w)
p(w)=\int p(w\,|\,\alpha)p(\alpha)\,d\alpha
q_{\phi}(w)=\int q_{\phi}(w\,|\,\alpha)q_{\phi}(\alpha)\,d\alpha
\mathcal{L}^{marginal}(\phi)=\mathbb{E}_{q_{\phi}(w)}\log\frac{p(t\,|\,x,w)p(w%
)}{q_{\phi}(w)}.
\phi_{j}
\phi_{m}
\mathcal{L}^{joint}
\mathcal{L}^{marginal}
{\mathrm{KL}}(q_{\phi_{m}}(w)\,\|\,p(w\,|\,X_{tr},T_{tr}))\leq\\
{\mathrm{KL}}(\,q_{\phi_{j}}(w)\,\,\|\,p(w\,|\,X_{tr},T_{tr})).
\alpha
\mathcal{L}^{marginal}
p(w_{ij}\,|\,\alpha_{ij})=\mathcal{N}(w_{ij}\,|\,0,\alpha_{ij}^{-1})
p(\alpha_{ij})=\mathrm{Gamma}(\alpha_{ij}\,|\,0.5,2)
p(w_{ij})=t(w_{ij}\,|\,\nu=1)
10^{-3}
q_{\phi}(w,\alpha)=q_{\phi}(w)q_{\phi}(\alpha)
q_{\phi}(w)
q_{\phi}(\alpha)
q_{\phi}(w)
\mathcal{L}^{marginal}
K=10
97.7-98.0\%
-830
-855
p(z)
q_{\phi}(z)
p(z)=\int\mathcal{N}(z\,|\,0,\alpha^{-1})\mathrm{Gamma}(\alpha\,|\,0.5,2)\,d\alpha
q_{\phi}(z)=\int\mathcal{N}(z\,|\,\mu,\tau)\mathrm{Exp}(\tau\,|\,\lambda)\,d\tau
{\mathrm{KL}}(q_{\phi}(z)\,\|\,p(z))
\mu
\lambda
q_{\phi}(z)
\alpha=0.2
\lambda=0.001
\phi
10^{-2}
\phi
KL(q_{\phi}(z)\,\|\,p(z))
K
\phi
\phi
p(z)
q_{\phi_{1}}(z)=\mathbb{E}_{q_{\phi_{1}}(\psi)}[q_{\phi_{1}}(z\,|\,\psi)]
p(z)
\phi_{1}
{\mathrm{KL}}(q_{\phi_{1}}(z)\,\|\,p(z))
q_{\phi_{1}}(z)
z
\phi_{2}
{\mathrm{KL}}(q_{\phi_{2}}(z)\,\|\,q_{\phi_{1}}(z))
k
q_{\phi_{k}}(z)
{\mathrm{KL}}(q_{\phi_{k}}(z)\,\|\,q_{\phi_{k-1}}(z))
p(z)
q_{\phi_{i}}(\psi)
q_{\phi_{i}}(z\,|\,\psi)=\mathcal{N}(z\,|\,\psi,\sigma^{2}I)
\sigma^{2}=0.1
p(z)
{\mathrm{KL}}(q_{\phi_{i}}(z)\,\|\,p(z))
i=1,\dotsc,9
K_{1}=K_{2}=K
p(z)
q_{\phi_{k}}(z)
K
{\mathrm{KL}}(q_{\phi_{i}}(z)\,\|\,p(z))
K_{1}=K_{2}=K
K=10^{4}
p(z)
{\mathrm{KL}}(q_{\phi_{i}}(z)\,\|\,p(z))
K_{1}=K_{2}=K
K=10^{4}
p(z)
q_{\phi_{k}}(z)
K_{1}=K_{2}=100
1000
p(z)
K=10^{4}
q_{\phi_{k}}(z)
K_{1}=K_{2}=100
1000
p(z)
K=10^{4}
z
z_{1}
z_{2}
K=20000
\mathcal{L}^{S}
\underline{\mathcal{L}}_{K}^{p,S}
\mathcal{L}^{S}
\underline{\mathcal{L}}_{K}^{p,S}
-85.05
-82.38
\geq-82.27
\geq-83.02
\geq\mathbf{-82.16}
-81.71
-81.24
\geq\mathbf{-81.09}
p(z\,|\,\zeta)=\mathcal{N}(z\,|\,\zeta,\mathrm{diag}(\sigma^{2}))
\zeta
\epsilon
\zeta
\beta
\mathcal{L}
\underline{\mathcal{L}}_{K}^{q}
\underline{\mathcal{L}}_{K}^{q}
\mathcal{L}
K\to~{}\infty
\underline{\mathcal{L}}_{K}^{q}\leq\underline{\mathcal{L}}_{K+1}^{q}\leq%
\mathcal{L}
\displaystyle\underline{\mathcal{L}}_{K}^{q}=\mathbb{E}_{\psi^{0..K}\sim q_{%
\phi}(\psi)}\mathbb{E}_{q_{\phi}^{K}(z\,|\,\psi^{0..K})}\log{\frac{p(x\,|\,z)p%
(z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}},
\displaystyle\underline{\mathcal{L}}_{K}^{q}=\mathbb{E}_{\psi^{0..K}\sim q_{%
\phi}(\psi)}\mathbb{E}_{q_{\phi}^{K}(z\,|\,\psi^{0..K})}\log{\frac{p(x\,|\,z)p%
(z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}},
\displaystyle\text{where }q_{\phi}^{K}(z\,|\,\psi^{0..K})=\frac{1}{K+1}\sum_{k%
=0}^{K}q_{\phi}(z\,|\,\psi^{k}).
\displaystyle\text{where }q_{\phi}^{K}(z\,|\,\psi^{0..K})=\frac{1}{K+1}\sum_{k%
=0}^{K}q_{\phi}(z\,|\,\psi^{k}).
\mathbb{E}_{\psi^{0..K}\sim q_{\phi}(\psi)}
\mathbb{E}_{\psi^{0..K}}
\mathbb{E}_{z\sim q_{\phi}^{K}(z\,|\,\psi^{0..K})}
\mathbb{E}_{z\,|\,\psi^{0..K}}
\underline{\mathcal{L}}_{K}^{q}
q_{\phi}(z\,|\,\psi^{i})
\displaystyle\underline{\mathcal{L}}_{K}^{q}=\mathbb{E}_{\psi^{0..K}}\mathbb{E%
}_{z\,|\,\psi^{0}}\log\frac{p(x,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}=
\displaystyle\underline{\mathcal{L}}_{K}^{q}
\displaystyle=\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z\,|\,\psi^{0}}\log\frac{p(x%
,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}=
\displaystyle=\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z\,|\,\psi^{i}}\log\frac{p(x%
,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}.
\displaystyle=\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z\,|\,\psi^{i}}\log\frac{p(x%
,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}.
\underline{\mathcal{L}}_{K}^{q}
\displaystyle\underline{\mathcal{L}}_{K}^{q}=\frac{1}{K+1}\sum_{i=0}^{K}%
\underline{\mathcal{L}}_{K}^{q}=
\displaystyle\underline{\mathcal{L}}_{K}^{q}=\frac{1}{K+1}\sum_{i=0}^{K}%
\underline{\mathcal{L}}_{K}^{q}=
\displaystyle=\frac{1}{K+1}\sum_{i=0}^{K}\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z%
\,|\,\psi^{i}}\log\frac{p(x,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}=
\displaystyle=\frac{1}{K+1}\sum_{i=0}^{K}\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z%
\,|\,\psi^{i}}\log\frac{p(x,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}=
\displaystyle=\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log\frac{%
p(x,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}.
\displaystyle=\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log\frac{%
p(x,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}.
q_{\phi}^{K}(z\,|\,\psi^{0..K})
\psi^{0..K}
\mathbb{E}_{\psi^{0..K}}q_{\phi}^{K}(z\,|\,\psi^{0..K})=q_{\phi}(z)
\displaystyle\mathcal{L}=\mathbb{E}_{q_{\phi}(z)}\log\frac{p(x,z)}{q_{\phi}(z)}=
\displaystyle\mathcal{L}=\mathbb{E}_{q_{\phi}(z)}\log\frac{p(x,z)}{q_{\phi}(z)}=
\displaystyle=\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log\frac{%
p(x,z)}{q_{\phi}(z)}.
\displaystyle=\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log\frac{%
p(x,z)}{q_{\phi}(z)}.
\mathcal{L}\geq\underline{\mathcal{L}}_{K}^{q}
\mathcal{L}-\underline{\mathcal{L}}_{K}^{q}
\displaystyle\mathcal{L}-\underline{\mathcal{L}}_{K}^{q}=
\displaystyle\mathcal{L}-\underline{\mathcal{L}}_{K}^{q}=
\displaystyle=\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log\frac{%
q_{\phi}^{K}(z\,|\,\psi^{0..K})}{q_{\phi}(z)}=
\displaystyle=\mathbb{E}_{\psi^{0..K}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log\frac{%
q_{\phi}^{K}(z\,|\,\psi^{0..K})}{q_{\phi}(z)}=
\displaystyle=\mathbb{E}_{\psi^{0..K}}{\mathrm{KL}}\left(q_{\phi}^{K}(z\,|\,%
\psi^{0..K})\,\|\,q_{\phi}(z)\right)\geq 0.
\displaystyle=\mathbb{E}_{\psi^{0..K}}{\mathrm{KL}}\left(q_{\phi}^{K}(z\,|\,%
\psi^{0..K})\,\|\,q_{\phi}(z)\right)\geq 0.
K
\underline{\mathcal{L}}_{K}^{q}
\underline{\mathcal{L}}_{K+1}^{q}
\displaystyle\underline{\mathcal{L}}_{K}^{q}=\mathbb{E}_{\psi^{0..K}}\mathbb{E%
}_{z\,|\,\psi^{0..K}}\log\frac{p(x,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}=
\displaystyle\underline{\mathcal{L}}_{K}^{q}=\mathbb{E}_{\psi^{0..K}}\mathbb{E%
}_{z\,|\,\psi^{0..K}}\log\frac{p(x,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})}=
\displaystyle=\mathbb{E}_{\psi^{0..K+1}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log%
\frac{p(x,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})},
\displaystyle=\mathbb{E}_{\psi^{0..K+1}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log%
\frac{p(x,z)}{q_{\phi}^{K}(z\,|\,\psi^{0..K})},
\displaystyle\underline{\mathcal{L}}_{K+1}^{q}=\mathbb{E}_{\psi^{0..K+1}}%
\mathbb{E}_{z\,|\,\psi^{0}}\log\frac{p(x,z)}{q_{\phi}^{K+1}(z\,|\,\psi^{0..K+1%
})}=
\displaystyle\underline{\mathcal{L}}_{K+1}^{q}=\mathbb{E}_{\psi^{0..K+1}}%
\mathbb{E}_{z\,|\,\psi^{0}}\log\frac{p(x,z)}{q_{\phi}^{K+1}(z\,|\,\psi^{0..K+1%
})}=
\displaystyle=\mathbb{E}_{\psi^{0..K+1}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log%
\frac{p(x,z)}{q_{\phi}^{K+1}(z\,|\,\psi^{0..K+1})}.
\displaystyle=\mathbb{E}_{\psi^{0..K+1}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log%
\frac{p(x,z)}{q_{\phi}^{K+1}(z\,|\,\psi^{0..K+1})}.
\displaystyle\underline{\mathcal{L}}_{K+1}^{q}-\underline{\mathcal{L}}_{K}^{q}=
\displaystyle\underline{\mathcal{L}}_{K+1}^{q}-\underline{\mathcal{L}}_{K}^{q}=
\displaystyle=\mathbb{E}_{\psi^{0..K+1}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log%
\frac{q_{\phi}^{K}(z\,|\,\psi^{0..K})}{q_{\phi}^{K+1}(z\,|\,\psi^{0..K+1})}=
\displaystyle=\mathbb{E}_{\psi^{0..K+1}}\mathbb{E}_{z\,|\,\psi^{0..K}}\log%
\frac{q_{\phi}^{K}(z\,|\,\psi^{0..K})}{q_{\phi}^{K+1}(z\,|\,\psi^{0..K+1})}=
\displaystyle=\mathbb{E}_{\psi^{0..K+1}}{\mathrm{KL}}\left(q_{\phi}^{K}(z\,|\,%
\psi^{0..K})\,\|\,q_{\phi}^{K+1}(z\,|\,\psi^{0..K+1}))\right)
\displaystyle=\mathbb{E}_{\psi^{0..K+1}}{\mathrm{KL}}\left(q_{\phi}^{K}(z\,|\,%
\psi^{0..K})\,\|\,q_{\phi}^{K+1}(z\,|\,\psi^{0..K+1}))\right)
\displaystyle\geq 0.
\displaystyle\geq 0.
\log p(x)\geq\mathcal{L}^{S}=\mathbb{E}_{z^{1..S}\sim q_{\phi}(z)}\log\frac{1}%
{S}\sum_{i=1}^{S}\frac{p(x\,|\,z^{i})p(z^{i})}{q_{\phi}(z_{i}\,|\,x)}
\displaystyle\begin{multlined}\underline{\underline{\mathcal{L}}}_{K_{1},K_{2}%
}^{q,p,S}=\mathbb{E}_{\psi^{1..K_{1}}\sim q_{\phi}(\psi)}\mathbb{E}_{\zeta^{1.%
.K_{2}}\sim p_{\theta}(\zeta)}\left[\phantom{\frac{1}{S}}\right.\\
\mathbb{E}_{(z^{1},\hat{\psi}^{1}),\dots,(z^{S},\hat{\psi}^{S})\sim q_{\phi}(z%
,\psi)}\left[\phantom{\frac{1}{S}}\right.\\
\left.\left.\log\frac{1}{S}\sum_{i=1}^{S}\frac{p(x\,|\,z^{i})\frac{1}{K_{2}}%
\sum_{k=1}^{K_{2}}p_{\theta}(z^{i}\,|\,\zeta^{k})}{\frac{1}{K_{1}+1}(q_{\phi}(%
z^{i}\,|\,\hat{\psi}^{i})+\sum_{k=1}^{K_{1}}q_{\phi}(z^{i}\,|\,\psi^{k}))}%
\right]\right].\end{multlined}\underline{\underline{\mathcal{L}}}_{K_{1},K_{2}%
}^{q,p,S}=\mathbb{E}_{\psi^{1..K_{1}}\sim q_{\phi}(\psi)}\mathbb{E}_{\zeta^{1.%
.K_{2}}\sim p_{\theta}(\zeta)}\left[\phantom{\frac{1}{S}}\right.\\
\mathbb{E}_{(z^{1},\hat{\psi}^{1}),\dots,(z^{S},\hat{\psi}^{S})\sim q_{\phi}(z%
,\psi)}\left[\phantom{\frac{1}{S}}\right.\\
\left.\left.\log\frac{1}{S}\sum_{i=1}^{S}\frac{p(x\,|\,z^{i})\frac{1}{K_{2}}%
\sum_{k=1}^{K_{2}}p_{\theta}(z^{i}\,|\,\zeta^{k})}{\frac{1}{K_{1}+1}(q_{\phi}(%
z^{i}\,|\,\hat{\psi}^{i})+\sum_{k=1}^{K_{1}}q_{\phi}(z^{i}\,|\,\psi^{k}))}%
\right]\right].
\underline{\underline{\mathcal{L}}}_{K_{1},K_{2}}^{q,p,S}\leq\mathcal{L}^{S}
K_{1}
K_{2}
\underline{\underline{\mathcal{L}}}_{\infty,\infty}^{q,p,S}=\mathcal{L}^{S}
\mathcal{L}^{joint}
\mathcal{L}^{marginal}
\displaystyle\mathcal{L}^{joint}(\phi)=\mathbb{E}_{q_{\phi}(w,\alpha)}\log%
\frac{p(t\,|\,x,w)p(w\,|\,\alpha)p(\alpha)}{q_{\phi}(w,\alpha)}
\displaystyle\mathcal{L}^{joint}(\phi)=\mathbb{E}_{q_{\phi}(w,\alpha)}\log%
\frac{p(t\,|\,x,w)p(w\,|\,\alpha)p(\alpha)}{q_{\phi}(w,\alpha)}
\displaystyle\mathcal{L}^{marginal}(\phi)=\mathbb{E}_{q_{\phi}(w)}\log\frac{p(%
t\,|\,x,w)p(w)}{q_{\phi}(w)}
\displaystyle\mathcal{L}^{marginal}(\phi)=\mathbb{E}_{q_{\phi}(w)}\log\frac{p(%
t\,|\,x,w)p(w)}{q_{\phi}(w)}
\phi_{j}
\phi_{m}
\mathcal{L}^{joint}
\mathcal{L}^{marginal}
q_{\phi_{m}}(w)
q_{\phi_{j}}(w)
{\mathrm{KL}}(q_{\phi_{m}}(w)\,\|\,p(w\,|\,X_{tr},T_{tr}))\leq\\
{\mathrm{KL}}(\,q_{\phi_{j}}(w)\,\,\|\,p(w\,|\,X_{tr},T_{tr}))
\mathcal{L}^{marginal}(\phi)
{\mathrm{KL}}(q_{\phi}(w)\,\|\,p(w\,|\,X_{tr},T_{tr}))
\mathcal{L}^{marginal}(\phi)+{\mathrm{KL}}(q_{\phi}(w)\,\|\,p(w\,|\,X_{tr},T_{%
tr}))=const
\mathcal{L}^{marginal}(\phi_{m})\geq\mathcal{L}^{marginal}(\phi_{j})
\mathcal{L}^{joint}(\phi)
\displaystyle\mathcal{L}^{joint}(\phi)=\mathbb{E}_{q_{\phi}(w,\alpha)}\log%
\frac{p(t\,|\,x,w)p(w\,|\,\alpha)p(\alpha)}{q_{\phi}(w,\alpha)}=
\displaystyle\mathcal{L}^{joint}(\phi)=\mathbb{E}_{q_{\phi}(w,\alpha)}\log%
\frac{p(t\,|\,x,w)p(w\,|\,\alpha)p(\alpha)}{q_{\phi}(w,\alpha)}=
\displaystyle=\mathbb{E}_{q_{\phi}(w)}\log p(t\,|\,x,w)-{\mathrm{KL}}(q_{\phi}%
(w,\alpha)\,\|\,p(w,\alpha))=
\displaystyle=\mathbb{E}_{q_{\phi}(w)}\log p(t\,|\,x,w)-{\mathrm{KL}}(q_{\phi}%
(w,\alpha)\,\|\,p(w,\alpha))=
\displaystyle=\mathbb{E}_{q_{\phi}(w)}\log p(t\,|\,x,w)-{\mathrm{KL}}(q_{\phi}%
(w)\,\|\,p(w))-
\displaystyle=\mathbb{E}_{q_{\phi}(w)}\log p(t\,|\,x,w)-{\mathrm{KL}}(q_{\phi}%
(w)\,\|\,p(w))-
\displaystyle-\mathbb{E}_{q_{\phi}(w)}{\mathrm{KL}}(q_{\phi}(\alpha\,|\,w)\,\|%
\,p(\alpha\,|\,w))=
\displaystyle-\mathbb{E}_{q_{\phi}(w)}{\mathrm{KL}}(q_{\phi}(\alpha\,|\,w)\,\|%
\,p(\alpha\,|\,w))=
\displaystyle=\mathcal{L}^{marginal}(\phi)-\mathbb{E}_{q_{\phi}(w)}{\mathrm{KL%
}}(q_{\phi}(\alpha\,|\,w)\,\|\,p(\alpha\,|\,w))
\displaystyle=\mathcal{L}^{marginal}(\phi)-\mathbb{E}_{q_{\phi}(w)}{\mathrm{KL%
}}(q_{\phi}(\alpha\,|\,w)\,\|\,p(\alpha\,|\,w))
\mathcal{L}^{joint}
\mathcal{L}^{marginal}
\mathcal{L}^{joint}
\mathcal{L}^{marginal}
q_{\phi}(\alpha\,|\,w)
p(\alpha\,|\,w)
q_{\phi}(w,\alpha)=q_{\phi}(w)q_{\phi}(\alpha)
q_{\phi}(w)
p_{\phi}(w)
q_{\phi}(w)
q_{\phi}(w)
p_{\phi}(w)
q_{\phi}(w)
\mathbf{-1.42\times 10^{5}}
7.2\times 10^{3}
1.35\times 10^{5}
97.80
855
-1.48\times 10^{5}
6.7\times 10^{3}
1.42\times 10^{5}
97.74
831
-1.47\times 10^{5}
7.0\times 10^{3}
1.41\times 10^{5}
97.75
846
\mathbf{-1.42\times 10^{5}}
7.2\times 10^{3}
1.35\times 10^{5}
97.76
843
p(z)=0.3\mathcal{N}(z\,|\,{-2},1)+0.7\mathcal{N}(z\,|\,2,1)
p(z_{1},z_{2})=\mathcal{N}(z_{1}\,|\,z_{2}^{2}/4,1)\mathcal{N}(z_{2}\,|\,0,4)
10^{-2}
0.5
10^{5}
{\mathrm{KL}}(q_{\phi_{i}}(z)\,\|\,p(z))
K_{1}=K_{2}=K
K=10^{4}
p(z)
{\mathrm{KL}}(q_{\phi_{i}}(z)\,\|\,p(z))
K_{1}=K_{2}=K
K=10^{4}
p(z)
K=100
K=100
K=1000
K=1000
K=100
K=100
K=1000
K=1000
