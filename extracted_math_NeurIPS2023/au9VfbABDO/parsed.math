p(a|s)
p(s,a)
p(a|s)
a
s
p(s,a)
p(s,a)
a
\underset{a\in\mathcal{A}}{\arg\max}\ p(s,a)
p(a|s)
p(s,a)
\pi
M
D=\{\tau_{1},...,\tau_{M}\}
\tau_{i}
n_{i}
\{s^{i}_{1},a^{i}_{1},...,s^{i}_{n_{i}},a^{i}_{n_{i}}\}
p(a|s)
\pi
\pi^{E}
(s,a)
D
\mathop{max}\limits_{\theta}\sum\limits_{(s,a)\in D}\log(\pi_{\theta}(a|s))
\theta
\pi
p(a|s)
a
s
p(s,a)
p(s,a)
\arg\max_{a\in\mathcal{A}}\ p(s,a)
p(a|s)
p(s,a)
\phi
p(a|s)
\phi
x_{1},...,x_{N}
x_{0}
\phi
x_{0}
x_{1},...,x_{N}
x_{0}
\phi
x_{0}
p(a|s)
p(s,a)
\phi
D
\mathcal{L}_{\text{diff}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
(s,a)
(s,\hat{a})
\hat{a}
\pi
\mathcal{L}_{\text{diff}}
\phi
D
\mathcal{L}_{\text{diff}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
(s,a)
(s,\hat{a})
\hat{a}
\pi
\mathcal{L}_{\text{diff}}
p(a|s)
\pi(a|s)
\mathcal{L}_{\text{BC}}=\mathbb{E}_{(s,a)\sim D,\hat{a}\sim\pi(s)}[d(a,\hat{a}%
)],
d(\cdot,\cdot)
{||a-\hat{a}||}^{2}
p(a|s)
p(s,a)
\phi
s
a
(s,a)
\epsilon(n)
n
N
\phi
\displaystyle\mathcal{L}_{\text{diff}}(s,a,\phi)=\mathbb{E}_{n\sim N,(s,a)\sim
D%
}\left[{||\hat{\epsilon}(s,a,n)-\epsilon(n)||}^{2}\right]
\displaystyle\mathcal{L}_{\text{diff}}(s,a,\phi)=\mathbb{E}_{n\sim N,(s,a)\sim
D%
}\left[{||\hat{\epsilon}(s,a,n)-\epsilon(n)||}^{2}\right]
\displaystyle=\mathbb{E}_{n\sim N,(s,a)\sim D}\left[{||\phi(s,a,\epsilon(n))-%
\epsilon(n)||}^{2}\right],
\displaystyle=\mathbb{E}_{n\sim N,(s,a)\sim D}\left[{||\phi(s,a,\epsilon(n))-%
\epsilon(n)||}^{2}\right]
\hat{\epsilon}
\phi
\mathcal{L}_{\text{diff}}(s,a,\phi)
(s,a)
\phi
\phi
\mathcal{L}_{\text{diff}}(s,a,\phi)
(s,a)
\pi
\hat{a}
\pi
\mathcal{L}_{\text{diff}}^{\text{agent}}=\mathcal{L}_{\text{diff}}(s,\hat{a},%
\phi)=\mathbb{E}_{s\sim D,\hat{a}\sim\pi(s)}\left[{||\hat{\epsilon}(s,\hat{a},%
n)-\epsilon||}^{2}\right].
\pi
\hat{a}
a
\epsilon
\mathcal{G}(0,1)
n
\mathcal{U}(0,N)
\mathcal{L}_{\text{diff}}
\mathcal{L}_{\text{diff}}^{\text{agent}}
\mathcal{L}_{\text{diff}}^{\text{expert}}
(s,a)
\mathcal{L}_{\text{diff}}^{\text{expert}}=\mathcal{L}_{\text{diff}}(s,a,\phi)=%
\mathbb{E}_{(s,a)\sim D}\left[{||\hat{\epsilon}(s,a,n)-\epsilon||}^{2}\right].
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{DM}}=\mathbb{E}_{(s,a)\sim D,\hat{a}\sim\pi(s)}\left[max%
\left(\mathcal{L}_{\text{diff}}^{\text{agent}}-\mathcal{L}_{\text{diff}}^{%
\text{expert}},0\right)\right].
L_{\text{BC}}
L_{\text{BC}}
L_{\text{DM}}
\mathcal{L}_{\text{total}}=\mathcal{L}_{\text{BC}}+\lambda\mathcal{L}_{\text{%
DM}},
\lambda
x
y
p(a|s)
\mathcal{L}_{\text{BC}}
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\uparrow
p(a|s)
\lambda
0.1
26.1\%
1
2
27.0\%
71.6\%
1
35.3\%
2
\pi_{BC}
\pi_{DM}
\pi_{DBC}
\pi_{BC}
\pi_{DBC}
\pi_{DM}
\pi_{BC}
\pi_{DM}
\pi_{DBC}
\pi_{BC}
\pi_{DBC}
\pi_{DM}
(0.5,0)
(0,0.5)
(-0.7,0)
(0,-0.7)
\pi_{BC}
\pi_{DM}
\pi_{DBC}
\pi_{DM}
\pi_{BC}
\pi_{DBC}
p(a|s)
p(s,a)
p(a|s)
p(s,a)
\phi
D
\mathcal{L}_{\text{diff}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
(s,a)
(s,\hat{a})
\hat{a}
\pi
\mathcal{L}_{\text{diff}}
D
\pi
\phi
\phi
(s,a)
D
n
\{0,...,N\}
\phi
L_{\text{diff}}
\pi
\phi
\pi
(s,a)
D
\hat{a}
\pi
s
\hat{a}\sim\pi(s)
L_{\text{BC}}
n
\{0,...,N\}
L_{\text{diff}}^{\text{agent}}
(s,\hat{a})
L_{\text{diff}}^{\text{expert}}
(s,a)
L_{\text{DM}}
\pi
L_{\text{total}}
\pi
5
1826
96\times 96
64\times 64
766.4
26.3
791.5
27.7
(s,\hat{a})
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\lambda
\lambda
\lambda=0.5
97.5\%
\lambda
\lambda
91.7\%
51.46\%
\lambda
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\lambda
L_{\text{BC}}
L_{\text{DM}}
\lambda
\lambda
\lambda
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{diff}}^{\text{expert}}
\mathcal{L}_{\text{diff}}^{\text{agent}}
\mathcal{L}_{\text{DM}}
94\%
95\%
\mathcal{L}_{\text{diff}}^{\text{expert}}
\mathcal{L}_{\text{DM}}
\lambda
L_{DM}
\lambda
\lambda
L_{DM}
\lambda
\mathcal{L}_{\text{diff}}^{\text{agent}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{diff}}^{\text{agent}}
\mathcal{L}_{\text{DM}}
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\pi=\pi^{E}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
L_{BC}
L_{DM}
\pi_{BC}
\pi_{DM}
\pi_{DBC}
\pi_{BC}
\pi_{DM}
\pi_{DBC}
\pi
\pi^{E}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\pi_{BC}
\pi_{DM}
\pi_{DBC}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\pi_{BC}
\pi_{DM}
\pi_{DBC}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\pi^{E}
\hat{\pi}=-\mathbb{E}_{s\sim\rho_{\pi^{E^{\prime}}},a\sim\pi^{E}}[log(\pi(a|s))]
\sigma
\Sigma^{m}_{i=1}-\log p(y_{i}|x_{i};\Theta)=m\log\sigma+{\frac{m}{2}}\log(2\pi%
)+\Sigma^{m}_{i=1}{\frac{||\hat{y}_{i}-y_{i}||^{2}}{2{\sigma}^{2}}},
x_{i}
y_{i}
\hat{y}_{i}
\Theta
m
\mathcal{L}_{\text{BC}}
\mathbb{E}_{(s,a)\sim D}[-\log\rho_{\pi^{E}}(s,a)]
\mathcal{L}_{\text{diff}}^{\text{agent}}
s
D
\hat{a}
\pi
\rho_{\pi^{E^{\prime}}}
\displaystyle\mathbb{E}_{s\sim D,\hat{a}\sim\pi}[-\log\rho_{\pi^{E^{\prime}}}(%
s,\hat{a})]
\displaystyle\mathbb{E}_{s\sim D,\hat{a}\sim\pi}[-\log\rho_{\pi^{E^{\prime}}}(%
s,\hat{a})]
\displaystyle=\iint[-\rho_{\pi}(s,\hat{a})\log\rho_{\pi^{E^{\prime}}}(s,\hat{a%
})]\,ds\,d\hat{a}
\displaystyle=\iint[-\rho_{\pi}(s,\hat{a})\log\rho_{\pi^{E^{\prime}}}(s,\hat{a%
})]\,ds\,d\hat{a}
\displaystyle=\iint[-\rho_{\pi}(s,\hat{a})\log\rho_{\pi^{E^{\prime}}}(s,\hat{a%
})+\rho_{\pi}(s,\hat{a})\log\rho_{\pi}(s,\hat{a})-\rho_{\pi}(s,\hat{a})\log%
\rho_{\pi}(s,\hat{a})]\,ds\,d\hat{a}
\displaystyle=\iint[-\rho_{\pi}(s,\hat{a})\log\rho_{\pi^{E^{\prime}}}(s,\hat{a%
})+\rho_{\pi}(s,\hat{a})\log\rho_{\pi}(s,\hat{a})-\rho_{\pi}(s,\hat{a})\log%
\rho_{\pi}(s,\hat{a})]\,ds\,d\hat{a}
\displaystyle=\iint\rho_{\pi}(s,\hat{a})[\log\rho_{\pi}(s,\hat{a})-\log\rho_{%
\pi^{E^{\prime}}}(s,\hat{a})]\,ds\,d\hat{a}+\iint-\rho_{\pi}(s,\hat{a})\log%
\rho_{\pi}(s,\hat{a})\,ds\,d\hat{a}
\displaystyle=\iint\rho_{\pi}(s,\hat{a})[\log\rho_{\pi}(s,\hat{a})-\log\rho_{%
\pi^{E^{\prime}}}(s,\hat{a})]\,ds\,d\hat{a}+\iint-\rho_{\pi}(s,\hat{a})\log%
\rho_{\pi}(s,\hat{a})\,ds\,d\hat{a}
\displaystyle=\mathrm{D_{RKL}}(\rho_{\pi^{E^{\prime}}}(s,\hat{a}),\rho_{\pi}(s%
,\hat{a}))+\mathcal{H}(\rho_{\pi})
\displaystyle=\mathrm{D_{RKL}}(\rho_{\pi^{E^{\prime}}}(s,\hat{a}),\rho_{\pi}(s%
,\hat{a}))+\mathcal{H}(\rho_{\pi})
\displaystyle\geq\mathrm{D_{RKL}}(\rho_{\pi^{E^{\prime}}}(s,\hat{a}),\rho_{\pi%
}(s,\hat{a})),
\displaystyle\geq\mathrm{D_{RKL}}(\rho_{\pi^{E^{\prime}}}(s,\hat{a}),\rho_{\pi%
}(s,\hat{a})),
\rho_{\pi^{E^{\prime}}}
\rho_{\pi}
\mathcal{H}(\rho_{\pi})
\rho_{\pi}
\mathrm{D_{RKL}}(\rho_{\pi^{E^{\prime}}},\rho_{\pi})
\rho_{\pi^{E^{\prime}}}
\rho_{\pi}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\mathcal{L}_{\text{DM}}
\pi_{\text{DM-0.01}}
\pi_{\text{BC}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{DM}}
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
100
400
100
18,525
100
50
303
10k
[-\frac{\pi}{12},\frac{\pi}{12}]
[\frac{\pi}{3},\frac{2\pi}{3}]
100
50
10M
t
R(s_{t},a_{t})=d_{t}-d_{t+1}
d_{t}
d_{t+1}
515
10k
30
5
5k
30
1000
5
5k
100
50
\pi
\pi
\pi
\phi
\pi
2
5
0.2
5
8
1
128
5
128
8
128
128
8
6
2
(s,a)
(s,\hat{a})
8
256
\lambda
\hat{a}
s
\hat{a}\sim\pi(s)
\hat{a}
s
N_{s}
N_{s}
N_{s}
N_{iter}
\hat{a}
N_{s}
1000
N_{iter}
3
\pi
\mathcal{N}(0,1)
s
\hat{a}
a_{n-1}=\frac{1}{\sqrt{\alpha_{n}}}(a_{n}-\frac{1-\alpha_{n}}{\sqrt{1-\bar{%
\alpha}_{n}}}\pi(s,a_{n},n))+\sigma_{n}z,
\alpha_{n}
\bar{\alpha}_{n}
\sigma_{n}
n
z\sim\mathcal{N}(0,1)
N
a_{0}
a_{N}\sim\mathcal{N}(0,1)
N
1000
3
256
2000
(s,a)
(s,a)
N_{neg}
E_{\phi}
\mathcal{L}_{\text{InfoNCE}}=\frac{e^{-E_{\phi}(s,a)}}{e^{-E_{\phi}(s,a)}+%
\Sigma_{i=1}^{N_{neg}}e^{-E_{\phi}(s,\tilde{a}_{i})}},
(s,a)
\tilde{a}_{i}
N_{neg}
64
8000
128
0.0005
0.99
100
\pi
\mathcal{L}_{\text{EBM}}=E_{\phi}(s,\hat{a})
\hat{a}
(s,\hat{a})
\mathcal{L}_{\text{EBM}}
49.09\%
\mathcal{L}_{\text{EBM}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{BC}}+\lambda_{\text{EBM}}\mathcal{L}_{\text{EBM}}
\lambda_{\text{EBM}}
0.1
80.00\%
(s,a)
\mathcal{L}_{\text{vae}}={||\hat{x}-x||}^{2}+D_{\text{KL}}(\mathcal{N}(\mu_{x}%
,\sigma_{x})||\mathcal{N}(0,1)),
x
x=[s,a]
\hat{x}
x
\mathcal{N}(0,1)
\mu_{x}
\sigma_{x}
x
100k
128
0.0001
0.5
5k
\pi
\mathcal{L}_{\text{VAE}}=max(\mathcal{L}_{\text{vae}}^{\text{agent}}-\mathcal{%
L}_{\text{vae}}^{\text{expert}},0)
\mathcal{L}_{\text{VAE}}
48.47\%
\mathcal{L}_{\text{VAE}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{BC}}+\lambda_{\text{VAE}}\mathcal{L}_{\text{VAE}}
\lambda_{\text{VAE}}
1
82.31\%
\hat{a}
s
(s,a)
(s,\hat{a})
\pi
\pi
D
D
\mathcal{L}_{\text{disc}}=BCE(D(s,a),1)+BCE(D(s,\hat{a}),0)=-log(D(s,a))-log(1%
-D(s,\hat{a})),
\hat{a}=\pi(s)
BCE
(0,1)
0.00005
\mathcal{L}_{\text{GAN}}=BCE(D(s,\hat{a}),1)=-log(D(s,\hat{a})).
\mathcal{L}_{\text{GAN}}
50.29\%
\mathcal{L}_{\text{GAN}}
\mathcal{L}_{\text{BC}}
\mathcal{L}_{\text{BC}}+\lambda_{\text{GAN}}\mathcal{L}_{\text{GAN}}
\lambda_{\text{GAN}}
0.2
71.64\%
q_{x}
x_{0}
(s,a)
q(x_{n}|x_{n-1})
n=1,...,N
x_{N}
\phi(x_{n-1}|x_{n}):=\mathcal{N}(x_{n-1};\mu_{\theta}(x_{n},n),\Sigma_{\theta}%
(x_{n},n))
\theta
\phi
\mathcal{L}_{\text{DM}}
(s,\hat{a})
\mathcal{L}_{\text{DM}}
\pi
\pi^{E}
p(x)
x
D_{KL}(q(x_{n-1}|x_{n},x_{0})||\phi(x_{n-1}|x_{n}))
(s,\hat{a})
q(x_{n-1}|x_{n},x_{0})
\displaystyle q(x_{n-1}|x_{n},x_{0})\sim\mathcal{N}(x_{n-1};\underbrace{\frac{%
\sqrt{\alpha_{n}}(1-\bar{\alpha}_{n-1})x_{n}+\sqrt{\bar{\alpha}_{n-1}}(1-%
\alpha_{n})x_{0}}{1-\bar{\alpha_{n}}}}{\mu_{q}(x_{n},x_{0})},
\displaystyle q(x_{n-1}|x_{n},x_{0})\sim\mathcal{N}(x_{n-1};
\displaystyle\underbrace{\frac{\sqrt{\alpha_{n}}(1-\bar{\alpha}_{n-1})x_{n}+%
\sqrt{\bar{\alpha}_{n-1}}(1-\alpha_{n})x_{0}}{1-\bar{\alpha_{n}}}}{\mu_{q}(x_{%
n},x_{0})},
\displaystyle\underbrace{\frac{(1-\alpha_{n})(1-\bar{\alpha}_{n-1})}{1-\bar{%
\alpha}_{n}}}{\Sigma_{q}(n)}).
\displaystyle\underbrace{\frac{(1-\alpha_{n})(1-\bar{\alpha}_{n-1})}{1-\bar{%
\alpha}_{n}}}{\Sigma_{q}(n)}).
\Sigma_{q}(n)
\sigma^{2}_{q}(n)I
\sigma^{2}_{q}(n)=\displaystyle\frac{(1-\alpha_{n})(1-\bar{\alpha}_{n-1})}{1-%
\bar{\alpha}_{n}}
\displaystyle\mathop{\arg\min}_{\theta}D_{KL}(q(x_{n-1}|x_{n},x_{0})||\phi(x_{%
n-1}|x_{n}))
\displaystyle\mathop{\arg\min}_{\theta}D_{KL}(q(x_{n-1}|x_{n},x_{0})||\phi(x_{%
n-1}|x_{n}))
\displaystyle=\mathop{\arg\min}_{\theta}D_{KL}(\mathcal{N}(x_{n-1};\mu_{q},%
\Sigma_{q}(n))||\mathcal{N}(x_{n-1};\mu_{\theta},\Sigma_{q}(n)))
\displaystyle=\mathop{\arg\min}_{\theta}D_{KL}(\mathcal{N}(x_{n-1};\mu_{q},%
\Sigma_{q}(n))||\mathcal{N}(x_{n-1};\mu_{\theta},\Sigma_{q}(n)))
\displaystyle=\mathop{\arg\min}_{\theta}\frac{1}{2\sigma^{2}_{q}(n)}[||\mu_{%
\theta}-\mu_{q}||^{2}_{2}],
\displaystyle=\mathop{\arg\min}_{\theta}\frac{1}{2\sigma^{2}_{q}(n)}[||\mu_{%
\theta}-\mu_{q}||^{2}_{2}],
\mu_{q}
\mu_{\theta}
\mu_{\theta}
\mu_{q}(x_{n},x_{0})
\displaystyle\mu_{q}(x_{n},x_{0})=\frac{1}{\sqrt{\alpha_{n}}}(x_{n}-\frac{1-%
\alpha_{n}}{\sqrt{1-\bar{\alpha}_{n}}}\epsilon_{0}),
\displaystyle\mu_{q}(x_{n},x_{0})=\frac{1}{\sqrt{\alpha_{n}}}(x_{n}-\frac{1-%
\alpha_{n}}{\sqrt{1-\bar{\alpha}_{n}}}\epsilon_{0}),
\mu_{\theta}
\displaystyle\mu_{\theta}(x_{n},n)=\frac{1}{\sqrt{\alpha_{n}}}(x_{n}-\frac{1-%
\alpha_{n}}{\sqrt{1-\bar{\alpha}_{n}}}\hat{\epsilon_{\theta}}(x_{n},n)),
\displaystyle\mu_{\theta}(x_{n},n)=\frac{1}{\sqrt{\alpha_{n}}}(x_{n}-\frac{1-%
\alpha_{n}}{\sqrt{1-\bar{\alpha}_{n}}}\hat{\epsilon_{\theta}}(x_{n},n)),
\nabla_{x}\log p_{t}(x)
\nabla_{x}\log p_{t}(x)
p(s,a)
x_{t}
\displaystyle\mathop{\arg\min}_{\theta}D_{KL}(q(x_{n-1}|x_{n},x_{0})||\phi(x_{%
n-1}|x_{n}))
\displaystyle\mathop{\arg\min}_{\theta}D_{KL}(q(x_{n-1}|x_{n},x_{0})||\phi(x_{%
n-1}|x_{n}))
\displaystyle=\mathop{\arg\min}_{\theta}\frac{1}{2\sigma^{2}_{q}(n)}\frac{(1-%
\alpha_{n})^{2}}{(1-\bar{\alpha}_{n})\alpha_{n}}[||\hat{\epsilon}_{\theta}(x_{%
n},n)-\epsilon_{0}||^{2}_{2}],
\displaystyle=\mathop{\arg\min}_{\theta}\frac{1}{2\sigma^{2}_{q}(n)}\frac{(1-%
\alpha_{n})^{2}}{(1-\bar{\alpha}_{n})\alpha_{n}}[||\hat{\epsilon}_{\theta}(x_{%
n},n)-\epsilon_{0}||^{2}_{2}],
\epsilon_{\theta}
\epsilon
x
\mathcal{L}_{\text{diff}}
\displaystyle\mathcal{L}_{\text{diff}}(s,a,\phi)=\mathbb{E}_{n\sim N,(s,a)\sim
D%
}\{{||\hat{\epsilon}(s,a,n)-\epsilon(n)||}^{2}\}
\displaystyle\mathcal{L}_{\text{diff}}(s,a,\phi)=\mathbb{E}_{n\sim N,(s,a)\sim
D%
}\{{||\hat{\epsilon}(s,a,n)-\epsilon(n)||}^{2}\}
\displaystyle=\mathbb{E}_{n\sim N,(s,a)\sim D}\{{||\phi(s,a,\epsilon(n))-%
\epsilon(n)||}^{2}\}.
\displaystyle=\mathbb{E}_{n\sim N,(s,a)\sim D}\{{||\phi(s,a,\epsilon(n))-%
\epsilon(n)||}^{2}\}.
\mathcal{L}_{\text{diff}}
\hat{a}
s
(s,a)
(s,a)
(s,\hat{a})
\mathcal{L}_{\text{diff}}^{\text{expert}}
\mathcal{L}_{\text{diff}}^{\text{agent}}
\mathcal{L}_{\text{DM}}=\mathbb{E}_{(s,a)\sim D,\hat{a}\sim\pi(s)}\{max(%
\mathcal{L}_{\text{diff}}^{\text{agent}}-\mathcal{L}_{\text{diff}}^{\text{%
expert}},0)\}.
