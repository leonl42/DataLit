z_{T}\sim\mathcal{N}(0,1)
T
\texttt{attn}(Q,K,V)=\texttt{softmax}(\frac{QK^{T}}{\sqrt{d}})V,
Q
K
V
d
z_{T}
z_{T}
P_{t}
z_{T}
P_{s}
t
l
\text{SA-S}^{l}_{\text{edit}}:=\begin{cases}\texttt{attn}(Q,K,V^{r}),&t>t_{0}%
\,\text{and}\,l>l_{0}\\
\texttt{attn}(Q,K,V),&\text{otherwise}\end{cases}
Q
K
V
V^{r}
t_{0}
l_{0}
P_{t}
t_{0}
l_{0}
z_{T}
P_{t}
\text{SA-T}^{l}_{\text{edit}}:=\begin{cases}\texttt{attn}(Q^{m},K^{m},V),&t>t_%
{1}\,\text{and}\,l>l_{1}\\
\texttt{attn}(Q,K,V),\quad&\text{otherwise}\end{cases}
Q^{m}
K^{m}
t_{1}
l_{1}
Q
K
V
Q
K
V
\text{SA-S}^{l}_{\text{edit}}:=\begin{cases}\texttt{attn}(Q^{r},K^{r},V),&t<t_%
{2}\,\text{and}\,l>l_{2},\\
\texttt{attn}(Q,K,V),\;&\text{otherwise},\end{cases}
Q^{r}
K^{r}
t_{2}
l_{2}
M
M
\texttt{m-attn}(Q,K,V;M)=\texttt{softmax}(\frac{QK^{T}}{\sqrt{d}}+M)V.
\displaystyle\text{SA}_{\text{mask}}:=\texttt{m-attn}(Q,K,V;M^{f})\odot M_{m}
\displaystyle\text{SA}_{\text{mask}}:=
\displaystyle\texttt{m-attn}(Q,K,V;M^{f})\odot M_{m}
\displaystyle+\texttt{m-attn}(Q,K,V;M^{b})\odot(1-M_{m}),
\displaystyle+
\displaystyle\texttt{m-attn}(Q,K,V;M^{b})\odot(1-M_{m}),
M^{f},M^{b}\in\{-\infty,0\}
M_{m}\in\{0,1\}
\odot
Q^{m}
M_{m}\odot Q^{m}+(1-M_{m})\odot Q
320\times 512
10
1
5
t_{2}
t_{2}
\bullet
\bullet
320\times 512
50
50
z_{T}
7.5
10
20
1
5
512\times 512
