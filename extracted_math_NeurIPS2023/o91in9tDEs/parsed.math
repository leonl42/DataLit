\pi(a\mid s)\propto\exp(Q^{\pi}(s,a)).
(\mathcal{S},\mathcal{A},\mathcal{P},r,\gamma)
\mathcal{S}
\mathcal{A}
\mathcal{P}:\mathcal{S}\times\mathcal{A}\times\mathcal{S}\rightarrow[0,1]
\mathbf{s}_{t+1}\in\mathcal{S}
\mathbf{s}_{t}\in\mathcal{S}
\mathbf{a}_{t}\in\mathcal{A}
r:\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}
r(\mathbf{s},\mathbf{a})\in[r_{\mathrm{min}},r_{\mathrm{max}}]
\gamma\in(0,1]
\pi:\mathcal{S}\rightarrow\mathcal{A}
s\in\mathcal{S}
\sum_{t}\mathbb{E}_{a_{t}\sim\pi(\cdot\mid s_{t}),s_{t+1}\sim\mathcal{P}(\cdot%
\mid s_{t},a_{t})}\left[r(s_{t},a_{t})\right]
\pi
Q^{\pi}(s,a)=\mathbb{E}_{\pi}\left[\sum_{k=t}^{\infty}r(s_{k},a_{k})\mid s_{t}%
=s,a_{t}=a\right].
\pi^{*}=\operatorname*{arg\,max}_{\pi}\mathbb{E}_{\pi}\left[\sum_{t=0}^{\infty%
}r(s_{t},a_{t})\right]
dx_{\tau}=-\alpha(\tau)x_{\tau}d\tau+g(\tau)dw_{\tau}
w_{\tau}
\alpha
\alpha(\tau)=0
x_{0}\sim p_{0}
\tau\in[0,1]
\tau
p_{\tau}
p_{0}
\sigma_{\tau}^{2}
p_{\tau}(x_{\tau})=\int_{0}^{\tau}p_{0}(x_{0})\mathcal{N}(x_{\tau};x_{0},%
\sigma_{\tau}^{2})dx_{0}
g(\tau)
\sigma_{\tau}^{2}=\int_{0}^{\tau}g(\xi)^{2}d\xi
\bar{w}_{\tau}
dx_{\tau}=[-\alpha(\tau)x_{\tau}-g(\tau)^{2}\nabla\log p_{\tau}(x_{\tau})]d%
\tau+g(\tau)d\bar{w}_{\tau}
\nabla\log p_{\tau}(x_{\tau})
p_{0}(x)\propto\exp(-\mathcal{E}(x))
\mathcal{E}
\nabla\log p_{\tau}
\begin{split}\nabla\log p_{\tau}&=\frac{\int\nabla\exp(-\mathcal{E}(x_{0}))%
\mathcal{N}(x_{\tau};x_{0},\sigma_{\tau}^{2})dx_{0}}{\int\exp(-\mathcal{E}(x_{%
0}))\mathcal{N}(x_{\tau};x_{0},\sigma_{\tau}^{2})dx_{0}}\\
&=\frac{\mathbb{E}_{\tilde{x}\sim\mathcal{N}(x_{\tau},\sigma_{\tau}^{2})}\big{%
[}\nabla\exp(-\mathcal{E}(x)\big{]}}{\mathbb{E}_{\tilde{x}\sim\mathcal{N}(x_{%
\tau},\sigma_{\tau}^{2}})\big{[}\exp(-\mathcal{E}(x)\big{]}}\end{split}
K
S_{k}(x_{\tau},\tau)=\nabla\log\sum_{i=1}^{K}\exp\big{(}-\mathcal{E}(\tilde{x}%
^{(i)})\big{)},\quad\tilde{x}^{(i)}\sim\mathcal{N}(x_{\tau},\sigma_{\tau}^{2})
f_{\phi}
S_{K}
S_{k}(x_{\tau},\tau)
x_{\tau}
\pi(\mathbf{a}\mid\mathbf{s})\propto\exp(-\mathcal{E}(\mathbf{s},\mathbf{a}))
\mathcal{E}
Q(\mathbf{s},\mathbf{a})
\pi(\mathbf{a}\mid\mathbf{s};T)=\frac{\exp(\frac{1}{T}Q(\mathbf{s},\mathbf{a})%
)}{\int_{\mathbf{a}}\exp(\frac{1}{T}Q(\mathbf{s},\mathbf{a}))\mathrm{d}\mathbf%
{a}}.
T
Q
Q
\pi
Q:\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}
\mathcal{T}^{\pi}
\mathcal{T}^{\pi}Q(\mathbf{s}_{t},\mathbf{a}_{t})\triangleq r(\mathbf{s}_{t},%
\mathbf{a}_{t})+\gamma\,\mathbb{E}_{\mathbf{s}_{t+1}\sim\mathcal{P},\mathbf{a}%
_{t+1}\sim\pi}\left[Q(\mathbf{s}_{t+1},\mathbf{a}_{t+1})\right]
\Pi
\pi_{\text{old}}\in\Pi
\pi_{\text{new}}
Q^{\pi_{\text{old}}}
Q^{\pi_{\text{new}}}(\mathbf{s}_{t},\mathbf{a}_{t})\geq Q^{\pi_{\text{old}}}(%
\mathbf{s}_{t},\mathbf{a}_{t})
\mathbf{s}_{t},\mathbf{a}_{t}\in\mathcal{S},\mathcal{A}
\Pi
\pi\in\Pi
\pi^{*}
Q^{\pi^{*}}(\mathbf{s}_{t},\mathbf{a}_{t})\geq Q^{\pi}(\mathbf{s}_{t},\mathbf{%
a}_{t})
\pi\in\Pi
(\mathbf{s}_{t},\mathbf{a}_{t})\in\mathcal{S}\times\mathcal{S}
\mathcal{D}
Q_{\theta}
\pi_{\phi}
\theta,\phi
\displaystyle J(\theta)=\mathbb{E}_{(\mathbf{s}_{t},\mathbf{a}_{t})\sim%
\mathcal{D}}\left[\left(Q_{\theta}(\mathbf{s}_{t},\mathbf{a}_{t})-\hat{Q}(%
\mathbf{s}_{t},\mathbf{a}_{t})\right)^{2}\right],
\displaystyle J(\theta)=\mathbb{E}_{(\mathbf{s}_{t},\mathbf{a}_{t})\sim%
\mathcal{D}}\left[\left(Q_{\theta}(\mathbf{s}_{t},\mathbf{a}_{t})-\hat{Q}(%
\mathbf{s}_{t},\mathbf{a}_{t})\right)^{2}\right],
\displaystyle\hat{Q}(\mathbf{s}_{t},\mathbf{a}_{t})=r(\mathbf{s}_{t},\mathbf{a%
}_{t})+\gamma\,\mathbb{E}_{\mathbf{s}_{t+1}\sim\mathcal{P},\mathbf{a}_{t+1}%
\sim\pi_{\phi}}\left[Q_{\bar{\theta}}(\mathbf{s}_{t+1},\mathbf{a}_{t+1})\right]
\displaystyle\hat{Q}(\mathbf{s}_{t},\mathbf{a}_{t})=r(\mathbf{s}_{t},\mathbf{a%
}_{t})+\gamma\,\mathbb{E}_{\mathbf{s}_{t+1}\sim\mathcal{P},\mathbf{a}_{t+1}%
\sim\pi_{\phi}}\left[Q_{\bar{\theta}}(\mathbf{s}_{t+1},\mathbf{a}_{t+1})\right]
\hat{Q}
Q_{\bar{\theta}}
\bar{\theta}
\theta
\mathbf{s}_{t+1}
\pi(\cdot|\mathbf{s}_{t})\propto\exp(Q_{\theta}(\mathbf{s}_{t},\mathbf{a}_{t}))
\theta
\phi
\bar{\theta}\leftarrow\theta
\mathcal{D}
\mathbf{s}_{t}
\mathbf{a}_{t}
f_{\phi}
\mathbf{a}_{t}
r_{t}
\mathbf{s}_{t+1}
(\mathbf{s}_{t},\mathbf{a}_{t},r_{t},\mathbf{s}_{t+1})
\mathcal{D}
\mathcal{B}=\{(\mathbf{s}_{t},\mathbf{a}_{t},r_{t},\mathbf{s}_{t+1})\}
\mathcal{D}
\theta
\hat{Q}_{t}=r_{t}+\gamma Q_{\bar{\theta}}(\mathbf{s}_{t+1},\mathbf{a}_{t+1}),%
\quad\mathbf{a}_{t+1}\sim\pi_{\phi}(\mathbf{s}_{t+1})
\theta
J(\theta)=\frac{1}{|\mathcal{B}|}\sum_{\mathcal{B}}\left(Q_{\theta}(\mathbf{s}%
_{t},\mathbf{a}_{t})-\hat{Q}_{t}\right)^{2}
\phi
(\mathbf{s}_{t},\mathbf{a}_{t})
\mathcal{B}
\tau\sim\mathcal{U}[0,1]
\mathbf{a}_{t,\tau}\sim\mathcal{N}(\mathbf{a}_{t},\sigma^{2}_{\tau}\mathbf{I})
\{\tilde{\mathbf{a}}_{t}^{(i)}\}_{i=1}^{K}
\tilde{\mathbf{a}}_{t}^{(i)}\sim\mathcal{N}(\mathbf{a}_{t,\tau},\sigma^{2}_{%
\tau}\mathbf{I})
S_{t}=\nabla_{\mathbf{a}_{t,\tau}}\log\sum_{i=1}^{K}\exp\left(Q_{\theta}(%
\mathbf{s}_{t},\tilde{\mathbf{a}}_{t}^{(i)})\right)
\phi
J(\phi)=\left\|f_{\phi}(\mathbf{s}_{t},\mathbf{a}_{t,\tau},\tau)-S_{t}\right\|%
^{2}
\bar{\theta}\leftarrow\eta\,\theta+(1-\eta)\,\bar{\theta}
(\mathbf{s}_{t},\mathbf{a}_{t})\in\mathcal{S}\times\mathcal{A}
\mathbf{a}_{t,\tau}
\tau\in[0,1]
\displaystyle\mathbf{a}_{t,0}=\mathbf{a}_{t};\qquad\mathbf{a}_{t,\tau}\sim%
\mathcal{N}(\mathbf{a}_{t},\sigma^{2}_{\tau}I).
\displaystyle\mathbf{a}_{t,0}=\mathbf{a}_{t};\qquad\mathbf{a}_{t,\tau}\sim%
\mathcal{N}(\mathbf{a}_{t},\sigma^{2}_{\tau}I).
\sigma_{\tau}=\sigma_{\text{min}}\left(\frac{\sigma_{\text{max}}}{\sigma_{%
\text{min}}}\right)^{\tau}
\sigma_{\text{min}}
\sigma_{\text{max}}
\sigma_{\text{min}}=10^{-5}
\sigma_{\text{max}}=1.0
\pi(\cdot|\mathbf{s}_{t})\propto\exp(Q^{\pi}(\mathbf{s}_{t},\cdot))
f_{\phi}
K
\displaystyle J(\phi)=\mathbb{E}_{\begin{subarray}{c}(\mathbf{s}_{t},\mathbf{a%
}_{t})\sim\mathcal{D},\tau\sim U[0,1],\\
\mathbf{a}_{t,\tau}\sim\mathcal{N}(\mathbf{a}_{t},\sigma^{2}_{\tau}I)\end{%
subarray}}\left[\ \left\lVert f_{\phi}(\mathbf{s}_{t},\mathbf{a}_{t,\tau},\tau%
)-\nabla\log\sum_{i=1}^{K}\exp(Q_{\theta}(\mathbf{s}_{t},\tilde{\mathbf{a}}^{(%
i)}_{t}))\right\rVert^{2}\right],
\displaystyle J(\phi)=\mathbb{E}_{\begin{subarray}{c}(\mathbf{s}_{t},\mathbf{a%
}_{t})\sim\mathcal{D},\tau\sim U[0,1],\\
\mathbf{a}_{t,\tau}\sim\mathcal{N}(\mathbf{a}_{t},\sigma^{2}_{\tau}I)\end{%
subarray}}\left[\ \left\lVert f_{\phi}(\mathbf{s}_{t},\mathbf{a}_{t,\tau},\tau%
)-\nabla\log\sum_{i=1}^{K}\exp(Q_{\theta}(\mathbf{s}_{t},\tilde{\mathbf{a}}^{(%
i)}_{t}))\right\rVert^{2}\right],
\tilde{\mathbf{a}}^{(i)}_{t}\sim\mathcal{N}(\mathbf{a}_{t,\tau},\sigma^{2}_{%
\tau}I)
\mathbf{a}_{t}
\mathbf{s}_{t}
\pi_{\phi}(\mathbf{a}_{t}|\mathbf{s}_{t})\propto\exp(Q^{\pi_{\phi}}(\mathbf{s}%
_{t},\mathbf{a}_{t}))
\tau=1
\mathbf{a}_{t,1}\sim\mathcal{N(}0,\sigma^{2}_{1})
\alpha(\tau)=0
f_{\phi}
\nabla\log p_{\tau}
\mathbf{a}_{t}
T
f_{\phi}
t\rightarrow\infty
T\rightarrow 0
250k
256
3\times 10^{-4}
250k
250k
(x,y)
T=10
T=1
250k
100
250k
250k
T=0.05
\pi_{\text{old}}\in\Pi
\pi_{\text{new}}
Q^{\pi_{\text{old}}}
Q^{\pi_{\text{new}}}(\mathbf{s}_{t},\mathbf{a}_{t})\geq Q^{\pi_{\text{old}}}(%
\mathbf{s}_{t},\mathbf{a}_{t})
\mathbf{s}_{t},\mathbf{a}_{t}\in\mathcal{S},\mathcal{A}
Q^{\pi_{\text{old}}}
\pi_{\text{old}}
\pi_{\text{new}}
Q^{\pi_{\text{old}}}
D_{\text{KL}}\left(\pi_{\text{new}}(\cdot|s_{t})||\exp(Q^{\pi_{\text{old}}}(s_%
{t},\cdot)-\log Z^{\pi_{\text{old}}}(s_{t})\right)\leq D_{\text{KL}}\left(\pi_%
{\text{old}}(\cdot|s_{t})||\exp(Q^{\pi_{\text{old}}}(s_{t},\cdot)-\log Z^{\pi_%
{\text{old}}}(s_{t})\right),
D_{\text{KL}}(p||q)
p
q
Z^{\pi}
Z^{\pi}(s)=\int_{a}Q^{\pi}(s,a)da
\displaystyle\mathbb{E}_{a_{t}\sim\pi_{\text{new}}}\left[\log\pi_{\text{new}}(%
a_{t}|s_{t})-Q^{\pi_{\text{old}}}(s_{t},a_{t})+\log Z^{\pi_{\text{old}}}(s_{t}%
)\right]
\displaystyle\mathbb{E}_{a_{t}\sim\pi_{\text{new}}}\left[\log\pi_{\text{new}}(%
a_{t}|s_{t})-Q^{\pi_{\text{old}}}(s_{t},a_{t})+\log Z^{\pi_{\text{old}}}(s_{t}%
)\right]
\displaystyle\qquad\qquad\leq\mathbb{E}_{a_{t}\sim\pi_{\text{old}}}\left[\log%
\pi_{\text{old}}(a_{t}|s_{t})-Q^{\pi_{\text{old}}}(s_{t},a_{t})+\log Z^{\pi_{%
\text{old}}}(s_{t})\right]
\displaystyle\qquad\qquad\leq\mathbb{E}_{a_{t}\sim\pi_{\text{old}}}\left[\log%
\pi_{\text{old}}(a_{t}|s_{t})-Q^{\pi_{\text{old}}}(s_{t},a_{t})+\log Z^{\pi_{%
\text{old}}}(s_{t})\right]
\displaystyle\Rightarrow\;\mathbb{E}_{a_{t}\sim\pi_{\text{old}}}\left[Q^{\pi_{%
\text{old}}}(s_{t},a_{t})\right]\leq\mathbb{E}_{a_{t}\sim\pi_{\text{new}}}%
\left[Q^{\pi_{\text{old}}}(s_{t},a_{t})-\log\pi_{\text{new}}(a_{t}|s_{t})+\log%
\pi_{\text{old}}(a_{t}|s_{t})\right].
\displaystyle\Rightarrow\;
\displaystyle\mathbb{E}_{a_{t}\sim\pi_{\text{old}}}\left[Q^{\pi_{\text{old}}}(%
s_{t},a_{t})\right]\leq\mathbb{E}_{a_{t}\sim\pi_{\text{new}}}\left[Q^{\pi_{%
\text{old}}}(s_{t},a_{t})-\log\pi_{\text{new}}(a_{t}|s_{t})+\log\pi_{\text{old%
}}(a_{t}|s_{t})\right].
\pi_{\text{new}}
\pi_{\text{old}}
\displaystyle D_{\text{KL}}\left(\pi_{\text{new}}(\cdot|s_{t})||\pi_{\text{old%
}}(\cdot|s_{t})\right)\geq 0
\displaystyle D_{\text{KL}}\left(\pi_{\text{new}}(\cdot|s_{t})||\pi_{\text{old%
}}(\cdot|s_{t})\right)\geq 0
\displaystyle\Rightarrow\;\mathbb{E}_{a_{t}\sim\pi_{\text{new}}}\left[\log\pi_%
{\text{new}}(a_{t}|s_{t})-\log\pi_{\text{old}}(a_{t}|s_{t})\right]\geq 0
\displaystyle\Rightarrow\;
\displaystyle\mathbb{E}_{a_{t}\sim\pi_{\text{new}}}\left[\log\pi_{\text{new}}(%
a_{t}|s_{t})-\log\pi_{\text{old}}(a_{t}|s_{t})\right]\geq 0
\displaystyle\mathbb{E}_{a_{t}\sim\pi_{\text{old}}}\left[Q^{\pi_{\text{old}}}(%
s_{t},a_{t})\right]\leq\mathbb{E}_{a_{t}\sim\pi_{\text{new}}}\left[Q^{\pi_{%
\text{old}}}(s_{t},a_{t})\right]
\displaystyle\mathbb{E}_{a_{t}\sim\pi_{\text{old}}}\left[Q^{\pi_{\text{old}}}(%
s_{t},a_{t})\right]\leq\mathbb{E}_{a_{t}\sim\pi_{\text{new}}}\left[Q^{\pi_{%
\text{old}}}(s_{t},a_{t})\right]
\displaystyle Q^{\pi_{\text{old}}}(s_{t},a_{t})=r(s_{t},a_{t})+\gamma\,\mathbb%
{E}_{s_{t+1}\sim\mathcal{P}}\left[\mathbb{E}_{a_{t+1}\sim\pi_{\text{old}}}%
\left[Q^{\pi_{\text{old}}}(s_{t+1},a_{t+1})\right]\right]
\displaystyle Q^{\pi_{\text{old}}}(s_{t},a_{t})
\displaystyle=r(s_{t},a_{t})+\gamma\,\mathbb{E}_{s_{t+1}\sim\mathcal{P}}\left[%
\mathbb{E}_{a_{t+1}\sim\pi_{\text{old}}}\left[Q^{\pi_{\text{old}}}(s_{t+1},a_{%
t+1})\right]\right]
\displaystyle\leq r(s_{t},a_{t})+\gamma\,\mathbb{E}_{s_{t+1}\sim\mathcal{P}}%
\left[\mathbb{E}_{a_{t+1}\sim\pi_{\text{new}}}\left[Q^{\pi_{\text{old}}}(s_{t+%
1},a_{t+1})\right]\right]
\displaystyle\leq r(s_{t},a_{t})+\gamma\,\mathbb{E}_{s_{t+1}\sim\mathcal{P}}%
\left[\mathbb{E}_{a_{t+1}\sim\pi_{\text{new}}}\left[Q^{\pi_{\text{old}}}(s_{t+%
1},a_{t+1})\right]\right]
\displaystyle\leq r(s_{t},a_{t})+\gamma\,\mathbb{E}_{s_{t+1}\sim\mathcal{P}}%
\left[\mathbb{E}_{a_{t+1}\sim\pi_{\text{new}}}\left[r(s_{t+1},a_{t+1})+\gamma%
\,\mathbb{E}[\ldots]\right]\right]
\displaystyle\leq r(s_{t},a_{t})+\gamma\,\mathbb{E}_{s_{t+1}\sim\mathcal{P}}%
\left[\mathbb{E}_{a_{t+1}\sim\pi_{\text{new}}}\left[r(s_{t+1},a_{t+1})+\gamma%
\,\mathbb{E}[\ldots]\right]\right]
\displaystyle\;\;\vdots
\displaystyle\;\;\vdots
\displaystyle\leq Q^{\pi_{\text{new}}}(s_{t},a_{t}),
\displaystyle\leq Q^{\pi_{\text{new}}}(s_{t},a_{t}),
Q^{\pi_{\text{old}}}
Q^{\pi_{\text{new}}}
\pi\in\Pi
\pi^{*}
Q^{\pi^{*}}(\mathbf{s}_{t},\mathbf{a}_{t})\geq Q^{\pi}(\mathbf{s}_{t},\mathbf{%
a}_{t})
\pi\in\Pi
(\mathbf{s}_{t},\mathbf{a}_{t})\in\mathcal{S}\times\mathcal{S}
\pi_{i}
i
Q^{\pi_{i}}
Q^{\pi}
\pi\in\Pi
\pi^{*}
\pi in\Pi
\displaystyle D_{\text{KL}}\left(\pi^{*}(\cdot|s_{t})||\exp(Q^{\pi^{*}}(s_{t},%
\cdot)-\log Z^{\pi^{*}}(s_{t}))\right)\leq D_{\text{KL}}\left(\pi(\cdot|s_{t})%
||\exp(Q^{\pi^{*}}(s_{t},\cdot)-\log Z^{\pi^{*}}(s_{t}))\right).
\displaystyle D_{\text{KL}}\left(\pi^{*}(\cdot|s_{t})||\exp(Q^{\pi^{*}}(s_{t},%
\cdot)-\log Z^{\pi^{*}}(s_{t}))\right)\leq D_{\text{KL}}\left(\pi(\cdot|s_{t})%
||\exp(Q^{\pi^{*}}(s_{t},\cdot)-\log Z^{\pi^{*}}(s_{t}))\right).
Q^{\pi^{*}}(\mathbf{s}_{t},\mathbf{a}_{t})\geq Q^{\pi}(\mathbf{s}_{t},\mathbf{%
a}_{t})
(\mathbf{s}_{t},\mathbf{a}_{t})\in\mathcal{S}\times\mathcal{A}
\Pi
\pi^{*}
\pi^{*}
256
256
\mathrm{tanh(\cdot)}
256
250k
3\times 10^{-4}
256
3\cdot 10^{-4}
10^{4}
\sigma_{\text{min}}
\sigma_{\text{max}}
