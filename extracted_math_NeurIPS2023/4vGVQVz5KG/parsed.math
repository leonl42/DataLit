(\cS,\cA,H,\cP,r),
\cS
\cA
H
\cP=\{\cP_{h}\}_{h=1}^{H},r=\{r_{h}\}^{H}_{h=1}
\pi=\{\pi_{h}\}_{h=1}^{H}
a_{h}\sim\pi_{h}(\cdot\given s_{h})
V^{\pi}_{h}:\cS\rightarrow\RR
s
h\in[H]
V^{\pi}_{h}(s)=\EE_{\pi}\Big{[}\sum_{t=h}^{H}r_{t}(s_{t},a_{t})\Biggiven s_{h}%
=s\Big{]},\quad Q^{\pi}_{h}(s,a)=\EE_{\pi}\Big{[}\sum_{t=h}^{H}r_{h}(s_{t},a_{%
t})\Biggiven s_{h}=s,a_{h}=a\Big{]}.
\tau
\pi
\displaystyle(\BB_{h}f)(s,a)=\EE\bigl{[}r_{h}(s,a)+f(s^{\prime})\bigr{]},
\displaystyle(\BB_{h}f)(s,a)
\displaystyle=\EE\bigl{[}r_{h}(s,a)+f(s^{\prime})\bigr{]},
f:\mathcal{S}\rightarrow\mathbb{R}
h\in[H]
Q^{*}
V^{*}
\pi^{*}
\displaystyle V^{*}_{h}(s)=\max_{a\in\cA}Q^{*}_{h}(s,a),\quad Q^{*}_{h}(s,a)=(%
\BB_{h}V^{*}_{h})(s,a),\quad\pi^{*}_{h}(\cdot\given s)=\argmax_{\pi}\EE_{a\sim%
\pi}{Q^{*}_{h}(s,a)}.
\displaystyle V^{*}_{h}(s)=\max_{a\in\cA}Q^{*}_{h}(s,a),\quad Q^{*}_{h}(s,a)=(%
\BB_{h}V^{*}_{h})(s,a),\quad\pi^{*}_{h}(\cdot\given s)=\argmax_{\pi}\EE_{a\sim%
\pi}{Q^{*}_{h}(s,a)}.
\pi^{*}
\pi_{k}
s_{1}=s
\text{SubOpt}(\pi;s)=V^{\pi^{*}}_{1}(s)-V^{\pi}_{1}(s).
\rm{MDP}(\cS,\cA,H,\PP,r)
\phi:\cS\times\cA\rightarrow\RR^{d}
h\in[H]
d
\mu_{h}=(\mu_{h}^{(1)},\ldots,\mu_{h}^{(d)})
\cS
z_{h}\in\RR^{d}
(s,a)\in\cS\times\cA
\displaystyle\PP_{h}(\cdot\given s,a)=\langle\phi(s,a),\mu_{h}(\cdot)\rangle,%
\qquad r_{h}(s,a)=\langle\phi(s,a),z_{h}\rangle.
\displaystyle\PP_{h}(\cdot\given s,a)=\langle\phi(s,a),\mu_{h}(\cdot)\rangle,%
\qquad r_{h}(s,a)=\langle\phi(s,a),z_{h}\rangle.
\norm{\phi(s,a)}\leq 1
(s,a)\in\cS\times\cA
\max\{\norm{\mu_{h}(\cS)},\norm{z_{h}}\}\leq\sqrt{d}
h\in[H]
z
r_{h}(s,a,z),V^{\pi}_{h}(s,z)
V^{*}_{h}(s,z)
z
\cZ
z\in\cZ
r_{z}:\cS\times\cA\rightarrow\RR
\beta\in\Delta(\cZ)
\cZ
\cW
\beta
w\in\cW
f_{w}
N
\beta
\displaystyle r_{i}(s,a)=f_{w_{i}}(s,a),~{}w_{i}\sim\beta,~{}\forall i=1,%
\ldots,N.
\displaystyle r_{i}(s,a)=f_{w_{i}}(s,a),~{}w_{i}\sim\beta,~{}\forall i=1,%
\ldots,N.
\beta
\displaystyle\cL^{\rm offline}_{\rm critic}(\theta_{i})=\mathbb{E}_{(s,a,r_{i}%
,s^{\prime})\sim\mathcal{D}_{i}^{\rm off}}\left[\left(r_{i}+\gamma Q_{\theta^{%
\prime}_{i}}(s^{\prime},\widetilde{a})-Q_{\theta_{i}}(s,a)\right)^{2}\right],
\displaystyle\cL^{\rm offline}_{\rm critic}(\theta_{i})
\displaystyle=\mathbb{E}_{(s,a,r_{i},s^{\prime})\sim\mathcal{D}_{i}^{\rm off}}%
\left[\left(r_{i}+\gamma Q_{\theta^{\prime}_{i}}(s^{\prime},\widetilde{a})-Q_{%
\theta_{i}}(s,a)\right)^{2}\right],
\displaystyle\cL^{\rm offline}_{\rm actor}(\phi_{i})=-\mathbb{E}_{(s,a)\sim%
\mathcal{D}_{i}^{\rm off}}\left[\lambda Q_{\theta_{i}}(s,\pi_{\phi_{i}}(s))-(%
\pi_{\phi_{i}}(s)-a)^{2}\right],
\displaystyle\cL^{\rm offline}_{\rm actor}(\phi_{i})
\displaystyle=-\mathbb{E}_{(s,a)\sim\mathcal{D}_{i}^{\rm off}}\left[\lambda Q_%
{\theta_{i}}(s,\pi_{\phi_{i}}(s))-(\pi_{\phi_{i}}(s)-a)^{2}\right],
\widetilde{a}=\pi_{\phi^{\prime}_{i}}(s^{\prime})+\epsilon
\lambda
\gamma
\widetilde{\pi}=[\pi_{\phi_{1}},\ldots,\pi_{\phi_{N}},\pi_{w}]
\{{\phi_{i}}\}_{i=1}^{N}
\pi_{w}
\displaystyle P_{\widetilde{\pi}}[i]=\frac{\exp{\left(\alpha\cdot Q(s,%
\widetilde{\pi}_{i}(s))\right)}}{\sum_{j}\exp{\left(\alpha\cdot Q(s,\widetilde%
{\pi}_{j}(s)\right))}},\forall i\in\{1,\cdots,N+1\},
\displaystyle P_{\widetilde{\pi}}[i]=\frac{\exp{\left(\alpha\cdot Q(s,%
\widetilde{\pi}_{i}(s))\right)}}{\sum_{j}\exp{\left(\alpha\cdot Q(s,\widetilde%
{\pi}_{j}(s)\right))}},\forall i\in\{1,\cdots,N+1\},
\alpha
i\in\{1,\cdots,N+1\}
P_{\widetilde{\pi}}
\pi_{i}
\pi_{w}
Q_{\theta}
\displaystyle\cL^{\rm online}_{\rm critic}(\theta)=\mathbb{E}_{(s,a,r,s^{%
\prime})\sim\mathcal{D}^{\rm on}}\left[\left(r+\gamma Q_{\theta^{\prime}}(s^{%
\prime},\widetilde{a})-Q_{\theta}(s,a)\right)\right]^{2},
\displaystyle\cL^{\rm online}_{\rm critic}(\theta)
\displaystyle=\mathbb{E}_{(s,a,r,s^{\prime})\sim\mathcal{D}^{\rm on}}\left[%
\left(r+\gamma Q_{\theta^{\prime}}(s^{\prime},\widetilde{a})-Q_{\theta}(s,a)%
\right)\right]^{2},
\displaystyle\cL^{\rm online}_{\rm actor}(w)=-\mathbb{E}_{(s,a)\sim\mathcal{D}%
^{\rm on}}\left[Q_{\theta}(s,\pi_{w}(s))\right].
\displaystyle\cL^{\rm online}_{\rm actor}(w)
\displaystyle=-\mathbb{E}_{(s,a)\sim\mathcal{D}^{\rm on}}\left[Q_{\theta}(s,%
\pi_{w}(s))\right].
N
\cD^{\rm off}
\beta
N
\{Q_{\theta_{i}},\pi_{\phi_{i}}\}_{i=1}^{N}
i=1,\cdots,N
z_{i}\sim\beta
\cD^{\rm off}
\cD_{i}^{\rm off}
r_{z_{i}}
\{\tau_{j}\}_{j=1}^{B}\sim\cD_{i}^{\rm off}
\cL_{\rm critic}^{\rm offline}(\theta_{i})
\theta_{i}
\cL_{\rm actor}^{\rm offline}(\phi_{i})
\phi_{i}
\{\pi_{\phi_{i}}\}_{i=1}^{N}
\{\pi_{\phi_{i}}\}_{i=1}^{N}
\cD^{\rm off}
G
Q_{\theta},\pi_{w}
\cD^{\rm on}
\widetilde{\pi}=[\pi_{\phi_{1}},\ldots,\pi_{\phi_{N}},\pi_{w}]
s_{1}
t=1,\cdots,T
P_{\widetilde{\pi}}
\pi_{t}\sim P_{\widetilde{\pi}}
a_{t}\sim\pi_{t}(\cdot|s_{t})
(s_{t},a_{t},r_{t},s_{t+1})
\cD^{\rm on}
g=1,\cdots,G
\cL_{\rm critic}^{\rm online}(\theta)
\theta
\cL_{\rm actor}^{\rm online}(w)
w
\pi
z
r(\cdot,\cdot,z)
\pi
r(\cdot,\cdot,z)
\pi=\{\pi_{h}\}_{h=1}^{H},\pi_{h}:\cS\rightarrow\Delta(\cA)
z\in\cZ
\displaystyle V^{\pi}_{h}(s,z)=V^{*}_{h}(s,z),~{}\forall(s,a,h)\in\cS\times\cA%
\times[H].
\displaystyle V^{\pi}_{h}(s,z)=V^{*}_{h}(s,z),~{}\forall(s,a,h)\in\cS\times\cA%
\times[H].
z
\pi
\pi_{z}
\cZ
\cD
N
z\in\cZ
\displaystyle\text{\rm SubOpt}(\widehat{\pi};s,z)=\cO\left(\sqrt{\frac{C^{%
\dagger}_{z}d^{2}H^{3}\iota}{N}}\right),
\displaystyle\text{\rm SubOpt}(\widehat{\pi};s,z)=\cO\left(\sqrt{\frac{C^{%
\dagger}_{z}d^{2}H^{3}\iota}{N}}\right),
N
\iota=\log(dN|\cZ|/\delta)
c
\displaystyle C^{\dagger}_{z}=\max_{h\in[H]}\sup_{\|x\|=1}\frac{x^{\top}\Sigma%
_{\pi_{z},h}x}{x^{\top}\Sigma_{\rho_{h}}x},
\displaystyle C^{\dagger}_{z}=\max_{h\in[H]}\sup_{\|x\|=1}\frac{x^{\top}\Sigma%
_{\pi_{z},h}x}{x^{\top}\Sigma_{\rho_{h}}x},
\Sigma_{\pi_{z},h}=\EE_{(s,a)\sim d_{\pi_{z},h}(s,a)}[\phi(s,a)\phi(s,a)^{\top%
}],~{}\Sigma_{\rho_{h}}=\EE_{\rho_{h}}[\phi(s,a)\phi(s,a)^{\top}].
C^{\dagger}_{z}
\rho
d_{\pi_{z}}
\pi_{z}
\pi_{z}
\cD
\widehat{\pi}
r(\cdot,\cdot,z)
\log|\cZ|
r(s,a)
\psi(s,a)
\|\psi(s,a)\|_{\infty}\leq\kappa
N=c_{0}\sqrt{M}\log(18\sqrt{M}\kappa^{2}/\delta)
\{r_{i}\}_{i=1}^{N}
\widehat{r}(s,a)
\E_{(s,a)\sim\rho}[\widehat{r}(s,a)-r(s,a)]^{2}\leq c_{1}\log^{2}(18/\delta)/%
\sqrt{M},
1-\delta
M
\cD
c_{0}
c_{1}
\rho
\cD
\backslash
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\backslash
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
N=256
\pi
z
r(\cdot,\cdot,z)
\pi
r(\cdot,\cdot,z)
\pi=\{\pi_{h}\}_{h=1}^{H},\pi_{h}:\cS\rightarrow\Delta(\cA)
z\in\cZ
\displaystyle V^{\pi}_{h}(s,z)=V^{*}_{h}(s,z),~{}\forall(s,a,h)\in\cS\times\cA%
\times[H].
\displaystyle V^{\pi}_{h}(s,z)=V^{*}_{h}(s,z),~{}\forall(s,a,h)\in\cS\times\cA%
\times[H].
\pi
z\in\cZ
\pi
r(\cdot,\cdot,z)
\pi^{*}_{z},\pi^{*}_{h,z}(\cdot|s)=\pi_{h}(\cdot|s),\forall d^{\pi}_{h}(s)>0
\pi
r_{h}(\cdot,\cdot,z)
\displaystyle V^{\pi}_{h}(s_{h},z)=\sum_{t=h}^{H}\int{r_{t}(s,a,z)d^{\pi}_{t}(%
s,a,s_{h})\mathrm{d}s\mathrm{d}a},
\displaystyle V^{\pi}_{h}(s_{h},z)=\sum_{t=h}^{H}\int{r_{t}(s,a,z)d^{\pi}_{t}(%
s,a,s_{h})\mathrm{d}s\mathrm{d}a},
d^{\pi}_{t}(s,a,s_{h})
t
\pi
s_{h}
r_{h}(s,a,z)=\mathbbm{1}(\exists s_{h}\in\cS,d^{\pi}_{h}(s,a,s_{h})>0)
\displaystyle V^{\pi}_{h}(\cdot,z)=H-h=V_{h,\text{max}}=V^{*}_{h}(\cdot,z).
\displaystyle V^{\pi}_{h}(\cdot,z)=H-h=V_{h,\text{max}}=V^{*}_{h}(\cdot,z).
\pi
d^{\pi}_{h}(s,a)
s
\pi^{\prime}
s_{h}
\pi_{h}(\cdot|s_{h})\neq\pi^{\prime}_{h}(\cdot|s_{h})
d_{h}^{\pi}(s_{h})>0
\displaystyle\int{r_{h}(s_{h},a,z)d^{\pi^{\prime}}_{h}(s_{h},a)\mathrm{d}a}<1,
\displaystyle\int{r_{h}(s_{h},a,z)d^{\pi^{\prime}}_{h}(s_{h},a)\mathrm{d}a}<1,
V^{\pi^{\prime}}_{h}(s_{h},z)<V_{h,\text{max}}
\pi^{\prime}
\pi
z
\cD
N
z\in\cZ
|\cZ|
\displaystyle\text{\rm SubOpt}(\widehat{\pi};r_{z})\leq 4c\sqrt{\frac{C^{%
\dagger}_{z}d^{2}H^{3}\iota}{N}},
\displaystyle\text{\rm SubOpt}(\widehat{\pi};r_{z})\leq 4c\sqrt{\frac{C^{%
\dagger}_{z}d^{2}H^{3}\iota}{N}},
1-\delta
N
\iota=\log{\frac{4dN|\cZ|}{\delta}}
c
\displaystyle C^{\dagger}_{z}=\max_{h\in[H]}\sup_{\|x\|=1}\frac{x^{\top}\Sigma%
_{\pi_{z},h}x}{x^{\top}\Sigma_{\rho_{h}}x},
\displaystyle C^{\dagger}_{z}=\max_{h\in[H]}\sup_{\|x\|=1}\frac{x^{\top}\Sigma%
_{\pi_{z},h}x}{x^{\top}\Sigma_{\rho_{h}}x},
\displaystyle\Sigma_{\pi_{z},h}=\EE_{(s,a)\sim d_{\pi_{z},h}(s,a)}[\phi(s,a)%
\phi(s,a)^{\top}],\quad\Sigma_{\rho_{h}}=\EE_{\rho_{h}}[\phi(s,a)\phi(s,a)^{%
\top}].
\displaystyle\Sigma_{\pi_{z},h}
\displaystyle=\EE_{(s,a)\sim d_{\pi_{z},h}(s,a)}[\phi(s,a)\phi(s,a)^{\top}],%
\quad\Sigma_{\rho_{h}}=\EE_{\rho_{h}}[\phi(s,a)\phi(s,a)^{\top}].
\delta^{\prime}=\frac{\delta}{|\cZ|}
\widetilde{\cO}(d^{3})
\widetilde{\cO}(d^{2})
\widehat{r}_{\rm{ridge}}
\displaystyle\E_{(s,a)\sim\rho}(\widehat{r}_{\rm{ridge}}(s,a)-r(s,a))^{2}=\E_{%
(s,a)\sim\rho}\left(\sum_{i}\widehat{w}^{\rm{ridge}}_{i}r_{i}(s,a)-r(s,a)%
\right)^{2}\leq c_{1}\log^{2}(18/\delta)/\sqrt{M}.
\displaystyle\E_{(s,a)\sim\rho}(\widehat{r}_{\rm{ridge}}(s,a)-r(s,a))^{2}=\E_{%
(s,a)\sim\rho}\left(\sum_{i}\widehat{w}^{\rm{ridge}}_{i}r_{i}(s,a)-r(s,a)%
\right)^{2}\leq c_{1}\log^{2}(18/\delta)/\sqrt{M}.
\displaystyle\min_{w}\E_{(s,a)\sim\rho}\left(\sum_{i}w_{i}r_{i}(s,a)-r(s,a)%
\right)^{2}\leq\E_{(s,a)\sim\rho}\left(\sum_{i}\widehat{w}^{\rm{ridge}}_{i}r_{%
i}(s,a)-r(s,a)\right)^{2},
\displaystyle\min_{w}\E_{(s,a)\sim\rho}\left(\sum_{i}w_{i}r_{i}(s,a)-r(s,a)%
\right)^{2}\leq\E_{(s,a)\sim\rho}\left(\sum_{i}\widehat{w}^{\rm{ridge}}_{i}r_{%
i}(s,a)-r(s,a)\right)^{2},
\epsilon
\epsilon=\|r-\widehat{r}\|/\|r\|
\widehat{r}
(s,a)
40\%
\epsilon
\epsilon=\|r-\widehat{r}\|/\|r\|
\widehat{r}
(s,a)
40\%
\alpha
n
\alpha
\alpha
n
\alpha
\tau
G
n
\alpha
