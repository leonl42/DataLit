10
\displaystyle H=-\frac{1}{2}\nabla_{x}^{2}+V.
\displaystyle H
\displaystyle=-\frac{1}{2}\nabla_{x}^{2}+V.
x
V
\psi(x,t)
\displaystyle i\frac{\mathrm{d}}{\mathrm{d}t}\psi(x,t)=H\psi(x,t)
\displaystyle i\frac{\mathrm{d}}{\mathrm{d}t}\psi(x,t)=H\psi(x,t)
\displaystyle H\psi(x)=E\psi(x)
\displaystyle H\psi(x)=E\psi(x)
E
\psi
\psi
E
q(x)=|\psi(x)|^{2}
\displaystyle E[\psi]=\mathbb{E}_{q(x)}\mathopen{}\mathclose{{}\left[E_{%
\textrm{loc}}(x)}\right],\;\;\;E_{\textrm{loc}}(x)\coloneqq\frac{\mathopen{}%
\mathclose{{}\left[H\psi}\right](x)}{\psi(x)}
\displaystyle E[\psi]=\mathbb{E}_{q(x)}\mathopen{}\mathclose{{}\left[E_{%
\textrm{loc}}(x)}\right],\;\;\;E_{\textrm{loc}}(x)\coloneqq\frac{\mathopen{}%
\mathclose{{}\left[H\psi}\right](x)}{\psi(x)}
\log\mathopen{}\mathclose{{}\left|\psi}\right|
\displaystyle E[q]=\mathbb{E}_{q(x)}\mathopen{}\mathclose{{}\left[E_{\textrm{%
loc}}(x)}\right],\;\;\;E_{\textrm{loc}}(x)=V(x)-\frac{1}{4}\nabla_{x}^{2}\log q%
(x)-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q(x)}\right%
\rVert^{2},
\displaystyle E[q]=\mathbb{E}_{q(x)}\mathopen{}\mathclose{{}\left[E_{\textrm{%
loc}}(x)}\right],\;\;\;E_{\textrm{loc}}(x)=V(x)-\frac{1}{4}\nabla_{x}^{2}\log q%
(x)-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q(x)}\right%
\rVert^{2},
q(x)
q(x)=\psi^{2}(x)
E[q]
E[q]\geq E_{0}
\psi
\psi(x,\theta)
E[q(\theta)]
\theta_{0}=\mathop{\arg\,\min}_{\theta}\,E[q(\theta)]
\theta
\displaystyle\nabla_{\theta}E[q(\theta)]=\mathbb{E}_{q(x,\theta)}\mathopen{}%
\mathclose{{}\left[\bigg{(}E_{\textrm{loc}}(x,\theta)-\mathbb{E}_{q(x,\theta)}%
\mathopen{}\mathclose{{}\left[E_{\textrm{loc}}(x,\theta)}\right]\bigg{)}\nabla%
_{\theta}\log q(x,\theta)}\right].
\displaystyle\nabla_{\theta}E[q(\theta)]=\mathbb{E}_{q(x,\theta)}\mathopen{}%
\mathclose{{}\left[\bigg{(}E_{\textrm{loc}}(x,\theta)-\mathbb{E}_{q(x,\theta)}%
\mathopen{}\mathclose{{}\left[E_{\textrm{loc}}(x,\theta)}\right]\bigg{)}\nabla%
_{\theta}\log q(x,\theta)}\right].
q(x,\theta)=\psi^{2}(x,\theta)
q(x,\theta)
\tilde{q}(x,\theta)\propto q(x,\theta)
\theta
q(x,\theta)
f:\mathbb{R}^{d}\to\mathbb{R}
\frac{\mathrm{d}}{\mathrm{d}t}x_{t}=-\nabla_{x}f\mathopen{}\mathclose{{}\left(%
x_{t}}\right)
\mathcal{P}_{2}
g_{t}
p_{0}
p_{1}
\displaystyle\mathrm{WFR}_{\lambda}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}%
\right)^{2}\coloneqq\inf_{v_{t},g_{t},q_{t}}\int_{0}^{1}\;\mathbb{E}_{q_{t}(x)%
}\mathopen{}\mathclose{{}\left[\mathopen{}\mathclose{{}\left\lVert v_{t}(x)}%
\right\rVert^{2}+\lambda g_{t}(x)^{2}}\right]\,\mathrm{d}t,\;\;\text{ subj. to}
\displaystyle\mathrm{WFR}_{\lambda}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}%
\right)^{2}
\displaystyle\coloneqq\inf_{v_{t},g_{t},q_{t}}\int_{0}^{1}\;\mathbb{E}_{q_{t}(%
x)}\mathopen{}\mathclose{{}\left[\mathopen{}\mathclose{{}\left\lVert v_{t}(x)}%
\right\rVert^{2}+\lambda g_{t}(x)^{2}}\right]\,\mathrm{d}t,\;\;\text{ subj. to}
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right)+g_{t}(x)q_{t}(x)\,,\quad\text{ and%
 }q_{0}(x)=p_{0}(x),\;\;q_{1}(x)=p_{1}(x)\,,
\displaystyle\frac{\partial q_{t}(x)}{\partial t}
\displaystyle=-\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q_{t}(x)v_{t}(x)}%
\right)+g_{t}(x)q_{t}(x)\,,\quad\text{ and }q_{0}(x)=p_{0}(x),\;\;q_{1}(x)=p_{%
1}(x)\,,
v_{t}(x)
g_{t}(x)
\lambda
g_{t}(x)\equiv 0
v_{t}(x)\equiv 0
c
c
F[q]:\mathcal{P}_{2}\to\mathbb{R}
F
F[q]
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=\underbrace{-\nabla_{x}\cdot%
\mathopen{}\mathclose{{}\left(q_{t}(x)\bigg{(}-\nabla_{x}\frac{\delta F[q_{t}]%
}{\delta q_{t}}(x)\bigg{)}}\right)}_{\text{the continuity equation}}-\frac{1}{%
\lambda}\underbrace{\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}%
_{q_{t}(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(%
y)}\right]\bigg{)}}_{\text{growth term}}q_{t}(x),
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=\underbrace{-\nabla_{x}\cdot%
\mathopen{}\mathclose{{}\left(q_{t}(x)\bigg{(}-\nabla_{x}\frac{\delta F[q_{t}]%
}{\delta q_{t}}(x)\bigg{)}}\right)}_{\text{the continuity equation}}-\frac{1}{%
\lambda}\underbrace{\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}%
_{q_{t}(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(%
y)}\right]\bigg{)}}_{\text{growth term}}q_{t}(x),
\delta F[q]/\delta q
F
L_{2}
x\sim q_{t}(x)
v_{t}(x)=-\nabla_{x}\delta F[q_{t}]/\delta q_{t}
g_{t}(x)=\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_{t}(y)}%
\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}\right]
\mathbb{E}_{q_{t}}\mathopen{}\mathclose{{}\left[g_{t}}\right]=0
\displaystyle\frac{\partial q_{t}}{\partial t}(x)={-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)\bigg{(}-\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_%
{t}}(x)\bigg{)}}\right)},
\displaystyle\frac{\partial q_{t}}{\partial t}(x)
\displaystyle={-\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q_{t}(x)\bigg{(}-%
\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)\bigg{)}}\right)},
\displaystyle\frac{\partial q_{t}}{\partial t}(x)={-\bigg{(}\frac{\delta F[q_{%
t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_{t}(y)}\mathopen{}\mathclose{{}\left[\frac%
{\delta F[q_{t}]}{\delta q_{t}}(y)}\right]\bigg{)}q_{t}(x)},
\displaystyle\frac{\partial q_{t}}{\partial t}(x)
\displaystyle={-\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_%
{t}(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}%
\right]\bigg{)}q_{t}(x)},
\displaystyle\text{Fisher--Rao Gradient Flow}.
\displaystyle\text{Fisher--Rao Gradient Flow}.
\displaystyle\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\frac{\delta F[q_{t}%
]}{\delta q_{t}}(x)}\right\rVert=0\iff\frac{\delta F[q_{t}]}{\delta q_{t}}(x)%
\equiv\text{constant}\,.
\displaystyle\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\frac{\delta F[q_{t}%
]}{\delta q_{t}}(x)}\right\rVert=0\iff\frac{\delta F[q_{t}]}{\delta q_{t}}(x)%
\equiv\text{constant}\,.
F[q]
\psi
\psi_{t}
\displaystyle\frac{\partial\psi_{t}(x)}{\partial t}=~{}-\mathopen{}\mathclose{%
{}\left(H-E[\psi_{t}]}\right)\psi_{t}(x),
\displaystyle\frac{\partial\psi_{t}(x)}{\partial t}=~{}
\displaystyle-\mathopen{}\mathclose{{}\left(H-E[\psi_{t}]}\right)\psi_{t}(x),
q_{t}(x)=\psi_{t}^{2}(x)
E[\psi_{t}]
\mathbb{E}[q]
E[q]
\displaystyle\frac{\delta E[q]}{\delta q}(x)=V(x)-\frac{1}{4}\nabla_{x}^{2}%
\log q(x)-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q(x)}%
\right\rVert^{2}=E_{\textrm{loc}}(x).
\displaystyle\frac{\delta E[q]}{\delta q}(x)=V(x)-\frac{1}{4}\nabla_{x}^{2}%
\log q(x)-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q(x)}%
\right\rVert^{2}=E_{\textrm{loc}}(x).
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\bigg{(}E_{\textrm{loc}}(x)%
-\mathbb{E}_{q_{t}(x)}\mathopen{}\mathclose{{}\left[E_{\textrm{loc}}(x)}\right%
]\bigg{)}q_{t}(x),
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\bigg{(}E_{\textrm{loc}}(x)%
-\mathbb{E}_{q_{t}(x)}\mathopen{}\mathclose{{}\left[E_{\textrm{loc}}(x)}\right%
]\bigg{)}q_{t}(x),
q(x,\theta)
q(x,\theta)
q_{t}(x)=q(x,\theta)
\Delta t
q_{t}(x)
q_{t+\Delta t}(x)
q(x,\theta)
q_{t+\Delta t}(x)
\Delta\theta^{*}
q_{t+\Delta t}(x)
\displaystyle\Delta\theta^{*}=\mathop{\arg\,\min}_{\begin{subarray}{c}\Delta%
\theta\\
\mathopen{}\mathclose{{}\left\lVert\Delta\theta}\right\rVert_{2}=1\end{%
subarray}}\,D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t+\Delta t}(x)%
\middle\|q(x,\theta+\Delta\theta)}\right)\,.
\displaystyle\Delta\theta^{*}=\mathop{\arg\,\min}_{\begin{subarray}{c}\Delta%
\theta\\
\mathopen{}\mathclose{{}\left\lVert\Delta\theta}\right\rVert_{2}=1\end{%
subarray}}\,D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t+\Delta t}(x)%
\middle\|q(x,\theta+\Delta\theta)}\right)\,.
q_{t}(x)=q(x,\theta)
\displaystyle\begin{split}D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t+%
\Delta t}(x)\middle\|q(x,\theta+\Delta\theta)}\right)=~{}&-\frac{1}{2}\Delta t%
\mathopen{}\mathclose{{}\left\langle\Delta\theta,\int\frac{\partial}{\partial t%
}q_{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x}\right\rangle\\
~{}&+o\mathopen{}\mathclose{{}\left(\sqrt{\Delta t^{2}+\mathopen{}\mathclose{{%
}\left\lVert\Delta\theta}\right\rVert^{2}}}\right)\,,\end{split}
\displaystyle\begin{split}D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t+%
\Delta t}(x)\middle\|q(x,\theta+\Delta\theta)}\right)=~{}&-\frac{1}{2}\Delta t%
\mathopen{}\mathclose{{}\left\langle\Delta\theta,\int\frac{\partial}{\partial t%
}q_{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x}\right\rangle\\
~{}&+o\mathopen{}\mathclose{{}\left(\sqrt{\Delta t^{2}+\mathopen{}\mathclose{{%
}\left\lVert\Delta\theta}\right\rVert^{2}}}\right)\,,\end{split}
\mathopen{}\mathclose{{}\left\langle\cdot,\cdot}\right\rangle
\displaystyle\Delta\theta^{*}=\mathop{\arg\,\min}_{\begin{subarray}{c}\Delta%
\theta\\
\mathopen{}\mathclose{{}\left\lVert\Delta\theta}\right\rVert_{2}=1\end{%
subarray}}\,\mathopen{}\mathclose{{}\left\langle\Delta\theta,-\int\frac{%
\partial}{\partial t}q_{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x}%
\right\rangle\propto\int\frac{\partial}{\partial t}q_{t}(x)\nabla_{\theta}\log
q%
(x,{\theta})\,\mathrm{d}x\,.
\displaystyle\Delta\theta^{*}=\mathop{\arg\,\min}_{\begin{subarray}{c}\Delta%
\theta\\
\mathopen{}\mathclose{{}\left\lVert\Delta\theta}\right\rVert_{2}=1\end{%
subarray}}\,\mathopen{}\mathclose{{}\left\langle\Delta\theta,-\int\frac{%
\partial}{\partial t}q_{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x}%
\right\rangle\propto\int\frac{\partial}{\partial t}q_{t}(x)\nabla_{\theta}\log
q%
(x,{\theta})\,\mathrm{d}x\,.
\displaystyle\Delta\theta^{*}\propto-\mathbb{E}_{q_{t}(x)}\mathopen{}%
\mathclose{{}\left[\bigg{(}E_{\textrm{\emph{loc}}}(x,\theta)-\mathbb{E}_{q_{t}%
(x)}\mathopen{}\mathclose{{}\left[E_{\textrm{\emph{loc}}}(x,\theta)}\right]%
\bigg{)}\nabla_{\theta}\log q(x,\theta)}\right].
\displaystyle\Delta\theta^{*}\propto-\mathbb{E}_{q_{t}(x)}\mathopen{}%
\mathclose{{}\left[\bigg{(}E_{\textrm{\emph{loc}}}(x,\theta)-\mathbb{E}_{q_{t}%
(x)}\mathopen{}\mathclose{{}\left[E_{\textrm{\emph{loc}}}(x,\theta)}\right]%
\bigg{)}\nabla_{\theta}\log q(x,\theta)}\right].
{q}(x,\theta)
{q}(x,\theta)
\mathcal{F}_{\theta}
\displaystyle\Delta\theta^{*}=~{}\mathop{\arg\,\min}_{\begin{subarray}{c}%
\Delta\theta\\
\mathopen{}\mathclose{{}\left\lVert\Delta\theta}\right\rVert_{\mathcal{F}}=1%
\end{subarray}}\,\mathopen{}\mathclose{{}\left\langle\Delta\theta,-\int\frac{%
\partial}{\partial t}q_{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x}%
\right\rangle\propto\mathcal{F}_{\theta}^{-1}\int\frac{\partial}{\partial t}q_%
{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x\,,
\displaystyle\Delta\theta^{*}=~{}
\displaystyle\mathop{\arg\,\min}_{\begin{subarray}{c}\Delta\theta\\
\mathopen{}\mathclose{{}\left\lVert\Delta\theta}\right\rVert_{\mathcal{F}}=1%
\end{subarray}}\,\mathopen{}\mathclose{{}\left\langle\Delta\theta,-\int\frac{%
\partial}{\partial t}q_{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x}%
\right\rangle\propto\mathcal{F}_{\theta}^{-1}\int\frac{\partial}{\partial t}q_%
{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x\,,
\displaystyle\mathcal{F}_{\theta}=~{}\mathbb{E}_{q(x,\theta)}\mathopen{}%
\mathclose{{}\left[\frac{\partial}{\partial\theta}\log q\mathopen{}\mathclose{%
{}\left(x,\theta}\right)\frac{\partial}{\partial\theta}\log q\mathopen{}%
\mathclose{{}\left(x,\theta}\right)^{\top}}\right].
\displaystyle\mathcal{F}_{\theta}=~{}
\displaystyle\mathbb{E}_{q(x,\theta)}\mathopen{}\mathclose{{}\left[\frac{%
\partial}{\partial\theta}\log q\mathopen{}\mathclose{{}\left(x,\theta}\right)%
\frac{\partial}{\partial\theta}\log q\mathopen{}\mathclose{{}\left(x,\theta}%
\right)^{\top}}\right].
\theta
q_{t}(x)
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)(-\nabla_{x}E_{\textrm{\emph{loc}}}(x))}\right)
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)(-\nabla_{x}E_{\textrm{\emph{loc}}}(x))}\right)
\delta E[q]/\delta q=E_{\textrm{loc}}(x)
c
c
c:\mathbb{R}^{d}\to\mathbb{R}
c
p_{0}
p_{1}
\displaystyle W_{c}^{2}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}\right)%
\coloneqq\inf_{v_{t},q_{t}}\int_{0}^{1}\;\mathbb{E}_{q_{t}(x)}\mathopen{}%
\mathclose{{}\left[c(v_{t}(x))}\right]\,\mathrm{d}t,\;\;\text{ subj. to}
\displaystyle W_{c}^{2}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}\right)
\displaystyle\coloneqq\inf_{v_{t},q_{t}}\int_{0}^{1}\;\mathbb{E}_{q_{t}(x)}%
\mathopen{}\mathclose{{}\left[c(v_{t}(x))}\right]\,\mathrm{d}t,\;\;\text{ subj%
. to}
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right)\,,\quad\text{ and }q_{0}=p_{0},\;%
\;q_{1}=p_{1}\,.
\displaystyle\frac{\partial q_{t}(x)}{\partial t}
\displaystyle=-\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q_{t}(x)v_{t}(x)}%
\right)\,,\quad\text{ and }q_{0}=p_{0},\;\;q_{1}=p_{1}\,.
c
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)\nabla c^{*}(-2\nabla_{x}E_{\textrm{\emph{loc}}}(x)%
)}\right)\,,
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)\nabla c^{*}(-2\nabla_{x}E_{\textrm{\emph{loc}}}(x)%
)}\right)\,,
c^{*}(\cdot)
c(\cdot)
\nabla c^{*}(y)
y
c(\cdot)=\mathopen{}\mathclose{{}\left\lVert\cdot}\right\rVert^{2}
c
L^{2}
-\nabla_{x}E_{\textrm{loc}}(x)
c
\tanh
\displaystyle\Delta\theta^{*}\propto\int q_{t}(x)\nabla_{\theta}\bigg{\langle}%
\nabla c^{*}(-2\nabla_{x}E_{\textrm{{loc}}}(x)),\nabla_{x}\log q(x,\theta)%
\bigg{\rangle}\,\mathrm{d}x.
\displaystyle\Delta\theta^{*}\propto\int q_{t}(x)\nabla_{\theta}\bigg{\langle}%
\nabla c^{*}(-2\nabla_{x}E_{\textrm{{loc}}}(x)),\nabla_{x}\log q(x,\theta)%
\bigg{\rangle}\,\mathrm{d}x.
\lambda
\lambda\to\infty
c
\lambda\to 0
\lambda\to 0,\infty
\lambda=1
\{x^{(i)}\}_{i=1}^{N}\sim q_{t=0}(x)
V(x)
E_{\textrm{loc}}(x^{(i)})=V(x^{(i)})-\frac{1}{4}\nabla^{2}_{x}\log q(x^{(i)},%
\theta)-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q(x^{(i)}%
,\theta)}\right\rVert^{2}
\nabla_{x}E_{\textrm{loc}}(x^{(i)})=\textrm{stop\_gradient}(\nabla_{x}E_{%
\textrm{loc}}(x^{(i)}))
\Delta\theta^{*}=\frac{1}{N}\sum_{i}^{N}\nabla_{\theta}\bigg{\langle}\nabla c^%
{*}\mathopen{}\mathclose{{}\left(-2\nabla_{x}E_{\textrm{loc}}(x^{(i)})}\right)%
,\nabla_{x}\log q(x^{(i)},\theta)\bigg{\rangle}
E_{\textrm{loc}}(x^{(i)})=\textrm{stop\_gradient}(E_{\textrm{loc}}(x^{(i)}))
\Delta\theta^{*}\mathrel{{+}{=}}-\frac{1}{\lambda}\frac{1}{N}\sum_{i}^{N}%
\mathopen{}\mathclose{{}\left[E_{\textrm{loc}}(x^{(i)})-\frac{1}{N}\sum_{j}^{N%
}E_{\textrm{loc}}(x^{(j)})}\right]\nabla_{\theta}\log q(x^{(i)},\theta)
\theta^{\prime}=\text{optimizer}(\theta,\mathcal{F}_{\theta}^{-1}\Delta\theta^%
{*})
x^{(i)}
q(x,\theta^{\prime})
q(x,\theta^{*})
\{x^{(i)}\}_{i=1}^{N}\sim q(x,\theta^{*})
5\%
1000
(E-E_{0})/E_{0}
1000
5\%
1000
5\%
5\%
1000
(E-E_{0})/E_{0}
1000
5\%
1000
5\%
\displaystyle H=-\frac{1}{2}\nabla_{x}^{2}+\sum_{i<j}\frac{1}{\mathopen{}%
\mathclose{{}\left\lVert x_{i}-x_{j}}\right\rVert}-\sum_{i,I}\frac{Z_{I}}{%
\mathopen{}\mathclose{{}\left\lVert x_{i}-X_{I}}\right\rVert}+\sum_{I<J}\frac{%
Z_{I}Z_{J}}{\mathopen{}\mathclose{{}\left\lVert X_{I}-X_{J}}\right\rVert}\,,
\displaystyle H=-\frac{1}{2}\nabla_{x}^{2}+\sum_{i<j}\frac{1}{\mathopen{}%
\mathclose{{}\left\lVert x_{i}-x_{j}}\right\rVert}-\sum_{i,I}\frac{Z_{I}}{%
\mathopen{}\mathclose{{}\left\lVert x_{i}-X_{I}}\right\rVert}+\sum_{I<J}\frac{%
Z_{I}Z_{J}}{\mathopen{}\mathclose{{}\left\lVert X_{I}-X_{J}}\right\rVert}\,,
x_{i}
X_{I},Z_{I}
x
\psi(x)
\psi
\psi(x,\theta)
q(x,\theta)=\mathopen{}\mathclose{{}\left|\psi(x,\theta)}\right|^{2}
\tanh
\nabla_{x}E_{\textrm{loc}}(x)
\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q(x,\theta)}\right\rVert
\mathbb{E}_{q(x,\theta)}\mathopen{}\mathclose{{}\left[\mathopen{}\mathclose{{}%
\left|\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q(x,\theta)}\right%
\rVert-\textrm{median}(\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q(x,%
\theta)}\right\rVert)}\right|}\right]
10
20
10
20
10
20
F[q]:\mathcal{P}_{2}\to\mathbb{R}
h
\displaystyle F[q+h]=F[q]+\mathrm{d}F[h]+o(\mathopen{}\mathclose{{}\left\lVert
h%
}\right\rVert),\;\;\mathrm{d}F[h]=\int\,\mathrm{d}x\;h(x)\underbrace{\frac{%
\delta F[q]}{\delta q}(x)}_{\text{derivative}}.
\displaystyle F[q+h]=F[q]+\mathrm{d}F[h]+o(\mathopen{}\mathclose{{}\left\lVert
h%
}\right\rVert),\;\;\mathrm{d}F[h]=\int\,\mathrm{d}x\;h(x)\underbrace{\frac{%
\delta F[q]}{\delta q}(x)}_{\text{derivative}}.
\displaystyle F\bigg{[}q_{t}+\Delta t\frac{\partial q_{t}}{\partial t}\bigg{]}%
=F[q_{t}]+\Delta t\cdot\mathrm{d}F\bigg{[}\frac{\partial q_{t}}{\partial t}%
\bigg{]}+o(\mathopen{}\mathclose{{}\left\lVert h}\right\rVert),\;\;\mathrm{d}F%
\bigg{[}\frac{\partial q_{t}}{\partial t}\bigg{]}=\int\,\mathrm{d}x\;\frac{%
\partial q_{t}(x)}{\partial t}\frac{\delta F[q_{t}]}{\delta q_{t}}(x).
\displaystyle F\bigg{[}q_{t}+\Delta t\frac{\partial q_{t}}{\partial t}\bigg{]}%
=F[q_{t}]+\Delta t\cdot\mathrm{d}F\bigg{[}\frac{\partial q_{t}}{\partial t}%
\bigg{]}+o(\mathopen{}\mathclose{{}\left\lVert h}\right\rVert),\;\;\mathrm{d}F%
\bigg{[}\frac{\partial q_{t}}{\partial t}\bigg{]}=\int\,\mathrm{d}x\;\frac{%
\partial q_{t}(x)}{\partial t}\frac{\delta F[q_{t}]}{\delta q_{t}}(x).
\displaystyle\frac{\mathrm{d}}{\mathrm{d}t}F[q_{t}]=\mathrm{d}F\bigg{[}\frac{%
\partial q_{t}}{\partial t}\bigg{]}=\int\,\mathrm{d}x\;\frac{\partial q_{t}(x)%
}{\partial t}\frac{\delta F[q_{t}]}{\delta q_{t}}(x).
\displaystyle\frac{\mathrm{d}}{\mathrm{d}t}F[q_{t}]=\mathrm{d}F\bigg{[}\frac{%
\partial q_{t}}{\partial t}\bigg{]}=\int\,\mathrm{d}x\;\frac{\partial q_{t}(x)%
}{\partial t}\frac{\delta F[q_{t}]}{\delta q_{t}}(x).
\displaystyle\inf_{q^{\prime}}F[q^{\prime}]-F[q]+\frac{1}{2\Delta t}W_{2}%
\mathopen{}\mathclose{{}\left(q,q^{\prime}}\right),
\displaystyle\inf_{q^{\prime}}F[q^{\prime}]-F[q]+\frac{1}{2\Delta t}W_{2}%
\mathopen{}\mathclose{{}\left(q,q^{\prime}}\right),
\displaystyle\frac{\partial q_{t}}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right),\;\;\text{ and }\;\;q^{\prime}(x)=%
q(x)-\Delta t\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q(x)v(x)}\right)+o(%
\Delta t).
\displaystyle\frac{\partial q_{t}}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right),\;\;\text{ and }\;\;q^{\prime}(x)=%
q(x)-\Delta t\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q(x)v(x)}\right)+o(%
\Delta t).
W_{2}
\displaystyle W_{2}\mathopen{}\mathclose{{}\left(q,q^{\prime}}\right)^{2}=\int%
\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left\lVert x-T^{*}(x)}\right\rVert%
^{2}=\Delta t^{2}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left\lVert v^%
{*}(x)}\right\rVert^{2},
\displaystyle W_{2}\mathopen{}\mathclose{{}\left(q,q^{\prime}}\right)^{2}=\int%
\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left\lVert x-T^{*}(x)}\right\rVert%
^{2}=\Delta t^{2}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left\lVert v^%
{*}(x)}\right\rVert^{2},
T^{*}(x)
v^{*}(x)
\displaystyle\inf_{v}F[q]-\Delta t\int\,\mathrm{d}x\;\nabla_{x}\cdot\mathopen{%
}\mathclose{{}\left(q(x)v(x)}\right)\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-F[%
q]+\frac{\Delta t}{2}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left%
\lVert v(x)}\right\rVert^{2},
\displaystyle\inf_{v}F[q]-\Delta t\int\,\mathrm{d}x\;\nabla_{x}\cdot\mathopen{%
}\mathclose{{}\left(q(x)v(x)}\right)\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-F[%
q]+\frac{\Delta t}{2}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left%
\lVert v(x)}\right\rVert^{2},
\displaystyle\inf_{v}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left%
\langle v(x),\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rangle+%
\frac{1}{2}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left\lVert v(x)}%
\right\rVert^{2},
\displaystyle\inf_{v}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left%
\langle v(x),\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rangle+%
\frac{1}{2}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left\lVert v(x)}%
\right\rVert^{2},
\displaystyle\inf_{v}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left%
\lVert v(x)+\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rVert^{2}.
\displaystyle\inf_{v}\int\,\mathrm{d}x\;q(x)\mathopen{}\mathclose{{}\left%
\lVert v(x)+\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rVert^{2}.
\displaystyle v(x)=-\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x).
\displaystyle v(x)=-\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x).
\displaystyle\inf_{q^{\prime}}F[q^{\prime}]-F[q]+\frac{1}{2\Delta t}D_{\mathrm%
{KL}}\mathopen{}\mathclose{{}\left(q^{\prime}\middle\|q}\right),
\displaystyle\inf_{q^{\prime}}F[q^{\prime}]-F[q]+\frac{1}{2\Delta t}D_{\mathrm%
{KL}}\mathopen{}\mathclose{{}\left(q^{\prime}\middle\|q}\right),
\displaystyle\frac{\partial q_{t}}{\partial t}=~{}-g_{t}(x)q_{t}(x),\;\;\text{%
 hence },
\displaystyle\frac{\partial q_{t}}{\partial t}=~{}
\displaystyle-g_{t}(x)q_{t}(x),\;\;\text{ hence },
\displaystyle q^{\prime}(x)=~{}q_{t}(x)-\Delta t\;q_{t}(x)g_{t}(x)+o(\Delta t)%
,\;\;\text{ and }\;\;
\displaystyle q^{\prime}(x)=~{}
\displaystyle q_{t}(x)-\Delta t\;q_{t}(x)g_{t}(x)+o(\Delta t),\;\;\text{ and }\;\;
\displaystyle\log q^{\prime}(x)=~{}\log q_{t}(x)-\Delta t\;g_{t}(x)+\frac{%
\Delta t^{2}}{2}\frac{\partial^{2}\log q_{t}(x)}{\partial t^{2}}+o(\Delta t^{2%
}).
\displaystyle\log q^{\prime}(x)=~{}
\displaystyle\log q_{t}(x)-\Delta t\;g_{t}(x)+\frac{\Delta t^{2}}{2}\frac{%
\partial^{2}\log q_{t}(x)}{\partial t^{2}}+o(\Delta t^{2}).
\displaystyle D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q^{\prime}\middle\|%
q}\right)=~{}\int\,\mathrm{d}x\;q^{\prime}(x)\mathopen{}\mathclose{{}\left(-%
\Delta t\;g_{t}(x)+\frac{\Delta t^{2}}{2}\frac{\partial^{2}\log q_{t}(x)}{%
\partial t^{2}}}\right)+o(\Delta t^{2})
\displaystyle D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q^{\prime}\middle\|%
q}\right)=~{}
\displaystyle\int\,\mathrm{d}x\;q^{\prime}(x)\mathopen{}\mathclose{{}\left(-%
\Delta t\;g_{t}(x)+\frac{\Delta t^{2}}{2}\frac{\partial^{2}\log q_{t}(x)}{%
\partial t^{2}}}\right)+o(\Delta t^{2})
\displaystyle=~{}-\Delta t\int\,\mathrm{d}x\;q_{t}(x)g_{t}(x)+\frac{\Delta t^{%
2}}{2}\int\,\mathrm{d}x\;q_{t}(x)\frac{\partial^{2}\log q_{t}(x)}{\partial t^{%
2}}
\displaystyle=~{}
\displaystyle-\Delta t\int\,\mathrm{d}x\;q_{t}(x)g_{t}(x)+\frac{\Delta t^{2}}{%
2}\int\,\mathrm{d}x\;q_{t}(x)\frac{\partial^{2}\log q_{t}(x)}{\partial t^{2}}
\displaystyle+\Delta t^{2}\int dx\;q_{t}(x)g_{t}(x)+o(\Delta t^{2})
\displaystyle+\Delta t^{2}\int dx\;q_{t}(x)g_{t}(x)+o(\Delta t^{2})
\displaystyle=~{}\frac{\Delta t^{2}}{2}\int\,\mathrm{d}x\;q_{t}(x)g_{t}^{2}(x)%
+o(\Delta t^{2}).
\displaystyle=~{}
\displaystyle\frac{\Delta t^{2}}{2}\int\,\mathrm{d}x\;q_{t}(x)g_{t}^{2}(x)+o(%
\Delta t^{2}).
\displaystyle\int\,\mathrm{d}x\;\frac{\partial q_{t}(x)}{\partial t}=\int\,%
\mathrm{d}x\;g_{t}(x)q_{t}(x)=0.
\displaystyle\int\,\mathrm{d}x\;\frac{\partial q_{t}(x)}{\partial t}=\int\,%
\mathrm{d}x\;g_{t}(x)q_{t}(x)=0.
\displaystyle\inf_{g}F[q]+\Delta t\int dx\;g(x)q(x)\frac{\delta F[q_{t}]}{%
\delta q_{t}}(x)-F[q]+\frac{\Delta t}{4}\int dx\;q(x)g(x)^{2},
\displaystyle\inf_{g}F[q]+\Delta t\int dx\;g(x)q(x)\frac{\delta F[q_{t}]}{%
\delta q_{t}}(x)-F[q]+\frac{\Delta t}{4}\int dx\;q(x)g(x)^{2},
\displaystyle\inf_{g}\int dx\;q(x)g(x)\mathopen{}\mathclose{{}\left(\frac{%
\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q(y)}\mathopen{}\mathclose{{}%
\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}\right]}\right)+\frac{1}{4}\int
dx%
\;q(x)g(x)^{2},
\displaystyle\inf_{g}\int dx\;q(x)g(x)\mathopen{}\mathclose{{}\left(\frac{%
\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q(y)}\mathopen{}\mathclose{{}%
\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}\right]}\right)+\frac{1}{4}\int
dx%
\;q(x)g(x)^{2},
\displaystyle\inf_{g}\int dx\;q(x)\mathopen{}\mathclose{{}\left[g(x)+2%
\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{%
E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)%
}\right]}\right)}\right]^{2}.
\displaystyle\inf_{g}\int dx\;q(x)\mathopen{}\mathclose{{}\left[g(x)+2%
\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{%
E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)%
}\right]}\right)}\right]^{2}.
\displaystyle g(x)=-2\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{%
\delta q_{t}}(x)-\mathbb{E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F%
[q_{t}]}{\delta q_{t}}(y)}\right]}\right).
\displaystyle g(x)=-2\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{%
\delta q_{t}}(x)-\mathbb{E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F%
[q_{t}]}{\delta q_{t}}(y)}\right]}\right).
D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(\cdot\middle\|\cdot}\right)
\displaystyle\mathrm{WFR}_{\lambda}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}%
\right)^{2}\coloneqq\inf_{v_{t},g_{t},q_{t}}\int_{0}^{1}\;\mathbb{E}_{q_{t}(x)%
}\mathopen{}\mathclose{{}\left[\mathopen{}\mathclose{{}\left\lVert v_{t}(x)}%
\right\rVert^{2}+\lambda g_{t}(x)^{2}}\right]\,\mathrm{d}t,\;\;\text{ subj. to}
\displaystyle\mathrm{WFR}_{\lambda}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}%
\right)^{2}
\displaystyle\coloneqq\inf_{v_{t},g_{t},q_{t}}\int_{0}^{1}\;\mathbb{E}_{q_{t}(%
x)}\mathopen{}\mathclose{{}\left[\mathopen{}\mathclose{{}\left\lVert v_{t}(x)}%
\right\rVert^{2}+\lambda g_{t}(x)^{2}}\right]\,\mathrm{d}t,\;\;\text{ subj. to}
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right)+g_{t}(x)q_{t}(x)\,,\;\;q_{0}(x)=p_%
{0}(x),\;\;q_{1}(x)=p_{1}(x)\,.
\displaystyle\frac{\partial q_{t}(x)}{\partial t}
\displaystyle=-\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q_{t}(x)v_{t}(x)}%
\right)+g_{t}(x)q_{t}(x)\,,\;\;q_{0}(x)=p_{0}(x),\;\;q_{1}(x)=p_{1}(x)\,.
\displaystyle\inf_{q^{\prime}}F[q^{\prime}]-F[q]+\frac{1}{2\Delta t}\mathrm{%
WFR}_{\lambda}\mathopen{}\mathclose{{}\left(q,q^{\prime}}\right)^{2},
\displaystyle\inf_{q^{\prime}}F[q^{\prime}]-F[q]+\frac{1}{2\Delta t}\mathrm{%
WFR}_{\lambda}\mathopen{}\mathclose{{}\left(q,q^{\prime}}\right)^{2},
\displaystyle\frac{\partial q_{t}}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right)+g_{t}(x)q_{t}(x).
\displaystyle\frac{\partial q_{t}}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right)+g_{t}(x)q_{t}(x).
q
q^{\prime}
\mathrm{WFR}_{\lambda}\mathopen{}\mathclose{{}\left(q,q^{\prime}}\right)^{2}
\mathopen{}\mathclose{{}\left|\mu_{t}^{\prime}}\right|^{2}
\displaystyle\mathopen{}\mathclose{{}\left|\mu_{t}^{\prime}}\right|^{2}=%
\mathopen{}\mathclose{{}\left(\lim_{\Delta t\to 0}\frac{\mathrm{WFR}_{\lambda}%
\mathopen{}\mathclose{{}\left(q_{t},q_{t+\Delta t}}\right)}{\Delta t}}\right)^%
{2},
\displaystyle\mathopen{}\mathclose{{}\left|\mu_{t}^{\prime}}\right|^{2}=%
\mathopen{}\mathclose{{}\left(\lim_{\Delta t\to 0}\frac{\mathrm{WFR}_{\lambda}%
\mathopen{}\mathclose{{}\left(q_{t},q_{t+\Delta t}}\right)}{\Delta t}}\right)^%
{2},
\displaystyle\mathrm{WFR}_{\lambda}\mathopen{}\mathclose{{}\left(q,q^{\prime}}%
\right)^{2}=\Delta t^{2}\mathopen{}\mathclose{{}\left|\mu_{t}^{\prime}}\right|%
^{2}=\Delta t^{2}\int dx\;q(x)\bigg{[}\mathopen{}\mathclose{{}\left\lVert v^{*%
}(x)}\right\rVert^{2}+\lambda g^{*}(x)^{2}\bigg{]}.
\displaystyle\mathrm{WFR}_{\lambda}\mathopen{}\mathclose{{}\left(q,q^{\prime}}%
\right)^{2}=\Delta t^{2}\mathopen{}\mathclose{{}\left|\mu_{t}^{\prime}}\right|%
^{2}=\Delta t^{2}\int dx\;q(x)\bigg{[}\mathopen{}\mathclose{{}\left\lVert v^{*%
}(x)}\right\rVert^{2}+\lambda g^{*}(x)^{2}\bigg{]}.
\displaystyle\inf_{g,v}~{}F[q]-\Delta t\int dx\;\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q(x)v(x)}\right)\frac{\delta F[q_{t}]}{\delta q_{t}}(x)+%
\int dx\;q(x)g(x)\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-F[q]
\displaystyle\inf_{g,v}~{}
\displaystyle F[q]-\Delta t\int dx\;\nabla_{x}\cdot\mathopen{}\mathclose{{}%
\left(q(x)v(x)}\right)\frac{\delta F[q_{t}]}{\delta q_{t}}(x)+\int dx\;q(x)g(x%
)\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-F[q]
\displaystyle+\frac{\Delta t}{2}\int dx\;q(x)\bigg{[}\mathopen{}\mathclose{{}%
\left\lVert v(x)}\right\rVert^{2}+\lambda g(x)^{2}\bigg{]},
\displaystyle+\frac{\Delta t}{2}\int dx\;q(x)\bigg{[}\mathopen{}\mathclose{{}%
\left\lVert v(x)}\right\rVert^{2}+\lambda g(x)^{2}\bigg{]},
\displaystyle\inf_{g,v}~{}\int dx\;q(x)\mathopen{}\mathclose{{}\left\langle v(%
x),\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rangle+\int dx\;q(%
x)g(x)\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-%
\mathbb{E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q%
_{t}}(y)}\right]}\right)
\displaystyle\inf_{g,v}~{}
\displaystyle\int dx\;q(x)\mathopen{}\mathclose{{}\left\langle v(x),\nabla_{x}%
\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rangle+\int dx\;q(x)g(x)%
\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{%
E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)%
}\right]}\right)
\displaystyle+\frac{1}{2}\int dx\;q(x)\bigg{[}\mathopen{}\mathclose{{}\left%
\lVert v(x)}\right\rVert^{2}+\lambda g(x)^{2}\bigg{]},
\displaystyle+\frac{1}{2}\int dx\;q(x)\bigg{[}\mathopen{}\mathclose{{}\left%
\lVert v(x)}\right\rVert^{2}+\lambda g(x)^{2}\bigg{]},
\displaystyle\inf_{g,v}~{}\int dx\;q(x)\mathopen{}\mathclose{{}\left\lVert v(x%
)+\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rVert^{2}
\displaystyle\inf_{g,v}~{}
\displaystyle\int dx\;q(x)\mathopen{}\mathclose{{}\left\lVert v(x)+\nabla_{x}%
\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rVert^{2}
\displaystyle+\lambda\int dx\;q(x)\mathopen{}\mathclose{{}\left(g(x)+\frac{1}{%
\lambda}\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-%
\mathbb{E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q%
_{t}}(y)}\right]}\right)}\right)^{2}.
\displaystyle+\lambda\int dx\;q(x)\mathopen{}\mathclose{{}\left(g(x)+\frac{1}{%
\lambda}\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-%
\mathbb{E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q%
_{t}}(y)}\right]}\right)}\right)^{2}.
\displaystyle v(x)=-\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x),\;\;\;g(%
x)=-\frac{1}{\lambda}\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{%
\delta q_{t}}(x)-\mathbb{E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F%
[q_{t}]}{\delta q_{t}}(y)}\right]}\right).
\displaystyle v(x)=-\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x),\;\;\;g(%
x)=-\frac{1}{\lambda}\mathopen{}\mathclose{{}\left(\frac{\delta F[q_{t}]}{%
\delta q_{t}}(x)-\mathbb{E}_{q(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F%
[q_{t}]}{\delta q_{t}}(y)}\right]}\right).
\lambda
\lambda\to\infty
g(x)\to 0
W_{2}
\lambda\to 0
\lambda\to 0
q_{t}
v_{t}(x)
g_{t}(x)
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right)+g_{t}(x)q_{t}(x).
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right)+g_{t}(x)q_{t}(x).
F[q]
\displaystyle\frac{\mathrm{d}}{\mathrm{d}t}F[q_{t}]=~{}-\int\,\mathrm{d}x\;%
\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right)\frac{%
\delta F[q_{t}]}{\delta q_{t}}(x)+\int\,\mathrm{d}x\;q_{t}(x)g_{t}(x)\frac{%
\delta F[q_{t}]}{\delta q_{t}}(x)
\displaystyle\frac{\mathrm{d}}{\mathrm{d}t}F[q_{t}]=~{}
\displaystyle-\int\,\mathrm{d}x\;\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(%
q_{t}(x)v_{t}(x)}\right)\frac{\delta F[q_{t}]}{\delta q_{t}}(x)+\int\,\mathrm{%
d}x\;q_{t}(x)g_{t}(x)\frac{\delta F[q_{t}]}{\delta q_{t}}(x)
\displaystyle=~{}\int\,\mathrm{d}x\;q_{t}(x)\mathopen{}\mathclose{{}\left%
\langle v_{t}(x),\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right%
\rangle+\int\,\mathrm{d}x\;q_{t}(x)g_{t}(x)\frac{\delta F[q_{t}]}{\delta q_{t}%
}(x).
\displaystyle=~{}
\displaystyle\int\,\mathrm{d}x\;q_{t}(x)\mathopen{}\mathclose{{}\left\langle v%
_{t}(x),\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rangle+\int\,%
\mathrm{d}x\;q_{t}(x)g_{t}(x)\frac{\delta F[q_{t}]}{\delta q_{t}}(x).
v_{t}(x)
g_{t}(x)
F[q]
\displaystyle v_{t}(x)=-\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x),\;\;%
g_{t}(x)=-\frac{1}{\lambda}\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-%
\mathbb{E}_{q_{t}(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{%
\delta q_{t}}(y)}\right]\bigg{)},
\displaystyle v_{t}(x)=-\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x),\;\;%
g_{t}(x)=-\frac{1}{\lambda}\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-%
\mathbb{E}_{q_{t}(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{%
\delta q_{t}}(y)}\right]\bigg{)},
\displaystyle\frac{\mathrm{d}}{\mathrm{d}t}F[q_{t}]=~{}-\int\,\mathrm{d}x\;q_{%
t}(x)\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\frac{\delta F[q_{t}]}{%
\delta q_{t}}(x)}\right\rVert^{2}-\frac{1}{\lambda}\int\,\mathrm{d}x\;q_{t}(x)%
\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_{t}(y)}\frac{%
\delta F[q_{t}]}{\delta q_{t}}(y)\bigg{)}^{2}
\displaystyle\frac{\mathrm{d}}{\mathrm{d}t}F[q_{t}]=~{}
\displaystyle-\int\,\mathrm{d}x\;q_{t}(x)\mathopen{}\mathclose{{}\left\lVert%
\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)}\right\rVert^{2}-\frac{1}{%
\lambda}\int\,\mathrm{d}x\;q_{t}(x)\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}%
}(x)-\mathbb{E}_{q_{t}(y)}\frac{\delta F[q_{t}]}{\delta q_{t}}(y)\bigg{)}^{2}
\displaystyle-\frac{1}{\lambda}\underbrace{\int\,\mathrm{d}x\;q_{t}(x)\bigg{(}%
\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_{t}(y)}\mathopen{}%
\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}\right]\bigg{)}}_{=%
0}\mathbb{E}_{q_{t}(z)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{%
\delta q_{t}}(z)}\right]\leq 0.
\displaystyle-\frac{1}{\lambda}\underbrace{\int\,\mathrm{d}x\;q_{t}(x)\bigg{(}%
\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_{t}(y)}\mathopen{}%
\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}\right]\bigg{)}}_{=%
0}\mathbb{E}_{q_{t}(z)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{%
\delta q_{t}}(z)}\right]\leq 0.
\displaystyle\int\,\mathrm{d}x\;\frac{\partial q_{t}}{\partial t}(x)=\int\,%
\mathrm{d}x\;g_{t}(x)q_{t}(x)=-\int\,\mathrm{d}x\;q_{t}(x)\bigg{(}\frac{\delta
F%
[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_{t}(y)}\mathopen{}\mathclose{{}\left[%
\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}\right]\bigg{)}=0.
\displaystyle\int\,\mathrm{d}x\;\frac{\partial q_{t}}{\partial t}(x)=\int\,%
\mathrm{d}x\;g_{t}(x)q_{t}(x)=-\int\,\mathrm{d}x\;q_{t}(x)\bigg{(}\frac{\delta
F%
[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_{t}(y)}\mathopen{}\mathclose{{}\left[%
\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}\right]\bigg{)}=0.
F[q]
q_{t}
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=\underbrace{-\nabla_{x}\cdot%
\mathopen{}\mathclose{{}\left(q_{t}(x)\bigg{(}-\nabla_{x}\frac{\delta F[q_{t}]%
}{\delta q_{t}}(x)\bigg{)}}\right)}_{\text{the continuity equation}}-\frac{1}{%
\lambda}\underbrace{\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}%
_{q_{t}(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(%
y)}\right]\bigg{)}}_{\text{growth term}}q_{t}(x),
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=\underbrace{-\nabla_{x}\cdot%
\mathopen{}\mathclose{{}\left(q_{t}(x)\bigg{(}-\nabla_{x}\frac{\delta F[q_{t}]%
}{\delta q_{t}}(x)\bigg{)}}\right)}_{\text{the continuity equation}}-\frac{1}{%
\lambda}\underbrace{\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}%
_{q_{t}(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(%
y)}\right]\bigg{)}}_{\text{growth term}}q_{t}(x),
\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{%
t}}(x)}\right\rVert^{2}=0
\frac{\delta F[q_{t}]}{\delta q_{t}}(x)\equiv\text{constant}
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=~{}-\nabla_{x}\cdot\mathopen%
{}\mathclose{{}\left(q_{t}(x)\bigg{(}-\nabla_{x}\frac{\delta F[q_{t}]}{\delta q%
_{t}}(x)\bigg{)}}\right),
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=~{}
\displaystyle-\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q_{t}(x)\bigg{(}-%
\nabla_{x}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)\bigg{)}}\right),
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=~{}-\bigg{(}\frac{\delta F[q%
_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_{t}(y)}\mathopen{}\mathclose{{}\left[%
\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}\right]\bigg{)}q_{t}(x).
\displaystyle\frac{\partial q_{t}}{\partial t}(x)=~{}
\displaystyle-\bigg{(}\frac{\delta F[q_{t}]}{\delta q_{t}}(x)-\mathbb{E}_{q_{t%
}(y)}\mathopen{}\mathclose{{}\left[\frac{\delta F[q_{t}]}{\delta q_{t}}(y)}%
\right]\bigg{)}q_{t}(x).
\mathbb{E}[q]
E[q]
F(q)
h
\displaystyle\mathrm{d}F(q)[h]=\int\,\mathrm{d}x\;h\cdot\frac{\delta F[q]}{%
\delta q},
\displaystyle\mathrm{d}F(q)[h]=\int\,\mathrm{d}x\;h\cdot\frac{\delta F[q]}{%
\delta q},
\delta F[q]/\delta q
\displaystyle E[q]=\int\,\mathrm{d}x\;q\bigg{[}V-\frac{1}{4}\nabla_{x}^{2}\log
q%
-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q}\right\rVert^{%
2}\bigg{]}.
\displaystyle E[q]=\int\,\mathrm{d}x\;q\bigg{[}V-\frac{1}{4}\nabla_{x}^{2}\log
q%
-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q}\right\rVert^{%
2}\bigg{]}.
\displaystyle\mathrm{d}E(q)[h]=~{}\frac{\partial E(q+\varepsilon\cdot h)}{%
\partial\varepsilon}\bigg{|}_{\varepsilon=0}
\displaystyle\mathrm{d}E(q)[h]=
\displaystyle~{}\frac{\partial E(q+\varepsilon\cdot h)}{\partial\varepsilon}%
\bigg{|}_{\varepsilon=0}
\displaystyle=~{}\int\,\mathrm{d}x\;h\bigg{[}V-\frac{1}{4}\nabla_{x}^{2}\log q%
-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q}\right\rVert^{%
2}\bigg{]}-\int\,\mathrm{d}x\;q\bigg{[}\frac{1}{4}\nabla_{x}^{2}\frac{h}{q}+%
\frac{1}{4}\langle\nabla_{x}\log q,\nabla_{x}\frac{h}{q}\rangle\bigg{]}.
\displaystyle=
\displaystyle~{}\int\,\mathrm{d}x\;h\bigg{[}V-\frac{1}{4}\nabla_{x}^{2}\log q-%
\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q}\right\rVert^{2%
}\bigg{]}-\int\,\mathrm{d}x\;q\bigg{[}\frac{1}{4}\nabla_{x}^{2}\frac{h}{q}+%
\frac{1}{4}\langle\nabla_{x}\log q,\nabla_{x}\frac{h}{q}\rangle\bigg{]}.
\displaystyle\int\,\mathrm{d}x\;q\bigg{[}\frac{1}{4}\nabla_{x}^{2}\frac{h}{q}+%
\frac{1}{4}\langle\nabla_{x}\log q,\nabla_{x}\frac{h}{q}\rangle\bigg{]}=-\frac%
{1}{4}\int\,\mathrm{d}x\;\mathopen{}\mathclose{{}\left\langle\nabla_{x}q,%
\nabla_{x}\frac{h}{q}}\right\rangle+\frac{1}{4}\int\,\mathrm{d}x\;\mathopen{}%
\mathclose{{}\left\langle\nabla_{x}q,\nabla_{x}\frac{h}{q}}\right\rangle=0.
\displaystyle\int\,\mathrm{d}x\;q\bigg{[}\frac{1}{4}\nabla_{x}^{2}\frac{h}{q}+%
\frac{1}{4}\langle\nabla_{x}\log q,\nabla_{x}\frac{h}{q}\rangle\bigg{]}=-\frac%
{1}{4}\int\,\mathrm{d}x\;\mathopen{}\mathclose{{}\left\langle\nabla_{x}q,%
\nabla_{x}\frac{h}{q}}\right\rangle+\frac{1}{4}\int\,\mathrm{d}x\;\mathopen{}%
\mathclose{{}\left\langle\nabla_{x}q,\nabla_{x}\frac{h}{q}}\right\rangle=0.
\displaystyle\mathrm{d}E(q)[h]=\int\,\mathrm{d}x\;h\underbrace{\bigg{[}V-\frac%
{1}{4}\nabla_{x}^{2}\log q-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert%
\nabla_{x}\log q}\right\rVert^{2}\bigg{]}}_{\delta E[q]/\delta q},
\displaystyle\mathrm{d}E(q)[h]=\int\,\mathrm{d}x\;h\underbrace{\bigg{[}V-\frac%
{1}{4}\nabla_{x}^{2}\log q-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert%
\nabla_{x}\log q}\right\rVert^{2}\bigg{]}}_{\delta E[q]/\delta q},
\displaystyle\frac{\delta E[q]}{\delta q}(x)=E_{\textrm{loc}}(x)=V(x)-\frac{1}%
{4}\nabla_{x}^{2}\log q(x)-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert%
\nabla_{x}\log q(x)}\right\rVert^{2}.
\displaystyle\frac{\delta E[q]}{\delta q}(x)=E_{\textrm{loc}}(x)=V(x)-\frac{1}%
{4}\nabla_{x}^{2}\log q(x)-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert%
\nabla_{x}\log q(x)}\right\rVert^{2}.
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=~{}-\bigg{[}E_{\textrm{loc}}%
(x)-E[q_{t}]\bigg{]}q_{t}(x).
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=~{}
\displaystyle-\bigg{[}E_{\textrm{loc}}(x)-E[q_{t}]\bigg{]}q_{t}(x).
q_{t}
\displaystyle\frac{\partial\psi_{t}}{\partial t}=~{}\frac{1}{2}\nabla_{x}^{2}%
\psi_{t}-(V-E[q_{t}])\psi_{t}
\displaystyle\frac{\partial\psi_{t}}{\partial t}=~{}
\displaystyle\frac{1}{2}\nabla_{x}^{2}\psi_{t}-(V-E[q_{t}])\psi_{t}
\displaystyle 2\psi_{t}\frac{\partial\psi_{t}}{\partial t}=~{}\psi_{t}\nabla_{%
x}^{2}\psi_{t}-2(V-E[q_{t}])\psi_{t}^{2}
\displaystyle 2\psi_{t}\frac{\partial\psi_{t}}{\partial t}=~{}
\displaystyle\psi_{t}\nabla_{x}^{2}\psi_{t}-2(V-E[q_{t}])\psi_{t}^{2}
\displaystyle\frac{\partial q_{t}}{\partial t}=~{}\psi_{t}\nabla_{x}^{2}\psi_{%
t}-2(V-E[q_{t}])q_{t}
\displaystyle\frac{\partial q_{t}}{\partial t}=~{}
\displaystyle\psi_{t}\nabla_{x}^{2}\psi_{t}-2(V-E[q_{t}])q_{t}
\displaystyle\psi\nabla_{x}^{2}\psi=~{}\psi\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(\psi\nabla_{x}\log|\psi|}\right)=\mathopen{}\mathclose{{}%
\left\langle\psi\nabla_{x}\psi,\nabla_{x}\log|\psi|}\right\rangle+\psi^{2}%
\nabla_{x}^{2}\log|\psi|
\displaystyle\psi\nabla_{x}^{2}\psi=~{}
\displaystyle\psi\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(\psi\nabla_{x}%
\log|\psi|}\right)=\mathopen{}\mathclose{{}\left\langle\psi\nabla_{x}\psi,%
\nabla_{x}\log|\psi|}\right\rangle+\psi^{2}\nabla_{x}^{2}\log|\psi|
\displaystyle=~{}\frac{1}{4}\mathopen{}\mathclose{{}\left\langle\nabla_{x}q,%
\nabla_{x}\log q}\right\rangle+\frac{1}{2}q\nabla_{x}^{2}\log q=\frac{1}{4}q%
\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q}\right\rVert^{2}+\frac{1}{%
2}q\nabla_{x}^{2}\log q,
\displaystyle=~{}
\displaystyle\frac{1}{4}\mathopen{}\mathclose{{}\left\langle\nabla_{x}q,\nabla%
_{x}\log q}\right\rangle+\frac{1}{2}q\nabla_{x}^{2}\log q=\frac{1}{4}q%
\mathopen{}\mathclose{{}\left\lVert\nabla_{x}\log q}\right\rVert^{2}+\frac{1}{%
2}q\nabla_{x}^{2}\log q,
\displaystyle\frac{\partial q_{t}}{\partial t}=~{}-2\bigg{[}V-\frac{1}{4}%
\nabla_{x}^{2}\log q-\frac{1}{8}\mathopen{}\mathclose{{}\left\lVert\nabla_{x}%
\log q_{t}}\right\rVert^{2}-E[q_{t}]\bigg{]}q_{t}
\displaystyle\frac{\partial q_{t}}{\partial t}=~{}
\displaystyle-2\bigg{[}V-\frac{1}{4}\nabla_{x}^{2}\log q-\frac{1}{8}\mathopen{%
}\mathclose{{}\left\lVert\nabla_{x}\log q_{t}}\right\rVert^{2}-E[q_{t}]\bigg{]%
}q_{t}
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=~{}-2\bigg{[}E_{\textrm{loc}%
}(x)-E[q_{t}]\bigg{]}q_{t}(x),
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=~{}
\displaystyle-2\bigg{[}E_{\textrm{loc}}(x)-E[q_{t}]\bigg{]}q_{t}(x),
q_{t}(x)=q(x,\theta)
\displaystyle\begin{split}D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t+%
\Delta t}(x)\middle\|q(x,\theta+\Delta\theta)}\right)=~{}&-\frac{1}{2}\Delta t%
\mathopen{}\mathclose{{}\left\langle\Delta\theta,\int\frac{\partial}{\partial t%
}q_{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x}\right\rangle\\
~{}&+o\mathopen{}\mathclose{{}\left(\sqrt{\Delta t^{2}+\mathopen{}\mathclose{{%
}\left\lVert\Delta\theta}\right\rVert^{2}}}\right)\end{split}
\displaystyle\begin{split}D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t+%
\Delta t}(x)\middle\|q(x,\theta+\Delta\theta)}\right)=~{}&-\frac{1}{2}\Delta t%
\mathopen{}\mathclose{{}\left\langle\Delta\theta,\int\frac{\partial}{\partial t%
}q_{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x}\right\rangle\\
~{}&+o\mathopen{}\mathclose{{}\left(\sqrt{\Delta t^{2}+\mathopen{}\mathclose{{%
}\left\lVert\Delta\theta}\right\rVert^{2}}}\right)\end{split}
\displaystyle D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t}(x)\middle\|q(%
x,\theta)}\right)=~{}\int q_{t}(x)\log\frac{q_{t}(x)}{q(x,\theta)}\,\mathrm{d}x
\displaystyle D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t}(x)\middle\|q(%
x,\theta)}\right)=~{}
\displaystyle\int q_{t}(x)\log\frac{q_{t}(x)}{q(x,\theta)}\,\mathrm{d}x
\displaystyle\implies\frac{\mathbf{\partial}}{\mathbf{\partial}\theta}D_{%
\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t}(x)\middle\|q(x,\theta)}\right)%
=~{}-\int q_{t}(x)\frac{\mathbf{\partial}}{\mathbf{\partial}\theta}\log q(x,%
\theta)\,\mathrm{d}x
\displaystyle\implies\frac{\mathbf{\partial}}{\mathbf{\partial}\theta}D_{%
\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t}(x)\middle\|q(x,\theta)}\right)%
=~{}
\displaystyle-\int q_{t}(x)\frac{\mathbf{\partial}}{\mathbf{\partial}\theta}%
\log q(x,\theta)\,\mathrm{d}x
\displaystyle=~{}\begin{cases}0&q_{t}(x)=q(x,\theta)\\
-\int q_{t}(x)\frac{\mathbf{\partial}}{\mathbf{\partial}\theta}\log q(x,\theta%
)\,\mathrm{d}x&q_{t}(x)\neq q(x,\theta)\end{cases}
\displaystyle=~{}
\displaystyle\begin{cases}0&q_{t}(x)=q(x,\theta)\\
-\int q_{t}(x)\frac{\mathbf{\partial}}{\mathbf{\partial}\theta}\log q(x,\theta%
)\,\mathrm{d}x&q_{t}(x)\neq q(x,\theta)\end{cases}
\displaystyle\implies\frac{\partial}{\partial t}D_{\mathrm{KL}}\mathopen{}%
\mathclose{{}\left(q_{t}(x)\middle\|q(x,\theta)}\right)=~{}\frac{\partial}{%
\partial t}\int q_{t}(x)\log q_{t}(x)\,\mathrm{d}x-\int\frac{\partial}{%
\partial t}q_{t}(x)\log q(x,\theta)\,\mathrm{d}x
\displaystyle\implies\frac{\partial}{\partial t}D_{\mathrm{KL}}\mathopen{}%
\mathclose{{}\left(q_{t}(x)\middle\|q(x,\theta)}\right)=~{}
\displaystyle\frac{\partial}{\partial t}\int q_{t}(x)\log q_{t}(x)\,\mathrm{d}%
x-\int\frac{\partial}{\partial t}q_{t}(x)\log q(x,\theta)\,\mathrm{d}x
\displaystyle=~{}\int\frac{\partial}{\partial t}q_{t}(x)\log q_{t}(x)\,\mathrm%
{d}x+\int q_{t}(x)\frac{\partial}{\partial t}\log q_{t}(x)\,\mathrm{d}x
\displaystyle=~{}
\displaystyle\int\frac{\partial}{\partial t}q_{t}(x)\log q_{t}(x)\,\mathrm{d}x%
+\int q_{t}(x)\frac{\partial}{\partial t}\log q_{t}(x)\,\mathrm{d}x
\displaystyle-\int\frac{\partial}{\partial t}q_{t}(x)\log q(x,\theta)\,\mathrm%
{d}x
\displaystyle-\int\frac{\partial}{\partial t}q_{t}(x)\log q(x,\theta)\,\mathrm%
{d}x
\displaystyle=~{}\int\frac{\partial}{\partial t}q_{t}(x)\log q_{t}(x)\,\mathrm%
{d}x+\int\frac{\partial}{\partial t}q_{t}(x)\,\mathrm{d}x
\displaystyle=~{}
\displaystyle\int\frac{\partial}{\partial t}q_{t}(x)\log q_{t}(x)\,\mathrm{d}x%
+\int\frac{\partial}{\partial t}q_{t}(x)\,\mathrm{d}x
\displaystyle-\int\frac{\partial}{\partial t}q_{t}(x)\log q(x,\theta)\,\mathrm%
{d}x
\displaystyle-\int\frac{\partial}{\partial t}q_{t}(x)\log q(x,\theta)\,\mathrm%
{d}x
\displaystyle=~{}\int\frac{\partial}{\partial t}q_{t}(x)\mathopen{}\mathclose{%
{}\left[1+\log\frac{q_{t}(x)}{q(x,\theta)}}\right]\,\mathrm{d}x
\displaystyle=~{}
\displaystyle\int\frac{\partial}{\partial t}q_{t}(x)\mathopen{}\mathclose{{}%
\left[1+\log\frac{q_{t}(x)}{q(x,\theta)}}\right]\,\mathrm{d}x
\displaystyle=~{}\begin{cases}0&q_{t}(x)=q(x,\theta)\\
\int\frac{\partial}{\partial t}q_{t}(x)\mathopen{}\mathclose{{}\left[1+\log%
\frac{q_{t}(x)}{q(x,\theta)}}\right]\,\mathrm{d}x&q_{t}(x)\neq q(x,\theta)\end%
{cases}
\displaystyle=~{}
\displaystyle\begin{cases}0&q_{t}(x)=q(x,\theta)\\
\int\frac{\partial}{\partial t}q_{t}(x)\mathopen{}\mathclose{{}\left[1+\log%
\frac{q_{t}(x)}{q(x,\theta)}}\right]\,\mathrm{d}x&q_{t}(x)\neq q(x,\theta)\end%
{cases}
\displaystyle\implies\frac{\mathbf{\partial}^{2}}{\mathbf{\partial}\theta\,%
\mathbf{\partial}t}D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t}(x)%
\middle\|q(x,\theta)}\right)=~{}-\int\frac{\partial}{\partial t}q_{t}(x)\nabla%
\log q(x,\theta)\,\mathrm{d}x
\displaystyle\implies\frac{\mathbf{\partial}^{2}}{\mathbf{\partial}\theta\,%
\mathbf{\partial}t}D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t}(x)%
\middle\|q(x,\theta)}\right)=~{}
\displaystyle-\int\frac{\partial}{\partial t}q_{t}(x)\nabla\log q(x,\theta)\,%
\mathrm{d}x
q_{t}(x)=q(x,\theta)
\displaystyle\implies D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t+\Delta
t%
}(x)\middle\|q(x,\theta+\Delta\theta)}\right)\approx-\frac{1}{2}\Delta t%
\mathopen{}\mathclose{{}\left\langle\Delta\theta,\int\frac{\partial}{\partial t%
}q_{t}(x)\nabla_{\theta}\log q(x,{\theta})\,\mathrm{d}x}\right\rangle\,.
\displaystyle\implies D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(q_{t+\Delta
t%
}(x)\middle\|q(x,\theta+\Delta\theta)}\right)
\displaystyle\approx-\frac{1}{2}\Delta t\mathopen{}\mathclose{{}\left\langle%
\Delta\theta,\int\frac{\partial}{\partial t}q_{t}(x)\nabla_{\theta}\log q(x,{%
\theta})\,\mathrm{d}x}\right\rangle\,.
\displaystyle F[q]=D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(p(x)\middle\|q%
(x)}\right),\;\;\;\frac{\delta F[q]}{\delta q}=-\frac{p(x)}{q(x)},
\displaystyle F[q]=D_{\mathrm{KL}}\mathopen{}\mathclose{{}\left(p(x)\middle\|q%
(x)}\right),\;\;\;\frac{\delta F[q]}{\delta q}=-\frac{p(x)}{q(x)},
p(x)
\displaystyle\frac{\partial q_{t}}{\partial t}(x)={\bigg{(}\frac{p(x)}{q_{t}(x%
)}-\mathbb{E}_{q_{t}(y)}\mathopen{}\mathclose{{}\left[\frac{p(y)}{q_{t}(y)}}%
\right]\bigg{)}q_{t}(x)}=p(x)-q_{t}(x),
\displaystyle\frac{\partial q_{t}}{\partial t}(x)
\displaystyle={\bigg{(}\frac{p(x)}{q_{t}(x)}-\mathbb{E}_{q_{t}(y)}\mathopen{}%
\mathclose{{}\left[\frac{p(y)}{q_{t}(y)}}\right]\bigg{)}q_{t}(x)}=p(x)-q_{t}(x),
\displaystyle\frac{\partial q_{t}}{\partial t}(x)={-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)\nabla_{x}\frac{p(x)}{q_{t}(x)}}\right)},
\displaystyle\frac{\partial q_{t}}{\partial t}(x)
\displaystyle={-\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q_{t}(x)\nabla_{x%
}\frac{p(x)}{q_{t}(x)}}\right)},
\displaystyle\Delta\theta^{*}_{\text{FR}}=-\mathbb{E}_{p(x)}\nabla_{\theta}%
\log q(x,\theta)+\mathbb{E}_{q_{t}(x)}\nabla_{\theta}\log q(x,\theta).
\displaystyle\Delta\theta^{*}_{\text{FR}}=-\mathbb{E}_{p(x)}\nabla_{\theta}%
\log q(x,\theta)+\mathbb{E}_{q_{t}(x)}\nabla_{\theta}\log q(x,\theta).
q_{t}(x)=q(x,\theta)
\theta
\displaystyle\Delta\theta^{*}_{\text{FR}}=-\nabla_{\theta}\mathbb{E}_{p(x)}%
\log q(x,\theta),
\displaystyle\Delta\theta^{*}_{\text{FR}}=-\nabla_{\theta}\mathbb{E}_{p(x)}%
\log q(x,\theta),
q_{t}(x)=q(x,\theta)
\displaystyle\Delta\theta^{*}_{W_{2}}=~{}-\nabla_{\theta}\int dx\;q_{t}(x)%
\mathopen{}\mathclose{{}\left\langle\nabla_{x}\frac{p(x)}{q_{t}(x)},\nabla_{x}%
\log q(x,\theta)}\right\rangle
\displaystyle\Delta\theta^{*}_{W_{2}}=~{}
\displaystyle-\nabla_{\theta}\int dx\;q_{t}(x)\mathopen{}\mathclose{{}\left%
\langle\nabla_{x}\frac{p(x)}{q_{t}(x)},\nabla_{x}\log q(x,\theta)}\right\rangle
\displaystyle=~{}-\nabla_{\theta}\int\,\mathrm{d}x\;\mathopen{}\mathclose{{}%
\left\langle\nabla_{x}p(x),\nabla_{x}\log q(x,\theta)}\right\rangle+\nabla_{%
\theta}\int\,\mathrm{d}x\;p(x)\mathopen{}\mathclose{{}\left\langle\nabla_{x}%
\log q_{t}(x),\nabla_{x}\log q(x,\theta)}\right\rangle
\displaystyle=~{}
\displaystyle-\nabla_{\theta}\int\,\mathrm{d}x\;\mathopen{}\mathclose{{}\left%
\langle\nabla_{x}p(x),\nabla_{x}\log q(x,\theta)}\right\rangle+\nabla_{\theta}%
\int\,\mathrm{d}x\;p(x)\mathopen{}\mathclose{{}\left\langle\nabla_{x}\log q_{t%
}(x),\nabla_{x}\log q(x,\theta)}\right\rangle
\displaystyle=~{}\nabla_{\theta}\frac{1}{2}\mathbb{E}_{p(x)}\mathopen{}%
\mathclose{{}\left\lVert\nabla_{x}\log p(x)-\nabla_{x}\log q(x,\theta)}\right%
\rVert^{2},
\displaystyle=~{}
\displaystyle\nabla_{\theta}\frac{1}{2}\mathbb{E}_{p(x)}\mathopen{}\mathclose{%
{}\left\lVert\nabla_{x}\log p(x)-\nabla_{x}\log q(x,\theta)}\right\rVert^{2},
c
c:\mathbb{R}^{d}\to\mathbb{R}
\displaystyle W_{c}^{2}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}\right)=\inf_%
{\pi\in\Gamma(p_{0},p_{1})}\int\pi(x,y)c(x-y)\,\mathrm{d}x\,\mathrm{d}y,
\displaystyle W_{c}^{2}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}\right)=\inf_%
{\pi\in\Gamma(p_{0},p_{1})}\int\pi(x,y)c(x-y)\,\mathrm{d}x\,\mathrm{d}y,
\Gamma(p_{0},p_{1})
p_{0}
p_{1}
\displaystyle W_{c}^{2}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}\right)%
\coloneqq\inf_{v_{t},q_{t}}\int_{0}^{1}\;\mathbb{E}_{q_{t}(x)}\mathopen{}%
\mathclose{{}\left[c(v_{t}(x))}\right]\,\mathrm{d}t,\;\;\text{ subj. to}
\displaystyle W_{c}^{2}\mathopen{}\mathclose{{}\left(p_{0},p_{1}}\right)
\displaystyle\coloneqq\inf_{v_{t},q_{t}}\int_{0}^{1}\;\mathbb{E}_{q_{t}(x)}%
\mathopen{}\mathclose{{}\left[c(v_{t}(x))}\right]\,\mathrm{d}t,\;\;\text{ subj%
. to}
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)v_{t}(x)}\right)\,,\quad\text{ and }\quad q_{0}=p_{%
0},\;\;q_{1}=p_{1}\,.
\displaystyle\frac{\partial q_{t}(x)}{\partial t}
\displaystyle=-\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(q_{t}(x)v_{t}(x)}%
\right)\,,\quad\text{ and }\quad q_{0}=p_{0},\;\;q_{1}=p_{1}\,.
c
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)\nabla c^{*}\mathopen{}\mathclose{{}\left(-2\nabla_%
{x}E_{\textrm{\emph{loc}}}(x)}\right)}\right)\,,
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)\nabla c^{*}\mathopen{}\mathclose{{}\left(-2\nabla_%
{x}E_{\textrm{\emph{loc}}}(x)}\right)}\right)\,,
c^{*}(\cdot)
c(\cdot)
W_{c}\mathopen{}\mathclose{{}\left(\cdot,\cdot}\right)
\displaystyle\inf_{q^{\prime}}F[q^{\prime}]-F[q]+\frac{1}{2\Delta t}W_{c}^{2}%
\mathopen{}\mathclose{{}\left(q,q^{\prime}}\right).
\displaystyle\inf_{q^{\prime}}F[q^{\prime}]-F[q]+\frac{1}{2\Delta t}W_{c}^{2}%
\mathopen{}\mathclose{{}\left(q,q^{\prime}}\right).
q^{\prime}=q-\Delta t\mathopen{}\mathclose{{}\left\langle\nabla_{x},q(x)v(x)}\right\rangle
\Delta t
v(x)
\displaystyle\inf_{v}~{}F[q]-\Delta t\int\nabla_{x}\cdot\mathopen{}\mathclose{%
{}\left(q(x)v(x)}\right)\frac{\delta F[q]}{\delta q}(x)\,\mathrm{d}x-F[q]+%
\frac{1}{2\Delta t}\Delta t^{2}\mathbb{E}_{q(x)}c(v(x))
\displaystyle\inf_{v}
\displaystyle~{}F[q]-\Delta t\int\nabla_{x}\cdot\mathopen{}\mathclose{{}\left(%
q(x)v(x)}\right)\frac{\delta F[q]}{\delta q}(x)\,\mathrm{d}x-F[q]+\frac{1}{2%
\Delta t}\Delta t^{2}\mathbb{E}_{q(x)}c(v(x))
\displaystyle=~{}\Delta t\inf_{v}\int q(x)\mathopen{}\mathclose{{}\left\langle
v%
(x),\nabla_{x}\frac{\delta F[q]}{\delta q}(x)}\right\rangle\,\mathrm{d}x+\frac%
{1}{2}\mathbb{E}_{q(x)}c(v(x))
\displaystyle=
\displaystyle~{}\Delta t\inf_{v}\int q(x)\mathopen{}\mathclose{{}\left\langle v%
(x),\nabla_{x}\frac{\delta F[q]}{\delta q}(x)}\right\rangle\,\mathrm{d}x+\frac%
{1}{2}\mathbb{E}_{q(x)}c(v(x))
\displaystyle=~{}\frac{1}{2}\Delta t\inf_{v}\int q(x)\bigg{[}c(v(x))-\mathopen%
{}\mathclose{{}\left\langle v(x),-2\nabla_{x}\frac{\delta F[q]}{\delta q}(x)}%
\right\rangle\bigg{]}\,\mathrm{d}x
\displaystyle=
\displaystyle~{}\frac{1}{2}\Delta t\inf_{v}\int q(x)\bigg{[}c(v(x))-\mathopen{%
}\mathclose{{}\left\langle v(x),-2\nabla_{x}\frac{\delta F[q]}{\delta q}(x)}%
\right\rangle\bigg{]}\,\mathrm{d}x
\displaystyle=~{}-\frac{1}{2}\Delta t\int q(x)c^{*}\mathopen{}\mathclose{{}%
\left(-2\nabla_{x}\frac{\delta F[q]}{\delta q}(x)}\right)\,\mathrm{d}x
\displaystyle=
\displaystyle~{}-\frac{1}{2}\Delta t\int q(x)c^{*}\mathopen{}\mathclose{{}%
\left(-2\nabla_{x}\frac{\delta F[q]}{\delta q}(x)}\right)\,\mathrm{d}x
\displaystyle v(x)=\nabla c^{*}\mathopen{}\mathclose{{}\left(-2\nabla_{x}\frac%
{\delta F[q]}{\delta q}(x)}\right),
\displaystyle v(x)=\nabla c^{*}\mathopen{}\mathclose{{}\left(-2\nabla_{x}\frac%
{\delta F[q]}{\delta q}(x)}\right),
\frac{\delta E[q]}{\delta q}(x)=E_{\textrm{loc}}
\tanh
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)\tanh\mathopen{}\mathclose{{}\left(-\nabla_{x}E_{%
\textrm{\emph{loc}}}(x)}\right)}\right)\,,
\displaystyle\frac{\partial q_{t}(x)}{\partial t}=-\nabla_{x}\cdot\mathopen{}%
\mathclose{{}\left(q_{t}(x)\tanh\mathopen{}\mathclose{{}\left(-\nabla_{x}E_{%
\textrm{\emph{loc}}}(x)}\right)}\right)\,,
c
c:\mathbb{R}^{d}\to\mathbb{R}
\displaystyle c(x)=\sum_{i}^{d}\frac{1}{2}\bigg{(}(x_{i}+1)\log(x_{i}+1)+(1-x_%
{i})\log(1-x_{i})\bigg{)}-d\log 2.
\displaystyle c(x)=\sum_{i}^{d}\frac{1}{2}\bigg{(}(x_{i}+1)\log(x_{i}+1)+(1-x_%
{i})\log(1-x_{i})\bigg{)}-d\log 2.
c^{*}(x)=\sum_{i}\log(\exp(x_{i})+\exp(-x_{i}))
\displaystyle\partial_{i}c^{*}(x)=\frac{\exp(x_{i})-\exp(-x_{i})}{\exp(x_{i})+%
\exp(-x_{i})}=\tanh(x_{i}).
\displaystyle\partial_{i}c^{*}(x)=\frac{\exp(x_{i})-\exp(-x_{i})}{\exp(x_{i})+%
\exp(-x_{i})}=\tanh(x_{i}).
c(x)
\displaystyle c(x)=~{}\sup_{y}\mathopen{}\mathclose{{}\left\langle x,y}\right%
\rangle-c^{*}(y)
\displaystyle c(x)=~{}
\displaystyle\sup_{y}\mathopen{}\mathclose{{}\left\langle x,y}\right\rangle-c^%
{*}(y)
\displaystyle=~{}\sup_{y}\sum_{i}^{d}\bigg{(}x_{i}y_{i}-\log(\exp(y_{i})+\exp(%
-y_{i}))\bigg{)}
\displaystyle=~{}
\displaystyle\sup_{y}\sum_{i}^{d}\bigg{(}x_{i}y_{i}-\log(\exp(y_{i})+\exp(-y_{%
i}))\bigg{)}
\displaystyle=~{}\sup_{y}\sum_{i}^{d}\bigg{(}(x_{i}+1)y_{i}-\log(\exp(2y_{i})+%
1)\bigg{)}\qquad//y_{i}=\frac{1}{2}\log\frac{1+x}{1-x}
\displaystyle=~{}
\displaystyle\sup_{y}\sum_{i}^{d}\bigg{(}(x_{i}+1)y_{i}-\log(\exp(2y_{i})+1)%
\bigg{)}\qquad//y_{i}=\frac{1}{2}\log\frac{1+x}{1-x}
\displaystyle=~{}\sum_{i}^{d}\bigg{(}(x_{i}+1)\frac{1}{2}\log\mathopen{}%
\mathclose{{}\left(\frac{1+x_{i}}{1-x_{i}}}\right)-\log\mathopen{}\mathclose{{%
}\left(\frac{1+x_{i}}{1-x_{i}}+1}\right)\bigg{)}
\displaystyle=~{}
\displaystyle\sum_{i}^{d}\bigg{(}(x_{i}+1)\frac{1}{2}\log\mathopen{}\mathclose%
{{}\left(\frac{1+x_{i}}{1-x_{i}}}\right)-\log\mathopen{}\mathclose{{}\left(%
\frac{1+x_{i}}{1-x_{i}}+1}\right)\bigg{)}
\displaystyle=~{}\sum_{i}^{d}\frac{1}{2}\bigg{(}(x_{i}+1)\log(x_{i}+1)+(1-x_{i%
})\log(1-x_{i})\bigg{)}-d\log 2.
\displaystyle=~{}
\displaystyle\sum_{i}^{d}\frac{1}{2}\bigg{(}(x_{i}+1)\log(x_{i}+1)+(1-x_{i})%
\log(1-x_{i})\bigg{)}-d\log 2.
5\%
1000
(E-E_{0})/E_{0}
1000
5\%
1000
5\%
5\%
1000
(E-E_{0})/E_{0}
1000
5\%
1000
5\%
