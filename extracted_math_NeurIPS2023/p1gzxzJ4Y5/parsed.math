t\geq 0
s_{t}\in\mathcal{S}
a_{t}\in\mathcal{A}
r_{t}=r(s_{t},a_{t})\in\mathbb{R}
s_{t+1}\sim p(\cdot|s_{t},a_{t})\in\mathcal{S}
\pi:\mathcal{S}\mapsto P(\mathcal{A})
P(\mathcal{A})
\mathcal{A}
\pi
J(\pi)=\mathbb{E}_{\pi}\big{[}\sum_{t=0}^{\infty}\gamma^{t}r_{t}\big{]}
\gamma\in[0,1)
\pi
\pi^{\ast}=\arg\max_{\pi}J(\pi)
\pi
Q^{\pi}(s,a)=\mathbb{E}_{\pi}\big{[}J(\pi)|s_{0}=s,a_{0}=a\big{]}
V^{\pi}(s)=\mathbb{E}_{\pi}\big{[}J(\pi)|s_{0}=s,a_{0}\sim\pi(\cdot|s_{0})\big%
{]}
A^{\pi}(s,a)=Q^{\pi}(s,a)-V^{\pi}(s)
\pi^{\ast}
\pi_{\theta},\theta\in\Theta
\Theta
\theta
\nabla_{\theta}J(\pi_{\theta})=\mathbb{E}_{\pi_{\theta}}\big{[}\sum_{t=0}^{%
\infty}A^{\pi_{\theta}}(s_{t},a_{t})\nabla_{\theta}\log\pi_{\theta}(a_{t}|s_{t%
})\big{]}
\theta_{\text{new}}\leftarrow\theta+\alpha\nabla_{\theta}J(\pi_{\theta})
\alpha>0
\displaystyle\max_{\theta_{\text{new}}}\ \mathbb{E}_{\pi_{\theta}}\big{[}\frac%
{\pi_{\theta_{\text{new}}}(a_{t}|s_{t})}{\pi_{\theta}(a_{t}|s_{t})}A^{\pi_{%
\theta}}(s_{t},a_{t})\big{]},
\displaystyle\max_{\theta_{\text{new}}}\ \mathbb{E}_{\pi_{\theta}}\big{[}
\displaystyle\frac{\pi_{\theta_{\text{new}}}(a_{t}|s_{t})}{\pi_{\theta}(a_{t}|%
s_{t})}A^{\pi_{\theta}}(s_{t},a_{t})\big{]},
\displaystyle||\theta_{\text{new}}-\theta||_{2}\leq\epsilon,
\displaystyle||\theta_{\text{new}}-\theta||_{2}\leq\epsilon,
\epsilon>0
\mathbb{E}_{\pi_{\theta}}\big{[}\frac{\pi_{\theta_{\text{new}}}(a_{t}|s_{t})}{%
\pi_{\theta}(a_{t}|s_{t})}A^{\pi_{\theta}}(s_{t},a_{t})\big{]}\approx\nabla_{%
\theta}J(\pi_{\theta})^{T}(\theta_{\text{new}}-\theta)
\epsilon
\alpha
\theta_{\text{new}}
\theta
\displaystyle\max_{\theta_{\text{new}}}\ \mathbb{E}_{\pi_{\theta}}\big{[}\frac%
{\pi_{\theta_{\text{new}}}(a_{t}|s_{t})}{\pi_{\theta}(a_{t}|s_{t})}A^{\pi_{%
\theta}}(s_{t},a_{t})\big{]},
\displaystyle\max_{\theta_{\text{new}}}\ 
\displaystyle\mathbb{E}_{\pi_{\theta}}\big{[}\frac{\pi_{\theta_{\text{new}}}(a%
_{t}|s_{t})}{\pi_{\theta}(a_{t}|s_{t})}A^{\pi_{\theta}}(s_{t},a_{t})\big{]},
\displaystyle\mathbb{E}_{s}\big{[}\mathbb{KL}[\pi_{\theta}(\cdot|s)||\pi_{%
\theta_{\text{new}}}(\cdot|s)]\big{]}\leq\epsilon,
\displaystyle\mathbb{E}_{s}\big{[}\mathbb{KL}[\pi_{\theta}(\cdot|s)||\pi_{%
\theta_{\text{new}}}(\cdot|s)]\big{]}\leq\epsilon,
\mathbb{E}_{s}\big{[}\cdot\big{]}
\pi_{\theta}
J(\pi_{\theta})
\mathbb{E}_{s}\big{[}\mathbb{KL}[\pi_{\theta}(\cdot|s)||\pi_{\theta_{\text{new%
}}}(\cdot|s)]\big{]}\approx(\theta_{\text{new}}-\theta)^{T}\hat{H}(\theta_{%
\text{new}}-\theta)\leq\epsilon
\hat{H}=\frac{\partial^{2}}{\partial\theta^{2}}\mathbb{E}_{\pi_{\theta}}\big{[%
}\mathbb{KL}[\pi_{\theta}(\cdot|s)||\pi_{\theta_{\text{new}}}(\cdot|s)]\big{]}
\displaystyle\max_{\theta_{\text{new}}}\nabla_{\theta}J(\pi_{\theta})^{T}(%
\theta_{\text{new}}-\theta),
\displaystyle\max_{\theta_{\text{new}}}\nabla_{\theta}J(\pi_{\theta})^{T}(%
\theta_{\text{new}}-\theta),
\displaystyle(\theta_{\text{new}}-\theta)^{T}\hat{H}(\theta_{\text{new}}-%
\theta)\leq\epsilon.
\displaystyle(\theta_{\text{new}}-\theta)^{T}\hat{H}(\theta_{\text{new}}-%
\theta)\leq\epsilon.
\propto\hat{H}^{-1}\nabla_{\theta}J(\pi_{\theta})
\pi_{\theta}
\hat{H}^{-1}
\hat{H}^{-1}\nabla_{\theta}J(\pi_{\theta})
\hat{g}\approx\hat{H}^{-1}\nabla_{\theta}J(\pi_{\theta})
\Delta\theta=\sqrt{\frac{\epsilon}{\hat{g}^{T}\hat{H}\hat{g}}}\hat{g}
s
\mathbb{E}_{\pi_{\theta}}\big{[}\mathbb{KL}[\pi_{\theta+s\Delta\theta}||\pi_{%
\theta}]\big{]}\leq\epsilon
\theta_{\text{new}}\leftarrow\theta+s\Delta\theta
\hat{H}^{-1}
\epsilon\sim\rho_{0}(\cdot)
g_{\theta_{i}}(\cdot),1\leq i\leq K
\theta_{i}
x
\displaystyle x=g_{\theta_{K}}\circ g_{\theta_{K-1}}\circ...\circ g_{\theta_{2%
}}\circ g_{\theta_{1}}(\epsilon).
\displaystyle x=g_{\theta_{K}}\circ g_{\theta_{K-1}}\circ...\circ g_{\theta_{2%
}}\circ g_{\theta_{1}}(\epsilon).
\Sigma_{i}
g_{\theta}(\cdot)
x
\displaystyle\log p(x)=\log p(\epsilon)+\sum_{i=1}^{K}\log\text{det}(\Sigma_{i%
}).
\displaystyle\log p(x)=\log p(\epsilon)+\sum_{i=1}^{K}\log\text{det}(\Sigma_{i%
}).
x
\epsilon
g_{\theta_{i}}(\cdot)
g_{\theta_{i}}(\cdot)
g_{\theta_{i}}(\cdot)
p(x)
g_{\theta_{i}}(\cdot)
\text{det}(\Sigma_{i})
\text{det}(\Sigma_{i})
g_{\theta_{i}}(\cdot)
\epsilon
a
\pi(a|s)
s
L_{\theta_{s}}(\cdot)
\theta_{s}
L_{\theta_{s}}(s)
\epsilon
s
g_{\theta_{i}}
L_{\theta_{s}}
\displaystyle a=g_{\theta_{K}}\circ g_{\theta_{K-1}}\circ...\circ g_{\theta_{2%
}}\circ(L_{\theta_{s}}(s)+g_{\theta_{1}}(\epsilon)).
\displaystyle a=g_{\theta_{K}}\circ g_{\theta_{K-1}}\circ...\circ g_{\theta_{2%
}}\circ(L_{\theta_{s}}(s)+g_{\theta_{1}}(\epsilon)).
L_{\theta_{s}}(s)
g_{\theta_{1}}(\epsilon)
a=f_{\theta}(s,\epsilon)
\theta=\{\theta_{s},\theta_{i},1\leq i\leq K\}
a=f_{\theta}(s,\epsilon)
a
\epsilon
\log\pi_{\theta}(a|s)
\pi_{\theta}(\cdot|s)
\nabla_{\theta}\mathbb{H}\big{[}\pi_{\theta}(\cdot|s)\big{]}
N
\mathbb{H}\big{[}\pi_{\theta}(\cdot|s)\big{]}=\mathbb{E}_{a\sim\pi_{\theta}(%
\cdot|s)}\big{[}-\log\pi_{\theta}(a|s)\big{]}=\mathbb{E}_{\epsilon\sim\rho_{0}%
(\cdot)}\big{[}-\log\pi_{\theta}(f_{\theta}(s,\epsilon)|s)\big{]}\approx\frac{%
1}{N}\sum_{i=1}^{N}-\log\pi_{\theta}(f_{\theta}(s,\epsilon_{i})|s)
\nabla_{\theta}\mathbb{H}\big{[}\pi_{\theta}(\cdot|s)\big{]}\approx\frac{1}{N}%
\sum_{i=1}^{N}-\nabla_{\theta}\log\pi_{\theta}(f_{\theta}(s,\epsilon_{i})|s)%
\big{]}
\mathbb{R}^{2}
\mathbb{I}\cdot\sigma^{2}
\sigma^{2}=0.1^{2}
\hat{\pi}_{o}
\hat{\pi}_{o}
\mathcal{B}(\hat{\pi}_{o},\epsilon)=\{\pi:\mathbb{KL}[\hat{\pi}_{o}||\pi]\leq\epsilon\}
\mathbb{KL}[\hat{\pi}_{o}||\pi]=\epsilon
\mathbb{KL}[\hat{\pi}_{o}||\pi]\approx\epsilon
\hat{\pi}_{o}
\sigma^{2}=0.1^{2}
\hat{\pi}_{o}
\mathcal{B}(\hat{\pi}_{o},\epsilon)=\{\pi:\mathbb{KL}[\hat{\pi}_{o}||\pi]\leq\epsilon\}
\hat{\pi}_{o}
\mathcal{B}(\hat{\pi},0.01)
\sigma^{2}=0.1^{2}
\hat{\pi}_{o}
\mathcal{B}(\hat{\pi}_{o},\epsilon)=\{\pi:\mathbb{KL}[\hat{\pi}_{o}||\pi]\leq\epsilon\}
\hat{\pi}_{o}
\mathcal{B}(\hat{\pi},0.01)
a\in[-1,1]^{2}
r(a)=-a^{T}\Sigma^{-1}a
\Sigma
J(\pi)
\pi^{\ast}=[0,0]^{T}
J(\pi)+c\mathbb{H}\big{[}\pi\big{]}
\pi_{\text{ent}}^{\ast}\propto\exp(\frac{r(a)}{c})
\frac{\Sigma}{c}
\pi_{\text{ent}}^{\ast}
K\geq 2
\pi_{\text{ent}}^{\ast}
r(a)=\max_{i\in I}\{(a-\mu_{i})^{T}\Lambda_{i}^{-}(a-\mu_{i})\}
\Lambda_{i},i\in I
\mu_{i},i\in I
|I|=2
K
J(\pi)+c\mathbb{H}[\pi]=-\mathbb{KL}[\pi||\pi_{\text{ent}}^{\ast}]
\pi
\pi_{\text{ent}}^{\ast}\propto\exp(\frac{r(a)}{c})
2\cdot 10^{6}
[0.0,0.0]
r(a)=-a^{T}\Sigma^{-1}a
\Sigma
[0.0,0.0]
r(a)=-a^{T}\Sigma^{-1}a
\Sigma
[0.0,0.0]
\mathbb{H}\big{[}\pi_{\theta}(\cdot|s)\big{]}
\pi_{\theta}
K\geq 2
\pm
K=2
K=5
K\geq 2
K=5
K=2
K=5
K=2
+\text{tanh}
\epsilon=0.01
\epsilon=0.001
+\ \text{tanh}
a
(1-a^{2})
\theta
a\approx\pm 1
a=\pm 1
+\ \text{tanh}
\leq 10^{7}
(\text{mean}\pm\text{std})
10^{7}
5
7\cdot 10^{6}
(\text{mean}\pm\text{std})
10^{7}
5
7\cdot 10^{6}
+\text{tanh}
-76\pm 14
-89\pm 13
\mathbf{2362\pm 305}
\mathbf{1982\pm 407}
1576\pm 782
386\pm 78
\mathbf{1643\pm 819}
\mathbf{2900\pm 554}
1156\pm 153
\mathbf{6350\pm 486}
3812\pm 1973
\mathbf{4270\pm 142}
\mathbf{64.7\pm 7.6}
38.2\pm 2.3
37.8\pm 3.4
\mathbf{87.2\pm 19.6}
\mathbf{6.5\pm 0.2}
4.4\pm 0.1
4.2\pm 0.2
\mathbf{8.0\pm 1.8}
\mathbf{137955\pm 9238}
133558\pm 9238
111497\pm 15031
\mathbf{142568\pm 9296}
64
10^{6}
10^{6}
+
10^{6}
10^{6}
10^{6}
10^{6}
\mathbf{\approx-10}
\approx-115
\approx-115
\mathbf{\approx-10}
\approx 64
\approx 90
\mathbf{\approx 120}
\approx 40
\approx 900
\approx 800
\approx 900
\mathbf{\approx 1000}
\mathbf{\approx 7800}
<1000
\approx 0
<1000
\mathbf{\approx 2000}
\mathbf{\approx 2000}
\mathbf{\approx 2000}
\approx 1400
\mathbf{\approx 1500}
\approx 0
\approx 0
<500
\approx 1700
\mathbf{\approx 2000}
\approx 1000
\approx 550
\mathbf{\approx 800}
\approx 0
<-500
\epsilon
\log_{10}\epsilon\in[-3.0,-2.0]
\epsilon
\epsilon
K
s
L_{\theta_{s}}(s)
L_{\theta_{s}}(s)
l_{1}
K\in\{2,4,6\}
l_{1}\in\{3,5,7\}
\log\pi_{\theta}(a|s)
\pi_{\theta}(a|s)
\pi_{\theta}(\cdot|s)=\mathbb{N}(\mu_{\theta}(s),\Sigma)
\Sigma
\Sigma_{ii}=\sigma_{i}^{2}
\mu_{\theta}(s)
64
\sigma_{i}^{2}
+\text{tanh}
\tanh
\mu_{\theta}(s)\in[-1,1]
\pi_{\theta}(\cdot|s)=\sum_{i=1}^{K}p_{i}\mathbb{N}(\mu^{(i)}_{\theta}(s),%
\Sigma_{i})
p_{i}=\frac{1}{K}
\mu_{\theta}^{(i)}(s),\Sigma_{i}
i
\pi(\alpha_{\theta}(s),\beta_{\theta}(s))
\pi
\alpha_{\theta}(s),\beta_{\theta}(s)
\alpha_{\theta}(s)
\beta_{\theta}(s)
f_{\theta}(s)
\alpha_{\theta}(s)=\log(\exp(f_{\theta}(s))+1)+1
\alpha_{\theta}(s)\rightarrow\infty
\beta_{\theta}(s)\rightarrow\infty
\epsilon=0.01
\epsilon=0.001
a\sim\pi_{\theta}(\cdot|s)
a=f_{\theta}(s,\epsilon)
\epsilon\sim\rho_{0}(\cdot)
f_{\theta}(s,\epsilon)
\epsilon
\epsilon\in\{0.01,0.001\}
\epsilon\in\{0.02,0.002\}
x=g_{\theta_{K}}\circ g_{\theta_{K-1}}\circ...\circ g_{\theta_{2}}\circ g_{%
\theta_{1}}(\epsilon),
g_{\theta_{i}}(\cdot)
g_{\theta_{i}}(\cdot)
x,y
g_{\theta}(\cdot)
y=g_{\theta}(x).
g_{\theta}(\cdot)
x_{I}
x
I\subset\{1,2...m\}
\displaystyle y_{1:d}=x_{1:d}
\displaystyle y_{1:d}
\displaystyle=x_{1:d}
\displaystyle y_{d+1:m}=x_{d+1:m}\odot\exp(s(x_{1:d}))+t(x_{1:d}),
\displaystyle y_{d+1:m}
\displaystyle=x_{d+1:m}\odot\exp(s(x_{1:d}))+t(x_{1:d}),
t(\cdot),s(\cdot)
t,s:\mathbb{R}^{d}\mapsto\mathbb{R}^{m-d}
|\frac{\partial y}{\partial x^{T}}|=\exp(\sum_{j=1}^{m-d}[s(x_{1:d})]_{j})
[s(x_{1:d})]_{j}
j
s(x_{1:d})
1\leq j\leq m-d
x
s\in\mathbb{R}^{n}
L_{\theta_{s}}(\cdot)
\theta_{s}
L_{\theta_{s}}(s)\in\mathbb{R}^{m}
\displaystyle z_{1:d}=x_{1:d}
\displaystyle z_{1:d}
\displaystyle=x_{1:d}
\displaystyle z_{d+1:m}=x_{d+1:m}\odot\exp(s(x_{1:d}))+t(x_{1:d})
\displaystyle z_{d+1:m}
\displaystyle=x_{d+1:m}\odot\exp(s(x_{1:d}))+t(x_{1:d})
\displaystyle y=z+L_{\theta_{s}}(s).
\displaystyle y
\displaystyle=z+L_{\theta_{s}}(s).
x\leftrightarrow y
L_{\theta_{s}}(\cdot)
s,t
l_{1}=3
K=4
L_{\theta_{s}}(s)
2
64
2
64
K\in\{2,4,6\}
l_{1}\in\{3,5,7\}
L_{\theta_{s}}(\cdot)
K
l_{1}
K
l_{1}
3
l_{1}
K
4
30
10^{6}
2\cdot 10^{6}
\approx 5\cdot 10^{6}
30
10^{6}
2\cdot 10^{6}
\approx 5\cdot 10^{6}
K
K
K
K
l_{1}
l_{1}
l_{1}
l_{1}
l_{1}
K
\pm
l_{1}
K
\pm
128
32
128
32
2
\pm
5\cdot 10^{6}
128
32
2
\pm
5\cdot 10^{6}
-104\pm 30
-94\pm 44
5.1\pm 0.7
6.4\pm 0.4
501\pm 14
708\pm 43
20\pm 2
53\pm 9
+
+
\approx 2000
\approx 4000
\approx 1000
\approx 6000
\approx 5000
\mathbf{\approx 2000}
\mathbf{\approx 2000}
\approx 1300
\mathbf{\approx 2900}
\approx 1600
\approx 1500
\mathbf{\approx 3200}
\approx 3000
\approx 800
\mathbf{\approx 2000}
\approx 0
\approx 1250
\mathbf{\approx 90}
\approx 60
\mathbf{\approx 90}
\mathcal{S}\subset\mathbb{R}^{116}
\mathcal{A}\subset\mathbb{R}^{8}
t
r_{t}\propto v_{x}
v_{x}
T
\tau=\{s_{t},a_{t}\}_{t=0}^{T-1}
T
r_{t}=r(s_{t},a_{t})
p(O_{t}=1|s_{t},a_{t})=\exp(\frac{r_{t}}{c})
c>0
r_{t}
p(s_{t+1}|s_{t},a_{t})
p(a_{t})
\mathcal{A}
O=\{O_{t}\}_{t=0}^{T-1}
\tau
p(\tau|O)
q(\tau)=\Pi_{t=0}^{T-1}p(s_{t+1}|s_{t},a_{t})\pi(a_{t}|s_{t})
\min_{\pi}\mathbb{KL}[q(\tau)||p(\tau|O)]
\max_{\pi}\mathbb{E}_{\pi}[R(\tau)+c\mathbb{H}(\tau)]
R(\tau)=\sum_{t=0}^{T-1}r_{t}
\tau
q(\tau)
p(s_{t+1}|s_{t},a_{t})
\pi(a_{t}|s_{t})
q(\tau)
