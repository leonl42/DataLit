2\times
1.44\times
2\times
\times
\times
150,000
4,000
0.5
0.9
20,000
0.9
-0.5
1
1
0
0.9
50,000
50,000
20,000
\small\text{FFN}({\bm{x}})={\bm{W}}_{o}\sigma({\bm{W}}_{i}{\bm{x}}+{\bm{b}}_{i%
})+{\bm{b}}_{o},
{\bm{W}}_{i}\in\mathbb{R}^{d_{\text{ff}}\times d_{\text{model}}}
{\bm{W}}_{o}\in\mathbb{R}^{d_{\text{model}}\times d_{\text{ff}}}
{\bm{b}}_{i}\in\mathbb{R}^{d_{\text{ff}}}
{\bm{b}}_{o}\in\mathbb{R}^{d_{\text{model}}}
\sigma
d_{\text{ff}}
d_{\text{model}}
{\bm{b}}_{i}
{\bm{b}}_{o}
N
\small\text{FFN}_{\text{SMoE}}({\bm{x}})=\sum_{n=1}^{N}\alpha_{n}{\bm{W}}_{o,n%
}\sigma({\bm{W}}_{i,n}{\bm{x}}),
{\bm{W}}_{i,n}\in\mathbb{R}^{\frac{d_{\text{ff}}}{N}\times d_{\text{model}}}
{\bm{W}}_{o,n}\in\mathbb{R}^{d_{\text{model}}\times\frac{d_{\text{ff}}}{N}}
n
\alpha_{n}
n
{\bm{x}}
K
\alpha_{n}
0
K=N
\alpha_{n}
1
{\bm{W}}_{i}
N
k
{\bm{s}}\in\mathbb{R}^{d_{\text{ff}}}
{\bm{W}}_{i},{\bm{W}}_{o}
N
{\bm{W}}_{i,n},{\bm{W}}_{o,n}
{\bm{s}}_{j}
j
\small{\bm{s}}_{j}=\min_{{\bm{s}}\in\{f({\bm{W}}_{i}),f({\bm{W}}_{i},{\bm{s}}_%
{j-1})\}}\text{WCSS}({\bm{W}}_{i},{\bm{s}}),
f({\bm{W}}_{i})
f({\bm{W}}_{i},s_{j-1})
{\bm{x}}
K
n
\small\alpha_{n}={\bm{x}}^{\top}{\bm{c}}_{n},\quad{\bm{c}}_{n}=\frac{N}{d_{%
\text{ff}}}\sum_{m=1}^{\frac{d_{\text{ff}}}{N}}{\bm{W}}_{i,n}^{m},
{\bm{W}}_{i,n}^{m}
m
{\bm{W}}_{i,n}
{\bm{c}}_{n}
n
K=N
\tau
\tau
r
r=0.5
50\%
50\%
T=\frac{r}{1-r}
l
T
T=\frac{r}{1-r-l}
K
N
\times
k
1
32
k
k
k
k
k
75\%
\times
\times
\times
\times
0.5
2\times
N
K
\tau
r
l
N
K
r=0.5
N
K
\sum_{k=1}^{K}\sum_{i\in S_{k}}\sum_{j=1}^{p}(x_{ij}-\bar{x}_{kj})^{2}
S_{k}
k
x_{ij}
j
i
\bar{x}_{kj}
j
k
x_{i}
i
{\bm{W}}_{i}
\alpha_{n}
1
\alpha=1+\alpha-\alpha\text{.detach()}
\pm 0.5
\pm 0.1
\pm 0.1
\pm 0.4
\pm 0.1
\pm 0.2
\pm 0.2
\pm 0.2
\pm 0.2
\pm 0.7
\pm 0.2
\pm 0.7
\pm 1.0
\pm 0.7
\pm 1.0
\pm 0.1
\pm 0.2
\pm 0.1
\pm 0.4
\pm 1.0
\pm 0.8
\pm 0.4
\pm 0.2
\pm 0.3
\pm 0.4
\pm 0.1
\pm 0.3
\pm 0.3
\pm 0.3
\pm 0.2
\pm 0.2
\pm 0.3
\pm 0.1
\pm 0.4
\pm 0.7
\pm 0.4
\pm 0.1
\pm 0.4
\pm 0.4
\pm 0.1
\pm 0.3
\pm 0.1
\pm 0.5
\pm 0.2
\pm 0.1
\pm 0.2
\pm 0.1
\pm 0.4
\pm 0.3
\pm 0.1
\pm 0.1
\pm 0.4
\pm 0.0
\pm 0.2
\pm 0.3
\pm 0.3
\pm 0.6
\pm 0.2
\pm 0.5
\pm 0.2
\pm 0.1
\pm 0.3
\pm 0.2
\pm 0.1
\pm 0.1
\pm 0.1
\pm 0.1
\pm 0.1
\pm 0.3
\pm 0.4
\pm 0.3
\pm 0.1
\pm 0.1
\pm 0.2
\pm 0.1
\pm 0.2
\pm 0.1
\pm 0.2
\pm 0.1
\pm 0.1
\pm 0.1
\pm 0.1
\pm 0.4
\pm 0.2
\pm 0.3
\pm 0.6
\pm 0.4
\pm 0.8
\pm 0.5
\pm 0.9
\pm 0.7
\pm 0.4
\pm 0.5
\pm 1.7
\pm 0.4
\pm 0.9
\pm 0.3
\pm 0.8
\pm 0.2
\pm 0.2
\pm 0.7
\pm 1.0
\pm 0.3
\pm 0.7
\pm 0.3
\pm 0.7
\pm 0.2
\pm 0.6
18000\times 1.25
6000\times 1.25
\tau
r
\tau
0.98
\tau
r
70\%
1.63\times
2000
