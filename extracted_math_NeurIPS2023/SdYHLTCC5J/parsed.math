\mathscr{V}
\mathscr{V}^{*}
\Delta_{\mathscr{V}}
\mathscr{V}
x=x_{1}x_{2}\ldots x_{L}\in\mathscr{V}^{*}
i\leq L
x_{<i}=x_{1}x_{2}\ldots x_{i-1}
\mathscr{V}^{*}
\mathbb{P}
\mathscr{V}^{*}
\mathbb{P}
q
p
p
q
p
p
q(x_{t}|x_{<t})
q
x_{t}\in\mathscr{V}
x_{<t}\in\mathscr{V}^{t-1}
p(x_{t}|x_{<t})
p
x_{<t}
p_{t}(\cdot)
p(\cdot|x_{<t})
q_{t}(\cdot)
q(\cdot|x_{<t})
q
p
q
p
q
x_{<m}
q
x_{m}\ldots x_{m+n}
q
\alpha\in[0,1]
\displaystyle\textstyle q(x_{m}\ldots x_{m+n}\,|\,x_{<m})<1-\alpha.
\displaystyle\textstyle q(x_{m}\ldots x_{m+n}\,|\,x_{<m})<1-\alpha.
p
q
q
p
x_{<t}
\gamma
x_{t},\ldots,x_{t+\gamma-1}
q
p
\gamma
x_{<t},\ldots,x_{<t+\gamma-1}
t+j^{*}
j^{*}\in\{0,1,\ldots,\gamma-1\}
x_{t+j^{*}}
x_{<t+j^{*}+1}
x_{t+j}
q
\min\left(1,\frac{p_{t+j}(x_{t+j})}{q_{t+j}(x_{t+j})}\right)
q_{t+j}(\cdot)=q(\cdot|x_{<t+j})
p_{t+j}(\cdot)=p(\cdot|x_{<t+j})
\operatorname{norm}\left(\max\left\{0,\,p_{t+j}(\cdot)-q_{t+j}(\cdot)\right\}%
\right),
\text{norm}(\cdot)
\gamma
p
x_{<t}
\gamma+1
1
x_{<t}
p
x_{t+j}
\min\left(1,\frac{p_{t+j}(x_{t+j})}{(1-\alpha)\cdot q_{t+j}(x_{t+j})}\right)
\alpha\in[0,1)
p
\operatorname{norm}\left(\max\left\{0,\,\frac{1}{\beta}\cdot p_{t+j}(\cdot)-q_%
{t+j}(\cdot)\right\}\right),
\beta\geq 1-\alpha
\alpha
q
p
\beta=1
\alpha
\beta\geq 1-\alpha
\alpha
q
p
\delta
D(q,p)
q
p
\alpha
\beta\geq 1-\alpha
\alpha
q
p
\delta
D(q,p)
q
p
\delta(q,p)
\pi(x)
p(x)
\max\{\min\{q(x),\frac{p(x)}{1-\alpha}\},\frac{p(x)}{\beta}\}
\bm{1}\big{(}\,D(q,p)>\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<1-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<\max_{v}p(v)-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<1-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<\max_{v}p(v)-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<\max_{v}p(v)-\alpha\cdot D_{\textrm{TV}}(p,q)\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
q
p
x_{<t}
q(\cdot|x_{<t})
\max_{v\in\mathscr{V}}\,q(v|x_{<t})
p(\cdot|x_{<t})
x_{t}\sim p(\cdot|x_{<t})
x_{t}\sim q(\cdot|x_{<t})
{r}:\mathscr{V}^{t-1}\rightarrow\{0,1\}
x_{<t}
{r}(x_{<t})=1
p
p
q
\displaystyle\textstyle{r}_{\rm\tt Chow}(x_{<t})=1\leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \max_{v\in\mathscr{V}}\,q(v|x_{<t})<1-\alpha,
\displaystyle\textstyle{r}_{\rm\tt Chow}(x_{<t})=1\leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \max_{v\in\mathscr{V}}\,q(v|x_{<t})<1-\alpha,
\alpha
p
r
t
\mathbb{P}
x_{<t}
q_{t}(\cdot)
q(\cdot|x_{<t})
p_{t}(\cdot)
p(\cdot|x_{<t})
\displaystyle L_{\rm def}(r;x_{<t})=\mathbb{E}_{v\sim\mathbb{P}(\cdot|x_{<t})}%
\Big{[}\big{(}1-r(x_{<t})\big{)}\cdot\ell(v,q_{t})+r(x_{<t})\cdot\big{(}\ell(v%
,p_{t})+\alpha\big{)}\Big{]},
\displaystyle L_{\rm def}(r;x_{<t})
\displaystyle=\mathbb{E}_{v\sim\mathbb{P}(\cdot|x_{<t})}\Big{[}\big{(}1-r(x_{<%
t})\big{)}\cdot\ell(v,q_{t})+r(x_{<t})\cdot\big{(}\ell(v,p_{t})+\alpha\big{)}%
\Big{]},
\alpha\geq 0
\ell:\mathscr{V}\times\Delta_{\mathscr{V}}\rightarrow\mathbb{R}_{+}
\ell
\ell_{\text{0-1}}(v,q_{t})=\bm{1}\left(v\neq\operatorname*{arg\,max}_{v^{%
\prime}}q_{t}(v^{\prime})\right)
\ell_{\log}(v,q_{t})=-\log\left(q_{t}(v)\right).
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{v\sim\mathbb{P}(\cdot|x_%
{<t})}\left[\ell(v,q_{t})\right]\,>\,\mathbb{E}_{v\sim\mathbb{P}(\cdot|x_{<t})%
}\left[\ell(v,p_{t})\right]+\alpha.
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{v\sim\mathbb{P}(\cdot|x_%
{<t})}\left[\ell(v,q_{t})\right]\,>\,\mathbb{E}_{v\sim\mathbb{P}(\cdot|x_{<t})%
}\left[\ell(v,p_{t})\right]+\alpha.
q
p
x_{<t}
\mathbb{P}(\cdot|x_{>t})
\ell=\ell_{\text{0-1}}
1-\max_{v}q_{t}(v)
\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell_{\text{0-1}}(x_{t},q_%
{t})\right]
1-\max_{v}p_{t}(v)
\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell_{\text{0-1}}(x_{t},q_%
{t})\right]
q
p
\displaystyle\textstyle{\hat{r}_{\rm\tt Diff}(x_{<t})=1\leavevmode\nobreak\ %
\leavevmode\nobreak\ \iff\leavevmode\nobreak\ \leavevmode\nobreak\ \max_{v}q_{%
t}(v)\,<\,\max_{v}p_{t}(v)-\alpha.}
\displaystyle\textstyle{\hat{r}_{\rm\tt Diff}(x_{<t})=1\leavevmode\nobreak\ %
\leavevmode\nobreak\ \iff\leavevmode\nobreak\ \leavevmode\nobreak\ \max_{v}q_{%
t}(v)\,<\,\max_{v}p_{t}(v)-\alpha.}
\ell=\ell_{\log}
-\sum_{v}q_{t}(v)\cdot\log(q_{t}(v))
q_{t}
p_{t}
\hat{r}_{\rm\tt Diff}
t
\rightarrow
\alpha
\gamma
\gamma
q
p
q
p
\gamma
q
q
T=1
\gamma=5
\gamma
T=1
\gamma=5
\gamma
\pi=\mathbb{T}(q,p)\in\Delta_{\mathscr{V}}
t
\mathbb{T}(\cdot,\cdot)
x_{t}
q(x_{t})\leq\pi(x_{t})
1-\frac{\pi(x_{t})}{q(x_{t})}
\operatorname{norm}\left(\max\{0,\pi(\cdot)-q(\cdot)\}\right)
\mathbb{T}(q,p)=p
\alpha
\beta
\mathbb{T}(q,p)(v)=\max\{\min\{q(v),\frac{p(v)}{1-\alpha}\},\frac{p(v)}{\beta}\}
q
p
r:\mathscr{V}^{t-1}\rightarrow\{0,1\}
x_{<t}
t
\pi(v)=(1-r(x_{<t}))\cdot q_{t}(v)+r(x_{<t})\cdot p_{t}(v).
\mathbb{T}_{\delta}
\mathbb{T}_{\delta}(q,p)(v)=(1-\delta(q,p))\cdot q(v)+\delta(q,p)\cdot p(v),
\delta:\Delta_{\mathscr{V}}\times\Delta_{\mathscr{V}}\rightarrow\{0,1\}
(q,p)
\delta(q,p)=\bm{1}\big{(}\max_{v}q(v)<1-\alpha\big{)}
\delta(q,p)=\bm{1}\big{(}\max_{v}q(v)<\max_{v}p(v)-\alpha\big{)}.
\mathbb{T}_{\delta}
p
p
p
q
p
p
q
p(\cdot)
q(\cdot)
r
\pi=(1-r(x_{<t}))\cdot q_{t}+r(x_{<t})\cdot p_{t}
q_{t}
q
p
x_{<t}
\gamma
\mathbb{T}(q,p)\stackrel{{\scriptstyle.}}{{=}}p
\text{\tt{GenSpecSample}}(q,p,\mathbb{T},x_{<t},\gamma)
q
p
{\delta}
x_{<t}
q_{t}(\cdot)\stackrel{{\scriptstyle.}}{{=}}q(\cdot|x_{<t})
{\delta}(q_{t},\emptyset)=0
x_{t}\sim q_{t}(\cdot)
p_{t}(\cdot)\stackrel{{\scriptstyle.}}{{=}}p(\cdot|x_{<t})
x_{t}\sim p_{t}(\cdot)
x_{t}
q
p
{\delta}
x_{<t}
q_{t}(\cdot)\stackrel{{\scriptstyle.}}{{=}}q(\cdot|x_{<t})
p_{t}(\cdot)\stackrel{{\scriptstyle.}}{{=}}p(\cdot|x_{<t})
{\delta}(q_{t},p_{t})=0
x_{t}\sim q_{t}(\cdot)
x_{t}\sim p_{t}(\cdot)
x_{t}
q
p
\mathbb{T}
x_{<t}
\gamma
[\gamma]\equiv\{0,\ldots,\gamma\}
\gamma
q
j=0
\gamma-1
q_{t+j}(\cdot)\stackrel{{\scriptstyle.}}{{=}}q(\cdot|x_{<t+j});\leavevmode%
\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ 
x_{t+j}\sim q_{t+j}(\cdot)
p
\gamma
p_{t+j}(\cdot)\stackrel{{\scriptstyle.}}{{=}}p(\cdot|x_{<t+j}),\leavevmode%
\nobreak\ \forall j\in[\gamma]
\pi_{t+j}=\mathbb{T}(q_{t+j},p_{t+j})
a_{j}\sim\text{Ber}\left(\min\left\{1,\frac{\pi_{t+j}({x_{t+j}})}{q_{t+j}({x_{%
t+j}})}\right\}\right),\leavevmode\nobreak\ \forall j\in[\gamma-1];
a_{\gamma}=0
j^{*}=\min\{j\in[\gamma]\,:\,a_{j}=0\}
p_{\rm res}(\cdot)=\begin{cases}\operatorname{norm}\left(\max\left\{0,\,\pi_{t%
+j^{*}}(\cdot)-q_{t+j^{*}}(\cdot)\right\}\right)&\text{if}\leavevmode\nobreak%
\ j^{*}<\gamma\\
\pi_{t+\gamma}(\cdot)&\text{else}\end{cases}
x_{t+j^{*}}\sim p_{\rm res}(\cdot)
x_{t},\ldots,x_{t+j^{*}}
q
p
\delta
x_{<t}
\gamma
\mathbb{T}_{\delta}(q,p)\stackrel{{\scriptstyle.}}{{=}}(1-\delta(q,p))\cdot q+%
\delta(q,p)\cdot p
\text{\tt{GenSpecSample}}(q,p,\mathbb{T}_{\delta},x_{<t},\gamma)
r:\mathscr{V}^{t-1}\rightarrow\{0,1\}
\pi
q
r
x_{<t}
\pi=(1-r(x_{<t}))\cdot q_{t}+r(x_{<t})\cdot p_{t}
\pi_{t}
q_{t}
r(x_{<t})\cdot D_{\textup{{TV}}}(p_{t},q_{t}),
D_{\textup{{TV}}}(p,q)=\sum_{v\in\mathscr{V}}\max\{0,p(v)-q(v)\}
p
q
r(x_{<t})=0
\pi(v)=q_{t}(v)
r(x_{<t})=1
D_{\textup{{TV}}}(p_{t},q_{t})
x_{<t}
\displaystyle\min_{r}\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{v%
\sim\mathbb{P}(\cdot|x_{<t})}\Big{[}\big{(}1-r(x_{<t})\big{)}\cdot\ell(v,q_{t}%
)+r(x_{<t})\cdot\ell(v,p_{t})\big{)}\Big{]}\hskip 2.84544pt\text{s.t.}%
\leavevmode\nobreak\ \leavevmode\nobreak\ r(x_{<t})\cdot D_{\textrm{TV}}(p_{t}%
,q_{t})\,\leq\,B,
\displaystyle\min_{r}
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{v\sim%
\mathbb{P}(\cdot|x_{<t})}\Big{[}\big{(}1-r(x_{<t})\big{)}\cdot\ell(v,q_{t})+r(%
x_{<t})\cdot\ell(v,p_{t})\big{)}\Big{]}\hskip 2.84544pt\text{s.t.}\leavevmode%
\nobreak\ \leavevmode\nobreak\ r(x_{<t})\cdot D_{\textrm{TV}}(p_{t},q_{t})\,%
\leq\,B,
B>0
\alpha>0
\displaystyle L_{\rm spec}(r;x_{<t})=\mathbb{E}_{v\sim\mathbb{P}(\cdot|x_{<t})%
}\big{[}\big{(}1-r(x_{<t})\big{)}\cdot\ell(v,q_{t})+r(x_{<t})\cdot\big{(}\ell(%
v,p_{t})+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})\big{)}\big{]},
\displaystyle L_{\rm spec}(r;x_{<t})
\displaystyle=\mathbb{E}_{v\sim\mathbb{P}(\cdot|x_{<t})}\big{[}\big{(}1-r(x_{<%
t})\big{)}\cdot\ell(v,q_{t})+r(x_{<t})\cdot\big{(}\ell(v,p_{t})+\alpha\cdot D_%
{\textrm{TV}}(p_{t},q_{t})\big{)}\big{]},
q_{t}
p_{t}
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{v\sim\mathbb{P}(\cdot|x_%
{<t})}\left[\ell(v,q_{t})\right]\,>\,\mathbb{E}_{v\sim\mathbb{P}(\cdot|x_{<t})%
}\left[\ell(v,p_{t})\right]+\alpha\cdot D_{\textup{{TV}}}(p_{t},q_{t}).
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{v\sim\mathbb{P}(\cdot|x_%
{<t})}\left[\ell(v,q_{t})\right]\,>\,\mathbb{E}_{v\sim\mathbb{P}(\cdot|x_{<t})%
}\left[\ell(v,p_{t})\right]+\alpha\cdot D_{\textup{{TV}}}(p_{t},q_{t}).
p_{t}
q_{t}
q_{t}
p_{t}
q_{t}
p_{t}
q_{t}
\mathbb{P}(\cdot|x_{<t}).
\ell=\ell_{\text{0-1}}
\displaystyle\textstyle{\hat{r}_{\rm\tt OPT}(x_{<t})=1\leavevmode\nobreak\ %
\leavevmode\nobreak\ \iff\leavevmode\nobreak\ \leavevmode\nobreak\ \max_{v}q_{%
t}(v)\,<\,\max_{v}p_{t}(v)-\alpha\cdot D_{\textup{{TV}}}(p_{t},q_{t}).}
\displaystyle\textstyle{\hat{r}_{\rm\tt OPT}(x_{<t})=1\leavevmode\nobreak\ %
\leavevmode\nobreak\ \iff\leavevmode\nobreak\ \leavevmode\nobreak\ \max_{v}q_{%
t}(v)\,<\,\max_{v}p_{t}(v)-\alpha\cdot D_{\textup{{TV}}}(p_{t},q_{t}).}
\mathbb{P}(\cdot|x_{<t})
\hat{r}_{\rm\tt OPT}
\ell=\ell_{\emph{\text{0-1}}}
x_{<t}
\displaystyle L_{\rm spec}(\hat{r}_{\rm\tt OPT};x_{<t})-\min_{r}\,L_{\rm spec}%
(r;x_{<t})\leavevmode\nobreak\ \leq\leavevmode\nobreak\ \max_{v\in\mathscr{V}}%
\big{|}\mathbb{P}(v|x_{<t})-q_{t}(v)\big{|}\,+\,\max_{v\in\mathscr{V}}\big{|}%
\mathbb{P}(v|x_{<t})-p_{t}(v)\big{|}.
\displaystyle L_{\rm spec}(\hat{r}_{\rm\tt OPT};x_{<t})-\min_{r}\,L_{\rm spec}%
(r;x_{<t})\leavevmode\nobreak\ \leq\leavevmode\nobreak\ \max_{v\in\mathscr{V}}%
\big{|}\mathbb{P}(v|x_{<t})-q_{t}(v)\big{|}\,+\,\max_{v\in\mathscr{V}}\big{|}%
\mathbb{P}(v|x_{<t})-p_{t}(v)\big{|}.
\delta(\cdot)
\ell=\ell_{\log}
q_{t}(\cdot)
p_{t}(\cdot)
x_{t}\sim q_{t}(\cdot)
q_{t}(\cdot)
x_{t}
q_{t}
p_{t}
r:\mathscr{V}^{t-1}\times\mathscr{V}\rightarrow\{0,1\}
x_{<t}
v
r(x_{<t},v)\in\{0,1\}
\displaystyle\pi_{\rm\tt Token}(v)=q_{t}(v)\cdot(1-r(x_{<t},v))+p_{t}(v)\cdot\eta,
\displaystyle\pi_{\rm\tt Token}(v)=q_{t}(v)\cdot(1-r(x_{<t},v))+p_{t}(v)\cdot\eta,
\eta=\sum_{v^{\prime}\in\mathscr{V}}r(x_{<t},v^{\prime})\cdot q_{t}(v^{\prime})
\sum_{v}\pi_{\tt Token}(v)=1
q_{t}(\cdot)
r
p_{t}(\cdot)
\pi_{\tt Token}
r
v
p_{t}
\displaystyle r(x_{<t},v)=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ 1-\mathbb{P}(v|x_{<t})\,>\,\mathbb{E%
}_{v\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell_{\text{0-1}}(v,p_{t})\right]+\alpha,
\displaystyle r(x_{<t},v)=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ 1-\mathbb{P}(v|x_{<t})\,>\,\mathbb{E%
}_{v\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell_{\text{0-1}}(v,p_{t})\right]+\alpha,
\alpha
\displaystyle\hat{r}_{\rm\tt TokenV1}(x_{<t},v)=1\leavevmode\nobreak\ %
\leavevmode\nobreak\ \iff\leavevmode\nobreak\ \leavevmode\nobreak\ \textstyle q%
_{t}(v)\,<\,\max_{v^{\prime}}p_{t}(v^{\prime})-\alpha
\displaystyle\hat{r}_{\rm\tt TokenV1}(x_{<t},v)=1
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \iff\leavevmode\nobreak%
\ \leavevmode\nobreak\ \textstyle q_{t}(v)\,<\,\max_{v^{\prime}}p_{t}(v^{%
\prime})-\alpha
\displaystyle\hat{r}_{\rm\tt TokenV2}(x_{<t},v)=1\leavevmode\nobreak\ %
\leavevmode\nobreak\ \iff\leavevmode\nobreak\ \leavevmode\nobreak\ \textstyle p%
_{t}(v)\,<\,\max_{v^{\prime}}p_{t}(v^{\prime})-\alpha
\displaystyle\hat{r}_{\rm\tt TokenV2}(x_{<t},v)=1
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \iff\leavevmode\nobreak%
\ \leavevmode\nobreak\ \textstyle p_{t}(v)\,<\,\max_{v^{\prime}}p_{t}(v^{%
\prime})-\alpha
\displaystyle\hat{r}_{\rm\tt TokenV3}(x_{<t},v)=1\leavevmode\nobreak\ %
\leavevmode\nobreak\ \iff\leavevmode\nobreak\ \leavevmode\nobreak\ \textstyle p%
_{t}(v)\,<\,\max_{v^{\prime}}p_{t}(v^{\prime})\cdot(1-\alpha),
\displaystyle\hat{r}_{\rm\tt TokenV3}(x_{<t},v)=1
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \iff\leavevmode\nobreak%
\ \leavevmode\nobreak\ \textstyle p_{t}(v)\,<\,\max_{v^{\prime}}p_{t}(v^{%
\prime})\cdot(1-\alpha),
\mathbb{P}(v|x_{<t})
q_{t}(v)
p_{t}(v)
\displaystyle\textstyle\pi_{\tt TokenV3}(v)=q_{t}(v)\cdot\bm{1}\big{(}v\in%
\textup{Top}_{\alpha}\big{)}\,+\,p_{t}(v)\cdot\sum_{v^{\prime}\notin\textup{%
Top}_{\alpha}}q_{t}(v^{\prime}),
\displaystyle\textstyle\pi_{\tt TokenV3}(v)=q_{t}(v)\cdot\bm{1}\big{(}v\in%
\textup{Top}_{\alpha}\big{)}\,+\,p_{t}(v)\cdot\sum_{v^{\prime}\notin\textup{%
Top}_{\alpha}}q_{t}(v^{\prime}),
\textup{Top}_{\alpha}=\{v\in\mathscr{V}:\,p_{t}(v)\,\geq\,\max_{v^{\prime}}p_{%
t}(v^{\prime})\cdot(1-\alpha)\}
p_{t}(\cdot)
\pi_{\tt TokenV3}
q_{t}(\cdot)
p_{t}(\cdot)
q
p
q
D(q,p)>\alpha
D
\alpha
\mathbb{T}_{\textup{BiLD}}(q,p)(v)=\bm{1}(D(q,p)\leq\alpha)\cdot q(v)+\bm{1}(D%
(q,p)>\alpha)\cdot p(v)
p
\pi=\mathbb{T}_{\textup{BiLD}}(q,p)
D(\pi,p)\leq\alpha
q
p
p
q
q
p
\mathbb{T}_{\textup{BiLD}}
T=1,\gamma=5
T=0.5
T=0
T=1,\gamma=5
T=0.5
T=0
\downarrow
\rightarrow
\rightarrow
\rightarrow
\rightarrow
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\gamma=5
\gamma
\gamma=5
\gamma
\beta=1
\beta
\mathbb{T}_{\textup{BiLD}}
\rightarrow
T=0,0.1,0.5,1.0
\gamma=3,5,7
\gamma=1
\rightarrow
\gamma=1
\rightarrow
\alpha
\gamma
q_{t}(\cdot)
p_{t}(\cdot)
\gamma=1
q
p
t
\displaystyle L_{\rm def}(r;x_{<t})=\big{(}1-r(x_{<t})\big{)}\cdot\mathbb{E}_{%
x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]+r(x_{<t})%
\cdot\big{(}\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{%
t})\right]+\alpha\big{)}
\displaystyle L_{\rm def}(r;x_{<t})
\displaystyle=\big{(}1-r(x_{<t})\big{)}\cdot\mathbb{E}_{x_{t}\sim\mathbb{P}(%
\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]+r(x_{<t})\cdot\big{(}\mathbb{E}_{%
x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]+\alpha\big{)}
\displaystyle=r(x_{<t})\cdot\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t}%
)}\left[\ell(x_{t},p_{t})\right]+\alpha-\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|%
x_{<t})}\left[\ell(x_{t},q_{t})\right]\right)\,+\,\mathbb{E}_{x_{t}\sim\mathbb%
{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]
\displaystyle=r(x_{<t})\cdot\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t}%
)}\left[\ell(x_{t},p_{t})\right]+\alpha-\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|%
x_{<t})}\left[\ell(x_{t},q_{t})\right]\right)\,+\,\mathbb{E}_{x_{t}\sim\mathbb%
{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]
r:\mathscr{V}^{t-1}\rightarrow\{0,1\}
x_{<t}
r^{*}(x_{<t})=1
\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]+%
\alpha-\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})%
\right]<0,
r^{*}(x_{<t})=0
x
\kappa(x)=\min\left\{1,\frac{p(x)}{(1-\alpha)\cdot q(x)}\right\},
p_{\rm res}(x)=\operatorname{norm}\left(\max\left\{0,\,\frac{1}{\beta}\cdot p(%
x)-q(x)\right\}\right),
\alpha\in[0,1)
\beta\geq 1-\alpha
\pi(x)=\max\left\{\min\left\{q(x),\frac{p(x)}{1-\alpha}\right\},\frac{p(x)}{%
\beta}\right\}
x
\pi
\kappa^{\pi}(x)=\min\left\{1,\frac{\pi(x)}{q(x)}\right\}.
p^{\pi}_{\rm res}(x)=\operatorname{norm}\left(\max\left\{0,\,\pi(x)-q(x)\right%
\}\right).
q(x)>\frac{1}{1-\alpha}\cdot p(x)\geq\frac{1}{\beta}\cdot p(x)
\pi(x)=\frac{1}{1-\alpha}\cdot p(x)
\kappa^{\pi}(x)=\min\left\{1,\frac{p(x)}{(1-\alpha)\cdot q(x)}\right\}=\kappa(%
x);
\displaystyle p^{\pi}_{\rm res}(x)=\operatorname{norm}\left(\max\left\{0,\,%
\frac{1}{1-\alpha}\cdot p(x)-q(x)\right\}\right)
\displaystyle p^{\pi}_{\rm res}(x)
\displaystyle=\operatorname{norm}\left(\max\left\{0,\,\frac{1}{1-\alpha}\cdot p%
(x)-q(x)\right\}\right)
\displaystyle=0=\operatorname{norm}\left(\max\left\{0,\,\frac{1}{\beta}\cdot p%
(x)-q(x)\right\}\right)=p_{\rm res}(x).
\displaystyle=0=\operatorname{norm}\left(\max\left\{0,\,\frac{1}{\beta}\cdot p%
(x)-q(x)\right\}\right)=p_{\rm res}(x).
\frac{1}{1-\alpha}\cdot p(x)\geq\frac{1}{\beta}\cdot p(x)>q(x)
\pi(x)=\frac{1}{\beta}\cdot p(x)
\kappa^{\pi}(x)=\min\left\{1,\frac{p(x)}{\beta\cdot q(x)}\right\}=1=\min\left%
\{1,\frac{p(x)}{(1-\alpha)\cdot q(x)}\right\}=\kappa(x);
\displaystyle p^{\pi}_{\rm res}(x)=\operatorname{norm}\left(\max\left\{0,\,%
\frac{1}{\beta}\cdot p(x)-q(x)\right\}\right)=p_{\rm res}(x).
\displaystyle p^{\pi}_{\rm res}(x)
\displaystyle=\operatorname{norm}\left(\max\left\{0,\,\frac{1}{\beta}\cdot p(x%
)-q(x)\right\}\right)=p_{\rm res}(x).
\frac{1}{1-\alpha}\cdot p(x)\geq q(x)\geq\frac{1}{\beta}\cdot p(x)
\pi(x)=q(x)
\kappa^{\pi}(x)=1=\min\left\{1,\frac{p(x)}{(1-\alpha)\cdot q(x)}\right\}=%
\kappa(x);
p^{\pi}_{\rm res}(x)=0=\operatorname{norm}\left(\max\left\{0,\,\frac{1}{\beta}%
\cdot p(x)-q(x)\right\}\right)=p_{\rm res}(x).
\pi_{t}
q_{t}
\displaystyle\text{rejection probability}=\sum_{v\in\mathscr{V}}q_{t}(v)\cdot%
\left(1-\min\left\{1,\frac{\pi_{t}(v)}{q_{t}(v)}\right\}\right)
\displaystyle=\sum_{v\in\mathscr{V}}q_{t}(v)\cdot\left(1-\min\left\{1,\frac{%
\pi_{t}(v)}{q_{t}(v)}\right\}\right)
\displaystyle=1-\sum_{v\in\mathscr{V}}\min\left\{q_{t}(v),\pi_{t}(v)\right\}
\displaystyle=1-\sum_{v\in\mathscr{V}}\min\left\{q_{t}(v),\pi_{t}(v)\right\}
\displaystyle=\sum_{v\in\mathscr{V}}\pi_{t}(v)-\sum_{v\in\mathscr{V}}\min\left%
\{q_{t}(v),\pi_{t}(v)\right\}
\displaystyle=\sum_{v\in\mathscr{V}}\pi_{t}(v)-\sum_{v\in\mathscr{V}}\min\left%
\{q_{t}(v),\pi_{t}(v)\right\}
\displaystyle=\sum_{v\in\mathscr{V}}\max\left\{0,\pi_{t}(v)-q_{t}(v)\right\}.
\displaystyle=\sum_{v\in\mathscr{V}}\max\left\{0,\pi_{t}(v)-q_{t}(v)\right\}.
\pi
\text{rejection probability}=\sum_{v\in\mathscr{V}}\max\left\{0,\,(1-r(x_{<t})%
)\cdot q_{t}(v)+r(x_{<t})\cdot p_{t}(v)-q_{t}(v)\right\}
r(x_{<t})=1
\displaystyle\text{rejection probability}=\sum_{v\in\mathscr{V}}\min\left\{0,%
\,p_{t}(v)-q_{t}(v)\right\}=D_{\textrm{TV}}(p_{t},q_{t})=r(x_{<t})\cdot D_{%
\textrm{TV}}(p_{t},q_{t}).
\displaystyle=\sum_{v\in\mathscr{V}}\min\left\{0,\,p_{t}(v)-q_{t}(v)\right\}=D%
_{\textrm{TV}}(p_{t},q_{t})=r(x_{<t})\cdot D_{\textrm{TV}}(p_{t},q_{t}).
r(x_{<t})=0
\displaystyle\text{rejection probability}=0=r(x_{<t})\cdot D_{\textrm{TV}}(p_{%
t},q_{t}),
\displaystyle=0=r(x_{<t})\cdot D_{\textrm{TV}}(p_{t},q_{t}),
\displaystyle L_{\rm spec}(r;x_{<t})=r(x_{<t})\cdot\left(\mathbb{E}_{x_{t}\sim%
\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]+\alpha\cdot D_{\textrm%
{TV}}(p_{t},q_{t})-\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_%
{t},q_{t})\right]\right)
\displaystyle L_{\rm spec}(r;x_{<t})
\displaystyle=r(x_{<t})\cdot\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t}%
)}\left[\ell(x_{t},p_{t})\right]+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-%
\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\right)
\displaystyle\hskip 199.16928pt+\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},q_{t})\right].
\displaystyle\hskip 199.16928pt+\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},q_{t})\right].
r:\mathscr{V}^{t-1}\rightarrow\{0,1\}
x_{<t}
r^{*}(x_{<t})=1
\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]+%
\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot%
|x_{<t})}\left[\ell(x_{t},q_{t})\right]<0,
r^{*}(x_{<t})=0
x_{<t}
\displaystyle L_{\rm spec}(r;x_{<t})=r(x_{<t})\cdot\left(\mathbb{E}_{x_{t}\sim%
\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]+\alpha\cdot D_{\textrm%
{TV}}(p_{t},q_{t})-\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_%
{t},q_{t})\right]\right)+C,
\displaystyle L_{\rm spec}(r;x_{<t})
\displaystyle=r(x_{<t})\cdot\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t}%
)}\left[\ell(x_{t},p_{t})\right]+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-%
\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]%
\right)+C,
C
r
r^{*}:\mathscr{V}^{t-1}\rightarrow\{0,1\}
L_{\rm spec}
x_{<t}
\displaystyle L_{\rm spec}\left(\hat{r}_{\rm\tt OPT};x_{<t}\right)-L_{\rm spec%
}\left(r^{*};x_{<t}\right)
\displaystyle L_{\rm spec}\left(\hat{r}_{\rm\tt OPT};x_{<t}\right)-L_{\rm spec%
}\left(r^{*};x_{<t}\right)
\displaystyle=\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})\right)\cdot%
\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})%
\right]+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\mathbb{E}_{x_{t}\sim\mathbb{%
P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\right).
\displaystyle=\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})\right)\cdot%
\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})%
\right]+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\mathbb{E}_{x_{t}\sim\mathbb{%
P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\right).
\max_{v}q_{t}(v)-\max_{v}p_{t}(v)
\displaystyle L_{\rm spec}\left(\hat{r}_{\rm\tt OPT};x_{<t}\right)-L_{\rm spec%
}\left(r^{*};x_{<t}\right)
\displaystyle L_{\rm spec}\left(\hat{r}_{\rm\tt OPT};x_{<t}\right)-L_{\rm spec%
}\left(r^{*};x_{<t}\right)
\displaystyle=\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})\right)\cdot%
\left(\max_{v}q_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\max_{v}p_{t}(%
v)\right)
\displaystyle=\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})\right)\cdot%
\left(\max_{v}q_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\max_{v}p_{t}(%
v)\right)
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left(\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right)\cdot\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},p_{t})\right]-\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},q_{t})\right]-\max_{v}q_{t}(v)+\max_{v}p_{t}(v)\right)
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left(\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right)\cdot\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},p_{t})\right]-\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},q_{t})\right]-\max_{v}q_{t}(v)+\max_{v}p_{t}(v)\right)
\displaystyle=\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})\right)\cdot%
\left(\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\max_{v}q_{t}(%
v)\right)
\displaystyle=\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})\right)\cdot%
\left(\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\max_{v}q_{t}(%
v)\right)
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left(\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right)\cdot\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},p_{t})\right]-1+\max_{v}p_{t}(v)\right)
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left(\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right)\cdot\left(\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},p_{t})\right]-1+\max_{v}p_{t}(v)\right)
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left(\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right)\cdot\left(1-\max_{v}q_{t}(v)-\mathbb{E}_{x_{t}\sim\mathbb%
{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\right)
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left(\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right)\cdot\left(1-\max_{v}q_{t}(v)-\mathbb{E}_{x_{t}\sim\mathbb%
{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\right)
\displaystyle=\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})\right)\cdot%
\left(\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\max_{v}q_{t}(%
v)\right)
\displaystyle=\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})\right)\cdot%
\left(\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\max_{v}q_{t}(%
v)\right)
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left|\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right|\cdot\left|\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},p_{t})\right]-1+\max_{v}p_{t}(v)\right|
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left|\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right|\cdot\left|\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}%
\left[\ell(x_{t},p_{t})\right]-1+\max_{v}p_{t}(v)\right|
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left|\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right|\cdot\left|1-\max_{v}q_{t}(v)-\mathbb{E}_{x_{t}\sim\mathbb%
{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\right|
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\left|\hat{r}_{\rm\tt OPT}(x_{<t})-%
r^{*}(x_{<t})\right|\cdot\left|1-\max_{v}q_{t}(v)-\mathbb{E}_{x_{t}\sim\mathbb%
{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\right|
\displaystyle=\underbrace{\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})%
\right)\cdot\left(\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-%
\max_{v}q_{t}(v)\right)}_{\text{term}_{1}}
\displaystyle=\underbrace{\left(\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})%
\right)\cdot\left(\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-%
\max_{v}q_{t}(v)\right)}_{\text{term}_{1}}
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\underbrace{\left|\mathbb{E}_{x_{t}%
\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]-1+\max_{v}p_{t}(v)%
\right|}_{\text{term}_{2}}+\underbrace{\left|1-\max_{v}q_{t}(v)-\mathbb{E}_{x_%
{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\right|}_{\text{%
term}_{3}}
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ +\underbrace{\left|\mathbb{E}_{x_{t}%
\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]-1+\max_{v}p_{t}(v)%
\right|}_{\text{term}_{2}}+\underbrace{\left|1-\max_{v}q_{t}(v)-\mathbb{E}_{x_%
{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\right|}_{\text{%
term}_{3}}
\left|\hat{r}_{\rm\tt OPT}(x_{<t})-r^{*}(x_{<t})\right|\leq 1.
\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\max_{v}q_{t}(v)\leq
0
\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-\max_{v}q_{t}(v)>0
\hat{r}_{\rm\tt OPT}(x_{<t})=1
r^{*}(x_{<t})
\displaystyle\text{term}_{1}\leq\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p%
_{t},q_{t})-\max_{v}q_{t}(v)\leq 0
\displaystyle\text{term}_{1}
\displaystyle\leq\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{t})-%
\max_{v}q_{t}(v)\leq 0
\hat{r}_{\rm\tt OPT}(x_{<t})=0
r^{*}(x_{<t})
\displaystyle\text{term}_{1}\leq-\left(\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm%
{TV}}(p_{t},q_{t})-\max_{v}q_{t}(v)\right)<0.
\displaystyle\text{term}_{1}
\displaystyle\leq-\left(\max_{v}p_{t}(v)+\alpha\cdot D_{\textrm{TV}}(p_{t},q_{%
t})-\max_{v}q_{t}(v)\right)<0.
\displaystyle\text{term}_{1}\leq 0.
\displaystyle\text{term}_{1}\leq 0.
\ell=\ell_{\text{0-1}}
\displaystyle\text{term}_{2}=\left|\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t%
})}\left[\ell(x_{t},p_{t})\right]-1+\max_{v}p_{t}(v)\right|
\displaystyle\text{term}_{2}
\displaystyle=\left|\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\ell(x%
_{t},p_{t})\right]-1+\max_{v}p_{t}(v)\right|
\displaystyle=\left|\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[1\left%
(x_{t}\neq\operatorname*{arg\,max}_{v}p_{t}(v)\right)\right]-1+\max_{v}p_{t}(v%
)\right|
\displaystyle=\left|\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[1\left%
(x_{t}\neq\operatorname*{arg\,max}_{v}p_{t}(v)\right)\right]-1+\max_{v}p_{t}(v%
)\right|
\displaystyle=\left|\max_{v}p_{t}(v)-\sum_{x_{t}}\mathbb{P}(x_{t}|x_{<t})\cdot
1%
\left(x_{t}=\operatorname*{arg\,max}_{v}p_{t}(v)\right)\right|
\displaystyle=\left|\max_{v}p_{t}(v)-\sum_{x_{t}}\mathbb{P}(x_{t}|x_{<t})\cdot
1%
\left(x_{t}=\operatorname*{arg\,max}_{v}p_{t}(v)\right)\right|
v^{*}\in\operatorname*{arg\,max}_{v}p_{t}(v)
\displaystyle\text{term}_{2}=\left|p_{t}(v^{*})-\mathbb{P}(v^{*}|x_{<t})\right%
|\leq\max_{v}\left|p_{t}(v)-\mathbb{P}(v|x_{<t})\right|.
\displaystyle\text{term}_{2}
\displaystyle=\left|p_{t}(v^{*})-\mathbb{P}(v^{*}|x_{<t})\right|\leq\max_{v}%
\left|p_{t}(v)-\mathbb{P}(v|x_{<t})\right|.
\displaystyle\text{term}_{3}\leq\max_{v}\left|q_{t}(v)-\mathbb{P}(v|x_{<t})%
\right|.
\displaystyle\text{term}_{3}
\displaystyle\leq\max_{v}\left|q_{t}(v)-\mathbb{P}(v|x_{<t})\right|.
\delta(q,p)
\pi(x)
p(x)
\max\{\min\{p(x),\frac{q(x)}{1-\alpha}\},\frac{q(x)}{\beta}\}
\bm{1}\big{(}\,D(q,p)>\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<1-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\,\textrm{entropy}(q)>\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<\max_{v}p(v)-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\,\textrm{entropy}(p)<\textrm{entropy}(q)-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<1-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\,\textrm{entropy}(q)>\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<\max_{v}p(v)-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\,\textrm{entropy}(p)<\textrm{entropy}(q)-\alpha\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\max_{v}q(v)<\max_{v}p(v)-\alpha\cdot D_{\textrm{TV}}(p,q)\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\bm{1}\big{(}\,\textrm{entropy}(p)<\textrm{entropy}(q)-\alpha\cdot D_{\textrm{%
TV}}(p,q)\big{)}
(1-\delta)\cdot q(x)+\delta\cdot p(x)
\alpha
\beta\geq 1-\alpha
q,p
\alpha
D(q,p)
q
p
\alpha
\beta\geq 1-\alpha
q,p
\alpha
D(q,p)
q
p
\displaystyle L_{\rm rej}(r;x_{<t})=\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<%
t})}\Big{[}\big{(}1-r(x_{<t})\big{)}\cdot\ell(x_{t},q_{t})+r(x_{<t})\cdot%
\alpha\Big{]},
\displaystyle L_{\rm rej}(r;x_{<t})
\displaystyle=\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\Big{[}\big{(}1-r(%
x_{<t})\big{)}\cdot\ell(x_{t},q_{t})+r(x_{<t})\cdot\alpha\Big{]},
\alpha\in[0,1]
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{x_{t}\sim\mathbb{P}(%
\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\,>\,\alpha.
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{x_{t}\sim\mathbb{P}(%
\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\,>\,\alpha.
\ell=\ell_{\text{0-1}}
q_{t}
1-\max_{v}q_{t}(v)
\hat{r}_{\rm\tt Chow}(x_{<t})
\ell=\ell_{\log}
q_{t}
q_{t}
\displaystyle\hat{r}_{\rm\tt ChowLog}(x_{<t})=1\leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \textrm{entropy}\big{(}q(\cdot|x_{<t})\big{)}>\alpha,
\displaystyle\hat{r}_{\rm\tt ChowLog}(x_{<t})=1\leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \textrm{entropy}\big{(}q(\cdot|x_{<t})\big{)}>\alpha,
\textrm{entropy}(q)=-\sum_{v\in\mathscr{V}}q(v)\cdot\log(q(v)).
\ell=\ell_{\log}
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{x_{t}\sim\mathbb{P}(%
\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\,>\,\mathbb{E}_{x_{t}\sim\mathbb{%
P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]+\alpha\cdot D_{\textup{{TV}}}(%
p_{t},q_{t}).
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{x_{t}\sim\mathbb{P}(%
\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\,>\,\mathbb{E}_{x_{t}\sim\mathbb{%
P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]+\alpha\cdot D_{\textup{{TV}}}(%
p_{t},q_{t}).
\ell=\ell_{\log}
-\sum_{v}q_{t}(v)\cdot\log(q_{t}(v))
q_{t}
p_{t}
\displaystyle\textstyle\hat{r}_{\rm\tt DiffLog}(x_{<t})=1\leavevmode\nobreak\ %
\leavevmode\nobreak\ \iff\leavevmode\nobreak\ \leavevmode\nobreak\ \sum_{v}q_{%
t}(v)\cdot\log(q_{t}(v))\,<\,\sum_{v}p_{t}(v)\cdot\log(p_{t}(v))-\alpha.
\displaystyle\textstyle\hat{r}_{\rm\tt DiffLog}(x_{<t})=1\leavevmode\nobreak\ %
\leavevmode\nobreak\ \iff\leavevmode\nobreak\ \leavevmode\nobreak\ \sum_{v}q_{%
t}(v)\cdot\log(q_{t}(v))\,<\,\sum_{v}p_{t}(v)\cdot\log(p_{t}(v))-\alpha.
\ell=\ell_{\log}
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{x_{t}\sim\mathbb{P}(%
\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\,>\,\mathbb{E}_{x_{t}\sim\mathbb{%
P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]+\alpha\cdot D_{\textup{{TV}}}(%
p_{t},q_{t}).
\displaystyle r^{*}(x_{<t})=1\leavevmode\nobreak\ \leavevmode\nobreak\ \iff%
\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{x_{t}\sim\mathbb{P}(%
\cdot|x_{<t})}\left[\ell(x_{t},q_{t})\right]\,>\,\mathbb{E}_{x_{t}\sim\mathbb{%
P}(\cdot|x_{<t})}\left[\ell(x_{t},p_{t})\right]+\alpha\cdot D_{\textup{{TV}}}(%
p_{t},q_{t}).
\ell=\ell_{\log}
\displaystyle\textstyle\hat{r}_{\rm\tt OPTLog}(x_{<t})=1\leavevmode\nobreak\ %
\iff\leavevmode\nobreak\ \sum_{v}q_{t}(v)\cdot\log(q_{t}(v))\,<\,\sum_{v}p_{t}%
(v)\cdot\log(p_{t}(v))-\alpha\cdot D_{\textup{{TV}}}(p_{t},q_{t}).
\displaystyle\textstyle\hat{r}_{\rm\tt OPTLog}(x_{<t})=1\leavevmode\nobreak\ %
\iff\leavevmode\nobreak\ \sum_{v}q_{t}(v)\cdot\log(q_{t}(v))\,<\,\sum_{v}p_{t}%
(v)\cdot\log(p_{t}(v))-\alpha\cdot D_{\textup{{TV}}}(p_{t},q_{t}).
\hat{r}_{\rm\tt OPTLog}
\ell=\ell_{\log}
x_{<t}
|\log(q(v))|\leq B_{q}
|\log(p(v))|\leq B_{p},\,\forall v\in\mathscr{V}
B_{q},B_{p}>0
L_{\rm spec}(r_{\rm\tt OPT};x_{<t})-\min_{r}L_{\rm spec}(r;x_{<t})\leavevmode%
\nobreak\ \leq\leavevmode\nobreak\ \textstyle B_{q}\cdot\sum_{v\in\mathscr{V}}%
\big{|}\mathbb{P}(v|x_{<t})-q_{t}(v)\big{|}\,+\,B_{p}\cdot\sum_{v\in\mathscr{V%
}}\big{|}\mathbb{P}(v|x_{<t})-p_{t}(v)\big{|}.
\text{term}_{2}
\text{term}_{3}
\displaystyle\text{term}_{2}=\left|\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t%
})}\left[\log(p_{t}(x_{t}))\right]-\sum_{v}p_{t}(v)\cdot\log(p_{t}(v))\right|
\displaystyle\text{term}_{2}
\displaystyle=\left|\mathbb{E}_{x_{t}\sim\mathbb{P}(\cdot|x_{<t})}\left[\log(p%
_{t}(x_{t}))\right]-\sum_{v}p_{t}(v)\cdot\log(p_{t}(v))\right|
\displaystyle=\left|\sum_{v}\mathbb{P}(v|x_{<t})\cdot\log(p_{t}(v))-\sum_{v}p_%
{t}(v)\cdot\log(p_{t}(v))\right|
\displaystyle=\left|\sum_{v}\mathbb{P}(v|x_{<t})\cdot\log(p_{t}(v))-\sum_{v}p_%
{t}(v)\cdot\log(p_{t}(v))\right|
\displaystyle\leq\sum_{v}\left|\mathbb{P}(v|x_{<t})-\sum_{v}p_{t}(v)\right|%
\cdot\log(p_{t}(v))
\displaystyle\leq\sum_{v}\left|\mathbb{P}(v|x_{<t})-\sum_{v}p_{t}(v)\right|%
\cdot\log(p_{t}(v))
\displaystyle\leq B_{p}\cdot\sum_{v}\left|\mathbb{P}(v|x_{<t})-\sum_{v}p_{t}(v%
)\right|.
\displaystyle\leq B_{p}\cdot\sum_{v}\left|\mathbb{P}(v|x_{<t})-\sum_{v}p_{t}(v%
)\right|.
\displaystyle\text{term}_{3}\leq\sum_{v}\left|\mathbb{P}(v|x_{<t})-\sum_{v}p_{%
t}(v)\right|\cdot\log(p_{t}(v))
\displaystyle\text{term}_{3}
\displaystyle\leq\sum_{v}\left|\mathbb{P}(v|x_{<t})-\sum_{v}p_{t}(v)\right|%
\cdot\log(p_{t}(v))
\displaystyle\leq B_{q}\cdot\sum_{v}\left|\mathbb{P}(v|x_{<t})-\sum_{v}q_{t}(v%
)\right|.
\displaystyle\leq B_{q}\cdot\sum_{v}\left|\mathbb{P}(v|x_{<t})-\sum_{v}q_{t}(v%
)\right|.
T\rightarrow 0
\tilde{r}_{\rm\tt OPT}
\tilde{q}_{t}
\hat{r}_{\rm\tt Diff}
\tilde{q}_{t}
\tilde{q}_{t}
\tilde{p}_{t}
\operatorname*{arg\,max}_{v}q_{t}(v)
\operatorname*{arg\,max}_{v}p_{t}(v)
D_{\textrm{TV}}(\tilde{q}_{t},\tilde{p}_{t})=\bm{1}\left(\operatorname*{arg\,%
max}_{v}q_{t}(v)\neq\operatorname*{arg\,max}_{v}p_{t}(v)\right).
\tilde{r}_{\rm\tt OPT}
v
\kappa(v)=\min\left\{1,\frac{(1-\delta_{\rm OPT}(q,p))\cdot\tilde{q}(v)+\delta%
_{\rm OPT}(q,p)\cdot\tilde{p}(v)}{\tilde{q}(v)}\right\}
\delta_{\rm OPT}(q,p)\leavevmode\nobreak\ =\leavevmode\nobreak\ \bm{1}\left(%
\max_{v}q(v)\,<\,\max_{v}p(v)-\alpha\cdot\bm{1}\left(\operatorname*{arg\,max}_%
{v}q(v)\neq\operatorname*{arg\,max}_{v}p(v)\right)\right)
\operatorname*{arg\,max}_{v}q(v)=\operatorname*{arg\,max}_{v}p(v)
\tilde{q}=\tilde{p}
\delta(q,p),
\pi(v)=1
\operatorname*{arg\,max}_{v}q(v)\neq\operatorname*{arg\,max}_{v}p(v)
\pi(v)=1-\delta_{\rm OPT}(q,p)=\bm{1}\left(\max_{v}q(v)\,\geq\,\max_{v}p(v)-%
\alpha\right)=1-\delta_{\rm\tt Diff}(q,p).
p_{\rm res}(v)\propto\min\{0,(1-\delta_{\rm OPT}(q,p))\cdot\tilde{q}(v)+\delta%
_{\rm OPT}(q,p)\cdot\tilde{p}(v)-\tilde{q}(v)\}=\delta_{\rm OPT}(q,p)\cdot\min%
\{0,\tilde{p}(v)-\tilde{q}(v)\}
\operatorname*{arg\,max}_{v}q(v)=\operatorname*{arg\,max}_{v}p(v)
p_{\rm res}(v)=0
\operatorname*{arg\,max}_{v}q(v)\neq\operatorname*{arg\,max}_{v}p(v)
p_{\rm res}(v)\propto\delta_{\rm OPT}(q,p)\cdot\min\{0,\tilde{p}(v)-\tilde{q}(%
v)\}=\delta_{\rm Diff}(q,p)\cdot\min\{0,\tilde{p}(v)-\tilde{q}(v)\}.
\hat{r}_{\rm\tt Diff}
x_{<t}
\min_{r\in\{0,1\}}(1-r)\cdot c_{0}+r\cdot c_{1}\leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ \text{s.t.}\leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ r\cdot c_{2}\leq B,
c_{0},c_{1},c_{2}>0
r
\min_{r\in\{0,1\}}(1-r)\cdot c_{0}+r\cdot c_{1}+\alpha\cdot r\cdot c_{2},
\alpha=0
c_{2}\leq B
\alpha>\frac{1}{c_{2}}\cdot(c_{0}-c_{1})
q
p
r
x_{<t}
\gamma
\mathbb{T}_{\tt Token}(q,p)(v)\stackrel{{\scriptstyle.}}{{=}}q(v)\cdot(1-r(x_{%
<t},v))+p(v)\cdot\sum_{v^{\prime}\in\mathscr{V}}r(x_{<t},v^{\prime})\cdot q(v^%
{\prime})
\text{\tt{GenSpecSample}}(q,p,\mathbb{T}_{\tt Token},x_{<t},\gamma)
x_{<t}
\displaystyle\min_{r}\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{v%
\sim\mathbb{P}(\cdot|x_{<t})}\Big{[}\ell(v,\pi_{\tt Token})\big{)}\Big{]}
\displaystyle\min_{r}
\displaystyle\leavevmode\nobreak\ \leavevmode\nobreak\ \mathbb{E}_{v\sim%
\mathbb{P}(\cdot|x_{<t})}\Big{[}\ell(v,\pi_{\tt Token})\big{)}\Big{]}
\displaystyle\text{s.t.}\leavevmode\nobreak\ \leavevmode\nobreak\ D_{\textrm{%
TV}}(\pi_{\tt Token},q_{t})\,\leq\,B,
\displaystyle\text{s.t.}\leavevmode\nobreak\ \leavevmode\nobreak\ D_{\textrm{%
TV}}(\pi_{\tt Token},q_{t})\,\leq\,B,
\pi_{\tt Token}(v)\stackrel{{\scriptstyle.}}{{=}}(1-r(x_{<t},v))\cdot q_{t}(v)%
+\eta\cdot p_{t}(v)
r
\eta=\sum_{v^{\prime}\in\mathscr{V}}r(x_{<t},v^{\prime})\cdot q_{t}(v^{\prime})
B>0
\ell=\ell_{\text{0-1}}
q_{t}
\mathbb{P}(\cdot|x_{<t})
\operatorname*{arg\,max}_{v}q_{t}(v)=\operatorname*{arg\,max}_{v}\mathbb{P}(v|%
x_{<t})
r(x_{<t},v)=0,
v\in\mathscr{V}
T=1
\gamma=5
x
T=1
\gamma=5
x
T=0
\gamma=5
x
T=0
\gamma=5
x
T=0
\rightarrow
\gamma
\alpha
D
D(q,p)=-\log\left(p\left(\operatorname*{arg\,max}_{v}q(v)\right)\right),
\alpha
[0,10]
D
D(q,p)=-\mathbb{E}_{v\sim q}\left[\log(p(v))\right]=-\sum_{v\in\mathscr{V}}q(v%
)\cdot\log(p(v)).
T=1
T\rightarrow 0
D_{\textup{{TV}}}(\tilde{p}_{t},\tilde{q}_{t})=1
\operatorname*{arg\,max}_{v}p_{t}(v)\neq\operatorname*{arg\,max}_{v}q_{t}(v)
\tilde{r}_{\rm\tt OPT}
\tilde{q}_{t}
\hat{r}_{\rm\tt Diff}
q_{t}(\cdot)
p_{t}(\cdot)
x
x
\gamma
\gamma
\gamma
\gamma=3
\gamma=7
\gamma
x
\gamma
x
\gamma
\alpha_{f}
\beta=1
\beta
\gamma
\alpha_{f}
\beta=1
\beta
\mathbb{T}_{\textup{BiLD}}
\max_{v}q(v)<1-\alpha_{f}
\alpha_{f}\in[0,1]
D(q,p)>\alpha
T=0
D(q,p)=\log p\left(\operatorname*{arg\,max}_{v}q(v)\right).
\gamma
\alpha_{f}
\alpha
D(q,p)
\alpha_{f}
\gamma=10,\alpha=0.9
\gamma=5,\alpha=0.1
\mathbb{T}_{\rm BiLD}
D(q_{t},p_{t})>\alpha
\beta
\beta
\beta=1
\beta
\alpha
\beta
p
R
R
\alpha
\beta
\alpha
\alpha
p
\beta\geq 1-\alpha
\sum_{v}\max\left\{0,q(v)-\frac{p(v)}{1-\alpha}\right\}=\sum_{v}\max\left\{0,%
\frac{p(v)}{\beta}-q(v)\right\}
\beta
\alpha
\beta=1
\beta
\beta=1
\beta
\beta
\beta=1
p
\rightarrow
\rightarrow
\rightarrow
p_{t}(\cdot)
q
p
q_{t}(\cdot)
\alpha
p_{t}(\cdot)
p_{t}(\cdot)
x
x
\rightarrow
\rightarrow
\mathbb{P}
t
