P
Q
P
Q
\mathcal{D}_{\text{train}}=\{(\boldsymbol{x}_{i},\tilde{y}_{i})\}_{i}^{N}
K
\boldsymbol{x}_{i}
i
\tilde{y}_{i}\in[K]
N
y_{i}
\boldsymbol{x}_{i}
\mathcal{D}_{\text{train}}
N_{1}\geq N_{2}\geq...\geq N_{K}
N_{k}
k
\frac{N_{1}}{N_{K}}
\mathcal{D}_{\text{train}}
\tilde{y}_{i}
y_{i}
[K]
\theta
f:\boldsymbol{x}\rightarrow\boldsymbol{z}
g:\boldsymbol{z}\rightarrow y
\theta
P
Q
P=\sum_{i}^{n}a_{i}\delta_{x_{i}}
Q=\sum_{j}^{m}b_{j}\delta_{y_{j}}
\delta
x_{i}
y_{j}
\boldsymbol{a}\in\Delta^{n}
\boldsymbol{b}\in\Delta^{m}
\mathbb{R}^{n}
\mathbb{R}^{m}
P
Q
\text{OT}(P,Q)=\min\limits_{{\bf T}\in\Pi{(P,Q)}}\langle{\bf T},{\bf D}\rangle%
=\sum_{i=1}^{n}\sum_{j=1}^{m}T_{ij}D_{ij},
{\bf D}\in\mathbb{R}^{n\times m}_{\geq 0}
D_{ij}=dist(x_{i},y_{j})
x_{i}
y_{j}
{\bf T}\in\mathbb{R}_{\geq 0}^{n\times m}
\Pi(P,Q):\!=\!\left\{\mathbb{T}|\sum_{i=1}^{n}T_{ij}=b_{j},\sum_{j=1}^{m}T_{ij%
}=a_{i}\right\}
H({\bf T})=-\sum_{ij}{T}_{ij}\log{T}_{ij}
\mathcal{X}
\mathcal{D}_{\text{train}}
\mathcal{X}
\mathcal{D}_{\text{train}}
f
\boldsymbol{z}_{i}=f(\boldsymbol{x_{i}})\in\mathbb{R}^{d}
\boldsymbol{x_{i}}
f
\boldsymbol{\mathcal{C}}:=\{\boldsymbol{\mathcal{C}}_{1},\boldsymbol{\mathcal{%
C}}_{2},...,\boldsymbol{\mathcal{C}}_{K}\}\in\mathbb{R}^{K\times d}
\{\boldsymbol{x}_{i}\}_{i=1}^{N}
N_{j}
j
\mathcal{D}_{\text{train}}
\mathcal{X}
\mathcal{D}_{\text{train}}
N
P=\sum_{i=1}^{N}\frac{1}{N}\delta_{\boldsymbol{z}_{i}}.
P
P
Q=\sum_{j=1}^{K}b_{j}\delta_{\boldsymbol{\mathcal{C}}_{j}},
b_{j}\sim\boldsymbol{b}
j
b_{j}
b_{j}=\frac{(1-\beta)/(1-\beta^{N_{j}})}{\sum_{k=1}^{K}{(1-\beta)/(1-\beta^{N_%
{k}})}}
\beta\in(0,1)
\beta
P
Q
\text{OT}_{\gamma}(P,Q)=\min\limits_{{\bf T}\in\Pi{(p,q)}}\langle{\bf T},{\bf D%
}\rangle-\gamma H({\bf T}),
\gamma
D_{ij}
{\bf D}\in\mathbb{R}^{N\times K}
\boldsymbol{z}_{i}
\boldsymbol{\mathcal{C}}_{j}
D_{ij}=1-\text{cosine}(\boldsymbol{z}_{i},\boldsymbol{\mathcal{C}}_{j})
{\bf T}\in\mathbb{R}^{N\times K}
\Pi(P,Q):=\{\mathbf{T}\,|\,\sum_{i=1}^{N}T_{ij}=b_{j},\sum_{j=1}^{K}T_{ij}=1/N\}
\boldsymbol{z}_{i}
\boldsymbol{\mathcal{C}}_{j}
D_{ij}
T_{ij}
\text{OT}_{\gamma}(P,Q)
T_{ij}
j
i
i
K
T_{i,1:K}
T_{i,1:K}
N
P
K
T_{ij}
i
j
b_{j}
j
j
j
T_{ij}
i
j
i
j
{\bf T}\in\mathbb{R}^{N\times K}
\boldsymbol{x}_{i}
\operatorname*{arg\,max}\limits_{j^{\prime}\in[K]}j^{\prime}=\{i\in[N]:j^{%
\prime}=\max\limits_{j\in[K]}(T_{ij})\}.
\{\hat{y}_{i}\}_{i=1}^{N}
\mathcal{D}_{\text{train}}
b_{j}
\mathcal{D}_{\text{train}}
\tilde{y}
\hat{y}
y
\tilde{y}
\hat{y}
\tilde{y}
\hat{y}
\hat{y}
\tilde{y}
\mathcal{X}=\mathcal{X}\bigcup(\boldsymbol{x}_{i},y_{i}),\quad y_{i}=\tilde{y}%
_{i}\quad\text{if}\quad\tilde{y}_{i}=\hat{y}_{i},
\mathcal{X}
\emptyset
\mathcal{X}
f
g
\theta
\ell=\sum_{(\boldsymbol{x}_{i},y_{i})\sim\mathcal{X}}-\log\operatorname{Pr}(y_%
{i}\mid\boldsymbol{x}_{i};\theta).
\mathcal{D}_{\text{train}}
f
g
E
\{\alpha,\beta,\gamma\}
g(f(\cdot))
e=1,...,E
\mathcal{X}\leftarrow\emptyset
\{(\boldsymbol{x}_{i},\tilde{y}_{i})\}_{i=1}^{B}\sim\mathcal{D}_{\text{train}}
P
\sum_{i=1}^{B}\frac{1}{B}\delta_{f(\boldsymbol{x}_{i})}
Q
\sum_{j=1}^{K}b_{j}\delta_{\boldsymbol{\mathcal{C}}_{j}}
b_{j}=\frac{(1-\beta)/(1-\beta^{N_{j}})}{\sum_{k=1}^{K}{(1-\beta)/(1-\beta^{N_%
{k}})}}
{\bf T}
{\bf T}
\hat{\boldsymbol{y}}=\{\hat{y}_{1},\hat{y}_{2},...,\hat{y}_{B}\}
\hat{y}_{j}
\{(\boldsymbol{x}_{i},\tilde{y}_{i})\}_{i}^{B^{\prime}}
\mathcal{X}
x_{i}
\tilde{y}_{i}=\hat{y}_{i}
\mathcal{X}
g(f(\cdot))
\mathcal{X}
\boldsymbol{\mathcal{C}}_{j}
\mathcal{D}_{\text{train}}
\mathcal{X}
\boldsymbol{\mathcal{C}}_{j}\!=\!\alpha*\boldsymbol{\mathcal{C}}_{j}\!+\!(1-%
\alpha)*\boldsymbol{\mathcal{C}}^{\prime}_{j},
\boldsymbol{\mathcal{C}}^{\prime}_{j}
j
\mathcal{X}
\alpha
e
\mathcal{D}_{\text{train}}
\{(\boldsymbol{x}_{i},y_{i})\}_{i=1}^{B^{\prime}}
\mathcal{X}
\boldsymbol{x}_{i}
y_{i}=\tilde{y}_{i}=\hat{y}_{i}
f
g
\{(\boldsymbol{x}_{i},y_{i})\}_{i=1}^{B^{\prime}}
\mathcal{D}_{\text{train}}
\mathcal{X}
\alpha
\beta
\gamma
1\times 10^{-2}
F_{ij}(\boldsymbol{x})
i
j
\boldsymbol{x}
\eta\in[0,1]
F_{ij}(\boldsymbol{x})\!=\!\mathbb{P}(\tilde{y}\!=\!j|y\!=\!i,\boldsymbol{x})%
\!=\!\left\{\begin{aligned} &\ \ \ 1-\eta,\quad\text{if}\quad i\!=\!j\\
&\frac{N_{j}}{N-N_{i}}\eta,\ \text{otherwise}.\end{aligned}\right.
\mathcal{X}
4.2\%
\mathcal{X}
\beta
\beta
\beta
b_{j}
\boldsymbol{\mathcal{C}}_{j}
\beta
\beta
\boldsymbol{b}
\beta
\beta
\beta
\beta
\alpha
b_{j}
32\times 32
320\times 320
299\times 299
84\times 84
6\times 10^{-2}
5\times 10^{-4}
5\times 10^{-4}
5\times 10^{-4}
\times 10
5\times 10^{-4}
\times 10
5\times 10^{-4}
\times 10
\{1,2,...,10\}
P
\mathcal{D}_{\text{train}}
Q
\beta=0
\beta=0.98
{\bf T}
{\bf T}
\beta
\beta
{\bf T}
\mathcal{X}
\beta=0
\beta=0.98
\beta=0
\beta=0.98
\mathcal{X}
\beta
\beta
\beta
\alpha
\alpha
\alpha
\boldsymbol{\mathcal{C}}_{j}=\alpha*\boldsymbol{\mathcal{C}}_{j}+(1-\alpha)*%
\boldsymbol{\mathcal{C}}^{\prime}_{j},
\boldsymbol{\mathcal{C}}^{\prime}_{j}
j
\mathcal{X}
\alpha
\alpha
\mathcal{X}
\alpha=0
\mathcal{X}
\alpha
\mathcal{D}_{\textbf{train}}
\alpha=1
\mathcal{X}
\alpha
\alpha
\Delta
\uparrow 0.04
\uparrow 0.34
\uparrow 1.06
\uparrow 2.33
\uparrow 1.78
\uparrow 1.77
\uparrow 2.15
\uparrow 3.27
\uparrow 3.01
\uparrow 1.11
\uparrow 1.84
\uparrow 1.96
\uparrow 3.09
\uparrow 2.09
\uparrow 2.63
\uparrow 3.30
\uparrow 2.40
\uparrow 2.42
\uparrow 2.47
\uparrow 1.75
\Delta
\uparrow 0.22
\uparrow 0.16
\uparrow 1.15
\uparrow 1.16
\uparrow 1.30
\uparrow 1.43
\uparrow 0.70
\uparrow 1.69
\uparrow 1.75
\uparrow 0.40
\uparrow 0.70
\uparrow 0.96
\uparrow 1.03
\uparrow 1.56
\uparrow 0.95
\uparrow 0.73
\uparrow 1.17
\uparrow 0.90
\uparrow 0.94
\uparrow 1.71
b_{j}
b_{j}
b_{j}
b_{j}
b_{j}
b_{j}
b_{j}
b_{j}
b_{j}=\frac{(1-\beta)/(1-\beta^{N_{j}})}{\sum_{k=1}^{K}{(1-\beta)/(1-\beta^{N_%
{k}})}}
\beta=0
b_{j}=\frac{1/N_{j}^{r}}{\Sigma_{k=1}^{K}1/N_{k}^{r}}
r>0
b_{j}
r=1
r=0.5
r
b_{j}
b_{j}
b_{j}
r
r
\beta
\beta
\beta
\beta
\beta
\beta
\beta
\beta
\mathcal{O}({n^{2}log(n)/\epsilon^{2}})
\epsilon
n
\beta
\beta
\beta
\beta
\beta
\beta
\beta
P
Q
{\bf T}
P
T
b
Q
T
\mathcal{D}_{\text{train}}
\beta
\beta
\beta
