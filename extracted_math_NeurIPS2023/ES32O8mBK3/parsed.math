\Psi
2\Psi
4\Psi
16\Psi
a
p
b
s
h
t
d
c
h_{\text{ffn}}
k
L
v
b\times s\times h
v\times h
L
4h
h
h_{\text{ffn}}
4h
Q=XW_{Q}
K=XW_{K}
V=XW_{V}
W_{O}
g=\frac{a}{k}
W_{Q}
W_{K}
W_{V}
W_{O}
(h,h)
(h,h/g)
(h,h/g)
(h,h)
\begin{split}\text{Attention parameter per layer}=2h^{2}(1+\frac{k}{a})\end{split}
W_{\text{mlp\_up}}
W_{\text{mlp\_gate}}
W_{\text{mlp\_down}}
(h,h_{\text{ffn}})
(h,h_{\text{ffn}})
(h_{\text{ffn}},h)
\text{FFN parameter per layer}=3hh_{ffn}
\begin{split}2hv+L(2h^{2}(1+\frac{k}{a})+3h^{2}\frac{h_{\text{ffn}}}{h}+2h)+h%
\\
=2hv+h+2Lh^{2}(1+\frac{k}{a}+\frac{3}{2}\frac{h_{\text{ffn}}}{h}+\frac{1}{h})%
\end{split}
2hv
L
h
2h^{2}\left(1+\frac{k}{a}\right)
3hh_{\text{ffn}}
2h
h
16\Psi
\Psi
18\Psi
18
\begin{split}18(2hv+h+2Lh^{2}(1+\frac{k}{a}+\frac{3}{2}\frac{h_{\text{ffn}}}{h%
}+\frac{1}{h}))\end{split}
12\Psi
\begin{split}(6+\frac{12}{d})(2hv+h+2Lh^{2}(1+\frac{k}{a}+\frac{3}{2}\frac{h_{%
\text{ffn}}}{h}+\frac{1}{h}))\end{split}
t
(2h^{2}(1+\frac{k}{a}))/t
(3hh_{\text{ffn}})/t
\begin{split}(6+\frac{12}{d})(\frac{2hv}{t}+h+2Lh^{2}(\frac{1+\frac{k}{a}+%
\frac{3}{2}\frac{h_{\text{ffn}}}{h}}{t}+\frac{1}{h}))\end{split}
hv
\frac{L}{p}
\begin{split}(6+\frac{12}{d})(\frac{hv}{t}+2\frac{L}{p}h^{2}(\frac{1+\frac{k}{%
a}+\frac{3}{2}\frac{h_{\text{ffn}}}{h}}{t}+\frac{1}{h}))\end{split}
\begin{split}(6+\frac{12}{d})(2\frac{L}{p}h^{2}(\frac{1+\frac{k}{a}+\frac{3}{2%
}\frac{h_{\text{ffn}}}{h}}{t}+\frac{1}{h}))\end{split}
\begin{split}(6+\frac{12}{d})(\frac{hv}{t}+h+2\frac{L}{p}h^{2}(\frac{1+\frac{k%
}{a}+\frac{3}{2}\frac{h_{\text{ffn}}}{h}}{t}+\frac{1}{h}))\end{split}
d\times c
\begin{split}(6+\frac{12}{dc})(\frac{hv}{t}+2\frac{L}{p}h^{2}(\frac{1+\frac{k}%
{a}+\frac{3}{2}\frac{h_{\text{ffn}}}{h}}{t}+\frac{1}{h}))\end{split}
Q
K
V
(b,s,h)
2sbh
(b,s,h\times\frac{k}{a})
2sbh\times\frac{k}{a}
QK^{\top}
QK^{\top}
V
(b,s,h)
2sbh
X
6sbh+4sbh\times\frac{k}{a}
2sbh
2sbh_{\text{ffn}}
2sbh_{\text{ffn}}
2sbh_{\text{ffn}}
2sbh_{\text{ffn}}
2sb(h+4h_{\text{ffn}})
2sbh
4sbh
\text{Activation memory per layer}=sbh\left(12+4\frac{k}{a}+8\frac{h_{\text{%
ffn}}}{h}\right).
p
8sbhp
4sbv
2sbh
2sbh
4sbh\left(1+\frac{v}{h}\right)
f
\bar{f}
t
\text{Transformer layers = }sbh\left(12+4\frac{k}{a}+8\frac{h_{\text{ffn}}}{h}%
\right)L/t
L
p
L/p
p
p
L/p
L/p\times p=L
p
L
p
\delta_{p,1}
\frac{sbh}{t}\left((12+4\frac{k}{a}+8\frac{h_{\text{ffn}}}{h})L+8p+\delta_{p,1%
}4(1+v/h)\right)
c
\frac{sbh}{tc}\left((12+4\frac{k}{a}+8\frac{h_{\text{ffn}}}{h})L+8p+\delta_{p,%
1}4(1+v/h)\right)
\left(6+\frac{12}{dc}\right)\left(\frac{hv}{t}+2\frac{L}{p}h^{2}\left(\frac{1+%
\frac{k}{a}+\frac{3}{2}\frac{h_{\text{ffn}}}{h}}{t}+\frac{1}{h}\right)\right)%
\\
+\frac{sbh}{tc}\left((12+4\frac{k}{a}+8\frac{h_{\text{ffn}}}{h})L+8p+\delta_{p%
,1}\,4\left(1+\frac{v}{h}\right)\right)
TP\times CP\times PP
\text{(TP, CP, PP)}=(4,1,1)
\text{(TP, CP, PP)}=(2,1,2)
\text{(TP, CP, PP)}=(2,2,1)
\text{(TP, CP, PP, MBS)}=(4,1,1,2)
\text{(TP, CP, PP)}=(2,1,2)
\text{(TP, CP, PP, MBS)}=(2,1,2,1)
\frac{p-1}{m}
m
TP\times CP\times PP
TP\times CP\times PP
\text{(TP, CP, PP, MBS)}=(1,2,1,1)
\text{(TP, CP, PP, MBS)}=(2,1,1,1)
\text{(TP, CP, PP, MBS)}=(1,2,1,1)
\text{(TP, CP, PP, MBS)}=(2,1,1,1)
TP\times CP\times PP
TP\times CP\times PP
