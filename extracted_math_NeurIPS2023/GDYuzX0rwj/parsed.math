\triangleright
\triangleright
{\sim}20
2000
300
1
u(t)
1
y(t)
\Delta
\textbf{(continuous-time)}\ \ \begin{aligned} \bm{s}^{\prime}(t)&=\bm{A}\bm{s}%
(t)+\bm{B}u(t)\\
y(t)&=\bm{C}\bm{s}(t)+\bm{D}u(t)\end{aligned}\ ,\qquad\textbf{(discrete-time)}%
\ \ \begin{aligned} \bm{s}_{k}&=\bm{\overline{A}}\bm{s}_{k-1}+\bm{\overline{B}%
}u_{k}\\
y_{k}&=\bm{\overline{C}}\bm{s}_{k}+\bm{\overline{D}}u_{k}\end{aligned}\ .
\bm{s}(t)
\bm{s}_{k}
\bm{\overline{A}},\bm{\overline{B}},\bm{\overline{C}},\bm{\overline{D}}
\bm{A},\bm{B},\bm{C},\bm{D}
\Delta
\bm{s}_{k}
u_{1:T}
y_{1:T}
\textbf{(parallel)}\ \ \bm{y}_{1:T},\bm{s}_{T}=\text{PSSM}(\bm{u}_{1:T},\bm{s}%
_{0})\ ,\qquad\textbf{(single step)}\ \ \bm{y}_{k},\bm{s}_{k}=\text{PSSM}(\bm{%
u}_{k},\bm{s}_{k-1})\ ,
\bm{u}_{k}
\bm{y}_{k}
\bm{A},\bm{B},\bm{C},\bm{D}
\Delta
\bm{\overline{A}}
\bm{A}
\bm{A}
\bm{A}=\bm{\Lambda}-\bm{P}\bm{P}^{*}
\bm{\Lambda}
\bm{P}
1
\bm{P}^{*}
\bm{P}
\bm{\overline{A}}
\bm{A}
\bm{u}_{k},\bm{y}_{k}\in\mathbbm{R}^{H}
H
\bm{A}
(\mathbf{x}_{0},\bm{a}_{1},\mathbf{x}_{1},\dots,\bm{a}_{T},\mathbf{x}_{T})
t=0,\dots,T
\mathbf{z}_{t}\sim q(\mathbf{z}_{t}\!\mid\!\mathbf{x}_{t})=\text{Encoder}(%
\mathbf{x}_{t})
t=1,\dots,T
\bm{g}_{t}=\text{MLP}(\texttt{concat}[\mathbf{z}_{t-1},\bm{a}_{t}])
\bm{h}_{1:T},\bm{s}_{T}=\text{S4Blocks}(\bm{g}_{1:T},\bm{s}_{0})
t=1,\dots,T
p(\mathbf{z}_{t}\!\mid\!\mathbf{z}_{<t},\bm{a}_{\leq t})=\text{MLP}(\bm{h}_{t})
\hat{\mathbf{x}}_{t}=\text{Decoder}(\texttt{concat}[\bm{h}_{t},\mathbf{z}_{t}])
(\mathbf{x}_{0:C},\bm{a}_{1:C})
\bm{a}_{C+1:T}
t=0,\dots,C
\mathbf{z}_{t}\sim q(\mathbf{z}_{t}\!\mid\!\mathbf{x}_{t})=\text{Encoder}(%
\mathbf{x}_{t})
\bm{g}_{t+1}=\text{MLP}(\texttt{concat}[\mathbf{z}_{t},\bm{a}_{t+1}])
\bm{h}_{1:C+1},\bm{s}_{C+1}=\text{S4Blocks}(\bm{g}_{1:C+1},\bm{s}_{0})
\mathbf{z}_{C+1}\sim p(\mathbf{z}_{C+1}\!\mid\!\mathbf{z}_{0:C},\bm{a}_{1:C+1}%
)=\text{MLP}(\bm{h}_{C+1})
t=C+2,\dots,T
\bm{g}_{t}=\text{MLP}(\texttt{concat}[\mathbf{z}_{t-1},\bm{a}_{t}])
\bm{h}_{t},\bm{s}_{t}=\text{S4Blocks}(\bm{g}_{t},\bm{s}_{t-1})
\mathbf{z}_{t}\sim p(\mathbf{z}_{t}\!\mid\!\mathbf{z}_{<t},\bm{a}_{\leq t})=%
\text{MLP}(\bm{h}_{t})
t=C+1,\dots,T
\hat{\mathbf{x}}_{t}=\text{Decoder}(\texttt{concat}[\bm{h}_{t},\mathbf{z}_{t}])
t
\mathbf{x}_{t}
\bm{a}_{t+1}
\mathbf{x}_{t+1}
p(\mathbf{x}_{1:T}\mid\mathbf{x}_{0},\bm{a}_{1:T})
p(\mathbf{x}_{0})
p(\mathbf{x}_{1:T}\mid\mathbf{x}_{0},\bm{a}_{1:T})=\int p(\mathbf{z}_{0}\mid%
\mathbf{x}_{0})\prod_{t=1}^{T}p(\mathbf{x}_{t}\mid\mathbf{z}_{\leq t},\bm{a}_{%
\leq t})\,p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t})\,\mathrm{d}%
\mathbf{z}_{0:T}\ ,
\mathbf{z}_{0:T}
p(\mathbf{x}_{t}\mid\mathbf{z}_{\leq t},\bm{a}_{\leq t})
p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t})
(\mathbf{z}_{<t},\bm{a}_{\leq t})
(\mathbf{z}_{<t},\bm{a}_{\leq t})
\bm{h}_{t}
t
\displaystyle\textbf{(parallel)}\qquad\qquad\bm{h}_{1:T},\bm{s}_{T}=\text{PSSM%
\_Blocks}(\bm{g}_{1:T},\bm{s}_{0})\ ,
\displaystyle\textbf{(parallel)}\qquad\qquad\bm{h}_{1:T},\bm{s}_{T}
\displaystyle=\text{PSSM\_Blocks}(\bm{g}_{1:T},\bm{s}_{0})\ ,
\displaystyle\textbf{(single step)}\qquad\qquad\bm{h}_{t},\bm{s}_{t}=\text{%
PSSM\_Blocks}(\bm{g}_{t},\bm{s}_{t-1})\ .
\displaystyle\textbf{(single step)}\qquad\qquad\bm{h}_{t},\bm{s}_{t}
\displaystyle=\text{PSSM\_Blocks}(\bm{g}_{t},\bm{s}_{t-1})\ .
\bm{g}_{t}=\text{MLP}(\texttt{concat}[\mathbf{z}_{t-1},\bm{a}_{t}])
\bm{s}_{t}
\bm{h}_{t}
\bm{h}_{t}
\displaystyle p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t})=\text{MLP}(%
\bm{h}_{t})\ ,
\displaystyle p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t})
\displaystyle=\text{MLP}(\bm{h}_{t})\ ,
\displaystyle p(\mathbf{x}_{t}\mid\mathbf{z}_{\leq t},\bm{a}_{\leq t})=%
\mathcal{N}(\hat{\mathbf{x}}_{t},\bm{1})\ ,\quad\hat{\mathbf{x}}_{t}=\text{%
Decoder}(\texttt{concat}[\bm{h}_{t},\mathbf{z}_{t}])\ .
\displaystyle p(\mathbf{x}_{t}\mid\mathbf{z}_{\leq t},\bm{a}_{\leq t})
\displaystyle=\mathcal{N}(\hat{\mathbf{x}}_{t},\bm{1})\ ,\quad\hat{\mathbf{x}}%
_{t}=\text{Decoder}(\texttt{concat}[\bm{h}_{t},\mathbf{z}_{t}])\ .
q(\mathbf{z}_{0:T}\mid\mathbf{x}_{0:T},\bm{a}_{1:T})=\prod_{t=0}^{T}q(\mathbf{%
z}_{t}\mid\mathbf{x}_{t})\ ,\quad\text{where}\ q(\mathbf{z}_{0}\mid\mathbf{x}_%
{0})=p(\mathbf{z}_{0}\mid\mathbf{x}_{0})\ .
\mathbf{z}_{0:T}
\log p(\mathbf{x}_{1:T}\!\mid\!\mathbf{x}_{0},\bm{a}_{1:T})\geq\mathbb{E}_{q}%
\left[\sum_{t=1}^{T}\log p(\mathbf{x}_{t}\!\mid\!\mathbf{z}_{\leq t},\bm{a}_{%
\leq t})-\mathcal{L}_{\mathrm{KL}}\Bigl{(}q(\mathbf{z}_{t}\!\mid\!\mathbf{x}_{%
t}),\ p(\mathbf{z}_{t}\!\mid\!\mathbf{z}_{<t},\bm{a}_{\leq t})\Bigr{)}\right]\ .
{\sim}100
2000
m
m
m
{\sim}10{\times}
m=128
m=128
500
500
301\mid 200
501\mid 500
1101\mid 900
\downarrow
\downarrow
\downarrow
\downarrow
\downarrow
\downarrow
\mathbf{1.7}
62.2
\mathbf{1.5}
219.4
\mathbf{1.5}
323.1
2.5
62.9
2.4
224.4
2.6
360.4
1.8
\mathbf{27.3}
1.7
\mathbf{44.0}
1.8
\mathbf{224.4}
500
50
500
50
{\sim}15
20
20
500
500
50
1101
900
20
20
\text{Width}=100
199\mid 51
\text{Width}=200
399\mid 101
\text{Width}=400
799\mid 201
\uparrow
\uparrow
\uparrow
\uparrow
\uparrow
\uparrow
47.9\%
49.6\%
48.7\%
48.4\%
50.4\%
52.2\%
\mathbf{100.0\%}
51.2\%
99.9\%
51.3\%
50.4\%
51.0\%
\mathbf{100.0\%}
\mathbf{100.0\%}
\mathbf{100.0\%}
\mathbf{100.0\%}
\mathbf{100.0\%}
\mathbf{100.0\%}
100
100
1
76\mid 174
170\mid 380
296\mid 654
\downarrow
\downarrow
\downarrow
\downarrow
\downarrow
\downarrow
0.05
5.16
0.04
6.36
0.03
6.28
0.05
1.27
0.03
6.05
\mathbf{0.02}
9.24
\mathbf{0.01}
\mathbf{0.04}
\mathbf{0.02}
\mathbf{0.27}
\mathbf{0.02}
\mathbf{0.10}
30
28
1
1
10
8
1
1
64{\times}64{\times}3
40{\times}40{\times}3
m
q(\mathbf{z}_{0:T}\mid\mathbf{x}_{0:T},\bm{a}_{1:T})=\prod_{t=0}^{T}q(\mathbf{%
z}_{t}\mid\mathbf{x}_{t})
q(\mathbf{z}_{0:T}\mid\mathbf{x}_{0:T},\bm{a}_{1:T})=\prod_{t=0}^{T}q(\mathbf{%
z}_{t}\mid\mathbf{x}_{\leq t},\bm{a}_{\leq t})\ .
\bm{e}_{t}
\mathbf{x}_{t}
t
q(\mathbf{z}_{t}\!\mid\!\mathbf{x}_{\leq t},\bm{a}_{\leq t})=\text{MLP}(\bm{h}%
_{t})\ ,\quad\bm{h}_{0:T},\bm{s}_{T}=\text{S4Blocks}(\bm{g}_{0:T},\bm{s}_{-1})%
\ ,\quad\bm{g}_{t}=\text{MLP}(\texttt{concat}[\bm{e}_{t},\bm{a}_{t}])\ .
\bm{a}_{0}=\bm{\varnothing}
\bm{s}_{-1}
\bm{\varnothing}
\bm{\varnothing}
501\mid 500
1101\mid 900
\downarrow
\downarrow
\downarrow
\downarrow
\mathbf{1.7}
44.0
\mathbf{1.8}
224.4
\mathbf{1.7}
\mathbf{38.0}
2.0
\mathbf{171.1}
2.3
68.6
2.5
277.0
20
20
20
20
m
m
501\mid 500
1101\mid 900
\downarrow
\downarrow
\downarrow
\downarrow
m=128
\mathbf{2.4}
224.4
2.6
360.4
m=256
\mathbf{2.4}
124.4
\mathbf{2.5}
295.1
m=512
\mathbf{2.4}
\mathbf{38.4}
\mathbf{2.5}
\mathbf{277.6}
m
m
m
m=512
m=128
m=256
m
m=512
m=128
m=256
m=128
m=512
m
20
m
20
m
20
m=256
m=512
m=128
m
20
m=256
m=512
m=128
20
20
9{\times}9
\uparrow
15{\times}15
\uparrow
9{\times}9
\downarrow
15{\times}15
\downarrow
80.8\%
78.3\%
23.9
64.8
95.0\%
81.7\%
5.4
32.6
86.4\%
79.8\%
10.2
35.1
88.4\%
80.2\%
8.9
34.8
\mathbf{98.3\%}
\mathbf{81.8\%}
\mathbf{1.8}
\mathbf{25.3}
\texttt{concat}[\bm{h}_{t},\mathbf{z}_{t}]
\bm{h}_{t}
4
1024
\bm{h}_{t}
\bm{h}_{t}
t
\bm{s}_{t}
\bm{h}_{t}
\bm{s}_{t}
\texttt{concat}[\bm{s}_{t},\mathbf{z}_{t}]
\bm{s}_{t}
64{\times}
\bm{h}_{t}
\bm{s}_{t}
\bm{h}_{t}
\mathbf{z}_{t}
9{\times}9
15{\times}15
2
0\%
60\%
42.86\%
\mathbf{100\%}
40\%
57.14\%
\mathbf{100\%}
\mathbf{100\%}
\mathbf{100\%}
\uparrow
\uparrow
\downarrow
12.6
0.372
0.465
111
17.8
0.588
0.222
31
20.6
0.667
0.196
41
\mathbf{21.9}
\mathbf{0.703}
\mathbf{0.157}
169
301\mid 200
501\mid 500
1101\mid 900
\downarrow
\downarrow
\downarrow
\downarrow
\downarrow
\downarrow
1.8
27.3
1.7
44.0
1.8
224.4
\mathbf{1.5}
\mathbf{10.6}
\mathbf{1.3}
\mathbf{19.2}
\mathbf{1.3}
\mathbf{159.2}
(\mathbf{x}_{0},\bm{a}_{1},\mathbf{x}_{1},\bm{a}_{2},\mathbf{x}_{2},\dots,\bm{%
a}_{T},\mathbf{x}_{T})
\bm{a}_{t+1}
\mathbf{x}_{t}
\mathbf{x}_{t+1}
p(\mathbf{x}_{0:T}\mid\bm{a}_{1:T})=\int\prod_{t=0}^{T}p(\mathbf{x}_{t}\mid%
\mathbf{z}_{\leq t},\bm{a}_{\leq t})\,p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{%
a}_{\leq t})\,\mathrm{d}\mathbf{z}_{0:T}\ ,
\mathbf{z}_{0:T}
q(\mathbf{z}_{0:T}\mid\mathbf{x}_{0:T},\bm{a}_{1:T})=\prod_{t=0}^{T}q(\mathbf{%
z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t},\mathbf{x}_{t})\ .
\mathbf{z}_{<t}
\bm{a}_{\leq t}
\mathbf{z}_{<t}
\bm{a}_{\leq t}
\bm{h}_{t}
\bm{h}_{t}=\text{GRU}(\bm{h}_{t-1},\text{MLP}(\texttt{concat}[\mathbf{z}_{t-1}%
,\bm{a}_{t}]))\ .
\displaystyle p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t})=\text{MLP}(%
\bm{h}_{t})\ ,
\displaystyle p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t})
\displaystyle=\text{MLP}(\bm{h}_{t})\ ,
\displaystyle p(\mathbf{x}_{t}\mid\mathbf{z}_{\leq t},\bm{a}_{\leq t})=%
\mathcal{N}(\hat{\mathbf{x}}_{t},\bm{1})\ ,\quad\hat{\mathbf{x}}_{t}=\text{%
Decoder}(\texttt{concat}[\bm{h}_{t},\mathbf{z}_{t}])\ ,
\displaystyle p(\mathbf{x}_{t}\mid\mathbf{z}_{\leq t},\bm{a}_{\leq t})
\displaystyle=\mathcal{N}(\hat{\mathbf{x}}_{t},\bm{1})\ ,\quad\hat{\mathbf{x}}%
_{t}=\text{Decoder}(\texttt{concat}[\bm{h}_{t},\mathbf{z}_{t}])\ ,
\displaystyle q(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t},\mathbf{x}_{%
t})=\text{MLP}(\texttt{concat}[\bm{h}_{t},\bm{e}_{t}])\ ,\quad\bm{e}_{t}=\text%
{Encoder}(\mathbf{x}_{t})\ .
\displaystyle q(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t},\mathbf{x}_{%
t})
\displaystyle=\text{MLP}(\texttt{concat}[\bm{h}_{t},\bm{e}_{t}])\ ,\quad\bm{e}%
_{t}=\text{Encoder}(\mathbf{x}_{t})\ .
\log p(\mathbf{x}_{0:T}\!\mid\!\bm{a}_{1:T})\geq\mathbb{E}_{q}\left[\sum_{t=0}%
^{T}\log p(\mathbf{x}_{t}\!\mid\!\mathbf{z}_{\leq t},\bm{a}_{\leq t})-\mathcal%
{L}_{\mathrm{KL}}\Bigl{(}q(\mathbf{z}_{t}\!\mid\!\mathbf{z}_{<t},\bm{a}_{\leq t%
},\mathbf{x}_{t}),\ p(\mathbf{z}_{t}\!\mid\!\mathbf{z}_{<t},\bm{a}_{\leq t})%
\Bigr{)}\right]\ .
p(\mathbf{x}_{1:T}\mid\mathbf{x}_{0},\bm{a}_{1:T})=\int p(\mathbf{z}_{0}\mid%
\mathbf{x}_{0})\prod_{t=1}^{T}p(\mathbf{x}_{t}\mid\mathbf{z}_{\leq t},\bm{a}_{%
\leq t})\,p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t})\,\mathrm{d}%
\mathbf{z}_{0:T}\ ,
\mathbf{z}_{0:T}
q(\mathbf{z}_{0:T}\mid\mathbf{x}_{0:T},\bm{a}_{1:T})=\prod_{t=0}^{T}q(\mathbf{%
z}_{t}\mid\mathbf{x}_{t})\ ,\quad\text{where}\ q(\mathbf{z}_{0}\mid\mathbf{x}_%
{0})=p(\mathbf{z}_{0}\mid\mathbf{x}_{0})\ .
\log p(\mathbf{x}_{1:T}\!\mid\!\mathbf{x}_{0},\bm{a}_{1:T})\geq\mathbb{E}_{q}%
\left[\sum_{t=1}^{T}\log p(\mathbf{x}_{t}\!\mid\!\mathbf{z}_{\leq t},\bm{a}_{%
\leq t})-\mathcal{L}_{\mathrm{KL}}\Bigl{(}q(\mathbf{z}_{t}\!\mid\!\mathbf{x}_{%
t}),\ p(\mathbf{z}_{t}\!\mid\!\mathbf{z}_{<t},\bm{a}_{\leq t})\Bigr{)}\right]\ .
p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t})
\bm{h}_{t}
\bm{h}_{t}=\text{TransformerBlocks}(\bm{g}_{1:t})\ ,\quad\bm{g}_{t}=\text{MLP}%
(\texttt{concat}[\mathbf{z}_{t-1},\bm{a}_{t}])\ .
\bm{h}_{t}
\mathbf{z}_{t}
\hat{\mathbf{x}}_{t}
p(\mathbf{z}_{t}\mid\mathbf{z}_{<t},\bm{a}_{\leq t})=\text{MLP}(\bm{h}_{t})\ ,%
\quad\hat{\mathbf{x}}_{t}=\text{Decoder}(\texttt{concat}[\bm{h}_{t},\mathbf{z}%
_{t}])\ .
8
1000
64{\times}64
100
64
500
500
64{\times}64
8
1000
4
2
\mathbf{z}_{0:T}
1\%
99\%
\mathcal{L}_{\mathrm{KL}}(q,p)
q
p
\mathcal{L}_{\mathrm{KL}}(q,p)=\alpha\!\cdot\!\mathrm{KL}[\texttt{stop\_grad}(%
q)\parallel p]+(1-\alpha)\!\cdot\!\mathrm{KL}[q\parallel\texttt{stop\_grad}(p)%
]\ .
\alpha=0.8
8
8
32
57
57
57
1\times 10^{-3}
1\times 10^{-4}
3\times 10^{-4}
1\times 10^{-2}
1\times 10^{-2}
1\times 10^{-2}
1000
1000
200
48
32\times 32
32\times 32
32\times 32
6
12
1
d_{\text{model}}
512
512
2048
d_{\text{ff}}
2048
512
m
128
256
512
4
4
4
48
48
48
1000
1000
1000
41.1
43.8
54.1
\alpha
0.8
0.8
0.8
8
8
32
100
100
100
1\times 10^{-3}
1\times 10^{-4}
3\times 10^{-4}
1\times 10^{-2}
1\times 10^{-2}
1\times 10^{-2}
1000
1000
200
50
32\times 32
32\times 32
32\times 32
6
10
1
d_{\text{model}}
512
512
2048
d_{\text{ff}}
2048
512
m
128
3
3
3
32
32
32
512
512
512
28.1
27.1
31.2
\alpha
0.8
0.8
0.8
