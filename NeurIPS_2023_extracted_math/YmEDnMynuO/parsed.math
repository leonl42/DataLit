('3', '\\mathcal{L}_{exp}')
('3', '\\mathcal{L}_{imp}')
('3', '\\mathcal{L}_{exp}')
('3', '\\mathcal{L}_{imp}')
('3', '\\mathcal{L}_{exp}')
('3', '\\mathcal{L}_{imp}')
('3', '\\mathcal{L}_{exp}')
('3', '\\mathcal{L}_{imp}')
('3.1', '\\mathcal{G}')
('3.1', '\\mathcal{G}=(\\mathcal{E},\\mathcal{R},\\mathcal{T},\\mathcal{D})')
('3.1', '\\mathcal{E}')
('3.1', '\\mathcal{R}')
('3.1', '\\mathcal{D}')
('3.1', '\\mathcal{D}_{e}')
('3.1', '\\mathcal{D}_{r}')
('3.1', 'e')
('3.1', 'r')
('3.1', '\\mathcal{T}=\\{(h,r,t)|h,t\\in\\mathcal{E},r\\in\\mathcal{R}\\}')
('3.1', '(h,r,t)')
('3.1', 'r')
('3.1', 'h')
('3.1', 't')
('3.2', 'E_{LLM}')
('3.2', '\\{(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\}_{i=1}^{N}')
('3.2', '\\mathcal{D}_{t}')
('3.2', '\\mathcal{D}_{hr}')
('3.2', '(\\mathcal{D}_{hr},\\mathcal{D}_{t})')
('3.2', 'E_{LLM}')
('3.2', '\\mathcal{D}_{hr}')
('3.2', '\\mathcal{D}_{t}')
('3.2', 'E_{LLM}')
('3.2', '\\displaystyle e_{hr}=E_{LLM}(\\texttt{[bos]}_{hr}\\oplus\\mathcal{D}_{hr}\\oplus%\n\\texttt{[eos]}_{hr}),')
('3.2', '\\displaystyle e_{hr}=E_{LLM}(\\texttt{[bos]}_{hr}\\oplus\\mathcal{D}_{hr}\\oplus%\n\\texttt{[eos]}_{hr}),')
('3.2', '\\displaystyle e_{t}=E_{LLM}(\\texttt{[bos]}_{t}\\oplus\\mathcal{D}_{t}\\oplus%\n\\texttt{[eos]}_{t}),')
('3.2', '\\displaystyle e_{t}=E_{LLM}(\\texttt{[bos]}_{t}\\oplus\\mathcal{D}_{t}\\oplus%\n\\texttt{[eos]}_{t}),')
('3.2', '\\oplus')
('3.2', '\\mathcal{D}_{hr}=\\mathcal{D}_{h}\\oplus\\mathcal{D}_{r}')
('3.2', '\\texttt{[bos]}_{hr}')
('3.2', '\\texttt{[eos]}_{hr}')
('3.2', '\\texttt{[bos]}_{t}')
('3.2', '\\texttt{[eos]}_{t}')
('3.2', '\\ell_{r}')
('3.2', '\\ell_{c}')
('3.2', '\\displaystyle\\ell_{r}=-\\log\\frac{e^{(\\phi(e_{hr},e_{t})-\\gamma)/\\tau}}{e^{(%\n\\phi(e_{hr},e_{t})-\\gamma)/\\tau}+\\sum\\nolimits_{i=1}^{\\mathcal{N}}e^{\\phi(e_{%\nhr},e_{t_{i}^{\\prime}})/\\tau}},')
('3.2', '\\displaystyle\\ell_{r}=-\\log\\frac{e^{(\\phi(e_{hr},e_{t})-\\gamma)/\\tau}}{e^{(%\n\\phi(e_{hr},e_{t})-\\gamma)/\\tau}+\\sum\\nolimits_{i=1}^{\\mathcal{N}}e^{\\phi(e_{%\nhr},e_{t_{i}^{\\prime}})/\\tau}},')
('3.2', '\\mathcal{N}')
('3.2', '\\tau')
('3.2', '\\phi')
('3.2', '\\gamma')
('3.2', '\\ell_{r}')
('3.2', '\\ell_{c}')
('3.2', '\\mathcal{L}_{exp}=\\frac{1}{\\mathcal{N}}\\underset{(\\mathcal{D}_{hr},\\mathcal{D}%\n_{t})}{\\sum}(\\ell_{r}+\\ell_{c})/2.')
('3.3', '\\mathcal{D}_{hr}')
('3.3', '\\mathcal{D}_{t}')
('3.3', '\\mathcal{L}_{imp}=\\frac{1}{\\mathcal{M}}\\underset{(\\mathcal{D}_{hr},\\mathcal{D}%\n_{t})}{\\sum}-\\log P(\\mathcal{D}_{t}|\\texttt{inst},\\mathcal{D}_{hr}),')
('3.3', '\\mathcal{M}')
('3.4', '\\mathcal{L}_{exp}')
('3.4', '\\mathcal{L}_{imp}')
('3.4', '\\mathcal{L}_{KaLM}=\\mathcal{L}_{exp}+\\lambda\\cdot\\mathcal{L}_{imp},')
('3.4', '\\lambda')
('3.4', '\\mathcal{N}')
('3.4', '\\mathcal{M}')
('4.1', 'f')
('4.1', 'E_{LLM}')
('4.1', '\\ell_{\\texttt{align}}(f;\\alpha)\\triangleq\\underset{(\\mathcal{D}_{hr},\\mathcal{%\nD}_{t})\\sim p_{\\texttt{pos}}}{\\mathbb{E}}\\left[\\|f(\\mathcal{D}_{hr})-f(%\n\\mathcal{D}_{t})\\|_{2}^{\\alpha}\\right],')
('4.1', '\\ell_{\\texttt{uniform}}(f;t)\\triangleq\\log\\underset{\\mathcal{D}_{i},\\mathcal{D%\n}_{j}\\stackrel{{\\scriptstyle i.i.d.}}{{\\sim}}p_{\\texttt{data}}}{\\mathbb{E}}%\n\\left[e^{-t\\|f(\\mathcal{D}_{i})-f(\\mathcal{D}_{j})\\|_{2}^{2}}\\right],')
('4.1', 'p_{\\texttt{pos}}')
('4.1', '\\{(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\}_{i=1}^{N}')
('4.1', 'p_{\\texttt{data}}')
('4.1', '\\{\\mathcal{D}_{i}\\}_{i=1}^{N}')
('4.1', '\\phi(e_{hr},e_{t})=f(x)^{\\top}f(y)')
('4.1', '\\gamma')
('4.1', '\\begin{split}&\\mathcal{L}_{\\texttt{exp}}(f;\\tau,\\mathcal{N})\\triangleq%\n\\underset{\\begin{subarray}{c}(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{\\texttt%\n{pos}}\\\\\n{\\{\\mathcal{D}_{t}{{}_{i}^{\\prime}}\\}_{i=1}^{\\mathcal{N}}}\\stackrel{{%\n\\scriptstyle i.i.d.}}{{\\sim}}p_{\\texttt{data}}\\end{subarray}}{\\mathbb{E}}\\\\\n&\\left[-\\log\\frac{e^{f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau}}{e^{f(%\n\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau}+\\sum\\limits_{i=1}^{\\mathcal{N%\n}}e^{f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t}{{}_{i}^{\\prime}})/\\tau}}%\n\\right],\\end{split}')
('4.1', '\\mathcal{L}_{\\texttt{exp}}')
('4.1', '\\tau>0')
('4.1', '\\mathcal{N}\\rightarrow\\infty')
('4.1', '\\begin{split}&\\lim_{\\mathcal{N}\\rightarrow\\infty}\\mathcal{L}_{\\texttt{exp}}(f;%\n\\tau,\\mathcal{N})-\\log\\mathcal{N}=\\\\\n&\\qquad-\\frac{1}{\\tau}\\underset{(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{%\n\\texttt{pos}}}{\\mathbb{E}}\\left[f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})%\n\\right]\\\\\n&\\qquad+\\underset{\\mathcal{D}_{i}\\sim p_{data}}{\\mathbb{E}}\\left[\\log\\underset%\n{\\mathcal{D}_{i}^{-}\\sim p_{\\texttt{data}}}{\\mathbb{E}}\\left[e^{f(\\mathcal{D}_%\n{i}^{-})^{\\top}f(\\mathcal{D}_{i})/\\tau}\\right]\\right].\\end{split}')
('4.1', 'E_{LLM}')
('4.1', 'E_{LLM}')
('4.2', '\\mathbf{E}')
('4.2', '\\{\\mathcal{D}_{i}\\}_{i=1}^{N}')
('4.2', 'i')
('4.2', '\\mathbf{E}')
('4.2', 'e_{i}')
('4.2', '\\{\\mathcal{D}_{i}\\}_{i=1}^{N}')
('4.2', '\\texttt{anisotropy}_{\\{\\mathcal{D}\\}}=\\frac{1}{N(N-1)}\\sum_{i=1}^{N}\\sum_{j=1,%\nj\\neq i}^{N}e_{i}^{\\top}e_{j}.')
('4.2', 'p_{data}')
('4.2', '\\{\\mathcal{D}_{i}\\}_{i=1}^{N}')
('4.2', '\\{\\mathcal{D}_{i}\\}_{i=1}^{N}')
('4.2', '\\begin{split}&\\underset{\\mathcal{D}_{i}\\sim p_{data}}{\\mathbb{E}}\\left[\\log%\n\\underset{\\mathcal{D}_{i}^{-}\\sim p_{data}}{\\mathbb{E}}\\left[e^{f(\\mathcal{D}_%\n{i}^{-})^{\\top}f(\\mathcal{D}_{i})/\\tau}\\right]\\right]\\\\\n&\\quad\\geq\\frac{N-1}{\\tau N}\\cdot\\texttt{anisotropy}_{\\{\\mathcal{D}\\}}+\\frac{1%\n}{\\tau N}.\\end{split}')
('4.2', '\\{\\mathcal{D}_{i}\\}_{i=1}^{N}')
('5.1', '(t,r^{-1},h)')
('5.1', '(h,r,t)')
('5.1', 'r^{-1}')
('5.1', 'r')
('5.1', 'k')
('5.1', 'k\\in\\{1,3,10\\}')
('5.1', '\\uparrow')
('5.1', '\\downarrow')
('5.1', '\\uparrow')
('5.1', '\\downarrow')
('5.1', '(i,j)')
('5.1', 'i')
('5.1', 'j')
('5.1', '(i,j)')
('5.1', 'i')
('5.1', 'j')
('5.1', '\\usym{1F5F9}')
('5.1', '\\usym{1F5F5}')
('5.1', '\\usym{1F5F9}')
('5.1', '\\usym{1F5F5}')
('A2.1', '\\begin{split}&\\mathcal{L}_{\\texttt{exp}}(f;\\tau,\\mathcal{N})\\triangleq%\n\\underset{\\begin{subarray}{c}(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{\\texttt%\n{pos}}\\\\\n{\\{\\mathcal{D}_{t}{{}_{i}^{\\prime}}\\}_{i=1}^{\\mathcal{N}}}\\stackrel{{%\n\\scriptstyle i.i.d.}}{{\\sim}}p_{\\texttt{data}}\\end{subarray}}{\\mathbb{E}}\\\\\n&\\left[-\\log\\frac{e^{f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau}}{e^{f(%\n\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau}+\\sum\\limits_{i=1}^{\\mathcal{N%\n}}e^{f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t}{{}_{i}^{\\prime}})/\\tau}}%\n\\right].\\end{split}')
('A2.1', 'p')
('A2.1', '\\begin{split}&\\mathcal{L}_{\\texttt{exp}}(f;\\tau,\\mathcal{N})=\\\\\n&\\underset{(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{\\texttt{pos}}}{\\mathbb{E}%\n}\\left[-f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau\\right]+\\underset{%\n\\begin{subarray}{c}(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{\\texttt{pos}}\\\\\n{\\{\\mathcal{D}_{t}{{}_{i}^{\\prime}}\\}_{i=1}^{\\mathcal{N}}}\\stackrel{{%\n\\scriptstyle i.i.d.}}{{\\sim}}p_{\\texttt{data}}\\end{subarray}}{\\mathbb{E}}\\\\\n&\\left[\\log\\left(e^{f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau}+\\sum%\n\\limits_{i=1}^{\\mathcal{N}}e^{f(\\mathcal{D}_{t}{{}_{i}^{\\prime}})^{\\top}f(%\n\\mathcal{D}_{t})/\\tau}\\right)\\right].\\end{split}')
('A2.1', '\\begin{split}&\\lim_{\\mathcal{N}\\rightarrow\\infty}\\log\\left(\\frac{e^{f(\\mathcal%\n{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau}}{\\mathcal{N}}+\\frac{\\sum\\limits_{i=1}%\n^{\\mathcal{N}}e^{f(\\mathcal{D}_{t}{{}_{i}^{\\prime}})^{\\top}f(\\mathcal{D}_{t})/%\n\\tau}}{\\mathcal{N}}\\right)\\\\\n&=\\log\\underset{\\mathcal{D}_{i}^{-}\\sim p_{\\texttt{data}}}{\\mathbb{E}}f(%\n\\mathcal{D}_{i}^{-})^{\\top}f(\\mathcal{D}_{i})/\\tau.\\end{split}')
('A2.1', '\\begin{split}&\\lim_{\\mathcal{N}\\rightarrow\\infty}\\mathcal{L}_{\\texttt{exp}}(f;%\n\\tau,\\mathcal{N})-\\log\\mathcal{N}\\\\\n&=\\underset{(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{\\texttt{pos}}}{\\mathbb{E%\n}}\\left[-f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau\\right]\\\\\n&\\quad+\\lim_{\\mathcal{N}\\rightarrow\\infty}\\underset{\\begin{subarray}{c}(%\n\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{\\texttt{pos}}\\\\\n{\\{\\mathcal{D}_{t}{{}_{i}^{\\prime}}\\}_{i=1}^{\\mathcal{N}}}\\stackrel{{%\n\\scriptstyle i.i.d.}}{{\\sim}}p_{\\texttt{data}}\\end{subarray}}{\\mathbb{E}}\\\\\n&\\quad\\left[\\log\\left(\\frac{e^{f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/%\n\\tau}}{\\mathcal{N}}+\\frac{\\sum\\limits_{i=1}^{\\mathcal{N}}e^{f(\\mathcal{D}_{t}{%\n{}_{i}^{\\prime}})^{\\top}f(\\mathcal{D}_{t})/\\tau}}{\\mathcal{N}}\\right)\\right]\\\\\n&=\\underset{(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{\\texttt{pos}}}{\\mathbb{E%\n}}\\left[-f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau\\right]\\end{split}')
('A2.1', '\\begin{split}&\\quad+\\mathbb{E}\\left[\\lim_{\\mathcal{N}\\rightarrow\\infty}\\log%\n\\left(\\frac{e^{f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})/\\tau}}{\\mathcal{N}%\n}+\\frac{\\sum\\limits_{i=1}^{\\mathcal{N}}e^{f(\\mathcal{D}_{t}{{}_{i}^{\\prime}})^%\n{\\top}f(\\mathcal{D}_{t})/\\tau}}{\\mathcal{N}}\\right)\\right]\\\\\n&=-\\frac{1}{\\tau}\\underset{(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{\\texttt{%\npos}}}{\\mathbb{E}}\\left[f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})\\right]\\\\\n&\\quad+\\underset{\\mathcal{D}_{i}\\sim p_{data}}{\\mathbb{E}}\\left[\\log\\underset{%\n\\mathcal{D}_{i}^{-}\\sim p_{\\texttt{data}}}{\\mathbb{E}}\\left[e^{f(\\mathcal{D}_{%\ni}^{-})^{\\top}f(\\mathcal{D}_{i})/\\tau}\\right]\\right].\\end{split}')
('A2.1', '\\begin{split}&\\lim_{\\mathcal{N}\\rightarrow\\infty}\\mathcal{L}_{\\texttt{exp}}(f;%\n\\tau,\\mathcal{N})-\\log\\mathcal{N}=\\\\\n&\\quad-\\frac{1}{\\tau}\\underset{(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{%\n\\texttt{pos}}}{\\mathbb{E}}\\left[f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})%\n\\right]\\\\\n&\\quad+\\underset{\\mathcal{D}_{i}\\sim p_{data}}{\\mathbb{E}}\\left[\\log\\underset{%\n\\mathcal{D}_{i}^{-}\\sim p_{\\texttt{data}}}{\\mathbb{E}}\\left[e^{f(\\mathcal{D}_{%\ni}^{-})^{\\top}f(\\mathcal{D}_{i})/\\tau}\\right]\\right].\\end{split}')
('A2.2', '\\begin{split}&\\lim_{\\mathcal{N}\\rightarrow\\infty}\\mathcal{L}_{\\texttt{exp}}(f;%\n\\tau,\\mathcal{N})-\\log\\mathcal{N}=\\\\\n&\\qquad-\\frac{1}{\\tau}\\underset{(\\mathcal{D}_{hr},\\mathcal{D}_{t})\\sim p_{%\n\\texttt{pos}}}{\\mathbb{E}}\\left[f(\\mathcal{D}_{hr})^{\\top}f(\\mathcal{D}_{t})%\n\\right]\\\\\n&\\qquad+\\underset{\\mathcal{D}_{i}\\sim p_{data}}{\\mathbb{E}}\\left[\\log\\underset%\n{\\mathcal{D}_{i}^{-}\\sim p_{\\texttt{data}}}{\\mathbb{E}}\\left[e^{f(\\mathcal{D}_%\n{i}^{-})^{\\top}f(\\mathcal{D}_{i})/\\tau}\\right]\\right].\\end{split}')
('A2.2', '\\{\\mathcal{D}_{i}\\}_{i=1}^{N}')
('A2.2', '\\texttt{anisotropy}_{\\{\\mathcal{D}\\}}=\\frac{1}{N(N-1)}\\sum_{i=1}^{N}\\sum_{j=1,%\nj\\neq i}^{N}e_{i}^{\\top}e_{j}.')
('A2.2', 'p_{\\texttt{data}}')
('A2.2', '\\{\\mathcal{D}_{i}\\}_{i=1}^{N}')
('A2.2', '\\begin{split}&\\underset{\\mathcal{D}_{i}\\sim p_{data}}{\\mathbb{E}}\\left[\\log%\n\\underset{\\mathcal{D}_{i}^{-}\\sim p_{data}}{\\mathbb{E}}\\left[e^{f(\\mathcal{D}_%\n{i}^{-})^{\\top}f(\\mathcal{D}_{i})/\\tau}\\right]\\right]\\\\\n&=\\frac{1}{N}\\sum_{i=1}^{N}\\log\\left(\\frac{1}{N}\\sum_{j=1}^{N}e^{e_{i}^{\\top}e%\n_{j}/\\tau}\\right)\\\\\n&\\geq\\frac{1}{\\tau N^{2}}\\sum_{i=1}^{N}\\sum_{j=1}^{N}e_{i}^{\\top}e_{j}\\\\\n&=\\frac{1}{\\tau N^{2}}\\left(\\sum_{i=1}^{N}\\sum_{j=1,j\\neq i}^{N}e_{i}^{\\top}e_%\n{j}+N\\right)\\\\\n&=\\frac{N-1}{\\tau N}\\cdot\\frac{1}{N(N-1)}\\sum_{i=1}^{N}\\sum_{j=1,j\\neq i}^{N}e%\n_{i}^{\\top}e_{j}+\\frac{1}{\\tau N}\\\\\n&=\\frac{N-1}{\\tau N}\\cdot\\texttt{anisotropy}_{\\{\\mathcal{D}\\}}+\\frac{1}{\\tau N%\n}.\\end{split}')
('A2.2', '\\begin{split}&\\underset{\\mathcal{D}_{i}\\sim p_{data}}{\\mathbb{E}}\\left[\\log%\n\\underset{\\mathcal{D}_{i}^{-}\\sim p_{data}}{\\mathbb{E}}\\left[e^{f(\\mathcal{D}_%\n{i}^{-})^{\\top}f(\\mathcal{D}_{i})/\\tau}\\right]\\right]\\\\\n&\\quad\\geq\\frac{N-1}{\\tau N}\\cdot\\texttt{anisotropy}_{\\{\\mathcal{D}\\}}+\\frac{1%\n}{\\tau N}.\\end{split}')
('A3.1', '40,943')
('A3.1', '11')
('A3.1', '86,835')
('A3.1', '3,034')
('A3.1', '3,134')
('A3.1', '14,541')
('A3.1', '237')
('A3.1', '272,115')
('A3.1', '17,535')
('A3.1', '20,466')
('A3.2', 'gate\\_proj')
('A3.2', 'up\\_proj')
('A3.2', 'down\\_proj')
('A3.2', '\\times')
('A3.2', 'dense\\_h\\_to\\_4h')
('A3.2', 'dense\\_4h\\_to\\_h')
('A3.2', 'fc1')
('A3.2', 'fc2')
('A3.2', '\\displaystyle\\ell_{c}=-\\log\\frac{e^{(\\phi(e_{t},e_{hr})-\\gamma)/\\tau}}{e^{(%\n\\phi(e_{t},e_{hr})-\\gamma)/\\tau}+\\sum\\nolimits_{j=1}^{\\mathcal{N}}e^{\\phi(e_{t%\n},e_{{hr}_{j}^{\\prime}})/\\tau}}.')
('A3.2', '\\displaystyle\\ell_{c}=-\\log\\frac{e^{(\\phi(e_{t},e_{hr})-\\gamma)/\\tau}}{e^{(%\n\\phi(e_{t},e_{hr})-\\gamma)/\\tau}+\\sum\\nolimits_{j=1}^{\\mathcal{N}}e^{\\phi(e_{t%\n},e_{{hr}_{j}^{\\prime}})/\\tau}}.')
('A3.3', 'k')
('A3.3', 'k\\in\\{1,3,10\\}')
('A3.3', 'k')
('A3.3', 'k')
('A4.2', '\\uparrow')
('A4.2', '\\downarrow')
('A4.2', '\\uparrow')
('A4.2', '\\downarrow')
('A4.4', '\\{\\mathcal{D}_{i}\\}_{i=1}^{N}')
('A4.4', '\\times')
('A5.1', '\\lambda')
('A5.1', '\\lambda>0')
('A5.1', '\\lambda=0.1')
('A5.1', '\\lambda=0,0.01,0.1,1.0')
('A5.1', '\\lambda')
('A5.1', '\\lambda')
('A5.1', '\\lambda=0')
('A5.1', '\\lambda=0.01')
('A5.1', '\\lambda=0.1')
('A5.1', '\\lambda=1.0')
