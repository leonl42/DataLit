('1', 'k')
('1', 'k')
('1', 'k')
('3.0', 'k = \\lceil n/r \\rceil')
('3.0', 'r > 1')
('3.0', 'F()')
('3.0', 'F_\\textrm{att}()')
('3.0', 'F_\\textrm{ffn}()')
('3.0', 'LN_\\textrm{att}()')
('3.0', 'LN_\\textrm{ffn}()')
('3.0', '{\\bm{X}}\\in {\\mathbb{R}}^{n\\times d}')
('3.0', 'n')
('3.0', 'd')
('3.0', '{\\bm{X}}')
('3.0', '{\\bm{X}}_\\textrm{norm} = LN_\\textrm{att}({\\bm{X}})')
('3.0.0', 'F_\\textrm{adapter}()')
('3.0.0', '\\begin{aligned}\n    {\\bm{Z}}_\\textrm{adapter} = F_\\textrm{adapter}({\\bm{X}}_\\textrm{norm})\n    %= F_\\textrm{adapter}(F_\\textrm{norm}(\\mX^i))\n\\end{aligned}')
('3.0.0', 'F_\\textrm{adapter}()')
('3.0.0', '{\\bm{Z}}_\\textrm{adapter}')
('3.0.0', 'F_\\textrm{adapter}()')
('3.0.0', '{\\bm{X}}\\in {\\mathbb{R}}^{n\\times d}')
('3.0.0.0', 'F_\\textrm{router}()')
('3.0.0.0', 'k')
('3.0.0.0', '\\begin{aligned}\n    {\\bm{m}}, {\\bm{P}}= F_\\textrm{router}({\\bm{X}}_\\textrm{norm})\n    \\label{eq:router_outputs}\n\\end{aligned}')
('3.0.0.0', '{\\bm{P}}\\in \\{0, 1\\}^{k\\times n}')
('3.0.0.0', 'k')
('3.0.0.0', '{\\bm{P}}[i, j]=1')
('3.0.0.0', 'i')
('3.0.0.0', 'j')
('3.0.0.0', '\\tilde{{\\bm{X}}}')
('3.0.0.0', '{\\bm{m}}\\in [0, 1]^n')
('3.0.0.0', '{\\bm{m}}[j]')
('3.0.0.0', 'j')
('3.0.0.0', '{\\bm{m}}[j]=0')
('3.0.0.0', '\\begin{aligned}\n{\\bm{X}}_\\textrm{routed} &= {\\bm{P}}{\\bm{X}}_\\textrm{norm} \\ \\ \\ \\ \\in {\\mathbb{R}}^{k\\times d}\n\\end{aligned}')
('3.0.0.0', 'k')
('3.0.0.0', '{\\bm{X}}_\\textrm{norm}')
('3.0.0.0', 'k')
('3.0.0.0', 'd')
('3.0.0.0', '{\\bm{X}}_\\textrm{routed}')
('3.0.0.0', '\\begin{aligned}\n    \\bar{{\\bm{Z}}}_\\textrm{routed} &= F_\\textrm{att}({\\bm{X}}_\\textrm{routed}) \\\\\n    {\\bm{Z}}_\\textrm{routed} &= F_\\textrm{ffn}(LN_\\textrm{ffn}({\\bm{X}}_\\textrm{routed} + \\bar{{\\bm{Z}}}_\\textrm{routed}))\n\\end{aligned}')
('3.0.0.0', '\\bar{{\\bm{Z}}}_\\textrm{routed},{\\bm{Z}}_\\textrm{routed}\\in {\\mathbb{R}}^{k\\times d}')
('3.0.0.0', 'k')
('3.0.0.0', 'k')
('3.0.0.0', '{\\bm{X}}_\\textrm{routed}')
('3.0.0.0', 'k')
('3.0.0.0', '{\\bm{X}}_\\textrm{norm}')
('3.0.0.0', 'k')
('3.0.0.0', '\\bar{{\\bm{Z}}}_\\textrm{routed}')
('3.0.0.0', '{\\bm{Z}}_\\textrm{routed}')
('3.0.0.0', '\\begin{aligned}\n    {\\bm{Z}}_\\textrm{cond} &= {\\bm{P}}^\\top (\\bar{{\\bm{Z}}}_\\textrm{routed} + {\\bm{Z}}_\\textrm{routed}) \\ \\ \\ \\ \\in {\\mathbb{R}}^{n\\times d}\n\\end{aligned}')
('3.0.0.0', '{\\bm{Z}}_\\textrm{cond}')
('3.0.0.0', '\\begin{aligned}\n    {\\bm{Y}}&= {\\bm{X}}+ {\\bm{Z}}_\\textrm{adapter} + {\\bm{m}}\\odot {\\bm{Z}}_\\textrm{cond}\n\\end{aligned}')
('3.0.0.0', '{\\bm{m}}\\odot {\\bm{Z}}_\\textrm{cond}')
('3.0.0.0', '{\\bm{Z}}_\\textrm{cond}')
('3.0.0.0', '{\\bm{m}}')
('3.0.0.0', '{\\bm{Z}}_\\textrm{cond}[i]')
('3.0.0.0', 'i')
('3.0.0.0', '{\\bm{m}}[i]')
('3.0.0.0', '{\\bm{m}}')
('3.0.0.1', 'F_\\textrm{router}()')
('3.0.0.1', '{\\bm{X}}_\\textrm{norm}')
('3.0.0.1', '{\\bm{s}}= {\\bm{w}}\\,{\\bm{X}}_\\textrm{norm}^\\top')
('3.0.0.1', '{\\bm{w}}\\in {\\mathbb{R}}^d')
('3.0.0.1', '{\\bm{s}}')
('3.0.0.1', 'f(): {\\mathbb{R}}^n \\rightarrow [0, 1]^n')
('3.0.0.1', '{\\bm{m}}')
('3.0.0.1', '\\begin{aligned}\n    \\bm{\\lambda} &= f({\\bm{s}}) \\\\\n    {\\bm{m}}&= \\bm{\\lambda} \\odot \\textrm{Top}(\\bm{\\lambda}, k) \\ \\ \\ \\ \\in {\\mathbb{R}}^n\n\\end{aligned}')
('3.0.0.1', '\\textrm{Top}(\\bm{\\lambda}, k) \\in \\{0, 1\\}^n')
('3.0.0.1', 'k')
('3.0.0.1', '\\bm{\\lambda}')
('3.0.0.1', '{\\bm{P}}')
('3.0.0.1', '\\textrm{Top}(\\bm{\\lambda}, k)')
('3.0.0.1', '\\bm{\\lambda}')
('3.0.0.1', 'f()')
('3.0.0.1', '{\\bm{s}}')
('3.0.0.1', '{\\bm{w}}')
('3.0.0.1', 'f()')
('3.0.0.1', '{\\bm{s}}')
('3.0.0.1', 'k')
('3.0.0.1', 'n')
('3.0.0.1', 'k=1')
('3.0.0.1', 'f()')
('3.0.0.1', 'k')
('3.0.0.1', 'k > 1')
('3.0.0.1', 'k')
('3.0.0.1', '\\begin{aligned}\nf({\\bm{s}}) \\ :=\\  \\mathop{\\mathrm{arg\\,max}}_{\\bm{\\lambda}}\\  {\\bm{s}}^\\top \\bm{\\lambda} + \\epsilon H(\\bm{\\lambda}) \\notag \\\\\n\\text{s.t.} \\quad \\bm{1}^\\top \\bm{\\lambda} = k, \\ \\ \\bm{\\lambda}[i]\\in [0, 1] \\ \\ \\forall i=1,\\dots, n\n\\label{eq:soft_topk}\n\\end{aligned}')
('3.0.0.1', 'H(\\bm{\\lambda}) = \\sum_{i=1}^n -\\bm{\\lambda}[i] \\log \\bm{\\lambda}[i]')
('3.0.0.1', '\\bm{\\lambda}')
('3.0.0.1', '\\epsilon >0')
('3.0.0.1', 'k')
('3.0.0.1', '\\epsilon=0')
('3.0.0.1', '\\textrm{Top}({\\bm{s}}, k)')
('3.0.0.1', 'k=1')
('3.0.0.1', '\\textrm{softmax}(\\bm{{\\bm{s}}}/\\epsilon)')
('3.0.0.1', 'k')
('3.0.0.1', '\\epsilon')
('3.0.0.1', '\\epsilon')
('3.0.0.1', '\\epsilon > 0')
('3.0.0.1', 'k > 1')
('3.0.0.1', 'a \\in {\\mathbb{R}}')
('3.0.0.1', '{\\bm{b}}\\in {\\mathbb{R}}^n')
('3.0.0.1', '\\bm{\\lambda} = \\exp(\\frac{{\\bm{s}}+ {\\bm{b}}+ a}{\\epsilon})')
('3.0.0.1', 'a')
('3.0.0.1', '{\\bm{b}}')
('3.0.0.1', "\\begin{aligned}\n    a' &= \\epsilon \\ln(k) -\\epsilon \\ln\\left(\\sum_{i=1}^n \\exp\\left(\\frac{{\\bm{s}}[i] + {\\bm{b}}[i]}{\\epsilon}\\right)\\right) \\notag \\\\\n    {\\bm{b}}' &= \\min(-{\\bm{s}}-a', 0)\n    \\label{eq:iterations}\n\\end{aligned}")
('3.0.0.1', 'T=20')
('3.0.0.1', 'f({\\bm{s}})')
('3.0.0.1', '\\exp(\\frac{{\\bm{s}}+ {\\bm{b}}+ a}{\\epsilon})')
('3.0.0.1', 'a')
('3.0.0.1', '{\\bm{b}}')
('3.0.0.1', 'f({\\bm{s}})')
('3.0.0.1', '{\\bm{s}}')
('3.1', 'd')
('3.1', 'd')
('5.0', 'k=192')
('5.0', 'n=512')
('5.0', 'k')
('5.0', 'k')
('5.0.0', 'r=3, 5')
('5.0.0', 'k')
('5.0.0', 'k')
('5.0.0', 'k')
('5.0.0', 'k')
('5.0.0', 'k')
('5.0.0', 'k')
('5.0.0.1', 'k')
('5.0.0.1', 'k')
('5.0.0.1', 'k')
('5.0.0.1', 'k')
('5.0.0.1', 'r')
('6.0.0', '1/r')
('6.0.0', 'r=1, 3, 5')
('6.0.0.0', 'r=2,4')
('6.0.0.1', '\\times')
('6.0.0.1', '\\times')
('9.0', 'd_\\textrm{model}')
('9.0', 'd_\\textrm{ffn}')
('9.0', 'd_\\textrm{head}')
('9.0', 'd_\\textrm{adpt}')
('9.0.0', 'n=512')
('9.0.0', 'k=192')
('9.0.0', 'n=4096')
('9.0.0', 'k=1024')
('9.0.0', 'k')
('9.0.0', 'k')
('9.0.0', 'n')
('9.0.0', 'n/r')
('9.0.0', '10\\%')
('9.0.0', '20\\%')
('10.0', 'r=3')
('10.0', 'r')
('10.1', 'r')
('10.1', 'r=2,4')
('10.1', 'r=2,4')
('11.0', 'k')
('11.0', 'k')
('11.0', '\\begin{aligned}\n & \\max_{\\bm{\\lambda}} \\ \\ {\\bm{s}}^\\top \\bm{\\lambda} + \\epsilon H(\\bm{\\lambda}) \\nonumber \\\\\n\\Longleftrightarrow\\qquad & \\min_{\\bm{\\lambda}} \\ \\ -{\\bm{s}}^\\top \\bm{\\lambda} - \\epsilon H(\\bm{\\lambda}) \\nonumber \\\\\n\\Longleftrightarrow\\qquad & \\min_{\\bm{\\lambda}} \\ \\ -{\\bm{s}}^\\top \\bm{\\lambda} - \\epsilon H(\\bm{\\lambda}) - \\epsilon \\bm{1}^\\top \\bm{\\lambda} \\label{eq:minobj}\\\\\n\\text{s.t.}\\  & \\bm{1}^\\top\\bm{\\lambda} = k, \\ \\  \\bm{\\lambda[i]}\\in [0, 1],\\ \\ i=1,\\dots,n. \\nonumber\n\\end{aligned}')
('11.0', '\\epsilon \\bm{1}^\\top \\bm{\\lambda}')
('11.0', '\\epsilon\\times k')
('11.0', 'a\\in\\mathbb{R}')
('11.0', '{\\bm{b}}\\in\\mathbb{R}^m')
('11.0', '\\bm{1}^\\top\\bm{\\lambda} = k')
('11.0', '\\bm{\\lambda}[i] \\leq 1\\ \\forall i\\ ')
('11.0', '\\bm{\\lambda}[i] \\geq 0\\ \\forall i\\ ')
('11.0', 'H(\\bm{\\lambda}) = \\sum_i -\\bm{\\lambda}[i] \\log \\bm{\\lambda}[i]')
('11.0', '\\log\\bm{\\lambda}[i]')
('11.0', '\\begin{aligned}\n\\min_{\\lambda\\in\\mathbb{R}^m}\\ \\max_{a\\in\\mathbb{R}, {\\bm{b}}\\leq \\bm{0}} \\ -{\\bm{s}}^\\top \\bm{\\lambda} - \\epsilon H(\\bm{\\lambda}) - \\epsilon \\bm{1}^\\top \\bm{\\lambda} + a (k-\\bm{1}^\\top\\bm{\\lambda}) + \\bm{b}^\\top (\\bm{1} - \\bm{\\lambda})\n\\label{eq:minmax}\n\\end{aligned}')
('11.0', '\\bm{\\lambda}')
('11.0', '\\min')
('11.0', '\\max')
('11.0', '\\begin{aligned}\n\\max_{a\\in\\mathbb{R}, {\\bm{b}}\\leq \\bm{0}}\\ \\min_{\\lambda\\in\\mathbb{R}^m}\\ -{\\bm{s}}^\\top \\bm{\\lambda} - \\epsilon H(\\bm{\\lambda}) - \\epsilon \\bm{1}^\\top \\bm{\\lambda} + a (k-\\bm{1}^\\top\\bm{\\lambda}) + \\bm{b}^\\top (\\bm{1} - \\bm{\\lambda})\n\\label{eq:maxmin}\n\\end{aligned}')
('11.0', '(a, {\\bm{b}}, \\bm{\\lambda})')
('11.0', '\\begin{aligned}\n& \\frac{\\partial\\left(-{\\bm{s}}^\\top \\bm{\\lambda} - \\epsilon H(\\bm{\\lambda}) + \\epsilon \\bm{1}^\\top \\bm{\\lambda} + a (k-\\bm{1}^\\top\\bm{\\lambda}) + \\bm{b}^\\top (\\bm{1} - \\bm{\\lambda})\\right)}{\\partial \\bm{\\lambda}} = 0 \\\\\n\\Longleftrightarrow\\qquad & \\bm{\\lambda} = \\exp\\left(\\frac{{\\bm{s}}+ a +{\\bm{b}}}{\\epsilon}\\right)\n\\quad \\Longleftrightarrow\\quad \\bm{\\lambda}[i] = \\exp\\left(\\frac{{\\bm{s}}[i] + a + {\\bm{b}}[i]}{\\epsilon}\\right) \\ \\ \\forall i=1,\\dots,n\n%\\Longleftrightarrow\\qquad & \\lambda_i = \\exp\\left(\\frac{s_i + a+\\vb_i}{\\epsilon}\\right) \\ \\ \\forall i=1,\\dots,m\n\\end{aligned}')
('11.0', '\\bm{\\lambda}')
('11.0', '\\begin{aligned}\n\\max_{a\\in\\mathbb{R}, {\\bm{b}}\\leq \\bm{0}} k\\cdot a + \\bm{1}^\\top{\\bm{b}}- \\bm{1}^\\top \\exp\\left( \\frac{{\\bm{s}}+ a +{\\bm{b}}}{\\epsilon}\\right)\n\\end{aligned}')
('11.0', 'a')
('11.0', '{\\bm{b}}')
('11.0', 'a')
('11.0', '{\\bm{b}}')
('11.0', "\\begin{split}\n    a' = \\epsilon \\ln(k) - \\epsilon \\ln\\left(\\sum_{i=1}^n \\exp\\left(\\frac{{\\bm{s}}[i] + {\\bm{b}}[i]}{\\epsilon}\\right)\\right), \\qquad \\qquad {\\bm{b}}' = \\min(-{\\bm{s}}- a', 0) \\nonumber\n\\end{split}")
('11.0', 'k')
('11.0', 'a')
('11.0', '{\\bm{b}}')
('11.1', 'a')
('11.1', '{\\bm{b}}')
('11.1', '\\epsilon')
('11.1', '\\bm{\\lambda}')
('11.1', '\\epsilon')
('11.1', '\\epsilon_t')
('11.1', '\\epsilon')
('11.1', 't')
('11.1', '\\epsilon_0')
('11.1', '\\epsilon_t')
('11.1', '\\epsilon')
('11.1', '\\epsilon_t = \\max(\\beta \\epsilon_{t-1}, \\epsilon)')
('11.1', 't')
('11.1', '\\beta \\in (0, 1)')
('11.1', '\\epsilon_0=4')
('11.1', '\\epsilon=0.03')
('11.1', '\\beta=0.7')
('11.1', '\\epsilon=1.0')
('11.1', '\\beta=0.85')
('11.1', 'T=20')
('11.2', 'k')
('11.2', 'd')
('11.3', '\\sum_i \\lambda_i = k')
('11.3', '\\lambda_i \\leq 1\\ \\forall i')
('11.3', 'k')
('11.3', '\\epsilon')
('11.3', 'k')
('11.3', 'k')
('11.3', 'k')
