\{\mathcal{S},\mathcal{A},P,r,d_{0},\gamma\}
\mathcal{S}
\mathcal{A}
P:\mathcal{S}\times\mathcal{A}\times\mathcal{S}\rightarrow\mathbb{R}
r:\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}
d_{0}:\mathcal{S}\rightarrow\mathbb{R}
\gamma\in[0,1)
\pi
\pi:\mathcal{S}\times\mathcal{A}\rightarrow[0,1]
\pi(a|s)
J(\pi)\triangleq\mathbb{E}_{s_{0}\sim d_{0},a_{t}\sim\pi(\cdot|s_{t}),s_{t+1}%
\sim P(\cdot|s_{t},a_{t})}\big{[}\sum_{t=0}^{\infty}\gamma^{t}r(s_{t},a_{t})%
\big{]}
Q_{\pi}
V_{\pi}
Q_{\pi}(s_{t},a_{t})\triangleq\mathbb{E}_{t}\Big{[}\sum_{l=0}^{\infty}\gamma^{%
l}r(s_{t+l},a_{t+l})\Big{]}
V_{\pi}(s_{t})\triangleq\mathbb{E}_{a_{t}\sim\pi(\cdot|s_{t})}\Big{[}Q_{\pi}(s%
_{t},a_{t})\Big{]}
A_{\pi}(s,a)\triangleq Q_{\pi}(s,a)-V_{\pi}(s)
{d_{\pi}(s)\triangleq\sum_{t=0}^{\infty}\gamma^{t}P(s_{t}=s|\pi,d_{0})}
J(\tilde{\pi})=J(\pi)+\sum_{s}d_{\tilde{\pi}}(s)\sum_{a}\tilde{\pi}(a|s)A_{\pi%
}(s,a).
d_{\tilde{\pi}}(s)
\tilde{\pi}
L_{\pi}(\tilde{\pi})\triangleq J(\pi)+\sum_{s}d_{\pi}(s)\sum_{a}\tilde{\pi}(a|%
s)A_{\pi}(s,a),
d_{\tilde{\pi}}
d_{\pi}
D_{\mathrm{TV}}^{\mathrm{max}}(\pi,\tilde{\pi})\triangleq\max_{s}D_{\mathrm{TV%
}}\big{(}\pi(\cdot|s),\tilde{\pi}(\cdot|s)\big{)}
D_{\mathrm{TV}}
\alpha\triangleq D_{\mathrm{TV}}^{\mathrm{max}}(\pi,\tilde{\pi})
J(\tilde{\pi})\geq L_{\pi}(\tilde{\pi})-\frac{4\epsilon\gamma}{(1-\gamma)^{2}}%
\alpha^{2}
\epsilon=\max_{s,a}\lvert A_{\pi}(s,a)\rvert
D_{\mathrm{TV}}^{2}(\pi,\tilde{\pi})\leq\frac{1}{2}D_{\mathrm{KL}}(\pi,\tilde{%
\pi})
J(\tilde{\pi})\geq L_{\pi}(\tilde{\pi})-\frac{2\epsilon\gamma}{(1-\gamma)^{2}}%
D_{\mathrm{KL}}^{\mathrm{max}}(\pi,\tilde{\pi})
D_{\mathrm{KL}}^{\mathrm{max}}(\pi,\tilde{\pi})\triangleq\max_{s}D_{\mathrm{KL%
}}(\pi,\tilde{\pi})
\pi
\tilde{\pi}
\max_{\tilde{\pi}}\quad\mathbb{E}_{(s,a)\sim d_{\pi}}\Big{[}\frac{\tilde{\pi}(%
a|s)}{\pi(a|s)}A_{\pi}(s,a)\Big{]},\quad\text{s.t.}\quad\mathbb{E}_{s}\big{[}D%
_{\mathrm{KL}}(\pi(\cdot|s),\tilde{\pi}(\cdot|s))\big{]}\leq\delta,
\delta
\max_{\tilde{\pi}}\mathbb{E}_{d_{\pi}}\big{[}\min\big{(}\frac{\tilde{\pi}(a|s)%
}{\pi(a|s)}A_{\pi},\mathrm{clip}(\frac{\tilde{\pi}(a|s)}{\pi(a|s)},1-\epsilon,%
1+\epsilon)A_{\pi}\big{)}\big{]},\quad\text{ where }\epsilon\text{ is the %
clipping hyperparameter. }
A(s,a)\triangleq r(s,a)+\mathbb{E}_{s^{\prime}\sim P(\cdot|s,a)}[f(s^{\prime})%
]-f(s)
f
f:\mathcal{S}\rightarrow\mathbb{R}
\pi
\tilde{\pi}
\tilde{\pi}
\pi
J(\tilde{\pi})-J(\pi)=\mathbb{E}_{s\sim d_{\tilde{\pi}}(s),a\sim\tilde{\pi}}[A%
(s,a)]-\mathbb{E}_{s\sim d_{\pi}(s),a\sim\pi}[A(s,a)].
A(s,a)
\pi
A_{\pi}(s,a)
f
d_{\tilde{\pi}}(s)\tilde{\pi}(a)-d_{\pi}(s)\pi(a)
A(s,a)
d_{\tilde{\pi}}(s)
d_{\tilde{\pi}}(s)
\pi
d_{\pi}(s)
G_{\pi}(\tilde{\pi})\triangleq\mathbb{E}_{s\sim d_{\pi}(s),a\sim\pi(\cdot|s)}%
\big{[}\big{(}\frac{\tilde{\pi}(a|s)}{\pi(a|s)}-1\big{)}A(s,a)\big{]}.
\tilde{\pi}
\pi
J(\tilde{\pi})-J(\pi)\geq G_{\pi}(\tilde{\pi})-\frac{2\gamma}{1-\gamma}(\delta%
+\epsilon),\quad\text{ where }\delta=\max_{s,a}\left|\big{(}\frac{\tilde{\pi}(%
a|s)}{\pi(a|s)}-1\big{)}A(s,a)\right|\text{ and }\epsilon=\left|\sum_{a}\pi(a|%
s)A(s,a)\right|.
\big{(}\frac{\tilde{\pi}(a|s)}{\pi(a|s)}-1\big{)}
\big{(}\frac{\tilde{\pi}(a|s)}{\pi(a|s)}-1\big{)}
A(s,a)
G_{\pi}(\tilde{\pi})
G_{\pi}(\tilde{\pi})
A(s,a)
i=1,2,...
=1,2,...,N
\pi
\hat{A}_{\pi}
=1,2,...,K
M
\{(s,a)\}
\mathcal{L}(\theta)\triangleq\frac{1}{M}\sum\limits_{s,a}\min\Big{(}\big{(}%
\frac{\tilde{\pi}_{\theta}(a|s)}{\pi(a|s)}-1\big{)}\hat{A}_{\pi}(s,a),\delta%
\Big{)}
\mathcal{L}(\theta)
\theta
\pi\leftarrow\tilde{\pi}_{\theta}
G_{\pi}(\tilde{\pi})
G_{\pi}(\tilde{\pi})
\pi
\max_{\theta}\quad\mathbb{E}_{(s,a)\sim d_{\pi}}\big{[}\frac{\tilde{\pi}_{%
\theta}(s,a)}{\pi(s,a)}A_{\pi}(s,a)\big{]}
G_{\pi}(\tilde{\pi})
\max_{\theta}\quad\mathbb{E}_{(s,a)\sim d_{\pi}}\big{[}\mathrm{clip}\big{(}%
\frac{\tilde{\pi}_{\theta}(s,a)}{\pi(s,a)}-1,-\lambda,\lambda\big{)}A_{\pi}(s,%
a)\big{]}
\lambda>0
\big{(}\frac{\tilde{\pi}_{\theta}(s,a)}{\pi(s,a)}-1\big{)}A_{\pi}(s,a)
\max_{\theta}\quad\mathbb{E}_{(s,a)\sim d_{\pi}}\Big{[}\min\Big{(}\big{(}\frac%
{\tilde{\pi}_{\theta}(s,a)}{\pi(s,a)}-1\big{)}A_{\pi}(s,a),\delta\Big{)}\Big{]},
\delta>0
\delta
\tanh
0.01
0.01
0.0003
0
\delta
0.01
\frac{\tilde{\pi}(a|s)}{\pi(a|s)}
[-2,1]
[0,1]
