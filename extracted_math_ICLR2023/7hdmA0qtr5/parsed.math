x
N
x
N
\mathcal{X}
x_{1}x_{2}\ldots x_{n}\in\mathcal{X}^{n}
n
x_{1:n}
x_{1:j}
x_{1:n}
j\leq n
x_{\leq j}
x_{<j+1}
\epsilon
x_{1:n}
m>n
x_{1:m}:=x_{1:n}
x_{n:m}:=\epsilon
s
r
sr
[\![A]\!]
1
A
0
P
\mathcal{X}^{\infty}\cup\mathcal{X}^{*}
\mathcal{X}
\{0,1\}
\mathcal{X}
\mu(x)
x
\sum_{a\in\mathcal{X}}\mu(xa)=\mu(x)
\sum_{a\in\mathcal{X}}\mu(xa)\leq\mu(x)
z
x
z
T(z)=x
s
T^{s}(z)=x
\epsilon
U
U
p,q,x,y
U(p)=y
U(q)=x
\ell(x)\geq\ell(y)
p\sqsubseteq q
y\sqsubseteq x
p\sqsubseteq q
p
q
x_{n+1}
x_{1:n}
\mu(x_{n+1}|x_{1:n})=\mu(x_{1:n+1})/\mu(x_{1:n})
\mu
x_{n+1}
M
U
M(x)\leavevmode\nobreak\ :=\leavevmode\nobreak\ \sum_{p:U(p)=x*}2^{-\ell(p)}
p\in\{0,1\}^{*}
x*
x
p
U
M
M(x_{n+1}|x_{1:n})=\frac{M(x_{1:n}x_{n+1})}{M(x_{1:n})}
M(x_{n+1}|x_{1:n})=\sum_{p}P(p|x_{1:n})[\![U(p)=x_{1:n}x_{n+1}*]\!]
*
P(p|x_{1:n})
P(p)=2^{-\ell(p)}
P(x|p)=[\![U(p)=x*]\!]
M
\mu
\mu
\sum_{t=1}^{\infty}\sum_{x_{<t}}\mu(x_{<t})\sum_{x\in\mathcal{X}}(M(x|x_{<t})-%
\mu(x|x_{<t}))^{2}\leq K(\mu)\ln 2<\infty
K(\mu):=\min_{p}\{\ell(p):U(p)=\mu\}
\mu
x
a\in\mathcal{X}
M^{norm}(\epsilon):=1,\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode%
\nobreak\ M^{norm}(a|x)\leavevmode\nobreak\ :=\leavevmode\nobreak\ \frac{M(xa)%
}{\sum_{a\in\mathcal{X}}M(xa)}\leavevmode\nobreak\ =\leavevmode\nobreak\ \frac%
{M^{norm}(xa)}{M^{norm}(x)}
\mu
T
\pi_{\theta}
\tau
p(\tau)
x_{1:n}
\tau
\pi_{\theta}
-\sum_{t=1}^{n}\log\pi_{\theta}(x_{t}|x_{<t})
\pi_{\theta}
\pi_{\theta}(x_{t}|x_{<t})\approx\sum_{\tau}p(\tau|x_{<t})p(x_{t}|x_{<t},\tau)
p(x_{t}|x_{<t},\tau)
p(\tau|x_{<t})
\mu
D=(x^{1},...,x^{J})
n
\mu
\hat{\mu}(x)=\frac{1}{J}\sum_{y\in D}[\![y=x]\!]
\text{Loss}(\theta):=-\frac{1}{J}\sum_{x\in D}\sum_{t=1}^{\ell(x)}\log\pi_{%
\theta}(x_{t}|x_{<t})=-\frac{1}{J}\sum_{x\in D}\log\pi_{\theta}(x)=-\sum_{x\in%
\mathcal{X}^{n}}\hat{\mu}(x)\log p_{\theta}(x)
\pi_{\theta}(x)=\hat{\mu}(x)
\pi_{\theta}
\hat{\mu}
M
\pi_{\theta}
p
U
M
x
M
M
M
D:=(x^{1},...,x^{J})
J
\mu
M
\mu
\hat{\mu}_{D}(x)\leavevmode\nobreak\ :=\leavevmode\nobreak\ \frac{1}{|D|}\sum_%
{y\in D}[\![\ell(y)\geq\ell(x)\leavevmode\nobreak\ \wedge\leavevmode\nobreak\ %
y_{1:\ell(x)}=x]\!]\leavevmode\nobreak\ \stackrel{{\scriptstyle w.p.1}}{{%
\longrightarrow}}\mu(x)\leavevmode\nobreak\ \leavevmode\nobreak\ \text{for}%
\leavevmode\nobreak\ \leavevmode\nobreak\ |D|\to\infty
M
\leq L
U
s
U^{s}
n
\displaystyle M_{s,L,n}(x)\leavevmode\nobreak\ :=\leavevmode\nobreak\ \sum_{p%
\in\{0,1\}^{\leq L}:U^{s}(p)=x*}2^{-\ell(p)}\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ \text{if}\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ \ell(x)\leq n\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ \text{and}\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ 0\leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \text{otherwise}
\displaystyle M_{s,L,n}(x)\leavevmode\nobreak\ :=\leavevmode\nobreak\ \sum_{p%
\in\{0,1\}^{\leq L}:U^{s}(p)=x*}2^{-\ell(p)}\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ \text{if}\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ \ell(x)\leq n\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ \text{and}\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ 0\leavevmode\nobreak\ \leavevmode\nobreak\ %
\leavevmode\nobreak\ \text{otherwise}
D^{J}:=(x^{1},...,x^{J})
M_{s,L,n}
M
\leq n
M_{s,L,n}(x):=0
\ell(x)>n
D^{J}:=(x^{1},...,x^{J})
M_{s,L,n}
\hat{M}_{D^{J}}(x)=\frac{1}{J}\sum_{y\in D^{J}}[\![\ell(y)\geq\ell(x)%
\leavevmode\nobreak\ \wedge\leavevmode\nobreak\ y_{1:\ell(x)}=x]\!]\leavevmode%
\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \longrightarrow\leavevmode%
\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ M_{s,L,n}(x)\leavevmode%
\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{for}\leavevmode%
\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ J\to\infty
M(x)=\lim_{s,L,n\to\infty}M_{s,L,n}(x)=\sup_{s,L,n}M_{s,L,n}(x)
\hat{M}_{D^{J}}\rightarrow M
s,L,n,J\to\infty
D^{J}
s,L,n
s(j),L(j),n(j)
x^{j}
M_{s(j),L(j),n(j)}(x)
j=1,2,3,...
M_{s,L,n}
M_{s,L,n}^{norm}(x)
\displaystyle\hat{M}_{s,L,n}^{norm}(x_{t}|x_{<t})\leavevmode\nobreak\ =%
\leavevmode\nobreak\ \frac{\sum_{y\in D^{J}}[\![\ell(y)\geq t\leavevmode%
\nobreak\ \wedge\leavevmode\nobreak\ y_{1:t}=x_{1:t}]\!]}{\sum_{y\in D^{J}}[\!%
[\ell(y)\geq t\leavevmode\nobreak\ \wedge\leavevmode\nobreak\ y_{<t}=x_{<t}]\!%
]}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \stackrel{{%
\scriptstyle J\to\infty}}{{\longrightarrow}}\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ M_{s,L,n}^{norm}(x_{t}|x_{<t})
\displaystyle\hat{M}_{s,L,n}^{norm}(x_{t}|x_{<t})\leavevmode\nobreak\ =%
\leavevmode\nobreak\ \frac{\sum_{y\in D^{J}}[\![\ell(y)\geq t\leavevmode%
\nobreak\ \wedge\leavevmode\nobreak\ y_{1:t}=x_{1:t}]\!]}{\sum_{y\in D^{J}}[\!%
[\ell(y)\geq t\leavevmode\nobreak\ \wedge\leavevmode\nobreak\ y_{<t}=x_{<t}]\!%
]}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \stackrel{{%
\scriptstyle J\to\infty}}{{\longrightarrow}}\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ M_{s,L,n}^{norm}(x_{t}|x_{<t})
t=1,...,n
\hat{M}_{s,L,n}^{norm}(x)\to M_{s,L,n}^{norm}(x)\to M^{norm}(x)
n
n
s,L,n
M_{s,L,n}^{\cdots}
M^{norm}
M
M^{norm}
M^{norm}
x^{j}
D^{J}
n
\mathcal{X}
\ell(x^{j})
\text{Loss}(\theta)\leavevmode\nobreak\ =\leavevmode\nobreak\ -\sum_{t=1}^{n}%
\sum_{x_{<t}}\Big{(}\sum_{x_{t}}\hat{M}_{D^{J}}(x_{1:t})\Big{)}\Big{(}\sum_{x_%
{t}}\hat{M}^{norm}(x_{t}|x_{<t})\log\pi_{\theta}(x_{t}|x_{<t})\Big{)}
\pi_{\theta}(x_{t}|x_{<t})=\hat{M}^{norm}(x_{t}|x_{<t})
\pi_{\theta}(x)
\hat{M}^{norm}(x)
\text{Loss}(\theta)
x^{j}
\hat{M}^{\cdots}
\pi_{\theta}
\hat{\mu}=\hat{M}^{\cdots}
x^{j}
M_{s(j),L(j),n}^{\cdots}(x)
j=1,2,3,...
M_{\infty,\infty,n}^{\cdots}
n
\hat{M}^{\cdots}\to M^{\cdots}_{\infty,\infty,\infty}
Q
\mathcal{X}^{\infty}
Q(q):=Q(\Gamma_{q})
Q
q
\Gamma_{q}:=\{\omega\in\mathcal{X}^{\infty}:q\sqsubseteq\omega\}=q\mathcal{X}^%
{\infty}
\displaystyle M_{T}^{Q}(x)\leavevmode\nobreak\ :=\sum_{q:T(q)=x*\!\!\!\!}Q(q)%
\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{with %
special case}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ M_%
{U}(x)\leavevmode\nobreak\ :=\sum_{q:U(q)=x*\!\!\!\!}2^{-\ell(q)}
\displaystyle M_{T}^{Q}(x)\leavevmode\nobreak\ :=\sum_{q:T(q)=x*\!\!\!\!}Q(q)%
\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{with %
special case}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ M_%
{U}(x)\leavevmode\nobreak\ :=\sum_{q:U(q)=x*\!\!\!\!}2^{-\ell(q)}
T=U
Q(q)=2^{-\ell(q)}
M_{U}
Q
M_{U}^{Q}
M_{U}^{Q}(x)
Q
Q(q)>0\leavevmode\nobreak\ \forall q\in\mathcal{X}^{*}
Q(q_{1:n})\to 0
n\to\infty
U
Q
V
M_{U}^{Q}(x)=M_{V}(x)\leavevmode\nobreak\ \forall x
6
256
24
3
1024
6
256
24
3
1024
k
t
k
k
n
15
\mathcal{X}
\{(x_{i}\in\mathcal{X},y_{i}\in\mathcal{X})\}_{i=1}^{I}
z:=(x_{1},y_{1};x_{2},y_{2};\dots x_{n},y_{n};\dots)
\mathcal{O}_{z}
z
A(z):=\frac{1}{|\mathcal{O}_{z}|}\sum_{t\in\mathcal{O}_{z}}[\![\operatorname*{%
arg\,max}_{y}\pi_{\theta}(y|z_{<t})=z_{t}]\!]
|\mathcal{X}|=17
7
s=1000
200
n=256
\pi_{\theta}
x_{<t}
\pi_{\theta}(\cdot|x_{<t})
\text{Loss}(\theta):=-\frac{1}{n}\sum_{t=1}^{n}\log\pi_{\theta}(x_{t}|x_{<t})
500
128
256
10^{-4}
3
R_{\pi\mu}(t):=\mathbb{E}_{x_{t}\sim\mu}\left[\log\mu(x_{t}\mid x_{<t})-\log%
\pi(x_{t}\mid x_{<t})\right]
t
R_{\pi\mu}^{T}:=\sum_{t=1}^{T}R_{\pi\mu}(t)
\pi
\mu
6
256
1024
6
400
1024
6
400
1024
256
2
6
1024
6
1024
3
3
U^{s}(p)
p
s
M_{s,L,n}
s
n
s
T
O(\log T)
\mu
x=\epsilon
\mu(a|x):=\mu(xa)/\mu(x)
x\leftarrow xa
a\in\mathcal{X}
1-\sum_{a\in\mathcal{X}}\mu(a|x)
x
D:=(x^{1},...,x^{J})
J
\mu
\mu
\displaystyle\hat{\mu}_{D}(x)\leavevmode\nobreak\ :=\leavevmode\nobreak\ \frac%
{1}{|D|}\sum_{y\in D}[\![\ell(y)\geq\ell(x)\leavevmode\nobreak\ \wedge%
\leavevmode\nobreak\ y_{1:\ell(x)}=x]\!]\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ \stackrel{{\scriptstyle w.p.1}}{{%
\longrightarrow}}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak%
\ \mu(x)\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{%
for}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ |D|\to\infty
\displaystyle\hat{\mu}_{D}(x)\leavevmode\nobreak\ :=\leavevmode\nobreak\ \frac%
{1}{|D|}\sum_{y\in D}[\![\ell(y)\geq\ell(x)\leavevmode\nobreak\ \wedge%
\leavevmode\nobreak\ y_{1:\ell(x)}=x]\!]\leavevmode\nobreak\ \leavevmode%
\nobreak\ \leavevmode\nobreak\ \stackrel{{\scriptstyle w.p.1}}{{%
\longrightarrow}}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak%
\ \mu(x)\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{%
for}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ |D|\to\infty
D_{x}:=(y\in D:\ell(y)\geq\ell(x)\leavevmode\nobreak\ \wedge\leavevmode%
\nobreak\ y_{1:\ell(y)}=x)
D
x
x^{j}
\mu
|D_{x}|/|D|\to\mu(x)
J\to\infty
\displaystyle\widetilde{M}_{s,L,n}(x_{1:t})\leavevmode\nobreak\ :=\leavevmode%
\nobreak\ \frac{\sum_{x_{t+1:n}}M_{s,L,n}(x_{1:n})}{\sum_{x_{1:n}}M_{s,L,n}(x_%
{1:n})}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{%
for}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ t\leq n%
\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{and}%
\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ 0\leavevmode%
\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{else}
\displaystyle\widetilde{M}_{s,L,n}(x_{1:t})\leavevmode\nobreak\ :=\leavevmode%
\nobreak\ \frac{\sum_{x_{t+1:n}}M_{s,L,n}(x_{1:n})}{\sum_{x_{1:n}}M_{s,L,n}(x_%
{1:n})}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{%
for}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ t\leq n%
\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{and}%
\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ 0\leavevmode%
\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{else}
n
M_{s,L,n}
n
\widetilde{D}:=(x^{j}\in D^{J}:\ell(x^{j})\geq n)
\displaystyle\hat{\widetilde{M}}_{\widetilde{D}}(x)\leavevmode\nobreak\ =%
\leavevmode\nobreak\ \frac{1}{|\widetilde{D}|}\sum_{y\in\widetilde{D}}[\![y_{1%
:\ell(x)}=x]\!]\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\longrightarrow\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
M(x)\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{for}%
\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ s,L,n,J\to\infty
\displaystyle\hat{\widetilde{M}}_{\widetilde{D}}(x)\leavevmode\nobreak\ =%
\leavevmode\nobreak\ \frac{1}{|\widetilde{D}|}\sum_{y\in\widetilde{D}}[\![y_{1%
:\ell(x)}=x]\!]\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\longrightarrow\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
M(x)\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{for}%
\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ s,L,n,J\to\infty
|\widetilde{D}|/|D|
n
\sum_{x_{1:n}}M_{s,L,n}(x_{1:n})
n
J\to\infty
\displaystyle\hat{\widetilde{M}}_{\widetilde{D}}(x_{1:n})\leavevmode\nobreak\ %
=\leavevmode\nobreak\ \frac{1}{|\widetilde{D}|}\sum_{y\in\widetilde{D}}[\![y_{%
1:\ell(x)}=x_{1:n}]\!]\leavevmode\nobreak\ =\leavevmode\nobreak\ \frac{|D|}{|%
\widetilde{D}|}\frac{1}{|D|}\sum_{y\in D}[\![\ell(y)\geq n\leavevmode\nobreak%
\ \wedge\leavevmode\nobreak\ y_{1:\ell(x)}=x_{1:n}]\!]
\displaystyle\hat{\widetilde{M}}_{\widetilde{D}}(x_{1:n})\leavevmode\nobreak\ 
\displaystyle=\leavevmode\nobreak\ \frac{1}{|\widetilde{D}|}\sum_{y\in%
\widetilde{D}}[\![y_{1:\ell(x)}=x_{1:n}]\!]\leavevmode\nobreak\ =\leavevmode%
\nobreak\ \frac{|D|}{|\widetilde{D}|}\frac{1}{|D|}\sum_{y\in D}[\![\ell(y)\geq
n%
\leavevmode\nobreak\ \wedge\leavevmode\nobreak\ y_{1:\ell(x)}=x_{1:n}]\!]
\displaystyle=\leavevmode\nobreak\ \frac{|D|}{|\widetilde{D}|}\hat{M}_{D^{J}}(%
x_{1:n})\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\stackrel{{\scriptstyle J\to\infty}}{{\longrightarrow}}\leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ \frac{M_{s,L,n}(x_{1:n})}{\sum_{x_{1%
:n}}M_{s,L,n}(x_{1:n})}\leavevmode\nobreak\ =\leavevmode\nobreak\ \widetilde{M%
}_{s,L,n}(x_{1:n})
\displaystyle=\leavevmode\nobreak\ \frac{|D|}{|\widetilde{D}|}\hat{M}_{D^{J}}(%
x_{1:n})\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\stackrel{{\scriptstyle J\to\infty}}{{\longrightarrow}}\leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ \frac{M_{s,L,n}(x_{1:n})}{\sum_{x_{1%
:n}}M_{s,L,n}(x_{1:n})}\leavevmode\nobreak\ =\leavevmode\nobreak\ \widetilde{M%
}_{s,L,n}(x_{1:n})
\sum_{x_{t+1:n}}
s,L,n\to\infty
x=x_{1:t}
x
n
\ell(x)<n
M_{s,L,n}(x)
M_{\cdots}^{norm}(x)
n
D_{x}:=(y\in D:\ell(y)\geq\ell(x)\leavevmode\nobreak\ \wedge\leavevmode%
\nobreak\ y_{1:\ell(y)}=x)
D
x
x^{j}
\mu
|D_{x}|/|D|\to\mu(x)
J\to\infty
x=x_{<t}
a=x_{t}
\displaystyle\sum_{a\in\mathcal{X}}\hat{M}_{D^{J}}(xa)\leavevmode\nobreak\ =%
\leavevmode\nobreak\ \frac{1}{J}\sum_{a}\sum_{y\in D^{J}}[\![\ell(y)\geq\ell(%
xa)\leavevmode\nobreak\ \wedge\leavevmode\nobreak\ y_{1:\ell(xa)}=xa]\!]
\displaystyle\sum_{a\in\mathcal{X}}\hat{M}_{D^{J}}(xa)\leavevmode\nobreak\ 
\displaystyle=\leavevmode\nobreak\ \frac{1}{J}\sum_{a}\sum_{y\in D^{J}}[\![%
\ell(y)\geq\ell(xa)\leavevmode\nobreak\ \wedge\leavevmode\nobreak\ y_{1:\ell(%
xa)}=xa]\!]
\displaystyle=\leavevmode\nobreak\ \frac{1}{J}\sum_{y\in D^{J}}[\![\ell(y)\geq
t%
\leavevmode\nobreak\ \wedge\leavevmode\nobreak\ \exists a:y_{1:t}=xa]\!]
\displaystyle=\leavevmode\nobreak\ \frac{1}{J}\sum_{y\in D^{J}}[\![\ell(y)\geq
t%
\leavevmode\nobreak\ \wedge\leavevmode\nobreak\ \exists a:y_{1:t}=xa]\!]
\displaystyle\text{hence}\leavevmode\nobreak\ \hat{M}_{s,L,n}^{norm}(a|x)%
\leavevmode\nobreak\ =\leavevmode\nobreak\ \frac{\hat{M}_{D^{J}}(xa)}{\sum_{a}%
\hat{M}_{D^{J}}(xa)}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode%
\nobreak\ \stackrel{{\scriptstyle J\to\infty}}{{\longrightarrow}}\leavevmode%
\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \frac{M_{s,L,n}(ax)}{\sum_%
{a}M_{s,L,n}(ax)}\leavevmode\nobreak\ =\leavevmode\nobreak\ M_{s,L,n}^{norm}(a%
|x)
\displaystyle\leavevmode\nobreak\ \hat{M}_{s,L,n}^{norm}(a|x)\leavevmode%
\nobreak\ =\leavevmode\nobreak\ \frac{\hat{M}_{D^{J}}(xa)}{\sum_{a}\hat{M}_{D^%
{J}}(xa)}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ %
\stackrel{{\scriptstyle J\to\infty}}{{\longrightarrow}}\leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ \frac{M_{s,L,n}(ax)}{\sum_{a}M_{s,L,%
n}(ax)}\leavevmode\nobreak\ =\leavevmode\nobreak\ M_{s,L,n}^{norm}(a|x)
M
n
\bot\not\in\mathcal{X}
x^{j}
n
\bot
\hat{M}_{\cdots}
\hat{M}_{\cdots}
x^{j}
M_{s(j),L(j),n}(x)
j=1,2,3,...
M_{\infty,\infty,n}
n
\hat{M}_{\cdots}\to M
\widetilde{M}_{\cdots}
M_{\cdots}^{norm}
\bot
\widetilde{M}_{\cdots}
\widetilde{D}
M_{\cdots}^{norm}
x^{j}
D^{J}
n
\mathcal{X}
-\sum_{t=1}^{\ell(x)}\log(\text{LLM}(x_{t}|x_{<t}))
\ell(x)
n
\widetilde{M}
\widetilde{D}
n
D^{J}
M
\widetilde{D}
\widetilde{M}
D=\widetilde{D}
p_{\theta}=\hat{\widetilde{M}}
\widetilde{D}
p_{\theta}
\hat{\widetilde{M}}
M
\mathcal{X}
\bot
D_{\bot}
x\in D^{J}
\bot
n
M:\mathcal{X}^{*}\to[0;1]
M_{\!\bot\!}:\mathcal{X}^{*}\cup\{\bot\}\to[0;1]
\displaystyle M_{\!\bot\!}(x)\leavevmode\nobreak\ :=\leavevmode\nobreak\ M(x)
\displaystyle M_{\!\bot\!}(x)\leavevmode\nobreak\ 
\displaystyle:=\leavevmode\nobreak\ M(x)
\displaystyle\text{for all}x\in\mathcal{X}^{*}
\displaystyle x\in\mathcal{X}^{*}
\displaystyle M_{\!\bot\!}(x\bot^{\!t})\leavevmode\nobreak\ :=\leavevmode%
\nobreak\ M(x)-\textstyle\sum_{a\in\mathcal{X}}M(xa)
\displaystyle M_{\!\bot\!}(x\bot^{\!t})\leavevmode\nobreak\ 
\displaystyle:=\leavevmode\nobreak\ M(x)-\textstyle\sum_{a\in\mathcal{X}}M(xa)
\displaystyle\text{for all}x\in\mathcal{X}^{*}\leavevmode\nobreak\ \leavevmode%
\nobreak\ \text{and}\leavevmode\nobreak\ \leavevmode\nobreak\ t\geq 1
\displaystyle x\in\mathcal{X}^{*}\leavevmode\nobreak\ \leavevmode\nobreak\ %
\text{and}\leavevmode\nobreak\ \leavevmode\nobreak\ t\geq 1
\displaystyle M_{\!\bot\!}(x)\leavevmode\nobreak\ :=\leavevmode\nobreak\ 0
\displaystyle M_{\!\bot\!}(x)\leavevmode\nobreak\ 
\displaystyle:=\leavevmode\nobreak\ 0
\displaystyle\text{for all}x\not\in\mathcal{X}^{*}\{\bot\}^{*}
\displaystyle x\not\in\mathcal{X}^{*}\{\bot\}^{*}
D_{\bot}
M_{\!\bot}
D=D_{\bot}
p_{\theta}=\hat{M}_{\!\bot}
\hat{M}_{\!\bot\!}(x)
x\in\mathcal{X}^{*}
\hat{M}(x)
D_{\bot}
p_{\theta}(x)
\hat{M}(x)
x\in\mathcal{X}^{*}
M
x\bot
\ell(x)<n
\ell(x)<n
s
U^{s}
\bot
x
s\to\infty
x
\mathcal{X}
t=\ell(x)
M^{norm}
\bot
\displaystyle\text{Loss}(\theta)\leavevmode\nobreak\ :=\leavevmode\nobreak\ -%
\frac{1}{J}\sum_{x\in D^{J}}\log p_{\theta}(x)\leavevmode\nobreak\ =%
\leavevmode\nobreak\ -\frac{1}{J}\sum_{x\in D^{J}}\sum_{t=1}^{\ell(x)}\log p_{%
\theta}(x_{t}|x_{<t})
\displaystyle\text{Loss}(\theta)\leavevmode\nobreak\ 
\displaystyle:=\leavevmode\nobreak\ -\frac{1}{J}\sum_{x\in D^{J}}\log p_{%
\theta}(x)\leavevmode\nobreak\ =\leavevmode\nobreak\ -\frac{1}{J}\sum_{x\in D^%
{J}}\sum_{t=1}^{\ell(x)}\log p_{\theta}(x_{t}|x_{<t})
\displaystyle=\leavevmode\nobreak\ -\frac{1}{J}\sum_{t=1}^{n}\sum_{x\in D^{J}%
\wedge\ell(x)\geq t}\log p_{\theta}(x_{t}|x_{<t})\leavevmode\nobreak\ =%
\leavevmode\nobreak\ -\sum_{t=1}^{n}\sum_{x_{1:t}}\hat{M}_{D^{J}}(x_{1:t})\log
p%
_{\theta}(x_{t}|x_{<t})
\displaystyle=\leavevmode\nobreak\ -\frac{1}{J}\sum_{t=1}^{n}\sum_{x\in D^{J}%
\wedge\ell(x)\geq t}\log p_{\theta}(x_{t}|x_{<t})\leavevmode\nobreak\ =%
\leavevmode\nobreak\ -\sum_{t=1}^{n}\sum_{x_{1:t}}\hat{M}_{D^{J}}(x_{1:t})\log
p%
_{\theta}(x_{t}|x_{<t})
\displaystyle=\leavevmode\nobreak\ -\sum_{t=1}^{n}\sum_{x_{<t}}\Big{(}\sum_{x_%
{t}}\hat{M}_{D^{J}}(x_{1:t})\Big{)}\Big{(}\sum_{x_{t}}\hat{M}^{norm}(x_{t}|x_{%
<t})\log p_{\theta}(x_{t}|x_{<t})\Big{)}
\displaystyle=\leavevmode\nobreak\ -\sum_{t=1}^{n}\sum_{x_{<t}}\Big{(}\sum_{x_%
{t}}\hat{M}_{D^{J}}(x_{1:t})\Big{)}\Big{(}\sum_{x_{t}}\hat{M}^{norm}(x_{t}|x_{%
<t})\log p_{\theta}(x_{t}|x_{<t})\Big{)}
\varphi
\varphi:\mathcal{X}^{\#}\to\mathcal{X}^{\#}
\mathcal{X}^{\#}:=\mathcal{X}^{\infty}\cup\mathcal{X}^{*}
\mathcal{X}=\{0,1\}
\varphi
\displaystyle\varphi\leavevmode\nobreak\ \text{is monotone \leavevmode\nobreak%
\ \leavevmode\nobreak\ \leavevmode\nobreak\  iff}\leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ [\forall q\sqsubseteq p:\varphi(q)%
\sqsubseteq\varphi(p)]
\displaystyle\varphi\leavevmode\nobreak\ \text{is monotone \leavevmode\nobreak%
\ \leavevmode\nobreak\ \leavevmode\nobreak\  iff}\leavevmode\nobreak\ %
\leavevmode\nobreak\ \leavevmode\nobreak\ [\forall q\sqsubseteq p:\varphi(q)%
\sqsubseteq\varphi(p)]
q\sqsubseteq p
q
p
\exists r\in\mathcal{X}^{\#}:qr=p
\sqsubset
r\neq\epsilon
p
\varphi
x
\exists r:\phi(p)=xr
\forall r\forall q\sqsubset p:\phi(q)\neq xr
\varphi(p)=x*
p
x
T
\varphi_{T}
p
x
\varphi_{T}(p):=x
\varphi_{T}
T(p)=\varphi_{T}(p)
U
U(i^{\prime}q)=T_{i}(q)
T_{1},T_{2},...
i^{\prime}
i
Q
Q
Q
q\in\mathcal{X}^{*}
Q
Q
Q(q)=4^{-\ell(q)}
\frac{1}{2}
x_{1:\infty}
M_{U}(x_{t}|x_{<t})\to\frac{1}{2}
M_{U}^{Q}(x_{t}|x_{<t})<\frac{1}{3}
t
0.q_{1:\infty}\in[0;1]
q_{1:\infty}
Q
[0;1]
F:[0;1]\to[0;1]
F(0.q_{1:\infty})=\sum_{t:q_{t}=1}Q(\Gamma_{q_{<t}0})
[0;\,0.q_{1:\infty})={\dot{\smash{\bigcup}}}_{t:q_{t}=1}0.\Gamma_{q_{<t}0}
0.\Gamma_{q}=[0.q0^{\infty};\,0.q1^{\infty})
\dot{\smash{\bigcup}}
Q(q)>0\leavevmode\nobreak\ \forall q\in\mathcal{X}^{*}
F
Q(q_{1:n})\to 0
F
F(0)=0
F(1)=1
F
0.p_{1:\infty}=F(0.q_{1:\infty})
0.q_{1:\infty}=F^{-1}(0.p_{1:\infty})
p_{1:m}
m
q_{1:n}
0.q10^{\infty}=0.q01^{\infty}
0
Q
\frac{1}{2}
M_{U}^{Q}(x)
q\sqsubset q_{1:\infty}
\displaystyle[0.p_{1:\infty}^{0};\,0.p_{1:\infty}^{1})\leavevmode\nobreak\ :=%
\leavevmode\nobreak\ [F(0.q0^{\infty});F(0.q1^{\infty}))\leavevmode\nobreak\ =%
:\leavevmode\nobreak\ \dot{\bigcup}_{p\in\Phi(q)}0.\Gamma_{p}
\displaystyle[0.p_{1:\infty}^{0};\,0.p_{1:\infty}^{1})\leavevmode\nobreak\ :=%
\leavevmode\nobreak\ [F(0.q0^{\infty});F(0.q1^{\infty}))\leavevmode\nobreak\ =%
:\leavevmode\nobreak\ \dot{\bigcup}_{p\in\Phi(q)}0.\Gamma_{p}
0.\Gamma_{p}
\Phi(q)
p
p
p0
p1
\Phi(q)
\displaystyle\Phi(q)\leavevmode\nobreak\ :=\leavevmode\nobreak\ \{p_{<t}^{0}1:%
t>t_{0}\wedge p_{t}^{0}=0\}\leavevmode\nobreak\ \dot{\cup}\leavevmode\nobreak%
\ \{p_{<t}^{1}0:t>t_{0}\wedge p_{t}^{1}=1\}
\displaystyle\Phi(q)\leavevmode\nobreak\ :=\leavevmode\nobreak\ \{p_{<t}^{0}1:%
t>t_{0}\wedge p_{t}^{0}=0\}\leavevmode\nobreak\ \dot{\cup}\leavevmode\nobreak%
\ \{p_{<t}^{1}0:t>t_{0}\wedge p_{t}^{1}=1\}
t_{0}
t
p_{t}^{0}\neq p_{t}^{1}
\displaystyle Q(q)\leavevmode\nobreak\ =\leavevmode\nobreak\ F(0.q1^{\infty})-%
F(0.q0^{\infty})\leavevmode\nobreak\ =\leavevmode\nobreak\ \sum_{p\in\Phi(q)}|%
0.\Gamma_{p}|\leavevmode\nobreak\ =\leavevmode\nobreak\ \sum_{p\in\Phi(q)}2^{-%
\ell(p)}\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{into}
\displaystyle Q(q)\leavevmode\nobreak\ 
\displaystyle=\leavevmode\nobreak\ F(0.q1^{\infty})-F(0.q0^{\infty})%
\leavevmode\nobreak\ =\leavevmode\nobreak\ \sum_{p\in\Phi(q)}|0.\Gamma_{p}|%
\leavevmode\nobreak\ =\leavevmode\nobreak\ \sum_{p\in\Phi(q)}2^{-\ell(p)}%
\leavevmode\nobreak\ \leavevmode\nobreak\ \leavevmode\nobreak\ \text{into}
\displaystyle M_{U}^{Q}(x)\leavevmode\nobreak\ \equiv\leavevmode\nobreak\ \sum%
_{q:U(q)=x*\!\!\!\!}Q(q)\leavevmode\nobreak\ =\leavevmode\nobreak\ \sum_{\!\!%
\!\!q:U(q)=x*\leavevmode\nobreak\ \leavevmode\nobreak\ }\sum_{p\in\Phi(q)\!\!%
\!\!}2^{-\ell(p)}\leavevmode\nobreak\ =\leavevmode\nobreak\ \sum_{p:V(p)=x*\!%
\!\!\!}2^{-\ell(p)}\leavevmode\nobreak\ =\leavevmode\nobreak\ M_{V}(x)
\displaystyle M_{U}^{Q}(x)\leavevmode\nobreak\ 
\displaystyle\equiv\leavevmode\nobreak\ \sum_{q:U(q)=x*\!\!\!\!}Q(q)%
\leavevmode\nobreak\ =\leavevmode\nobreak\ \sum_{\!\!\!\!q:U(q)=x*\leavevmode%
\nobreak\ \leavevmode\nobreak\ }\sum_{p\in\Phi(q)\!\!\!\!}2^{-\ell(p)}%
\leavevmode\nobreak\ =\leavevmode\nobreak\ \sum_{p:V(p)=x*\!\!\!\!}2^{-\ell(p)%
}\leavevmode\nobreak\ =\leavevmode\nobreak\ M_{V}(x)
V(p):=U(q)
q
p\in\Phi(q)
q
\Phi(q)\cap\Phi(q^{\prime})=\{\}
q\not\sqsubseteq q^{\prime}
q^{\prime}\not\sqsubseteq q
F
V
p^{\imath}
0.\Gamma_{p^{\imath}}\subseteq[F(0.\imath^{\prime}0^{\infty});F(0.\imath^{%
\prime}1^{\infty}))
\imath
F^{-1}(0.p^{\imath}*)=0.\imath^{\prime}...
*
F(q_{1:\infty})_{\text{tail}}:=F(q_{1:\infty})_{\ell(p^{\imath})+1:\infty}=p_{%
\ell(p^{\imath})+1:\infty}
q_{1:\infty}
\imath^{\prime}
F(q_{1:\infty})
T
T(q_{1:\infty}):=U_{0}(F(q_{1:\infty})_{\text{tail}})
U_{0}
i
T_{i}(q)=T(i^{\prime}q)\leavevmode\nobreak\ \forall q
\dot{k}:=\ell(i^{\prime})+1
\dot{\ell}:=\ell(p^{i})+1
q_{<\dot{k}}:=i^{\prime}
p_{<\dot{\ell}}=p^{i}
V(p_{1:\infty})=U(q_{1:\infty})
\displaystyle V(p^{i}p_{\dot{\ell}:\infty})\leavevmode\nobreak\ =\leavevmode%
\nobreak\ U(i^{\prime}q_{\dot{k}:\infty})\leavevmode\nobreak\ =\leavevmode%
\nobreak\ T_{i}(q_{\dot{k}:\infty})\leavevmode\nobreak\ =\leavevmode\nobreak\ %
T(i^{\prime}q_{\dot{k}:\infty})\leavevmode\nobreak\ =\leavevmode\nobreak\ U_{0%
}(F(i^{\prime}q_{\dot{k}:\infty})_{\text{tail}})\leavevmode\nobreak\ =%
\leavevmode\nobreak\ U_{0}(p_{\dot{\ell}:\infty})
\displaystyle V(p^{i}p_{\dot{\ell}:\infty})\leavevmode\nobreak\ =\leavevmode%
\nobreak\ U(i^{\prime}q_{\dot{k}:\infty})\leavevmode\nobreak\ =\leavevmode%
\nobreak\ T_{i}(q_{\dot{k}:\infty})\leavevmode\nobreak\ =\leavevmode\nobreak\ %
T(i^{\prime}q_{\dot{k}:\infty})\leavevmode\nobreak\ =\leavevmode\nobreak\ U_{0%
}(F(i^{\prime}q_{\dot{k}:\infty})_{\text{tail}})\leavevmode\nobreak\ =%
\leavevmode\nobreak\ U_{0}(p_{\dot{\ell}:\infty})
V
q_{1:\infty}
\ell
\ell
\ell
x_{1},x_{2},x_{3},...
S\subset\{0,1\}^{*}
p(x_{t}=0|x_{<t};S,\Theta_{S}):=\theta_{s}
x_{t}
s=x_{t-\ell(s):t-1}\in S
\Theta_{S}:=(\theta_{s}\in[0;1]:s\in S)
x_{t}=0
t\leq 0
\text{Leaf}_{11}
\text{Leaf}_{11}
\text{Leaf}_{10}
01010101
D\in\mathbb{N}_{0}
S
D
\theta_{s}\in[0;1]
s\in S
S=\{\epsilon\}
s\in S
\ell(s)<D
{{}^{1}\!/\!_{2}}
s
{{}^{1}\!/\!_{2}}
S\leftarrow S\setminus\{s\}\cup\{0s,1s\}
s\in S
\ell(s)=D
\theta_{s}
\text{Beta}({{}^{1}\!/\!_{2}},{{}^{1}\!/\!_{2}})
s\in S
t=1,2,3,...
x_{t}
p(x_{t}|x_{<t};S,\Theta_{S})
P_{\text{CTW}}(x_{1:n})
a_{s}:=|\{t\in\{1,...,n\}:x_{t}=0\wedge x_{t-\ell(s):t-1}=s\}|
x_{t}=0
s\in\{0,1\}^{*}
b_{s}:=|\{t:x_{t}=1\wedge x_{t-\ell(s):t-1}=s\}|
x_{1:n}^{s}\in\{0,1\}^{a_{s}+b_{s}}
x_{t}
s
\theta_{s}
s\in S
x_{1:n}^{s}
1-\theta_{s}
\theta_{s}\sim\text{Beta}({{}^{1}\!/\!_{2}},{{}^{1}\!/\!_{2}})
P(x_{1:n}^{s}|s\in S)=P_{\text{KT}}(a_{s},b_{s}):=\int_{0}^{1}\theta_{s}^{a_{s%
}}(1-\theta_{s})^{b_{s}}\text{Beta}({{}^{1}\!/\!_{2}},{{}^{1}\!/\!_{2}})(%
\theta_{s})d\theta_{s}
s\not\in S
x_{1:n}^{s}
x_{1:n}^{0s}
x_{1:n}^{1s}
S
s\in S
0s
1s
P_{\text{CTW}}(x_{1:n}^{s})=\frac{1}{2}P_{\text{KT}}(a_{s},b_{s})+\frac{1}{2}P%
_{\text{CTW}}(x_{1:n}^{0s})P_{\text{CTW}}(x_{1:n}^{1s})
P_{\text{CTW}}(x_{1:n}^{s})=P_{\text{KT}}(a_{s},b_{s})
\ell(s)=D
P_{\text{CTW}}(x_{1:n})\equiv P_{\text{CTW}}(x_{1:n}^{\epsilon})
O(nD)
P_{\text{CTW}}(x_{1:n})
n\to n+1
O(D)
\leq d
<d
\leq d
F(d)=\frac{1}{2}+\frac{1}{2}F(d-1)^{2}
F(0)=\frac{1}{2}
d
P(d)=F(d)-F(d-1)
d<D
P(D)=1-F(D-1)
P(0)=\frac{1}{2}
P(1)=\frac{1}{8}
P(2)=\frac{9}{128}
d
d
\frac{1}{2}
d+1
E(d)
d<D
E(0)=\frac{1}{2}
E(d)=\frac{1}{2}
d<D
E(D)=1
E_{+}=\frac{1}{2}D+1
N=10^{\prime}000
5^{\prime}000
d<D
d
\alpha_{d}\in[0;1]
\frac{1}{2}
E(d)=2\alpha_{0}\cdot...\cdot 2\alpha_{d-1}(1-\alpha_{d})
d<D
\alpha_{d}>\frac{1}{2}
D
\dagger
\star
\circ
\times
\dagger
\star
\circ
\times
aabba
1+2-4
4
aaabba
011210
2
abbaa
a
abba
aabba
abbaa
-(1-2)\cdot(4-3\cdot(-2))
0
-(x-2)\cdot(4-3\cdot(-2))
1
abaab
abaababaab
10011021
0
aaabaa
aaaaba
10010+101
10111
10010*101
1001000
100010
110
421302214
011222344
\mathcal{P}^{\prime\prime}
T
T
t+k
t
k
n
n
n
n
5000
5000
Q
Q
Q
Q
Q(p_{t})
Q(p_{t}|p_{t-1})
Q(p_{t}|p_{t-2}p_{t-1})
p_{\cdot}\in\{\texttt{<>+-[]\{.}\}
p_{t-1}
p_{t-2}p_{t-1}
Q(p_{1}|p_{0}\!\!:=\!\!\texttt{\_})
Q(p_{1}|p_{-1}p_{0}\!\!:=\!\!\texttt{\_\_})
p_{t}
Q
k
Q(\texttt{.})
Q(\texttt{<})\approx Q(\texttt{>})\approx Q(\texttt{+})\approx Q(\texttt{-})%
\approx 1/7
0
Q
Q
Q
Q
Q(p_{t})
Q(p_{t}|p_{t-1})
Q(p_{t}|p_{t-2}p_{t-1})
p_{\cdot}\in\{\texttt{<>+-[]\{.}\}
p_{t-1}
p_{t-2}p_{t-1}
Q(p_{1}|p_{0}\!\!:=\!\!\texttt{\_})
Q(p_{1}|p_{-1}p_{0}\!\!:=\!\!\texttt{\_\_})
p_{t}
Q
k
Q(\texttt{.})
Q(\texttt{<})\approx Q(\texttt{>})\approx Q(\texttt{+})\approx Q(\texttt{-})%
\approx 1/7
0
q
\tilde{q}
\hat{Q}=(q^{1},\dots,q^{J})
(U(q^{1})_{1:256},\dots,U(q^{J})_{1:256})
\displaystyle\text{Loss}(M_{U},\hat{Q})=\sum_{q\in\hat{Q}}-\log\sum_{p:U(p)_{1%
:256}=U(q)_{1:256}}7^{-\ell(p)}\leq\sum_{q\in\hat{Q}}-\log 7^{-\ell(\tilde{q})%
}=\log(7)\sum_{q\in\hat{Q}}\ell(\tilde{q})
\displaystyle\text{Loss}(M_{U},\hat{Q})=\sum_{q\in\hat{Q}}-\log\sum_{p:U(p)_{1%
:256}=U(q)_{1:256}}7^{-\ell(p)}\leq\sum_{q\in\hat{Q}}-\log 7^{-\ell(\tilde{q})%
}=\log(7)\sum_{q\in\hat{Q}}\ell(\tilde{q})
7
11
11
6
\geq 11
6
\geq 11
6
400
6
400
6
256
6
256
256
6
1024
256
256
6
1024
256
