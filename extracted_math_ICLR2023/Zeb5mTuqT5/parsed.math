\dagger
M=(\mathcal{S},\mathcal{A},T,r,\rho_{0},\gamma)
\mathcal{S}
\mathcal{A}
T(s^{\prime}|s,a)
\rho_{0}(s)
r(s,a)\in[0,R_{\max}]
\gamma\in(0,1)
\pi^{*}(a|s)
\arg\max\limits_{\pi}J_{M}(\pi):=\mathop{\mathbb{E}}\limits_{\pi,T,\rho_{0}}%
\left[\sum_{t=0}^{\infty}\gamma^{t}r\left(s_{t},a_{t}\right)\right]\,.
(s,a)
Q^{\pi}(s,a)
\mathop{\mathbb{E}}_{\pi,T}[\sum_{t=0}^{\infty}\gamma^{t}r(s_{t},a_{t})|s_{0}=%
s,a_{0}=a]
(s,a)
V^{\pi}(s)
\mathop{\mathbb{E}}_{\pi,T}[\sum_{t=0}^{\infty}\gamma^{t}r(s_{t},a_{t})|s_{0}=s]
\pi
s
\pi
M
d^{\pi}_{M}(s):=(1-\gamma)\sum_{t=0}^{\infty}\gamma^{t}\mathcal{P}(s_{t}=s|\pi)
\mathcal{P}(s_{t}=s|\pi)
s
t
\pi
M
d^{\pi}_{M}(s,a):=d^{\pi}_{M}(s)\pi(a|s)
\widehat{M}=(\mathcal{S},\mathcal{A},\widehat{T},\hat{r},\rho_{0},\gamma)
\widehat{M}
\hat{\pi}=\arg\max_{\pi}J_{\widehat{M}}(\pi)
\mathcal{D}_{\text{env}}=\{(s,a,r,s^{\prime})\}
\pi_{\beta}
\widehat{Q}^{\pi}
\widehat{M}
\pi
\widehat{Q}^{\pi}(s_{0},a_{0})=\mathop{\mathbb{E}}\limits_{s_{1}\sim\widehat{T%
},a_{1}\sim\pi}\left[\hat{r}(s_{0},a_{0})+\gamma\widehat{Q}^{\pi}(s_{1},a_{1})%
\right]\,.
\epsilon_{m}
\epsilon_{\pi}
\epsilon_{m}=\mathbb{E}_{\mathcal{D}}\mathbb{E}_{s,a\sim\mathcal{D}}\left[D_{%
\textnormal{TV}}(T(\cdot|s,a),\widehat{T}(\cdot|s,a))\right]
\epsilon_{\pi}=\mathbb{E}_{\mathcal{D}}\mathbb{E}_{s\sim\mathcal{D}}\Big{[}D_{%
\textnormal{TV}}(\pi(\cdot|s),\pi_{\beta}(\cdot|s))\Big{]}
\mathbb{E}_{\mathcal{D}}
\mathcal{D}
\mathbb{E}_{\mathcal{D}}\mathbb{E}_{s,a\sim\mathcal{D}}\left|Q^{\pi}(s,a)-%
\widehat{Q}^{\pi}(s,a)\right|\leq\frac{2\gamma R_{\max}(2\epsilon_{\pi}+%
\epsilon_{m})}{(1-\gamma)^{2}}+\frac{4R_{\max}\epsilon_{\pi}}{1-\gamma}\,.
\frac{1}{1-\gamma}
\gamma
1
\epsilon_{m}
\epsilon_{\pi}
\epsilon_{\pi}
\{s_{t},a_{t}\}_{t=0}^{H+1}\sim\mathcal{D}
\widetilde{Q}^{\pi}(s_{0},a_{0})=\mathop{\mathbb{E}}_{\begin{subarray}{c}s_{t}%
,a_{t}\sim\mathcal{D},\\
a_{H+1}\sim\pi(s_{H+1})\end{subarray}}\left[\sum_{t=0}^{H}\gamma^{t}r(s_{t},a_%
{t})+\gamma^{H+1}\widehat{Q}^{\pi}(s_{H+1},a_{H+1})\right]\,.
\widetilde{Q}^{\pi}
J_{\mathcal{D}}(s_{0},a_{0},H):=\mathbb{E}_{s_{t},a_{t}\sim\mathcal{D}}\left[%
\sum_{t=0}^{H}\gamma^{t}r(s_{t},a_{t})\right]
J_{\pi}(s_{0},a_{0},H):=\mathbb{E}_{s_{t},a_{t}\sim d_{M}^{\pi}(s,a)}\left[%
\sum_{t=0}^{H}\gamma^{t}r(s_{t},a_{t})\right]
\displaystyle\mathbb{E}_{\mathcal{D}}\mathbb{E}_{s,a\sim\mathcal{D}}\left|Q^{%
\pi}(s,a)-\widetilde{Q}^{\pi}(s,a)\right|\leq\sqrt{\mathbb{V}(J_{\mathcal{D}}(%
s,a,H))}+f(H)R_{\max}\epsilon_{\pi}+\gamma^{H+1}\epsilon_{M,\widehat{M}}\,,
\displaystyle\mathbb{E}_{\mathcal{D}}\mathbb{E}_{s,a\sim\mathcal{D}}\left|Q^{%
\pi}(s,a)-\widetilde{Q}^{\pi}(s,a)\right|
\displaystyle\leq\sqrt{\mathbb{V}(J_{\mathcal{D}}(s,a,H))}+f(H)R_{\max}%
\epsilon_{\pi}+\gamma^{H+1}\epsilon_{M,\widehat{M}}\,,
f(H)=\left(\frac{1-\gamma^{H+1}}{(1-\gamma)^{2}}-\frac{(H+1)\gamma^{H+1}}{1-%
\gamma}\right)
\epsilon_{M,\widehat{M}}=\bigg{(}\frac{2\gamma R_{\max}(2\epsilon_{\pi}+%
\epsilon_{m})}{(1-\gamma)^{2}}+\frac{4R_{\max}\epsilon_{\pi}}{1-\gamma}\bigg{)}
\mathbb{V}(J_{\mathcal{D}}(s,a,H))
n
\mathcal{D}
(s,a)
\mathbb{V}(J_{\mathcal{D}}(s,a,H))=\frac{1}{n}\left(\textnormal{Var}(\text{rew%
})+\textnormal{Var}(\text{trans}))\right)\,,
\left\{\begin{aligned} \textnormal{Var}(rew)&=\Sigma_{t=0}^{H}\mathbb{E}\left[%
\gamma^{2t}\mathbb{V}_{t+1}[r(s_{t},a_{t})|s_{t}]|s_{0}=s,a_{0}=a\right]\\
\textnormal{Var}(trans)&=\Sigma_{t=1}^{H}\mathbb{E}\left[\gamma^{2t}\mathbb{V}%
_{t}(J_{\pi}(s_{t},a_{t},H-t))|s_{0}=s,a_{0}=a\right]\end{aligned}\right.
\mathbb{V}_{t}
t
\mathbb{V}[\cdot|s_{0},a_{0},s_{1},\dots,s_{t-1},a_{t-1}]
H
H=-1
H\to\infty
H
R_{\max}=1
\gamma=0.9
\pi
\hat{M}
\epsilon_{\pi}=0.1
\epsilon_{m}=0.05
H=5
\mathbb{V}(J_{\mathcal{D}}(s,a,H))
n=9
\mathbb{V}(J_{\mathcal{D}}(s,a,5))\leq 1.723
\displaystyle\widetilde{Q}^{\pi}(s_{0},a_{0})=\mathop{\mathbb{E}}_{\begin{%
subarray}{c}s_{t},a_{t}\sim\mathcal{D},\\
a_{H+1}\sim\pi(s_{H+1})\end{subarray}}\left[\sum_{t=0}^{H}\rho_{1:t}\gamma^{t}%
r(s_{t},a_{t})+\gamma^{H+1}\widehat{Q}^{\pi}(s_{H+1},a_{H+1}))\right]\,,
\displaystyle\widetilde{Q}^{\pi}(s_{0},a_{0})=\mathop{\mathbb{E}}_{\begin{%
subarray}{c}s_{t},a_{t}\sim\mathcal{D},\\
a_{H+1}\sim\pi(s_{H+1})\end{subarray}}\left[\sum_{t=0}^{H}\rho_{1:t}\gamma^{t}%
r(s_{t},a_{t})+\gamma^{H+1}\widehat{Q}^{\pi}(s_{H+1},a_{H+1}))\right]\,,
\rho_{1:t}=\rho_{1}\rho_{2}\cdots\rho_{t}
t>0
\rho_{1:0}=1
\rho_{t}=\frac{\pi(a_{t}|s_{t})}{\pi_{\beta}(a_{t}|s_{t})}
f(H)R_{\max}\epsilon_{\pi}
\mathbb{V}(J^{\textnormal{IS}}_{\mathcal{D}}(s,a,H))
J^{\textnormal{IS}}_{\mathcal{D}}(s,a,H):=\mathbb{E}_{s_{t},a_{t}\sim\mathcal{%
D}}\left[\sum_{t=0}^{H}\rho_{1:t}\gamma^{t}r(s_{t},a_{t})\right]
\rho_{1:t}
\mathbb{V}(J^{\textnormal{IS}}_{\mathcal{D}}(s,a,H))=\frac{1}{n}\left(%
\textnormal{Var}_{\textnormal{IS}}(\text{rew})+\textnormal{Var}_{\textnormal{%
IS}}(\text{trans}))\right)\,,
\left\{\begin{aligned} \textnormal{Var}_{\textnormal{IS}}(\text{rew})&=\Sigma_%
{t=0}^{H}\mathbb{E}\left[\rho^{2}_{1:t}\gamma^{2t}\mathbb{V}_{t+1}[r(s_{t},a_{%
t})|s_{t}]|s_{0}=s,a_{0}=a\right]\\
\textnormal{Var}_{\textnormal{IS}}(\text{trans})&=\Sigma_{t=1}^{H}\mathbb{E}%
\left[\rho^{2}_{1:t}\gamma^{2t}\mathbb{V}_{t}(J_{\pi}(s_{t},a_{t},H-t))|s_{0}=%
s,a_{0}=a\right]\end{aligned}\right.
\rho_{1:t}
\rho_{1:t}
H
\pi_{\beta}(\mathbf{a|s})
\rho_{1:t}
\epsilon_{\pi}
\theta_{b}^{*}=\arg\max_{\theta_{b}}\mathbb{E}_{(s,a)\sim\mathcal{D}_{\text{%
env}}}\Big{[}\log\pi_{\theta_{b}}(a|s)\Big{]}\,,
\theta_{b}
\widehat{T}_{\psi}(s_{t+1}|s_{t},a_{t})=\mathcal{N}(\mu_{\psi}(s_{t},a_{t}),%
\Sigma_{\psi}(s_{t},a_{t}))
\psi^{*}=\arg\max_{\psi}\mathbb{E}_{(s,a,s^{\prime})\sim\mathcal{D}_{\text{env%
}}}[\log\widehat{T}_{\psi}(s^{\prime}|s,a)]\,.
r
\rho_{1:t}
(1-\epsilon,1+\epsilon)
1
\epsilon
\epsilon
\mathbb{V}(\bar{J}^{\textnormal{IS}}_{\mathcal{D}}(s,a,H)
\epsilon^{\prime}_{\pi}
\sqrt{\mathbb{V}(\bar{J}^{\textnormal{IS}}_{\mathcal{D}}(s,a,H))}+f(H)R_{\max}%
\epsilon^{\prime}_{\pi}+\gamma^{H+1}\epsilon_{M,\widehat{M}}
\epsilon
\epsilon
0.1
H
H
H
H
H
H
H_{b}=\operatorname*{arg\,min}_{H}\sqrt{\mathbb{V}(\bar{J}^{\textnormal{IS}}_{%
\mathcal{D}}(s,a,H))}+f(H)R_{\max}\epsilon^{\prime}_{\pi}+\gamma^{H+1}\epsilon%
_{M,\widehat{M}}\,.
H
H
-1
H
H
-1
H
\mathbb{V}(\bar{J}^{\textnormal{IS}}_{\mathcal{D}}(s,a,H))
\epsilon^{\prime}_{\pi}
\epsilon_{M,\widehat{M}}
\epsilon_{M,\widehat{M}}
\epsilon_{\pi}
\epsilon_{m}
H_{b}
H_{b}
H_{b}
\mathbb{V}(\bar{J}^{\textnormal{IS}}_{\mathcal{D}}(s,a,H))
(1+\epsilon)^{2}\sum_{t=0}^{H}\gamma^{2t}R_{\max}^{2}/4
\epsilon^{\prime}_{\pi}
\epsilon_{\pi}
\pi_{\beta}
\pi
\epsilon_{\pi}
\mathcal{D}
\epsilon_{m}
M
H
H
H
H=-1
J(\pi)=\mathbb{E}_{s\sim\rho_{0},a\sim\pi}\left[Q^{\pi}(s,a)\right]
\rho_{0}
f(H)R_{\max}\epsilon^{\prime}_{\pi}
\gamma^{H+1}\epsilon_{M,\widehat{M}}
\epsilon_{\pi}
\displaystyle\pi=\operatorname*{arg\,max}_{\pi}\mathbb{E}_{s\sim\mathcal{D}_{%
\text{mix}},a\sim\pi(\cdot|s)}\Big{[}Q^{\pi}(s,a)\Big{]}\,,\ \text{s.t.}\ \ %
\mathbb{E}_{s\sim\mathcal{D}_{\text{mix}}}\Big{[}D_{\text{KL}}\left(\pi(\cdot|%
s)||\pi_{\beta}(\cdot|s)\right)\Big{]}\leq\delta\,.
\displaystyle\pi
\displaystyle=\operatorname*{arg\,max}_{\pi}\mathbb{E}_{s\sim\mathcal{D}_{%
\text{mix}},a\sim\pi(\cdot|s)}\Big{[}Q^{\pi}(s,a)\Big{]}\,,\ \text{s.t.}\ \ %
\mathbb{E}_{s\sim\mathcal{D}_{\text{mix}}}\Big{[}D_{\text{KL}}\left(\pi(\cdot|%
s)||\pi_{\beta}(\cdot|s)\right)\Big{]}\leq\delta\,.
\mathcal{D}_{\text{mix}}
\mathcal{D}_{\text{mix}}:=\alpha\mathcal{D}_{\text{env}}+(1-\alpha)\mathcal{D}%
_{\text{model}}
\alpha\in[0,1]
D_{\text{KL}}\left(\pi||\pi_{\beta}\right)
D_{\textnormal{TV}}^{2}(p,q)\leq 2D_{\textnormal{KL}}(p,q)
\theta
\beta
\displaystyle\max_{\theta}\min_{\beta}\mathbb{E}_{s\sim\mathcal{D}_{\text{mix}%
},a\sim\pi_{\theta}(\cdot|s)}\Big{[}Q(s,a)+\beta(\delta-D_{\text{KL}}\left(\pi%
_{\theta}(\cdot|s)||\pi_{\beta}(\cdot|s)\right))\Big{]}\,.
\displaystyle\max_{\theta}\min_{\beta}\mathbb{E}_{s\sim\mathcal{D}_{\text{mix}%
},a\sim\pi_{\theta}(\cdot|s)}\Big{[}
\displaystyle Q(s,a)+\beta(\delta-D_{\text{KL}}\left(\pi_{\theta}(\cdot|s)||%
\pi_{\beta}(\cdot|s)\right))\Big{]}\,.
\mathbb{V}(\bar{J}^{\textnormal{IS}}_{\mathcal{D}}(s,H))
\pi
\mathbb{E}_{s\sim\mathcal{D}_{\text{mix}}}\left[D_{\textnormal{KL}}\left(\pi(%
\cdot|s)||\pi_{\beta}(\cdot|s)\right)\right]\leq\delta
c=\max_{s,a}\left\|\frac{\pi(a|s)}{\pi_{\beta}(a|s)}\right\|_{\infty}\leq\infty
\mathbb{E}_{s\sim\mathcal{D}_{\text{mix}}}\mathbb{E}_{a\sim\pi_{\beta}(\cdot|s%
_{t})}\rho_{t}^{2}\leq c\delta+1
H
\mathcal{D}
\{\pi_{1},\pi_{2},...,\pi_{N}\}
\{\hat{V}_{1},\hat{V}_{2},...,\hat{V}_{N}\}
\{V_{1},V_{2},...,V_{N}\}
1
7
12
5
H
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
H
H
H
-1
H
H
-1
H
H
H
H
2
\mathbb{V}(\bar{J}^{\textnormal{IS}}_{\mathcal{D}}(s,a,H))
H
H
-1
H
0
H
2
H
9
H
H
k
k
\pm
k
k
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
J_{\pi}(s_{w},a_{w},H)=\mathbb{E}_{\pi}[\sum_{t=0}^{H}\gamma^{t}r(s_{t},a_{t})%
|s_{0}=s_{w},a_{0}=a_{w}]
\mathbb{E}_{\mathcal{D}}\left|J_{\pi}(s_{w},a_{w},H)-J_{\pi_{\beta}}(s_{w},a_{%
w},H)\right|\leq\left(\frac{1-\gamma^{H+1}}{(1-\gamma)^{2}}-\frac{(H+1)\gamma^%
{H+1}}{1-\gamma}\right)R_{\max}\epsilon_{\pi}
d_{t,w}(s)
t
(s_{w},a_{w})
\pi
d^{\beta}_{t,w}(s)
t
(s_{w},a_{w})
\pi_{\beta}
d^{\prime}_{t,w}(s)
t
\pi_{\beta}
(s_{w},a_{w})
\pi_{\beta}
\pi
d^{\beta}_{t,w}(s)=p_{t-1}d_{t,w}(s)+(1-p_{t-1})d^{\prime}_{t,w}(s),
p_{t-1}
\pi_{\beta}
\pi
t-1
\pi(\cdot|s)
\pi(s)
\mathbb{E}_{\mathcal{D}}\mathbb{E}_{s\sim\mathcal{D}}
\mathbb{E}_{s,\mathcal{D}}
\displaystyle\quad\ \mathbb{E}_{s,\mathcal{D}}\textnormal{Pr}(\pi(s)=\pi_{%
\beta}(s))
\displaystyle\quad\ \mathbb{E}_{s,\mathcal{D}}\textnormal{Pr}(\pi(s)=\pi_{%
\beta}(s))
\displaystyle=\mathbb{E}_{s,\mathcal{D}}\int\min(\pi(a|s),\pi_{\beta}(a|s))da
\displaystyle=\mathbb{E}_{s,\mathcal{D}}\int\min(\pi(a|s),\pi_{\beta}(a|s))da
\displaystyle=\mathbb{E}_{s,\mathcal{D}}\bigg{(}\int\pi(a|s)da-\int\big{(}\pi(%
a|s)-\min(\pi(a|s),\pi_{\beta}(a|s))\big{)}da\bigg{)}
\displaystyle=\mathbb{E}_{s,\mathcal{D}}\bigg{(}\int\pi(a|s)da-\int\big{(}\pi(%
a|s)-\min(\pi(a|s),\pi_{\beta}(a|s))\big{)}da\bigg{)}
\displaystyle=\mathbb{E}_{s,\mathcal{D}}\Big{(}1-D_{\textnormal{TV}}(\pi(s),%
\pi_{\beta}(s))\Big{)}
\displaystyle=\mathbb{E}_{s,\mathcal{D}}\Big{(}1-D_{\textnormal{TV}}(\pi(s),%
\pi_{\beta}(s))\Big{)}
\displaystyle=1-\epsilon_{\pi}
\displaystyle=1-\epsilon_{\pi}
p=\mathbb{E}_{s,\mathcal{D}}\textnormal{Pr}(\pi(s)=\pi_{\beta}(s))
\displaystyle p_{t}\geq p_{t-1}p\geq p^{t}
\displaystyle p_{t}\geq p_{t-1}p\geq p^{t}
\displaystyle\mathbb{E}_{s,\mathcal{D}}\left|d^{\beta}_{t,w}(s)-d_{t,w}(s)%
\right|=\mathbb{E}_{s,\mathcal{D}}(1-p_{t-1})\left|d^{\prime}_{t,w}(s)-d_{t,w}%
(s)\right|
\displaystyle\mathbb{E}_{s,\mathcal{D}}\left|d^{\beta}_{t,w}(s)-d_{t,w}(s)\right|
\displaystyle=\mathbb{E}_{s,\mathcal{D}}(1-p_{t-1})\left|d^{\prime}_{t,w}(s)-d%
_{t,w}(s)\right|
\displaystyle\leq\mathbb{E}_{s,\mathcal{D}}(1-p_{t-1})\leq 1-p^{t}
\displaystyle\leq\mathbb{E}_{s,\mathcal{D}}(1-p_{t-1})\leq 1-p^{t}
\mathbb{E}_{\mathcal{D}}\left|J_{\pi_{\beta}}(s_{w},a_{w},H)-J_{\pi}(s_{w},a_{%
w},H)\right|
\displaystyle\quad\ \mathbb{E}_{\mathcal{D}}\left|J_{\pi_{\beta}}(s_{w},a_{w},%
H)-J_{\pi}(s_{w},a_{w},H)\right|
\displaystyle\quad\ \mathbb{E}_{\mathcal{D}}\left|J_{\pi_{\beta}}(s_{w},a_{w},%
H)-J_{\pi}(s_{w},a_{w},H)\right|
\displaystyle=\mathbb{E}_{\mathcal{D}}\left|\mathbb{E}_{s_{t}\sim d^{\beta}_{t%
},a_{t}\sim\pi_{\beta}s^{\prime}_{t}\sim d_{t},a^{\prime}_{t}\sim\pi}\sum_{t=0%
}^{H}\gamma^{t}\left(r(s_{t},a_{t})-r(s^{\prime}_{t},a^{\prime}_{t})\right)\right|
\displaystyle=\mathbb{E}_{\mathcal{D}}\left|\mathbb{E}_{s_{t}\sim d^{\beta}_{t%
},a_{t}\sim\pi_{\beta}s^{\prime}_{t}\sim d_{t},a^{\prime}_{t}\sim\pi}\sum_{t=0%
}^{H}\gamma^{t}\left(r(s_{t},a_{t})-r(s^{\prime}_{t},a^{\prime}_{t})\right)\right|
\displaystyle=\left|\sum_{t=0}^{H}\gamma^{t}\int(d^{\beta}_{t,w}(s)\pi_{\beta}%
(a|s)-d_{t,w}(s)\pi(a|s))r(s,a)dsda\right|
\displaystyle=\left|\sum_{t=0}^{H}\gamma^{t}\int(d^{\beta}_{t,w}(s)\pi_{\beta}%
(a|s)-d_{t,w}(s)\pi(a|s))r(s,a)dsda\right|
\displaystyle\leq\sum_{t=0}^{H}\gamma^{t}\int\left|d^{\beta}_{t,w}(s)\pi_{%
\beta}(a|s)-d_{t,w}(s)\pi(a|s)\right|r(s,a)dsda
\displaystyle\leq\sum_{t=0}^{H}\gamma^{t}\int\left|d^{\beta}_{t,w}(s)\pi_{%
\beta}(a|s)-d_{t,w}(s)\pi(a|s)\right|r(s,a)dsda
\displaystyle\quad\ \sum_{t=0}^{H}\gamma^{t}\int\left|d^{\beta}_{t,w}(s)\pi_{%
\beta}(a|s)-d_{t,w}(s)\pi(a|s)\right|r(s,a)dsda
\displaystyle\quad\ \sum_{t=0}^{H}\gamma^{t}\int\left|d^{\beta}_{t,w}(s)\pi_{%
\beta}(a|s)-d_{t,w}(s)\pi(a|s)\right|r(s,a)dsda
\displaystyle\leq\sum_{t=0}^{H}\gamma^{t}\int\bigg{(}\left|d^{\beta}_{t,w}(s)-%
d_{t,w}(s)\right|\pi(a|s)+\left|\pi(a|s)-\pi_{\beta}(a|s)\right|d^{\beta}_{t,s%
_{w}}(s)\bigg{)}r(s,a)dsda
\displaystyle\leq\sum_{t=0}^{H}\gamma^{t}\int\bigg{(}\left|d^{\beta}_{t,w}(s)-%
d_{t,w}(s)\right|\pi(a|s)+\left|\pi(a|s)-\pi_{\beta}(a|s)\right|d^{\beta}_{t,s%
_{w}}(s)\bigg{)}r(s,a)dsda
\displaystyle\leq\sum_{t=0}^{H}\gamma^{t}R_{\max}\int\bigg{(}\left|d^{\beta}_{%
t,s_{w}}(s)-d_{t,s_{w}}(s)\right|+\left|\pi(a|s)-\pi_{\beta}(a|s)\right|\bigg{%
)}dsda
\displaystyle\leq\sum_{t=0}^{H}\gamma^{t}R_{\max}\int\bigg{(}\left|d^{\beta}_{%
t,s_{w}}(s)-d_{t,s_{w}}(s)\right|+\left|\pi(a|s)-\pi_{\beta}(a|s)\right|\bigg{%
)}dsda
\displaystyle\quad\ \mathbb{E}_{\mathcal{D}}\left|J_{\pi_{\beta}}(s_{w},a_{w},%
H)-J_{\pi}(s_{w},a_{w},H)\right|
\displaystyle\quad\ \mathbb{E}_{\mathcal{D}}\left|J_{\pi_{\beta}}(s_{w},a_{w},%
H)-J_{\pi}(s_{w},a_{w},H)\right|
\displaystyle\leq R_{\max}\sum_{t=0}^{H}\gamma^{t}\Big{(}(1-p^{t})+\epsilon_{%
\pi}\Big{)}
\displaystyle\leq R_{\max}\sum_{t=0}^{H}\gamma^{t}\Big{(}(1-p^{t})+\epsilon_{%
\pi}\Big{)}
\displaystyle\leq R_{\max}\sum_{t=0}^{H}\gamma^{t}\Big{(}1-(1-\epsilon_{\pi})^%
{t}+\epsilon_{\pi}\Big{)}
\displaystyle\leq R_{\max}\sum_{t=0}^{H}\gamma^{t}\Big{(}1-(1-\epsilon_{\pi})^%
{t}+\epsilon_{\pi}\Big{)}
\displaystyle\leq R_{\max}\sum_{t=0}^{H}\gamma^{t}t\epsilon_{\pi}
\displaystyle\leq R_{\max}\sum_{t=0}^{H}\gamma^{t}t\epsilon_{\pi}
\displaystyle=\left(\frac{1-\gamma^{H+1}}{(1-\gamma)^{2}}-\frac{(H+1)\gamma^{H%
+1}}{1-\gamma}\right)R_{\max}\epsilon_{\pi}
\displaystyle=\left(\frac{1-\gamma^{H+1}}{(1-\gamma)^{2}}-\frac{(H+1)\gamma^{H%
+1}}{1-\gamma}\right)R_{\max}\epsilon_{\pi}
\mathbb{E}_{\mathcal{D}}\left|J_{\pi}(s_{w},a_{w},H)-J_{\pi_{\beta}}(s_{w},a_{%
w},H)\right|\leq\left(\frac{1-\gamma^{H+1}}{(1-\gamma)^{2}}-\frac{(H+1)\gamma^%
{H+1}}{1-\gamma}\right)R_{\max}\epsilon_{\pi}
J_{\mathcal{D}}(s_{w},a_{w},H)=\mathbb{E}_{s_{t},a_{t}\sim\mathcal{D}}[\sum_{t%
=0}^{H}\gamma^{t}r(s_{t},a_{t})|s_{0}=s_{w}]
\mathbb{E}_{\mathcal{D}}\left|J_{\pi_{\beta}}(s_{w},a_{w},H)-J_{\mathcal{D}}(s%
_{w},a_{w},H)\right|\leq\sqrt{\mathbb{V}(J_{\mathcal{D}}(s_{w},a_{w},H))}
\mathbb{E}_{\mathcal{D}}J_{\mathcal{D}}(s_{w},a_{w},H)=J_{\pi_{\beta}}(s_{w},a%
_{w},H)
\displaystyle\quad\ \mathbb{E}_{\mathcal{D}}\left|J_{\pi_{\beta}}(s_{w},a_{w},%
H)-J_{\mathcal{D}}(s_{w},a_{w},H)\right|^{2}
\displaystyle\quad\ \mathbb{E}_{\mathcal{D}}\left|J_{\pi_{\beta}}(s_{w},a_{w},%
H)-J_{\mathcal{D}}(s_{w},a_{w},H)\right|^{2}
\displaystyle=(J_{\pi_{\beta}}(s_{w},a_{w},H)-\mathbb{E}_{\mathcal{D}}J_{%
\mathcal{D}}(s_{w},a_{w},H))^{2}+\mathbb{V}(J_{\mathcal{D}}(s_{w},a_{w},H))
\displaystyle=(J_{\pi_{\beta}}(s_{w},a_{w},H)-\mathbb{E}_{\mathcal{D}}J_{%
\mathcal{D}}(s_{w},a_{w},H))^{2}+\mathbb{V}(J_{\mathcal{D}}(s_{w},a_{w},H))
\displaystyle=\mathbb{V}(J_{\mathcal{D}}(s_{w},a_{w},H))
\displaystyle=\mathbb{V}(J_{\mathcal{D}}(s_{w},a_{w},H))
\left(\mathbb{E}_{\mathcal{D}}\left|J_{\pi_{\beta}}(s_{w},a_{w},H)-J_{\mathcal%
{D}}(s_{w},a_{w},H)\right|\right)^{2}\leq\mathbb{E}_{\mathcal{D}}\left|J_{\pi_%
{\beta}}(s_{w},a_{w},)-J_{\mathcal{D}}(s_{w},a_{w},H)\right|^{2}
Q^{\pi}(s,a)=J_{\pi}(s,a,H)+\gamma^{H+1}\mathbb{E}_{s^{\prime}\sim P^{\pi}_{H+%
1}(s,a),a^{\prime}\sim\pi}Q^{\pi}(s^{\prime},a^{\prime})\,,
\widehat{Q}^{\pi}(s,a)=J_{\mathcal{D}}(s,a,H)+\gamma^{H+1}\mathbb{E}_{s^{%
\prime}\sim P^{\pi}_{H+1}(s,a),a^{\prime}\sim\pi}Q^{\pi}_{\widehat{M}}(s^{%
\prime},a^{\prime})\,,
P^{\pi}_{H+1}(s,a)
(s,a)
\pi
H
\displaystyle\quad\ \mathbb{E}_{\mathcal{D}}\left|Q^{\pi}(s,a)-\widehat{Q}^{%
\pi}(s,a)\right|
\displaystyle\quad\ \mathbb{E}_{\mathcal{D}}\left|Q^{\pi}(s,a)-\widehat{Q}^{%
\pi}(s,a)\right|
\displaystyle\overset{(a)}{\leq}\mathbb{E}_{\mathcal{D}}\left|J_{\pi}(s,a,H)-J%
_{\mathcal{D}}(s,a,H)\right|+\mathbb{E}_{\mathcal{D}}\gamma^{H+1}\left|\mathbb%
{E}_{s^{\prime}\sim P^{\pi}_{H+1}(s,a)}Q^{\pi}(s^{\prime})-\mathbb{E}_{s^{%
\prime}\sim P^{\pi}_{H+1}(s,a)}Q^{\pi}_{M}(s^{\prime})\right|
\displaystyle\overset{(a)}{\leq}\mathbb{E}_{\mathcal{D}}\left|J_{\pi}(s,a,H)-J%
_{\mathcal{D}}(s,a,H)\right|+\mathbb{E}_{\mathcal{D}}\gamma^{H+1}\left|\mathbb%
{E}_{s^{\prime}\sim P^{\pi}_{H+1}(s,a)}Q^{\pi}(s^{\prime})-\mathbb{E}_{s^{%
\prime}\sim P^{\pi}_{H+1}(s,a)}Q^{\pi}_{M}(s^{\prime})\right|
\displaystyle\overset{(b)}{\leq}\sqrt{\mathbb{V}(J_{\mathcal{D}}(s,a,H))}+%
\left(\frac{1-\gamma^{H+1}}{(1-\gamma)^{2}}-\frac{(H+1)\gamma^{H+1}}{1-\gamma}%
\right)R_{\max}\epsilon_{\pi}
\displaystyle\overset{(b)}{\leq}\sqrt{\mathbb{V}(J_{\mathcal{D}}(s,a,H))}+%
\left(\frac{1-\gamma^{H+1}}{(1-\gamma)^{2}}-\frac{(H+1)\gamma^{H+1}}{1-\gamma}%
\right)R_{\max}\epsilon_{\pi}
\displaystyle\qquad\ +\gamma^{H+1}\bigg{(}\frac{2\gamma R_{\max}(2\epsilon_{%
\pi}+\epsilon_{m})}{(1-\gamma)^{2}}+\frac{4R_{\max}\epsilon_{\pi}}{1-\gamma}%
\bigg{)}\,,
\displaystyle\qquad\ +\gamma^{H+1}\bigg{(}\frac{2\gamma R_{\max}(2\epsilon_{%
\pi}+\epsilon_{m})}{(1-\gamma)^{2}}+\frac{4R_{\max}\epsilon_{\pi}}{1-\gamma}%
\bigg{)}\,,
\rho_{0:t}=1
\hat{J}(s_{w},a_{w},H)=\sum_{t=0}^{H}\gamma^{t}\rho_{0:t}r(s_{t},a_{t})
s_{0}=s_{w},a_{0}=a_{w}
\hat{J}(s_{t},a_{t},H-t)=\left(r(s_{t},a_{t})+\gamma\rho_{t+1}\hat{J}(s_{t+1},%
a_{t+1},H-t-1)\right)
\mathbb{E}_{t}[\cdot]:=\mathbb{E}[\cdot|s_{0},a_{0},\dots,s_{t-1},a_{t-1}]
\mathbb{V}_{t}[\cdot]
\displaystyle\mathbb{V}_{t}(\hat{J}(s_{t},a_{t},H-t))=\mathbb{E}_{t}\left[\rho%
_{t}^{2}\mathbb{V}_{t+1}\left[r(s_{t},a_{t})\right]\right]+\mathbb{E}_{t}\left%
[\rho_{t}^{2}\gamma^{2}\mathbb{V}_{t+1}[\hat{J}(s_{t+1},a_{t+1},H-t-1)\right]
\displaystyle\mathbb{V}_{t}(\hat{J}(s_{t},a_{t},H-t))
\displaystyle=\mathbb{E}_{t}\left[\rho_{t}^{2}\mathbb{V}_{t+1}\left[r(s_{t},a_%
{t})\right]\right]+\mathbb{E}_{t}\left[\rho_{t}^{2}\gamma^{2}\mathbb{V}_{t+1}[%
\hat{J}(s_{t+1},a_{t+1},H-t-1)\right]
\displaystyle\quad\ +\mathbb{V}_{t}(J_{\pi}(s_{t},\pi(s_{t}),H-t))
\displaystyle\quad\ +\mathbb{V}_{t}(J_{\pi}(s_{t},\pi(s_{t}),H-t))
\mathbb{V}_{t+1}\left[\hat{J}(s_{t},a_{t},H)\right]=\mathbb{E}_{t+1}\left[\rho%
_{t}^{2}\mathbb{V}_{t+1}\left[r(s_{t},a_{t})\right]\right]+\mathbb{E}_{t+1}%
\left[\rho_{t}^{2}\gamma^{2}\mathbb{V}_{t+1}[\hat{J}_{\mathcal{D}}(s_{t+1},a_{%
t+1},H-t-1)\right]
\displaystyle\quad\ \mathbb{V}_{t}(\hat{J}(s_{t},a_{t},H-t))
\displaystyle\quad\ \mathbb{V}_{t}(\hat{J}(s_{t},a_{t},H-t))
\displaystyle=\mathbb{E}_{t}\left[\hat{J}^{2}(s_{t},a_{t},H-t)\right]-\big{(}%
\mathbb{E}_{t}J_{\pi}(s_{t},\pi_{\beta}(s_{t}),H-t)\big{)}^{2}
\displaystyle=\mathbb{E}_{t}\left[\hat{J}^{2}(s_{t},a_{t},H-t)\right]-\big{(}%
\mathbb{E}_{t}J_{\pi}(s_{t},\pi_{\beta}(s_{t}),H-t)\big{)}^{2}
\displaystyle=\mathbb{E}_{t}\left[\left(r(s_{t},a_{t})+\gamma\rho_{t+1}\hat{J}%
(s_{t+1},a_{t+1},H-t-1)\right)^{2}-J^{2}_{\pi}(s_{t},a_{t},H-t)\right]+\mathbb%
{V}_{t}(J_{\pi}(s_{t},a_{t},H-t))
\displaystyle=\mathbb{E}_{t}\left[\left(r(s_{t},a_{t})+\gamma\rho_{t+1}\hat{J}%
(s_{t+1},a_{t+1},H-t-1)\right)^{2}-J^{2}_{\pi}(s_{t},a_{t},H-t)\right]+\mathbb%
{V}_{t}(J_{\pi}(s_{t},a_{t},H-t))
\displaystyle=\mathbb{E}_{t}\left[\left(J_{\pi}(s_{t},a_{t},H-t)+r(s_{t},a_{t}%
)+\gamma\rho_{t+1}\hat{J}(s_{t+1},a_{t+1},H-t-1)-J_{\pi}(s_{t},a_{t},H-t)%
\right)^{2}\right.
\displaystyle=\mathbb{E}_{t}\left[\left(J_{\pi}(s_{t},a_{t},H-t)+r(s_{t},a_{t}%
)+\gamma\rho_{t+1}\hat{J}(s_{t+1},a_{t+1},H-t-1)-J_{\pi}(s_{t},a_{t},H-t)%
\right)^{2}\right.
\displaystyle\left.\qquad\qquad-J^{2}_{\pi}(s_{t},a_{t},H-t)\right]+\mathbb{V}%
_{t}(J_{\pi}(s_{t},a_{t},H-t))
\displaystyle\left.\qquad\qquad-J^{2}_{\pi}(s_{t},a_{t},H-t)\right]+\mathbb{V}%
_{t}(J_{\pi}(s_{t},a_{t},H-t))
\displaystyle=\mathbb{E}_{t}\left[\left(J_{\pi}(s_{t},a_{t},H-t)+\Big{(}r(s_{t%
},a_{t})-R(s_{t},a_{t})+\gamma\rho_{t+1}\Big{(}\hat{J}(s_{t+1},a_{t+1},H-t-1)%
\right.\right.
\displaystyle=\mathbb{E}_{t}\left[\left(J_{\pi}(s_{t},a_{t},H-t)+\Big{(}r(s_{t%
},a_{t})-R(s_{t},a_{t})+\gamma\rho_{t+1}\Big{(}\hat{J}(s_{t+1},a_{t+1},H-t-1)%
\right.\right.
\displaystyle\left.\left.\qquad\qquad-\mathbb{E}_{t+1}[J_{\pi}(s_{t+1},a_{t+1}%
,H-t-1)]\Big{)}\Big{)}\right)^{2}-J^{2}_{\pi}(s_{t},a_{t},H-t)\right]
\displaystyle\left.\left.\qquad\qquad-\mathbb{E}_{t+1}[J_{\pi}(s_{t+1},a_{t+1}%
,H-t-1)]\Big{)}\Big{)}\right)^{2}-J^{2}_{\pi}(s_{t},a_{t},H-t)\right]
\displaystyle\qquad+\mathbb{V}_{t}(J_{\pi}(s_{t},a_{t},H-t))
\displaystyle\qquad+\mathbb{V}_{t}(J_{\pi}(s_{t},a_{t},H-t))
\displaystyle\overset{(a)}{=}\mathbb{E}_{t}\left[\mathbb{E}\left[J^{2}_{\pi}(s%
_{t},a_{t},H-t)-J^{2}_{\pi}(s_{t},\pi(s_{t}),H-t)|s_{t}\right]\right]+\mathbb{%
E}_{t}\left[\mathbb{E}\left[(r(s_{t},a_{t})-R(s_{t},a_{t}))^{2}|s_{t},a_{t}%
\right]\right]
\displaystyle\overset{(a)}{=}\mathbb{E}_{t}\left[\mathbb{E}\left[J^{2}_{\pi}(s%
_{t},a_{t},H-t)-J^{2}_{\pi}(s_{t},\pi(s_{t}),H-t)|s_{t}\right]\right]+\mathbb{%
E}_{t}\left[\mathbb{E}\left[(r(s_{t},a_{t})-R(s_{t},a_{t}))^{2}|s_{t},a_{t}%
\right]\right]
\displaystyle\qquad+\mathbb{E}_{t}\left[\mathbb{E}\left[\gamma^{2}\rho_{t+1}^{%
2}(\hat{J}(s_{t+1},a_{t+1},H-t-1)-\mathbb{E}_{t+1}J_{\pi}(s_{t+1},a_{t+1},H-t-%
1))^{2}|s_{t},a_{t}\right]\right]
\displaystyle\qquad+\mathbb{E}_{t}\left[\mathbb{E}\left[\gamma^{2}\rho_{t+1}^{%
2}(\hat{J}(s_{t+1},a_{t+1},H-t-1)-\mathbb{E}_{t+1}J_{\pi}(s_{t+1},a_{t+1},H-t-%
1))^{2}|s_{t},a_{t}\right]\right]
\displaystyle\qquad+\mathbb{V}_{t}(J_{\pi}(s_{t},a_{t},H-t))
\displaystyle\qquad+\mathbb{V}_{t}(J_{\pi}(s_{t},a_{t},H-t))
\displaystyle=\mathbb{E}_{t}\left[\mathbb{V}_{t+1}\left[r(s_{t},a_{t})\right]%
\right]+\mathbb{E}_{t}\left[\rho_{t+1}^{2}\gamma^{2}\mathbb{V}_{t+1}[\hat{J}(s%
_{t+1},a_{t+1},H-t-1)\right]+\mathbb{V}_{t}(J_{\pi}(s_{t},a_{t},H-t))
\displaystyle=\mathbb{E}_{t}\left[\mathbb{V}_{t+1}\left[r(s_{t},a_{t})\right]%
\right]+\mathbb{E}_{t}\left[\rho_{t+1}^{2}\gamma^{2}\mathbb{V}_{t+1}[\hat{J}(s%
_{t+1},a_{t+1},H-t-1)\right]+\mathbb{V}_{t}(J_{\pi}(s_{t},a_{t},H-t))
R(s,a)=\mathbb{E}[r(s,a)]
s_{t}
a_{t}
r(s_{t},a_{t})-R(s_{t},a_{t})
\hat{J}(s_{t+1},a_{t+1},H-t-1)-\mathbb{E}_{t+1}J_{\pi}(s_{t+1},a_{t+1},H-t-1)
\displaystyle\quad\ \mathbb{V}_{t+1}\left[\hat{J}(s_{t},a_{t},H)\right]
\displaystyle\quad\ \mathbb{V}_{t+1}\left[\hat{J}(s_{t},a_{t},H)\right]
\displaystyle=\mathbb{E}_{t+1}\left[\hat{J}^{2}(s_{t},a_{t},H-t)\right]-\left(%
\mathbb{E}_{t+1}\left[J_{\pi}(s_{t},a_{t},H-t)\right]\right)^{2}
\displaystyle=\mathbb{E}_{t+1}\left[\hat{J}^{2}(s_{t},a_{t},H-t)\right]-\left(%
\mathbb{E}_{t+1}\left[J_{\pi}(s_{t},a_{t},H-t)\right]\right)^{2}
\displaystyle=\mathbb{E}_{t+1}\left[\mathbb{V}_{t+1}\left[r(s_{t},a_{t})\right%
]\right]+\mathbb{E}_{t+1}\left[\rho_{t+1}^{2}\gamma^{2}\mathbb{V}_{t+1}[\hat{J%
}_{\mathcal{D}}(s_{t+1},a_{t+1},H-t-1)\right]
\displaystyle=\mathbb{E}_{t+1}\left[\mathbb{V}_{t+1}\left[r(s_{t},a_{t})\right%
]\right]+\mathbb{E}_{t+1}\left[\rho_{t+1}^{2}\gamma^{2}\mathbb{V}_{t+1}[\hat{J%
}_{\mathcal{D}}(s_{t+1},a_{t+1},H-t-1)\right]
\displaystyle\quad\ +\mathbb{V}_{t+1}[J_{\pi}(s_{t},a_{t},H-t)]
\displaystyle\quad\ +\mathbb{V}_{t+1}[J_{\pi}(s_{t},a_{t},H-t)]
\displaystyle=\mathbb{E}_{t+1}\left[\mathbb{V}_{t+1}\left[r(s_{t},a_{t})\right%
]\right]+\mathbb{E}_{t+1}\left[\rho_{t+1}^{2}\gamma^{2}\mathbb{V}_{t+1}[\hat{J%
}_{\mathcal{D}}(s_{t+1},a_{t+1},H-t-1)\right]\,.
\displaystyle=\mathbb{E}_{t+1}\left[\mathbb{V}_{t+1}\left[r(s_{t},a_{t})\right%
]\right]+\mathbb{E}_{t+1}\left[\rho_{t+1}^{2}\gamma^{2}\mathbb{V}_{t+1}[\hat{J%
}_{\mathcal{D}}(s_{t+1},a_{t+1},H-t-1)\right]\,.
\mathbb{V}_{t+1}\left[J_{\pi}(s_{t},a_{t},H-t)\right]=0
\displaystyle\quad\ \mathbb{V}(\hat{J}(s_{w},a_{w},H))
\displaystyle\quad\ \mathbb{V}(\hat{J}(s_{w},a_{w},H))
\displaystyle=\mathbb{V}[\hat{J}(s_{0},a_{0},H)|s_{0}=s_{w},a_{0}=a_{w}]
\displaystyle=\mathbb{V}[\hat{J}(s_{0},a_{0},H)|s_{0}=s_{w},a_{0}=a_{w}]
\displaystyle=\mathbb{V}_{1}[\hat{J}(s_{0},a_{0},H)]
\displaystyle=\mathbb{V}_{1}[\hat{J}(s_{0},a_{0},H)]
\displaystyle\overset{(a)}{=}\mathbb{E}_{1}\left[\mathbb{V}_{1}\left[r(s_{0},a%
_{0})\right]\right]+\mathbb{E}_{1}\left[\rho_{1}^{2}\gamma^{2}\mathbb{V}_{1}[%
\hat{J}(s_{1},a_{1},H-1)]\right]
\displaystyle\overset{(a)}{=}\mathbb{E}_{1}\left[\mathbb{V}_{1}\left[r(s_{0},a%
_{0})\right]\right]+\mathbb{E}_{1}\left[\rho_{1}^{2}\gamma^{2}\mathbb{V}_{1}[%
\hat{J}(s_{1},a_{1},H-1)]\right]
\displaystyle\overset{(b)}{=}\sum_{t=0}^{H}\mathbb{E}_{1}\left[\rho^{2}_{1:t}%
\gamma^{2t}\mathbb{V}_{t+1}[r(s_{t},a_{t})]\right]+\sum_{t=1}^{H}\mathbb{E}_{1%
}\left[\rho^{2}_{1:t}\gamma^{2t}\mathbb{V}_{t+1}(J_{\pi}(s_{t+1},a_{t+1},H-t))\right]
\displaystyle\overset{(b)}{=}\sum_{t=0}^{H}\mathbb{E}_{1}\left[\rho^{2}_{1:t}%
\gamma^{2t}\mathbb{V}_{t+1}[r(s_{t},a_{t})]\right]+\sum_{t=1}^{H}\mathbb{E}_{1%
}\left[\rho^{2}_{1:t}\gamma^{2t}\mathbb{V}_{t+1}(J_{\pi}(s_{t+1},a_{t+1},H-t))\right]
\displaystyle=\sum_{t=0}^{H}\mathbb{E}\left[\rho^{2}_{1:t}\gamma^{2t}\mathbb{V%
}_{t+1}[r(s_{t},a_{t})]|s_{0}=s_{w},a_{0}=a_{w}\right]
\displaystyle=\sum_{t=0}^{H}\mathbb{E}\left[\rho^{2}_{1:t}\gamma^{2t}\mathbb{V%
}_{t+1}[r(s_{t},a_{t})]|s_{0}=s_{w},a_{0}=a_{w}\right]
\displaystyle\quad\ +\sum_{t=1}^{H}\mathbb{E}\left[\rho^{2}_{1:t}\gamma^{2t}%
\mathbb{V}_{t+1}(J_{\pi}(s_{t+1},a_{t+1},H-t))|s_{0}=s_{w},a_{0}=a_{w}\right]\,,
\displaystyle\quad\ +\sum_{t=1}^{H}\mathbb{E}\left[\rho^{2}_{1:t}\gamma^{2t}%
\mathbb{V}_{t+1}(J_{\pi}(s_{t+1},a_{t+1},H-t))|s_{0}=s_{w},a_{0}=a_{w}\right]\,,
\rho_{1:0}=1
J_{\mathcal{D}}(s_{w},a_{w},H)
\mathbb{V}(J_{\mathcal{D}}(s_{w},a_{w},H))=\mathbb{V}(\hat{J}(s_{w},a_{w},H))/n
n
\mathcal{D}
(s_{w},a_{w})
\chi^{2}(P,Q)
\chi^{2}(P,Q)=\int\frac{dP^{2}}{dQ}-1
c=\left\|\frac{dP}{dQ}\right\|_{\infty}\leq\infty
cD_{\textnormal{KL}}(P,Q)\geq\chi^{2}(P,Q)
\log x\geq\frac{x-1}{x}
cD_{\textnormal{KL}}(P,Q)\geq\left\|\frac{dP}{dQ}\right\|_{\infty}\int dP\left%
(\frac{dP/dQ-1}{dP/dQ}\right)\geq\chi^{2}(P,Q)
\pi(\cdot|s)
\pi_{\beta}(\cdot|s)
cD_{\textnormal{KL}}(\pi(\cdot|s),\pi_{\beta}(\cdot|s))\geq\chi^{2}(\pi(\cdot|%
s),\pi_{\beta}(\cdot|s))
\displaystyle\chi^{2}(\pi(\cdot|s),\pi_{\beta}(\cdot|s))=\int\left(\frac{\pi^{%
2}(a|s)}{\pi_{\beta}(a|s)}-1\right)da
\displaystyle\chi^{2}(\pi(\cdot|s),\pi_{\beta}(\cdot|s))
\displaystyle=\int\left(\frac{\pi^{2}(a|s)}{\pi_{\beta}(a|s)}-1\right)da
\displaystyle=\int\pi_{\beta}(a|s)\left(\frac{\pi^{2}(a|s)}{\pi^{2}_{\beta}(a|%
s)}\right)da-1
\displaystyle=\int\pi_{\beta}(a|s)\left(\frac{\pi^{2}(a|s)}{\pi^{2}_{\beta}(a|%
s)}\right)da-1
\displaystyle=\mathbb{E}_{a\sim\pi_{\beta}}\left[\frac{\pi^{2}(a|s)}{\pi^{2}_{%
\beta}(a|s)}\right]-1\,,
\displaystyle=\mathbb{E}_{a\sim\pi_{\beta}}\left[\frac{\pi^{2}(a|s)}{\pi^{2}_{%
\beta}(a|s)}\right]-1\,,
cD_{\textnormal{KL}}(P,Q)\geq\mathbb{E}_{a\sim\pi_{\beta}}\left[\rho_{t}^{2}%
\right]-1\,.
\widehat{Q}
\widetilde{Q}
Q_{\phi_{k}}
k
\displaystyle\phi_{k+1}=\phi_{k}-\frac{\eta}{2}\nabla_{\phi}\mathbb{E}_{s,a%
\sim\mathcal{D}_{\text{env}}}\left[\left(Q(s,a)-\text{TIS}^{H}(s,a)\right)^{2}%
\right]\,,
\displaystyle\phi_{k+1}=\phi_{k}-\frac{\eta}{2}\nabla_{\phi}\mathbb{E}_{s,a%
\sim\mathcal{D}_{\text{env}}}\left[\left(Q(s,a)-\text{TIS}^{H}(s,a)\right)^{2}%
\right]\,,
\displaystyle\phi_{k+2}=\phi_{k+1}-\frac{\eta}{2}\nabla_{\phi}\mathbb{E}_{s,a%
\sim\mathcal{D}_{\text{model}}}\left[\left(Q(s,a)-\mathcal{\hat{B}}^{\pi}Q^{k+%
1}(s,a)\right)^{2}\right]\,,
\displaystyle\phi_{k+2}=\phi_{k+1}-\frac{\eta}{2}\nabla_{\phi}\mathbb{E}_{s,a%
\sim\mathcal{D}_{\text{model}}}\left[\left(Q(s,a)-\mathcal{\hat{B}}^{\pi}Q^{k+%
1}(s,a)\right)^{2}\right]\,,
\eta
\text{TIS}^{H}(s_{0},a_{0}):=\sum_{t=0}^{H}\gamma^{t}\rho_{0:t}r(s_{t},a_{t})+%
\gamma^{H+1}Q^{k}(s_{H+1},a_{H+1})
\mathcal{D}_{\text{env}}
Q_{\phi}
\phi
\pi_{\theta}
\theta
h
\alpha
\delta
N_{H}
H
N
\{\hat{T}^{i}_{\psi}(s^{\prime},r|s,a)=\mathcal{N}(\mu^{i}_{\psi}(s,a),\Sigma^%
{i}_{\psi}(s,a))\}_{i=1}^{N}
\mathcal{D}_{\text{env}}
\pi_{\beta}
\pi
\mathcal{D}_{\text{model}}\leftarrow\emptyset
e=1,2,...,
b
s_{1}
\mathcal{D}_{\text{env}}
h
\{\hat{T}\}_{i=1}^{N}
\mathcal{D}_{\text{model}}
Q_{\phi}
\pi_{\theta}
\mathcal{D}_{\text{mix}}
e
N_{H}=0
H
V^{\pi}
\hat{V}^{\pi}
\text{Absolute Error}=\left|V^{\pi}-\hat{V}^{\pi}\right|
\text{Rank Correlation}=\frac{\text{Cov}(V^{\pi}_{1:N},\hat{V}^{\pi}_{1:N})}{%
\sigma(V^{\pi}_{1:N})\sigma(\hat{V}^{\pi}_{1:N})}
\text{Regret@k}=\max_{i\in 1:N}V^{\pi}_{i}-\max_{j\in\text{topk}(1:N)}V^{\pi}_%
{j}
h
h
H
h
h=10
5
h
H_{\max}
H
H
H_{\max}
4
\delta
\epsilon_{\pi}
\alpha
\mathcal{D}_{\text{mix}}
\alpha\in\{0.2,0.5,0.8\}
h
H_{\max}
\delta
\alpha
7
5
256
50000
100
N_{H}
H
200
1.5
10
10
1000
H
H
H=0
H=-1
H
H
H
H
H
H
H
H
