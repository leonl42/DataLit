\ast
\dagger
O(T^{2})
T
O(T)
\text{RLA}_{g}
\bm{X}\in\mathbb{R}^{T\times D_{in}}
T
D_{in}
\bm{O}\in\mathbb{R}^{T\times D_{out}}
T
\bm{Q}
\bm{K}
\bm{V}
\bm{X}
\bm{Q}=\bm{X}\bm{W}_{Q}
\bm{W}_{Q}\in\mathbb{R}^{D_{in}\times D_{k}}
\bm{K}=\bm{X}\bm{W}_{K}
\bm{W}_{K}\in\mathbb{R}^{D_{in}\times D_{k}}
\bm{V}=\bm{X}\bm{W}_{V}
\bm{W}_{V}\in\mathbb{R}^{D_{in}\times D_{out}}
\bm{O}=\text{Self-Attention}(\bm{X}):=\text{softmax}(\frac{\bm{Q}{\bm{K}}^{%
\mathsf{T}}}{\sqrt{D_{k}}})\bm{V}=\bm{A}\bm{V},
\bm{A}=(a_{i,j})
T\times T
\bm{Y}\in\mathbb{R}^{I\times J}
\bm{Y}_{i,:}
\bm{Y}_{:,j}
y_{i,j}
i
j
(i,j)
[T]
T
t\in[T]
D_{in}
D_{out}
\bm{O}_{t,:}=\bm{A}_{t,:}\bm{V}=\sum_{s=1}^{T}a_{t,s}\bm{V}_{s,:}.
\bm{X}^{t}\in\mathbb{R}^{1\times D}
t
t\in[T]
T
\bm{X}^{t}
(\bm{X}^{1},...,\bm{X}^{t})\in\mathbb{R}^{t\times D}
\bm{X}^{s}
D_{in}
D_{out}
D
t
\displaystyle\bm{Q}^{t}=f_{Q}^{t}(\bm{X}^{t})\in\mathbb{R}^{1\times D_{k}},
\displaystyle\bm{Q}^{t}=
\displaystyle f_{Q}^{t}(\bm{X}^{t})\in\mathbb{R}^{1\times D_{k}},
\displaystyle\bm{K}^{t}=\text{Concat}[f_{K}^{t}(\bm{X}^{1}),...,f_{K}^{t}(\bm{%
X}^{t})]\hskip 8.53581pt\text{and}\hskip 8.53581pt\bm{V}^{t}=\text{Concat}[f_{%
V}^{t}(\bm{X}^{1}),...,f_{V}^{t}(\bm{X}^{t})],
\displaystyle\bm{K}^{t}=\text{Concat}[f_{K}^{t}(\bm{X}^{1}),...,f_{K}^{t}(\bm{%
X}^{t})]
\displaystyle\hskip 8.53581pt\text{and}\hskip 8.53581pt\bm{V}^{t}=\text{Concat%
}[f_{V}^{t}(\bm{X}^{1}),...,f_{V}^{t}(\bm{X}^{t})],
\bm{K}^{t}\in\mathbb{R}^{t\times D_{k}}
\bm{V}^{t}\in\mathbb{R}^{t\times D}
f_{Q}^{t}
f_{K}^{t}
f_{V}^{t}
t
t
\bm{O}^{t}\in\mathbb{R}^{1\times D}
t
\bm{O}^{t}=\bm{Q}^{t}{(\bm{K}^{t})}^{\mathsf{T}}\bm{V}^{t}=\sum_{s=1}^{t}\bm{Q%
}^{t}{(\bm{K}^{t}_{s,:})}^{\mathsf{T}}\bm{V}^{t}_{s,:},
\sqrt{D_{k}}
t
s
\bm{Q}^{t}{(\bm{K}^{t}_{s,:})}^{\mathsf{T}}
\bm{V}^{t}_{s,:}
f_{K}^{t}
f_{V}^{t}
t
\bm{K}^{t}=\text{Concat}[f_{K}^{1}(\bm{X}^{1}),...,f_{K}^{t}(\bm{X}^{t})]%
\hskip 8.53581pt\text{and}\hskip 8.53581pt\bm{V}^{t}=\text{Concat}[f_{V}^{1}(%
\bm{X}^{1}),...,f_{V}^{t}(\bm{X}^{t})].
t
\bm{K}^{t}=\text{Concat}[\bm{K}^{t-1},f_{K}^{t}(\bm{X}^{t})]
\bm{V}^{t}=\text{Concat}[\bm{V}^{t-1},f_{V}^{t}(\bm{X}^{t})]
\displaystyle\bm{O}^{t}=\sum_{s=1}^{t-1}\bm{Q}^{t}{(\bm{K}^{t}_{s,:})}^{%
\mathsf{T}}\bm{V}^{t}_{s,:}+\bm{Q}^{t}{(\bm{K}^{t}_{t,:})}^{\mathsf{T}}\bm{V}^%
{t}_{t,:}
\displaystyle\bm{O}^{t}
\displaystyle=\sum_{s=1}^{t-1}\bm{Q}^{t}{(\bm{K}^{t}_{s,:})}^{\mathsf{T}}\bm{V%
}^{t}_{s,:}+\bm{Q}^{t}{(\bm{K}^{t}_{t,:})}^{\mathsf{T}}\bm{V}^{t}_{t,:}
\displaystyle=\sum_{s=1}^{t-1}\bm{Q}^{t}{(\bm{K}^{t-1}_{s,:})}^{\mathsf{T}}\bm%
{V}^{t-1}_{s,:}+\bm{Q}^{t}{(\bm{K}^{t}_{t,:})}^{\mathsf{T}}\bm{V}^{t}_{t,:}=%
\bm{Q}^{t}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}+\bm{Q}^{t}{(\bm{K}^{t}_{t,%
:})}^{\mathsf{T}}\bm{V}^{t}_{t,:},
\displaystyle=\sum_{s=1}^{t-1}\bm{Q}^{t}{(\bm{K}^{t-1}_{s,:})}^{\mathsf{T}}\bm%
{V}^{t-1}_{s,:}+\bm{Q}^{t}{(\bm{K}^{t}_{t,:})}^{\mathsf{T}}\bm{V}^{t}_{t,:}=%
\bm{Q}^{t}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}+\bm{Q}^{t}{(\bm{K}^{t}_{t,%
:})}^{\mathsf{T}}\bm{V}^{t}_{t,:},
t
\bm{K}^{t}
\bm{V}^{t}
\bm{K}^{t-1}
\bm{V}^{t-1}
D
\bm{V}^{t}
H\times W\times C
t
\bm{V}^{t}
\bm{Q}^{t}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}
\odot
\bm{\lambda}^{t}_{q}\in\mathbb{R}^{1\times D_{k}}
\bm{Q}^{t}=\bm{\lambda}^{t}_{q}\odot\bm{Q}^{t-1}
\bm{Q}^{t}
\bm{Q}^{t-1}
\bm{\lambda}^{t}_{q}
\displaystyle\begin{split}\bm{Q}^{t}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}&%
=(\bm{\lambda}^{t}_{q}\odot\bm{Q}^{t-1}){(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t%
-1}\\
&\approx\bm{\lambda}^{t}_{o}\odot[\bm{Q}^{t-1}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm%
{V}^{t-1}]=\bm{\lambda}^{t}_{o}\odot\bm{O}^{t-1},\end{split}
\displaystyle\begin{split}\bm{Q}^{t}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}&%
=(\bm{\lambda}^{t}_{q}\odot\bm{Q}^{t-1}){(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t%
-1}\\
&\approx\bm{\lambda}^{t}_{o}\odot[\bm{Q}^{t-1}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm%
{V}^{t-1}]=\bm{\lambda}^{t}_{o}\odot\bm{O}^{t-1},\end{split}
\bm{\lambda}^{t}_{o}\in\mathbb{R}^{1\times D}
\bm{Q}^{t}
\bm{Q}^{t-1}
{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}
\bm{\lambda}^{t}_{o}
\bm{Q}^{t}
\bm{Q}^{t-1}
\bm{\lambda}^{t}_{q}
\bm{\lambda}^{t}_{q}=c\bm{1}\in\mathbb{R}^{1\times D_{k}}
\bm{\lambda}^{t}_{o}=c\bm{1}\in\mathbb{R}^{1\times D}
O(T)
\bm{O}^{t}=\bm{\lambda}^{t}_{o}\odot\bm{O}^{t-1}+\bm{Q}^{t}{(\bm{K}^{t}_{t,:})%
}^{\mathsf{T}}\bm{V}^{t}_{t,:}=\sum_{l=0}^{t-1}\bm{\beta}_{l}\odot\left[\bm{Q}%
^{t-l}{(\bm{K}^{t-l}_{t-l,:})}^{\mathsf{T}}\bm{V}^{t-l}_{t-l,:}\right],
\bm{\beta}_{0}=\bm{1}
\bm{\beta}_{l}=\bm{\lambda}^{t}_{o}\odot...\odot\bm{\lambda}^{t-l+1}_{o}
l\geq 1
\bm{V}^{t-l}_{t-l,:}
H
h\in[H]
\bm{O}^{t}_{h}=\bm{Q}^{t}_{h}{(\bm{K}^{t}_{h})}^{\mathsf{T}}\bm{V}^{t}_{h}%
\quad\text{and}\quad\bm{O}^{t}_{h}\approx\bm{\lambda}^{t}_{o,h}\odot\bm{O}^{t-%
1}_{h}+\bm{Q}^{t}_{h}{(\bm{K}^{t}_{h[t,:]})}^{\mathsf{T}}\bm{V}^{t}_{h[t,:]},
\bm{O}^{t}_{h}\in\mathbb{R}^{1\times\frac{D}{H}}
h
\bm{O}^{t}=\text{Concat}[\bm{O}^{t}_{1},...,\bm{O}^{t}_{H}]
\bm{V}^{t}_{t,:}
\bm{Q}^{t}{(\bm{K}^{t}_{t,:})}^{\mathsf{T}}
H
\bm{Q}_{h}^{t}{(\bm{K}_{h}^{t-1})}^{\mathsf{T}}\bm{V}_{h}^{t-1}\approx\bm{%
\lambda}^{t}_{o,h}\odot[\bm{Q}_{h}^{t-1}{(\bm{K}_{h}^{t-1})}^{\mathsf{T}}\bm{V%
}_{h}^{t-1}]
\bm{\lambda}^{t}_{q,h}=c_{h}\bm{1}\in\mathbb{R}^{1\times\frac{D_{k}}{H}}
D_{k}
H=D_{k}
t
\bm{X}^{t}\in\mathbb{R}^{1\times D}
D=H\times W\times C
t
D
\bm{Q}^{t}
\bm{K}^{t}_{t,:}
\bm{V}^{t}_{t,:}
\cdot
f_{Q}^{t}
f_{K}^{t}
f_{V}^{t}
H
\bm{O}^{t-1}
\bm{\lambda}^{t}_{o}
C
H\times W\times C
\bm{O}^{t-1}
[0,1]
t
\bm{X}^{t}\in\mathbb{R}^{1\times D}
D=(N+1)\times C
N
C
\bm{X}^{t}
\bm{X}^{t}_{p}\in\mathbb{R}^{N\times C}
\bm{X}^{t}_{c}\in\mathbb{R}^{1\times C}
\bm{X}^{t}_{p}\in\mathbb{R}^{\sqrt{N}\times\sqrt{N}\times C}
\bm{O}^{t-1}_{p}
\dagger
\dagger
A^{2}
\text{RLA}_{g}
\text{RLA}_{g}
\text{RLA}_{g}
d_{k}
d_{k}=32
8
16
A^{2}
\text{RLA}_{g}
\bm{Q}^{t}_{h}
\bm{Q}^{t-1}_{h}
\bm{\lambda}_{q,h}^{t}
1280\times 800
1280\times 800
AP^{bb}
AP_{50}^{bb}
AP_{75}^{bb}
AP_{S}^{bb}
AP_{M}^{bb}
AP_{L}^{bb}
\text{RLA}_{g}
\text{RLA}_{g}
\text{RLA}_{g}
\text{RLA}_{g}
AP^{bb}
AP^{m}
AP^{bb}
AP^{m}
AP^{bb}
AP_{50}^{bb}
AP_{75}^{bb}
AP^{m}
AP_{50}^{m}
AP_{75}^{m}
\text{RLA}_{g}
\text{RLA}_{g}
AP_{50}
AP_{L}
AP_{75}
\text{RLA}_{g}
\text{RLA}_{g}
\text{RLA}_{g}
\bm{\lambda}_{o}^{t}
d_{k}
d_{k}=1
\bm{\lambda}_{o}^{t}
\bm{\lambda}_{o}^{t}\bm{O}^{t-1}
\bm{\lambda}_{o}^{t}
d_{k}
d_{k}
d_{k}
\bm{X}\in\mathbb{R}^{{T}\times D_{in}}
T
D_{in}
\bm{K}\in\mathbb{R}^{T\times D_{k}}
\bm{V}\in\mathbb{R}^{T\times D_{out}}
F_{K}
F_{V}
\displaystyle\bm{K}=F_{K}(\bm{X})=F_{K}(\text{Concat}[\bm{X}_{1,:},\bm{X}_{2,:%
},...,\bm{X}_{T,:}]),
\displaystyle\bm{K}=F_{K}(\bm{X})=F_{K}(\text{Concat}[\bm{X}_{1,:},\bm{X}_{2,:%
},...,\bm{X}_{T,:}]),
\bm{V}=F_{V}(\bm{X})=F_{V}(\text{Concat}[\bm{X}_{1,:},\bm{X}_{2,:},...,\bm{X}_%
{T,:}])
F_{K}(\bm{X})=XW_{K}
F_{V}(\bm{X})=XW_{V}
D_{in}
\displaystyle\bm{K}=\text{Concat}[F_{K}(\bm{X}_{1,:}),...,F_{K}(\bm{X}_{T,:})]%
\quad\text{and}\quad\bm{V}=\text{Concat}[F_{V}(\bm{X}_{1,:}),...,F_{V}(\bm{X}_%
{T,:})].
\displaystyle\bm{K}=\text{Concat}[F_{K}(\bm{X}_{1,:}),...,F_{K}(\bm{X}_{T,:})]%
\quad\text{and}\quad\bm{V}=\text{Concat}[F_{V}(\bm{X}_{1,:}),...,F_{V}(\bm{X}_%
{T,:})].
D_{in}=D_{out}=D
t
\bm{X}^{t}\in\mathbb{R}^{1\times D}
t
\bm{K}^{t}\in\mathbb{R}^{t\times D_{k}}
\bm{V}^{t}\in\mathbb{R}^{t\times D}
f_{K}^{t}
f_{V}^{t}
\displaystyle\bm{K}^{t}=\text{Concat}[f_{K}^{t}(\bm{X}^{1}),...,f_{K}^{t}(\bm{%
X}^{t})]\quad\text{and}\quad\bm{V}^{t}=\text{Concat}[f_{V}^{t}(\bm{X}^{1}),...%
,f_{V}^{t}(\bm{X}^{t})].
\displaystyle\bm{K}^{t}=\text{Concat}[f_{K}^{t}(\bm{X}^{1}),...,f_{K}^{t}(\bm{%
X}^{t})]\quad\text{and}\quad\bm{V}^{t}=\text{Concat}[f_{V}^{t}(\bm{X}^{1}),...%
,f_{V}^{t}(\bm{X}^{t})].
\bm{K}^{t}=\text{Concat}[f_{K}^{1}(\bm{X}^{1}),...,f_{K}^{t}(\bm{X}^{t})]%
\hskip 8.53581pt\text{and}\hskip 8.53581pt\bm{V}^{t}=\text{Concat}[f_{V}^{1}(%
\bm{X}^{1}),...,f_{V}^{t}(\bm{X}^{t})],
{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}
\bm{B}^{t-1}\in\mathbb{R}^{D_{k}\times D}
\bm{b}^{t-1}_{j}
j
\displaystyle\bm{Q}^{t}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}=(\bm{\lambda}%
^{t}_{q}\odot\bm{Q}^{t-1})[{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}]
\displaystyle\bm{Q}^{t}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}
\displaystyle=(\bm{\lambda}^{t}_{q}\odot\bm{Q}^{t-1})[{(\bm{K}^{t-1})}^{%
\mathsf{T}}\bm{V}^{t-1}]
\displaystyle=(\bm{\lambda}^{t}_{q}\odot\bm{Q}^{t-1})\bm{B}^{t-1}
\displaystyle=(\bm{\lambda}^{t}_{q}\odot\bm{Q}^{t-1})\bm{B}^{t-1}
\displaystyle=\sum_{j=1}^{D_{k}}\lambda_{q,j}^{t}q^{t-1}_{j}\bm{b}^{t-1}_{j}
\displaystyle=\sum_{j=1}^{D_{k}}\lambda_{q,j}^{t}q^{t-1}_{j}\bm{b}^{t-1}_{j}
\displaystyle\approx c\sum_{j=1}^{D_{k}}q^{t-1}_{j}\bm{b}^{t-1}_{j}
\displaystyle\approx c\sum_{j=1}^{D_{k}}q^{t-1}_{j}\bm{b}^{t-1}_{j}
\displaystyle=c[\bm{Q}^{t-1}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}],
\displaystyle=c[\bm{Q}^{t-1}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}],
\lambda_{q,j}^{t}
q^{t-1}_{j}
j
\bm{\lambda}^{t}_{q}\in\mathbb{R}^{1\times D_{k}}
\bm{Q}^{t-1}\in\mathbb{R}^{1\times D_{k}}
\bm{\lambda}^{t}_{q}
\bm{\lambda}^{t}_{q,h}\in\mathbb{R}^{1\times\frac{D_{k}}{H}}
\bm{\lambda}^{t}_{o}\odot[\bm{Q}^{t-1}{(\bm{K}^{t-1})}^{\mathsf{T}}\bm{V}^{t-1}]
\bm{\lambda}^{t}_{o}
D
\sqrt{D_{k}}
\displaystyle\bm{O}^{t}=\frac{\sum_{s=1}^{t}k(\bm{Q}^{t},\bm{K}^{t}_{s,:})\bm{%
V}^{t}_{s,:}}{\sum_{s=1}^{t}k(\bm{Q}^{t},\bm{K}^{t}_{s,:})},
\displaystyle\bm{O}^{t}=\frac{\sum_{s=1}^{t}k(\bm{Q}^{t},\bm{K}^{t}_{s,:})\bm{%
V}^{t}_{s,:}}{\sum_{s=1}^{t}k(\bm{Q}^{t},\bm{K}^{t}_{s,:})},
k(x,y)=\text{exp}(\frac{{x}^{\mathsf{T}}y}{\sqrt{D_{k}}})
k(x,y)
\phi(\cdot)
k(x,y)=\mathbb{E}[{\phi(x)}^{\mathsf{T}}\phi(y)]
t
\displaystyle\bm{O}^{t}=\frac{\sum_{s=1}^{t}\phi(\bm{Q}^{t}){\phi(\bm{K}^{t}_{%
s,:})}^{\mathsf{T}}\bm{V}^{t}_{s,:}}{\sum_{s=1}^{t}\phi(\bm{Q}^{t}){\phi(\bm{K%
}^{t}_{s,:})}^{\mathsf{T}}}
\displaystyle\bm{O}^{t}
\displaystyle=\frac{\sum_{s=1}^{t}\phi(\bm{Q}^{t}){\phi(\bm{K}^{t}_{s,:})}^{%
\mathsf{T}}\bm{V}^{t}_{s,:}}{\sum_{s=1}^{t}\phi(\bm{Q}^{t}){\phi(\bm{K}^{t}_{s%
,:})}^{\mathsf{T}}}
\displaystyle=\frac{\phi(\bm{Q}^{t})\sum_{s=1}^{t}{\phi(\bm{K}^{t}_{s,:})}^{%
\mathsf{T}}\bm{V}^{t}_{s,:}}{\phi(\bm{Q}^{t})\sum_{s=1}^{t}{\phi(\bm{K}^{t}_{s%
,:})}^{\mathsf{T}}}.
\displaystyle=\frac{\phi(\bm{Q}^{t})\sum_{s=1}^{t}{\phi(\bm{K}^{t}_{s,:})}^{%
\mathsf{T}}\bm{V}^{t}_{s,:}}{\phi(\bm{Q}^{t})\sum_{s=1}^{t}{\phi(\bm{K}^{t}_{s%
,:})}^{\mathsf{T}}}.
\bm{U}^{t}=\sum_{s=1}^{t}{\phi(\bm{K}^{t}_{s,:})}^{\mathsf{T}}\bm{V}^{t}_{s,:}%
\quad\text{and}\quad\bm{Z}^{t}=\sum_{s=1}^{t}{\phi(\bm{K}^{t}_{s,:})}^{\mathsf%
{T}},
\bm{O}^{t}=\frac{\phi(\bm{Q}^{t})\bm{U}^{t}}{\phi(\bm{Q}^{t})\bm{Z}^{t}}
\bm{U}^{t}
\bm{Z}^{t}
\bm{U}^{t-1}
\bm{Z}^{t-1}
\displaystyle\bm{U}^{t}=\bm{U}^{t-1}+{\phi(\bm{K}^{t}_{t,:})}^{\mathsf{T}}\bm{%
V}^{t}_{t,:}
\displaystyle\bm{U}^{t}
\displaystyle=\bm{U}^{t-1}+{\phi(\bm{K}^{t}_{t,:})}^{\mathsf{T}}\bm{V}^{t}_{t,:}
\displaystyle\bm{Z}^{t}=\bm{Z}^{t-1}+{\phi(\bm{K}^{t}_{t,:})}^{\mathsf{T}}
\displaystyle\bm{Z}^{t}
\displaystyle=\bm{Z}^{t-1}+{\phi(\bm{K}^{t}_{t,:})}^{\mathsf{T}}
\bm{O}^{t}=\sum_{l=0}^{t-1}\bm{\beta}_{l}\odot\left[\bm{Q}^{t-l}{(\bm{K}^{t-l}%
_{t-l,:})}^{\mathsf{T}}\bm{V}^{t-l}_{t-l,:}\right],
\bm{V}^{t-l}_{t-l,:}
\bm{X}
t
\bm{X}^{t}\in\mathbb{R}^{1\times H\times W\times C}
t-1
\bm{K}^{t-1}\in\mathbb{R}^{1\times(t-1)\times C}
\bm{V}^{t-1}\in\mathbb{R}^{1\times(t-1)\times H\times W\times C}
H
\bm{O}^{t}\in\mathbb{R}^{1\times H\times W\times C}
\bm{K}^{t}\in\mathbb{R}^{1\times t\times C}
\bm{V}^{t}\in\mathbb{R}^{1\times t\times H\times W\times C}
\bm{X}^{t}
\bm{Y}^{t}\leftarrow\text{GAP}(\bm{X}^{t})\in\mathbb{R}^{1\times 1\times C}
\bm{Q}^{t}\leftarrow\text{Conv1D}(\bm{Y}^{t})\in\mathbb{R}^{1\times 1\times C}
\bm{K}^{t}_{t,:}\leftarrow\text{Conv1D}(\bm{Y}^{t})\in\mathbb{R}^{1\times 1%
\times C}
\bm{V}^{t}_{t,:}\leftarrow\text{DWConv2D}(\bm{X}^{t})\in\mathbb{R}^{1\times 1%
\times H\times W\times C}
t=1
\bm{K}^{t}\leftarrow\bm{K}^{t}_{t,:}
\bm{V}^{t}\leftarrow\bm{V}^{t}_{t,:}
\bm{K}^{t}\leftarrow\text{Concat}[\bm{K}^{t-1},\bm{K}^{t}_{t,:}]\in\mathbb{R}^%
{1\times t\times C}
\bm{V}^{t}\leftarrow\text{Concat}[\bm{V}^{t-1},\bm{V}^{t}_{t,:}]\in\mathbb{R}^%
{1\times t\times H\times W\times C}
\bm{O}^{t}\leftarrow\text{Multi-head Attention}(\bm{Q}^{t},\bm{K}^{t},\bm{V}^{%
t})
H
t
\bm{X}^{t}\in\mathbb{R}^{1\times(N+1)\times C}
t-1
\bm{K}^{t-1}\in\mathbb{R}^{1\times(t-1)\times C}
\bm{V}^{t-1}\in\mathbb{R}^{1\times(t-1)\times\sqrt{N}\times\sqrt{N}\times C}
H
\bm{O}^{t}\in\mathbb{R}^{1\times(N+1)\times C}
\bm{K}^{t}\in\mathbb{R}^{1\times t\times C}
\bm{V}^{t}\in\mathbb{R}^{1\times t\times\sqrt{N}\times\sqrt{N}\times C}
\bm{X}^{t}_{c}\in\mathbb{R}^{1\times 1\times C},\bm{X}^{t}_{p}\in\mathbb{R}^{1%
\times N\times C}\leftarrow\text{Split}(\bm{X}^{t})
\bm{X}^{t}_{p}\leftarrow\text{Reshape}(\bm{X}^{t}_{p})\in\mathbb{R}^{1\times%
\sqrt{N}\times\sqrt{N}\times C}
\bm{X}^{t}_{p}
\bm{Y}^{t}_{p}\leftarrow\text{GAP}(\bm{X}^{t}_{p})\in\mathbb{R}^{1\times 1%
\times C}
\bm{Q}^{t}\leftarrow\text{Conv1D}(\bm{Y}^{t}_{p})\in\mathbb{R}^{1\times 1%
\times C}
\bm{K}^{t}_{t,:}\leftarrow\text{Conv1D}(\bm{Y}^{t}_{p})\in\mathbb{R}^{1\times 1%
\times C}
\bm{V}^{t}_{t,:}\leftarrow\text{DWConv2D}(\bm{X}^{t}_{p})\in\mathbb{R}^{1%
\times 1\times\sqrt{N}\times\sqrt{N}\times C}
t=1
\bm{K}^{t}\leftarrow\bm{K}^{t}_{t,:}
\bm{V}^{t}\leftarrow\bm{V}^{t}_{t,:}
\bm{K}^{t}\leftarrow\text{Concat}[\bm{K}^{t-1},\bm{K}^{t}_{t,:}]\in\mathbb{R}^%
{1\times t\times C}
\bm{V}^{t}\leftarrow\text{Concat}[\bm{V}^{t-1},\bm{V}^{t}_{t,:}]\in\mathbb{R}^%
{1\times t\times\sqrt{N}\times\sqrt{N}\times C}
\bm{O}^{t}_{p}\leftarrow\text{Multi-head Attention}(\bm{Q}^{t},\bm{K}^{t},\bm{%
V}^{t})
H
\bm{O}^{t}_{p}\leftarrow\text{Reshape}(\bm{O}^{t}_{p})\in\mathbb{R}^{1\times N%
\times C}
\bm{O}^{t}\leftarrow\text{Concat}[\bm{X}^{t}_{c},\bm{O}^{t}_{p}]
t
\bm{X}^{t}\in\mathbb{R}^{1\times H\times W\times C}
t-1
\bm{O}^{t-1}\in\mathbb{R}^{1\times H\times W\times C}
H
\bm{\lambda}^{t}_{o}\in\mathbb{R}^{1\times C}
\bm{O}^{t}\in\mathbb{R}^{1\times H\times W\times C}
\bm{X}^{t}
\bm{Y}^{t}\leftarrow\text{GAP}(\bm{X}^{t})\in\mathbb{R}^{1\times 1\times C}
\bm{Q}^{t}\leftarrow\text{Conv1D}(\bm{Y}^{t})\in\mathbb{R}^{1\times 1\times C}
\bm{K}^{t}_{t,:}\leftarrow\text{Conv1D}(\bm{Y}^{t})\in\mathbb{R}^{1\times 1%
\times C}
\bm{V}^{t}_{t,:}\leftarrow\text{DWConv2D}(\bm{X}^{t})\in\mathbb{R}^{1\times 1%
\times H\times W\times C}
\tilde{\bm{O}}^{t}\leftarrow\text{Multi-head Attention}(\bm{Q}^{t},\bm{K}^{t}_%
{t,:},\bm{V}^{t}_{t,:})
H
\bm{O}^{t}\leftarrow\text{Expand}(\bm{\lambda}^{t}_{o})\odot\bm{O}^{t-1}+%
\tilde{\bm{O}}^{t}
t
\bm{X}^{t}\in\mathbb{R}^{1\times(N+1)\times C}
t-1
\bm{O}^{t-1}\in\mathbb{R}^{1\times(N+1)\times C}
H
\bm{\lambda}^{t}_{o}\in\mathbb{R}^{1\times C}
\bm{O}^{t}\in\mathbb{R}^{1\times(N+1)\times C}
\bm{X}^{t}_{c}\in\mathbb{R}^{1\times 1\times C},\bm{X}^{t}_{p}\in\mathbb{R}^{1%
\times N\times C}\leftarrow\text{Split}(\bm{X}^{t})
\bm{O}^{t-1}_{c}\in\mathbb{R}^{1\times 1\times C},\bm{O}^{t-1}_{p}\in\mathbb{R%
}^{1\times N\times C}\leftarrow\text{Split}(\bm{O}^{t-1})
\bm{X}^{t}_{p}\leftarrow\text{Reshape}(\bm{X}^{t}_{p})\in\mathbb{R}^{1\times%
\sqrt{N}\times\sqrt{N}\times C}
\bm{X}^{t}_{p}
\bm{Y}^{t}_{p}\leftarrow\text{GAP}(\bm{X}^{t}_{p})\in\mathbb{R}^{1\times 1%
\times C}
\bm{Q}^{t}\leftarrow\text{Conv1D}(\bm{Y}^{t}_{p})\in\mathbb{R}^{1\times 1%
\times C}
\bm{K}^{t}_{t,:}\leftarrow\text{Conv1D}(\bm{Y}^{t}_{p})\in\mathbb{R}^{1\times 1%
\times C}
\bm{V}^{t}_{t,:}\leftarrow\text{GELU}(\text{DWConv2D}(\bm{X}^{t}_{p}))\in%
\mathbb{R}^{1\times 1\times\sqrt{N}\times\sqrt{N}\times C}
\tilde{\bm{O}}^{t}_{p}\leftarrow\text{Multi-head Attention}(\bm{Q}^{t},\bm{K}^%
{t}_{t,:},\bm{V}^{t}_{t,:})
H
\tilde{\bm{O}}^{t}_{p}\leftarrow\text{Reshape}(\tilde{\bm{O}}^{t}_{p})\in%
\mathbb{R}^{1\times N\times C}
\bm{O}^{t}_{p}\leftarrow\text{Expand}(\bm{\lambda}^{t}_{o})\odot\bm{O}^{t-1}_{%
p}+\tilde{\bm{O}}^{t}_{p}
\bm{O}^{t}\leftarrow\text{Concat}[\bm{X}^{t}_{c},\bm{O}^{t}_{p}]
224\times 224
\epsilon=0.1
\text{RLA}_{g}
\text{RLA}_{g}
\text{RLA}_{g}
\text{RLA}_{g}
AP^{bb}
AP_{50}^{bb}
AP_{75}^{bb}
AP_{S}^{bb}
AP_{M}^{bb}
AP_{L}^{bb}
\text{RLA}_{g}
\text{RLA}_{g}
AP^{m}
AP_{50}^{m}
AP_{75}^{m}
AP_{S}^{m}
AP_{M}^{m}
AP_{L}^{m}
\text{RLA}_{g}
\text{RLA}_{g}
1280\times 800
1280\times 800
AP^{bb}
AP_{50}^{bb}
AP_{75}^{bb}
AP_{S}^{bb}
AP_{M}^{bb}
AP_{L}^{bb}
\bm{\lambda}^{t}_{o}
