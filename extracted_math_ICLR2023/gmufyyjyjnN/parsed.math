X\in\mathbb{R}^{N\times M}
N
M
K
\widetilde{A}\in\mathbb{R}^{N\times K}
W\in\mathbb{R}^{K\times M}
X\approx\widetilde{A}W\,,
W
K
\widetilde{A}
\widetilde{A}
W
\widetilde{A}
N
K
A\in\mathbb{R}^{N\times K}
k
A_{\cdot k}
N
k
A
A
A
A
Y\in\mathbb{R}^{N\times L}
N
L
S\in\{0,1\}^{N\times L}
S_{il}=0
i
l
S_{il}=1
l
G_{l}\in\{1,\cdots,K\}
Y_{\cdot l}\in\mathbb{R}^{N}
p_{l}
R_{l}=\sum_{i=1}^{N}Y_{il}
p_{l}
A_{\cdot\,G_{l}}
G_{l}
p_{l}
A_{\cdot\,G_{l}}
S_{\cdot l}
\pi_{il}=\mathbb{P}(S_{il}=1)
A_{i,G_{l}}
\pi_{il}=\textrm{logistic}\left(\kappa_{l}+\tau_{l}A_{i,G_{l}}\right)\,,
(\kappa_{l},\tau_{l})
\begin{split}&\textrm{dropouts}=\{(i,l):S_{il}=0\}\,,\\
&\textrm{structural zeros}=\{(i,l):S_{il}=1,Y_{il}=0\}\,.\end{split}
X\in\mathbb{R}^{N\times M}
N
M
j
W_{\cdot j}\in\mathbb{R}^{K}
K
\sum_{k=1}^{K}W_{kj}=1
X_{\cdot j}\in\mathbb{R}^{N}
K
A
W_{\cdot j}
j
R_{j}=\sum_{i=1}^{N}X_{ij}
W_{\cdot j}
(\kappa_{l},\tau_{l})
A
S
W
A
R_{l}
Y_{\cdot l}
S_{il}
\pi_{il}
{\kappa_{l}}
{\tau_{l}}
\mu_{\kappa},\sigma_{\kappa}^{2}
\mu_{\tau},\sigma_{\tau}^{2}
A
X_{\cdot j}
W_{\cdot j}
\alpha
N
L
X
Y
S
W
\pi
A
X
Y
S
W
\pi
A
W_{\cdot j}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}\textrm{Dirichlet}(\alpha)
j=1,\cdots,M
\alpha\in\mathbb{R}^{K}
\alpha\geq 0
X_{\cdot j}\,|\,W_{\cdot j}\stackrel{{\scriptstyle indep.}}{{\sim}}\textrm{%
Multinomial}(R_{j},~{}AW_{\cdot j})
j=1,\cdots,M
R_{j}=\sum_{i=1}^{N}X_{ij}
\kappa_{l}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}N(\mu_{\kappa},\sigma_{%
\kappa}^{2})
\tau_{l}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}N(\mu_{\tau},\sigma_{\tau}^{2})
l=1,\cdots,L
\pi_{il}=\textrm{logistic}\left(\kappa_{l}+\tau_{l}A_{i,G_{l}}\right)
G_{l}\in\{1,\cdots,K\}
l
S_{il}\,|\,\kappa_{l},\tau_{l}\stackrel{{\scriptstyle indep.}}{{\sim}}\textrm{%
Bernoulli}(\pi_{il})
i=1,\cdots,N;~{}l=1,\cdots,L
Y_{\cdot l}\,|\,S_{\cdot l}\stackrel{{\scriptstyle indep.}}{{\sim}}\textrm{%
Multinomial}(R_{l},~{}p_{l})
l=1,\cdots,L
R_{l}=\sum_{i=1}^{N}Y_{il}
p_{l}=(p_{il})_{i=1,\cdots,N}\,,\textrm{ where }p_{il}=\frac{A_{i,G_{l}}S_{il}%
}{\sum_{n=1}^{N}A_{n,G_{l}}S_{nl}}\,.
A
A_{ik}
S_{il}
A_{i,G_{l}}=0
A_{ik}=0
X_{il}=0
k
\theta=(A,\alpha,\mu_{\kappa},\sigma_{\kappa}^{2},\mu_{\tau},\sigma_{\tau}^{2})
H=(W,S,\kappa,\tau)
A
\mathbb{E}[S|Y,\theta]
\mathbb{E}[W|X,\theta]
X,Y
W
Z
d
\displaystyle\begin{split}&W_{\cdot j}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}%
\textrm{Dirichlet}(\alpha)\,,~{}j=1,\cdots,M\,,\\
&Z_{rj}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}\textrm{Multinomial}(1,W_{\cdot
j%
})\,,~{}r=1,\cdots,R_{j}\,,\\
&d_{rj}\stackrel{{\scriptstyle indep.}}{{\sim}}\textrm{Multinomial}(1,A_{\cdot
Z%
_{rj}})\,,~{}r=1,\cdots,R_{j}\,,\\
&X_{ij}=\sum_{r=1}^{R_{j}}I_{\{d_{rj}=i\}}\,,~{}i=1,\cdots,N,~{}j=1,\cdots,M\,%
.\end{split}
\displaystyle\begin{split}&W_{\cdot j}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}%
\textrm{Dirichlet}(\alpha)\,,~{}j=1,\cdots,M\,,\\
&Z_{rj}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}\textrm{Multinomial}(1,W_{\cdot
j%
})\,,~{}r=1,\cdots,R_{j}\,,\\
&d_{rj}\stackrel{{\scriptstyle indep.}}{{\sim}}\textrm{Multinomial}(1,A_{\cdot
Z%
_{rj}})\,,~{}r=1,\cdots,R_{j}\,,\\
&X_{ij}=\sum_{r=1}^{R_{j}}I_{\{d_{rj}=i\}}\,,~{}i=1,\cdots,N,~{}j=1,\cdots,M\,%
.\end{split}
d_{rj}
X_{ij}
R_{j}
Z_{rj}
d_{rj}
\tilde{Z}_{ij,k}:=\sum_{r:d_{rj}=i}I_{\{Z_{rj}=k\}}~{}\textrm{and}~{}\tilde{Z}%
_{ij}:=(\tilde{Z}_{ij,k})\in\mathbb{R}^{K}\,,
\displaystyle\begin{split}&W_{\cdot j}\,|\,W_{\cdot(-j)},\tilde{Z},X\sim%
\textrm{Dirichlet}\left(\alpha+\sum_{i=1}^{N}\tilde{Z}_{ij}\right)\,,\\
&\tilde{Z}_{ij}\,|\,\tilde{Z}_{(-ij)},W,X\sim\textrm{Multinomial}\left(X_{ij},%
\frac{A_{i\cdot}\odot W_{\cdot j}}{\sum_{k=1}^{K}A_{ik}W_{kj}}\right)\,,\end{split}
\displaystyle\begin{split}&W_{\cdot j}\,|\,W_{\cdot(-j)},\tilde{Z},X\sim%
\textrm{Dirichlet}\left(\alpha+\sum_{i=1}^{N}\tilde{Z}_{ij}\right)\,,\\
&\tilde{Z}_{ij}\,|\,\tilde{Z}_{(-ij)},W,X\sim\textrm{Multinomial}\left(X_{ij},%
\frac{A_{i\cdot}\odot W_{\cdot j}}{\sum_{k=1}^{K}A_{ik}W_{kj}}\right)\,,\end{split}
\odot
(-i)
i
S,\kappa,\tau
\displaystyle\begin{split}&(\kappa_{l},\tau_{l})\sim N(\mu,\Sigma),~{}\textrm{%
where }\mu=(\mu_{\kappa},\mu_{\tau}),\Sigma=\textrm{Diag}(\sigma_{\kappa}^{2},%
\sigma_{\tau}^{2})\,,\\
&S_{il}\,|\,\kappa_{l},\tau_{l}\sim\textrm{Bernoulli}(\textrm{logistic}\left(%
\psi_{il}\right))\,,~{}\textrm{where }\psi_{il}=\kappa_{l}+\tau_{l}A_{i,G_{l}}%
\,,\end{split}
\displaystyle\begin{split}&(\kappa_{l},\tau_{l})\sim N(\mu,\Sigma),~{}\textrm{%
where }\mu=(\mu_{\kappa},\mu_{\tau}),\Sigma=\textrm{Diag}(\sigma_{\kappa}^{2},%
\sigma_{\tau}^{2})\,,\\
&S_{il}\,|\,\kappa_{l},\tau_{l}\sim\textrm{Bernoulli}(\textrm{logistic}\left(%
\psi_{il}\right))\,,~{}\textrm{where }\psi_{il}=\kappa_{l}+\tau_{l}A_{i,G_{l}}%
\,,\end{split}
(1,A_{i,G_{l}})
\omega
\displaystyle\begin{split}&\omega_{il}\,|\,\omega_{(-il)},S,Y,\kappa,\tau~{}%
\sim~{}\textrm{Polya-Gamma}(1,\psi_{il})\,,\\
&(\kappa_{l},\tau_{l})\,|\,\kappa_{(-l)},\tau_{(-l)},\omega,S,Y~{}\sim~{}N(m_{%
\omega l},V_{\omega l}^{-1})\,,\\
&S_{il}\,|\,S_{(-il)},\omega,S,\kappa,\tau,Y~{}\sim~{}\textrm{Bernoulli}(b_{il%
})\,,\end{split}
\displaystyle\begin{split}&\omega_{il}\,|\,\omega_{(-il)},S,Y,\kappa,\tau~{}%
\sim~{}\textrm{Polya-Gamma}(1,\psi_{il})\,,\\
&(\kappa_{l},\tau_{l})\,|\,\kappa_{(-l)},\tau_{(-l)},\omega,S,Y~{}\sim~{}N(m_{%
\omega l},V_{\omega l}^{-1})\,,\\
&S_{il}\,|\,S_{(-il)},\omega,S,\kappa,\tau,Y~{}\sim~{}\textrm{Bernoulli}(b_{il%
})\,,\end{split}
\begin{split}&\psi_{il}=\kappa_{l}+\tau_{l}A_{i,G_{l}}\,,\\
&V_{\omega l}=\left(\begin{array}[]{cc}\sum_{i=1}^{N}\omega_{il}+\sigma_{%
\kappa}^{-2}&\sum_{i=1}^{N}\omega_{il}A_{i,G_{l}}\\
\sum_{i=1}^{N}\omega_{il}A_{i,G_{l}}&\sum_{i=1}^{N}\omega_{il}A_{i,G_{l}}^{2}+%
\sigma_{\tau}^{-2}\end{array}\right)\,,\\
&m_{\omega l}=V_{\omega l}^{-1}\left(\begin{array}[]{c}\sum_{i=1}^{N}S_{il}-N/%
2+\mu_{\kappa}/\sigma_{\kappa}^{2}\\
\sum_{i=1}^{N}S_{il}A_{i,G_{l}}-1/2+\mu_{\tau}/\sigma_{\tau}^{2}\end{array}%
\right)\,,\\
&b_{il}=\begin{cases}1,&\textrm{if }Y_{il}>0\\
\textrm{logit}\left(\psi_{il}+R_{l}\log\left(\frac{\sum_{n\neq i}A_{n,G_{l}}S_%
{nl}}{A_{i,G_{l}}+\sum_{n\neq i}A_{n,G_{l}}S_{nl}}\right)\right),&\textrm{if }%
Y_{il}=0\end{cases}\,.\end{split}
\mathbb{E}_{Q}
(\mu_{\kappa},\sigma_{\kappa}^{2},\mu_{\tau},\sigma_{\tau}^{2})
\displaystyle\begin{split}\hat{\mu}_{\kappa}=\frac{1}{L}\sum_{l=1}^{L}\mathbb{%
E}_{Q}(\kappa_{l})\,,~{}~{}\hat{\sigma}_{\kappa}^{2}=\frac{1}{L}\sum_{l=1}^{L}%
\mathbb{E}_{Q}\left[(\kappa_{l}-\hat{\mu}_{\kappa})^{2}\right]\,,\\
\hat{\mu}_{\tau}=\frac{1}{L}\sum_{l=1}^{L}\mathbb{E}_{Q}(\tau_{l})\,,~{}~{}%
\hat{\sigma}_{\tau}^{2}=\frac{1}{L}\sum_{l=1}^{L}\mathbb{E}_{Q}\left[(\tau_{l}%
-\hat{\mu}_{\tau})^{2}\right]\,.\end{split}
\displaystyle\begin{split}\hat{\mu}_{\kappa}=\frac{1}{L}\sum_{l=1}^{L}\mathbb{%
E}_{Q}(\kappa_{l})\,,~{}~{}\hat{\sigma}_{\kappa}^{2}=\frac{1}{L}\sum_{l=1}^{L}%
\mathbb{E}_{Q}\left[(\kappa_{l}-\hat{\mu}_{\kappa})^{2}\right]\,,\\
\hat{\mu}_{\tau}=\frac{1}{L}\sum_{l=1}^{L}\mathbb{E}_{Q}(\tau_{l})\,,~{}~{}%
\hat{\sigma}_{\tau}^{2}=\frac{1}{L}\sum_{l=1}^{L}\mathbb{E}_{Q}\left[(\tau_{l}%
-\hat{\mu}_{\tau})^{2}\right]\,.\end{split}
A
\alpha
\begin{split}&A_{\cdot k}^{new}\leftarrow\textrm{Proj}\left(A_{\cdot k}^{old}+%
t\cdot\nabla ELBO(A_{\cdot k}^{old})\right)\,,\\
&\alpha^{new}\leftarrow\textrm{Proj}\left(\alpha^{old}+t\cdot\nabla ELBO(%
\alpha^{old})\right)\,,\end{split}
t
A_{ik}\geq\epsilon_{A},~{}~{}\sum_{i=1}^{N}A_{ik}=1,~{}~{}\alpha_{k}\geq%
\epsilon_{\alpha}\,,
\epsilon_{A},\epsilon_{\alpha}>0
\begin{split}&\frac{\partial ELBO}{\partial A_{ik}}=\sum_{j=1}^{M}\frac{%
\mathbb{E}_{Q}\left[\widetilde{Z}_{ij,k}\right]}{A_{ik}}+\sum_{l:G_{l}=k}\left%
[\frac{Y_{il}\mathbb{E}_{Q}(S_{il})}{A_{ik}}-\mathbb{E}_{Q}[\omega_{il}\tau_{l%
}^{2}]A_{ik}-\right.\\
&\qquad\qquad\qquad\left.\frac{\mathbb{E}_{Q}(S_{il})R_{l}}{u_{l}}+\mathbb{E}_%
{Q}\left[\left(S_{il}-\frac{1}{2}\right)\tau_{l}-\omega_{il}\tau_{l}\kappa_{l}%
\right]\right]\,,\\
&\frac{\partial ELBO}{\partial\alpha_{k}}=\sum_{j=1}^{M}\mathbb{E}_{Q}[\log W_%
{kj}]+M\left[\Psi\left(\sum_{k=1}^{K}\alpha_{k}\right)-\Psi(\alpha_{k})\right]%
\,,\end{split}
u_{l}=\sum_{i=1}^{N}A_{i,G_{l}}\mathbb{E}_{Q}(S_{il})
\Psi(\cdot)
A
W
S
N
50\,N
2\,N
2
A
\mu=0,\sigma=1
k
N_{m}=10
A_{il}=0
l\neq k
k
N_{a}=10
A_{ik}=0
N_{h}=30
A
N_{h}
N_{h}/N
1-N_{h}/N
\{S_{il}\}_{il}
i
l
(\pi_{il})
S_{il}=0
1-\pi_{il}=1-\textrm{logistic}(\kappa_{l}+\tau_{l}A_{i,G_{l}})\,,
G_{l}\in\{1,...,K\}
l
\kappa_{l}
\textrm{Normal}(-1,0.5^{2})
\tau_{l}
\textrm{Normal}(1.5\,N,(0.15\,N)^{2})
A
\bar{A}_{\cdot,k}
1/N
\mathbb{E}[\kappa_{l}+\tau_{l}\bar{A}_{\cdot,G_{l}}]=0.5
37.8\%
73.1\%
A_{ik}=0
A
L=100
M=150
N=200
K=3
30\%,30\%
40\%
\alpha=(1,2,3)
64.6\%
A
Y\in{\mathbb{R}}^{N\times L}
\{G_{l}\}_{l=1,\cdots,L}
\{R_{l}\}_{l=1,\cdots,L}
R_{l}=\sum_{i}Y_{il}
A_{ik}
\hat{A}_{ik}^{naive}=\frac{1}{\#\{l:G_{l}=k\}}\sum_{l:G_{l}=k}\frac{Y_{il}}{R_%
{l}}\,.
\pi_{il}
A
L_{1}
L_{1}
\sum_{i,k}|\hat{A}_{ik}-A_{ik}|
L_{1}
0.17
A
\hat{A}
L_{1}
\sum_{i,k}|\hat{A}_{ik}-A_{ik}|
A
\hat{A}
L_{1}
\sum_{i,k}|\hat{A}_{ik}-A_{ik}|
W
p
p
L_{1}
A
W
p
\{10^{-8},\cdots,10^{-3}\}
A
\hat{A}
L_{1}
W
\hat{A}
L_{1}
A
A
W
W
L_{1}
\sum_{i,k}|\hat{A}_{ik}-A_{ik}|
\sum_{k,j}|\hat{W}_{kj}-W_{kj}|
p
W
\hat{A}
\hat{A}
p
L_{1}
\sum_{i,k}|\hat{A}_{ik}-A_{ik}|
\sum_{k,j}|\hat{W}_{kj}-W_{kj}|
p
W
\hat{A}
\hat{A}
p
p
p
\log_{10}(\text{p-value})
\{(i,l):Y_{il}=0\}
S_{il}=0
i
l
S
\widetilde{\pi}_{il}=\mathbb{E}(S_{il}~{}|~{}X,Y,\theta)\,,
\theta
\widetilde{\pi}_{il}
Y\in\mathbb{R}^{N\times L}
A
A
Y
A
A
L_{1}
\sum_{i,k}|\hat{A}_{ik}-A_{ik}|
A
L_{1}
\sum_{i,k}|\hat{A}_{ik}-A_{ik}|
K_{sc}
K_{bk}
N
K=\max\{K_{sc},K_{bk}\}
\hat{A}_{unif}\in\mathbb{R}^{N\times K}
\hat{W}_{unif}\in\mathbb{R}^{K\times M}
K_{sc}>K_{bk}
\hat{W}_{unif}
K_{sc}<K_{bk}
A
A
M=150
(\alpha)
\alpha=(1,...,K_{bk})
40
30
K_{sc}-1
W
K_{sc}>K_{bk}
K_{bk}
K_{sc}
K_{bk}
N=200
K
L_{1}
L_{1}
||\hat{A}_{\cdot,k}-A_{\cdot,k}||_{1}
||\hat{W}_{\cdot,k}-W_{\cdot,k}||_{1}
k
\hat{A}_{unif}
\hat{A}_{naive}
K_{sc}<K_{bk}
N=\{200,500,1000\}
K_{sc}=K_{bk}=3
N=200
K_{sc}
K_{bk}
N=200
K_{sc}
K_{bk}
K_{sc}=K_{bk}=3
N
K_{sc}=K_{bk}=3
N
L_{1}
A
W
K_{sc},K_{bk}\in\{3,4,5\}
N=200
N=\{200,500,1000\}
K_{sc}=K_{bk}=3
W
\hat{A}_{unif}
L_{1}
A
W
K_{sc},K_{bk}\in\{3,4,5\}
N=200
N=\{200,500,1000\}
K_{sc}=K_{bk}=3
W
\hat{A}_{unif}
\log_{2}(x+1)
2^{x}-1
5.5\times 10^{6}
2.1\times 10^{5}
3.2\times 10^{5}(sd=1.6\times 10^{4})
1.4\times 10^{4}(sd=4.3\times 10^{3})
\mathbb{E}(S_{il}~{}|~{}X,Y,\theta)
A
\log_{2}
\log_{2}
\alpha
(2\times 10^{4},\,10^{4},\,7\times 10^{4})
\alpha
1.4\times 10^{4}
p
<10^{-5}
\hat{A}
k
(W_{kj})_{j}
(X_{ij}/R_{j})_{j}
i
k
(W_{kj})_{j}
(X_{ij}/R_{j})_{j}
i
N,M,L
K
K
K
K
K
X,Y
\displaystyle\begin{split}&W_{\cdot j}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}%
\textrm{Dirichlet}(\alpha)\,,~{}j=1,\cdots,M\,,\\
&Z_{rj}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}\textrm{Multinomial}(1,W_{\cdot
j%
})\,,~{}r=1,\cdots,R_{j}\,,\\
&d_{rj}\stackrel{{\scriptstyle indep.}}{{\sim}}\textrm{Multinomial}(1,A_{\cdot
Z%
_{rj}})\,,~{}r=1,\cdots,R_{j}\,,\\
&X_{ij}=\sum_{r=1}^{R_{j}}I_{\{d_{rj}=i\}}\,,~{}i=1,\cdots,N,~{}j=1,\cdots,M\,%
,\end{split}
\displaystyle\begin{split}&W_{\cdot j}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}%
\textrm{Dirichlet}(\alpha)\,,~{}j=1,\cdots,M\,,\\
&Z_{rj}\stackrel{{\scriptstyle i.i.d.}}{{\sim}}\textrm{Multinomial}(1,W_{\cdot
j%
})\,,~{}r=1,\cdots,R_{j}\,,\\
&d_{rj}\stackrel{{\scriptstyle indep.}}{{\sim}}\textrm{Multinomial}(1,A_{\cdot
Z%
_{rj}})\,,~{}r=1,\cdots,R_{j}\,,\\
&X_{ij}=\sum_{r=1}^{R_{j}}I_{\{d_{rj}=i\}}\,,~{}i=1,\cdots,N,~{}j=1,\cdots,M\,%
,\end{split}
Z
d
\mathbb{P}(Z_{rj}=k)=W_{kj}
\mathbb{P}(d_{rj}=i)=A_{i,Z_{rj}}
\tilde{Z}_{ij,k}:=\sum_{r:d_{rj}=i}I_{\{Z_{rj}=k\}}\,,~{}~{}\tilde{Z}_{ij}:=(%
\tilde{Z}_{ij,k})\in\mathbb{R}^{K}\,,
\displaystyle\begin{split}L_{bulk}(W,&Z,d,X~{}|~{}\alpha,A)\\
&=p(W|\alpha)p(Z|W)p(d|A,Z)p(X|d)\\
&=\prod_{j=1}^{M}\left\{\Gamma\left(\sum_{t=1}^{K}\alpha_{t}\right)\prod_{k=1}%
^{K}\frac{W_{kj}^{(\alpha_{k}-1)}}{\Gamma(\alpha_{k})}\cdot\prod_{r=1}^{R_{j}}%
\prod_{k=1}^{K}W_{kj}^{I_{\{Z_{rj}=k\}}}\cdot\right.\\
&\qquad\left.\cdot\prod_{k=1}^{K}\prod_{i=1}^{N}A_{ik}^{\sum_{r:d_{rj}=i}I_{\{%
Z_{rj}=k\}}}\cdot\prod_{i=1}^{N}I_{\{X_{ij}=\sum_{r=1}^{R_{j}}I_{\{d_{rj}=i\}}%
\}}\right\}\\
&=\prod_{j=1}^{M}\left\{\Gamma\left(\sum_{t=1}^{K}\alpha_{t}\right)\prod_{k=1}%
^{K}\frac{W_{kj}^{(\alpha_{k}-1)}}{\Gamma(\alpha_{k})}\cdot\right.\\
&\qquad\left.\cdot\prod_{i=1}^{N}\prod_{k=1}^{K}\left(W_{kj}A_{ik}\right)^{%
\tilde{Z}_{ij,k}}\cdot\prod_{i=1}^{N}I_{\{X_{ij}=\sum_{r=1}^{R_{j}}I_{\{d_{rj}%
=i\}}\}}\right\}\,.\\
\end{split}
\displaystyle\begin{split}L_{bulk}(W,&Z,d,X~{}|~{}\alpha,A)\\
&=p(W|\alpha)p(Z|W)p(d|A,Z)p(X|d)\\
&=\prod_{j=1}^{M}\left\{\Gamma\left(\sum_{t=1}^{K}\alpha_{t}\right)\prod_{k=1}%
^{K}\frac{W_{kj}^{(\alpha_{k}-1)}}{\Gamma(\alpha_{k})}\cdot\prod_{r=1}^{R_{j}}%
\prod_{k=1}^{K}W_{kj}^{I_{\{Z_{rj}=k\}}}\cdot\right.\\
&\qquad\left.\cdot\prod_{k=1}^{K}\prod_{i=1}^{N}A_{ik}^{\sum_{r:d_{rj}=i}I_{\{%
Z_{rj}=k\}}}\cdot\prod_{i=1}^{N}I_{\{X_{ij}=\sum_{r=1}^{R_{j}}I_{\{d_{rj}=i\}}%
\}}\right\}\\
&=\prod_{j=1}^{M}\left\{\Gamma\left(\sum_{t=1}^{K}\alpha_{t}\right)\prod_{k=1}%
^{K}\frac{W_{kj}^{(\alpha_{k}-1)}}{\Gamma(\alpha_{k})}\cdot\right.\\
&\qquad\left.\cdot\prod_{i=1}^{N}\prod_{k=1}^{K}\left(W_{kj}A_{ik}\right)^{%
\tilde{Z}_{ij,k}}\cdot\prod_{i=1}^{N}I_{\{X_{ij}=\sum_{r=1}^{R_{j}}I_{\{d_{rj}%
=i\}}\}}\right\}\,.\\
\end{split}
\displaystyle\begin{split}&p(W_{\cdot j}~{}|~{}\tilde{Z},X,\alpha,A)\propto%
\prod_{k=1}^{K}W_{kj}^{\left(\alpha_{k}+\sum_{i=1}^{N}\tilde{Z}_{ij,k}-1\right%
)}\,,\\
&p(\tilde{Z}_{ij}~{}|~{}W,X,\alpha,A)\propto\left[\prod_{k=1}^{K}\left(W_{kj}A%
_{ik}\right)^{\tilde{Z}_{ij,k}}\right]I_{\{\sum_{k=1}^{K}\tilde{Z}_{ij,k}=X_{%
ij}\}}\,.\end{split}
\displaystyle\begin{split}&p(W_{\cdot j}~{}|~{}\tilde{Z},X,\alpha,A)\propto%
\prod_{k=1}^{K}W_{kj}^{\left(\alpha_{k}+\sum_{i=1}^{N}\tilde{Z}_{ij,k}-1\right%
)}\,,\\
&p(\tilde{Z}_{ij}~{}|~{}W,X,\alpha,A)\propto\left[\prod_{k=1}^{K}\left(W_{kj}A%
_{ik}\right)^{\tilde{Z}_{ij,k}}\right]I_{\{\sum_{k=1}^{K}\tilde{Z}_{ij,k}=X_{%
ij}\}}\,.\end{split}
\displaystyle\begin{split}&W_{\cdot j}~{}|~{}\tilde{Z},X\sim\textrm{Dirichlet}%
\left(\alpha+\sum_{i=1}^{N}\tilde{Z}_{ij}\right)\,,\\
&\tilde{Z}_{ij}~{}|~{}W,X\sim\textrm{Multinomial}\left(X_{ij},\frac{A_{i\cdot}%
\odot W_{\cdot j}}{\sum_{k=1}^{K}A_{ik}W_{kj}}\right)\,,\end{split}
\displaystyle\begin{split}&W_{\cdot j}~{}|~{}\tilde{Z},X\sim\textrm{Dirichlet}%
\left(\alpha+\sum_{i=1}^{N}\tilde{Z}_{ij}\right)\,,\\
&\tilde{Z}_{ij}~{}|~{}W,X\sim\textrm{Multinomial}\left(X_{ij},\frac{A_{i\cdot}%
\odot W_{\cdot j}}{\sum_{k=1}^{K}A_{ik}W_{kj}}\right)\,,\end{split}
\odot
\displaystyle\begin{split}&(\kappa_{l},\tau_{l})\sim N(\mu,\Sigma),~{}\textrm{%
where }\mu=(\mu_{\kappa},\mu_{\tau}),\Sigma=\textrm{Diag}(\sigma_{\kappa}^{2},%
\sigma_{\tau}^{2})\,,\\
&S_{il}\,|\,\kappa_{l},\tau_{l}\sim\textrm{Bernoulli}(\textrm{logistic}\left(%
\psi_{il}\right))\,,~{}\textrm{where }\psi_{il}=\kappa_{l}+\tau_{l}A_{i,G_{l}}%
\,.\end{split}
\displaystyle\begin{split}&(\kappa_{l},\tau_{l})\sim N(\mu,\Sigma),~{}\textrm{%
where }\mu=(\mu_{\kappa},\mu_{\tau}),\Sigma=\textrm{Diag}(\sigma_{\kappa}^{2},%
\sigma_{\tau}^{2})\,,\\
&S_{il}\,|\,\kappa_{l},\tau_{l}\sim\textrm{Bernoulli}(\textrm{logistic}\left(%
\psi_{il}\right))\,,~{}\textrm{where }\psi_{il}=\kappa_{l}+\tau_{l}A_{i,G_{l}}%
\,.\end{split}
\frac{(e^{\psi})^{a}}{(1+e^{\psi})^{b}}=2^{-b}e^{c\psi}\int_{0}^{\infty}e^{-%
\omega\psi^{2}/2}p(\omega)d\omega,~{}~{}\forall\psi\in\mathbb{R}\,,
a,b>0
c=a-b/2
\omega\sim PG(0,1)
\psi_{il}=\kappa_{l}+\tau_{l}A_{i,G_{l}}\,,
\displaystyle L_{sc}(Y,\kappa,\tau,S~{}|~{}\mu_{\kappa},\sigma_{\kappa}^{2},%
\mu_{\tau},\sigma_{\tau}^{2},A)
\displaystyle L_{sc}(
\displaystyle Y,\kappa,\tau,S~{}|~{}\mu_{\kappa},\sigma_{\kappa}^{2},\mu_{\tau%
},\sigma_{\tau}^{2},A)
\displaystyle=p(Y|S,A)p(S|\kappa,\tau)p(\kappa|\mu_{\kappa},\sigma_{\kappa}^{2%
})p(\tau|\mu_{\tau},\sigma_{\tau}^{2})
\displaystyle=p(Y|S,A)p(S|\kappa,\tau)p(\kappa|\mu_{\kappa},\sigma_{\kappa}^{2%
})p(\tau|\mu_{\tau},\sigma_{\tau}^{2})
\displaystyle\propto\prod_{l=1}^{L}\left\{\frac{R_{l}!}{\prod_{i=1}^{N}Y_{il}!%
}\prod_{i=1}^{N}\left[\left(\frac{A_{i,G_{l}}}{\sum_{n=1}^{N}S_{nl}A_{n,G_{l}}%
}\right)^{Y_{il}S_{il}}\delta_{0}(Y_{il})^{(1-S_{il})}\right]\cdot\right.
\displaystyle\propto\prod_{l=1}^{L}\left\{\frac{R_{l}!}{\prod_{i=1}^{N}Y_{il}!%
}\prod_{i=1}^{N}\left[\left(\frac{A_{i,G_{l}}}{\sum_{n=1}^{N}S_{nl}A_{n,G_{l}}%
}\right)^{Y_{il}S_{il}}\delta_{0}(Y_{il})^{(1-S_{il})}\right]\cdot\right.
\displaystyle\qquad\cdot\left.\left[\prod_{i=1}^{N}\frac{\left(e^{\psi_{il}}%
\right)^{S_{il}}}{1+e^{\psi_{il}}}\right]\cdot\frac{1}{\sigma_{\kappa}\sigma_{%
\tau}}\exp\left\{-\frac{(\kappa_{l}-\mu_{\kappa})^{2}}{2\sigma_{\kappa}^{2}}-%
\frac{(\tau_{l}-\mu_{\tau})^{2}}{\sigma_{\tau}^{2}}\right\}\right\}
\displaystyle\qquad\cdot\left.\left[\prod_{i=1}^{N}\frac{\left(e^{\psi_{il}}%
\right)^{S_{il}}}{1+e^{\psi_{il}}}\right]\cdot\frac{1}{\sigma_{\kappa}\sigma_{%
\tau}}\exp\left\{-\frac{(\kappa_{l}-\mu_{\kappa})^{2}}{2\sigma_{\kappa}^{2}}-%
\frac{(\tau_{l}-\mu_{\tau})^{2}}{\sigma_{\tau}^{2}}\right\}\right\}
\displaystyle\propto\prod_{l=1}^{L}\left\{\left[\frac{R_{l}!}{\prod_{i=1}^{N}Y%
_{il}!}\frac{\prod_{i=1}^{N}\left(A_{i,G_{l}}\right)^{Y_{il}S_{il}}\delta_{0}(%
Y_{il})^{(1-S_{il})}}{\left(\sum_{n=1}^{N}S_{nl}A_{n,G_{l}}\right)^{R_{l}}}%
\right]\cdot\right.
\displaystyle\propto\prod_{l=1}^{L}\left\{\left[\frac{R_{l}!}{\prod_{i=1}^{N}Y%
_{il}!}\frac{\prod_{i=1}^{N}\left(A_{i,G_{l}}\right)^{Y_{il}S_{il}}\delta_{0}(%
Y_{il})^{(1-S_{il})}}{\left(\sum_{n=1}^{N}S_{nl}A_{n,G_{l}}\right)^{R_{l}}}%
\right]\cdot\right.
\displaystyle\qquad\cdot\left.\left[\prod_{i=1}^{N}e^{\psi_{il}(S_{il}-1/2)}%
\int_{0}^{\infty}e^{-\omega_{il}\psi_{il}^{2}/2}p(\omega_{il})d\omega_{il}%
\right]\cdot\right.
\displaystyle\qquad\cdot\left.\left[\prod_{i=1}^{N}e^{\psi_{il}(S_{il}-1/2)}%
\int_{0}^{\infty}e^{-\omega_{il}\psi_{il}^{2}/2}p(\omega_{il})d\omega_{il}%
\right]\cdot\right.
\displaystyle\qquad\cdot\left.(\sigma_{\kappa}^{2}\sigma_{\tau}^{2})^{-1/2}%
\exp\left\{-\frac{(\kappa_{l}-\mu_{\kappa})^{2}}{2\sigma_{\kappa}^{2}}-\frac{(%
\tau_{l}-\mu_{\tau})^{2}}{2\sigma_{\tau}^{2}}\right\}\right\}
\displaystyle\qquad\cdot\left.(\sigma_{\kappa}^{2}\sigma_{\tau}^{2})^{-1/2}%
\exp\left\{-\frac{(\kappa_{l}-\mu_{\kappa})^{2}}{2\sigma_{\kappa}^{2}}-\frac{(%
\tau_{l}-\mu_{\tau})^{2}}{2\sigma_{\tau}^{2}}\right\}\right\}
\displaystyle\propto\int_{0}^{\infty}p(Y,\kappa,\tau,S,\omega)p(\omega)d\omega
\displaystyle\propto\int_{0}^{\infty}p(Y,\kappa,\tau,S,\omega)p(\omega)d\omega
\delta_{0}(y)=I_{\{y=0\}}
\omega_{il}\sim PG(0,1)
\omega_{il},\kappa_{l},\tau_{l}
\displaystyle\begin{split}&\omega_{il}\,|\,\omega_{-(il)},S,Y,\kappa,\tau~{}%
\sim~{}\textrm{Polya-Gamma}(1,\psi_{il})\,,\\
&(\kappa_{l},\tau_{l})\,|\,\omega,S,Y~{}\sim~{}N(m_{\omega l},V_{\omega l}^{-1%
})\,,\\
\end{split}
\displaystyle\begin{split}&\omega_{il}\,|\,\omega_{-(il)},S,Y,\kappa,\tau~{}%
\sim~{}\textrm{Polya-Gamma}(1,\psi_{il})\,,\\
&(\kappa_{l},\tau_{l})\,|\,\omega,S,Y~{}\sim~{}N(m_{\omega l},V_{\omega l}^{-1%
})\,,\\
\end{split}
\displaystyle V_{\omega l}=\left(\begin{array}[]{cc}\sum_{i=1}^{N}\omega_{il}+%
\sigma_{\kappa}^{-2}&\sum_{i=1}^{N}\omega_{il}A_{i,G_{l}}\\
\sum_{i=1}^{N}\omega_{il}A_{i,G_{l}}&\sum_{i=1}^{N}\omega_{il}A_{i,G_{l}}^{2}+%
\sigma_{\tau}^{-2}\end{array}\right),
\displaystyle m_{\omega l}=V_{\omega l}^{-1}\left(\begin{array}[]{c}\sum_{i=1}%
^{N}S_{il}-N/2+\mu_{\kappa}/\sigma_{\kappa}^{2}\\
\sum_{i=1}^{N}S_{il}A_{i,G_{l}}-1/2+\mu_{\tau}/\sigma_{\tau}^{2}\end{array}%
\right)\,.
S_{il}
S_{il}
\frac{P(S_{il}=1~{}|~{}S_{-(il)},Y,\psi)}{P(S_{il}=0~{}|~{}S_{-(il)},Y,\psi)}=%
\frac{(A_{i,G_{l}})^{Y_{il}}e^{\psi_{il}}}{\delta_{0}(Y_{il})}\cdot\left(\frac%
{\sum_{n\neq i}^{N}S_{nl}A_{n,G_{l}}}{\sum_{n\neq i}^{N}S_{nl}A_{n,G_{l}}+A_{i%
,G_{l}}}\right)^{R_{l}}\,.
S_{il}\,|\,S_{-(il)},\omega,\kappa,\tau,Y~{}\sim~{}\textrm{Bernoulli}(b_{il})\,,
b_{il}=\begin{cases}1,&\textrm{if }Y_{il}>0\\
\textrm{logit}\left(\psi_{il}+R_{l}\log\left(\frac{\sum_{n\neq i}S_{nl}A_{n,G_%
{l}}}{A_{i,G_{l}}+\sum_{n\neq i}S_{nl}A_{n,G_{l}}}\right)\right),&\textrm{if }%
Y_{il}=0\end{cases}\,.
\mathbb{E}\left[\log\left(\sum_{n=1}^{N}S_{nl}A_{n,G_{l}}\right)\right]
-\mathbb{E}\left[\log\left(\sum_{n}X_{n}\right)\right]\geq-\log u-\frac{\sum_{%
n}\mathbb{E}[X_{n}]-u}{u}\,,
u=\sum_{n}\mathbb{E}[X_{n}]
X_{n}
\displaystyle\begin{split}\mathbb{E}_{Q}&\left[\log p(X,Y,W,\tilde{Z},\kappa,%
\tau,S,\omega|\theta)\right]\geq\textrm{const.}+\\
&\sum_{j=1}^{M}\left\{\log\Gamma\left(\sum_{k=1}^{K}\alpha_{k}\right)+\sum_{k=%
1}^{K}\left[(\alpha_{k}-1)\mathbb{E}_{Q}\left[\log W_{kj}\right]-\log\Gamma(%
\alpha_{k})\right]\right.\\
&\quad\left.+\sum_{i=1}^{N}\sum_{k=1}^{K}\left[\mathbb{E}_{Q}\left(\tilde{Z}_{%
ij,k}\log W_{kj}\right)+\mathbb{E}_{Q}\left(\tilde{Z}_{ij,k}\right)\log A_{ik}%
\right]\right\}+\\
&\sum_{l=1}^{L}\left\{\sum_{i=1}^{N}\mathbb{E}_{Q}(S_{il})Y_{il}\log(A_{i,G_{l%
}})-R_{l}\left(\sum_{i=1}^{N}\frac{\mathbb{E}_{Q}(S_{il})A_{i,G_{l}}}{u_{l}}+%
\log u_{l}\right)\right.\\
&\quad\left.+\sum_{i=1}^{N}\mathbb{E}_{Q}\left[\left(S_{il}-\frac{1}{2}\right)%
(\kappa_{l}+\tau_{l}A_{i,G_{l}})-\frac{\omega_{il}(\kappa_{l}+\tau_{l}A_{i,G_{%
l}})^{2}}{2}\right]\right.\\
&\quad\left.-\frac{1}{2}\left(\log\sigma_{\kappa}^{2}+\log\sigma_{\tau}^{2}%
\right)-\frac{\mathbb{E}_{Q}\left[(\kappa_{l}-\mu_{\kappa})^{2}\right]}{2%
\sigma_{\kappa}^{2}}-\frac{\mathbb{E}_{Q}\left[(\tau_{l}-\mu_{\tau})^{2}\right%
]}{2\sigma_{\tau}^{2}}\right\}\,,\end{split}
\displaystyle\begin{split}\mathbb{E}_{Q}&\left[\log p(X,Y,W,\tilde{Z},\kappa,%
\tau,S,\omega|\theta)\right]\geq\textrm{const.}+\\
&\sum_{j=1}^{M}\left\{\log\Gamma\left(\sum_{k=1}^{K}\alpha_{k}\right)+\sum_{k=%
1}^{K}\left[(\alpha_{k}-1)\mathbb{E}_{Q}\left[\log W_{kj}\right]-\log\Gamma(%
\alpha_{k})\right]\right.\\
&\quad\left.+\sum_{i=1}^{N}\sum_{k=1}^{K}\left[\mathbb{E}_{Q}\left(\tilde{Z}_{%
ij,k}\log W_{kj}\right)+\mathbb{E}_{Q}\left(\tilde{Z}_{ij,k}\right)\log A_{ik}%
\right]\right\}+\\
&\sum_{l=1}^{L}\left\{\sum_{i=1}^{N}\mathbb{E}_{Q}(S_{il})Y_{il}\log(A_{i,G_{l%
}})-R_{l}\left(\sum_{i=1}^{N}\frac{\mathbb{E}_{Q}(S_{il})A_{i,G_{l}}}{u_{l}}+%
\log u_{l}\right)\right.\\
&\quad\left.+\sum_{i=1}^{N}\mathbb{E}_{Q}\left[\left(S_{il}-\frac{1}{2}\right)%
(\kappa_{l}+\tau_{l}A_{i,G_{l}})-\frac{\omega_{il}(\kappa_{l}+\tau_{l}A_{i,G_{%
l}})^{2}}{2}\right]\right.\\
&\quad\left.-\frac{1}{2}\left(\log\sigma_{\kappa}^{2}+\log\sigma_{\tau}^{2}%
\right)-\frac{\mathbb{E}_{Q}\left[(\kappa_{l}-\mu_{\kappa})^{2}\right]}{2%
\sigma_{\kappa}^{2}}-\frac{\mathbb{E}_{Q}\left[(\tau_{l}-\mu_{\tau})^{2}\right%
]}{2\sigma_{\tau}^{2}}\right\}\,,\end{split}
u_{l}=\sum_{i=1}^{N}A_{i,G_{l}}\mathbb{E}_{Q}(S_{il})
\mathbb{E}_{Q}
(X,Y)
\theta=(A,\alpha,\mu_{\kappa},\sigma_{\kappa}^{2},\mu_{\tau},\sigma_{\tau}^{2})
\mathbb{E}_{Q}[S_{il}]=1~{}~{}\textrm{when}~{}~{}Y_{il}>0\,.
\alpha
\epsilon_{\alpha}>0
\textrm{Proj}(\alpha_{k})=\max\{\epsilon_{\alpha},~{}\alpha_{k}\}\,.
A
\mathcal{S}_{\epsilon}=\left\{u=(u_{1},\cdots,u_{N})\in\mathbb{R}^{N}:\sum_{n=%
1}^{N}u_{n}=1,~{}u_{n}\geq\epsilon,~{}\forall n\right\}\,,
\epsilon>0
\epsilon=0
\epsilon
A
v\in\mathbb{R}^{N}
\epsilon\geq 0
v
\tilde{v}
\tilde{v}_{1}\geq\tilde{v}_{2}\geq\cdots\geq\tilde{v}_{N}
\rho=\max\left\{1\leq j\leq N:\tilde{v}_{j}+\frac{1}{j}(1-\sum_{i=1}^{j}\tilde%
{v}_{i}-(N-j)\epsilon)>\epsilon\right\}
\lambda=\frac{1}{\rho}\left(1-\sum_{i=1}^{\rho}\tilde{v}_{i}-(N-\rho)\epsilon\right)
v^{*}_{i}=\max\{\tilde{v}_{i}+\lambda,~{}\epsilon\}
v^{*}=(v^{*}_{i})\in\mathbb{R}^{N}
A
\hat{A}^{naive}
\hat{A}_{ik}^{naive}=\frac{1}{\#\{l:G_{l}=k\}}\sum_{l:G_{l}=k}\frac{Y_{il}}{R_%
{l}}\,.
\hat{A}^{naive}
A
\alpha
\alpha
\mathbf{1}^{K}
\alpha_{0}=(1,1,1)
\mu_{\kappa}
\mu_{\tau}
\hat{A}_{ik}^{naive}
\left\{1-\textrm{logistic}\left(\kappa_{l}+\tau_{l}\hat{A}_{i,G_{l}}^{naive}%
\right)\right\}_{i,l}
\mu_{\kappa}
\mu_{\kappa,0}=\textrm{logit}(0.4)
60\%
A_{il}=0
\mu_{\tau}
\mu_{\tau,0}=(\textrm{logit}(0.7)-\mu_{\kappa,0})/\bar{A}^{naive}
\bar{A}^{naive}=\sum_{i,k}\hat{A}_{ik}^{naive}/(NK)
\frac{1}{NK}\sum_{i,k}(\mu_{\kappa,0}+\mu_{\tau,0}\hat{A}_{i,k}^{naive})=30\%
W
R_{j}\sim\textrm{Poisson}(\lambda)
X
R_{j}
X_{ij}|A,W\sim\textrm{Poisson}(\lambda(AW)_{ij})\,,
p(X,W|A,\alpha)\propto\prod_{i=1}^{N}\prod_{j=1}^{M}\frac{\left((AW)_{ij}%
\lambda\right)^{X_{ij}}\exp\{-\lambda(AW)_{ij}\}}{X_{ij}!}\cdot\prod_{j=1}^{M}%
\prod_{k=1}^{K}W_{kj}^{(\alpha_{k}-1)}\,.
W
\begin{split}&\max_{W}\sum_{i,j}\left[X_{ij}\log((AW)_{ij})-\lambda(AW)_{ij}%
\right]+\sum_{k,j}(\alpha_{k}-1)\log W_{kj}\,,\\
&\textrm{subject to }\sum_{k}W_{kj}=1\,.\end{split}
W_{kj}
\begin{cases}\sum_{i}\frac{X_{ij}A_{ik}}{(AW)_{ij}}-\lambda+\frac{\alpha_{k}-1%
}{W_{kj}}+\eta_{j}=0\,,\\
\sum_{k}W_{kj}=1\,,\end{cases}
\eta_{j}
\sum_{k}W_{kj}=1
W
\begin{split}W_{kj}\propto W_{kj}\sum_{i}\frac{X_{ij}A_{ik}}{(AW)_{ij}}+\alpha%
_{k}-1\,,~{}~{}\textrm{s.t. }\sum_{k}W_{kj}=1\end{split}
W
\alpha_{k}=1
