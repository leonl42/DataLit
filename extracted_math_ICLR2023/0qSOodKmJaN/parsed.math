\mathbf{y}
\mathbf{x}
P(\mathbf{y}|\mathbf{x})
P_{\mathbf{\theta}}(\mathbf{y}|\mathbf{x})=\prod_{t=0}^{l}P_{\mathbf{\theta}}(%
y^{t}|y^{0}...y^{t-1},\mathbf{x})
l
L=\sum_{i}^{N}-log(P_{\mathbf{\theta}}(\mathbf{y}_{i}|\mathbf{x}_{i}))=\sum_{i%
}^{N}\sum_{t=0}^{l}-log(P_{\mathbf{\theta}}(y_{i}^{t}|y_{i}^{0}...y_{i}^{t-1},%
\mathbf{x}_{i}))
N
R_{m}
R_{m}
m
\{\hat{\mathbf{y}}\}_{m}
P_{\mathbf{\theta}_{ft}}(\mathbf{y}|\mathbf{x})
\{\mathbf{x},\bar{\mathbf{y}}\}_{n}
\mathcal{L}(\mathbf{\theta})=\sum_{b}L^{\mathrm{cal}}(\mathbf{\theta},s;%
\mathbf{x},\bar{\mathbf{y}},\{\hat{\mathbf{y}}\}_{m})+\lambda L^{\mathrm{reg}}%
(\mathbf{\theta},\mathbf{\theta}_{ft};\mathbf{x},\bar{\mathbf{y}})
L^{\mathrm{cal}}
L^{\mathrm{reg}}
s=s(\hat{\mathbf{y}},\bar{\mathbf{y}};\mathbf{x})
\hat{\mathbf{y}}
\bar{\mathbf{y}}
\mathbf{x}
s
L^{\mathrm{cal}}
L^{\mathrm{reg}}
\hat{\mathbf{y}}\sim P_{\mathbf{\theta}}(\mathbf{y}|\mathbf{x})
\mathbf{x},\bar{\mathbf{y}}\in\{\mathbf{x},\bar{\mathbf{y}}\}_{n}
m
\{\hat{\mathbf{y}}\sim P_{\mathbf{\theta}_{ft}}(\mathbf{y}|\mathbf{x})\}_{m}
\mathbf{\theta}\leftarrow\mathbf{\theta}_{ft}
\{\mathbf{x},\bar{\mathbf{y}},\{\hat{\mathbf{y}}\}_{m}\}_{b}\sim\{\mathbf{x},%
\bar{\mathbf{y}},\{\hat{\mathbf{y}}\}_{m}\}_{n}
\mathbf{\theta}\leftarrow\mathbf{\theta}-lr\nabla_{\mathbf{\theta}}\mathcal{L}%
(\mathbf{\theta})
\mathbf{y}
\mathbf{e}^{L\times D}=emb(\mathbf{y},\mathbf{x})
L
D
\hat{\mathbf{y}}
\hat{\mathbf{e}}
\bar{\mathbf{y}}
\bar{\mathbf{e}}
n
F_{n}
F_{n},P_{n},R_{n}
\begin{split}s_{\mathbf{\theta}}(\hat{\mathbf{y}},\bar{\mathbf{y}};\mathbf{x})%
=\sum_{n}F_{n}(\hat{\mathbf{e}},\bar{\mathbf{e}})=\sum_{n}F_{n}(emb(\hat{%
\mathbf{y}},\mathbf{x}),emb(\bar{\mathbf{y}},\mathbf{x}))~{}~{}~{}~{}~{}~{}~{}%
~{}F_{n}=2\frac{P_{n}\times R_{n}}{P_{n}+R_{n}}\\
P_{n}(\hat{\mathbf{e}},\bar{\mathbf{e}})=\frac{1}{|\hat{\mathbf{e}}|}\sum_{%
\hat{\mathbf{e}}_{i:i+n}}\underset{\bar{\mathbf{e}}_{j:j+n}}{\max}~{}\hat{%
\mathbf{e}}_{i:i+n}^{T}\bar{\mathbf{e}}_{j:j+n}~{}~{}~{}~{}~{}~{}~{}~{}R_{n}(%
\hat{\mathbf{e}},\bar{\mathbf{e}})=\frac{1}{|\bar{\mathbf{e}}|}\sum_{\bar{%
\mathbf{e}}_{j:j+n}}\underset{\hat{\mathbf{e}}_{i:i+n}}{\max}~{}\hat{\mathbf{e%
}}_{i:i+n}^{T}\bar{\mathbf{e}}_{j:j+n}\end{split}
n=1,2,4,8
1
s(\hat{\mathbf{y}},\bar{\mathbf{y}};\mathbf{x})
s(\hat{\mathbf{y}},\bar{\mathbf{y}})
L^{\mathrm{cal}}(\mathbf{\theta},s;\mathbf{x},\bar{\mathbf{y}},\{\hat{\mathbf{%
y}}\}_{m})
P_{\mathbf{\theta}}(\hat{\mathbf{y}}|\mathbf{x})
s(\hat{\mathbf{y}},\bar{\mathbf{y}};\mathbf{x})
\mathbf{x}
\bar{\mathbf{y}}
\{\hat{\mathbf{y}}\}_{m}
\hat{\mathbf{y}}_{+},\hat{\mathbf{y}}_{-}
\{\hat{\mathbf{y}}\}_{m}
s(\hat{\mathbf{y}}_{+},\bar{\mathbf{y}};\mathbf{x})>s(\hat{\mathbf{y}}_{-},%
\bar{\mathbf{y}};\mathbf{x})
i,j
\hat{\mathbf{y}}_{i},\hat{\mathbf{y}}_{j}
\{\hat{\mathbf{y}}\}_{m}
s(\hat{\mathbf{y}},\bar{\mathbf{y}};\mathbf{x})
\begin{split}L^{\mathrm{cal}}_{\mathrm{rank}}&=\max(0,\beta-\log P_{\mathbf{%
\theta}}(\hat{\mathbf{y}}_{+}|\mathbf{x})+\log P_{\mathbf{\theta}}(\hat{%
\mathbf{y}}_{-}|\mathbf{x}))\\
L^{\mathrm{cal}}_{\mathrm{margin}}&=\max(0,\beta(s(\hat{\mathbf{y}}_{+},\bar{%
\mathbf{y}};\mathbf{x})-s(\hat{\mathbf{y}}_{-},\bar{\mathbf{y}};\mathbf{x}))-%
\log P_{\mathbf{\theta}}(\hat{\mathbf{y}}_{+}|\mathbf{x})+\log P_{\mathbf{%
\theta}}(\hat{\mathbf{y}}_{-}|\mathbf{x}))\\
L^{\mathrm{cal}}_{\mathrm{list~{}rank}}&=\Sigma_{i<j}\max\left(0,\beta|i-j|-%
\log P_{\mathbf{\theta}}(\hat{\mathbf{y}}_{i}|\mathbf{x})+\log P_{\mathbf{%
\theta}}(\hat{\mathbf{y}}_{j}|\mathbf{x})\right)\\
L^{\mathrm{cal}}_{\mathrm{reward}}&=\Sigma_{i}\left[-s(\hat{\mathbf{y}}_{i},%
\bar{\mathbf{y}};\mathbf{x})*\frac{P_{\mathbf{\theta}}(\hat{\mathbf{y}}_{i}|%
\mathbf{x})}{\sum_{i}P_{\mathbf{\theta}}(\hat{\mathbf{y}}_{i}|\mathbf{x})}%
\right]\end{split}
\beta
L^{\mathrm{reg}}
L^{\mathrm{reg}}_{\mathrm{ce}}=\sum_{t}-\log P_{\mathbf{\theta}}(\bar{y}_{t}|%
\bar{\mathbf{y}}_{t-1},\mathbf{x})~{}~{}~{}~{}~{}L^{\mathrm{reg}}_{\mathrm{kl}%
}=\sum_{t}P_{\mathbf{\theta}}(\bar{y}_{t}|\bar{\mathbf{y}}_{t-1},\mathbf{x})%
\log\frac{P_{\mathbf{\theta}}(\bar{y}_{t}|\bar{\mathbf{y}}_{t-1},\mathbf{x})}{%
P_{\mathbf{\theta}_{ft}}(\bar{y}_{t}|\bar{\mathbf{y}}_{t-1},\mathbf{x})}\\

p
\text{PEGASUS}_{\text{SMALL}}
\text{PEGASUS}_{\text{BASE}}
\text{PEGASUS}_{\text{LARGE}}
\text{PEGASUS}_{\text{2B}}
4096
lr=10^{-4}
\text{PEGASUS}_{\text{LARGE}}
R_{m}
R_{m}=\frac{1}{4}\sum_{d}\sqrt[3]{R_{1}R_{2}R_{L}}
\text{PEGASUS}_{\text{2B}}
2.5M
\Delta
R_{m}
\Delta
R_{m}
\Delta
s_{\mathbf{\theta}}(\hat{\mathbf{y}},\bar{\mathbf{y}};\mathbf{x})
emb(\mathbf{y},\mathbf{x})
\beta
\alpha
\alpha
\alpha
\alpha
\Delta
\text{PEGASUS}_{\text{2B}}
lr
\text{PEGASUS}_{\text{2B}}
\dagger
\text{PEGASUS}_{\text{2B}}
\dagger
\dagger
\dagger
\text{PEGASUS}_{\text{2B}}
\text{PEGASUS}_{\text{2B}}
\text{PEGASUS}_{\text{SMALL}}
\text{PEGASUS}_{\text{BASE}}
\text{PEGASUS}_{\text{LARGE}}
\text{PEGASUS}_{\text{2B}}
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
s_{tok}(\mathbf{y},\hat{\mathbf{y}})
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\beta
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\beta
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\beta
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\beta
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\beta
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\beta
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\beta
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\alpha
\rightarrow
\rightarrow
\rightarrow
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\rightarrow
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\rightarrow
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\rightarrow
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\rightarrow
\rightarrow
\rightarrow
\rightarrow
\rightarrow
\rightarrow
\rightarrow
\alpha
\alpha
\alpha
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\beta
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
\beta
\begin{split}total\_C&=C_{enc}\times n_{enc-ctx}+C_{dec}\times n_{dec-ctx}%
\times m\\
C_{enc}&=2N_{enc}+2n_{enc-layer}n_{enc-ctx}d_{enc-attn}\\
C_{dec}&=2N_{dec}+n_{dec-layer}n_{dec-ctx}d_{dec-attn}\\
\end{split}
m
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
lr
\beta
\lambda
\beta
lr*\lambda
1e-5
lr
s_{\theta}(\mathbf{y},\hat{\mathbf{y}},\mathbf{x})
10^{-5}
10^{-5}
10^{-5}
10^{-6}
3\times 10^{-6}
10^{-5}
10^{-6}
10^{-5}
