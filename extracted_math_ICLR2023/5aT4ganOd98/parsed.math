M\doteq\langle\mathcal{S},\mathcal{A},T,R,\mu,\gamma\rangle
\mathcal{S}
\mathcal{A}
T:\mathcal{S}\times\mathcal{A}\rightarrow\mathcal{P}(\mathcal{S})
{R}:\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}
\mu:\mathcal{S}\rightarrow[0,1]
\gamma\in(0,1)
\pi:\mathcal{S}\rightarrow\mathcal{P}(\mathcal{A})
\pi
T
\rho^{\pi}(s,a)\doteq(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}\Pr(s_{h}=s|T,\pi,%
\mu)\pi(a|s)
\max_{\pi\in\Pi}J(\pi)\doteq\mathbb{E}_{s,a\sim\rho^{\pi}}[{R}(s,a)]
\Pi
\mathcal{A}
\mathcal{S}
1/(1-\gamma)
\max_{\pi\in\Pi}\mathbb{E}_{s,a\sim\rho^{\pi}}[{R}(s,a)/(1-\gamma)]
\pi^{E}
\displaystyle\min_{{r}\in\mathcal{R}}\left(\max_{\pi\in\Pi}\alpha{H}(\pi)+%
\mathbb{E}_{s,a\sim\rho^{\pi}}[{r}(s,a)]\right)-\mathbb{E}_{s,a\sim\rho^{E}}[{%
r}(s,a)]+\psi(r),
\displaystyle\min_{{r}\in\mathcal{R}}\left(\max_{\pi\in\Pi}\alpha{H}(\pi)+%
\mathbb{E}_{s,a\sim\rho^{\pi}}[{r}(s,a)]\right)-\mathbb{E}_{s,a\sim\rho^{E}}[{%
r}(s,a)]+\psi(r),
{H}(\pi)\doteq-\iint\rho^{\pi}(s,a)\log\pi(a|s)\dif s\dif a
\gamma
\mathcal{R}
\alpha\geq 0
\psi:\mathbb{R}^{\mathcal{S}\times\mathcal{A}}\rightarrow\mathbb{R}\cup\{\infty\}
\mathcal{D}=\mathcal{D}_{E}\cup\mathcal{D}_{B}
\mathcal{D}_{E}\doteq\{(s_{i},a_{i},s^{\prime}_{i})\}^{D_{E}}_{i=1}
\mathcal{D}_{B}\doteq\{(s_{i},a_{i},s^{\prime}_{i})\}^{D_{B}}_{i=1}
\pi^{E}
\pi^{B}
\widehat{T}
\pi
\widehat{T}
\mathcal{D}_{E}
\mathcal{D}_{B}
{r}
\displaystyle L({r}|\pi)\doteq\underbrace{\vphantom{\big{(}\big{)}}{\color[rgb%
]{0,0,1}Z_{\beta}}\mathbb{E}_{s,a\sim{\color[rgb]{0,0,1}\hat{\rho}^{\pi}}}[{r}%
(s,a)]}_{\textrm{penalized on model rollouts}}-\underbrace{\vphantom{\big{(}%
\big{)}}\mathbb{E}_{s,a\sim\tilde{\rho}^{E}}[{r}(s,a)]}_{\textrm{increased on %
expert data}}-\underbrace{\vphantom{\big{(}\big{)}}\mathbb{E}_{s,a\sim{\color[%
rgb]{0,0,1}\tilde{\rho}^{D}}}[{\color[rgb]{0,0,1}{\beta}(s,a)}{r}(s,a)]}_{%
\mathclap{\textrm{weighting expert and diverse data}}}+\underbrace{\vphantom{%
\big{(}\big{)}}{\color[rgb]{0,0,1}Z_{\beta}}\psi({r})}_{\mathclap{\textrm{%
regularizer}}},
\displaystyle L({r}|\pi)\doteq\underbrace{\vphantom{\big{(}\big{)}}{\color[rgb%
]{0,0,1}Z_{\beta}}\mathbb{E}_{s,a\sim{\color[rgb]{0,0,1}\hat{\rho}^{\pi}}}[{r}%
(s,a)]}_{\textrm{penalized on model rollouts}}-\underbrace{\vphantom{\big{(}%
\big{)}}\mathbb{E}_{s,a\sim\tilde{\rho}^{E}}[{r}(s,a)]}_{\textrm{increased on %
expert data}}-\underbrace{\vphantom{\big{(}\big{)}}\mathbb{E}_{s,a\sim{\color[%
rgb]{0,0,1}\tilde{\rho}^{D}}}[{\color[rgb]{0,0,1}{\beta}(s,a)}{r}(s,a)]}_{%
\mathclap{\textrm{weighting expert and diverse data}}}+\underbrace{\vphantom{%
\big{(}\big{)}}{\color[rgb]{0,0,1}Z_{\beta}}\psi({r})}_{\mathclap{\textrm{%
regularizer}}},
{\tilde{\rho}^{D}(s,a)\doteq(|\mathcal{D}_{E}(s,a)|+|\mathcal{D}_{B}(s,a)|)/(D%
_{E}+D_{B})}
(s,a)
\mathcal{D}=\mathcal{D}_{E}\cup\mathcal{D}_{B}
\tilde{\rho}^{E}\doteq|\mathcal{D}_{E}(s,a)|/D_{E}
\mathcal{D}_{E}
\hat{\rho}^{\pi}
\pi
\widehat{T}
\psi
\beta(s,a)
\beta(s,a)
\beta(s,a)=0
Z_{\beta}\doteq 1+\mathbb{E}_{s^{\prime},a^{\prime}\sim\tilde{\rho}^{D}}[{%
\beta}(s^{\prime},a^{\prime})]
\beta(s,a)
\beta(s,a)
{r}
\displaystyle\max_{\pi\in\Pi}L(\pi|{r})\doteq Z_{\beta}\mathbb{E}_{s,a\sim\hat%
{\rho}^{\pi}}[{r}(s,a)]+\alpha\widehat{{H}}(\pi),
\displaystyle\max_{\pi\in\Pi}L(\pi|{r})\doteq Z_{\beta}\mathbb{E}_{s,a\sim\hat%
{\rho}^{\pi}}[{r}(s,a)]+\alpha\widehat{{H}}(\pi),
\alpha\geq 0
\widehat{{H}}(\pi)\doteq-\iint\hat{\rho}^{\pi}(s,a)\log\pi(a|s)\dif s\dif a
\gamma
\widehat{T}
{r}
\beta(s,a)
\beta(s,a)
\tilde{\rho}^{E}
\tilde{\rho}^{D}
\displaystyle\min_{{r}\in\mathcal{R}}\max_{\pi\in\Pi}\underbrace{\alpha%
\widehat{{H}}(\pi)+Z_{\beta}\mathbb{E}_{\hat{\rho}^{\pi}}\big{[}{r}(s,a)\big{]%
}-\mathbb{E}_{\tilde{\rho}^{D}}\big{[}{\beta}(s,a){r}(s,a)\big{]}-\mathbb{E}_{%
\tilde{\rho}^{E}}\big{[}{r}(s,a)\big{]}+Z_{\beta}\psi({r})}_{\doteq L(\pi,{r})}.
\displaystyle\min_{{r}\in\mathcal{R}}\max_{\pi\in\Pi}\underbrace{\alpha%
\widehat{{H}}(\pi)+Z_{\beta}\mathbb{E}_{\hat{\rho}^{\pi}}\big{[}{r}(s,a)\big{]%
}-\mathbb{E}_{\tilde{\rho}^{D}}\big{[}{\beta}(s,a){r}(s,a)\big{]}-\mathbb{E}_{%
\tilde{\rho}^{E}}\big{[}{r}(s,a)\big{]}+Z_{\beta}\psi({r})}_{\doteq L(\pi,{r})}.
T
\displaystyle\mathcal{C}_{T}\doteq\bigg{\{}\rho\in\mathbb{R}^{|\mathcal{S}||%
\mathcal{A}|}:\rho\geq 0~{}\text{and}~{}\sum_{a}\rho(s,a)=\mu(s)+\gamma\sum_{s%
^{\prime},a}T(s|s^{\prime},a)\rho(s^{\prime},a)~{}\forall s\in\mathcal{S}\bigg%
{\}}.
\displaystyle\mathcal{C}_{T}\doteq\bigg{\{}\rho\in\mathbb{R}^{|\mathcal{S}||%
\mathcal{A}|}:\rho\geq 0~{}\text{and}~{}\sum_{a}\rho(s,a)=\mu(s)+\gamma\sum_{s%
^{\prime},a}T(s|s^{\prime},a)\rho(s^{\prime},a)~{}\forall s\in\mathcal{S}\bigg%
{\}}.
\pi_{\rho}
\rho
\rho\in\mathcal{C}_{T}
\rho
\pi_{\rho}(a|s)\doteq\rho(s,a)/\sum_{a^{\prime}}\rho(s,a^{\prime})
\pi_{\rho}
\rho
\bar{{H}}(\rho)\doteq-\sum_{s,a}\rho(s,a)\log\frac{\rho(s,a)}{\sum_{a^{\prime}%
}\rho(s,a^{\prime})}
\bar{{H}}
\pi\in\Pi
\rho\in\mathcal{C}_{T}
{H}(\pi)=\bar{{H}}(\rho^{\pi})
\bar{{H}}(\rho)={H}(\mathcal{\pi_{\rho}})
\pi_{\rho}(a|s)\doteq\rho(s,a)/\sum_{a^{\prime}}\rho(s,a^{\prime})
{\beta}(s,a)\geq-\tilde{\rho}^{E}(s,a)/\tilde{\rho}^{D}(s,a)
(s,a)\in\mathcal{D}
\displaystyle\min_{{r}\in\mathcal{R}}\max_{\pi\in\Pi}L(\pi,{r})=\max_{\hat{%
\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(\hat{\rho})-Z_{\beta}D_{\psi%
}\bigg{(}\hat{\rho},\frac{\tilde{\rho}^{E}+{\beta}\tilde{\rho}^{D}}{Z_{\beta}}%
\bigg{)},
\displaystyle\min_{{r}\in\mathcal{R}}\max_{\pi\in\Pi}L(\pi,{r})=\max_{\hat{%
\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(\hat{\rho})-Z_{\beta}D_{\psi%
}\bigg{(}\hat{\rho},\frac{\tilde{\rho}^{E}+{\beta}\tilde{\rho}^{D}}{Z_{\beta}}%
\bigg{)},
D_{\psi}(\rho_{1},\rho_{2})\doteq\psi^{*}(\rho_{2}-\rho_{1})
\psi^{*}
\psi
\psi
D_{\psi}
\psi(r)=\alpha r^{2}
D_{\psi}(\rho_{1},\rho_{2})=\frac{1}{4\alpha}\chi^{2}(\rho_{1},\rho_{2})
\psi
r\in[-R^{\max},R^{\mathrm{max}}]
D_{\psi}(\rho_{1},\rho_{2})=2R^{\mathrm{max}}D_{\mathrm{TV}}(\rho_{1},\rho_{2})
\widehat{T}
\mathcal{D}_{E}
\mathcal{D}
\beta(s,a)
\beta(s,a)=0
(s,a)\in\mathcal{D}
\beta(s,a)
\tilde{\rho}^{D}(s,a)
\frac{(1+\beta D_{E}/D)\tilde{\rho}^{E}+(\beta D_{S}/D)\tilde{\rho}^{B}}{Z_{%
\beta}}
\beta(s,a)
J(\pi)\doteq\mathbb{E}_{s,a\sim\rho^{\pi}}[R(s,a)]
\pi
J(\pi)
J(\pi^{E})
|R(s,a)|\leq 1
s\in\mathcal{S},a\in\mathcal{A}
\pi
\hat{\rho}^{\pi}
\pi
\widehat{T}
\displaystyle J(\pi^{E})-J(\pi)\leq C\cdot\mathbb{E}_{s,a\sim\hat{\rho}^{\pi}}%
\left[D_{\mathrm{TV}}\big{(}T(\cdot|s,a),\widehat{T}(\cdot|s,a)\big{)}\right]+%
2\left(D_{\mathrm{TV}}(\hat{\rho}^{\pi},\tilde{\rho}^{E})+D_{\mathrm{TV}}(%
\tilde{\rho}^{E},\rho^{E})\right),
\displaystyle J(\pi^{E})-J(\pi)\leq C\cdot\mathbb{E}_{s,a\sim\hat{\rho}^{\pi}}%
\left[D_{\mathrm{TV}}\big{(}T(\cdot|s,a),\widehat{T}(\cdot|s,a)\big{)}\right]+%
2\left(D_{\mathrm{TV}}(\hat{\rho}^{\pi},\tilde{\rho}^{E})+D_{\mathrm{TV}}(%
\tilde{\rho}^{E},\rho^{E})\right),
C\doteq\frac{2\gamma}{1-\gamma}
\rho^{E}
\pi^{E}
T
1-\delta
\displaystyle J(\pi^{E})-J(\pi)\leq\underbrace{\mathbb{E}_{s,a\sim\hat{\rho}^{%
\pi}}\Bigg{[}\frac{CC_{\delta}}{\sqrt{|\mathcal{D}_{E}(s,a)|+|\mathcal{D}_{B}(%
s,a)|}}\Bigg{]}}_{\textrm{(a)}}+2\underbrace{D_{\mathrm{TV}}(\hat{\rho}^{\pi},%
\tilde{\rho}^{E})}_{\textrm{(b)}}+2\underbrace{D_{\mathrm{TV}}(\tilde{\rho}^{E%
},\rho^{E})}_{\textrm{(c)}},
\displaystyle J(\pi^{E})-J(\pi)\leq\underbrace{\mathbb{E}_{s,a\sim\hat{\rho}^{%
\pi}}\Bigg{[}\frac{CC_{\delta}}{\sqrt{|\mathcal{D}_{E}(s,a)|+|\mathcal{D}_{B}(%
s,a)|}}\Bigg{]}}_{\textrm{(a)}}+2\underbrace{D_{\mathrm{TV}}(\hat{\rho}^{\pi},%
\tilde{\rho}^{E})}_{\textrm{(b)}}+2\underbrace{D_{\mathrm{TV}}(\tilde{\rho}^{E%
},\rho^{E})}_{\textrm{(c)}},
\mathcal{D}(s,a)\doteq\{(s^{\prime},a^{\prime})\in\mathcal{D}:s^{\prime}=s,a^{%
\prime}=a\}
\hat{\rho}^{\pi}
\pi
\widehat{T}
c(s,a)\doteq C\cdot D_{\mathrm{TV}}(T(\cdot|s,a),
\widehat{T}(\cdot|s,a))
c^{\mathrm{min}}\doteq\min_{s,a}c(s,a)
\displaystyle\hat{\rho}^{*}(s,a)=\begin{cases}\tilde{\rho}^{E}(s,a)+\Delta_{%
\rho},&\textit{if}~{}c(s,a)\leq c^{\mathrm{min}},\\
0,&\textit{if}~{}c(s,a)>c^{\mathrm{min}}+2,\\
\tilde{\rho}^{E}(s,a),&\textit{otherwise}.\end{cases}
\displaystyle\hat{\rho}^{*}(s,a)=\begin{cases}\tilde{\rho}^{E}(s,a)+\Delta_{%
\rho},&\textit{if}~{}c(s,a)\leq c^{\mathrm{min}},\\
0,&\textit{if}~{}c(s,a)>c^{\mathrm{min}}+2,\\
\tilde{\rho}^{E}(s,a),&\textit{otherwise}.\end{cases}
\Delta_{\rho}\doteq\frac{\sum_{s^{\prime},a^{\prime}}{\bm{1}}[c(s^{\prime},a^{%
\prime})-c^{\mathrm{min}}>2]\cdot\tilde{\rho}^{E}(s^{\prime},a^{\prime})}{|%
\mathcal{N}_{\mathrm{min}}|}
\mathcal{N}_{\mathrm{min}}\doteq\{(s,a)\in\mathcal{D}:c(s,a)\leq c^{\mathrm{%
min}}\}
\widehat{T}
\tilde{\rho}^{D}(s,a)=0
c(s,a)>c^{\min}
(s,a)\in\mathcal{S}\times\mathcal{A}
\beta(s,a)
\displaystyle\beta^{*}(s,a)=\begin{cases}\frac{\Delta_{\rho}}{\tilde{\rho}^{D}%
(s,a)},~{}&\textit{if}~{}c(s,a)\leq c^{\mathrm{min}}~{}\textrm{and}~{}\tilde{%
\rho}^{D}(s,a)>0,\\
-\frac{\tilde{\rho}^{E}(s,a)}{\tilde{\rho}^{D}(s,a)},~{}&\textit{if}~{}c(s,a)>%
c^{\mathrm{min}}+2~{}\textit{and}~{}\tilde{\rho}^{D}(s,a)>0,\\
0,~{}&\textit{otherwise},\end{cases}
\displaystyle\beta^{*}(s,a)=\begin{cases}\frac{\Delta_{\rho}}{\tilde{\rho}^{D}%
(s,a)},~{}&\textit{if}~{}c(s,a)\leq c^{\mathrm{min}}~{}\textrm{and}~{}\tilde{%
\rho}^{D}(s,a)>0,\\
-\frac{\tilde{\rho}^{E}(s,a)}{\tilde{\rho}^{D}(s,a)},~{}&\textit{if}~{}c(s,a)>%
c^{\mathrm{min}}+2~{}\textit{and}~{}\tilde{\rho}^{D}(s,a)>0,\\
0,~{}&\textit{otherwise},\end{cases}
\displaystyle\min_{r\in\mathcal{R}}\max_{\pi\in\Pi}L(\pi,r)=\max_{\pi}\alpha%
\bar{{H}}(\hat{\rho}^{\pi})-Z_{\beta}D_{\psi}(\hat{\rho}^{\pi},\hat{\rho}^{*}).
\displaystyle\min_{r\in\mathcal{R}}\max_{\pi\in\Pi}L(\pi,r)=\max_{\pi}\alpha%
\bar{{H}}(\hat{\rho}^{\pi})-Z_{\beta}D_{\psi}(\hat{\rho}^{\pi},\hat{\rho}^{*}).
\beta(s,a)
(s,a)\in\mathcal{D}
\beta^{*}
c(s,a)
\mathcal{D}_{E}
\mathcal{D}_{B}
u
\eta
\lambda
\widehat{T}
\beta(s,a)
(s,a)\in\mathcal{D}_{E}\cup\mathcal{D}_{B}
\pi_{\theta}
r_{\phi}
\theta
\phi
\widehat{T}
r_{\phi}
\pi_{\theta}
L(\pi_{\theta}|r_{\phi})-\lambda{D_{\mathrm{KL}}}(\pi^{b}\|\pi_{\theta})
r_{\phi}
\phi\leftarrow\phi-\eta\nabla_{\phi}L(r_{\phi}|\pi_{\theta})
\{\widehat{T}_{i}(s^{\prime}|s,a)=\mathcal{N}(\mu_{i}(s,a),\Sigma_{i}(s,a))\}^%
{N}_{i=1}
\tilde{\rho}^{D}(s,a)=1/D
\tilde{\rho}^{E}(s,a)=1/D_{E}
c(s,a)=\max_{i\in[N]}\|\Sigma_{i}(s,a)\|_{F}
(s,a)\in\mathcal{D}
\displaystyle\beta(s,a)=\begin{cases}\frac{N^{\prime\prime}D}{N^{\prime}D_{E}}%
,&~{}\textit{if}~{}c(s,a)\leq u,\\
-\frac{D}{D_{E}}\cdot{\bm{1}}[(s,a)\in\mathcal{D}_{E}],&~{}\textit{if}~{}c(s,a%
)>u,\\
0,&~{}\textit{otherwise},\end{cases}
\displaystyle\beta(s,a)=\begin{cases}\frac{N^{\prime\prime}D}{N^{\prime}D_{E}}%
,&~{}\textit{if}~{}c(s,a)\leq u,\\
-\frac{D}{D_{E}}\cdot{\bm{1}}[(s,a)\in\mathcal{D}_{E}],&~{}\textit{if}~{}c(s,a%
)>u,\\
0,&~{}\textit{otherwise},\end{cases}
N^{\prime}\doteq\sum_{(s,a)\in\mathcal{D}}{\bm{1}}[c(s,a)\leq u]
N^{\prime\prime}\doteq\sum_{(s,a)\in\mathcal{D}_{E}}{\bm{1}}[c(s,a)>u]
u
u
u
\psi(r)=r^{2}
\pi^{b}
\mathcal{D}^{\prime}\subset\mathcal{D}
\displaystyle{D_{\mathrm{KL}}}(\pi^{b}\|\pi)\doteq\mathbb{E}_{s\in\mathcal{D}^%
{\prime}}\Big{[}\mathbb{E}_{a\sim\pi^{b}(\cdot|s)}\big{[}\log\pi^{b}(a|s)\big{%
]}-\mathbb{E}_{a\sim\pi^{b}(\cdot|s)}\left[\log\pi(a|s)\right]\Big{]},
\displaystyle{D_{\mathrm{KL}}}(\pi^{b}\|\pi)\doteq\mathbb{E}_{s\in\mathcal{D}^%
{\prime}}\Big{[}\mathbb{E}_{a\sim\pi^{b}(\cdot|s)}\big{[}\log\pi^{b}(a|s)\big{%
]}-\mathbb{E}_{a\sim\pi^{b}(\cdot|s)}\left[\log\pi(a|s)\right]\Big{]},
\pi^{b}(a|s)=\frac{\sum_{(s^{\prime},a^{\prime})\in\mathcal{D}^{\prime}}{\bm{1%
}}[s^{\prime}=s,a^{\prime}=a]}{\sum_{(s^{\prime},a^{\prime})\in\mathcal{D}^{%
\prime}}{\bm{1}}[s^{\prime}=s]}
(s,a)\in\mathcal{D}^{\prime}
\pi^{b}(a|s)=0
-\mathbb{E}_{s,a\sim\mathcal{D}^{\prime}}[\log\pi(a|s)]
u
u
u
u
u
u
u
\bm{u}
[0,1]
u
u
u
u
\mu
\{\widehat{T}_{i}(s^{\prime}|s,a)=\mathcal{N}(\mu_{i}(s,a),\Sigma_{i}(s,a))\}^%
{N}_{i=1}
-\mathbb{E}_{s,a\sim\mathcal{D}^{\prime}}[\log\pi(a|s)]
\mathcal{D}^{\prime}\in\mathcal{D}
\mathcal{D}
\lambda
H
B
E
\{\widehat{T}_{i}\}^{N}_{i=1}
r_{\phi}
\pi_{\theta}
\mathcal{D}_{\mathrm{model}}\leftarrow\varnothing
\textit{epoch}=1
E
b=1
B
s_{1}
\mathcal{D}
h=1
H
a_{h}\sim\pi_{\theta}(\cdot|s_{h})
\widehat{T}
\{\widehat{T}_{i}\}^{N}_{i=1}
s_{h+1}\sim\widehat{T}(\cdot|s_{h},a_{h})
r_{h}\leftarrow r_{\phi}(s_{h},a_{h})
(s_{h},a_{h},r_{h},s_{h+1})
\mathcal{D}_{\mathrm{model}}
\mathcal{D}_{\mathrm{model}}
\pi_{\theta}
-\mathbb{E}_{s,a\sim\mathcal{D}^{\prime}}[\log\pi_{\theta}(a|s)]
\mathcal{D}^{\prime}\in\mathcal{D}
5\times 10^{-5}
\displaystyle L(r_{\phi})\doteq\;Z_{\beta}\mathbb{E}_{\mathcal{D}_{\mathrm{%
replay}}}\big{[}r_{\phi}(s,a)\big{]}+Z_{\beta}\mathbb{E}_{s,a\sim\mathcal{D}%
\cup\mathcal{D}_{\mathrm{replay}}}\big{[}r_{\phi}(s,a)^{2}\big{]}
\displaystyle L(r_{\phi})\doteq\;
\displaystyle Z_{\beta}\mathbb{E}_{\mathcal{D}_{\mathrm{replay}}}\big{[}r_{%
\phi}(s,a)\big{]}+Z_{\beta}\mathbb{E}_{s,a\sim\mathcal{D}\cup\mathcal{D}_{%
\mathrm{replay}}}\big{[}r_{\phi}(s,a)^{2}\big{]}
\displaystyle-\mathbb{E}_{s,a\sim\mathcal{D}_{E}}\big{[}r_{\phi}(s,a)\big{]}-%
\mathbb{E}_{s,a\sim\mathcal{D}}\big{[}{\beta}(s,a)r_{\phi}(s,a)\big{]}.
\displaystyle-\mathbb{E}_{s,a\sim\mathcal{D}_{E}}\big{[}r_{\phi}(s,a)\big{]}-%
\mathbb{E}_{s,a\sim\mathcal{D}}\big{[}{\beta}(s,a)r_{\phi}(s,a)\big{]}.
\mathcal{D}_{\mathrm{replay}}
\mathcal{D}_{E}
\mathcal{D}_{B}
\mathcal{D}_{\mathrm{replay}}
\mathcal{D}_{\mathrm{model}}
r_{\phi}
\eta
T
\mathcal{D}_{\mathrm{replay}}\leftarrow\mathcal{D}_{\mathrm{replay}}\cup%
\mathcal{D}_{\mathrm{model}}
t=1
T
r_{\phi}
\phi\leftarrow\phi-\eta\nabla L(r_{\phi})
\mathcal{D}_{E}
\mathcal{D}_{B}
u
\eta
\lambda
\widehat{T}
\beta(s,a)
(s,a)\in\mathcal{D}_{E}\cup\mathcal{D}_{B}
\pi_{\theta}
r_{\phi}
\theta
\phi
\mathcal{D}_{\mathrm{replay}}\leftarrow\varnothing
\pi_{\theta}
\mathcal{D}_{\mathrm{model}}
r_{\phi}
u
[0,1]
u
\{0.4,0.6,0.8\}
u
\eta=5\times 10^{-5}
3\times 10^{-4}
10^{-3}
\lambda=0.25
u
u
\eta
5\times 10^{-5}
B
5000
H
5
\lambda
0.25
\gamma
0.99
T
5
E
500
20
3\times 10^{-4}
3\times 10^{-4}
u
u
\{0.4,0.6,0.8\}
u
u
u
\{0.4,0.6,0.8\}
u
u=0.4
u=0.6
u=0.8
\displaystyle L(\pi,{r})=\alpha\widehat{{H}}(\pi)+Z_{\beta}\mathbb{E}_{\hat{%
\rho}^{\pi}}\big{[}{r}(s,a)\big{]}-\mathbb{E}_{\tilde{\rho}^{D}}\big{[}{\beta}%
(s,a){r}(s,a)\big{]}-\mathbb{E}_{\tilde{\rho}^{E}}\big{[}{r}(s,a)\big{]}+Z_{%
\beta}\psi({r})
\displaystyle L(\pi,{r})
\displaystyle=\alpha\widehat{{H}}(\pi)+Z_{\beta}\mathbb{E}_{\hat{\rho}^{\pi}}%
\big{[}{r}(s,a)\big{]}-\mathbb{E}_{\tilde{\rho}^{D}}\big{[}{\beta}(s,a){r}(s,a%
)\big{]}-\mathbb{E}_{\tilde{\rho}^{E}}\big{[}{r}(s,a)\big{]}+Z_{\beta}\psi({r})
\displaystyle=\alpha\widehat{{H}}(\pi)+\sum_{s,a}\left(Z_{\beta}\hat{\rho}^{%
\pi}(s,a)-\tilde{\rho}^{D}(s,a){\beta}(s,a)-\tilde{\rho}^{E}(s,a)\right){r}(s,%
a)+Z_{\beta}\psi({r})
\displaystyle=\alpha\widehat{{H}}(\pi)+\sum_{s,a}\left(Z_{\beta}\hat{\rho}^{%
\pi}(s,a)-\tilde{\rho}^{D}(s,a){\beta}(s,a)-\tilde{\rho}^{E}(s,a)\right){r}(s,%
a)+Z_{\beta}\psi({r})
\displaystyle=\alpha\widehat{{H}}(\pi)+Z_{\beta}\sum_{s,a}\left(\hat{\rho}^{%
\pi}(s,a)-\frac{\tilde{\rho}^{D}(s,a){\beta}(s,a)+\tilde{\rho}^{E}(s,a)}{Z_{%
\beta}}\right){r}(s,a)+Z_{\beta}\psi({r})
\displaystyle=\alpha\widehat{{H}}(\pi)+Z_{\beta}\sum_{s,a}\left(\hat{\rho}^{%
\pi}(s,a)-\frac{\tilde{\rho}^{D}(s,a){\beta}(s,a)+\tilde{\rho}^{E}(s,a)}{Z_{%
\beta}}\right){r}(s,a)+Z_{\beta}\psi({r})
\tilde{\rho}^{I}(s,a)\doteq\frac{\tilde{\rho}^{D}(s,a){\beta}(s,a)+\tilde{\rho%
}^{E}(s,a)}{Z_{\beta}}
\tilde{\rho}^{I}(s,a)\doteq\frac{\tilde{\rho}^{D}(s,a){\beta}(s,a)+\tilde{\rho%
}^{E}(s,a)}{Z_{\beta}}
\tilde{\rho}^{I}(s,a)\doteq\frac{\tilde{\rho}^{D}(s,a){\beta}(s,a)+\tilde{\rho%
}^{E}(s,a)}{Z_{\beta}}
\displaystyle=\alpha\widehat{{H}}(\pi)+Z_{\beta}\left(\mathbb{E}_{\hat{\rho}^{%
\pi}}\big{[}{r}(s,a)\big{]}-\mathbb{E}_{\tilde{\rho}^{I}}\big{[}{r}(s,a)\big{]%
}+\psi({r})\right).
\displaystyle=\alpha\widehat{{H}}(\pi)+Z_{\beta}\left(\mathbb{E}_{\hat{\rho}^{%
\pi}}\big{[}{r}(s,a)\big{]}-\mathbb{E}_{\tilde{\rho}^{I}}\big{[}{r}(s,a)\big{]%
}+\psi({r})\right).
\displaystyle Z_{\beta}=1+\mathbb{E}_{s,a\sim\tilde{\rho}^{D}}[{\beta}(s,a)]
\displaystyle Z_{\beta}
\displaystyle=1+\mathbb{E}_{s,a\sim\tilde{\rho}^{D}}[{\beta}(s,a)]
\displaystyle=\sum_{s,a}\tilde{\rho}^{E}(s,a)+\tilde{\rho}^{D}(s,a){\beta}(s,a)
\displaystyle=\sum_{s,a}\tilde{\rho}^{E}(s,a)+\tilde{\rho}^{D}(s,a){\beta}(s,a)
{\beta}(s,a)\geq-\tilde{\rho}^{E}(s,a)/\tilde{\rho}^{D}(s,a)
(s,a)\in\mathcal{D}
{\beta}(s,a)\geq-\tilde{\rho}^{E}(s,a)/\tilde{\rho}^{D}(s,a)
(s,a)\in\mathcal{D}
{\beta}(s,a)\geq-\tilde{\rho}^{E}(s,a)/\tilde{\rho}^{D}(s,a)
(s,a)\in\mathcal{D}
\displaystyle\geq 0.
\displaystyle\geq 0.
\Pi
\mathcal{C}_{\widehat{T}}
\displaystyle\min_{{r}\in\mathcal{R}}\max_{\pi\in\Pi}L(\pi,{r})=\min_{{r}\in%
\mathcal{R}}\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\underbrace{\alpha%
\widehat{{H}}(\pi)+Z_{\beta}\left(\mathbb{E}_{\hat{\rho}}\big{[}{r}(s,a)\big{]%
}-\mathbb{E}_{\tilde{\rho}^{I}}\big{[}{r}(s,a)\big{]}+\psi({r})\right)}_{%
\doteq\bar{L}(\hat{\rho},{r})}.
\displaystyle\min_{{r}\in\mathcal{R}}\max_{\pi\in\Pi}L(\pi,{r})=\min_{{r}\in%
\mathcal{R}}\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\underbrace{\alpha%
\widehat{{H}}(\pi)+Z_{\beta}\left(\mathbb{E}_{\hat{\rho}}\big{[}{r}(s,a)\big{]%
}-\mathbb{E}_{\tilde{\rho}^{I}}\big{[}{r}(s,a)\big{]}+\psi({r})\right)}_{%
\doteq\bar{L}(\hat{\rho},{r})}.
\mathcal{R}
\mathcal{C}_{\widehat{T}}
\bar{{H}}
\displaystyle\min_{{r}\in\mathcal{R}}\max_{\hat{\rho}\in\mathcal{C}_{\widehat{%
T}}}\bar{L}(\hat{\rho},{r})=\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\min_%
{{r}\in\mathcal{R}}\bar{L}(\hat{\rho},{r})
\displaystyle\min_{{r}\in\mathcal{R}}\max_{\hat{\rho}\in\mathcal{C}_{\widehat{%
T}}}\bar{L}(\hat{\rho},{r})
\displaystyle=\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\min_{{r}\in%
\mathcal{R}}\bar{L}(\hat{\rho},{r})
\displaystyle=\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(%
\hat{\rho})+Z_{\beta}\left(\min_{{r}\in\mathcal{R}}\mathbb{E}_{\hat{\rho}}\big%
{[}{r}(s,a)\big{]}-\mathbb{E}_{\tilde{\rho}^{I}}\big{[}{r}(s,a)\big{]}+\psi({r%
})\right)
\displaystyle=\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(%
\hat{\rho})+Z_{\beta}\left(\min_{{r}\in\mathcal{R}}\mathbb{E}_{\hat{\rho}}\big%
{[}{r}(s,a)\big{]}-\mathbb{E}_{\tilde{\rho}^{I}}\big{[}{r}(s,a)\big{]}+\psi({r%
})\right)
\displaystyle=\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(%
\hat{\rho})+Z_{\beta}\psi^{*}\big{(}\tilde{\rho}^{I}-\tilde{\rho}\big{)}
\displaystyle=\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(%
\hat{\rho})+Z_{\beta}\psi^{*}\big{(}\tilde{\rho}^{I}-\tilde{\rho}\big{)}
\displaystyle=\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(%
\hat{\rho})+Z_{\beta}D_{\psi}\big{(}\tilde{\rho},\tilde{\rho}^{I}\big{)}.
\displaystyle=\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(%
\hat{\rho})+Z_{\beta}D_{\psi}\big{(}\tilde{\rho},\tilde{\rho}^{I}\big{)}.
{r}^{*}
\hat{\rho}^{*}
\displaystyle{r}^{*}\in\arg\min_{{r}\in\mathcal{R}}\max_{\hat{\rho}\in\mathcal%
{C}_{\widehat{T}}}\bar{L}(\hat{\rho},{r}),\quad\hat{\rho}^{*}\in\arg\max_{\hat%
{\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(\hat{\rho})+Z_{\beta}D_{%
\psi}\big{(}\tilde{\rho},\tilde{\rho}^{I}\big{)}.
\displaystyle{r}^{*}\in\arg\min_{{r}\in\mathcal{R}}\max_{\hat{\rho}\in\mathcal%
{C}_{\widehat{T}}}\bar{L}(\hat{\rho},{r}),\quad\hat{\rho}^{*}\in\arg\max_{\hat%
{\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(\hat{\rho})+Z_{\beta}D_{%
\psi}\big{(}\tilde{\rho},\tilde{\rho}^{I}\big{)}.
({r}^{*},\hat{\rho}^{*})
\bar{L}
\hat{\rho}^{*}\in\arg\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\bar{L}(\hat%
{\rho},{r}^{*})
\pi^{*}
\hat{\rho}^{*}
\pi^{*}\in\arg\max_{\pi\in\Pi}L(\pi,{r}^{*})
p_{1}(x,y)=q_{1}(x)q_{1}(y|x)
p_{2}(x,y)=q_{2}(x)q_{2}(y|x)
p_{1}
p_{2}
\displaystyle D_{\mathrm{TV}}(p_{1},p_{2})\leq E_{x\sim q_{1}(x)}\left[D_{%
\mathrm{TV}}(q_{1}(\cdot|x),q_{2}(\cdot|x))\right]+D_{\mathrm{TV}}(q_{1},q_{2}).
\displaystyle D_{\mathrm{TV}}(p_{1},p_{2})\leq E_{x\sim q_{1}(x)}\left[D_{%
\mathrm{TV}}(q_{1}(\cdot|x),q_{2}(\cdot|x))\right]+D_{\mathrm{TV}}(q_{1},q_{2}).
\displaystyle D_{\mathrm{TV}}(p_{1},p_{2})=\frac{1}{2}\sum_{x,y}\left|p_{1}(x,%
y)-p_{2}(x,y)\right|
\displaystyle D_{\mathrm{TV}}(p_{1},p_{2})
\displaystyle=\frac{1}{2}\sum_{x,y}\left|p_{1}(x,y)-p_{2}(x,y)\right|
\displaystyle=\frac{1}{2}\sum_{x,y}\left|q_{1}(x)q_{1}(y|x)-q_{2}(x)q_{2}(y|x)\right|
\displaystyle=\frac{1}{2}\sum_{x,y}\left|q_{1}(x)q_{1}(y|x)-q_{2}(x)q_{2}(y|x)\right|
\displaystyle=\frac{1}{2}\sum_{x,y}\left|q_{1}(x)q_{1}(y|x)-q_{1}(x)q_{2}(y|x)%
+q_{1}(x)q_{2}(y|x)-q_{2}(x)q_{2}(y|x)\right|
\displaystyle=\frac{1}{2}\sum_{x,y}\left|q_{1}(x)q_{1}(y|x)-q_{1}(x)q_{2}(y|x)%
+q_{1}(x)q_{2}(y|x)-q_{2}(x)q_{2}(y|x)\right|
\displaystyle\leq\frac{1}{2}\sum_{x,y}q_{1}(x)\left|q_{1}(y|x)-q_{2}(y|x)%
\right|+\frac{1}{2}\sum_{x,y}q_{2}(y|x)\left|q_{1}(x)-q_{2}(x)\right|
\displaystyle\leq\frac{1}{2}\sum_{x,y}q_{1}(x)\left|q_{1}(y|x)-q_{2}(y|x)%
\right|+\frac{1}{2}\sum_{x,y}q_{2}(y|x)\left|q_{1}(x)-q_{2}(x)\right|
\displaystyle=\sum_{x}q_{1}(x)\cdot\frac{1}{2}\sum_{y}\left|q_{1}(y|x)-q_{2}(y%
|x)\right|+\frac{1}{2}\sum_{x}\left|q_{1}(x)-q_{2}(x)\right|\sum_{y}q_{2}(y|x)
\displaystyle=\sum_{x}q_{1}(x)\cdot\frac{1}{2}\sum_{y}\left|q_{1}(y|x)-q_{2}(y%
|x)\right|+\frac{1}{2}\sum_{x}\left|q_{1}(x)-q_{2}(x)\right|\sum_{y}q_{2}(y|x)
\displaystyle=E_{x\sim q_{1}(x)}\left[D_{\mathrm{TV}}(q_{1}(y|x),q_{2}(y|x))%
\right]+D_{\mathrm{TV}}(q_{1},q_{2}),
\displaystyle=E_{x\sim q_{1}(x)}\left[D_{\mathrm{TV}}(q_{1}(y|x),q_{2}(y|x))%
\right]+D_{\mathrm{TV}}(q_{1},q_{2}),
\sum_{y}q_{2}(y|x)=1
T_{1}(s^{\prime}|s)
T_{2}(s^{\prime}|s)
h\in[1,2,\dots)
h
\displaystyle D_{\mathrm{TV}}(p^{h}_{1},p^{h}_{2})\leq\sum^{h-1}_{h^{\prime}=0%
}E_{s\sim p^{h^{\prime}}_{2}}\left[D_{\mathrm{TV}}\left(T_{1}(\cdot|s),T_{2}(%
\cdot|s)\right)\right],
\displaystyle D_{\mathrm{TV}}(p^{h}_{1},p^{h}_{2})\leq\sum^{h-1}_{h^{\prime}=0%
}E_{s\sim p^{h^{\prime}}_{2}}\left[D_{\mathrm{TV}}\left(T_{1}(\cdot|s),T_{2}(%
\cdot|s)\right)\right],
p^{h}_{i}(s)\doteq\Pr(s_{h}=s\mid T_{i},\mu)
i=1,2
\displaystyle\left|p^{h}_{1}(s)-p^{h}_{2}(s)\right|
\displaystyle\left|p^{h}_{1}(s)-p^{h}_{2}(s)\right|
\displaystyle=\left|\sum_{s^{\prime}}T_{1}(s|s^{\prime})p^{h-1}_{1}(s^{\prime}%
)-\sum_{s^{\prime}}T_{2}(s|s^{\prime})p^{h-1}_{2}(s^{\prime})\right|
\displaystyle=
\displaystyle\left|\sum_{s^{\prime}}T_{1}(s|s^{\prime})p^{h-1}_{1}(s^{\prime})%
-\sum_{s^{\prime}}T_{2}(s|s^{\prime})p^{h-1}_{2}(s^{\prime})\right|
\displaystyle\leq\sum_{s^{\prime}}\left|T_{1}(s|s^{\prime})p^{h-1}_{1}(s^{%
\prime})-T_{2}(s|s^{\prime})p^{h-1}_{2}(s^{\prime})\right|
\displaystyle\leq
\displaystyle\sum_{s^{\prime}}\left|T_{1}(s|s^{\prime})p^{h-1}_{1}(s^{\prime})%
-T_{2}(s|s^{\prime})p^{h-1}_{2}(s^{\prime})\right|
\displaystyle=\sum_{s^{\prime}}\left|T_{1}(s|s^{\prime})p^{h-1}_{1}(s^{\prime}%
)-T_{1}(s|s^{\prime})p^{h-1}_{2}(s^{\prime})+T_{1}(s|s^{\prime})p^{h-1}_{2}(s^%
{\prime})-T_{2}(s|s^{\prime})p^{h-1}_{2}(s^{\prime})\right|
\displaystyle=
\displaystyle\sum_{s^{\prime}}\left|T_{1}(s|s^{\prime})p^{h-1}_{1}(s^{\prime})%
-T_{1}(s|s^{\prime})p^{h-1}_{2}(s^{\prime})+T_{1}(s|s^{\prime})p^{h-1}_{2}(s^{%
\prime})-T_{2}(s|s^{\prime})p^{h-1}_{2}(s^{\prime})\right|
\displaystyle\leq\sum_{s^{\prime}}\left(T_{1}(s|s^{\prime})\left|p^{h-1}_{1}(s%
^{\prime})-p^{h-1}_{2}(s^{\prime})\right|+p^{h-1}_{2}(s^{\prime})\left|T_{1}(s%
|s^{\prime})-T_{2}(s|s^{\prime})\right|\right)
\displaystyle\leq
\displaystyle\sum_{s^{\prime}}\left(T_{1}(s|s^{\prime})\left|p^{h-1}_{1}(s^{%
\prime})-p^{h-1}_{2}(s^{\prime})\right|+p^{h-1}_{2}(s^{\prime})\left|T_{1}(s|s%
^{\prime})-T_{2}(s|s^{\prime})\right|\right)
\displaystyle=\sum_{s^{\prime}}T_{1}(s|s^{\prime})\left|p^{h-1}_{1}(s^{\prime}%
)-p^{h-1}_{2}(s^{\prime})\right|+E_{s^{\prime}\sim p^{h-1}_{2}}\left[\left|T_{%
1}(s|s^{\prime})-T_{2}(s|s^{\prime})\right|\right].
\displaystyle=
\displaystyle\sum_{s^{\prime}}T_{1}(s|s^{\prime})\left|p^{h-1}_{1}(s^{\prime})%
-p^{h-1}_{2}(s^{\prime})\right|+E_{s^{\prime}\sim p^{h-1}_{2}}\left[\left|T_{1%
}(s|s^{\prime})-T_{2}(s|s^{\prime})\right|\right].
\displaystyle D_{\mathrm{TV}}(p^{h}_{1},p^{h}_{2})
\displaystyle D_{\mathrm{TV}}(p^{h}_{1},p^{h}_{2})
\displaystyle=\frac{1}{2}\sum_{s}\left|p^{h}_{1}(s)-p^{h}_{2}(s)\right|
\displaystyle=
\displaystyle\frac{1}{2}\sum_{s}\left|p^{h}_{1}(s)-p^{h}_{2}(s)\right|
\displaystyle\leq\frac{1}{2}\sum_{s}E_{s^{\prime}\sim p^{h-1}_{2}}\left[\left|%
T_{1}(s|s^{\prime})-T_{2}(s|s^{\prime})\right|\right]+\frac{1}{2}\sum_{s}\sum_%
{s^{\prime}}T_{1}(s|s^{\prime})\left|p^{h-1}_{1}(s^{\prime})-p^{h-1}_{2}(s^{%
\prime})\right|
\displaystyle\leq
\displaystyle\frac{1}{2}\sum_{s}E_{s^{\prime}\sim p^{h-1}_{2}}\left[\left|T_{1%
}(s|s^{\prime})-T_{2}(s|s^{\prime})\right|\right]+\frac{1}{2}\sum_{s}\sum_{s^{%
\prime}}T_{1}(s|s^{\prime})\left|p^{h-1}_{1}(s^{\prime})-p^{h-1}_{2}(s^{\prime%
})\right|
\displaystyle=\frac{1}{2}\sum_{s}E_{s^{\prime}\sim p^{h-1}_{2}}\left[\left|T_{%
1}(s|s^{\prime})-T_{2}(s|s^{\prime})\right|\right]+\frac{1}{2}\sum_{s^{\prime}%
}\left|p^{h-1}_{1}(s^{\prime})-p^{h-1}_{2}(s^{\prime})\right|\sum_{s}T_{1}(s|s%
^{\prime})
\displaystyle=
\displaystyle\frac{1}{2}\sum_{s}E_{s^{\prime}\sim p^{h-1}_{2}}\left[\left|T_{1%
}(s|s^{\prime})-T_{2}(s|s^{\prime})\right|\right]+\frac{1}{2}\sum_{s^{\prime}}%
\left|p^{h-1}_{1}(s^{\prime})-p^{h-1}_{2}(s^{\prime})\right|\sum_{s}T_{1}(s|s^%
{\prime})
\sum_{s}T_{1}(s|s^{\prime})=1
\sum_{s}T_{1}(s|s^{\prime})=1
\sum_{s}T_{1}(s|s^{\prime})=1
\displaystyle=E_{s^{\prime}\sim p^{h-1}_{2}}\left[\frac{1}{2}\sum_{s}\left|T_{%
1}(s|s^{\prime})-T_{2}(s|s^{\prime})\right|\right]+\frac{1}{2}\sum_{s^{\prime}%
}\left|p^{h-1}_{1}(s^{\prime})-p^{h-1}_{2}(s^{\prime})\right|
\displaystyle=
\displaystyle E_{s^{\prime}\sim p^{h-1}_{2}}\left[\frac{1}{2}\sum_{s}\left|T_{%
1}(s|s^{\prime})-T_{2}(s|s^{\prime})\right|\right]+\frac{1}{2}\sum_{s^{\prime}%
}\left|p^{h-1}_{1}(s^{\prime})-p^{h-1}_{2}(s^{\prime})\right|
\displaystyle=E_{s^{\prime}\sim p^{h-1}_{2}}\left[D_{\mathrm{TV}}\left(T_{1}(%
\cdot|s^{\prime}),T_{2}(\cdot|s^{\prime})\right)\right]+D_{\mathrm{TV}}(p^{h-1%
}_{1},p^{h-1}_{2})
\displaystyle=
\displaystyle E_{s^{\prime}\sim p^{h-1}_{2}}\left[D_{\mathrm{TV}}\left(T_{1}(%
\cdot|s^{\prime}),T_{2}(\cdot|s^{\prime})\right)\right]+D_{\mathrm{TV}}(p^{h-1%
}_{1},p^{h-1}_{2})
\displaystyle\leq\sum^{h-1}_{h^{\prime}=0}E_{s\sim p^{h^{\prime}}_{2}}\left[D_%
{\mathrm{TV}}\left(T_{1}(\cdot|s),T_{2}(\cdot|s)\right)\right]+D_{\mathrm{TV}}%
(p^{0}_{1},p^{0}_{2})
\displaystyle\leq
\displaystyle\sum^{h-1}_{h^{\prime}=0}E_{s\sim p^{h^{\prime}}_{2}}\left[D_{%
\mathrm{TV}}\left(T_{1}(\cdot|s),T_{2}(\cdot|s)\right)\right]+D_{\mathrm{TV}}(%
p^{0}_{1},p^{0}_{2})
\displaystyle=\sum^{h-1}_{h^{\prime}=0}E_{s\sim p^{h^{\prime}}_{2}}\left[D_{%
\mathrm{TV}}\left(T_{1}(\cdot|s),T_{2}(\cdot|s)\right)\right],
\displaystyle=
\displaystyle\sum^{h-1}_{h^{\prime}=0}E_{s\sim p^{h^{\prime}}_{2}}\left[D_{%
\mathrm{TV}}\left(T_{1}(\cdot|s),T_{2}(\cdot|s)\right)\right],
\hat{\rho}\in\mathcal{C}_{\widehat{T}}
\hat{\pi}
\hat{\pi}\doteq\hat{\rho}(s,a)/\sum_{a^{\prime}}\hat{\rho}(s,a^{\prime})
\rho^{\hat{\pi}}
\hat{\pi}
T
\displaystyle D_{\mathrm{TV}}(\rho^{\hat{\pi}},\rho^{E})\leq\frac{\gamma}{1-%
\gamma}\mathbb{E}_{s,a\sim\hat{\rho}}\Big{[}D_{\mathrm{TV}}\big{(}T(\cdot|s,a)%
,\widehat{T}(\cdot|s,a)\big{)}\Big{]}+D_{\mathrm{TV}}(\hat{\rho},\tilde{\rho}^%
{E})+D_{\mathrm{TV}}(\tilde{\rho}^{E},\rho^{E}),
\displaystyle D_{\mathrm{TV}}(\rho^{\hat{\pi}},\rho^{E})\leq\frac{\gamma}{1-%
\gamma}\mathbb{E}_{s,a\sim\hat{\rho}}\Big{[}D_{\mathrm{TV}}\big{(}T(\cdot|s,a)%
,\widehat{T}(\cdot|s,a)\big{)}\Big{]}+D_{\mathrm{TV}}(\hat{\rho},\tilde{\rho}^%
{E})+D_{\mathrm{TV}}(\tilde{\rho}^{E},\rho^{E}),
\rho^{E}
\pi^{E}
\rho_{1}\doteq\rho^{\hat{\pi}}
\rho_{2}\doteq\hat{\rho}
\displaystyle D_{\mathrm{TV}}(\rho_{1},\rho^{E})\leq D_{\mathrm{TV}}(\rho_{1},%
\rho_{2})+D_{\mathrm{TV}}(\rho_{2},\tilde{\rho}^{E})+D_{\mathrm{TV}}(\tilde{%
\rho}^{E},\rho^{E}),
\displaystyle D_{\mathrm{TV}}(\rho_{1},\rho^{E})\leq D_{\mathrm{TV}}(\rho_{1},%
\rho_{2})+D_{\mathrm{TV}}(\rho_{2},\tilde{\rho}^{E})+D_{\mathrm{TV}}(\tilde{%
\rho}^{E},\rho^{E}),
\tilde{\rho}^{E}
\pi^{E}
D_{\mathrm{TV}}(\rho_{1},\rho_{2})
p^{h}_{1}(s,a)\doteq\Pr(s_{h}=s,a_{h}=a\mid{\color[rgb]{0,0,0}T},\hat{\pi},\mu)
p^{h}_{2}(s,a)\doteq\Pr(s_{h}=s,a_{h}=a\mid{\color[rgb]{0,0,0}\widehat{T}},%
\hat{\pi},\mu)
\displaystyle D_{\mathrm{TV}}(\rho_{1},\rho_{2})=\frac{1}{2}\sum_{s,a}\left|%
\rho_{1}(s,a)-\rho_{2}(s,a)\right|
\displaystyle D_{\mathrm{TV}}(\rho_{1},\rho_{2})
\displaystyle=\frac{1}{2}\sum_{s,a}\left|\rho_{1}(s,a)-\rho_{2}(s,a)\right|
\displaystyle=\frac{1}{2}\sum_{s,a}\left|(1-\gamma)\sum^{\infty}_{h=0}\gamma^{%
h}p^{h}_{1}(s,a)-(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}p^{h}_{2}(s,a)\right|
\displaystyle=\frac{1}{2}\sum_{s,a}\left|(1-\gamma)\sum^{\infty}_{h=0}\gamma^{%
h}p^{h}_{1}(s,a)-(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}p^{h}_{2}(s,a)\right|
\displaystyle=\frac{1-\gamma}{2}\sum_{s,a}\left|\sum^{\infty}_{h=0}\gamma^{h}%
\left(p^{h}_{1}(s,a)-p^{h}_{2}(s,a)\right)\right|
\displaystyle=\frac{1-\gamma}{2}\sum_{s,a}\left|\sum^{\infty}_{h=0}\gamma^{h}%
\left(p^{h}_{1}(s,a)-p^{h}_{2}(s,a)\right)\right|
\displaystyle\leq\frac{1-\gamma}{2}\sum^{\infty}_{h=0}\sum_{s,a}\gamma^{h}%
\left|p^{h}_{1}(s,a)-p^{h}_{2}(s,a)\right|
\displaystyle\leq\frac{1-\gamma}{2}\sum^{\infty}_{h=0}\sum_{s,a}\gamma^{h}%
\left|p^{h}_{1}(s,a)-p^{h}_{2}(s,a)\right|
\displaystyle=(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}\cdot\frac{1}{2}\sum_{s,a%
}\left|p^{h}_{1}(s,a)-p^{h}_{2}(s,a)\right|
\displaystyle=(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}\cdot\frac{1}{2}\sum_{s,a%
}\left|p^{h}_{1}(s,a)-p^{h}_{2}(s,a)\right|
\displaystyle=(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}\cdot D_{\mathrm{TV}}%
\left(p^{h}_{1}(s,a),p^{h}_{2}(s,a)\right)
\displaystyle=(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}\cdot D_{\mathrm{TV}}%
\left(p^{h}_{1}(s,a),p^{h}_{2}(s,a)\right)
\displaystyle\leq(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}D_{\mathrm{TV}}\left(p%
^{h}_{1}(s),p^{h}_{2}(s)\right),
\displaystyle\leq(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}D_{\mathrm{TV}}\left(p%
^{h}_{1}(s),p^{h}_{2}(s)\right),
p^{h}_{1}(s)\doteq\Pr(s_{h}=s\mid T,\hat{\pi},\mu)
p^{h}_{2}(s)\doteq\Pr(s_{h}=s\mid\widehat{T},\hat{\pi},\mu)
p^{h}_{1}(s,a)=p^{h}_{1}(s)\hat{\pi}(a|s)
p^{h}_{2}(s,a)=p^{h}_{2}(s)\hat{\pi}(a|s)
D_{\mathrm{TV}}(p^{h}_{1}(s,a),p^{h}_{2}(s,a))
D_{\mathrm{TV}}(p^{h}_{1}(s),p^{h}_{2}(s))
T_{1}(s^{\prime}|s)\doteq\sum_{a}T(s^{\prime},a|s)
T_{2}(s^{\prime}|s)\doteq\sum_{a}\widehat{T}(s^{\prime},a|s)
T(s^{\prime},a|s)\doteq\hat{\pi}(a|s)T(s^{\prime}|s,a)
\widehat{T}(s^{\prime},a|s)\doteq\hat{\pi}(a|s)\widehat{T}(s^{\prime}|s,a)
\displaystyle D_{\mathrm{TV}}\left(T_{1}(\cdot|s),T_{2}(\cdot|s)\right)=\frac{%
1}{2}\sum_{s^{\prime}}\left|T_{1}(s^{\prime}|s)-T_{2}(s^{\prime}|s)\right|
\displaystyle D_{\mathrm{TV}}\left(T_{1}(\cdot|s),T_{2}(\cdot|s)\right)
\displaystyle=\frac{1}{2}\sum_{s^{\prime}}\left|T_{1}(s^{\prime}|s)-T_{2}(s^{%
\prime}|s)\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}}\left|\sum_{a}T(s^{\prime},a|s)-%
\widehat{T}(s^{\prime},a|s)\right|
\displaystyle=\frac{1}{2}\sum_{s^{\prime}}\left|\sum_{a}T(s^{\prime},a|s)-%
\widehat{T}(s^{\prime},a|s)\right|
\displaystyle\leq\frac{1}{2}\sum_{s^{\prime},a}\left|T(s^{\prime},a|s)-%
\widehat{T}(s^{\prime},a|s)\right|
\displaystyle\leq\frac{1}{2}\sum_{s^{\prime},a}\left|T(s^{\prime},a|s)-%
\widehat{T}(s^{\prime},a|s)\right|
\displaystyle=D_{\mathrm{TV}}\left(T(s^{\prime},a|s),\widehat{T}(s^{\prime},a|%
s)\right)
\displaystyle=D_{\mathrm{TV}}\left(T(s^{\prime},a|s),\widehat{T}(s^{\prime},a|%
s)\right)
\hat{\pi}(a|s)
q_{1}(x),q_{2}(x)
T(s^{\prime}|s,a)
q_{1}(y|x)
\widehat{T}(s^{\prime}|s,a)
q_{2}(y|x)
\hat{\pi}(a|s)
q_{1}(x),q_{2}(x)
T(s^{\prime}|s,a)
q_{1}(y|x)
\widehat{T}(s^{\prime}|s,a)
q_{2}(y|x)
\hat{\pi}(a|s)
q_{1}(x),q_{2}(x)
T(s^{\prime}|s,a)
q_{1}(y|x)
\widehat{T}(s^{\prime}|s,a)
q_{2}(y|x)
\displaystyle\leq E_{a\sim\hat{\pi}(a|s)}\left[D_{\mathrm{TV}}\left(T(\cdot|s,%
a),\widehat{T}(\cdot|s,a)\right)\right].
\displaystyle\leq E_{a\sim\hat{\pi}(a|s)}\left[D_{\mathrm{TV}}\left(T(\cdot|s,%
a),\widehat{T}(\cdot|s,a)\right)\right].
\displaystyle D_{\mathrm{TV}}(\rho_{1},\rho_{2})\leq(1-\gamma)\sum^{\infty}_{h%
=0}\gamma^{h}D_{\mathrm{TV}}\left(p^{h}_{1}(s),p^{h}_{2}(s)\right)
\displaystyle D_{\mathrm{TV}}(\rho_{1},\rho_{2})
\displaystyle\leq(1-\gamma)\sum^{\infty}_{h=0}\gamma^{h}D_{\mathrm{TV}}\left(p%
^{h}_{1}(s),p^{h}_{2}(s)\right)
\displaystyle\leq(1-\gamma)\sum^{\infty}_{h=1}\gamma^{h}\sum^{h-1}_{h^{\prime}%
=0}E_{s\sim p^{h^{\prime}}_{2}(s)}\left[D_{\mathrm{TV}}\left(T_{1}(\cdot|s),T_%
{2}(\cdot|s)\right)\right]
\displaystyle\leq(1-\gamma)\sum^{\infty}_{h=1}\gamma^{h}\sum^{h-1}_{h^{\prime}%
=0}E_{s\sim p^{h^{\prime}}_{2}(s)}\left[D_{\mathrm{TV}}\left(T_{1}(\cdot|s),T_%
{2}(\cdot|s)\right)\right]
\displaystyle\leq(1-\gamma)\sum^{\infty}_{h=1}\gamma^{h}\sum^{h-1}_{h^{\prime}%
=0}E_{s\sim p^{h^{\prime}}_{2}(s)}\left[E_{a\sim\hat{\pi}(a|s)}\left[D_{%
\mathrm{TV}}\left(T(\cdot|s,a),\widehat{T}(\cdot|s,a)\right)\right]\right]
\displaystyle\leq(1-\gamma)\sum^{\infty}_{h=1}\gamma^{h}\sum^{h-1}_{h^{\prime}%
=0}E_{s\sim p^{h^{\prime}}_{2}(s)}\left[E_{a\sim\hat{\pi}(a|s)}\left[D_{%
\mathrm{TV}}\left(T(\cdot|s,a),\widehat{T}(\cdot|s,a)\right)\right]\right]
\displaystyle=(1-\gamma)\sum^{\infty}_{h=1}\gamma^{h}\sum^{h-1}_{h^{\prime}=0}%
\mathbb{E}_{s,a\sim p^{h^{\prime}}_{2}(s,a)}\left[D_{\mathrm{TV}}\left(T(\cdot%
|s,a),\widehat{T}(\cdot|s,a)\right)\right]
\displaystyle=(1-\gamma)\sum^{\infty}_{h=1}\gamma^{h}\sum^{h-1}_{h^{\prime}=0}%
\mathbb{E}_{s,a\sim p^{h^{\prime}}_{2}(s,a)}\left[D_{\mathrm{TV}}\left(T(\cdot%
|s,a),\widehat{T}(\cdot|s,a)\right)\right]
\displaystyle=(1-\gamma)\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),\widehat{T%
}(\cdot|s,a)\right)\sum^{\infty}_{h=1}\gamma^{h}\sum^{h-1}_{h^{\prime}=0}p^{h^%
{\prime}}_{2}(s,a)
\displaystyle=(1-\gamma)\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),\widehat{T%
}(\cdot|s,a)\right)\sum^{\infty}_{h=1}\gamma^{h}\sum^{h-1}_{h^{\prime}=0}p^{h^%
{\prime}}_{2}(s,a)
\displaystyle=\gamma(1-\gamma)\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),%
\widehat{T}(\cdot|s,a)\right)\underbrace{\sum^{\infty}_{h=1}\sum^{h-1}_{h^{%
\prime}=0}\gamma^{h-1}p^{h^{\prime}}_{2}(s,a)}_{\doteq A}
\displaystyle=\gamma(1-\gamma)\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),%
\widehat{T}(\cdot|s,a)\right)\underbrace{\sum^{\infty}_{h=1}\sum^{h-1}_{h^{%
\prime}=0}\gamma^{h-1}p^{h^{\prime}}_{2}(s,a)}_{\doteq A}
\displaystyle=\gamma(1-\gamma)\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),%
\widehat{T}(\cdot|s,a)\right)\underbrace{\sum^{\infty}_{h=1}\gamma^{h-1}\sum^{%
\infty}_{h^{\prime}=0}\gamma^{h^{\prime}}p^{h^{\prime}}_{2}(s,a)}_{\doteq B}
\displaystyle=\gamma(1-\gamma)\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),%
\widehat{T}(\cdot|s,a)\right)\underbrace{\sum^{\infty}_{h=1}\gamma^{h-1}\sum^{%
\infty}_{h^{\prime}=0}\gamma^{h^{\prime}}p^{h^{\prime}}_{2}(s,a)}_{\doteq B}
\displaystyle=\gamma(1-\gamma)\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),%
\widehat{T}(\cdot|s,a)\right)\sum^{\infty}_{h=1}\gamma^{h-1}\frac{\rho_{2}(s,a%
)}{1-\gamma}
\displaystyle=\gamma(1-\gamma)\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),%
\widehat{T}(\cdot|s,a)\right)\sum^{\infty}_{h=1}\gamma^{h-1}\frac{\rho_{2}(s,a%
)}{1-\gamma}
\displaystyle=\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),\widehat{T}(\cdot|s,%
a)\right)\sum^{\infty}_{h=1}\gamma^{h}\rho_{2}(s,a)
\displaystyle=\sum_{s,a}D_{\mathrm{TV}}\left(T(\cdot|s,a),\widehat{T}(\cdot|s,%
a)\right)\sum^{\infty}_{h=1}\gamma^{h}\rho_{2}(s,a)
\displaystyle=\sum_{s,a}\rho_{2}(s,a)D_{\mathrm{TV}}\left(T(\cdot|s,a),%
\widehat{T}(\cdot|s,a)\right)\sum^{\infty}_{h=1}\gamma^{h}
\displaystyle=\sum_{s,a}\rho_{2}(s,a)D_{\mathrm{TV}}\left(T(\cdot|s,a),%
\widehat{T}(\cdot|s,a)\right)\sum^{\infty}_{h=1}\gamma^{h}
\displaystyle=\frac{\gamma}{1-\gamma}\mathbb{E}_{s,a\sim\rho_{2}}\left[D_{%
\mathrm{TV}}\left(T(\cdot|s,a),\widehat{T}(\cdot|s,a)\right)\right].
\displaystyle=\frac{\gamma}{1-\gamma}\mathbb{E}_{s,a\sim\rho_{2}}\left[D_{%
\mathrm{TV}}\left(T(\cdot|s,a),\widehat{T}(\cdot|s,a)\right)\right].
\rho^{\pi}
\pi
T
\displaystyle J(\pi^{E})-J(\rho^{\pi})=\sum_{s,a}\rho^{E}(s,a)R(s,a)-\sum_{s,a%
}\rho^{\pi}(s,a)R(s,a)
\displaystyle J(\pi^{E})-J(\rho^{\pi})
\displaystyle=\sum_{s,a}\rho^{E}(s,a)R(s,a)-\sum_{s,a}\rho^{\pi}(s,a)R(s,a)
\displaystyle=\sum_{s,a}\left(\rho^{E}(s,a)-\rho^{\pi}(s,a)\right)R(s,a)
\displaystyle=\sum_{s,a}\left(\rho^{E}(s,a)-\rho^{\pi}(s,a)\right)R(s,a)
\displaystyle\leq\sum_{s,a}\left|\rho^{E}(s,a)-\rho^{\pi}(s,a)\right|
\displaystyle\leq\sum_{s,a}\left|\rho^{E}(s,a)-\rho^{\pi}(s,a)\right|
\displaystyle=2D_{\mathrm{TV}}(\rho^{\pi},\rho^{E}).
\displaystyle=2D_{\mathrm{TV}}(\rho^{\pi},\rho^{E}).
c(s,a)=C\cdot D_{\mathrm{TV}}(T(\cdot|s,a),\widehat{T}(\cdot|s,a))
\displaystyle f(\rho)\doteq\mathbb{E}_{s,a\sim\rho}[c(s,a)]+2D_{\mathrm{TV}}(%
\rho,\tilde{\rho}^{E})
\displaystyle f(\rho)
\displaystyle\doteq\mathbb{E}_{s,a\sim\rho}[c(s,a)]+2D_{\mathrm{TV}}(\rho,%
\tilde{\rho}^{E})
\displaystyle=\sum_{s,a}c(s,a)\rho(s,a)+\left|\rho(s,a)-\tilde{\rho}^{E}(s,a)%
\right|.
\displaystyle=\sum_{s,a}c(s,a)\rho(s,a)+\left|\rho(s,a)-\tilde{\rho}^{E}(s,a)%
\right|.
\displaystyle\min_{\rho\in\mathcal{P}(\mathcal{S}\times\mathcal{A})}f(\rho).
\displaystyle\min_{\rho\in\mathcal{P}(\mathcal{S}\times\mathcal{A})}f(\rho).
\delta(s,a)\doteq\rho(s,a)-\tilde{\rho}^{E}(s,a)
\displaystyle\min_{\delta}~{}\sum_{s,a}c(s,a)\delta(s,a)+\left|\delta(s,a)\right|
\displaystyle\min_{\delta}~{}
\displaystyle\sum_{s,a}c(s,a)\delta(s,a)+\left|\delta(s,a)\right|
\displaystyle\text{s.t.}\sum_{s,a}\delta(s,a)=0
\displaystyle\sum_{s,a}\delta(s,a)=0
\displaystyle\delta(s,a)\geq-\tilde{\rho}^{E}(s,a)\quad s\in\mathcal{S},a\in%
\mathcal{A}.
\displaystyle\delta(s,a)\geq-\tilde{\rho}^{E}(s,a)\quad s\in\mathcal{S},a\in%
\mathcal{A}.
\displaystyle\min_{\delta}~{}g(\delta)\doteq\sum^{n}_{i=1}c_{i}\delta_{i}+%
\left|\delta_{i}\right|
\displaystyle\min_{\delta}~{}
\displaystyle g(\delta)\doteq\sum^{n}_{i=1}c_{i}\delta_{i}+\left|\delta_{i}\right|
\displaystyle\textrm{s.t.}\sum^{n}_{i=1}\delta_{i}=0
\displaystyle\sum^{n}_{i=1}\delta_{i}=0
\displaystyle\delta_{i}\geq-\tilde{\rho}^{E}_{i}\quad i\in[n]
\displaystyle\delta_{i}\geq-\tilde{\rho}^{E}_{i}\quad i\in[n]
i
n\doteq|\mathcal{S}|\cdot|\mathcal{A}|
[n]\doteq\{1,2,\dots,n\}
\delta\doteq\{\delta_{i}:i\in[n]\}
[n]
\mathcal{N}_{1}(\delta)\doteq\{i\in[n]:\delta_{i}>0\}
\mathcal{N}_{2}(\delta)\doteq\{i\in[n]:\delta_{i}\leq 0\}
\mathcal{N}_{1}(\delta)=\emptyset
\delta_{i}=0
\displaystyle g(\delta)=\sum_{i\in\mathcal{N}_{1}(\delta)}(c_{i}+1)\delta_{i}+%
\sum_{j\in\mathcal{N}_{2}(\delta)}(c_{j}-1)\delta_{j}.
\displaystyle g(\delta)=\sum_{i\in\mathcal{N}_{1}(\delta)}(c_{i}+1)\delta_{i}+%
\sum_{j\in\mathcal{N}_{2}(\delta)}(c_{j}-1)\delta_{j}.
\delta
\delta^{\prime}
\delta^{\prime}_{\mathcal{N}_{1}}
\delta^{\prime}_{j}=-{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot\tilde{\rho}^{%
E}_{j}
j\in\mathcal{N}_{2}(\delta)
\delta^{\prime}_{i}=0
i\in\mathcal{N}_{1}(\delta)\backslash\mathcal{N}_{\mathrm{min}}
\delta^{\prime}_{i}=\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{%
\mathrm{min}}_{1}>2]\cdot\tilde{\rho}^{E}_{j}/|\mathcal{N}_{\mathrm{min}}(%
\delta)|
i\in\mathcal{N}_{\mathrm{min}}(\delta)
\mathcal{N}_{\mathrm{min}}(\delta)\doteq\{i\in\mathcal{N}_{1}(\delta):i\in\arg%
\min_{i^{\prime}\in\mathcal{N}_{1}(\delta)}c_{i^{\prime}}\}
c^{\mathrm{min}}_{1}\doteq\min_{i\in\mathcal{N}_{1}(\delta)}c_{i}
\displaystyle g(\delta^{\prime})=\sum_{i\in\mathcal{N}_{1}(\delta)}(c_{i}+1)%
\delta^{\prime}_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}(c_{j}-1)\delta^{\prime}%
_{j}
\displaystyle g(\delta^{\prime})
\displaystyle=\sum_{i\in\mathcal{N}_{1}(\delta)}(c_{i}+1)\delta^{\prime}_{i}+%
\sum_{j\in\mathcal{N}_{2}(\delta)}(c_{j}-1)\delta^{\prime}_{j}
\displaystyle=\sum_{i\in\mathcal{N}_{\mathrm{min}}(\delta)}(c_{i}+1)\delta^{%
\prime}_{i}+\sum_{i^{\prime}\in\mathcal{N}_{1}(\delta)\backslash\mathcal{N}_{%
\mathrm{min}}(\delta)}(c_{i^{\prime}}+1)\delta^{\prime}_{i^{\prime}}+\sum_{j%
\in\mathcal{N}_{2}(\delta)}(c_{j}-1)\delta^{\prime}_{j}
\displaystyle=\sum_{i\in\mathcal{N}_{\mathrm{min}}(\delta)}(c_{i}+1)\delta^{%
\prime}_{i}+\sum_{i^{\prime}\in\mathcal{N}_{1}(\delta)\backslash\mathcal{N}_{%
\mathrm{min}}(\delta)}(c_{i^{\prime}}+1)\delta^{\prime}_{i^{\prime}}+\sum_{j%
\in\mathcal{N}_{2}(\delta)}(c_{j}-1)\delta^{\prime}_{j}
\displaystyle=\sum_{i\in\mathcal{N}_{\mathrm{min}}(\delta)}(c_{i}+1)\delta^{%
\prime}_{i}+\sum_{{i^{\prime}}\in\mathcal{N}_{1}(\delta)\backslash\mathcal{N}_%
{\mathrm{min}}(\delta)}(c_{i^{\prime}}+1)\delta^{\prime}_{i^{\prime}}-\sum_{j%
\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot(c_{j}-1%
)\tilde{\rho}^{E}_{j}
\displaystyle=\sum_{i\in\mathcal{N}_{\mathrm{min}}(\delta)}(c_{i}+1)\delta^{%
\prime}_{i}+\sum_{{i^{\prime}}\in\mathcal{N}_{1}(\delta)\backslash\mathcal{N}_%
{\mathrm{min}}(\delta)}(c_{i^{\prime}}+1)\delta^{\prime}_{i^{\prime}}-\sum_{j%
\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot(c_{j}-1%
)\tilde{\rho}^{E}_{j}
\displaystyle=(c^{\mathrm{min}}_{1}+1)\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1%
}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot\tilde{\rho}^{E}_{j}-\sum_{j\in\mathcal{N%
}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot(c_{j}-1)\cdot\tilde{%
\rho}^{E}_{j}
\displaystyle=(c^{\mathrm{min}}_{1}+1)\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1%
}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot\tilde{\rho}^{E}_{j}-\sum_{j\in\mathcal{N%
}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot(c_{j}-1)\cdot\tilde{%
\rho}^{E}_{j}
\displaystyle=\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)\cdot\tilde{\rho}^{E}_{j}.
\displaystyle=\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)\cdot\tilde{\rho}^{E}_{j}.
g(\delta)
\displaystyle g(\delta)=\;\sum_{i\in\mathcal{N}_{1}(\delta)}(c_{i}+1)\delta_{i%
}+\sum_{j\in\mathcal{N}_{2}(\delta)}(c_{j}-1)\delta_{j}
\displaystyle g(\delta)=\;
\displaystyle\sum_{i\in\mathcal{N}_{1}(\delta)}(c_{i}+1)\delta_{i}+\sum_{j\in%
\mathcal{N}_{2}(\delta)}(c_{j}-1)\delta_{j}
\displaystyle\geq\;\sum_{i\in\mathcal{N}_{1}(\delta)}(c^{\mathrm{min}}_{1}+1)%
\delta_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{%
1}>2]\cdot(c_{j}-1)\delta_{j}
\displaystyle\geq\;
\displaystyle\sum_{i\in\mathcal{N}_{1}(\delta)}(c^{\mathrm{min}}_{1}+1)\delta_%
{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]%
\cdot(c_{j}-1)\delta_{j}
\displaystyle+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}\leq 2]\cdot(c_{j}-1)\delta_{j}
\displaystyle+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}\leq 2]\cdot(c_{j}-1)\delta_{j}
\displaystyle=\;-\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{%
min}}_{1}>2]\cdot(c^{\mathrm{min}}_{1}+1)\delta_{j}+\sum_{j\in\mathcal{N}_{2}(%
\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot(c_{j}-1)\delta_{j}
\displaystyle=\;
\displaystyle-\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}>2]\cdot(c^{\mathrm{min}}_{1}+1)\delta_{j}+\sum_{j\in\mathcal{N}_{2}(%
\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot(c_{j}-1)\delta_{j}
\displaystyle+(c^{\mathrm{min}}_{1}+1)\left(\sum_{i\in\mathcal{N}_{1}(\delta)}%
\delta_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{%
1}>2]\cdot\delta_{j}\right)
\displaystyle+(c^{\mathrm{min}}_{1}+1)\left(\sum_{i\in\mathcal{N}_{1}(\delta)}%
\delta_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{%
1}>2]\cdot\delta_{j}\right)
\displaystyle+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}\leq 2]\cdot(c_{j}-1)\delta_{j}
\displaystyle+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}\leq 2]\cdot(c_{j}-1)\delta_{j}
\displaystyle=\;\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{%
min}}_{1}>2]\cdot(c_{j}-c^{\mathrm{min}}_{1}-2)\delta_{j}
\displaystyle=\;
\displaystyle\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}%
_{1}>2]\cdot(c_{j}-c^{\mathrm{min}}_{1}-2)\delta_{j}
\displaystyle+(c^{\mathrm{min}}_{1}+1)\left(\sum_{i\in\mathcal{N}_{1}(\delta)}%
\delta_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{%
1}>2]\cdot\delta_{j}\right)
\displaystyle+(c^{\mathrm{min}}_{1}+1)\left(\sum_{i\in\mathcal{N}_{1}(\delta)}%
\delta_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{%
1}>2]\cdot\delta_{j}\right)
\displaystyle+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}\leq 2]\cdot(c_{j}-1)\delta_{j}
\displaystyle+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}\leq 2]\cdot(c_{j}-1)\delta_{j}
\displaystyle\geq\;\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm%
{min}}_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)\tilde{\rho}^{E}_{j}
\displaystyle\geq\;
\displaystyle\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}%
_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)\tilde{\rho}^{E}_{j}
\displaystyle+(c^{\mathrm{min}}_{1}+1)\left(\sum_{i\in\mathcal{N}_{1}(\delta)}%
\delta_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{%
1}>2]\cdot\delta_{j}\right)
\displaystyle+(c^{\mathrm{min}}_{1}+1)\left(\sum_{i\in\mathcal{N}_{1}(\delta)}%
\delta_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{%
1}>2]\cdot\delta_{j}\right)
\displaystyle+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}\leq 2]\cdot(c^{\mathrm{min}}+1)\delta_{j}
\displaystyle+\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}%
}_{1}\leq 2]\cdot(c^{\mathrm{min}}+1)\delta_{j}
\displaystyle=\;\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{%
min}}_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)\tilde{\rho}^{E}_{j}
\displaystyle=\;
\displaystyle\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}%
_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)\tilde{\rho}^{E}_{j}
\displaystyle+(c^{\mathrm{min}}_{1}+1)\left(\sum_{i\in\mathcal{N}_{1}(\delta)}%
\delta_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}\left({\bm{1}}[c_{j}-c^{\mathrm{%
min}}_{1}>2]+{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}\leq 2]\right)\cdot\delta_{j}\right)
\displaystyle+(c^{\mathrm{min}}_{1}+1)\left(\sum_{i\in\mathcal{N}_{1}(\delta)}%
\delta_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}\left({\bm{1}}[c_{j}-c^{\mathrm{%
min}}_{1}>2]+{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}\leq 2]\right)\cdot\delta_{j}\right)
\displaystyle=\;\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{%
min}}_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)\tilde{\rho}^{E}_{j}+(c^{%
\mathrm{min}}_{1}+1)\underbrace{\left(\sum_{i\in\mathcal{N}_{1}(\delta)}\delta%
_{i}+\sum_{j\in\mathcal{N}_{2}(\delta)}\delta_{j}\right)}_{=0}
\displaystyle=\;
\displaystyle\sum_{j\in\mathcal{N}_{2}(\delta)}{\bm{1}}[c_{j}-c^{\mathrm{min}}%
_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)\tilde{\rho}^{E}_{j}+(c^{\mathrm{min%
}}_{1}+1)\underbrace{\left(\sum_{i\in\mathcal{N}_{1}(\delta)}\delta_{i}+\sum_{%
j\in\mathcal{N}_{2}(\delta)}\delta_{j}\right)}_{=0}
\displaystyle=\;g(\delta^{\prime}).
\displaystyle=\;
\displaystyle g(\delta^{\prime}).
\mathcal{G}\doteq\{\delta\in\mathbb{R}^{|\mathcal{S}|\cdot|\mathcal{A}|}~{}%
\text{s.t.}~{}\text{(\ref{eqn:trans_2_c1})}~{}\text{and}~{}\text{(\ref{eqn:%
trans_2_c2})}\}
\displaystyle\delta^{\prime}_{\mathcal{N}_{1}}=\mathop{\arg\min}_{\delta\in%
\mathcal{G}(\mathcal{N}_{1})}g(\delta),
\displaystyle\delta^{\prime}_{\mathcal{N}_{1}}=\mathop{\arg\min}_{\delta\in%
\mathcal{G}(\mathcal{N}_{1})}g(\delta),
\mathcal{G}(\mathcal{N}_{1})\doteq\{\delta\in\mathcal{G}:\mathcal{N}_{1}(%
\delta)=\mathcal{N}_{1}~{}\text{and}~{}\mathcal{N}_{2}(\delta)=[n]\backslash%
\mathcal{N}_{1}\}
\displaystyle\min_{\delta\in\mathcal{G}}g(\delta)=\min_{\mathcal{N}_{1}\subset%
[n]}g(\delta^{\prime}_{\mathcal{N}_{1}})=\min_{\mathcal{N}_{1}\subset[n]}\sum_%
{j\in[n]\backslash\mathcal{N}_{1}}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot(%
c^{\mathrm{min}}_{1}-c_{j}+2)\cdot\tilde{\rho}^{E}_{j}.
\displaystyle\min_{\delta\in\mathcal{G}}g(\delta)=\min_{\mathcal{N}_{1}\subset%
[n]}g(\delta^{\prime}_{\mathcal{N}_{1}})=\min_{\mathcal{N}_{1}\subset[n]}\sum_%
{j\in[n]\backslash\mathcal{N}_{1}}{\bm{1}}[c_{j}-c^{\mathrm{min}}_{1}>2]\cdot(%
c^{\mathrm{min}}_{1}-c_{j}+2)\cdot\tilde{\rho}^{E}_{j}.
c^{\mathrm{min}}\doteq\min_{i\in[n]}c_{i}
\mathcal{N}^{*}_{1}\doteq\{i\in[n]:c_{i}=c^{\mathrm{min}}\}
\displaystyle g(\delta^{\prime}_{\mathcal{N}_{1}})-g(\delta^{\prime}_{\mathcal%
{N}^{*}_{1}})=\;\sum_{j\in[n]\backslash\mathcal{N}_{1}}{\bm{1}}[c_{j}-c^{%
\mathrm{min}}_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)
\displaystyle g(\delta^{\prime}_{\mathcal{N}_{1}})-g(\delta^{\prime}_{\mathcal%
{N}^{*}_{1}})=\;
\displaystyle\sum_{j\in[n]\backslash\mathcal{N}_{1}}{\bm{1}}[c_{j}-c^{\mathrm{%
min}}_{1}>2]\cdot(c^{\mathrm{min}}_{1}-c_{j}+2)
\displaystyle-\sum_{j^{\prime}\in[n]\backslash\mathcal{N}^{*}_{1}}{\bm{1}}[c_{%
j^{\prime}}-c^{\mathrm{min}}>2]\cdot(c^{\mathrm{min}}-c_{j^{\prime}}+2)
\displaystyle-\sum_{j^{\prime}\in[n]\backslash\mathcal{N}^{*}_{1}}{\bm{1}}[c_{%
j^{\prime}}-c^{\mathrm{min}}>2]\cdot(c^{\mathrm{min}}-c_{j^{\prime}}+2)
\displaystyle\geq\;\sum_{j\in[n]\backslash\mathcal{N}_{1}}{\bm{1}}[c_{j}-c^{%
\mathrm{min}}_{1}>2]\cdot(c^{\mathrm{min}}-c_{j}+2)
\displaystyle\geq\;
\displaystyle\sum_{j\in[n]\backslash\mathcal{N}_{1}}{\bm{1}}[c_{j}-c^{\mathrm{%
min}}_{1}>2]\cdot(c^{\mathrm{min}}-c_{j}+2)
\displaystyle-\sum_{j^{\prime}\in[n]\backslash\mathcal{N}^{*}_{1}}{\bm{1}}[c_{%
j^{\prime}}-c^{\mathrm{min}}>2]\cdot(c^{\mathrm{min}}-c_{j^{\prime}}+2)
\displaystyle-\sum_{j^{\prime}\in[n]\backslash\mathcal{N}^{*}_{1}}{\bm{1}}[c_{%
j^{\prime}}-c^{\mathrm{min}}>2]\cdot(c^{\mathrm{min}}-c_{j^{\prime}}+2)
\displaystyle\geq\;0,
\displaystyle\geq\;
\displaystyle 0,
\{j\in[n]/\mathcal{N}_{1}:c_{j}-c^{\mathrm{min}}_{1}>2\}
\{j^{\prime}\in[n]/\mathcal{N}^{*}_{1}:c_{j^{\prime}}-c^{\mathrm{min}}>2\}
\delta^{*}\doteq\delta^{\prime}_{\mathcal{N}^{*}_{1}}=\min_{\delta\in\mathcal{%
G}}g(\delta)
\delta^{*}
\displaystyle\delta^{*}(s,a)=\begin{cases}\frac{\sum_{s^{\prime},a^{\prime}}{%
\bm{1}}[c(s^{\prime},a^{\prime})-c^{\mathrm{min}}>2]\cdot\tilde{\rho}^{E}(s^{%
\prime},a^{\prime})}{|\mathcal{N}_{\mathrm{min}}|},~{}&\textit{if}~{}c(s,a)%
\leq c^{\mathrm{min}}\\
-\tilde{\rho}^{E}(s,a),~{}&\textit{if}~{}c(s,a)>c^{\mathrm{min}}+2\\
0,~{}&\textit{otherwise}\end{cases}
\displaystyle\delta^{*}(s,a)=\begin{cases}\frac{\sum_{s^{\prime},a^{\prime}}{%
\bm{1}}[c(s^{\prime},a^{\prime})-c^{\mathrm{min}}>2]\cdot\tilde{\rho}^{E}(s^{%
\prime},a^{\prime})}{|\mathcal{N}_{\mathrm{min}}|},~{}&\textit{if}~{}c(s,a)%
\leq c^{\mathrm{min}}\\
-\tilde{\rho}^{E}(s,a),~{}&\textit{if}~{}c(s,a)>c^{\mathrm{min}}+2\\
0,~{}&\textit{otherwise}\end{cases}
\mathcal{N}_{\mathrm{min}}=\mathcal{N}^{*}_{1}
\delta(s,a)+\tilde{\rho}^{E}(s,a)=\rho(s,a)
\displaystyle\rho^{*}(s,a)=\begin{cases}\frac{\sum_{s^{\prime},a^{\prime}}{\bm%
{1}}[c(s^{\prime},a^{\prime})-c^{\mathrm{min}}>2]\cdot\tilde{\rho}^{E}(s^{%
\prime},a^{\prime})}{|\mathcal{N}_{\mathrm{min}}|}+\tilde{\rho}^{E}(s,a),~{}&%
\textit{if}~{}c(s,a)\leq c^{\mathrm{min}}\\
0,~{}&\textit{if}~{}c(s,a)>c^{\mathrm{min}}+2\\
\tilde{\rho}^{E}(s,a),~{}&\textit{otherwise}\end{cases}
\displaystyle\rho^{*}(s,a)=\begin{cases}\frac{\sum_{s^{\prime},a^{\prime}}{\bm%
{1}}[c(s^{\prime},a^{\prime})-c^{\mathrm{min}}>2]\cdot\tilde{\rho}^{E}(s^{%
\prime},a^{\prime})}{|\mathcal{N}_{\mathrm{min}}|}+\tilde{\rho}^{E}(s,a),~{}&%
\textit{if}~{}c(s,a)\leq c^{\mathrm{min}}\\
0,~{}&\textit{if}~{}c(s,a)>c^{\mathrm{min}}+2\\
\tilde{\rho}^{E}(s,a),~{}&\textit{otherwise}\end{cases}
c(s,a)>c^{\min}
\tilde{\rho}^{D}(s,a)=0
\tilde{\rho}^{D}(s,a)=0
\rho^{*}(s,a)=0
\beta^{*}(s,a)\tilde{\rho}^{D}(s,a)
\delta^{*}(s,a)
f
\rho_{1}
\rho_{2}
\displaystyle D_{f}(\rho_{1}\|\rho_{2})=\mathbb{E}_{\rho_{2}}\left[f\left(%
\frac{\rho_{1}}{\rho_{2}}\right)\right]=\sup_{g}\mathbb{E}_{X\sim\rho_{1}}[g(X%
)]-\mathbb{E}_{X\sim\rho_{2}}\left[f^{*}(g(X))\right]
\displaystyle D_{f}(\rho_{1}\|\rho_{2})=\mathbb{E}_{\rho_{2}}\left[f\left(%
\frac{\rho_{1}}{\rho_{2}}\right)\right]=\sup_{g}\mathbb{E}_{X\sim\rho_{1}}[g(X%
)]-\mathbb{E}_{X\sim\rho_{2}}\left[f^{*}(g(X))\right]
f^{*}
\chi^{2}
f
f(x)=(x-1)^{2}
f^{*}(y)=\frac{y^{2}}{4}+y
\displaystyle\chi^{2}(\rho_{1},\rho_{2})=\sup_{g}E_{X\sim\rho_{1}}[g(X)]-E_{X%
\sim\rho_{2}}\left[\frac{g(X)^{2}}{4}+g(X)\right]
\displaystyle\chi^{2}(\rho_{1},\rho_{2})=\sup_{g}E_{X\sim\rho_{1}}[g(X)]-E_{X%
\sim\rho_{2}}\left[\frac{g(X)^{2}}{4}+g(X)\right]
g=-r
X=(s,a)
\displaystyle\chi^{2}(\rho_{1},\rho_{2})=\sup_{r}E_{(s,a)\sim\rho_{2}}\left[r(%
s,a)\right]-E_{(s,a)\sim\rho_{1}}[r(s,a)]-\frac{1}{4}E_{(s,a)\sim\rho_{2}}%
\left[r(s,a)^{2}\right]
\displaystyle\chi^{2}(\rho_{1},\rho_{2})=\sup_{r}E_{(s,a)\sim\rho_{2}}\left[r(%
s,a)\right]-E_{(s,a)\sim\rho_{1}}[r(s,a)]-\frac{1}{4}E_{(s,a)\sim\rho_{2}}%
\left[r(s,a)^{2}\right]
\psi(r)=\frac{r^{2}}{4\delta}
\chi^{2}
\max_{\hat{\rho}\in\mathcal{C}_{\widehat{T}}}\alpha\bar{{H}}(\hat{\rho})-Z_{%
\beta}\delta\cdot\chi^{2}(\hat{\rho},\hat{\rho}^{*})
