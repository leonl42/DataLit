\mathsf{C}_{4}
x
\mathsf{g}\in\mathsf{C}_{4}
\mathsf{g}
\mathsf{G}
\displaystyle y=f(\mathsf{g}\circ x,x),\quad\mathsf{g}=g(x)\in\mathsf{G}.
\displaystyle y=f(\mathsf{g}\circ x,x),\quad\mathsf{g}=g(x)\in\mathsf{G}.
x\in\mathbb{R}^{d_{\text{in}}}
y\in\mathbb{R}^{d_{\text{out}}}
f,g
\circ
\mathsf{g}
f
x
\displaystyle y=f(\mathsf{g}\circ x)\quad\text{for {every} }\mathsf{g}\in%
\mathsf{G}
\displaystyle y
\displaystyle=f(\mathsf{g}\circ x)\quad\text{for {every} }\mathsf{g}\in\mathsf%
{G}
\displaystyle\mathsf{g}\circ y=f(\mathsf{g}\circ x)\quad\text{for {every} }%
\mathsf{g}\in\mathsf{G}.
\displaystyle\mathsf{g}\circ y
\displaystyle=f(\mathsf{g}\circ x)\quad\text{for {every} }\mathsf{g}\in\mathsf%
{G}.
90^{\circ}
1
0
90^{\circ}
1
0
{\bm{M}}\in[0,1]^{n_{Q}\times n_{K}}
\displaystyle{\bm{A}}=\mathrm{softmax}\big{(}\frac{{\bm{Q}}{\bm{K}}^{\top}}{%
\sqrt{d}}\big{)}\odot{\bm{M}},
\displaystyle{\bm{A}}=\mathrm{softmax}\big{(}\frac{{\bm{Q}}{\bm{K}}^{\top}}{%
\sqrt{d}}\big{)}\odot{\bm{M}},
{\bm{Q}}\in{\mathbb{R}}^{n_{Q}\times d}
{\bm{K}}\in{\mathbb{R}}^{n_{K}\times d}
d
n_{Q}
n_{K}
\odot
\mathrm{softmax}
{\bm{M}}
\mathrm{softmax}
{\bm{X}}
\mathrm{MaskedAttention}({\bm{Q}},{\bm{K}},{\bm{V}};{\bm{M}})=\frac{{\bm{A}}}{%
{\bm{A}}\cdot{\bm{1}}_{n_{K}}{\bm{1}}_{n_{K}}^{\top}}\,{\bm{V}},
{\bm{1}}_{n}
n
{\bm{V}}\in{\mathbb{R}}^{d\times n_{K}}
{\bm{Q}}={\bm{K}}={\bm{V}}={\bm{X}}
\mathrm{MaskedAttention}({\bm{X}};{\bm{M}})
{\bm{X}}
{\bm{x}}=(x_{1},\dots,x_{n})^{\top}
n
\mathrm{MaskedAttention}({\bm{x}};{\bm{M}})=(x_{n},x_{1},\dots,x_{n-1})^{\top}
{\bm{M}}=\begin{pmatrix}0&0&\cdots&1\\
1&0&\cdots&0\\
\vdots&\ddots&\ddots&\vdots\\
0&\cdots&1&0\end{pmatrix}.
{\bm{M}}
{\bm{x}}
\mathsf{G}_{m}
m
{\bm{X}}\in{\mathbb{R}}^{n\times d}
m
{\bm{\mathsfit{X}}}\in{\mathbb{R}}^{l_{1}\times\dots\times l_{m}}
n=l_{1}\cdot\ldots\cdot l_{m}
\mathsf{g}\in\mathsf{G}_{m}
{\bm{M}}_{\mathsf{g}}\in\{0,1\}^{n\times n}
\mathrm{MaskedAttention}({\bm{X}};{\bm{M}}_{\mathsf{g}})=\mathsf{g}\circ{\bm{X%
}}.
{\bm{M}}_{\mathsf{g}}
\mathsf{g}
{\bm{o}}(\mathsf{g}_{i})_{k}
k
{\bm{o}}(\mathsf{g}_{i})\in{\mathbb{R}}^{n}
k=1,\dots,n
{\bm{o}}(\mathsf{g}_{i})_{k}
k
{\bm{o}}(\mathsf{g}_{i})\in{\mathbb{R}}^{n}
k=1,\dots,n
{\bm{\mathsfit{X}}}
{\bm{o}}(\mathsf{g}_{i})_{k}=0
n=l_{1}
\delta
{\bm{o}}(\mathsf{g}_{i})_{k}=-\delta
n=l_{1}
{\bm{o}}(\mathsf{g}_{i})_{1}=(n-1)
{\bm{o}}(\mathsf{g})_{k}={\bm{o}}(\mathsf{g})_{k-1}-2
n=l_{1}
(90^{\circ})
\begin{aligned} {\bm{o}}(\mathsf{g}_{i})_{k}=&k\cdot(l_{1}-1)-\\
&\lfloor(k-1)/l_{1}\rfloor\end{aligned}
n=l_{1}\times l_{2}
h
\begin{aligned} {\bm{o}}(\mathsf{g}_{i})_{k}=&(k-1\text{ mod }h)+\\
&(h-1)\cdot\lfloor(k-1)/h\rfloor\end{aligned}
n=l_{1}
\mathsf{G}_{m}
m
\mathsf{g}\in\mathsf{G}_{m}
{\bm{\mathsfit{X}}}\in{\mathbb{R}}^{l_{1}\times\dots\times l_{m}}
{\bm{M}}_{\mathsf{g}_{i}}\in\{0,1\}^{n_{i}\times n_{i}}
\displaystyle{\bm{M}}_{\mathsf{g}}=\bigotimes_{i}{\bm{M}}_{\mathsf{g}_{i}}%
\quad\text{and}
\displaystyle{\bm{M}}_{\mathsf{g}}
\displaystyle=\bigotimes_{i}{\bm{M}}_{\mathsf{g}_{i}}\quad\text{and}
\displaystyle\mathcal{F}({\bm{M}}_{\mathsf{g}_{i}})=\mathcal{F}({\bm{I}}_{n_{i%
}})\,\exp(-\frac{2\pi{}j}{n_{i}}\,{\bm{o}}(\mathsf{g}_{i})\,{\bm{r}}_{n_{i}}^{%
\top}),
\displaystyle\mathcal{F}({\bm{M}}_{\mathsf{g}_{i}})
\displaystyle=\mathcal{F}({\bm{I}}_{n_{i}})\,\exp(-\frac{2\pi{}j}{n_{i}}\,{\bm%
{o}}(\mathsf{g}_{i})\,{\bm{r}}_{n_{i}}^{\top}),
{\bm{M}}_{\mathsf{g}}\in\{0,1\}^{n\times n}
\mathsf{g}
\mathsf{g}_{i}\in\mathsf{G}_{m_{i}}
m_{i}\in\{1,2\}
\otimes
\mathcal{F}
{\bm{I}}_{n_{i}}
n_{i}\times n_{i}
j
{\bm{r}}_{n_{i}}=(1,2,\dots,n_{i})^{\top}
{\bm{o}}(\mathsf{g}_{i})
\delta=1
{\bm{x}}\in{\mathbb{R}}^{n}
1
m=1
{\bm{o}}(\mathsf{g})
-1
{\bm{M}}_{\mathsf{g}}
{\bm{M}}_{\mathsf{g}}
-1
{\bm{o}}(\mathsf{g})
k
k
k
{\bm{X}}
{\bm{o}}(\mathsf{g})_{k}=-1
k=1,\dots,n
{\bm{o}}(\mathsf{g}_{i})
\mathsf{G}_{m}
m
{\bm{M}}_{\mathsf{g}}\in{\mathbb{R}}^{n\times n}
\mathsf{g}\in\mathsf{G}_{m}
{\bm{M}}_{\mathsf{g}}[:,i]=\mathcal{F}^{-1}(\exp(-\frac{2\pi{}j}{n}\cdot{\bm{o%
}}(\mathsf{g})\cdot{\bm{r}}_{n}^{\top}))[:,i]\star{\bm{I}}_{n}[:,i],
\star
n
m
\mathrm{MaskedAttention}
\displaystyle{\bm{M}}_{0}={\bm{I}},
\displaystyle{\bm{M}}_{0}
\displaystyle={\bm{I}},
\displaystyle{\bm{M}}_{l+1}=\alpha_{l}\,\text{Conv}({\bm{M}}_{l},{\bm{K}}_{l})%
+(1-\alpha_{l}){\bm{M}}_{l}
\displaystyle{\bm{M}}_{l+1}
\displaystyle=\alpha_{l}\,\text{Conv}({\bm{M}}_{l},{\bm{K}}_{l})+(1-\alpha_{l}%
){\bm{M}}_{l}
l=0,\ldots,L-1
{\bm{M}}_{L}
\alpha_{l}=\sigma_{l}({\bm{X}};{\bm{\theta}})=\mathrm{FFN}_{l}({\bm{X}},{\bm{%
\theta}})
{\bm{\theta}}
{\bm{K}}_{l}
l
L
\delta=2^{L}-1
\sigma
\sigma
\mathsf{g}_{i}
\mathsf{g}_{j}=\mathsf{e}\circ\mathsf{g}_{i}
\mathsf{e}
90^{\circ}
\mathsf{C_{4}}
y
y
S_{n}
\mathsf{SE}(3)
{\bm{M}}_{T}^{(\delta)}
\delta
{\bm{M}}_{R}^{(90)}
90^{\circ}
{\bm{M}}_{F}
{\bm{M}}_{S}^{(h)}
h
\sigma
\sigma({\bm{M}}_{S},{\bm{M}}_{S}^{\top})
30\times 30
30\times 30
[1,29]\times[1,29]
[2,5]\times[2,5]
d
P_{\textit{synth}}(\textit{prog}\mid\textit{natprog})\propto P_{\textit{gen}}(%
\textit{prog}\mid\textit{natprog})\mathbbm{1}[\textit{prog}\vdash\textit{IO}].
P_{\textit{gen}}
\mathbbm{1}[\textit{prog}\vdash\textit{IO}]
P_{\textit{synth}}(\textit{prog})
P_{\textit{synth}}(\textit{prog}\mid\textit{NL})
\textit{prog}(x)=y
(x,y)\in\textit{IO}
{\bm{x}}_{\textit{noise}}=(1-w){\bm{W}}^{\top}\bm{1}_{\textit{hot}}(x)+wW^{%
\top}\bm{1}
w\in[0,1]
\bm{1}_{\textit{hot}}(x)
x
{\bm{W}}\in\mathbb{R}^{n\times d}
n
{\bm{x}}_{\textit{noise}}
x
w=0.2
w=0.4
w=0.6
\alpha
2\%
30\times 30
(A\xrightarrow[]{}B)
(B\xrightarrow[]{}A)
(A\xrightarrow[]{}B)
(B\xrightarrow[]{}A)
\alpha
\alpha
(A\xrightarrow[]{}B)
\pm
\pm
\pm
\pm
\pm
\pm
(B\xrightarrow[]{}A)
\pm
\pm
\pm
\pm
\pm
\pm
(A\xrightarrow[]{}B)
\pm
\pm
\pm
\pm
\pm
\pm
(B\xrightarrow[]{}A)
\pm
\pm
\pm
\pm
\pm
\pm
(A\xrightarrow[]{}B)
\pm
\pm
\pm
\pm
\pm
\pm
(B\xrightarrow[]{}A)
\pm
\pm
\pm
\pm
\pm
\pm
(A\xrightarrow[]{}B)
\pm
\pm
\pm
\pm
\pm
\pm
(B\xrightarrow[]{}A)
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
m
{\bm{M}}\in\{0,1\}^{n\times n}
1
{\bm{M}}\cdot\mathbf{1}_{n}=\mathbf{1}_{n}
{\bm{X}}\in{\mathbb{R}}^{n\times d}
\displaystyle\mathrm{MaskedAttention}({\bm{X}};{\bm{M}})=\frac{{\bm{A}}}{{\bm{%
A}}\cdot{\bm{1}}_{n}{\bm{1}}_{n}^{\top}}\,{\bm{X}}
\displaystyle\mathrm{MaskedAttention}({\bm{X}};{\bm{M}})
\displaystyle=\frac{{\bm{A}}}{{\bm{A}}\cdot{\bm{1}}_{n}{\bm{1}}_{n}^{\top}}\,{%
\bm{X}}
\displaystyle=\frac{\mathrm{softmax}\big{(}\frac{{\bm{X}}{\bm{X}}^{\top}}{%
\sqrt{d}}\big{)}\odot{\bm{M}}}{\mathrm{softmax}\big{(}\frac{{\bm{X}}{\bm{X}}^{%
\top}}{\sqrt{d}}\big{)}\odot{\bm{M}}\cdot{\bm{1}}_{n}{\bm{1}}_{n}^{\top}}\,{%
\bm{X}}
\displaystyle=\frac{\mathrm{softmax}\big{(}\frac{{\bm{X}}{\bm{X}}^{\top}}{%
\sqrt{d}}\big{)}\odot{\bm{M}}}{\mathrm{softmax}\big{(}\frac{{\bm{X}}{\bm{X}}^{%
\top}}{\sqrt{d}}\big{)}\odot{\bm{M}}\cdot{\bm{1}}_{n}{\bm{1}}_{n}^{\top}}\,{%
\bm{X}}
\displaystyle={\bm{M}}\cdot{\bm{X}}.
\displaystyle={\bm{M}}\cdot{\bm{X}}.
\mathsf{g}\in\mathsf{G}_{1}
{\bm{M}}_{\mathsf{g}}
\mathrm{MaskedAttention}({\bm{X}};{\bm{M}}_{\mathsf{g}})=\mathsf{g}\circ{\bm{X%
}}.
{\bm{x}}=(x_{1},x_{2},\dots,x_{n})^{\top}
{\bm{M}}={\bm{M}}_{T}^{(1)}=\begin{pmatrix}0&0&0&\cdots&1\\
1&0&0&\cdots&0\\
0&1&0&\cdots&0\\
\vdots&\ddots&\ddots&\ddots&\vdots\\
0&\cdots&0&1&0\end{pmatrix}.
{\bm{M}}_{T}^{(1)}\cdot\mathbf{1}_{n}=\mathbf{1}_{n}
\mathrm{MaskedAttention}({\bm{x}};{\bm{M}}_{T}^{(1)})={\bm{M}}_{T}^{(1)}\cdot{%
\bm{x}}=(x_{n},x_{1},x_{2},\dots,x_{n-1})^{\top}.
\delta
{\bm{M}}_{T}^{(\delta)}=({\bm{M}}_{T}^{(1)})^{\delta}
{\bm{M}}_{T}^{(\delta)}
1
{\bm{M}}_{T}^{(\delta)}=\mathcal{F}^{-1}\big{(}\mathcal{F}({\bm{I}}_{n})\,\exp%
(-\frac{2\pi{}j}{n}\,{\bm{o}}_{T}^{(\delta)}\,{\bm{r}}_{n}^{\top})\big{)}\quad%
\text{where}\quad{\bm{o}}_{T}^{(\delta)}=\begin{pmatrix}-\delta\\
-\delta\\
\vdots\\
-\delta\end{pmatrix}.
{\bm{M}}_{T}^{(\delta)}
\delta
1
{\bm{x}}=(x_{0},x_{1},\dots,x_{n})^{\top}
\mathrm{MaskedAttention}({\bm{x}};{\bm{M}}_{F})={\bm{M}}_{F}\cdot{\bm{x}}=(x_{%
n},x_{n-1},\dots,x_{2},x_{1})^{\top}
{\bm{M}}_{F}=\begin{pmatrix}0&\cdots&0&0&1\\
0&\cdots&0&1&0\\
0&\cdots&1&0&0\\
\vdots&\cdots&\vdots&\vdots&\vdots\\
1&\cdots&0&0&0\end{pmatrix}.
{\bm{M}}_{F}
{\bm{o}}_{F}=\begin{pmatrix}n-1\\
n-3\\
n-5\\
\vdots\\
1\end{pmatrix}.
{\bm{M}}_{F}=\mathcal{F}^{-1}\big{(}\mathcal{F}({\bm{I}}_{n})\,\exp(-\frac{2%
\pi{}j}{n}\,{\bm{o}}_{F}\,{\bm{r}}_{n}^{\top})\big{)}.
{\bm{X}}\in{\mathbb{R}}^{l_{1}\cdot l_{2}}
n=l_{1}\times l_{2}
{\bm{o}}_{R}\in{\mathbb{R}}^{n}
{\bm{M}}_{R}^{(90)}=\mathcal{F}^{-1}\big{(}\mathcal{F}({\bm{I}}_{n})\,\exp(-%
\frac{2\pi{}j}{n}\,{\bm{o}}_{R}\,{\bm{r}}_{n}^{\top})\big{)}
{\bm{X}}
{\bm{o}}_{R}^{(90)}
l_{1}
{\bm{X}}
(l_{1}-1)
({\bm{o}}_{R}^{(90)})_{k}=k\cdot(l_{1}-1)-\lfloor(k-1)/l_{1}\rfloor
{\bm{x}}=(x_{0},x_{1},\dots,x_{n})^{\top}
h\in{\mathbb{N}}
h=2
\mathrm{MaskedAttention}({\bm{x}};{\bm{M}}_{S}^{(h)})={\bm{M}}_{S}^{(h)}\cdot{%
\bm{x}}=(x_{1},x_{1},x_{2},x_{2},\dots,x_{\lfloor n/2\rfloor})^{\top},
{\bm{M}}_{S}^{(h)}=\begin{pmatrix}1&0&\cdots&0&0\\
1&0&\cdots&0&0\\
0&1&\cdots&0&0\\
0&1&\cdots&0&0\\
\vdots&\vdots&\cdots&\vdots&\vdots\\
0&0&\cdots&0&0\end{pmatrix}.
{\bm{M}}_{S}^{(h)}=\mathcal{F}^{-1}\big{(}\mathcal{F}({\bm{I}}_{n})\,\exp(-%
\frac{2\pi{}j}{n}\,{\bm{o}}_{S}^{(h)}\,{\bm{r}}_{n}^{\top})\big{)},
({\bm{o}}_{S}^{(h)})_{k}=(k-1\text{ mod }h)+(h-1)\cdot\lfloor(k-1)/h\rfloor
{\bm{M}}_{\mathsf{g}_{1}}\in\{0,1\}^{n_{1}\times n_{1}}
{\bm{M}}_{\mathsf{g}_{2}}\in\{0,1\}^{n_{2}\times n_{2}}
\mathsf{g}_{1}\in\mathsf{G}_{m_{1}}
\mathsf{g}_{2}\in\mathsf{G}_{m_{2}}
{\bm{\mathsfit{X}}}_{1}\in{\mathbb{R}}^{l_{1}\times\dots\times l_{m_{1}}}
{\bm{\mathsfit{X}}}_{2}\in{\mathbb{R}}^{l_{1}^{\prime}\times\dots\times l_{m_{%
2}}^{\prime}}
n_{1}=l_{1}\cdot\ldots\cdot l_{m_{1}}
n_{2}=l_{1}^{\prime}\cdot\ldots\cdot l_{m_{2}}^{\prime}
{\bm{\mathsfit{X}}}\in{\mathbb{R}}^{l_{1}\times\dots\times l_{m_{1}}\times l_{%
1}^{\prime}\times\dots\times l_{m_{2}}^{\prime}}
{\bm{X}}\in{\mathbb{R}}^{n}
n=n_{1}n_{2}
\displaystyle\mathrm{MaskedAttention}({\bm{X}};{\bm{M}}_{\mathsf{g}_{1}}%
\otimes{\bm{M}}_{\mathsf{g}_{2}})=
\displaystyle\mathrm{MaskedAttention}({\bm{X}};{\bm{M}}_{\mathsf{g}_{1}}%
\otimes{\bm{M}}_{\mathsf{g}_{2}})=
\displaystyle\quad\quad=({\bm{M}}_{\mathsf{g}_{1}}\otimes{\bm{M}}_{\mathsf{g}_%
{2}})\,{\bm{X}}
\displaystyle\quad\quad=({\bm{M}}_{\mathsf{g}_{1}}\otimes{\bm{M}}_{\mathsf{g}_%
{2}})\,{\bm{X}}
\displaystyle\quad\quad=({\bm{M}}_{\mathsf{g}_{1}}\otimes{\bm{I}}_{n_{2}})({%
\bm{I}}_{n_{1}}\otimes{\bm{M}}_{\mathsf{g}_{2}}){\bm{X}}
\displaystyle\quad\quad=({\bm{M}}_{\mathsf{g}_{1}}\otimes{\bm{I}}_{n_{2}})({%
\bm{I}}_{n_{1}}\otimes{\bm{M}}_{\mathsf{g}_{2}}){\bm{X}}
\displaystyle\quad\quad=\mathrm{MaskedAttention}(\mathrm{MaskedAttention}({\bm%
{X}};{\bm{I}}_{n_{1}}\otimes{\bm{M}}_{\mathsf{g}_{2}});{\bm{M}}_{\mathsf{g}_{1%
}}\otimes{\bm{I}}_{n_{2}}).
\displaystyle\quad\quad=\mathrm{MaskedAttention}(\mathrm{MaskedAttention}({\bm%
{X}};{\bm{I}}_{n_{1}}\otimes{\bm{M}}_{\mathsf{g}_{2}});{\bm{M}}_{\mathsf{g}_{1%
}}\otimes{\bm{I}}_{n_{2}}).
\displaystyle\mathrm{MaskedAttention}({\bm{X}};{\bm{I}}_{n_{1}}\otimes{\bm{M}}%
_{\mathsf{g}_{2}})=({\bm{I}}_{n_{1}}\otimes{\bm{M}}_{\mathsf{g}_{2}})\,{\bm{X}}
\displaystyle\mathrm{MaskedAttention}({\bm{X}};{\bm{I}}_{n_{1}}\otimes{\bm{M}}%
_{\mathsf{g}_{2}})
\displaystyle=({\bm{I}}_{n_{1}}\otimes{\bm{M}}_{\mathsf{g}_{2}})\,{\bm{X}}
\displaystyle=\mathrm{vec}({\bm{M}}_{\mathsf{g}_{2}}\,\mathrm{vec}^{-1}({\bm{X%
}})\,{\bm{I}}_{n_{1}})
\displaystyle=\mathrm{vec}({\bm{M}}_{\mathsf{g}_{2}}\,\mathrm{vec}^{-1}({\bm{X%
}})\,{\bm{I}}_{n_{1}})
\displaystyle=\mathrm{vec}({\bm{M}}_{\mathsf{g}_{2}}\,\mathrm{vec}^{-1}({\bm{X%
}})),
\displaystyle=\mathrm{vec}({\bm{M}}_{\mathsf{g}_{2}}\,\mathrm{vec}^{-1}({\bm{X%
}})),
\displaystyle\mathrm{MaskedAttention}({\bm{X}};{\bm{M}}_{\mathsf{g}_{1}}%
\otimes{\bm{I}}_{n_{2}})=({\bm{M}}_{\mathsf{g}_{1}}\otimes{\bm{I}}_{n_{2}})\,{%
\bm{X}}
\displaystyle\mathrm{MaskedAttention}({\bm{X}};{\bm{M}}_{\mathsf{g}_{1}}%
\otimes{\bm{I}}_{n_{2}})
\displaystyle=({\bm{M}}_{\mathsf{g}_{1}}\otimes{\bm{I}}_{n_{2}})\,{\bm{X}}
\displaystyle=\mathrm{vec}({\bm{I}}_{n_{2}}\,\mathrm{vec}^{-1}({\bm{X}})\,{\bm%
{M}}_{\mathsf{g}_{1}}^{\top})
\displaystyle=\mathrm{vec}({\bm{I}}_{n_{2}}\,\mathrm{vec}^{-1}({\bm{X}})\,{\bm%
{M}}_{\mathsf{g}_{1}}^{\top})
\displaystyle=\mathrm{vec}(({\bm{M}}_{\mathsf{g}_{1}}\,\mathrm{vec}^{-1}({\bm{%
X}})^{\top})^{\top}).
\displaystyle=\mathrm{vec}(({\bm{M}}_{\mathsf{g}_{1}}\,\mathrm{vec}^{-1}({\bm{%
X}})^{\top})^{\top}).
{\bm{M}}_{\mathsf{g}_{1}}\otimes{\bm{M}}_{\mathsf{g}_{2}}
{\bm{\mathsfit{X}}}
\mathsf{g}_{1}
m_{1}
\mathsf{g}_{2}
m_{2}
{\bm{\mathsfit{X}}}
