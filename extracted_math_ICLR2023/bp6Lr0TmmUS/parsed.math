\star
m
x_{m}
h_{m}
h_{m}
\hat{h}
\mathcal{H}^{r}
\mathcal{H}^{r+1}_{m}
\mathcal{H}^{r+1}
m
x_{m}
h_{m}
h_{m}
\hat{h}
\mathcal{H}^{r}
\mathcal{H}^{r+1}_{m}
\mathcal{H}^{r+1}
\mathcal{M}=\left\{1,2,\cdots,M\right\}
M
\mathcal{D}_{m}
\theta\in\mathbb{R}^{d}
C
\cup_{m\in\mathcal{M}}\mathcal{D}_{m}
[C]
\mathcal{D}_{m}
(x,y)\in\mathcal{X}\times[C]
x
\mathcal{X}
y
\rho(\theta;x):\mathcal{X}\to\mathbb{R}^{C}
\min_{\theta\in\mathbb{R}^{d}}F(\theta):=\sum_{m=1}^{M}p_{m}F_{m}(\theta)=\sum%
_{m=1}^{M}p_{m}\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}f(\theta;x,y),
F_{m}(\theta)=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}f(\theta;x,y)
m
f(\theta;x,y)=CE(\rho(\theta;x),y)
CE
p_{m}>0
\sum_{m=1}^{M}p_{m}=1
p_{m}
\frac{n_{m}}{N}
n_{m}
m
N=\sum_{m=1}^{M}n_{m}
r
\theta^{r-1}
\mathcal{S}^{r}\subseteq\mathcal{M}
\left\{\theta_{m}^{r}\right\}
\theta^{r}
\rho(\theta;\cdot)
\theta
\mathcal{D}
\mathcal{D}
\rho(\theta;\cdot)
W_{d}(\rho(\theta),\mathcal{D})=\mathbb{E}_{(x,y)\sim\mathcal{D}}\inf_{\text{%
argmax}_{i}\rho(\theta;x^{\prime})_{i}\neq y}d(x^{\prime},x)
d
\text{argmax}_{i}\rho(\theta;x^{\prime})_{i}\neq y
\rho(\theta;x^{\prime})
x^{\prime}
x
y
x^{\prime}
\rho
x
\rho
\mathcal{D}
\rho
\theta
m
\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),%
\mathcal{D}\backslash\mathcal{D}_{m}),
\Delta
r
\Delta^{r}=\theta^{r-1}_{T}-\theta^{r-1}_{0}
T
\mathbf{L}(\cdot)
\mathcal{D}_{m}
W_{d}
\mathcal{D}\backslash\mathcal{D}_{m}
m
m
C_{d}(\mathcal{D},\mathcal{D}^{\prime})
\mathcal{D}
\mathcal{D}^{\prime}
\begin{split}C_{d}(\mathcal{D},\mathcal{D}^{\prime})=\frac{1}{2}\mathbb{E}_{(%
\cdot,y)\sim\mathcal{D}}\inf_{J\in\mathcal{J}(\mathcal{D}|y,\mathcal{D}^{%
\prime}|y)}\mathbb{E}_{(x,x^{\prime})\sim J}d(x,x^{\prime})+\frac{1}{2}\mathbb%
{E}_{(\cdot,y)\sim\mathcal{D^{\prime}}}\inf_{J\in\mathcal{J}(\mathcal{D}|y,%
\mathcal{D}^{\prime}|y)}\mathbb{E}_{(x,x^{\prime})\sim J}d(x,x^{\prime}).\end{split}
\Delta
\mathbf{L}(\mathcal{D}_{m})
\begin{split}\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+%
\Delta),\mathcal{D}\backslash\mathcal{D}_{m})\geq&\mathbb{E}_{\Delta:\mathbf{L%
}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}_{m})-\big{|}%
\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),%
\mathcal{D}_{m})\\
&-W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}_{m})\big{|}-2C_{d}(\mathcal{D}%
_{m},\mathcal{D}\backslash\mathcal{D}_{m}),\end{split}
\tilde{\mathcal{D}}_{m}
\mathcal{D}_{m}
\mathcal{D}_{m}
\mathcal{\tilde{D}}_{m}
y
\mathcal{H}|y
\mathcal{H}
\varphi_{\theta_{low}}
\theta_{low}\in\mathbb{R}^{d_{l}}
\theta_{high}\in\mathbb{R}^{d_{h}}
\mathcal{H}|y
d_{l}
d_{h}
\theta_{low}
\theta_{high}
m
\mathcal{H}_{m}
h=\varphi_{\theta_{low}}(x)|_{(x,y)\sim\mathcal{D}_{m}}
\mathcal{H}_{m}
\mathcal{H}
h_{(x,y)\sim\mathcal{D}_{m}}
\mathcal{H}
m
\mathcal{D}_{m}
k
\mathcal{D}_{k}
\text{CGV}(F,\theta)=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||\nabla f_{m}(%
\theta;x,y)-\nabla F(\theta)||^{2}
\text{CGV}(F,\theta)=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||\nabla f_{m}(%
\theta;x,y)-\nabla F(\theta)||^{2}\leq\sigma^{2}
\sigma
\nabla f_{m}(\theta;x,y)
\left\{\nabla_{\theta_{low}}f_{m}(\theta;x,y),\nabla_{\theta_{high}}f_{m}(%
\theta;x,y)\right\}
\theta
\displaystyle\text{CGV}(F,\theta)=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||%
\nabla f_{m}(\theta;x,y)-\nabla F(\theta)||^{2}
\displaystyle\text{CGV}(F,\theta)=
\displaystyle\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||\nabla f_{m}(\theta;x,y)-%
\nabla F(\theta)||^{2}
\displaystyle=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}\left[||\nabla_{\theta_{low%
}}f_{m}(\theta;x,y)-\nabla_{\theta_{low}}F(\theta)||^{2}+||\nabla_{\theta_{%
high}}f_{m}(\theta;x,y)-\nabla_{\theta_{high}}F(\theta)||^{2}\right].
\displaystyle=
\displaystyle\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}\left[||\nabla_{\theta_{low}%
}f_{m}(\theta;x,y)-\nabla_{\theta_{low}}F(\theta)||^{2}+||\nabla_{\theta_{high%
}}f_{m}(\theta;x,y)-\nabla_{\theta_{high}}F(\theta)||^{2}\right].
(x,y)\sim\mathcal{D}_{m}
(h=\varphi_{\theta_{low}}(x),y)
\begin{split}&\nabla_{\theta_{high}}f_{m}(\theta;x,y)=\nabla_{\theta_{high}}f_%
{m}(\theta;h,y),\\
&\nabla_{\theta_{high}}F(\theta)=\sum_{m=1}^{M}p_{m}\mathbb{E}_{(x,y)\sim%
\mathcal{D}_{m}}\nabla_{\theta_{high}}f(\theta;h,y),\end{split}
f_{m}(\theta;h,y)
h=\varphi_{\theta_{low}}(x)
\mathcal{H}
m
\hat{h}\sim\mathcal{H}
h_{m}=\varphi_{\theta_{low}}(x)|_{(x,y)\sim\mathcal{D}_{m}}
f
f
x
h=\varphi_{\theta_{low}}(x)
\min_{\theta\in\mathbb{R}^{d}}\hat{F}(\theta):=\sum_{m=1}^{M}\hat{p}_{m}%
\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}\hat{f}(\theta;x,\hat{h},y)\triangleq%
\sum_{m=1}^{M}\hat{p}_{m}\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{%
m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}\left[f(\theta;\varphi_{\theta_{low}}(x%
),y)+f(\theta;\hat{h},y)\right].
\hat{p}_{m}=\frac{n_{m}+\hat{n}_{m}}{N+\hat{N}}
n_{m}
\hat{n}_{m}
(x,y)\sim\mathcal{D}_{m}
\hat{h}\sim\mathcal{H}
\hat{N}=\sum_{m=1}^{M}\hat{n}_{m}
\hat{n}_{m}
\frac{\hat{n}_{m}}{n_{m}+\hat{n}_{m}}=\frac{\hat{N}}{N+\hat{N}}
\hat{F}(\theta)
\text{CGV}(\hat{F},\theta)=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||\nabla_{%
\theta_{low}}f_{m}(\theta;x,y)-\nabla_{\theta_{low}}F(\theta)||^{2}+\frac{N^{2%
}}{(N+\hat{N})^{2}}||\nabla_{\theta_{high}}f_{m}(\theta;x,y)-\nabla_{\theta_{%
high}}F(\theta)||^{2}\leq\text{CGV}(F,\theta).
\frac{N^{2}}{(N+\hat{N})^{2}}
\hat{N}=\infty
\hat{h}
\hat{N}=N
\theta^{0}
R
m
T
\theta^{0}
\mathcal{H}^{0}
r=0,1,\cdots,R
\mathcal{S}_{r}\subseteq\left\{1,...,M\right\}
\theta_{r}
\mathcal{H}^{r}
m\in\mathcal{S}
m\in\mathcal{S}^{r}
\small\theta_{m,E-1}^{r+1}
\mathcal{H}_{m}^{r+1}
\leftarrow\text{\small ClientUpdate}(m,\theta^{r},\mathcal{H}^{r})
\small\theta^{r+1}\leftarrow\sum_{m=1}^{M}p_{m}\theta_{m,E-1}^{r+1}
\mathcal{H}^{r+1}
\left\{\mathcal{H}_{m}^{r+1}|m\in\mathcal{S}^{r}\right\}
\small m,\theta,\mathcal{H}
t
t=0,\cdots,T-1
(x,y)\sim\mathcal{D}_{m}
\hat{h}\sim\mathcal{H}|y
\small\theta_{m,t+1}\leftarrow\theta_{m,t}-\eta_{m,t}\nabla_{\theta}\hat{f}(%
\theta;x,\hat{h},y)
\mathcal{H}_{m}
\hat{h}_{m}=\varphi_{\theta_{low}}(x)
\theta
\mathcal{H}_{m}
\mathcal{H}
(x,y)
(\hat{h}\sim\mathcal{H}|y,y)
\hat{h}\sim\mathcal{H}|y
\left\{h_{m}|m\in\mathcal{M}\right\}
\mathcal{H}
\mathcal{H}
\left\{h_{m}|m\in\mathcal{M}\right\}
m
\mathcal{N}(\mu_{m},\sigma_{m})
\mu_{m}
\sigma_{m}
\mathcal{N}(\mu_{g},\sigma_{g})
\mu_{m}
\sigma_{m}
h_{m}
\begin{split}\mu_{m}^{(t+1)}&=\beta_{m}\mu_{m}^{(t)}+(1-\beta_{m})\times\text{%
mean}(h_{m}),\\
\sigma_{m}^{(t+1)}&=\beta_{m}\sigma_{m}^{(t)}+(1-\beta_{m})\times\text{%
variance}({h}_{m}),\end{split}
t
\beta_{m}
\mu_{g}
\sigma_{g}
\epsilon_{i}^{r}
\begin{split}\mu_{g}^{(r+1)}&=\beta_{g}\mu_{g}^{(r)}+(1-\beta_{g})\times\frac{%
1}{|\mathcal{S}^{r}|}\sum_{i\in\mathcal{S}^{r}}(\mu_{i}^{r}+\epsilon_{r}^{r}),%
\\
\sigma_{g}^{(r+1)}&=\beta_{g}\sigma_{g}^{(r)}+(1-\beta_{g})\times\frac{1}{|%
\mathcal{S}^{r}|}\sum_{i\in\mathcal{S}^{r}}(\sigma_{i}^{r}+\epsilon_{i}^{r}),%
\end{split}
\epsilon_{i}^{r}\sim\mathcal{N}(0,\sigma_{\epsilon})
\sigma_{\epsilon}
\mu_{m},\sigma_{m},\mu_{g}
\sigma_{g}
a
E
M
0.1
1
10
\pm
\pm
\pm
\pm
\pm
\pm
0.05
1
10
\pm
\pm
\pm
\pm
\pm
\pm
0.1
5
10
\pm
\pm
\pm
\pm
\pm
\pm
0.1
1
100
\pm
\pm
\pm
\pm
\pm
\pm
0.1
1
10
\pm
\pm
\pm
\pm
\pm
\pm
0.05
1
10
\pm
\pm
\pm
\pm
\pm
\pm
0.1
5
10
\pm
\pm
\pm
\pm
\pm
\pm
0.1
1
100
\pm
\pm
\pm
\pm
\pm
\pm
0.1
1
10
\pm
\pm
\pm
\pm
\pm
\pm
0.05
1
10
\pm
\pm
\pm
\pm
\pm
\pm
0.1
5
10
\pm
\pm
\pm
\pm
\pm
\pm
0.1
1
100
\pm
\pm
\pm
\pm
\pm
\pm
0.1
1
10
\pm
\pm
\pm
\pm
\pm
\pm
0.05
1
10
\pm
\pm
\pm
\pm
\pm
\pm
0.1
5
10
\pm
\pm
\pm
\pm
\pm
\pm
0.1
1
100
\pm
\pm
\pm
\pm
\pm
\pm
a=0.1
a=0.05
M=10
M=100
M=10
M=100
\frac{1}{|\mathcal{S}^{r}|}\sum_{i\in\mathcal{S}^{r}}\|\bar{\theta}-\theta_{i}\|
a=0.1
E=5
M=10
a=0.05
a=0.1
a=0.1
a=0.05
a=0.05
E
E=5
a=0.1
E=1
M=10
a=0.1
E=1
M=10
\frac{1}{|\mathcal{S}^{r}|}\sum_{i\in\mathcal{S}^{r}}\|\bar{\theta}-\theta_{i}\|
a
E
M
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
5
9
13
17
5
9
13
17
17
5
9
13
a=0.1
E=1
M=10
\alpha=0.1
M=10
E=5
E=1
E=5
1\sim 10
10\sim 1000
48\sim 480
48000\sim 480000
15\sim 150
T_{comm}=\alpha+\beta M
\alpha
\beta
M
\alpha
M
M_{model}+M_{estimator}
M_{model}
M_{estimator}
\hat{h}
\hat{h}
\hat{h}
h
\hat{h}
\hat{h}
\hat{h}
m
\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),%
\mathcal{D}\backslash\mathcal{D}_{m})),
\Delta
\mathbf{L}(\mathcal{D}_{m})
\mathcal{D}_{m}
W_{d}
\mathcal{D}\backslash\mathcal{D}_{m})
m
\Delta
\mathbf{L}(\mathcal{D}_{m})
\begin{split}\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+%
\Delta),\mathcal{D}\backslash\mathcal{D}_{m}))\geq&\ \mathbb{E}_{\Delta:%
\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}_{m})%
-|\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),%
\mathcal{D}_{m}))\\
&-W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}_{m}))|-2C_{d}(\mathcal{D}_{m},%
\mathcal{D}\backslash\mathcal{D}_{m}),\end{split}
\tilde{\mathcal{D}}_{m}
\mathcal{D}_{m}
W_{d}(\rho(\theta+\Delta),\mathcal{D}\backslash\mathcal{D}_{m})
\begin{split}W_{d}(\rho(\theta+\Delta),\mathcal{D}\backslash\mathcal{D}_{m})&%
\ =W_{d}(\rho(\theta+\Delta),\mathcal{D}\backslash\mathcal{D}_{m})-W_{d}(\rho(%
\theta+\Delta),\mathcal{D}_{m})+W_{d}(\rho(\theta+\Delta),\mathcal{D}_{m})\\
&\ -W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}_{m})+W_{d}(\rho(\theta+%
\Delta),\tilde{\mathcal{D}}_{m}),\end{split}
\rho
\rho(\theta+\Delta)
\tilde{\mathcal{D}}_{m}
\mathcal{D}_{m}
\begin{split}\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+%
\Delta),\mathcal{D}\backslash\mathcal{D}_{m}))\geq&\ \mathbb{E}_{\Delta:%
\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}_{m})%
\\
&-|\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),%
\mathcal{D}_{m}))-W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}_{m}))|\\
&-|\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),%
\mathcal{D}\backslash\mathcal{D}_{m}))-W_{d}(\rho(\theta+\Delta),\mathcal{D}_{%
m}))|.\end{split}
\mathcal{D}\backslash\mathcal{D}_{m})
|\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),%
\mathcal{D}\backslash\mathcal{D}_{m}))-W_{d}(\rho(\theta+\Delta),\mathcal{D}_{%
m}))|
W_{d}(\rho(\theta+\Delta),\mathcal{D}_{m})
W_{d}(\rho(\theta+\Delta),\mathcal{D}\backslash\mathcal{D}_{m})
W_{d}(\rho(\theta+\Delta),\mathcal{D}_{m})
\begin{split}&W_{d}(\rho(\theta+\Delta),\mathcal{D}_{m})\\
=&\mathbb{E}_{(\cdot|y)\sim\mathcal{D}_{m}}\mathbb{E}_{x\sim\mathcal{D}_{m}|y}%
\inf_{\text{argmax}_{i}\rho(\theta;x^{\prime})_{i}\neq y}d(x,x^{\prime})\\
=&\mathbb{E}_{(\cdot|y)\sim\mathcal{D}_{m}}\mathbb{E}_{(x,x^{\prime\prime})%
\sim J_{y}}\inf_{\text{argmax}_{i}\rho(\theta;x^{\prime})_{i}\neq y}d(x,x^{%
\prime})\\
\leq&\mathbb{E}_{(\cdot|y)\sim\mathcal{D}_{m}}\mathbb{E}_{(x,x^{\prime\prime})%
\sim J_{y}}\inf_{\text{argmax}_{i}\rho(\theta;x^{\prime})_{i}\neq y}d(x^{%
\prime},x^{\prime\prime})+d(x,x^{\prime\prime})\\
=&\mathbb{E}_{(\cdot|y)\sim\mathcal{D}_{m}}\mathbb{E}_{(x,x^{\prime\prime})%
\sim J_{y}}\inf_{\text{argmax}_{i}\rho(\theta;x^{\prime})_{i}\neq y}d(x^{%
\prime},x^{\prime\prime})+\mathbb{E}_{(\cdot|y)\sim\mathcal{D}_{m}}\mathbb{E}_%
{(x,x^{\prime\prime})\sim J_{y}}d(x,x^{\prime\prime})\\
=&\mathbb{E}_{(\cdot|y)\sim\mathcal{D}_{m}}\mathbb{E}_{x^{\prime\prime}\sim%
\mathcal{D}\backslash\mathcal{D}_{m}|y}\inf_{\text{argmax}_{i}\rho(\theta;x^{%
\prime})_{i}\neq y}d(x^{\prime},x^{\prime\prime})+\mathbb{E}_{(\cdot|y)\sim%
\mathcal{D}_{m}}\mathbb{E}_{(x,x^{\prime\prime})\sim J_{y}}d(x,x^{\prime\prime%
}),\end{split}
J_{y}
\mathcal{D}_{m}|y
\mathcal{D}\backslash\mathcal{D}_{m}|y
\begin{split}W_{d}(\rho(\theta+\Delta),\mathcal{D}\backslash\mathcal{D}_{m})%
\leq&\mathbb{E}_{(\cdot|y)\sim\mathcal{D}\backslash\mathcal{D}_{m}}\mathbb{E}_%
{x^{\prime\prime}\sim\mathcal{D}_{m}|y}\inf_{\text{argmax}_{i}\rho(\theta;x^{%
\prime})_{i}\neq y}d(x^{\prime},x^{\prime\prime})\\
&+\mathbb{E}_{(\cdot|y)\sim\mathcal{D}\backslash\mathcal{D}_{m}}\mathbb{E}_{(x%
,x^{\prime\prime})\sim J_{y}}d(x,x^{\prime\prime}).\end{split}
\begin{split}|W_{d}(\rho(\theta+\Delta),\mathcal{D}_{m})-W_{d}(\rho(\theta+%
\Delta),\mathcal{D}\backslash\mathcal{D}_{m})|\leq&2C_{d}(\mathcal{D}_{m},%
\mathcal{D}\backslash\mathcal{D}_{m}))\\
&+\max\left\{\delta(\mathcal{D}_{m},\mathcal{D}\backslash\mathcal{D}_{m}),%
\gamma(\mathcal{D}_{m},\mathcal{D}\backslash\mathcal{D}_{m})\right\},\end{split}
\begin{split}\delta(\mathcal{D}_{m},\mathcal{D}\backslash\mathcal{D}_{m})=&%
\mathbb{E}_{(\cdot|y)\sim\mathcal{D}_{m}}\mathbb{E}_{x^{\prime\prime}\sim%
\mathcal{D}\backslash\mathcal{D}_{m}|y}\inf_{\text{argmax}_{i}\rho(\theta;x^{%
\prime})_{i}\neq y}d(x^{\prime},x^{\prime\prime})\\
&-\mathbb{E}_{(\cdot|y)\sim\mathcal{D}\backslash\mathcal{D}_{m}}\mathbb{E}_{x^%
{\prime\prime}\sim\mathcal{D}\backslash\mathcal{D}_{m}|y}\inf_{\text{argmax}_{%
i}\rho(\theta;x^{\prime})_{i}\neq y}d(x^{\prime},x^{\prime\prime}),\end{split}
\begin{split}\gamma(\mathcal{D}_{m},\mathcal{D}\backslash\mathcal{D}_{m})=&%
\mathbb{E}_{(\cdot|y)\sim\mathcal{D}\backslash\mathcal{D}_{m}}\mathbb{E}_{x^{%
\prime\prime}\sim\mathcal{D}_{m}|y}\inf_{\text{argmax}_{i}\rho(\theta;x^{%
\prime})_{i}\neq y}d(x^{\prime},x^{\prime\prime})\\
&-\mathbb{E}_{(\cdot|y)\sim\mathcal{D}_{m}}\mathbb{E}_{x^{\prime\prime}\sim%
\mathcal{D}_{m}|y}\inf_{\text{argmax}_{i}\rho(\theta;x^{\prime})_{i}\neq y}d(x%
^{\prime},x^{\prime\prime}).\end{split}
y\sim\mathcal{D}\backslash\mathcal{D}_{m}
y\sim\mathcal{D}_{m}
\begin{split}|W_{d}(\rho(\theta+\Delta),\mathcal{D}_{m})-W_{d}(\rho(\theta+%
\Delta),\mathcal{D}\backslash\mathcal{D}_{m})|\leq 2C_{d}(\mathcal{D}_{m},%
\mathcal{D}\backslash\mathcal{D}_{m})).\end{split}
\begin{split}&|\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(%
\theta+\Delta),\mathcal{D}_{m}))-W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}%
_{m}))|\\
\leq&\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}|W_{d}(\rho(\theta+\Delta)%
,\mathcal{D}_{m}))-W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}_{m}))|,\end{split}
\begin{split}&\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}|W_{d}(\rho(%
\theta+\Delta),\mathcal{D}_{m}))-W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}%
_{m}))|\\
&\leq 2C_{d}(\mathcal{D}_{m},\mathcal{D}\backslash\mathcal{D}_{m}))+\max\left%
\{\delta(\mathcal{D}_{m},\mathcal{D}\backslash\mathcal{D}_{m}),\gamma(\mathcal%
{D}_{m},\mathcal{D}\backslash\mathcal{D}_{m})\right\}.\end{split}
|\mathbb{E}_{\Delta:\mathbf{L}(\mathcal{D}_{m})}W_{d}(\rho(\theta+\Delta),%
\mathcal{D}_{m}))-W_{d}(\rho(\theta+\Delta),\tilde{\mathcal{D}}_{m}))|\leq 2C_%
{d}(\mathcal{D}_{m},\mathcal{D}\backslash\mathcal{D}_{m})),
\nabla f_{m}=\left\{\nabla_{\theta_{low}}f_{m},\nabla_{\theta_{high}}f_{m}%
\right\}\in\mathbb{R}^{d}
\nabla_{\theta_{low}}f_{m}\in\mathbb{R}^{d_{l}}
\nabla_{\theta_{high}}f_{m}\in\mathbb{R}^{d_{h}}
\displaystyle\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||\nabla f_{m}(\theta;x,y)-%
\nabla F(\theta)||^{2}
\displaystyle\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||\nabla f_{m}(\theta;x,y)-%
\nabla F(\theta)||^{2}
\displaystyle=\sum_{i=1}^{d}(\nabla f_{m}(\theta;x,y)_{(i)}-\nabla F(\theta)_{%
(i)})^{2}
\displaystyle=
\displaystyle\sum_{i=1}^{d}(\nabla f_{m}(\theta;x,y)_{(i)}-\nabla F(\theta)_{(%
i)})^{2}
\displaystyle=\sum_{i=1}^{d_{l}}(\nabla f_{m}(\theta;x,y)_{(i)}-\nabla F(%
\theta)_{(i)})^{2}+\sum_{i=d_{l}+1}^{d_{h}}(\nabla f_{m}(\theta;x,y)_{(i)}-%
\nabla F(\theta)_{(i)})^{2}
\displaystyle=
\displaystyle\sum_{i=1}^{d_{l}}(\nabla f_{m}(\theta;x,y)_{(i)}-\nabla F(\theta%
)_{(i)})^{2}+\sum_{i=d_{l}+1}^{d_{h}}(\nabla f_{m}(\theta;x,y)_{(i)}-\nabla F(%
\theta)_{(i)})^{2}
\displaystyle=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}\left[||\nabla_{\theta_{low%
}}f_{m}(\theta;x,y)-\nabla_{\theta_{low}}F(\theta)||^{2}+||\nabla_{\theta_{%
high}}f_{m}(\theta;x,y)-\nabla_{\theta_{high}}F(\theta)||^{2}\right]
\displaystyle=
\displaystyle\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}\left[||\nabla_{\theta_{low}%
}f_{m}(\theta;x,y)-\nabla_{\theta_{low}}F(\theta)||^{2}+||\nabla_{\theta_{high%
}}f_{m}(\theta;x,y)-\nabla_{\theta_{high}}F(\theta)||^{2}\right]
L
CE(\cdot)
\displaystyle f(\theta,x)=CE(\tau_{n}(\theta_{n}(\tau_{n-1}(\theta_{n-1}\tau_{%
n-2}(...\tau_{1}(\theta_{1}x)))))
\displaystyle f(\theta,x)=CE(\tau_{n}(\theta_{n}(\tau_{n-1}(\theta_{n-1}\tau_{%
n-2}(...\tau_{1}(\theta_{1}x)))))
l
\displaystyle g_{l}=\frac{\partial f}{\partial\theta_{l}}=\frac{\partial f}{%
\partial\tau_{n}(z_{n})}\frac{\partial\tau_{n}(z_{n})}{\partial z_{n}}\frac{%
\partial z_{n}}{\partial\tau_{n-1}(z_{n-1})}\frac{\partial\tau_{n-1}(z_{n-1})}%
{\partial z_{n-1}}\frac{\partial z_{n-1}}{\partial\tau_{n-2}(z_{n-2})}...\frac%
{\partial\tau_{l+1}(z_{l+1})}{\partial z_{l+1}}\frac{\partial z_{l}}{\partial%
\theta_{l}}
\displaystyle g_{l}=\frac{\partial f}{\partial\theta_{l}}
\displaystyle=\frac{\partial f}{\partial\tau_{n}(z_{n})}\frac{\partial\tau_{n}%
(z_{n})}{\partial z_{n}}\frac{\partial z_{n}}{\partial\tau_{n-1}(z_{n-1})}%
\frac{\partial\tau_{n-1}(z_{n-1})}{\partial z_{n-1}}\frac{\partial z_{n-1}}{%
\partial\tau_{n-2}(z_{n-2})}...\frac{\partial\tau_{l+1}(z_{l+1})}{\partial z_{%
l+1}}\frac{\partial z_{l}}{\partial\theta_{l}}
\displaystyle=\frac{\partial f}{\partial\tau_{n}(z_{n})}\tau_{n}^{\prime}(z_{n%
})\theta_{n}\tau_{n}^{\prime}(z_{n-1})\theta_{n-1}...\tau_{l+1}^{\prime}(z_{l+%
1})\tau_{l}(z_{l})
\displaystyle=\frac{\partial f}{\partial\tau_{n}(z_{n})}\tau_{n}^{\prime}(z_{n%
})\theta_{n}\tau_{n}^{\prime}(z_{n-1})\theta_{n-1}...\tau_{l+1}^{\prime}(z_{l+%
1})\tau_{l}(z_{l})
\displaystyle=\frac{\partial f}{\partial\tau_{n}(z_{n})}\left(\prod_{i=l+2}^{n%
}\tau_{i}^{\prime}(z_{i})\theta_{i}\right)\tau_{l+1}^{\prime}(z_{l+1})\tau_{l}%
(z_{l}),
\displaystyle=\frac{\partial f}{\partial\tau_{n}(z_{n})}\left(\prod_{i=l+2}^{n%
}\tau_{i}^{\prime}(z_{i})\theta_{i}\right)\tau_{l+1}^{\prime}(z_{l+1})\tau_{l}%
(z_{l}),
\theta_{l}
\tau_{l}
z_{l}
l
l
l
z_{l}
l
(x,y)
\hat{h}\sim\mathcal{H}|y
\min_{\theta\in\mathbb{R}^{d}}\hat{F}(\theta):=\sum_{m=1}^{M}\hat{p}_{m}%
\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}\hat{f}(\theta;x,\hat{h},y)=\sum_{m=1}^%
{M}\hat{p}_{m}\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}\left[f(\theta;x,y)+f(\theta;\hat{h},y)%
\right],
\hat{n}_{m}
\frac{\hat{n}_{m}}{n_{m}+\hat{n}_{m}}=\frac{\hat{N}}{N+\hat{N}}
\hat{F}(\theta)
\text{CGV}(\hat{F},\theta)=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||\nabla_{%
\theta_{low}}f_{m}(\theta;x,y)-\nabla_{\theta_{low}}F(\theta)||^{2}+\frac{N^{2%
}}{(N+\hat{N})^{2}}||\nabla_{\theta_{high}}f_{m}(\theta;x,y)-\nabla_{\theta_{%
high}}F(\theta)||^{2}\leq\text{CGV}(F,\theta)
\displaystyle\text{CGV}(\hat{F},\theta)=\mathbb{E}_{\begin{subarray}{c}(x,y)%
\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}||\nabla\hat{f}_{m}(\theta;x,\hat{h},y)%
-\nabla\hat{F}(\theta)||^{2}
\displaystyle\text{CGV}(\hat{F},\theta)=
\displaystyle\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}||\nabla\hat{f}_{m}(\theta;x,\hat{h},y)%
-\nabla\hat{F}(\theta)||^{2}
\displaystyle=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}[||\nabla_{\theta_{low}}f_{%
m}(\theta;x,y)-\nabla_{\theta_{low}}F(\theta)||^{2}]
\displaystyle=
\displaystyle\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}[||\nabla_{\theta_{low}}f_{m%
}(\theta;x,y)-\nabla_{\theta_{low}}F(\theta)||^{2}]
\displaystyle+\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}[||\nabla_{\theta_{high}}f_{m}(\theta;x%
,y)+\nabla_{\theta_{high}}f_{m}(\theta;\hat{h},y)-\nabla_{\theta_{high}}\bar{F%
}(\theta)||^{2}.
\displaystyle+\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}[||\nabla_{\theta_{high}}f_{m}(\theta;x%
,y)+\nabla_{\theta_{high}}f_{m}(\theta;\hat{h},y)-\nabla_{\theta_{high}}\bar{F%
}(\theta)||^{2}.
m
(x,y)
n_{m}
\hat{h}_{m}
\hat{n}_{m}
\displaystyle\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}[||\frac{n_{m}}{n_{m}+\hat{n}_{m}}%
\nabla_{\theta_{high}}f_{m}(\theta;x,y)+\frac{\hat{n}_{m}}{n_{m}+\hat{n}_{m}}%
\nabla_{\theta_{high}}f_{m}(\theta;\hat{h},y)-\nabla_{\theta_{high}}\bar{F}(%
\theta)||^{2}
\displaystyle\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}[||\frac{n_{m}}{n_{m}+\hat{n}_{m}}%
\nabla_{\theta_{high}}f_{m}(\theta;x,y)+\frac{\hat{n}_{m}}{n_{m}+\hat{n}_{m}}%
\nabla_{\theta_{high}}f_{m}(\theta;\hat{h},y)-\nabla_{\theta_{high}}\bar{F}(%
\theta)||^{2}
\displaystyle=\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}[||\frac{n_{m}}{n_{m}+\hat{n}_{m}}%
\nabla_{\theta_{high}}f_{m}(\theta;x,y)+\frac{\hat{n}_{m}}{n_{m}+\hat{n}_{m}}%
\nabla_{\theta_{high}}f_{m}(\theta;\hat{h},y)
\displaystyle=
\displaystyle\mathbb{E}_{\begin{subarray}{c}(x,y)\sim\mathcal{D}_{m}\\
\ \hat{h}\sim\mathcal{H}\end{subarray}}[||\frac{n_{m}}{n_{m}+\hat{n}_{m}}%
\nabla_{\theta_{high}}f_{m}(\theta;x,y)+\frac{\hat{n}_{m}}{n_{m}+\hat{n}_{m}}%
\nabla_{\theta_{high}}f_{m}(\theta;\hat{h},y)
\displaystyle-\sum_{m=1}^{M}\frac{n_{m}+\hat{n}_{m}}{N+\hat{N}}(\frac{n_{m}}{n%
_{m}+\hat{n}_{m}}\nabla_{\theta_{high}}f_{m}(\theta;x,y)+\frac{\hat{n}_{m}}{n_%
{m}+\hat{n}_{m}}\nabla_{\theta_{high}}f_{m}(\theta;\hat{h},y))||^{2}
\displaystyle-\sum_{m=1}^{M}\frac{n_{m}+\hat{n}_{m}}{N+\hat{N}}(\frac{n_{m}}{n%
_{m}+\hat{n}_{m}}\nabla_{\theta_{high}}f_{m}(\theta;x,y)+\frac{\hat{n}_{m}}{n_%
{m}+\hat{n}_{m}}\nabla_{\theta_{high}}f_{m}(\theta;\hat{h},y))||^{2}
\displaystyle=\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||\frac{n_{m}}{n_{m}+\hat{n%
}_{m}}\nabla_{\theta_{high}}f_{m}(\theta;x,y)-\sum_{m=1}^{M}\frac{n_{m}}{N+%
\hat{N}}\nabla_{\theta_{high}}f_{m}(\theta;x,y)||^{2}
\displaystyle=
\displaystyle\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}}||\frac{n_{m}}{n_{m}+\hat{n}%
_{m}}\nabla_{\theta_{high}}f_{m}(\theta;x,y)-\sum_{m=1}^{M}\frac{n_{m}}{N+\hat%
{N}}\nabla_{\theta_{high}}f_{m}(\theta;x,y)||^{2}
\displaystyle=\frac{N^{2}}{(N+\hat{N})^{2}}\mathbb{E}_{(x,y)\sim\mathcal{D}_{m%
}}||\nabla_{\theta_{high}}f_{m}(\theta;x,y)-\sum_{m=1}^{M}\frac{n_{m}}{N}%
\nabla_{\theta_{high}}f_{m}(\theta;x,y)||^{2}.
\displaystyle=
\displaystyle\frac{N^{2}}{(N+\hat{N})^{2}}\mathbb{E}_{(x,y)\sim\mathcal{D}_{m}%
}||\nabla_{\theta_{high}}f_{m}(\theta;x,y)-\sum_{m=1}^{M}\frac{n_{m}}{N}\nabla%
_{\theta_{high}}f_{m}(\theta;x,y)||^{2}.
\begin{split}\text{CGV}(\hat{F},\theta)=&\mathbb{E}_{(x,y)}||\nabla_{\theta_{%
low}}f_{m}(\theta;x,y)-\nabla_{\theta_{low}}F(\theta)||^{2}\\
&+\frac{N^{2}}{(N+\hat{N})^{2}}||\nabla_{\theta_{high}}f_{m}(\theta;x,y)-%
\nabla_{\theta_{high}}F(\theta)||^{2},\end{split}
\left\{0.0001,0.001,0.01,0.1,0.3\right\}
K=10
K=100
K=10
E=5
E=5
K=10
K=100
a
E
K
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
a
E
K
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
0.1
1
10
0.05
1
10
0.1
5
10
0.1
1
100
a=0.1
K=10
E=1
a=0.1
K=10
E=1
a=0.1
K=10
E=5
a=0.1
K=10
E=5
a=0.1
K=100
E=1
a=0.1
K=100
E=1
a=0.05
K=10
E=1
a=0.05
K=10
E=1
a=0.1
K=10
E=1
a=0.1
K=10
E=1
a=0.1
K=10
E=5
a=0.1
K=10
E=5
a=0.1
K=100
E=1
a=0.1
K=100
E=1
a=0.05
K=10
E=1
a=0.05
K=10
E=1
a=0.1
K=10
E=1
a=0.1
K=10
E=1
a=0.1
K=10
E=5
a=0.1
K=10
E=5
a=0.1
K=100
E=1
a=0.1
K=100
E=1
a=0.05
K=10
E=1
a=0.05
K=10
E=1
a=0.1
K=10
E=1
a=0.1
K=10
E=1
a=0.1
K=10
E=5
a=0.1
K=10
E=5
a=0.1
K=100
E=1
a=0.1
K=100
E=1
a=0.05
K=10
E=1
a=0.05
K=10
E=1
a=0.1
K=10
E=1
a=0.1
K=10
E=1
\mu_{\epsilon}
\epsilon\sim\mathcal{N}(0,\sigma{\epsilon})
\sigma_{m}
\mu_{m}
\mu_{\epsilon}
\sigma_{\epsilon}
\left\{0.01,0.05,0.1\right\}
\alpha
\alpha
a
M
M_{c}
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\sigma_{m}
\mu_{m}
\mu_{\epsilon}=0.001
\mu_{\epsilon}=0.001
\mu_{\epsilon}=0.01
\mu_{\epsilon}=0.01
\mu_{\epsilon}=0.1
\mu_{\epsilon}=0.1
\mu_{\epsilon}=0.5
\mu_{\epsilon}=0.5
\mu_{\epsilon}
\mu_{\epsilon}
