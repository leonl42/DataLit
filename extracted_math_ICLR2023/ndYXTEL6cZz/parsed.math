K
\forall({\bm{x}},y)\sim\mathcal{D}_{\text{ID}},y\in\mathcal{Y}_{\text{ID}}
\forall({\bm{x}},y)\sim\mathcal{D}_{\text{OOD}},y\notin\mathcal{Y}_{\text{ID}}
f(\cdot)
\mathbf{W}\in\mathbb{R}^{K\times D}
{\bm{b}}\in\mathbb{R}^{D}
{\bm{z}}=\mathbf{W}\cdot{\bm{a}}+{\bm{b}},\qquad{\bm{a}}=f({\bm{x}}),
{\bm{a}}\in\mathbb{R}^{D}
D
{\bm{z}}\in\mathbb{R}^{K}
\hat{y}=\operatorname*{arg\,max}({\bm{z}})
{\bm{a}}
j
{\bm{a}}_{j}
{\bm{x}}
{\bm{x}}
\tau
S_{\textit{EBO}}({\bm{x}})
G(\cdot)
\displaystyle G({\bm{x}};\tau)=\begin{cases}0&\quad\text{if }S_{\textit{EBO}}(%
{\bm{x}})\leq\tau\quad(\textit{OOD}),\\
1&\quad\text{if }S_{\textit{EBO}}({\bm{x}})>\tau\quad(\textit{ID}),\end{cases}%
,\qquad S_{\textit{EBO}}({\bm{x}})=T\cdot\text{log}\sum_{k}^{K}e^{{\bm{z}}_{k}%
/T},
\displaystyle G({\bm{x}};\tau)=\begin{cases}0&\quad\text{if }S_{\textit{EBO}}(%
{\bm{x}})\leq\tau\quad(\textit{OOD}),\\
1&\quad\text{if }S_{\textit{EBO}}({\bm{x}})>\tau\quad(\textit{ID}),\end{cases}%
,\qquad S_{\textit{EBO}}({\bm{x}})=T\cdot\text{log}\sum_{k}^{K}e^{{\bm{z}}_{k}%
/T},
T
k
K
{\bm{a}}
{\bm{a}}
p^{\text{th}}
D
p^{\text{th}}
s_{f}
{\bm{a}}_{j}
P_{p}({\bm{a}})
p^{\text{th}}
{\bm{a}}
{\bm{z}}_{\text{ASH}}
{\bm{z}}_{\text{ASH}}=\mathbf{W}\cdot\left({\bm{a}}\circ s_{f}({\bm{a}})\right%
)+{\bm{b}},\quad\text{where }s_{f}({\bm{a}})_{j}=\begin{cases}0&\quad\text{if %
}{\bm{a}}_{j}\leq P_{p}({\bm{a}}),\\
\exp(r)&\quad\text{if }{\bm{a}}_{j}>P_{p}({\bm{a}}),\end{cases},\quad
\circ
r
{\bm{a}}
r=\frac{Q}{Q_{p}},\qquad\text{where }Q={\sum_{j}^{D}{{\bm{a}}_{j}}}\qquad\text%
{ and }\;Q_{p}=\!\!\!\!\sum_{{\bm{a}}_{j}>P_{p}({\bm{a}})}{{\bm{a}}_{j}}.
Q_{p}\leq Q
r\geq 1
p
Q_{p}
Q
r
p
p
p
\mu/\sigma
\mu/\sigma
(\mu^{\text{ID}},\sigma^{\text{ID}})
(\mu^{\text{OOD}},\sigma^{\text{OOD}})
{\bm{a}}_{j}^{(\textit{ID})}\sim\mathcal{N}^{R}(\mu^{\textit{ID}},\sigma^{%
\textit{ID}})
{\bm{a}}_{j}^{(\textit{OOD})}\sim\mathcal{N}^{R}(\mu^{\textit{OOD}},\sigma^{%
\textit{OOD}})
\mathcal{N}^{R}
\mu^{\text{ID}}/\sigma^{\text{ID}}>\mu^{\text{OOD}}/\sigma^{\text{OOD}}
p
C(p)=\frac{\varphi(\sqrt{2}\operatorname{erf}^{-1}(2p-1))}{1-\Phi(\sqrt{2}%
\operatorname{erf}^{-1}(2p-1))}
{Q_{p}^{\text{ID}}}/{Q^{\text{ID}}}<{Q_{p}^{\text{OOD}}}/{Q^{\text{OOD}}}
\varphi
\Phi
C(p)
C(p)
p
C(p)
p
p=0.85
Q/Q_{p}
C(p)
p
C(p)
p
p=0.85
Q/Q_{p}
D^{\textit{Pruning}}=(Q-Q_{p})/{Q}.
{Q_{p}^{\textit{ID}}}/{Q^{\textit{ID}}}<{Q_{p}^{\textit{OOD}}}/{Q^{\textit{OOD%
}}}
D^{\textit{Pruning}}_{\textit{ID}}>D^{\textit{Pruning}}_{\textit{OOD}}
p
{Q_{p}^{\textit{ID}}}/{Q^{\textit{ID}}}<{Q_{p}^{\textit{OOD}}}/{Q^{\textit{OOD%
}}}
r=Q/Q_{q}
r^{\textit{ID}}>r^{\textit{OOD}}
r
I^{\text{Scaling}}=(r-1)
I^{\text{scaling}}_{\text{ID}}>I^{\text{scaling}}_{\text{OOD}}
{\bm{z}}
S_{\textit{EBO(ID)}}
S_{\textit{EBO(OOD)}}
p
C(p)
p
p\approx 0.95
C(p)
C(p)
C(p)
p
D=2048
r
{\bm{z}}^{\prime}=\mathbf{W}\cdot\left({\bm{a}}\circ s_{f}({\bm{a}})\right)+{%
\bm{b}},\qquad\text{where }s_{f}({\bm{a}})_{j}=\exp(r)\ \text{ and }\ r=\frac{%
\sum_{j}{{\bm{a}}_{j}}}{\sum_{{\bm{a}}_{j}>P_{p}({\bm{a}})}{{\bm{a}}_{j}}}.
r
p
{\bm{z}}^{\prime}
{\bm{z}}
\arg\max
s_{f}({\bm{a}}_{i})
{Q}/{Q_{p}}
\mathbf{W}^{t+1}=\mathbf{W}^{t}-\eta\sum_{i}[({\bm{a}}_{i}\circ s_{f}({\bm{a}}%
_{i}))^{\top}\nabla{{\bm{z}}_{i}}]
i
\nabla
t
t
\eta
\downarrow
\uparrow
\downarrow
\uparrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
{20.83}^{\pm 1.58}
{95.24}^{\pm 0.24}
{49.72}^{\pm 1.69}
{87.23}^{\pm 0.73}
p
p=0.85
p
C(p)
C(p)
p
p
p
p
\downarrow
\uparrow
\downarrow
\uparrow
\uparrow
{\bm{a}}_{j}^{(\textit{ID})}\sim\mathcal{N}^{R}(\mu^{\textit{ID}},\sigma^{%
\textit{ID}})
{\bm{a}}_{j}^{(\textit{OOD})}\sim\mathcal{N}^{R}(\mu^{\textit{OOD}},\sigma^{%
\textit{OOD}})
\mathcal{N}^{R}
\mu^{\text{ID}}/\sigma^{\text{ID}}>\mu^{\text{OOD}}/\sigma^{\text{OOD}}
p
C(p)=\frac{\varphi(\sqrt{2}\operatorname{erf}^{-1}(2p-1))}{1-\Phi(\sqrt{2}%
\operatorname{erf}^{-1}(2p-1))}
{Q_{p}^{\text{ID}}}/{Q^{\text{ID}}}<{Q_{p}^{\text{OOD}}}/{Q^{\text{OOD}}}
{\bm{a}}_{j}^{(\textit{ID})}\sim\mathcal{N}^{R}(\mu^{\textit{ID}},\sigma^{%
\textit{ID}})
{\bm{a}}_{j}^{(\textit{OOD})}\sim\mathcal{N}^{R}(\mu^{\textit{OOD}},\sigma^{%
\textit{OOD}})
\mathcal{N}^{R}
{\bm{h}}_{j}^{(\textit{ID})}={\bm{a}}_{j}^{(\textit{ID})}
{\bm{a}}_{j}>P_{p}({\bm{a}})
{\bm{h}}_{j}^{(\textit{ID})}\sim\mathcal{N}^{T}(\mu^{\textit{ID}},\sigma^{%
\textit{ID}})
{\bm{h}}_{j}^{(\textit{OOD})}\sim\mathcal{N}^{T}(\mu^{\textit{OOD}},\sigma^{%
\textit{OOD}})
\mathcal{N}^{T}
\displaystyle\mathbb{E}[{\bm{a}}_{j}]=\mu\left[1-\Phi(-\frac{\mu}{\sigma})%
\right]+\varphi(-\frac{\mu}{\sigma})\sigma
\displaystyle\mathbb{E}[{\bm{a}}_{j}]
\displaystyle=\mu\left[1-\Phi(-\frac{\mu}{\sigma})\right]+\varphi(-\frac{\mu}{%
\sigma})\sigma
\displaystyle\mathbb{E}[{\bm{h}}_{j}]=\mu+\frac{\varphi(m)}{1-\Phi(m)}\sigma,%
\ m=\frac{s-\mu}{\sigma}
\displaystyle\mathbb{E}[{\bm{h}}_{j}]
\displaystyle=\mu+\frac{\varphi(m)}{1-\Phi(m)}\sigma,\ m=\frac{s-\mu}{\sigma}
\varphi(\cdot)
\Phi(\cdot)
Q_{p}/Q=\frac{\sum_{j}{\bm{h}}_{j}}{\sum_{j}{\bm{a}}_{j}}=\frac{\mathbb{E}[{%
\bm{h}}_{j}](1-p)D}{\mathbb{E}[{\bm{a}}_{j}]D}
\beta=(1-p)Q/Q_{p}=\frac{\mathbb{E}[{\bm{a}}_{j}]}{\mathbb{E}[{\bm{h}}_{j}]}
Q_{p}^{\text{ID}}/Q^{\text{ID}}<Q_{p}^{\text{OOD}}/Q^{\text{OOD}}\iff\beta^{%
\text{ID}}>\beta^{\text{OOD}}
\displaystyle\beta=\frac{\mu\left[1-\Phi(-\frac{\mu}{\sigma})\right]+\varphi(-%
\frac{\mu}{\sigma})\sigma}{\mu+{\frac{\varphi(m)}{1-\Phi(m)}}\sigma}=\frac{1-%
\Phi(-\frac{\mu}{\sigma})}{1+{\frac{\varphi(m)}{1-\Phi(m)}}\frac{\sigma}{\mu}}%
+\frac{\varphi(-\frac{\mu}{\sigma})\sigma}{\mu+\frac{\varphi(m)}{1-\Phi(m)}\sigma}
\displaystyle\beta=\frac{\mu\left[1-\Phi(-\frac{\mu}{\sigma})\right]+\varphi(-%
\frac{\mu}{\sigma})\sigma}{\mu+{\frac{\varphi(m)}{1-\Phi(m)}}\sigma}=\frac{1-%
\Phi(-\frac{\mu}{\sigma})}{1+{\frac{\varphi(m)}{1-\Phi(m)}}\frac{\sigma}{\mu}}%
+\frac{\varphi(-\frac{\mu}{\sigma})\sigma}{\mu+\frac{\varphi(m)}{1-\Phi(m)}\sigma}
\gamma=\frac{\mu}{\sigma}
A=\Phi(-\gamma)
B=\varphi(-\gamma)
C=\frac{\varphi(m)}{1-\Phi(m)}=\frac{\varphi(\frac{s-\mu}{\sigma})}{1-\Phi(%
\frac{s-\mu}{\sigma})}
\beta
\displaystyle\beta=\frac{1-A}{1+C\gamma^{-1}}+\frac{B\sigma}{\mu+C\sigma}
\displaystyle\beta=\frac{1-A}{1+C\gamma^{-1}}+\frac{B\sigma}{\mu+C\sigma}
\gamma^{\text{ID}}\geq\gamma^{\text{OOD}}
A^{\text{ID}}\leq A^{\text{OOD}}
B^{\text{ID}}\leq B^{\text{OOD}}
s^{\text{ID}}(p)={\mu^{\text{ID}}+\sigma^{\text{ID}}{\sqrt{2}}\operatorname{%
erf}^{-1}(2p-1)}
s^{\text{OOD}}(p)={\mu^{\text{OOD}}+\sigma^{\text{OOD}}{\sqrt{2}}\operatorname%
{erf}^{-1}(2p-1)}
p
\displaystyle C^{\text{ID}}(p)=\frac{\varphi(m^{\text{ID}})}{1-\Phi(m^{\text{%
ID}})}=\frac{\varphi(\frac{s^{\text{ID}}-\mu^{\text{ID}}}{\sigma^{\text{ID}}})%
}{1-\Phi(\frac{s^{\text{ID}}-\mu^{\text{ID}}}{\sigma^{\text{ID}}})}=\frac{%
\varphi(\sqrt{2}\operatorname{erf}^{-1}(2p-1))}{1-\Phi(\sqrt{2}\operatorname{%
erf}^{-1}(2p-1))}
\displaystyle C^{\text{ID}}(p)=\frac{\varphi(m^{\text{ID}})}{1-\Phi(m^{\text{%
ID}})}=\frac{\varphi(\frac{s^{\text{ID}}-\mu^{\text{ID}}}{\sigma^{\text{ID}}})%
}{1-\Phi(\frac{s^{\text{ID}}-\mu^{\text{ID}}}{\sigma^{\text{ID}}})}=\frac{%
\varphi(\sqrt{2}\operatorname{erf}^{-1}(2p-1))}{1-\Phi(\sqrt{2}\operatorname{%
erf}^{-1}(2p-1))}
C^{\text{OOD}}(p)=\frac{\varphi(m^{\text{OOD}})}{1-\Phi(m^{\text{OOD}})}=\frac%
{\varphi(\frac{s^{\text{OOD}}-\mu^{\text{OOD}}}{\sigma^{\text{OOD}}})}{1-\Phi(%
\frac{s^{\text{OOD}}-\mu^{\text{OOD}}}{\sigma^{\text{OOD}}})}=\frac{\varphi(%
\sqrt{2}\operatorname{erf}^{-1}(2p-1))}{1-\Phi(\sqrt{2}\operatorname{erf}^{-1}%
(2p-1))}=C^{\text{ID}}(p)
\displaystyle\mathbb{E}[{\bm{a}}_{j}]\simeq\mu\left[1-\Phi(-\frac{\mu}{\sigma}%
)\right]
\displaystyle\mathbb{E}[{\bm{a}}_{j}]\simeq\mu\left[1-\Phi(-\frac{\mu}{\sigma}%
)\right]
\varphi\left(-\frac{\mu}{\sigma}\right)\sigma\approx 0
\displaystyle\beta=\frac{\gamma(1-A)}{\gamma+C}
\displaystyle\beta=\frac{\gamma(1-A)}{\gamma+C}
\beta
\beta^{\text{ID}}
\beta^{\text{OOD}}
\displaystyle\beta^{\text{ID}}\geq\beta^{\text{OOD}}\iff\frac{1-A^{\text{ID}}}%
{1+C{\gamma^{\text{ID}}}^{-1}}\geq\frac{1-A^{\text{OOD}}}{1+C{\gamma^{\text{%
OOD}}}^{-1}}\iff\frac{1-A^{\text{ID}}}{1-A^{\text{OOD}}}\geq\frac{1+C{\gamma^{%
\text{ID}}}^{-1}}{1+C{\gamma^{\text{OOD}}}^{-1}}
\displaystyle\beta^{\text{ID}}\geq\beta^{\text{OOD}}\iff\frac{1-A^{\text{ID}}}%
{1+C{\gamma^{\text{ID}}}^{-1}}\geq\frac{1-A^{\text{OOD}}}{1+C{\gamma^{\text{%
OOD}}}^{-1}}\iff\frac{1-A^{\text{ID}}}{1-A^{\text{OOD}}}\geq\frac{1+C{\gamma^{%
\text{ID}}}^{-1}}{1+C{\gamma^{\text{OOD}}}^{-1}}
\frac{1}{1+C{\gamma^{\text{OOD}}}^{-1}}\simeq 1-C{\gamma^{\text{OOD}}}^{-1}
\displaystyle\frac{1-A^{\text{ID}}}{1-A^{\text{OOD}}}\geq(1+C{\gamma^{\text{ID%
}}}^{-1})(1-C{\gamma^{\text{OOD}}}^{-1})
\displaystyle\frac{1-A^{\text{ID}}}{1-A^{\text{OOD}}}
\displaystyle\geq(1+C{\gamma^{\text{ID}}}^{-1})(1-C{\gamma^{\text{OOD}}}^{-1})
\displaystyle\geq 1+C({\gamma^{\text{ID}}}^{-1}-{\gamma^{\text{OOD}}}^{-1})-C^%
{2}({\gamma^{\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})
\displaystyle\geq 1+C({\gamma^{\text{ID}}}^{-1}-{\gamma^{\text{OOD}}}^{-1})-C^%
{2}({\gamma^{\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})
C
\displaystyle\frac{1-A^{\text{ID}}}{1-A^{\text{OOD}}}-1-C({\gamma^{\text{ID}}}%
^{-1}-{\gamma^{\text{OOD}}}^{-1})+C^{2}({\gamma^{\text{ID}}}^{-1}{\gamma^{%
\text{OOD}}}^{-1})\geq 0
\displaystyle\frac{1-A^{\text{ID}}}{1-A^{\text{OOD}}}-1-C({\gamma^{\text{ID}}}%
^{-1}-{\gamma^{\text{OOD}}}^{-1})+C^{2}({\gamma^{\text{ID}}}^{-1}{\gamma^{%
\text{OOD}}}^{-1})\geq 0
\displaystyle\mathbb{a}_{1}C^{2}+\mathbb{a}_{2}C+\mathbb{a}_{3}\geq 0
\displaystyle\mathbb{a}_{1}C^{2}+\mathbb{a}_{2}C+\mathbb{a}_{3}\geq 0
\mathbb{a}_{1}=({\gamma^{\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})
\mathbb{a}_{2}=-({\gamma^{\text{ID}}}^{-1}-{\gamma^{\text{OOD}}}^{-1})
\mathbb{a}_{3}=\frac{1-A^{\text{ID}}}{1-A^{\text{OOD}}}-1
\Delta=\mathbb{a}_{2}^{2}-4\mathbb{a}_{1}\mathbb{a}_{3}
\displaystyle\Delta=({\gamma^{\text{ID}}}^{-1}-{\gamma^{\text{OOD}}}^{-1})^{2}%
-4({\gamma^{\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})\left(\frac{1-A^{\text{%
ID}}}{1-A^{\text{OOD}}}-1\right)
\displaystyle\Delta
\displaystyle=({\gamma^{\text{ID}}}^{-1}-{\gamma^{\text{OOD}}}^{-1})^{2}-4({%
\gamma^{\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})\left(\frac{1-A^{\text{ID}}%
}{1-A^{\text{OOD}}}-1\right)
\displaystyle={\gamma^{\text{ID}}}^{-2}+{\gamma^{\text{OOD}}}^{-2}-2({\gamma^{%
\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})\left(2\frac{1-A^{\text{ID}}}{1-A^{%
\text{OOD}}}-1\right)
\displaystyle={\gamma^{\text{ID}}}^{-2}+{\gamma^{\text{OOD}}}^{-2}-2({\gamma^{%
\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})\left(2\frac{1-A^{\text{ID}}}{1-A^{%
\text{OOD}}}-1\right)
\displaystyle=\left({\gamma^{\text{ID}}}^{-1}+{\gamma^{\text{OOD}}}^{-1}\right%
)^{2}-4({\gamma^{\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})\left(\frac{1-A^{%
\text{ID}}}{1-A^{\text{OOD}}}\right)
\displaystyle=\left({\gamma^{\text{ID}}}^{-1}+{\gamma^{\text{OOD}}}^{-1}\right%
)^{2}-4({\gamma^{\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})\left(\frac{1-A^{%
\text{ID}}}{1-A^{\text{OOD}}}\right)
\mathbb{a}_{1}>0
\Delta\leq 0
C(p)\in\mathbb{R}^{+}
\Delta>0
C(p)\in\left[\max\left(\frac{({\gamma^{\text{ID}}}^{-1}-{\gamma^{\text{OOD}}}^%
{-1})+\sqrt{\Delta}}{2({\gamma^{\text{ID}}}^{-1}{\gamma^{\text{OOD}}}^{-1})},0%
^{+}\right),+\infty\right)
({\gamma^{\text{ID}}}^{-1}-{\gamma^{\text{OOD}}}^{-1})\leq 0
({\gamma^{\text{ID}}}^{-1}-{\gamma^{\text{OOD}}}^{-1})-\sqrt{\Delta}\leq 0
p
C(p)
Q_{p}/Q
p
C(p)
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\uparrow
\downarrow
\uparrow
\downarrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\downarrow
\uparrow
\uparrow
