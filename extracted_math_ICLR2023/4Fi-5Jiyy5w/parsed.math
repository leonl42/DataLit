\sim
\sim
\approx\!
\approx\!0.3\%
\|A\|_{F}
A
\|A\|_{F}^{2}=\sum_{i,j}A_{ij}^{2}
A\bullet B
A
B
C=A\bullet B\iff C_{ij}=A_{ij}B_{ij}
D^{\odot\alpha}
\smash{(D^{\odot\alpha})_{ij}=D_{ij}^{\alpha}}
\preceq
A,B
A\preceq B
B-A
A
\alpha\in\mathbb{R}
A^{\alpha}
A=UDU^{\mkern-1.5mu\scriptstyle\mathsf{T}}
A
U
D
D_{ii}\geq 0
A
A^{\alpha}=UD^{\alpha}U^{\mkern-1.5mu\scriptstyle\mathsf{T}}
(D^{\alpha})_{ii}=D_{ii}^{\alpha}
\alpha<0
D_{ii}>0
\operatorname{vec}(A)
m\times n
A
A
a_{1},\ldots,a_{m}
\operatorname{vec}(A)
mn\times 1
\operatorname{vec}(A)=(a_{1},\ldots,a_{m})^{\mkern-1.5mu\scriptstyle\mathsf{T}}
A\otimes B
A
B
(A\otimes B)^{\alpha}=A^{\alpha}\otimes B^{\alpha}
\alpha\in\mathbb{R}
(A\otimes B)\operatorname{vec}(C)=\operatorname{vec}(ACB^{\mkern-1.5mu%
\scriptstyle\mathsf{T}})
w_{t+1}=w_{t}-\eta_{t}\bar{g}_{t}
w_{t}
\bar{g}_{t}
\mathbb{R}^{d}
\bar{g}_{t}
g_{1},\ldots,g_{t}
w_{t+1}=w_{t}-P_{t}\bar{g}_{t}
P_{t}
d\times d
W\in\mathbb{R}^{m\times n}
G
W,G
w,g
mn
m^{2}n^{2}
m^{3}n^{3}
m
n
10^{4}
t
X_{t}
W_{t}
\hat{y}_{t}
y_{t}
\ell
\mathbb{R}_{+}
W_{t+1}
t
x_{t}\in\mathbb{R}^{k}
\hat{y}=f(W_{t},x_{t})
f:\mathbb{R}^{k}\rightarrow\mathbb{R}
\ell:\mathbb{R}\times\mathbb{R}\rightarrow\mathbb{R}_{+}
\ell(\hat{y},y)=(y-\hat{y})^{2}
\ell(\hat{y},y)=\log(1+\exp(-y\hat{y}))
G_{t}=\nabla_{W}\ell(f(W,x_{t}),y_{t})
G_{t}\in\mathbb{R}^{m\times{}n}
W\in\mathbb{R}^{m\times n}
L_{t}
R_{t}
L_{t}=\epsilon I_{m}+\textstyle\sum_{s=1}^{t}G_{s}G_{s}^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}~{};\qquad R_{t}=\epsilon I_{n}+\textstyle\sum_{s=1}^{t%
}G_{s}^{\mkern-1.5mu\scriptstyle\mathsf{T}}G_{s}~{}.
L_{t}\in\mathbb{R}^{m\times m}
R_{t}\in\mathbb{R}^{n\times n}
H_{t}
(L_{t}\otimes R_{t})^{1/2}
w_{t+1}=w_{t}-\eta H_{t}^{-1/2}g_{t}
W
\displaystyle W_{t+1}=W_{t}-\eta\,L_{t}^{-1/4}G_{t}R_{t}^{-1/4}~{}.
\displaystyle W_{t+1}
\displaystyle=W_{t}-\eta\,L_{t}^{-1/4}G_{t}R_{t}^{-1/4}~{}.
L_{t}=L_{t-1}+G_{t}G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}\;\mbox{ and }\;R%
_{t}=R_{t-1}+G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}G_{t}~{};
p
L_{t}^{-1/4}\mbox{ and }R_{t}^{-1/4}~{};
L_{t}^{-1/4}G_{t}R_{t}^{-1/4}~{}.
p
\sim\!\!186
O(d^{2})
O(d^{3})
G_{1},\ldots,G_{t}\in\mathbb{R}^{m\times n}
r
g_{s}=\operatorname{vec}(G_{s})
\widehat{H}_{t}=\epsilon I_{mn}+\sum_{s=1}^{t}g_{s}g_{s}^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}~{}.
L_{t},R_{t}
L_{t}=\epsilon I_{m}+\sum_{s=1}^{t}G_{s}G_{s}^{\mkern-1.5mu\scriptstyle\mathsf%
{T}}~{},R_{t}=\epsilon I_{n}+\sum_{s=1}^{t}G_{s}^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}G_{s}~{}.
p,q>0
\smash{1/p}+\smash{1/q}=1
\widehat{H}_{t}\preceq rL_{t}^{\smash{1/p}}\otimes R_{t}^{\smash{1/q}}
p,q>0
\smash{1/p}+\smash{1/q}=1
\smash{\widehat{H}_{t}^{-\smash{1/2}}g_{t}}
(L_{t}^{\smash{1/p}}\otimes R_{t}^{\smash{1/q}})^{-\smash{1/2}}g_{t}
\smash{\smash{\widetilde{G}}_{t}=L_{t}^{-\smash{1/2p}}G_{t}R_{t}^{-\smash{1/2q%
}}}
(p,q)=(1,\infty)
(p,q)=(\infty,1)
\smash{G_{t}R_{t}^{-\smash{1/2}}}
\smash{L_{t}^{-\smash{1/2}}G_{t}}
W\in\mathbb{R}^{km\times kn}
W_{1,1}\ldots W_{m,n}
W_{i,j}\in\mathbb{R}^{k\times k}
\forall i,j
g_{1},\ldots,g_{t}\in\mathbb{R}^{mk}
g_{i}=[g_{i,1},\ldots,g_{i,k}]
g_{i,j}\in\mathbb{R}^{m}
\widehat{H}_{t}=\epsilon I_{mn}+\sum_{s=1}^{t}g_{s}g_{s}^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}
B_{t}\in\mathbb{R}^{mk\times mk}
k
m\times m
j
B_{t}^{(j)}=\epsilon I_{m}+\sum_{s=1}^{t}g_{s,j}g_{s,j}^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}~{}.
\widehat{H}_{t}\preceq kB_{t}
p
p=2,4,8
p
L_{t},R_{t}
L_{t}
R_{t}
L_{t}^{\smash{1/4}}
R_{t}^{\smash{1/4}}
N
L_{t}
R_{t}
L_{t}^{\smash{1/4}}
R_{t}^{\smash{1/4}}
N
<\!5\%
p
\to
\to
\approx\!16\%
\approx
\to
\approx\!16\%
\approx
\smash{G_{t}R_{t}^{-1/2}}
\smash{L_{t}^{-1/2}G_{t}}
\approx\!20\%
<\!3\%
\to
\to
\to
\approx\!2
\to
\approx\!2
\approx\!0.3\%
\approx\!16\%
\approx\!1\%
\approx\!16\%
\approx\!1\%
\approx\!50\%
\widehat{H}_{t}\preceq rL_{t}\otimes I_{n}
\widehat{H}_{t}\preceq rI_{m}\otimes R_{t}
\displaystyle\widehat{H}_{t}\preceq r(L_{t}\otimes I_{n})^{1/p}(I_{m}\otimes R%
_{t})^{1/q}
\displaystyle\widehat{H}_{t}
\displaystyle\preceq r(L_{t}\otimes I_{n})^{1/p}(I_{m}\otimes R_{t})^{1/q}
\displaystyle=r(L_{t}^{1/p}\otimes I_{n})(I_{m}\otimes R_{t}^{1/q})
\displaystyle=r(L_{t}^{1/p}\otimes I_{n})(I_{m}\otimes R_{t}^{1/q})
\displaystyle=rL_{t}^{1/p}\otimes R_{t}^{1/q}~{},
\displaystyle=rL_{t}^{1/p}\otimes R_{t}^{1/q}~{},
G_{1},\ldots,G_{T}
r
W^{\star}\in\mathbb{R}^{m\times n}
\displaystyle\sum_{t=1}^{T}f_{t}(W_{t})-\sum_{t=1}^{T}f_{t}(W^{\star})\leq%
\sqrt{2r}D\operatorname*{Tr}(L_{T}^{\frac{1}{2p}})\operatorname*{Tr}(R_{T}^{%
\frac{1}{2q}})~{},
\displaystyle\sum_{t=1}^{T}f_{t}(W_{t})-\sum_{t=1}^{T}f_{t}(W^{\star})\leq%
\sqrt{2r}D\operatorname*{Tr}(L_{T}^{\frac{1}{2p}})\operatorname*{Tr}(R_{T}^{%
\frac{1}{2q}})~{},
L_{T}=\epsilon I_{m}+\sum_{t=1}^{T}G_{t}G_{t}^{\mkern-1.5mu\scriptstyle\mathsf%
{T}}\;,\;\;R_{T}=\epsilon I_{n}+\sum_{t=0}^{T}G_{t}^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}G_{t}\;,\;\;D=\max_{t\in[T]}\|W_{t}-W^{\star}\|_{2}~{}.
1/p+1/q=1,p,q\geq 1
H_{t}=L_{t}^{\frac{1}{2p}}\otimes R_{t}^{\frac{1}{2q}}
w_{t+1}=w_{t}-\eta H_{t}^{-1}g_{t}
0\preceq L_{1}\preceq\ldots\preceq L_{T}
0\preceq R_{1}\preceq\ldots\preceq R_{T}
x\mapsto x^{\alpha}
\alpha\leq 1
0\preceq H_{1}\preceq\ldots\preceq H_{T}
\sum_{t=1}^{T}f_{t}(W_{t})-\sum_{t=1}^{T}f_{t}(W^{\star})\leq\frac{D^{2}}{2%
\eta}\operatorname*{Tr}(H_{T})+\frac{\eta}{2}\sum_{t=1}^{T}\|g_{t}\|^{2}_{H_{t%
}^{*}},
D=\max_{t}\|W_{t}-W^{\star}\|_{2}
g_{t}=\operatorname{vec}(G_{t})
\widehat{H}_{t}=(\epsilon I_{m}+\sum_{s=1}^{t}g_{s}g_{s}^{\mkern-1.5mu%
\scriptstyle\mathsf{T}})^{1/2}
\widehat{H}_{t}\preceq\sqrt{r}H_{t}
\sum_{t=1}^{T}\|g_{t}\|^{2}_{H_{t}^{*}}\leq\sqrt{r}\sum_{t=1}^{T}\|g_{t}\|^{2}%
_{\widehat{H}_{t}^{*}}\leq 2\sqrt{r}\operatorname*{Tr}(\hat{H}_{T})\leq 2r%
\operatorname*{Tr}(H_{T}).
\sum_{t=1}^{T}f_{t}(W_{t})-\sum_{t=1}^{T}f_{t}(W^{\star})\leq\frac{D^{2}}{2%
\eta}\operatorname*{Tr}(H_{T})+\eta r\operatorname*{Tr}(H_{T}).
\eta=D/\sqrt{2r}
\operatorname*{Tr}(H_{t})=\operatorname*{Tr}(L_{t}^{1/2p})\operatorname*{Tr}(R%
_{t}^{1/2q})
x\in\mathbb{R}^{mk}
x=[x_{1},x_{2},\ldots,x_{k}]
x_{j}\in\mathbb{R}^{m}
\displaystyle x^{\mkern-1.5mu\scriptstyle\mathsf{T}}\widehat{H}_{t}x=\epsilon%
\|x\|_{2}^{2}+\sum_{s=1}^{t}x^{\mkern-1.5mu\scriptstyle\mathsf{T}}g_{s}g_{s}^{%
\mkern-1.5mu\scriptstyle\mathsf{T}}x=\epsilon\|x\|_{2}^{2}+\sum_{s=1}^{t}(g_{s%
}^{\mkern-1.5mu\scriptstyle\mathsf{T}}x)^{2}=\epsilon\|x\|_{2}^{2}+\sum_{s=1}^%
{t}\biggl{(}\sum_{j=1}^{k}g_{s,j}^{\mkern-1.5mu\scriptstyle\mathsf{T}}x_{j}%
\biggr{)}^{2}
\displaystyle x^{\mkern-1.5mu\scriptstyle\mathsf{T}}\widehat{H}_{t}x
\displaystyle=\epsilon\|x\|_{2}^{2}+\sum_{s=1}^{t}x^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}g_{s}g_{s}^{\mkern-1.5mu\scriptstyle\mathsf{T}}x=\epsilon\|x\|_{2}^%
{2}+\sum_{s=1}^{t}(g_{s}^{\mkern-1.5mu\scriptstyle\mathsf{T}}x)^{2}=\epsilon\|%
x\|_{2}^{2}+\sum_{s=1}^{t}\biggl{(}\sum_{j=1}^{k}g_{s,j}^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}x_{j}\biggr{)}^{2}
\displaystyle\leq k\epsilon\|x\|_{2}^{2}+k\sum_{s=1}^{t}\sum_{j=1}^{k}(g_{s,j}%
^{\mkern-1.5mu\scriptstyle\mathsf{T}}x_{j})^{2}=k\sum_{j=1}^{k}\biggl{(}%
\epsilon\|x_{j}\|_{2}^{2}+\sum_{s=1}^{t}x_{j}^{\mkern-1.5mu\scriptstyle\mathsf%
{T}}g_{s,j}g_{s,j}^{\mkern-1.5mu\scriptstyle\mathsf{T}}x_{j}\biggr{)}
\displaystyle\leq k\epsilon\|x\|_{2}^{2}+k\sum_{s=1}^{t}\sum_{j=1}^{k}(g_{s,j}%
^{\mkern-1.5mu\scriptstyle\mathsf{T}}x_{j})^{2}=k\sum_{j=1}^{k}\biggl{(}%
\epsilon\|x_{j}\|_{2}^{2}+\sum_{s=1}^{t}x_{j}^{\mkern-1.5mu\scriptstyle\mathsf%
{T}}g_{s,j}g_{s,j}^{\mkern-1.5mu\scriptstyle\mathsf{T}}x_{j}\biggr{)}
\displaystyle=k\sum_{j=1}^{k}x_{j}^{\mkern-1.5mu\scriptstyle\mathsf{T}}\bigl{(%
}\epsilon I_{m}+\sum_{s=1}^{t}g_{s,j}g_{s,j}^{\mkern-1.5mu\scriptstyle\mathsf{%
T}}\bigr{)}x_{j}=k\sum_{j=1}^{k}x_{j}^{\mkern-1.5mu\scriptstyle\mathsf{T}}B_{t%
}^{(j)}x_{j}=kx^{\mkern-1.5mu\scriptstyle\mathsf{T}}B_{t}x.
\displaystyle=k\sum_{j=1}^{k}x_{j}^{\mkern-1.5mu\scriptstyle\mathsf{T}}\bigl{(%
}\epsilon I_{m}+\sum_{s=1}^{t}g_{s,j}g_{s,j}^{\mkern-1.5mu\scriptstyle\mathsf{%
T}}\bigr{)}x_{j}=k\sum_{j=1}^{k}x_{j}^{\mkern-1.5mu\scriptstyle\mathsf{T}}B_{t%
}^{(j)}x_{j}=kx^{\mkern-1.5mu\scriptstyle\mathsf{T}}B_{t}x.
\bigl{(}\sum_{j=1}^{k}\alpha_{j}\bigr{)}^{2}\leq k\sum_{j=1}^{k}\alpha_{j}^{2}
x\mapsto x^{2}
g_{1},\ldots,g_{T}\in\mathbb{R}^{mk}
g_{i}=[g_{i,1},\ldots,g_{i,k}]
g_{i,j}\in\mathbb{R}^{m}
w^{\star}\in\mathbb{R}^{mk}
\displaystyle\sum_{t=1}^{T}f_{t}(w_{t})-\sum_{t=1}^{T}f_{t}(w^{\star})\leq%
\sqrt{2k}D\sum_{j=1}^{k}\operatorname*{Tr}\biggl{(}\biggl{(}\epsilon I_{m}+%
\sum_{t=1}^{T}g_{t,j}g_{t,j}^{\mkern-1.5mu\scriptstyle\mathsf{T}}\biggr{)}^{%
\frac{1}{2}}\biggr{)}~{}.
\displaystyle\sum_{t=1}^{T}f_{t}(w_{t})-\sum_{t=1}^{T}f_{t}(w^{\star})\leq%
\sqrt{2k}D\sum_{j=1}^{k}\operatorname*{Tr}\biggl{(}\biggl{(}\epsilon I_{m}+%
\sum_{t=1}^{T}g_{t,j}g_{t,j}^{\mkern-1.5mu\scriptstyle\mathsf{T}}\biggr{)}^{%
\frac{1}{2}}\biggr{)}~{}.
\displaystyle{\mathbf{F}}=\mathop{\mathbb{E}}_{p(x|\theta)}\left[\nabla\log p(%
x|\theta)\,\nabla\log p(x|\theta)^{\mkern-1.5mu\scriptstyle\mathsf{T}}\right]=%
\mathop{\mathbb{E}}_{p(x|\theta)}\left[g_{p(x|\theta)}\,g_{p(x|\theta)}^{%
\mkern-1.5mu\scriptstyle\mathsf{T}}\right].
\displaystyle{\mathbf{F}}=\mathop{\mathbb{E}}_{p(x|\theta)}\left[\nabla\log p(%
x|\theta)\,\nabla\log p(x|\theta)^{\mkern-1.5mu\scriptstyle\mathsf{T}}\right]=%
\mathop{\mathbb{E}}_{p(x|\theta)}\left[g_{p(x|\theta)}\,g_{p(x|\theta)}^{%
\mkern-1.5mu\scriptstyle\mathsf{T}}\right].
W\in\mathbb{R}^{m\times n}
Wx=s
G_{t}\in\mathbb{R}^{m\times{}n}
G_{t}=\nabla_{s}\ell(s_{t},y_{t})x^{\mkern-1.5mu\scriptstyle\mathsf{T}}
\nabla_{s}\ell(s_{t},y_{t})\otimes x
\displaystyle{\mathbf{F}}=\mathop{\mathbb{E}}_{p(x|\theta)}\left[(\nabla_{s}%
\ell(s_{t},y_{t})\otimes x)\,(\nabla_{s}\ell(s_{t},y_{t})\otimes x)^{\mkern-1.%
5mu\scriptstyle\mathsf{T}}\right]
\displaystyle{\mathbf{F}}
\displaystyle=\mathop{\mathbb{E}}_{p(x|\theta)}\left[(\nabla_{s}\ell(s_{t},y_{%
t})\otimes x)\,(\nabla_{s}\ell(s_{t},y_{t})\otimes x)^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}\right]
\displaystyle=\mathop{\mathbb{E}}_{p(x|\theta)}\left[(\nabla_{s}\ell(s_{t},y_{%
t})\nabla_{s}\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle\mathsf{T}})\otimes\,(%
x_{t}x_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}})\right].
\displaystyle=\mathop{\mathbb{E}}_{p(x|\theta)}\left[(\nabla_{s}\ell(s_{t},y_{%
t})\nabla_{s}\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle\mathsf{T}})\otimes\,(%
x_{t}x_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}})\right].
\nabla_{s}\ell(s_{t},y_{t})
x
\displaystyle{\mathbf{F}}\approx\mathop{\mathbb{E}}\left[(\nabla_{s}\ell(s_{t}%
,y_{t})\nabla_{s}\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle\mathsf{T}})\right%
]\otimes\,\mathop{\mathbb{E}}\left[x_{t}x_{t}^{\mkern-1.5mu\scriptstyle\mathsf%
{T}}\right].
\displaystyle{\mathbf{F}}
\displaystyle\approx\mathop{\mathbb{E}}\left[(\nabla_{s}\ell(s_{t},y_{t})%
\nabla_{s}\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle\mathsf{T}})\right]%
\otimes\,\mathop{\mathbb{E}}\left[x_{t}x_{t}^{\mkern-1.5mu\scriptstyle\mathsf{%
T}}\right].
D=\mathop{\mathbb{E}}\left[(\nabla_{s}\ell(s_{t},y_{t})\nabla_{s}\ell(s_{t},y_%
{t})^{\mkern-1.5mu\scriptstyle\mathsf{T}})\right]
X=\mathop{\mathbb{E}}\left[x_{t}x_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}\right]
\displaystyle W_{t+1}\approx W_{t}-\eta\,D^{-1}G_{t}X^{-1}.
\displaystyle W_{t+1}
\displaystyle\approx W_{t}-\eta\,D^{-1}G_{t}X^{-1}.
-1
-1/2p
p
\displaystyle G_{t}G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}=\nabla_{s}\ell(s%
_{t},y_{t})x_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}x_{t}\nabla_{s}\ell(s_{t}%
,y_{t})^{\mkern-1.5mu\scriptstyle\mathsf{T}}=\|x_{t}\|_{2}^{2}\nabla_{s}\ell(s%
_{t},y_{t})\nabla_{s}\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle\mathsf{T}};
\displaystyle G_{t}G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}
\displaystyle=\nabla_{s}\ell(s_{t},y_{t})x_{t}^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}x_{t}\nabla_{s}\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle\mathsf{T%
}}=\|x_{t}\|_{2}^{2}\nabla_{s}\ell(s_{t},y_{t})\nabla_{s}\ell(s_{t},y_{t})^{%
\mkern-1.5mu\scriptstyle\mathsf{T}};
\displaystyle G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}G_{t}=x_{t}\nabla_{s}%
\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle\mathsf{T}}\nabla_{s}\ell(s_{t},y_{%
t})x_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}=\|\nabla_{s}\ell(s_{t},y_{t})\|_%
{2}^{2}x_{t}x_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}.
\displaystyle G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}G_{t}
\displaystyle=x_{t}\nabla_{s}\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}\nabla_{s}\ell(s_{t},y_{t})x_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T%
}}=\|\nabla_{s}\ell(s_{t},y_{t})\|_{2}^{2}x_{t}x_{t}^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}.
\displaystyle\mathop{\mathbb{E}}\left[\frac{G_{t}G_{t}^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}}{\|x_{t}\|_{2}^{2}}\right]=\mathop{\mathbb{E}}\left[%
\nabla_{s}\ell(s_{t},y_{t})\nabla_{s}\ell(s_{t},y_{t})^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}\right]=D;
\displaystyle\mathop{\mathbb{E}}\left[\frac{G_{t}G_{t}^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}}{\|x_{t}\|_{2}^{2}}\right]
\displaystyle=\mathop{\mathbb{E}}\left[\nabla_{s}\ell(s_{t},y_{t})\nabla_{s}%
\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle\mathsf{T}}\right]=D;
\displaystyle\mathop{\mathbb{E}}\left[\frac{G_{t}^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}G_{t}}{\|\nabla_{s}\ell(s_{t},y_{t})\|_{2}^{2}}\right]=\mathop{%
\mathbb{E}}\left[x_{t}x_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}\right]=X.
\displaystyle\mathop{\mathbb{E}}\left[\frac{G_{t}^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}G_{t}}{\|\nabla_{s}\ell(s_{t},y_{t})\|_{2}^{2}}\right]
\displaystyle=\mathop{\mathbb{E}}\left[x_{t}x_{t}^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}\right]=X.
\|x_{t}\|_{2}^{2},\|\nabla_{s}\ell(s_{t},y_{t})\|_{2}^{2}
s={Wx}/{\|W\|}
G_{t}=\frac{1}{\|W\|}\nabla_{s}\ell(s_{t},y_{t})x^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}-\frac{\nabla_{s}\ell(s_{t},y_{t})^{\mkern-1.5mu\scriptstyle\mathsf%
{T}}Wx}{\|W\|^{3}}W,
\mathbb{E}[\operatorname{vec}(G_{t})\operatorname{vec}(G_{t})^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}]
\hat{H}_{t}\approx L_{t}^{\smash{1/2}}\otimes R_{t}^{\smash{1/2}}
L_{t}^{\smash{1/2}}=UDU^{\mkern-1.5mu\scriptstyle\mathsf{T}}
R_{t}^{\smash{1/2}}=VD^{\prime}V^{\mkern-1.5mu\scriptstyle\mathsf{T}}
L_{t}^{\smash{1/2}}\otimes R_{t}^{\smash{1/2}}=(U\otimes V)(D\otimes D^{\prime%
})(U\otimes V)^{\mkern-1.5mu\scriptstyle\mathsf{T}}
D\otimes D^{\prime}
\displaystyle\Lambda=\operatorname*{diag}((U\otimes V)^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}\hat{H}_{t}(U\otimes V))
\displaystyle\Lambda
\displaystyle=\operatorname*{diag}((U\otimes V)^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}\hat{H}_{t}(U\otimes V))
\displaystyle=\epsilon I+\sum_{s=1}^{t}\operatorname*{diag}((U\otimes V)^{%
\mkern-1.5mu\scriptstyle\mathsf{T}}\operatorname{vec}(G_{s})\operatorname{vec}%
(G_{s})^{\mkern-1.5mu\scriptstyle\mathsf{T}}(U\otimes V))
\displaystyle=\epsilon I+\sum_{s=1}^{t}\operatorname*{diag}((U\otimes V)^{%
\mkern-1.5mu\scriptstyle\mathsf{T}}\operatorname{vec}(G_{s})\operatorname{vec}%
(G_{s})^{\mkern-1.5mu\scriptstyle\mathsf{T}}(U\otimes V))
\displaystyle=\epsilon I+\sum_{s=1}^{t}\operatorname*{diag}(\operatorname{vec}%
(U^{\mkern-1.5mu\scriptstyle\mathsf{T}}G_{s}V)\operatorname{vec}(U^{\mkern-1.5%
mu\scriptstyle\mathsf{T}}G_{s}V)^{\mkern-1.5mu\scriptstyle\mathsf{T}})
\displaystyle=\epsilon I+\sum_{s=1}^{t}\operatorname*{diag}(\operatorname{vec}%
(U^{\mkern-1.5mu\scriptstyle\mathsf{T}}G_{s}V)\operatorname{vec}(U^{\mkern-1.5%
mu\scriptstyle\mathsf{T}}G_{s}V)^{\mkern-1.5mu\scriptstyle\mathsf{T}})
\displaystyle=\epsilon I+\sum_{s=1}^{t}\operatorname{vec}(U^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}G_{s}V)^{\odot 2},
\displaystyle=\epsilon I+\sum_{s=1}^{t}\operatorname{vec}(U^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}G_{s}V)^{\odot 2},
\Lambda_{t+1}\approx\Lambda_{t}+(U^{\mkern-1.5mu\scriptstyle\mathsf{T}}G_{t}V)%
^{\odot 2}
W_{t+1}=W_{t}-\eta_{t}U(\Lambda_{t}^{-\smash{1/2}}\bullet(U^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}G_{t}V))V^{\mkern-1.5mu\scriptstyle\mathsf{T}}
d
N
W\in\mathbb{R}^{d\times N}
x\in\mathbb{R}^{N\times m}
m
k
x(k)
x_{jk}=\delta_{j,x(k)}
y=Wx
G=\nabla_{W}\ell=\nabla_{y}\ell\,x^{\mkern-1.5mu\scriptstyle\mathsf{T}}
GG^{\mkern-1.5mu\scriptstyle\mathsf{T}}=\nabla_{y}\ell\,x^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}x\,\nabla_{y}\ell^{\mkern-1.5mu\scriptstyle\mathsf{T}}
x^{\mkern-1.5mu\scriptstyle\mathsf{T}}x={\bf I}_{m}
GG^{\mkern-1.5mu\scriptstyle\mathsf{T}}=\nabla_{y}\ell\,\nabla_{y}\ell^{\mkern%
-1.5mu\scriptstyle\mathsf{T}}
W
y
b\times m
O(d^{2}m)
O(d^{2}N)
O(d^{2}m)
x
x^{\mkern-1.5mu\scriptstyle\mathsf{T}}x
x
GG^{\mkern-1.5mu\scriptstyle\mathsf{T}}=\nabla_{y}\ell(x^{\mkern-1.5mu%
\scriptstyle\mathsf{T}}x)\nabla_{y}\ell^{\mkern-1.5mu\scriptstyle\mathsf{T}}
O(d^{2}m)\ll O(d^{2}N)
X^{-p}-A=0
X_{k+1}=\frac{1}{p}[(p+1)X_{k}-X_{k}^{p+1}A]
X_{0}=\frac{1}{c}I
X_{k}\rightarrow A^{-1/p}
k\to\infty
M_{k}=X_{k}^{p}A
X_{k+1}=X_{k}\biggl{(}\frac{(p+1)I-M_{k}}{p}\biggr{)},\qquad X_{0}=\frac{1}{c}I,
M_{k+1}=X_{k+1}^{p}A=\biggl{(}\frac{(p+1)I-M_{k}}{p}\biggr{)}^{p}X_{k}^{p}A=%
\biggl{(}\frac{(p+1)I-M_{k}}{p}\biggr{)}^{p}M_{k},\qquad M_{0}=\frac{1}{c^{p}}A,
X_{k},M_{k}
A
p
G^{-1/p}
X=I,M=G
M=X^{p}G
M\rightarrow I
X\rightarrow G^{-1/p}
p
G_{t}
X=G_{\smash{t}}^{\smash{-1/p}},M=X^{p}G_{t+1}
G_{t}
G_{t+1}
M
I
XM=MX
X=G_{\smash{t}}^{\smash{-1/p}},M=X^{p}G_{t+1}
[X,M]=XM-MX
X=I,M=G_{t+1}
G+\epsilon_{d}I
\epsilon_{d}
G
{\bf G}
\epsilon>0
n_{\text{step}}
{\bf v}\in\mathbb{R}^{n}
{\bf G}\in\mathbb{R}^{n\times n}
i=0,\,\mbox{error}=\infty,\,\lambda=0
i<n_{\text{step}}
\mbox{error}>\epsilon
\hat{\bf v}=\smash{\bf v/\|\bf v\|}
{\bf v}={\bf G\hat{v}}
\lambda_{\text{old}}=\lambda;\lambda={\hat{\bf{v}}}^{\mkern-1.5mu\scriptstyle%
\mathsf{T}}{\bf v}
\mbox{\text{error}}=|\lambda-\lambda_{\text{old}}|;i=i+1
\lambda
{\bf G}
p\in\mathbb{N}
{\bf X}
\epsilon>0
\epsilon_{d}>0
{\bf G}^{-\smash{1/p}}
\lambda_{\mbox{max}}=
G
{\bf G}={\bf G}+\epsilon*\lambda_{\mbox{max}}*I
\alpha=-\frac{1}{p}
{\bf X}
{\bf M}={\bf X}^{p}{\bf G}
z=\frac{1+p}{2\|{\bf G}\|_{F}}
{\bf X}=\frac{1}{z^{\alpha}}{\bf I}
{\bf M}=z{\bf G}
\|{\bf M}-{\bf I}\|_{\infty}>\epsilon
{\bf M}_{1}=(1-\alpha){\bf I}+\alpha{\bf M}
{\bf X}={\bf X}{\bf M}_{1}
{\bf M}={\bf M}_{1}^{p}{\bf M}
{\bf X}
p
L_{t}
\approx\log_{2}(\frac{1}{p}\kappa(L_{t}))
p
L_{t}
\approx\log_{2}(\frac{1}{p}\kappa(L_{t}))
p
\tau_{1}
\tau_{1}
\tau_{2}
=1
L_{t},R_{t}
\tau_{2}
\eta_{t}
\beta_{1}
\beta_{2}
t=1,\ldots,T
G_{t}
t~{}\%~{}\tau_{2}=0
\beta_{2}<1
L_{t}\leftarrow\beta_{2}~{}L_{t-\tau_{2}}
\left(1-\beta_{2}\right)~{}G_{t}G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}
R_{t}\leftarrow\beta_{2}~{}R_{t-\tau_{2}}
\left(1-\beta_{2}\right)~{}G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}G_{t}
L_{t}\leftarrow L_{t-\tau_{2}}
G_{t}G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}
R_{t}\leftarrow R_{t-\tau_{2}}
G_{t}^{\mkern-1.5mu\scriptstyle\mathsf{T}}G_{t}
D_{t}\leftarrow D_{t-1}+G_{t}\bullet G_{t}
M_{t}\leftarrow\beta_{1}~{}M_{t-1}+\left(1-\beta_{1}\right)~{}D_{t}^{\odot-1/2%
}\bullet G_{t}
t~{}\%~{}\tau_{1}=0
L_{\left(t-\tau_{1}\right)}^{-1/4},R_{\left(t-\tau_{1}\right)}^{-1/4}
L_{t},R_{t}
L_{t}^{-1/4},R_{t}^{-1/4}
t>\tau_{1}
P_{t}\leftarrow\beta_{1}P_{t-1}+\left(1-\beta_{1}\right)~{}L_{t}^{-1/4}G_{t}R_%
{t}^{-1/4}
\eta_{t}\leftarrow\eta_{0}\mathopen{}\big{\|}M_{t}\big{\|}_{F}\big{/}\mathopen%
{}\big{\|}P_{t}\big{\|}_{F}
W_{t}=W_{t-1}-\eta_{t}P_{t}
\eta_{t}\leftarrow\eta_{0}
W_{t}=W_{t-1}-\eta_{t}M_{t}
W_{t}
[n,m]
O(n^{2}m+m^{2}n)
O(n^{2}+m^{2})
W_{t}
[n,m]
O(n^{2}m)
O(n^{2})
b
O(mnb)
O(mn)
10^{-3}
5\times 10^{-6}
3.5\times 10^{-6}
W_{t+1}=W_{t}-\eta L_{t}^{-1/4}G_{t}R_{t}^{-1/4}
W_{t+1}=W_{t}-\eta L_{t}^{-\frac{\alpha}{2}}G_{t}R_{t}^{-\frac{\alpha}{2}}
\alpha\in[0,1]
\alpha=1
{\mathopen{}\big{\|}W_{t}\big{\|}_{F}}\big{/}{\mathopen{}\big{\|}G_{t}\big{\|}%
_{F}}
W_{t}
W_{t}=W_{t-1}-A_{t}{\bf\hat{S}_{t}}
\displaystyle D_{t}=\sum_{s=1}^{t}G_{s}\bullet G_{s};\ \ A_{t}=\eta_{0}\,%
\mathopen{}\big{\|}D_{t}^{\odot-1/2}\bullet G_{t}\big{\|}_{F}
\displaystyle D_{t}
\displaystyle=\sum_{s=1}^{t}G_{s}\bullet G_{s};\ \ A_{t}=\eta_{0}\,\mathopen{}%
\big{\|}D_{t}^{\odot-1/2}\bullet G_{t}\big{\|}_{F}
\displaystyle{\bf\hat{S}_{t}}=\frac{L_{t}^{-1/4}G_{t}R_{t}^{-1/4}}{\mathopen{}%
\big{\|}L_{t}^{-1/4}G_{t}R_{t}^{-1/4}\big{\|}_{F}}
\displaystyle{\bf\hat{S}_{t}}
\displaystyle=\frac{L_{t}^{-1/4}G_{t}R_{t}^{-1/4}}{\mathopen{}\big{\|}L_{t}^{-%
1/4}G_{t}R_{t}^{-1/4}\big{\|}_{F}}
\displaystyle\mbox{(Shampoo direction)}.
\displaystyle\mbox{(Shampoo direction)}.
\eta=0.000225
\beta_{1}=0.9
\beta_{2}=0.98
\eta=0.125
\beta_{1}=0.95
\eta=0.225
\beta_{1}=0.95
\kappa=500
\tau_{1}=1000
\tau_{2}=1
\eta=0.000154
\beta_{1}=0.9
\beta_{2}=0.999
\eta=0.03
\beta_{1}=0.9
\eta=0.06
\beta_{1}=0.9
\kappa=500
\tau_{1}=1000
\tau_{2}=1
\eta=0.06
\beta_{1}=0.9
\eta=0.08
\beta_{1}=0.9
\kappa=500
\tau_{1}=1000
\tau_{2}=1
\eta=0.0060
\beta_{1}=0.9
\beta_{2}=0.999
\eta=0.0060
\beta_{1}=0.9
\beta_{2}=0.999
\lambda_{2}=10^{-2}
\tau_{1}=400
\tau_{2}=10
\eta=0.1
\eta=0.1
\beta_{1}=0.9
\tau_{1}=999
\tau_{2}=10
\eta_{\text{embd}}=0.31
\to
\eta
\eta_{t}=\eta\sqrt{d/t}
1024\times 1024
\approx
\approx
H_{i}:=H_{i}+g_{i}^{2}
L_{i}:=L_{i}+GG^{\mkern-1.5mu\scriptstyle\mathsf{T}}
g_{i}/\sqrt{H_{i}}
L^{-\smash{1/4}}GR^{-\smash{1/4}}
W:=W-\eta\tilde{G}
\tilde{G}
L^{-\smash{1/4}},R^{-\smash{1/4}}
