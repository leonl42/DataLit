\dagger
\dagger
\dagger
\approx 30\%
\approx 45\%
D=\{v_{i}:=(o_{1}^{i},...,o_{h_{i}}^{i})\}_{i=1}^{N}
o\in{\color[rgb]{0,0,0}O:=}\mathbb{R}^{H\times W\times 3}
h_{i}=1
v_{i}
D
\mathcal{A}
\phi:=\mathcal{A}(D):\mathbb{R}^{H\times W\times 3}\rightarrow K
K
\phi
\mathcal{M}(\phi):=(\phi(O),A,R(o_{t},o_{t+1};\phi,g),T,\gamma,g)
g
(o_{t},o_{t+1})
R(o_{t},o_{t+1};\phi,\{g\}):=\mathcal{S}_{\phi}(o_{t+1};g)-\mathcal{S}_{\phi}(%
o_{t};g):=(1-\gamma)\mathcal{S}_{\phi}(o_{t+1};g)+\left(\gamma\mathcal{S}_{%
\phi}(o_{t+1};g)-\mathcal{S}_{\phi}(o_{t};g)\right),
\mathcal{S}_{\phi}
\phi
\mathcal{S}_{\phi}(o_{t};g):=-\left\lVert\phi(o_{t})-\phi(g)\right\rVert_{2}
\phi
\pi:\mathbb{R}^{K}\rightarrow A
a\sim\pi(\phi(o))
\pi_{H}
a^{H}\sim\pi^{H}(\phi(o)\mid\phi(g))
A^{H}
r(o,g)
\max_{\pi_{H},\phi}\mathbb{E}_{\pi^{H}}\left[\sum_{t}\gamma^{t}r(o;g)\right]-D%
_{\mathrm{KL}}(d^{\pi_{H}}(o,a^{H};g)\|d^{D}(o,\tilde{a}^{H};g)),
d^{\pi_{H}}(o,a^{H};g)
\pi_{H}
g
\tilde{a}
(o^{i}_{h},\tilde{a}^{i}_{h},o^{i}_{h+1})
D
\tilde{a}^{h}_{i}
o^{i}_{h}
o^{i}_{h+1}
\pi^{H}
D^{H}
A^{H}
\max_{\phi}\min_{V}\mathbb{E}_{p(g)}\left[(1-\gamma)\mathbb{E}_{\mu_{0}(o;g)}[%
V(\phi(o);\phi(g))]+\log\mathbb{E}_{(o,o^{\prime};g)\sim D}\left[\mathrm{exp}%
\left(r(o,g)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(o),\phi(g))\right)%
\right]\right],
\mu_{0}(o;g)
D(o,o^{\prime};g)
D
r(o,g)=\mathbb{I}(o==g)-1
\tilde{\delta}_{g}(o)
o
g
V(\phi(o);\phi(g))
g
o
\phi
V^{*}
\min_{\phi}\mathbb{E}_{p(g)}\left[(1-\gamma)\mathbb{E}_{\mu_{0}(o;g)}[-V^{*}(%
\phi(o);\phi(g))]+\log\mathbb{E}_{D(o,o^{\prime};g)}\left[\mathrm{exp}\left(%
\tilde{\delta}_{g}(o)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(o),\phi(g))%
\right)\right]^{-1}\right],
V^{*}(\phi(o);\phi(g))
\min_{\phi}(1-\gamma)\mathbb{E}_{p(g),\mu_{0}(o;g)}\left[-\log\frac{e^{V^{*}(%
\phi(o);\phi(g))}}{\mathbb{E}_{D(o,o^{\prime};g)}\left[\mathrm{exp}\left(%
\tilde{\delta}_{g}(o)+\gamma V^{*}(\phi(o^{\prime});\phi(g))-V^{*}(\phi(o),%
\phi(g))\right)\right]^{\frac{-1}{(1-\gamma)}}}\right]
p(g)
\mu_{0}(s;g)
D(o,o^{\prime};g)
V^{*}
V^{*}
V^{*}
L_{2}
V^{*}(\phi(o),\phi(g)):=-\left\lVert\phi(o)-\phi(g)\right\rVert_{2}
\mathcal{L}(\phi)=\mathbb{E}_{p(g)}\left[(1-\gamma)\mathbb{E}_{\mu_{0}(o;g)}%
\left[\left\lVert\phi(o)-\phi(g)\right\rVert_{2}\right]+\log\mathbb{E}_{(o,o^{%
\prime};g)\sim D}\left[\mathrm{exp}\left(\left\lVert\phi(o)-\phi(g)\right%
\rVert_{2}-\tilde{\delta}_{g}(o)-\gamma\left\lVert\phi(o^{\prime})-\phi(g)%
\right\rVert_{2}\right)\right]\right],
\exp(\cdot)
D
D=\{(o^{i}_{1},...,o^{i}_{h_{i}})\}_{i=1}^{N}
\phi
\{o^{i}_{t},...,o^{i}_{k},o^{i}_{k+1},...,o^{i}_{T}\}_{i=1}^{B}\sim D,t\in[1,h%
_{i}-1],t\leq k<T,T\in(t,h_{i}],\forall i
\mathcal{L}(\phi):=\frac{1-\gamma}{B}\sum_{i=1}^{B}\left[\left\lVert\phi(o^{i}%
_{t})-\phi(o^{i}_{T})\right\rVert_{2}\right]+\log\frac{1}{B}\sum_{i=1}^{B}%
\left[\mathrm{exp}\left(\left\lVert\phi(o^{i}_{k})-\phi(o^{i}_{T})\right\rVert%
_{2}-\tilde{\delta}_{o^{i}_{T}}(o^{i}_{k})-\gamma\left\lVert\phi(o^{i}_{k+1})-%
\phi(o^{i}_{T})\right\rVert_{2}\right)\right]
\phi
\phi\leftarrow\phi-\alpha_{\phi}\nabla\mathcal{L}(\phi)
L_{1}
32
L_{2}
R^{2}=\textbf{0.95}
\phi
\mathcal{L}(\pi)=-\mathbb{E}_{D_{\mathrm{task}}(o,a,o^{\prime},g)}\left[%
\mathrm{exp}(\tau\cdot R(o,o^{\prime};\phi,g))\log\pi(a\mid\phi(o))\right],
R
\tau
D_{\mathrm{task}}
\sim 20
D_{\mathrm{task}}
D_{\mathrm{task}}
\pm
\pm
\pm
\pm
\pm
\pm
0^{*}
\pm
\pm
\pm
\pm
\pm
\pm
0^{*}
\pm
0^{*}
\pm
\pm
\pm
\pm
\pm
\pm
0^{*}
\pm
0^{*}
\pm
\pm
\pm
\pm
\pm
\pm
0^{*}
\pm
0^{*}
\pm
*
D_{\mathrm{task}}
1
\frac{\lvert\mathrm{VIP}\rvert-\lvert\mathrm{R3M}\rvert}{\lvert\mathrm{R3M}\rvert}
\approx
\approx
f
\mathcal{M}=(O,A,G,r,T,\mu_{0},\gamma)
O
A
r(o,g)
o^{\prime}\sim T(o,a)
p(g)
\mu_{0}(o;g)
\gamma\in(0,1]
O
G
\pi:O\times G\rightarrow\Delta(A)
J(\pi):=\mathbb{E}_{p(g),\mu_{0}(o;g),\pi(a_{t}\mid s_{t},g),T(o_{t+1},\mid o_%
{t},a_{t})}\left[\sum_{t=0}^{\infty}\gamma^{t}r(o_{t};g)\right]
d^{\pi}(o,a;g):O\times A\times G\rightarrow[0,1]
\pi
\begin{split}d^{\pi}(o,a;g):=(1-\gamma)\sum_{t=0}^{\infty}\gamma^{t}\mathrm{Pr%
}(o_{t}=o,a_{t}=a\mid o_{0}\sim\mu_{0}(o;g),a_{t}\sim\pi(o_{t};g),o_{t+1}\sim T%
(o_{t},a_{t}))\end{split}
\pi
d^{\pi}(o;g)=\sum_{a}d^{\pi}(o,a;g)
\pi(a\mid o,g)=\frac{d^{\pi}(o,a;g)}{d^{\pi}(o;g)}
\pi
\sum_{a}d(o,a;g)=(1-\gamma)\mu_{0}(o;g)+\gamma\sum_{\tilde{o},\tilde{a}}T(s%
\mid\tilde{o},\tilde{a})d(\tilde{o},\tilde{a};g),\qquad\forall o\in O,g\in G
d^{\pi}(o,g)=p(g)d^{\pi}(o;g)
p(g)
\pi
d^{\pi}
J(\pi)=\frac{1}{1-\gamma}\mathbb{E}_{(o,g)\sim d^{\pi}(o,g)}[r(o,g)]
x
x_{\mathrm{pos}}
x_{\mathrm{neg}}
\min_{\phi}\mathbb{E}_{x_{\mathrm{pos}}}\left[-\log\frac{\mathcal{S}_{\phi}(x,%
x_{\mathrm{pos}})}{\mathbb{E}_{x_{\mathrm{neg}}}\mathcal{S}_{\phi}(x,x_{%
\mathrm{neg}})}\right],
\mathbb{E}_{x_{\mathrm{neg}}}
\mathcal{I}(x,x_{\mathrm{pos}})
x
x_{\mathrm{pos}}
(o_{t_{1}},o_{t_{2}},o_{t_{3}})
t_{1}<t_{2}<t_{3}
o_{t_{1}}
o_{t_{2}}
o_{t_{3}}
o_{t_{1}}
\min_{\phi}\mathbb{E}_{(o_{t_{1}},o_{t_{2}>t_{1}})\sim D}\left[-\log\frac{e^{-%
\left\lVert\phi(o_{t_{1}})-\phi(o_{t_{2}})\right\rVert_{2}}}{\mathbb{E}_{o_{t_%
{3}}\mid t_{3}>t_{2}\sim D}\left[\mathrm{exp}\left(-\left\lVert\phi(o_{t_{1}})%
-\phi(o_{t_{3}})\right\rVert_{2}\right)\right]}\right]
K
\min_{\phi}\frac{1}{K}\sum_{k=1}^{K}\mathbb{E}_{(o_{t_{1}},o_{t_{1}+k})\sim D}%
\left[-\log\frac{\mathcal{S}_{\phi}(o_{t_{1}};o_{t_{1}+k})}{\mathbb{E}_{o_{t_{%
3}}\mid t_{3}>t_{1}+k\sim D}\left[\mathcal{S}_{\phi}(o_{t_{1}};o_{t_{3}})%
\right]}\right],
\max_{\pi_{H},\phi}\mathbb{E}_{\pi^{H}}\left[\sum_{t}\gamma^{t}r(o;g)\right]-D%
_{\mathrm{KL}}(d^{\pi_{H}}(o,a^{H};g)\|d^{D}(o,\tilde{a}^{H};g)),
\max_{\phi}\min_{V}\mathbb{E}_{p(g)}\left[(1-\gamma)\mathbb{E}_{\mu_{0}(o;g)}[%
V(\phi(o);\phi(g))]+\log\mathbb{E}_{D(o,o^{\prime};g)}\left[\mathrm{exp}\left(%
r(o,g)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(o),\phi(g))\right)\right]%
\right],
\mu_{0}(o;g)
D(o,o^{\prime};g)
D
H
\begin{split}&\max_{\phi}\max_{d(\phi(o),a;\phi(g))\geq 0}\mathbb{E}_{d(\phi(o%
),\phi(g))}\left[r(o;g)\right]-D_{\mathrm{KL}}(d(\phi(o),a;\phi(g))\|d^{D}(%
\phi(o),\tilde{a};\phi(g)))\\
(\mathrm{P})&\quad\mathrm{s.t.}\quad\sum_{a}d(\phi(o),a;\phi(g))=(1-\gamma)\mu%
_{0}(o;g)+\gamma\sum_{\tilde{o},\tilde{a}}T(o\mid\tilde{o},\tilde{a})d(\phi(%
\tilde{o}),\tilde{a};\phi(g)),\forall o\in O,g\in G\end{split}
\phi
\phi
\displaystyle\max_{\phi}\min_{V}\mathbb{E}_{p(g)}\big{[}(1-\gamma)\mathbb{E}_{%
\mu_{0}(o;g)}[V(\phi(o);\phi(g))]
\displaystyle\max_{\phi}\min_{V}
\displaystyle\mathbb{E}_{p(g)}\big{[}(1-\gamma)\mathbb{E}_{\mu_{0}(o;g)}[V(%
\phi(o);\phi(g))]
\displaystyle(\mathrm{D})\quad\quad+\log\mathbb{E}_{d^{D}(\phi(o),a;\phi(g))}%
\big{[}\mathrm{exp}\big{(}r(o,g)+\gamma\mathbb{E}_{T(o^{\prime}\mid o,a)}[V(%
\phi(o^{\prime});\phi(g))]-V(\phi(o),\phi(g))\big{)}\big{]}\big{]}
\displaystyle(\mathrm{D})\quad\quad+
\displaystyle\log\mathbb{E}_{d^{D}(\phi(o),a;\phi(g))}\big{[}\mathrm{exp}\big{%
(}r(o,g)+\gamma\mathbb{E}_{T(o^{\prime}\mid o,a)}[V(\phi(o^{\prime});\phi(g))]%
-V(\phi(o),\phi(g))\big{)}\big{]}\big{]}
\mathbb{E}_{T(o^{\prime}\mid o,a)}
\displaystyle\max_{\phi}\min_{V}\mathbb{E}_{p(g)}\big{[}(1-\gamma)\mathbb{E}_{%
\mu_{0}(o;g)}[V(\phi(o);\phi(g))]
\displaystyle\max_{\phi}\min_{V}
\displaystyle\mathbb{E}_{p(g)}\big{[}(1-\gamma)\mathbb{E}_{\mu_{0}(o;g)}[V(%
\phi(o);\phi(g))]
\displaystyle+\log\mathbb{E}_{d^{D}(\phi(o),\phi(o^{\prime});\phi(g))}\big{[}%
\mathrm{exp}\big{(}r(o,g)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(o),\phi(g)%
)\big{)}\big{]}\big{]}
\displaystyle+
\displaystyle\log\mathbb{E}_{d^{D}(\phi(o),\phi(o^{\prime});\phi(g))}\big{[}%
\mathrm{exp}\big{(}r(o,g)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(o),\phi(g)%
)\big{)}\big{]}\big{]}
d^{D}(\phi(o),\phi(o^{\prime});\phi(g))
D(o,o^{\prime};g)
\phi(o)\neq\phi(o^{\prime}),\forall o\neq o^{\prime}
\phi
\max_{\phi}\min_{V}\mathbb{E}_{p(g)}\big{[}(1-\gamma)\mathbb{E}_{\mu_{0}(o;g)}%
[V(\phi(o);\phi(g))]+\log\mathbb{E}_{D(o,o^{\prime};g)}\big{[}\mathrm{exp}\big%
{(}r(o,g)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(o),\phi(g))\big{)}\big{]}%
\big{]}
\min_{\phi}\mathbb{E}_{p(g)}\left[(1-\gamma)\mathbb{E}_{\mu_{0}(o;g)}[-V^{*}(%
\phi(o);\phi(g))]+\log\mathbb{E}_{D(o,o^{\prime};g)}\left[\mathrm{exp}\left(%
\tilde{\delta}_{g}(o)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(o),\phi(g))%
\right)\right]^{-1}\right].
\min_{\phi}\mathbb{E}_{p(g)}\left[(1-\gamma)\mathbb{E}_{\mu_{0}(o;g)}[-\log e^%
{V^{*}(\phi(o);\phi(g))}]+\log\mathbb{E}_{D(o,o^{\prime};g)}\left[\mathrm{exp}%
\left(\tilde{\delta}_{g}(o)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(o),\phi(%
g))\right)\right]^{-1}\right]
\begin{aligned} &\min_{\phi}\mathbb{E}_{p(g)}\left[(1-\gamma)\mathbb{E}_{\mu_{%
0}(o;g)}\left[-\log e^{V^{*}(\phi(o);\phi(g))}-\log\mathbb{E}_{D(o,o^{\prime};%
g)}\left[\mathrm{exp}\left(\tilde{\delta}_{g}(o)+\gamma V(\phi(o^{\prime});%
\phi(g))-V(\phi(o),\phi(g))\right)\right]^{\frac{-1}{1-\gamma}}\right]\right]%
\\
=&\min_{\phi}(1-\gamma)\mathbb{E}_{p(g),\mu_{0}(o;g)}\left[\log\frac{e^{-V^{*}%
(\phi(o);\phi(g))}}{\mathbb{E}_{D(o,o^{\prime};g)}\left[\mathrm{exp}\left(%
\tilde{\delta}_{g}(o)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(o),\phi(g))%
\right)\right]^{\frac{-1}{1-\gamma}}}\right]\end{aligned}
V^{*}(s;g):=-\left\lVert\phi(s)-\phi(g)\right\rVert_{2}
\phi
(s_{t},s_{t+1})\sim\pi^{*}
\left\lVert\phi(s_{t})-\phi(g)\right\rVert_{2}>\left\lVert\phi(s_{t+1})-\phi(g%
)\right\rVert_{2},
V^{*}(s;g)=\max_{a}Q^{*}(s,a;g)
Q^{*}(s,a;g)=r(s,g)+\gamma\mathbb{E}_{s^{\prime}\sim T(s,a)}\max_{a^{\prime}}Q%
^{*}(s^{\prime},a^{\prime};g)
Q^{*}(s,a;g)=r(s,g)+\gamma V^{*}(s^{\prime};g)
(s_{t},a_{t},s_{t+1})\sim\pi^{*}
V^{*}(s_{t};g)=r(s_{t},g)+\gamma V^{*}(s_{t+1};g)
V^{*}
r(s_{t},g)=\mathbb{I}(s_{t}=g)-1
V^{*}(s_{t};g)
s_{t}
g
V^{*}(g;g)=0
V^{*}(s_{t};g)=-\sum_{k=0}^{K}\gamma^{k}
\pi^{*}
s_{t}
g
K
V^{*}(s_{t};g)
-\left\lVert\phi(s_{t})-\phi(g)\right\rVert_{2}
\phi
\left\lVert\phi(s_{t})-\phi(g)\right\rVert_{2}>\left\lVert\phi(s_{t+1})-\phi(g%
)\right\rVert_{2},\quad\forall(s_{t},s_{t+1})\sim\pi^{*}
224\times 224\times 3
\{o^{i}_{t},...,o^{i}_{k},o^{i}_{k+1},...,o^{i}_{T}\}
3
(\tilde{o}_{j},\tilde{o}_{j+1})
\mathcal{L}(\phi)
L_{1}
L_{1}
\gamma
2
12
S_{\phi}(\phi(o_{T});\phi(g))
L_{2}
D_{\mathrm{task}}
[256,256]
\tau=0.1
\tau=1
\min_{\phi}\mathbb{E}_{(o,o^{\prime},g)\sim D}\left[\left(\tilde{\delta}_{g}(o%
)+\gamma V(\phi(o^{\prime});\phi(g))-V(\phi(s),\phi(g))\right)^{2}\right],
V
L_{2}
()
E
I
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
o
g
g
o
V(o;g)
