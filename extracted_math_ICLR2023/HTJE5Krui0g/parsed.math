\mathbf{x}
\mathbf{y}
\mathcal{M}_{\bm{\theta}}
\mathbf{z}
\mathcal{M}_{\bm{\theta}}
\mathbf{z}
\mathbf{x}
\mathbf{z}
\mathbf{z}
\mathbf{y}
\mathbf{z}
\mathbf{x}
\mathbf{y}
\mathbf{x}
\mathbf{y}
\mathcal{M}_{\bm{\theta}}
\mathbf{z}
\mathcal{M}_{\bm{\theta}}
\mathbf{z}
\mathbf{x}
\mathbf{z}
\mathbf{z}
\mathbf{y}
\mathbf{z}
\mathbf{x}
\mathbf{y}
\mathcal{X}
\mathcal{Z}
\bm{\theta}
\mathbf{x}\in\mathcal{X}
\mathbf{z}\in\mathcal{Z}
P_{\bm{\theta}}(\mathbf{z}|\mathbf{x})
\mathbf{z}
\mathbf{y}
\mathbf{x}
\mathbf{y}
\mathbf{y}
\mathcal{S}_{\mathbf{y}}
\mathbf{z}
\mathbf{z}\in\mathcal{S}_{\mathbf{y}}
h\colon\mathcal{X}\to\mathcal{Z}
h
\{(\mathbf{x}^{i},\mathbf{y}^{i})\}_{i=1,\dots,N}
\min_{h}\left\{\min_{\bm{\theta}}\ell(\bm{\theta}):=-\sum_{i=1}^{N}\log P_{\bm%
{\theta}}(\mathbf{z}^{i}|\mathbf{x}^{i})\right\}\quad\text{s.t.}\quad\mathbf{z%
}^{i}=h(\mathbf{x}^{i})\in\mathcal{S}_{\mathbf{y}^{i}},i=1,\dots,N.
\mathbf{y}
\min_{\bm{\theta}}\left\{\min_{h}\ell(\bm{\theta}):=-\sum_{i=1}^{N}\log P_{\bm%
{\theta}}(\mathbf{z}^{i}|\mathbf{x}^{i})\quad\text{s.t.}\quad\mathbf{z}^{i}=h(%
\mathbf{x}^{i})\in\mathcal{S}_{\mathbf{y}^{i}},i=1,\dots,N\right\}.
h
h
h
h
h
\mathbf{x}
Q_{\bm{\phi}}
\mathcal{S}_{\mathbf{y}}
\bm{\phi}
\displaystyle\min_{\bm{\theta},\bm{\phi}}
\displaystyle\min_{\bm{\theta},\bm{\phi}}
\displaystyle\ell(\bm{\theta},\bm{\phi}):=-\sum_{i=1}^{N}\sum_{\mathbf{z}^{i}%
\in\mathcal{S}_{\mathbf{y}^{i}}}Q^{i}_{\bm{\phi}}(\mathbf{z}^{i})\log P_{\bm{%
\theta}}(\mathbf{z}^{i}|\mathbf{x}^{i})+\gamma Q^{i}_{\bm{\phi}}(\mathbf{z}^{i%
})\log Q^{i}_{\bm{\phi}}(\mathbf{z}^{i})
\displaystyle\ell(\bm{\theta},\bm{\phi}):=-\sum_{i=1}^{N}\sum_{\mathbf{z}^{i}%
\in\mathcal{S}_{\mathbf{y}^{i}}}Q^{i}_{\bm{\phi}}(\mathbf{z}^{i})\log P_{\bm{%
\theta}}(\mathbf{z}^{i}|\mathbf{x}^{i})+\gamma Q^{i}_{\bm{\phi}}(\mathbf{z}^{i%
})\log Q^{i}_{\bm{\phi}}(\mathbf{z}^{i})
\displaystyle\mathrm{supp}(Q^{i}_{\bm{\phi}})\subseteq\mathcal{S}_{\mathbf{y}^%
{i}},\quad i=1,\dots,N,
\displaystyle\mathrm{supp}(Q^{i}_{\bm{\phi}})\subseteq\mathcal{S}_{\mathbf{y}^%
{i}},\quad i=1,\dots,N,
\mathrm{supp}(Q_{\bm{\phi}})
Q_{\bm{\phi}}
\sum_{\mathbf{z}\in\mathcal{S}_{\mathbf{y}}}Q_{\bm{\phi}}(\mathbf{z})\log Q_{%
\bm{\phi}}(\mathbf{z})
Q_{\bm{\phi}}
\gamma
h
\gamma=1
P_{\bm{\theta}}
Q_{\bm{\phi}}
\gamma\to+\infty
Q_{\bm{\phi}}
P_{\bm{\theta}}
\mathcal{S}_{\mathbf{y}}
\gamma\to 0
Q_{\bm{\phi}}
h
h
Q_{\bm{\phi}}
\mathbf{x}
\mathbf{z}
\mathcal{S}_{\mathbf{y}}
Q_{\bm{\phi}}
\min_{\bm{\theta},\bm{\phi}}~{}\ell(\bm{\theta},\bm{\phi}):=\sum_{\mathbf{z}%
\in\mathcal{S}_{\mathbf{y}}}Q_{\bm{\phi}}(\mathbf{z})\log P_{\bm{\theta}}(%
\mathbf{z}|\mathbf{x})+\gamma Q_{\bm{\phi}}(\mathbf{z})\log Q_{\bm{\phi}}(%
\mathbf{z}),\quad\mathrm{supp}(Q_{\bm{\phi}})\subseteq\mathcal{S}_{\mathbf{y}}.
\bm{\theta}
\bm{\phi}
\bm{\theta}
\bm{\phi}
\bm{\theta}_{k+1}=\bm{\theta}_{k}-\eta\nabla_{\bm{\theta}}\ell(\bm{\theta}_{k}%
,\bm{\phi}_{k}),\quad\bm{\phi}_{k+1}=\mathop{\arg\min}_{\bm{\phi}\mid\mathrm{%
supp}(Q_{\bm{\phi}})}\ell(\bm{\theta}_{k+1},\bm{\phi}).
Q_{\bm{\phi}^{*}}
P_{\bm{\theta}}
\bm{\theta}
\min_{\bm{\phi}}\ell(\bm{\theta},\bm{\phi})
Q_{\bm{\phi}^{*}}(\mathbf{z})=\begin{cases}{P_{\bm{\theta}}(\mathbf{z}|\mathbf%
{x})^{\frac{1}{\gamma}}}/{\sum_{\mathbf{z}^{\prime}\in\mathcal{S}_{\mathbf{y}}%
}P_{\bm{\theta}}(\mathbf{z}^{\prime}|\mathbf{x})^{\frac{1}{\gamma}}},&\text{if%
}~{}~{}\mathbf{z}\in\mathcal{S}_{\mathbf{y}},\\
0,&\text{otherwise.}\end{cases}
Q_{\bm{\phi}^{*}}
\ell(\bm{\theta},\bm{\phi}^{*})
\nabla_{\bm{\theta}}\ell(\bm{\theta},\bm{\phi}^{*})
Q_{\bm{\phi}^{*}}
Q_{\bm{\phi}^{*}}
\mathcal{S}_{\mathbf{y}}
\mathcal{Z}
\mathbf{z}\notin\mathcal{S}_{\mathbf{y}}
\mathbf{z}
\mathcal{S}_{\mathbf{y}}
\mathbf{z}
\mathcal{Z}
\mathcal{S}_{\mathbf{y}}
\mathbf{z}
\mathbf{z}^{\prime}
\tau=\frac{Q_{\bm{\phi}^{*}}(\mathbf{z}^{\prime})}{Q_{\bm{\phi}^{*}}(\mathbf{z%
})}=\left(\frac{P_{\bm{\theta}}(\mathbf{z}^{\prime}|\mathbf{x})}{P_{\bm{\theta%
}}(\mathbf{z}|\mathbf{x})}\right)^{\frac{1}{\gamma}}.
\mathbf{z}
\mathbf{z}
\mathbf{z}^{\prime}
\Pi([\mathbf{z}_{1};\dots;\mathbf{z}_{7}])=[\mathbf{z}_{2};\dots;\mathbf{z}_{6}]
\mathbf{z}=[4;\times;9;+;3;+;3]
\Pi(\mathbf{z})=[\times;9;+;3;+;]
\times
+
+
=
\Pi(\mathbf{z}^{\prime})=[\times;8;+;3;+;]
\Pi([\mathbf{z}_{1};\dots;\mathbf{z}_{7}])=[\mathbf{z}_{2};\dots;\mathbf{z}_{6}]
\mathbf{z}=[4;\times;9;+;3;+;3]
\Pi(\mathbf{z})=[\times;9;+;3;+;]
\times
+
+
=
\Pi(\mathbf{z}^{\prime})=[\times;8;+;3;+;]
\Pi(\cdot)\colon\mathcal{Z}\to\Omega
\mathcal{Z}
\Omega
\Omega
\mathcal{S}_{\mathbf{y}}
\times
+
+
=
\mathbf{z}
\mathbf{z}^{\prime}
\times
+
+
\Omega
\mathbf{z}
Q_{\bm{\phi}^{*}}
\mathbf{z}
Q_{\bm{\phi}^{*}}
\gamma
\mathbf{z}\in\mathcal{S}_{\mathbf{y}}
(\mathbf{x},\mathbf{y})
k=0,1,\dots,K
(\mathbf{x},\mathbf{y})
\{(\mathbf{x}_{i},\mathbf{y}_{i})\}_{i=1}^{N}
t=0,1,\dots,T
\bm{u}=\Pi(\mathbf{z})\in\Omega
\bm{u}^{\prime}
\bm{u}
\mathbf{z}^{\prime}=\Pi^{-1}(\bm{u}^{\prime})
\tau=(P_{\bm{\theta}}(\mathbf{z}^{\prime}|\mathbf{x})/P_{\bm{\theta}}(\mathbf{%
z}|\mathbf{x}))^{1/\gamma}
\nu\in[0,1]
\mathbf{z}
\mathbf{z}^{\prime}
\nu\leq\tau
\hat{\nabla}\ell(\bm{\theta})=-\nabla_{\bm{\theta}}\log P_{\bm{\theta}}(%
\mathbf{z}|\mathbf{x})
\bm{\theta}
\gamma
\hat{\nabla}\ell(\bm{\theta})
\bm{\theta}
\ell(\bm{\theta})
L
\ell
\widehat{Q}
d_{\text{tv}}(\widehat{Q},Q^{*})
\epsilon
K
\eta=\alpha/(\sqrt{T+1})
\frac{1}{K}\sum_{k=1}^{K}\|\nabla\ell(\bm{\theta}_{k})\|^{2}\leq\mathcal{O}%
\left(\frac{\ell\sigma^{2}+\Delta_{0}}{\alpha\sqrt{T+1}}\right)+(n\epsilon L)^%
{2},
\Delta_{0}=\ell(\bm{\theta}_{0})-\min\ell(\bm{\theta})
n
\mathrm{supp}(Q^{*})
\gamma
Q^{*}
\hat{\ell}(\bm{\theta}):=-\sum_{i=1}^{N}\sum_{\mathbf{z}^{i}\in\mathcal{S}_{%
\mathbf{y}}^{i}}\log P_{\bm{\theta}}(\mathbf{z}^{i}|\mathbf{x}^{i}),
\gamma
\gamma=1
\hat{\ell}
Q
\gamma
\gamma
\bm{\phi}^{*}_{\mathbf{z}}=-\log P_{\bm{\theta}}(\mathbf{z}|\mathbf{x})
\mathbf{z}
Q_{\bm{\phi}^{*}}(\mathbf{z})=\frac{\exp(-\bm{\phi}^{*}_{\mathbf{z}}/\gamma)}{%
\sum_{\mathbf{z}^{\prime}\in\mathcal{S}_{\mathbf{y}}}\exp(-\bm{\phi}^{*}_{%
\mathbf{z}}/\gamma)}.
\bm{\phi}^{*}_{\mathbf{z}}
\mathbf{z}
\gamma
\gamma
\gamma_{t}=\gamma_{0}/{\log(1+t)}
\gamma_{t}=\gamma_{0}\alpha^{t}
\gamma_{t}=\gamma_{0}-\alpha t
\gamma=0
Q_{\bm{\phi}^{*}}
\gamma=0
\gamma
\gamma=0
\sim
+
-
\times
\div
\gamma=0.001
\Pi(\mathbf{z}_{1};\dots;\mathbf{z}_{7})=[\mathbf{z}_{1};\mathbf{z}_{2};%
\mathbf{z}_{4};\mathbf{z}_{6};\mathbf{z}_{7}]
\gamma_{0}=1.0
\begin{array}[]{|c|c|c|c|}\hline\cr 2&4&3&1\\
\hline\cr 3&1&4&2\\
\hline\cr 4&2&1&3\\
\hline\cr 1&3&2&4\\
\hline\cr\end{array}\xrightarrow{\text{Projection}}\begin{array}[]{|c|c|c|c|}%
\hline\cr 2&4&&\\
\hline\cr 3&1&&\\
\hline\cr&&1&3\\
\hline\cr&&2&4\\
\hline\cr\end{array}\xrightarrow{\begin{subarray}{c}\text{Random}\\
\text{walk}\end{subarray}}\begin{array}[]{|c|c|c|c|}\hline\cr 2&4&&\\
\hline\cr 3&1&&\\
\hline\cr&&3&1\\
\hline\cr&&2&4\\
\hline\cr\end{array}\xrightarrow{\begin{subarray}{c}\text{Inverse}\\
\text{projection}\end{subarray}}\begin{array}[]{|c|c|c|c|}\hline\cr 2&4&1&3\\
\hline\cr 3&1&4&2\\
\hline\cr 4&2&3&1\\
\hline\cr 1&3&2&4\\
\hline\cr\end{array}
A^{*}
{d}(n)=g(n)+f_{\bm{\theta}}(n)
n
g(n)
n
f_{\bm{\theta}}(n)
n
30
\{1,2,\dots,9\}
\mathbf{z}
\mathbf{z}\sim\mathcal{N}(f_{\bm{\theta}}(\mathbf{x}),\sigma^{2}\mathbf{I})
f_{\bm{\theta}}(\mathbf{x})
\mathbf{z}
[\mathbf{z}_{5},\mathbf{z}_{10},\mathbf{z}_{15},\mathbf{z}_{20},\mathbf{z}_{25}]
\mathbf{z}
[-5,5]
\ell(\bm{\theta})=\mathbb{E}_{\bm{z}\sim Q^{*}}\log P_{\bm{\theta}}(\mathbf{z}%
|\mathbf{x})
\widehat{Q}
Q^{*}
m(\bm{\theta})
m(\bm{\theta})=\mathbb{E}_{\bm{z}\sim\widehat{Q}}\nabla\log P_{\bm{\theta}}(%
\mathbf{z}|\mathbf{x})-\mathbb{E}_{\bm{z}\sim Q^{*}}\nabla\log P_{\bm{\theta}}%
(\mathbf{z}|\mathbf{x})=\sum_{\mathbf{z}\in\mathcal{S}_{\mathbf{y}}}\left(%
\widehat{Q}(\mathbf{z})-Q^{*}(\mathbf{z})\right)\nabla\log P_{\bm{\theta}}(%
\mathbf{z}|\mathbf{x}).
\mathrm{supp}(\widehat{Q})\subseteq\mathrm{supp}(Q^{*})\subseteq\mathcal{S}_{%
\mathbf{y}}.
\displaystyle\|m(\bm{\theta})\|^{2}=\|\sum_{\mathbf{z}\in\mathcal{S}_{\mathbf{%
y}}}(\widehat{Q}(\mathbf{z})-Q^{*}(\mathbf{z}))\nabla\log P_{\bm{\theta}}(%
\mathbf{z}|\mathbf{x})\|^{2}
\displaystyle\|m(\bm{\theta})\|^{2}
\displaystyle=\|\sum_{\mathbf{z}\in\mathcal{S}_{\mathbf{y}}}(\widehat{Q}(%
\mathbf{z})-Q^{*}(\mathbf{z}))\nabla\log P_{\bm{\theta}}(\mathbf{z}|\mathbf{x}%
)\|^{2}
\displaystyle\leq\sum_{\mathbf{z}\in\mathcal{S}_{Q^{*}}}(\widehat{Q}(\mathbf{z%
})-Q^{*}(\mathbf{z}))^{2}\cdot\sum_{\mathbf{z}\in\mathcal{S}_{Q^{*}}}\|\nabla%
\log P_{\bm{\theta}}(\mathbf{z}|\mathbf{x})\|^{2}\leq(n\epsilon L)^{2},
\displaystyle\leq\sum_{\mathbf{z}\in\mathcal{S}_{Q^{*}}}(\widehat{Q}(\mathbf{z%
})-Q^{*}(\mathbf{z}))^{2}\cdot\sum_{\mathbf{z}\in\mathcal{S}_{Q^{*}}}\|\nabla%
\log P_{\bm{\theta}}(\mathbf{z}|\mathbf{x})\|^{2}\leq(n\epsilon L)^{2},
\mathcal{S}_{Q^{*}}
Q^{*}
n
\frac{1}{K}\sum_{k=1}^{K}\|\nabla\ell(\bm{\theta}_{k})\|^{2}\leq\mathcal{O}%
\left(\frac{\ell\sigma^{2}+\Delta_{0}}{\alpha\sqrt{T+1}}\right)+(n\epsilon L)^%
{2},
\sigma^{2}
\hat{\ell}(\bm{\theta}):=-\log\sum_{\mathbf{z}\in\mathcal{S}_{\mathbf{y}}}P_{%
\bm{\theta}}(\mathbf{z}|\mathbf{x})
\nabla\hat{\ell}(\bm{\theta})
\displaystyle\nabla\hat{\ell}(\bm{\theta})=-\sum_{\mathbf{z}\in\mathcal{S}(%
\mathbf{y})}\frac{1}{\sum_{\mathbf{z}^{\prime}\in\mathcal{S}(\mathbf{y})}P_{%
\bm{\theta}}(\mathbf{z}^{\prime}|\mathbf{x})}\nabla P_{\bm{\theta}}(\mathbf{z}%
|\mathbf{x}),
\displaystyle\nabla\hat{\ell}(\bm{\theta})
\displaystyle=-\sum_{\mathbf{z}\in\mathcal{S}(\mathbf{y})}\frac{1}{\sum_{%
\mathbf{z}^{\prime}\in\mathcal{S}(\mathbf{y})}P_{\bm{\theta}}(\mathbf{z}^{%
\prime}|\mathbf{x})}\nabla P_{\bm{\theta}}(\mathbf{z}|\mathbf{x}),
\displaystyle=-\sum_{\mathbf{z}\in\mathcal{S}(\mathbf{y})}\frac{P_{\bm{\theta}%
}(\mathbf{z}|\mathbf{x})}{\sum_{\mathbf{z}^{\prime}\in\mathcal{S}(\mathbf{y})}%
P_{\bm{\theta}}(\mathbf{z}^{\prime}|\mathbf{x})}\nabla\log P_{\bm{\theta}}(%
\mathbf{z}|\mathbf{x}),
\displaystyle=-\sum_{\mathbf{z}\in\mathcal{S}(\mathbf{y})}\frac{P_{\bm{\theta}%
}(\mathbf{z}|\mathbf{x})}{\sum_{\mathbf{z}^{\prime}\in\mathcal{S}(\mathbf{y})}%
P_{\bm{\theta}}(\mathbf{z}^{\prime}|\mathbf{x})}\nabla\log P_{\bm{\theta}}(%
\mathbf{z}|\mathbf{x}),
\gamma=1
\mathbf{z}\in\mathcal{S}(\mathbf{y})
Q_{\bm{\phi}^{*}}
Q_{\bm{\phi}^{*}}(\mathbf{z})=\frac{P_{\bm{\theta}}(\mathbf{z}|\mathbf{x})}{%
\sum_{\mathbf{z}^{\prime}\in\mathcal{S}(\mathbf{y})}P_{\bm{\theta}}(\mathbf{z}%
^{\prime}|\mathbf{x})}.
\nabla_{\bm{\theta}}\ell(\bm{\theta},\bm{\phi}^{*})
\nabla\ell(\bm{\theta})=-\sum_{\mathbf{z}\in\mathcal{S}_{\mathbf{y}}}Q_{\bm{%
\phi^{*}}}(\mathbf{z})\nabla\log P_{\bm{\theta}}(\mathbf{z}|\mathbf{x}).
Q_{\bm{\phi}^{*}}
\min_{\bm{\phi}}\ell(\bm{\theta},\bm{\phi})
\gamma=1
\mathcal{L}(\bm{\phi};\lambda)=\sum_{\mathbf{z}\in\mathcal{S}_{\mathbf{y}}}Q_{%
\bm{\phi}}(\mathbf{z})\log\left(\frac{Q_{\bm{\phi}}(\mathbf{z})}{P_{\bm{\theta%
}}(\mathbf{z})}\right)-\lambda\Big{(}\sum_{\mathbf{z}\in\mathcal{S}_{\mathbf{y%
}}}Q_{\bm{\phi}}(\mathbf{z})-1\Big{)}.
Q_{\bm{\phi}}(\mathbf{z})
\log Q_{\phi^{*}}(\mathbf{z})+1-\log P_{\bm{\theta}}(\mathbf{z})-\lambda=0
\mathbf{z}\in\mathcal{S}_{\mathbf{y}}
Q_{\bm{\phi^{*}}}(\mathbf{z})=e^{\lambda-1}P_{\bm{\theta}}(\mathbf{z}),\quad%
\sum_{\mathbf{z}\in\mathcal{S}_{\mathbf{y}}}e^{\lambda-1}P_{\bm{\theta}}(%
\mathbf{z})=1.
Q_{\bm{\phi^{*}}}(\mathbf{z})=\frac{P_{\bm{\theta}}(\mathbf{z})}{\sum_{\mathbf%
{z}^{\prime}\in\mathcal{S}_{\mathbf{y}}}P_{\bm{\theta}}(\mathbf{z}^{\prime})},
\gamma
\gamma
\gamma
Q_{\bm{\phi}*}
Q_{\bm{\phi}*}
\gamma_{0}=1
\Omega
\mathrm{dim}(\Omega)
\mathrm{dim}(\Omega)
\mathrm{dim}(\Omega)
\Omega
\mathrm{dim}(\Omega)
\times
T=10
\gamma
0.001
