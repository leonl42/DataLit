k
k
900
1000
37.9\%
86.7\%
k
k
\S
\mathcal{X}=(e_{1},e_{2},\dots,e_{n})
\mathcal{X}\in{\rm I\!R}^{n\times d_{e}}
e_{i}\in{\rm I\!R}^{d_{e}}
d_{e}
\mathcal{E}:{\rm I\!R}^{n\times d_{e}}\rightarrow{\rm I\!R}^{d_{h}}
o=\mathcal{E}(\mathcal{X})
o\in{\rm I\!R}^{d_{h}}
d_{h}
R
R
a_{1}\in{\rm I\!R}^{d_{a_{1}}}
a_{2}\in{\rm I\!R}^{d_{a_{2}}}
v=R(a_{1},a_{2})
R:{\rm I\!R}^{d_{a_{1}}}\times{\rm I\!R}^{d_{a_{2}}}\rightarrow{\rm I\!R}^{d_{%
v}}
d_{a_{1}}=d_{a_{2}}=d_{v}=d_{h}
\mathcal{X}
(2+4\times 4+3)
2
4
+
\in{\rm I\!R}^{d_{h}}
o=R(R(R(R(R(R(R(h0,2),+),4),\times),4),+),3)
h0
o=R(R(R(R(2,+),R(R(4,\times),4)),+),3)
\mathcal{E}
v=R(a_{1},a_{2})
v
a_{1}
a_{2}
2+
4\times 4
score:{\rm I\!R}^{d_{h}}\rightarrow{\rm I\!R}^{1}
v=R(a_{1},a_{2})
score(v)
a_{1}
a_{2}
score(v)=vW_{v}
W_{v}\in{\rm I\!R}^{d_{h}\times 1}
v\in{\rm I\!R}^{d_{h}}
(h_{1},h_{2},\dots,h_{n})
(R(h_{1},h_{2}),R(h_{2},h_{3}),\dots,R(h_{n-1},h_{n}))
score(R(h_{i},h_{i+1}))\geq score(R(h_{j},h_{j+1}))\;\forall j\in\{1,2,\dots,n\}
R(h_{i},h_{i+1})
R(h_{i},h_{i+1})
h_{i}
h_{i+1}
(h_{1},\dots,h_{i-1},R(h_{i},h_{i+1}),h_{i+2},\dots,h_{n})
k
\S
k
k
score
\S
k
(o_{1},o_{2},\dots,o_{k})
o_{i}\in{\rm I\!R}^{d_{h}}
(s_{1},s_{2},\dots,s_{k})
s_{i}\in{\rm I\!R}^{1}
\sum_{i=1}^{k}\left(\frac{exp(s_{i})\cdot o_{i}}{\sum_{i=1}^{k}exp(s_{i})}\right)
k
k
m=4
k=3
k
m=4
k=3
k
k
k
k
k
k
k
k
k
k
k
k
k
k
k
k
k
k
k
m
k
k
k\leq m
k
m-k
P\in{\rm I\!R}^{m\times m}
P_{ij}
i^{th}
j^{th}
P
k
\S
\S
k
m
m
H=(\mathcal{H}_{1},\dots,\mathcal{H}_{m})
\mathcal{H}_{i}\in{\rm I\!R}^{n\times d_{h}}
n
m
S=(s_{1},\dots,s_{m})
k
k-1
k
idx=topk(S,K=k-1),\;\;\;\;\textit{Top}=\{(\mathcal{H}_{i},s_{i})\text{ }|\text%
{ }i\in idx\}
k^{th}
m-(k-1)
k
\textit{B}=\{(\mathcal{H}_{i},s_{i})\text{ }|\text{ }(i\notin idx)\land(i\in\{%
1,2,\dots,m\})\}
Z=\sum_{(\mathcal{H},s)\in B}\exp(s)
\textit{SP}=\left(\sum_{(\mathcal{H},s)\in B}\left(\frac{\exp(s)}{Z}\cdot%
\mathcal{H}\right),\sum_{(\mathcal{H},s)\in B}\left(\frac{exp(s)}{Z}\cdot s%
\right)\right)
B
m-(k-1)
SP
SP
k-1
k
\textit{Top}\cup\{SP\}
k
k-1
k^{th}
k
\leq
2000
\leq
\leq
\leq
\leq
99.95
99.88
99.85
100
80.5
79
78.1
84.05
33.85
20.2
15.1
37.35
30.10
20.7
74.89
47.6
43.85
37.9
51.35
50.5
46.1
97.87
93.75
60.75
42.45
\underline{99.88}
\mathbf{99.55}
92.7
76.9
\mathbf{84.15}
\mathbf{75.05}
\mathbf{80.1}
99.82
\underline{99.5}
98.5
\mathbf{98}
65.45
45.1
55.38
99.39
96.15
92.55
86.7
\underline{77.1}
63.7
67.3
\mathbf{99.92}
\underline{99.5}
\mathbf{99}
\underline{97.2}
76.05
\underline{67.9}
\underline{71.8}
3
\leq
\leq
\leq
3
\leq
\leq
\leq
k
k
5
\leq 100
200-300
900-1000
>100
\S
900
1000
37.9\%
86.7\%
k
\S
k
52.19_{1.5}
74.86_{28}
82.72_{19}
71.2_{3}
71.4_{4}
49_{25}
49.5_{24}
49.3_{6}
50.1_{6}
51.67_{8.8}
70.63_{21}
81.97_{5}
71.2_{7}
71.2_{6}
57.5_{17}
59.6_{12}
50.5_{20}
51.8_{20}
\underline{52.30_{2.7}}
\underline{76.98_{5.8}}
83.68_{7.8}
\mathbf{72.5_{3}}
\mathbf{73_{2}}
56.5_{33}
57.1_{31}
50.9_{7}
51.7_{13}
51.75_{11}
\mathbf{77.80_{15}}
\underline{85.38_{3.5}}
72.2_{4}
72.6_{5}
62_{44}
63.3_{47}
52.8_{6}
53.8_{4}
\mathbf{52.32_{4.7}}
75.07_{29}
82.86_{23}
71.6_{2}
72.3_{1}
64.7_{6}
66.4_{5}
\mathbf{53.7_{37}}
\mathbf{54.8_{43}}
51.92_{7.2}
75.68_{21}
84.77_{11}
71.7_{1}
71.9_{2}
\mathbf{65.6_{13}}
\mathbf{66.7_{9}}
53.2_{2}
54.2_{5}
3
90_{1}=90\pm 0.1
3
90_{1}=90\pm 0.1
\leq 5
10
15
2000
10
<90\%
\leq 40\%
60
80\%
10,000
\geq 150
\leq
2000
\leq
\leq
\leq
\leq
5
99.39
96.15
92.55
86.7
\mathbf{77.1}
63.7
67.3
\mathbf{99.92}
\mathbf{99.5}
\mathbf{99}
\mathbf{97.2}
76.05
\mathbf{67.9}
\mathbf{71.8}
94.1
85.1
83.5
78.8
67.9
44.3
57.9
70.3
42.4
33.2
26.3
40.2
35.8
29.7
89.3
36.8
28.2
25.1
39.5
34
30.1
69
44
37.1
29.4
39.5
38.6
31.6
2
94.18
68.2
56.85
50.2
64.45
56.95
55.85
99.69
97.55
95.40
91
75.75
62
66.1
3
3
k
k
k
k=5
k
k
k
\S
k
\S
k
k
k
k
2
k
2
k
50.2\%
900
1000
91\%
5
2
2
\mathbf{200-250}
\mathbf{500-600}
\mathbf{900-1000}
0.2
0.02
0.5
0.02
1.3
0.03
0.5
0.35
2.1
1.95
3.5
5.45
9.3
32.4
2.3
0.06
6.1
0.19
10.5
0.42
8.0
0.09
20.6
0.21
38.2
0.35
1.5
1.57
4.3
12.2
8.0
42.79
1.1
1.71
2.4
9.85
4.3
27.33
1.1
1.71
2.6
9.82
5.1
27.27
1.4
2.74
4.0
15.5
7.1
42.95
5.1
2.67
12.6
15.4
23.1
42.78
100
1
100
1
200
250
500
600
900
1000
100
1
k
k
k
k
\S
k
k
k
k
\S
k
k
k
k
X=[x_{1},x_{2},....x_{n}]
len(X)==1
X[0]
len(X)==2
cell(X[0],X[1])
Children_{L}
Children_{R}
\leftarrow
X[:len(X)-1],X[1:]
Parents
\leftarrow
cell(child_{L},child_{R})
child_{L}
child_{R}
zip(Children_{L},Children_{R}]
Scores\leftarrow[scorer(parent)\text{ for }parent\text{ in }Parents]
index
\leftarrow
argmax(Scores)
X[index]\leftarrow Parents[index]
X[index+1]
X=[x_{1},x_{2},....x_{n}],k\text{ (beam size)}
BeamX
\leftarrow
X
BeamScores
\leftarrow
len(BeamX[0])==1
BeamX
\leftarrow
beam[0]
beam
BeamX
len(BeamX[0])==2
BeamX
\leftarrow
cell(beam[0],beam[1])
beam
BeamX
NewBeamX
\leftarrow
[]
NewBeamScores
\leftarrow
[]
Beam
BeamScore
zip(BeamX,BeamScores)
Parents\leftarrow[cell(beam[i],beam[i+1])\text{ for }i\text{ in }range(0,len(%
beam)-1)]
Scores\leftarrow log\circ softmax([scorer(parent)\text{ for }parent\text{ in }%
Parents])
Indices\leftarrow topk(Scores,k)
i
range(K)
newBeam\leftarrow
deepcopy(Beam)
newBeam[Indices[i]]\leftarrow Parents[Indices[i]]
newBeam[Indices[i]+1]
NewBeamX.append(newBeam)
newScore\leftarrow BeamScore+Scores[indices[i]]
newBeamScores.append(newScore)
Indices\leftarrow topk(newBeamScores,k)
BeamScores\leftarrow[newBeamScores[i]\text{ for }i\text{ in Indices}]
BeamX\leftarrow[newBeamX[i]\text{ for }i\text{ in Indices}]
BeamScores\leftarrow Softmax(BeamScores)
sum([score*X\text{ for }score,X\text{ in }zip(BeanScores,BeamX)])
k
1
0
k
k
score
\S
k
k
k
k
k
k\times k
k\times k
k\times k
k
k
k
k
k
\S
\left[\begin{matrix}z_{i}\\
h_{i}\\
c_{i}\\
u_{i}\end{matrix}\right]=\mathrm{GeLU}\left(\left[\begin{matrix}child_{left}\\
child_{right}\end{matrix}\right]W^{Cell}_{1}+b_{1}\right)W^{cell}_{2}+b_{2}
\displaystyle o_{i}=LN(\sigma(z_{i})\odot child_{left}+\sigma(h_{i})\odot child%
_{right}+\sigma(c_{i})\odot u_{i})
\displaystyle o_{i}=LN(\sigma(z_{i})\odot child_{left}+\sigma(h_{i})\odot child%
_{right}+\sigma(c_{i})\odot u_{i})
\sigma
sigmoid
o_{i}
\in{\rm I\!R}^{d_{h}}
child_{left},child_{right}\in{\rm I\!R}^{d_{h}}
W_{1}^{cell}\in{\rm I\!R}^{2d_{h}\times 4d_{h}}
b_{1}\in{\rm I\!R}^{4d_{h}}
W_{2}\in{\rm I\!R}^{4d_{h}\times d_{h}}
b_{1}\in{\rm I\!R}^{d_{h}}
n
s
log(s)
log(1-s)
\S
\S
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
99.95
99.95
99.9
99.8
76.95
77.1
74.55
99.45
99.0
67.8
35.15
\mathbf{99.95}
\underline{99.8}
99.25
96.4
\mathbf{79.95}
\mathbf{77.55}
\mathbf{77}
\underline{99.9}
99.4
99.45
98.9
65.7
43.4
65.1
\mathbf{99.95}
\mathbf{99.95}
\mathbf{99.95}
\mathbf{99.9}
75.35
72.05
68.1
\underline{99.9}
99.6
98.1
97.1
\underline{78.1}
71.25
\underline{75.45}
3
\leq
\leq
\leq
3
\leq
\leq
\leq
100,000
\leq 5
\leq 100
\leq 6
2000
\leq 5
\leq 100
7
2000
\leq 5
\leq 100
8
10
20
\geq 90\%
3
\sim 75,000
>100
100,000
3
10
10
10
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
99.94_{0.6}
97.58_{32}
78.785_{197}
61.85_{291}
77.66_{30}
69.03_{107}
67.35_{125}
99.84_{1.5}
99.58_{5.8}
98.8_{21}
97.85_{39}
73.82_{57}
66.21_{107}
66.975_{102}
10
\leq
\leq
\leq
90_{1}=90\pm 0.1
10
\leq
\leq
\leq
90_{1}=90\pm 0.1
\leq
2000
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
96.7
48.9
32.85
22.1
65.65
64.6
42.6
91.75
34.60
24.05
19.7
54.65
52.45
39.95
\leq
2000
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
\leq
95.6
44.15
30.7
20.3
67.85
58.05
46
92.65
38.6
29.15
22.1
73.1
64.4
50.4
3
\leq
\leq
\leq
\leq
\leq
\leq
3
\leq
\leq
\leq
\leq
\leq
\leq
\sim 10
\sim 50
10
50
1
2000
\leq 100
1
3
8
10
\leq 6
48
97.14_{1}
96.5_{2}
95.29_{2.5}
94.21_{9.9}
93.67_{7.7}
97.41_{1.6}
52
51
51
51
48
51
52
51
51
51
48
51
87
85
81
78
75
60
\dagger
95
93
92
90
88
93.04_{6}
90.43_{4.9}
88.48_{6}
86.57_{5.8}
80.58_{1.5}
83.17_{5.1}
93.46_{14}
91.89_{19}
90.33_{22}
88.43_{18}
85.70_{24}
89.34_{29}
96.62_{2.3}
96.07_{4.6}
94.67_{11}
93.44_{8.8}
92.54_{9.3}
77.08_{27}
96.9_{3.7}
95.99_{2.8}
94.51_{2.9}
\mathbf{94.48_{5.6}}
92.73_{15}
89.79_{58}
\mathbf{97.5_{1.6}}
\mathbf{96.74_{1.4}}
94.95_{2}
93.9_{2.2}
93.36_{6.2}
\mathbf{94.88_{7}}
96.83_{1}
95.99_{2.4}
95.04_{2.3}
\underline{94.29_{3.8}}
93.36_{2.4}
\underline{94.17_{14}}
\underline{97.03_{1.4}}
\underline{96.49_{1.9}}
\mathbf{95.43_{4.5}}
94.21_{6.6}
\mathbf{93.39_{1.5}}
78.04_{43}
\geq 8
\leq 6
\dagger
3
90_{1}=90\pm 0.1
\geq 8
\leq 6
\dagger
3
90_{1}=90\pm 0.1
\leq 6
\geq 8
C
*(and(not*))*
94\%
\leq
2000
\leq
\leq
\leq
\leq
70.56
48.70
45.35
37.53
54.8
55.6
49.8
59.4
44.85
43.35
35.70
45.88
45.25
41.95
3
3
51.78_{1.2}
74.93_{14}
82.38_{9.3}
72.2_{3}
72.3_{5}
61.4_{23}
62.3_{23}
51.7_{3}
52.7_{7}
52.35_{6.2}
74.93_{22}
83.61_{15}
71.1_{5}
71.4_{1}
59_{8}
60.7_{5}
50.2_{4}
50.4_{6}
2
52.14_{2.8}
75.21_{23}
82.51_{23}
\mathbf{72.6_{1}}
\mathbf{72.6_{2}}
\mathbf{66.6_{5}}
\mathbf{68.1_{6}}
\mathbf{53.3_{21}}
\mathbf{54.4_{24}}
\mathbf{52.2_{4.4}}
\mathbf{75.89_{22}}
\mathbf{85.45_{15}}
71.1_{3}
71.9_{1}
63.7_{17}
65.6_{12}
51.8_{19}
53_{12}
3
90_{1}=90\pm 0.1
3
90_{1}=90\pm 0.1
\leq
2000
\leq
\leq
\leq
\leq
99.9_{.2}
99.9_{.9}
99.8_{1}
100_{.5}
81.2_{28}
79.5_{14}
78.5_{29}
83.8_{4.5}
33.9_{1.2}
18.1_{38}
13.7_{25}
37.6_{18}
29.2_{30}
18.5_{35}
75_{4.6}
47.7_{8.4}
42.7_{2.8}
37.4_{42}
50.9_{15}
51.4_{16}
45.3_{12}
\mathbf{99.9_{.3}}
\mathbf{99.6_{.7}}
92.4_{13}
76.3_{13}
\mathbf{83.2_{24}}
\mathbf{76.3_{38}}
\mathbf{79.3_{18}}
\underline{99.7_{2.8}}
98.8_{11}
\mathbf{97.2_{23}}
\mathbf{94.9_{49}}
66.6_{40}
43.7_{38}
55.38_{44}
99.4_{2.7}
\underline{96.8_{10}}
93.6_{22}
88.4_{27}
\underline{75.2_{28}}
59.1_{79}
63.4_{57}
99.6_{5.4}
97.2_{35}
\underline{94.8_{65}}
\underline{92.2_{86}}
73.3_{64}
\underline{63.1_{92}}
\underline{66.1_{101}}
3
\leq
\leq
\leq
90_{1}=90\pm 0.1
3
\leq
\leq
\leq
90_{1}=90\pm 0.1
2
10-20\%
0.42
0.40
0.20
0.40
0.21
0.19
0.19
0.40
0.40
0.20
0.61
0.40
0.50
0.50
0.50
0.50
0,51
0.49
1.0
0.42
0.20
0.19
0.19
0.41
0.21
0.19
0.19
0.21
0.20
0.20
0.19
0.40
0.21
0.20
0.19
0.57
0.43
0.54
0.46
0.55
0.45
0.53
0.47
0.26
0.23
0.19
0.18
0.14
0.24
0.22
0.21
0.19
0.14
0.25
0.22
0.21
0.18
0.15
5
5
2
k
5
10
8
5
0.1
[0.1,0.2,0.3,0.4]
5
20
0.4
0.2
0.3
