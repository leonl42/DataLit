\mathcal{D}
\pi_{\mathcal{D}}(a|s)
\max_{a^{\prime}:\pi_{\mathcal{D}}(a^{\prime}|s^{\prime})>0}q(s^{\prime},a^{%
\prime})
\max_{a^{\prime}}q(s^{\prime},a^{\prime})
\pi_{\mathcal{D}}(a|s)
\pi_{\mathcal{D}}
\pi_{\mathcal{D}}
\pi_{\mathcal{D}}
M=\{{\mathcal{S}},{\mathcal{A}},P,r,\gamma\}
{\mathcal{S}}
{\mathcal{A}}
\gamma\in[0,1)
r:{\mathcal{S}}\times{\mathcal{A}}\rightarrow{\mathbb{R}}
P:{\mathcal{S}}\times{\mathcal{A}}\rightarrow\Delta({\mathcal{S}})
\Delta({\mathcal{X}})
{\mathcal{X}}
\pi:{\mathcal{S}}\rightarrow\Delta({\mathcal{A}})
v^{\pi}(s)=\mathbb{E}^{\pi}[\sum_{t=0}^{\infty}\gamma^{t}r(s_{t},a_{t})|s_{0}=s]
\mathbb{E}^{\pi}
\pi
q^{\pi}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim P(\cdot|s,a)}[v^{\pi}(s^{%
\prime})]
\pi^{*}
s\in{\mathcal{S}}
v^{*}
q^{*}
\displaystyle v^{*}(s)=\max_{a}r(s,a)+\gamma\mathbb{E}_{s^{\prime}}[v^{*}(s^{%
\prime})]\,,\quad q^{*}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim P(\cdot|s%
,a)}\left[\max_{a^{\prime}}q^{*}(s^{\prime},a^{\prime})\right]\,.
\displaystyle v^{*}(s)=\max_{a}r(s,a)+\gamma\mathbb{E}_{s^{\prime}}[v^{*}(s^{%
\prime})]\,,\quad q^{*}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim P(\cdot|s%
,a)}\left[\max_{a^{\prime}}q^{*}(s^{\prime},a^{\prime})\right]\,.
\displaystyle\tilde{v}^{\pi}(s)=v^{\pi}(s)+\tau{\mathbb{H}}(s,\pi)\,,\quad{%
\mathbb{H}}(s,\pi)=\mathbb{E}^{\pi}\left[\sum_{t=0}^{\infty}-\gamma^{t}\log\pi%
(a|s)\Big{|}s_{0}=s\right]\,,
\displaystyle\tilde{v}^{\pi}(s)=v^{\pi}(s)+\tau{\mathbb{H}}(s,\pi)\,,\quad{%
\mathbb{H}}(s,\pi)=\mathbb{E}^{\pi}\left[\sum_{t=0}^{\infty}-\gamma^{t}\log\pi%
(a|s)\Big{|}s_{0}=s\right]\,,
\tau
{\mathbb{H}}
\tilde{q}^{\pi}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim P(s,a)}[\tilde{v}%
^{\pi}(s^{\prime})]
\tau\rightarrow 0
\mathcal{D}=\{s_{i},a_{i},r_{i},s_{i}^{\prime}\}^{n-1}_{i=0}
\pi_{\mathcal{D}}
\pi_{\mathcal{D}}
\mathcal{D}
\pi_{\mathcal{D}}
{q}\approx q^{*}
\pi_{\mathcal{D}}
\max_{\pi}\mathbb{E}_{s\sim\rho}[\sum_{a}\pi(a|s)q(s,a)-\tau D_{\mathrm{KL}}(%
\pi(\cdot|s)||\pi_{\mathcal{D}}(\cdot|s))]
\tau>0
\pi_{\mathcal{D}}
\pi(a|s)=0
\pi_{\mathcal{D}}(a|s)=0
\pi^{\prime}(a|s)\propto\pi_{\mathcal{D}}(a|s)\exp(q(s,a)/\tau)
\pi_{\mathcal{D}}
(\pi(s)-a)^{2}
a
\pi_{\mathcal{D}}
\pi^{\prime}
\pi_{\mathcal{D}}
\max_{\pi\preceq\pi_{\mathcal{D}}}\sum_{a\in{\mathcal{A}}}\pi(a|s)q(s,a)
\pi\preceq\pi_{\mathcal{D}}
\pi
\pi_{\mathcal{D}}
\pi_{\omega}\approx\pi_{\mathcal{D}}
\pi_{\omega}
\pi_{\omega}
\displaystyle\tilde{q}^{*}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim P(%
\cdot|s,a)}\Big{[}\tau\log\sum_{a\in{\mathcal{A}}}e^{{\tilde{q}^{*}(s^{\prime}%
,a^{\prime})}/{\tau}}\Big{]}\,.
\displaystyle\tilde{q}^{*}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim P(%
\cdot|s,a)}\Big{[}\tau\log\sum_{a\in{\mathcal{A}}}e^{{\tilde{q}^{*}(s^{\prime}%
,a^{\prime})}/{\tau}}\Big{]}\,.
\max_{p\in\Delta({\mathcal{A}})}\sum_{a\in{\mathcal{A}}}p(a)q(s,a)+\tau{%
\mathbb{H}}(p)=\tau\log\sum_{a\in{\mathcal{A}}}e^{{q(s,a)}/{\tau}}
\tau\rightarrow 0
\pi_{\mathcal{D}}
\displaystyle\tilde{q}_{\pi_{\mathcal{D}}}^{*}(s,a)=r(s,a)+\gamma\mathbb{E}_{s%
^{\prime}\sim{P}(\cdot|s,a)}\left[\tau\log\sum_{a^{\prime}:{\pi_{\mathcal{D}}}%
(a^{\prime}|s^{\prime})>0}e^{\tilde{q}_{\pi_{\mathcal{D}}}^{*}(s^{\prime},a^{%
\prime})/\tau}\right]\,.
\displaystyle\tilde{q}_{\pi_{\mathcal{D}}}^{*}(s,a)=r(s,a)+\gamma\mathbb{E}_{s%
^{\prime}\sim{P}(\cdot|s,a)}\left[\tau\log\sum_{a^{\prime}:{\pi_{\mathcal{D}}}%
(a^{\prime}|s^{\prime})>0}e^{\tilde{q}_{\pi_{\mathcal{D}}}^{*}(s^{\prime},a^{%
\prime})/\tau}\right]\,.
q
\displaystyle\sum_{a:\pi_{\mathcal{D}}(a|s)>0}e^{{q(s,a)}/{\tau}}=\sum_{a:\pi_%
{\mathcal{D}}(a|s)>0}\pi_{\mathcal{D}}(a|s)\pi_{\mathcal{D}}(a|s)^{-1}e^{{q(s,%
a)}/{\tau}}
\displaystyle\sum_{a:\pi_{\mathcal{D}}(a|s)>0}e^{{q(s,a)}/{\tau}}
\displaystyle=\sum_{a:\pi_{\mathcal{D}}(a|s)>0}\pi_{\mathcal{D}}(a|s)\pi_{%
\mathcal{D}}(a|s)^{-1}e^{{q(s,a)}/{\tau}}
\displaystyle=\sum_{a:\pi_{\mathcal{D}}(a|s)>0}\pi_{\mathcal{D}}(a|s)e^{-\log%
\pi_{\mathcal{D}}(a|s)}e^{{q(s,a)}/{\tau}}
\displaystyle=\sum_{a:\pi_{\mathcal{D}}(a|s)>0}\pi_{\mathcal{D}}(a|s)e^{-\log%
\pi_{\mathcal{D}}(a|s)}e^{{q(s,a)}/{\tau}}
\displaystyle=\mathbb{E}_{a\sim\pi_{\mathcal{D}}(\cdot|s)}\left[e^{{q(s,a)}/{%
\tau}-\log\pi_{\mathcal{D}}(a|s)}\right]\,.
\displaystyle=\mathbb{E}_{a\sim\pi_{\mathcal{D}}(\cdot|s)}\left[e^{{q(s,a)}/{%
\tau}-\log\pi_{\mathcal{D}}(a|s)}\right]\,.
\pi_{\mathcal{D}}(a|s)
\pi_{\mathcal{D}}
\pi_{\mathcal{D}}
q
\displaystyle\tau\log\sum_{a:\pi_{\mathcal{D}}(a|s)>0}e^{{q(s,a)}/{\tau}}=\max%
_{\pi\preceq\pi_{\mathcal{D}}}\sum_{a}\pi(a|s)q(s,a)+\tau{\mathbb{H}}(\pi).
\displaystyle\tau\log\sum_{a:\pi_{\mathcal{D}}(a|s)>0}e^{{q(s,a)}/{\tau}}=\max%
_{\pi\preceq\pi_{\mathcal{D}}}\sum_{a}\pi(a|s)q(s,a)+\tau{\mathbb{H}}(\pi).
q
q
\pi_{\pi_{\mathcal{D}},q}(a|s)\propto\pi_{\mathcal{D}}(a|s)\exp\left(\frac{q(s%
,a)}{\tau}-\log\pi_{\mathcal{D}}(a|s)\right)\,,
\pi^{\prime}
\pi_{\mathcal{D}}
-\log\pi_{\mathcal{D}}
\pi_{\mathcal{D}}
\exp(-\log\pi_{\mathcal{D}}(a|s))=\pi_{\mathcal{D}}(a|s)^{-1}
\pi_{\pi_{\mathcal{D}},q}(a|s)=0
\pi_{\mathcal{D}}(a|s)=0
\pi_{\pi_{\mathcal{D}},q}(a|s)\propto\exp({q}(s,a)/\tau)
0\cdot\infty=0
\tilde{\pi}_{\pi_{\mathcal{D}}}
\pi_{\pi_{\mathcal{D}},q}
\displaystyle q_{\pi_{\mathcal{D}}}^{*}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{%
\prime}\sim{P}(\cdot|s,a)}\left[\max_{a^{\prime}:{\pi_{\mathcal{D}}}(a^{\prime%
}|s^{\prime})>0}q_{\pi_{\mathcal{D}}}^{*}(s^{\prime},a^{\prime})\right]\,.
\displaystyle q_{\pi_{\mathcal{D}}}^{*}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{%
\prime}\sim{P}(\cdot|s,a)}\left[\max_{a^{\prime}:{\pi_{\mathcal{D}}}(a^{\prime%
}|s^{\prime})>0}q_{\pi_{\mathcal{D}}}^{*}(s^{\prime},a^{\prime})\right]\,.
\tilde{q}_{\pi_{\mathcal{D}}}^{*}
\lim_{\tau\rightarrow 0}\tilde{q}_{\pi_{\mathcal{D}}}^{*}=q_{\pi_{\mathcal{D}}%
}^{*}
{\mathbb{I}}
\pi_{\pi_{\mathcal{D}}}(a|s)={\mathbb{I}}(a=\operatorname*{arg\,max}_{a:\pi_{%
\mathcal{D}}(a)>0}q^{*}_{\pi_{\mathcal{D}}}(s,a))
q^{*}_{\pi_{\mathcal{D}}}
\displaystyle\tilde{\pi}_{\pi_{\mathcal{D}}}^{*}(a|s)\propto\pi_{\mathcal{D}}(%
a|s)\exp\left(\frac{\tilde{q}^{*}_{\pi_{\mathcal{D}}}(s,a)}{\tau}-\log\pi_{%
\mathcal{D}}(a|s)\right)\,.
\displaystyle\tilde{\pi}_{\pi_{\mathcal{D}}}^{*}(a|s)\propto\pi_{\mathcal{D}}(%
a|s)\exp\left(\frac{\tilde{q}^{*}_{\pi_{\mathcal{D}}}(s,a)}{\tau}-\log\pi_{%
\mathcal{D}}(a|s)\right)\,.
\lim_{\tau\rightarrow\infty}\tilde{\pi}_{\pi_{\mathcal{D}}}^{*}=\pi_{\pi_{%
\mathcal{D}}}^{*}
\displaystyle({\mathcal{T}}_{\pi_{\mathcal{D}}}q)(s,a)=r(s,a)+\gamma\mathbb{E}%
_{s^{\prime}\sim P(\cdot|s,a)}\left[\tau\log\sum_{a^{\prime}:{\pi_{\mathcal{D}%
}}(a^{\prime}|s^{\prime})>0}e^{q(s^{\prime},a^{\prime})/\tau}\right]\,.
\displaystyle({\mathcal{T}}_{\pi_{\mathcal{D}}}q)(s,a)=r(s,a)+\gamma\mathbb{E}%
_{s^{\prime}\sim P(\cdot|s,a)}\left[\tau\log\sum_{a^{\prime}:{\pi_{\mathcal{D}%
}}(a^{\prime}|s^{\prime})>0}e^{q(s^{\prime},a^{\prime})/\tau}\right]\,.
{\mathcal{T}}_{\pi_{\mathcal{D}}}
q_{t+1}={\mathcal{T}}_{\pi_{\mathcal{D}}}q_{t}
\gamma<1
\tilde{q}_{\pi_{\mathcal{D}}}^{*}
\pi_{t}
t
\tilde{q}^{\pi_{t}}
\pi_{t+1}
\tilde{q}^{\pi_{t}}\leq\tilde{q}^{\pi_{t+1}}
\pi_{t}
\pi_{t}\preceq{\pi_{\mathcal{D}}}
\displaystyle\pi_{t+1}(a|s)\propto{\pi_{\mathcal{D}}(a|s)\exp\left(\frac{%
\tilde{q}^{\pi_{t}}(s,a)}{\tau}-\log\pi_{\mathcal{D}}(a|s)\right)}\,.
\displaystyle\pi_{t+1}(a|s)\propto{\pi_{\mathcal{D}}(a|s)\exp\left(\frac{%
\tilde{q}^{\pi_{t}}(s,a)}{\tau}-\log\pi_{\mathcal{D}}(a|s)\right)}\,.
\pi_{t+1}\preceq\pi_{\mathcal{D}}
\tilde{q}^{\pi_{t+1}}\geq\tilde{q}^{\pi_{t}}
\pi_{t+1}
\pi_{\mathcal{D}}
\displaystyle({\mathcal{T}}^{\pi}q)(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime},a%
^{\prime}\sim P^{\pi}(\cdot|s,a)}[{q}(s^{\prime},a^{\prime})-\tau\log\pi(a^{%
\prime}|s^{\prime})]\,.
\displaystyle({\mathcal{T}}^{\pi}q)(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime},a%
^{\prime}\sim P^{\pi}(\cdot|s,a)}[{q}(s^{\prime},a^{\prime})-\tau\log\pi(a^{%
\prime}|s^{\prime})]\,.
\tilde{q}^{\pi}
{\mathcal{T}}^{\pi}q
q
{\mathcal{T}}^{\pi}
\gamma<1
\pi
\pi\preceq\pi_{\mathcal{D}}
\tilde{\pi}^{*}_{\pi_{\mathcal{D}}}
\pi_{\mathcal{D}}
\pi_{\omega}
\pi_{\psi}
\psi
q_{\theta}
\theta
v_{\phi}
\phi
\pi_{\omega}\approx\pi_{\mathcal{D}}
\pi_{\omega}\approx\pi_{\mathcal{D}}
{\mathcal{L}}_{\text{behavior}}(\omega)=-\mathbb{E}_{(s,a)\sim{\mathcal{D}}}%
\left[\log\pi_{\omega}(a|s)\right]
\pi_{\mathcal{D}}(a|s)=0
\pi_{\omega}
q_{\theta}
v_{\phi}
\pi_{\mathcal{D}}
\pi_{\mathcal{D}}
\pi_{\omega}
\hat{\pi}_{\pi_{\mathcal{D}},q_{\theta}}(a|s)=\pi_{\mathcal{D}}(a|s)\exp\left(%
\frac{q_{\theta}(s,a)-Z(s)}{\tau}-\log\pi_{\omega}(a|s)\right)
Z(s)=\tau\log\int_{a}{\pi_{\mathcal{D}}(a|s)\exp(\frac{{q_{\theta}(s,a)}}{\tau%
}-\log\pi_{\omega}(a|s))}da
\displaystyle D_{\mathrm{KL}}(\hat{\pi}_{\pi_{\mathcal{D}},q_{\theta}}(\cdot|s%
)||\pi_{\psi}(\cdot|s))=-\mathbb{E}_{a\sim\hat{\pi}_{\pi_{\mathcal{D}},q_{%
\theta}}(\cdot|s)}[\log\pi_{\psi}(a|s)-\log\hat{\pi}_{\pi_{\mathcal{D}},q_{%
\theta}}(a|s)]
\displaystyle D_{\mathrm{KL}}
\displaystyle(\hat{\pi}_{\pi_{\mathcal{D}},q_{\theta}}(\cdot|s)||\pi_{\psi}(%
\cdot|s))=-\mathbb{E}_{a\sim\hat{\pi}_{\pi_{\mathcal{D}},q_{\theta}}(\cdot|s)}%
[\log\pi_{\psi}(a|s)-\log\hat{\pi}_{\pi_{\mathcal{D}},q_{\theta}}(a|s)]
\displaystyle=\mathbb{E}_{a\sim\pi_{\mathcal{D}}(\cdot|s)}\left[\exp\left(%
\frac{q_{\theta}(s,a)-Z(s)}{\tau}-\log\pi_{\omega}(a|s)\right)(\log\pi_{\psi}(%
a|s)+\log\hat{\pi}_{\pi_{\mathcal{D}},q_{\theta}}(a|s))\right]
\displaystyle=\mathbb{E}_{a\sim\pi_{\mathcal{D}}(\cdot|s)}\left[\exp\left(%
\frac{q_{\theta}(s,a)-Z(s)}{\tau}-\log\pi_{\omega}(a|s)\right)(\log\pi_{\psi}(%
a|s)+\log\hat{\pi}_{\pi_{\mathcal{D}},q_{\theta}}(a|s))\right]
a\sim\pi_{\mathcal{D}}(\cdot|s)
\pi_{\mathcal{D}}
Z(s)
v_{\phi}
Z
\pi_{\psi}
\displaystyle{\mathcal{L}}_{\text{actor}}(\psi)=-\mathbb{E}_{s,a\sim{\mathcal{%
D}}}\left[\exp\left(\frac{q_{\theta}(s,a)-v_{\phi}(s)}{\tau}-\log\pi_{\omega}(%
a|s)\right)\log\pi_{\psi}(a|s)\right]\,.
\displaystyle{\mathcal{L}}_{\text{actor}}(\psi)=-\mathbb{E}_{s,a\sim{\mathcal{%
D}}}\left[\exp\left(\frac{q_{\theta}(s,a)-v_{\phi}(s)}{\tau}-\log\pi_{\omega}(%
a|s)\right)\log\pi_{\psi}(a|s)\right]\,.
\displaystyle{\mathcal{L}}_{\text{baseline}}(\phi)=\mathbb{E}_{s\sim{\mathcal{%
D}},a\sim\pi_{\psi}(s)}\left[\frac{1}{2}\left(v_{\phi}(s)-\left(q_{\theta}(s,a%
)-\tau\log\pi_{\psi}(a|s)\right)\right)^{2}\right]
\displaystyle{\mathcal{L}}_{\text{baseline}}(\phi)
\displaystyle=\mathbb{E}_{s\sim{\mathcal{D}},a\sim\pi_{\psi}(s)}\left[\frac{1}%
{2}\left(v_{\phi}(s)-\left(q_{\theta}(s,a)-\tau\log\pi_{\psi}(a|s)\right)%
\right)^{2}\right]
\displaystyle{\mathcal{L}}_{\text{critic}}(\theta)=\mathbb{E}_{s,a,r,s^{\prime%
}\sim{\mathcal{D}}}\left[\frac{1}{2}\left(r+\gamma v_{\phi}(s^{\prime})-q_{%
\theta}(s,a)\right)^{2}\right].
\displaystyle{\mathcal{L}}_{\text{critic}}(\theta)
\displaystyle=\mathbb{E}_{s,a,r,s^{\prime}\sim{\mathcal{D}}}\left[\frac{1}{2}%
\left(r+\gamma v_{\phi}(s^{\prime})-q_{\theta}(s,a)\right)^{2}\right].
v_{\phi}
v_{\phi}
\pi_{\psi}
v_{\phi}
\pi_{\psi}\preceq\pi_{\mathcal{D}}
\pi_{\psi}
\pi_{\psi}
\pi_{\psi}
Z
v_{\phi}
v_{\phi}
Z
Z
\tilde{\pi}_{\pi_{\mathcal{D}},q_{\theta}}
Z
\pi_{\omega}\approx\pi_{\mathcal{D}}
\hat{\pi}_{\pi_{\mathcal{D}},q_{\theta}}
Z
\hat{\pi}_{\pi_{\mathcal{D}},q_{\theta}}
v_{\phi}
Z
\pi_{\mathcal{D}}
\mathcal{A}=\{up,down,right,left\}
\gamma
down
10
95\%
10
95\%
10
95\%
p
0
p=0.002
10
95\%
p
0
p=0.002
10
10
10
10
10
3
0.8
10
3
0.8
q(s,a)
a
s
q(s,a)
\pi_{\mathcal{D}}
\pi_{\mathcal{D}}
k
\Delta
k
{\bm{q}}=(q(1),\dots,q(k))\in{\mathbb{R}}^{k}
\displaystyle\max_{\pi\in\Delta}\ \pi\cdot{\bm{q}}+\tau{\mathbb{H}}(\pi)\,.
\displaystyle\max_{\pi\in\Delta}\ \pi\cdot{\bm{q}}+\tau{\mathbb{H}}(\pi)\,.
\tau>0
\displaystyle F_{\tau}({\bm{q}})=\tau\log\sum_{a}e^{q(a)/\tau}\,,\quad f_{\tau%
}({\bm{q}})=\frac{e^{{\bm{q}}/\tau}}{\sum_{a}e^{q(a)/\tau}}=e^{\frac{{\bm{q}}-%
F_{\tau}({\bm{q}})}{\tau}}\,.
\displaystyle F_{\tau}({\bm{q}})=\tau\log\sum_{a}e^{q(a)/\tau}\,,\quad f_{\tau%
}({\bm{q}})=\frac{e^{{\bm{q}}/\tau}}{\sum_{a}e^{q(a)/\tau}}=e^{\frac{{\bm{q}}-%
F_{\tau}({\bm{q}})}{\tau}}\,.
\displaystyle F_{\tau}({\bm{q}})=\max_{\pi\in\Delta}\ \pi\cdot{\bm{q}}+\tau{%
\mathbb{H}}(\pi)=f_{\tau}({\bm{q}})\cdot{\bm{q}}+\tau{\mathbb{H}}(f_{\tau}({%
\bm{q}}))\,.
\displaystyle F_{\tau}({\bm{q}})=\max_{\pi\in\Delta}\ \pi\cdot{\bm{q}}+\tau{%
\mathbb{H}}(\pi)=f_{\tau}({\bm{q}})\cdot{\bm{q}}+\tau{\mathbb{H}}(f_{\tau}({%
\bm{q}}))\,.
\beta\in\Delta
\displaystyle\max_{\pi\preceq\beta}\ \pi\cdot{\bm{q}}+\tau{\mathbb{H}}(\pi)\,.
\displaystyle\max_{\pi\preceq\beta}\ \pi\cdot{\bm{q}}+\tau{\mathbb{H}}(\pi)\,.
\tau>0
\displaystyle F_{\beta,\tau}({\bm{q}})=\tau\log\left(\sum_{a:\beta(a)>0}e^{q(a%
)/\tau}\right)\,,
\displaystyle F_{\beta,\tau}({\bm{q}})=\tau\log\left(\sum_{a:\beta(a)>0}e^{q(a%
)/\tau}\right)\,,
\displaystyle f_{\beta,\tau}({\bm{q}})=\frac{\beta e^{{\bm{q}}/\tau-\log\beta}%
}{\sum_{a:\beta(a)>0}e^{q(a)/\tau}}=\beta e^{\frac{{\bm{q}}-F_{\beta,\tau}({%
\bm{q}})}{\tau}-\log\beta}\,.
\displaystyle f_{\beta,\tau}({\bm{q}})=\frac{\beta e^{{\bm{q}}/\tau-\log\beta}%
}{\sum_{a:\beta(a)>0}e^{q(a)/\tau}}=\beta e^{\frac{{\bm{q}}-F_{\beta,\tau}({%
\bm{q}})}{\tau}-\log\beta}\,.
\displaystyle F_{\beta,\tau}({\bm{q}})=\max_{\pi\preceq\beta}\ \pi\cdot{\bm{q}%
}+\tau{\mathbb{H}}(\pi)=f_{\beta,\tau}({\bm{q}})\cdot{\bm{q}}+\tau{\mathbb{H}}%
(f_{\beta,\tau}({\bm{q}}))\,.
\displaystyle F_{\beta,\tau}({\bm{q}})=\max_{\pi\preceq\beta}\ \pi\cdot{\bm{q}%
}+\tau{\mathbb{H}}(\pi)=f_{\beta,\tau}({\bm{q}})\cdot{\bm{q}}+\tau{\mathbb{H}}%
(f_{\beta,\tau}({\bm{q}}))\,.
F_{\beta,\tau}
{\bm{q}}_{1},{\bm{q}}_{2}\in{\mathbb{R}}^{k}
\displaystyle\left|F_{\beta,\tau}({\bm{q}}_{1})-F_{\beta,\tau}({\bm{q}}_{2})%
\right|\leq\|{\bm{q}}_{1}-{\bm{q}}_{2}\|_{\infty}\,.
\displaystyle\left|F_{\beta,\tau}({\bm{q}}_{1})-F_{\beta,\tau}({\bm{q}}_{2})%
\right|\leq\|{\bm{q}}_{1}-{\bm{q}}_{2}\|_{\infty}\,.
\displaystyle F_{\beta,\tau}({\bm{q}}_{1})-F_{\beta,\tau}({\bm{q}}_{2})=\sup_{%
\pi_{1}\preceq\beta}\left\{\pi_{1}\cdot{\bm{q}}_{1}+\tau{\mathbb{H}}(\pi_{1})%
\right\}-\sup_{\pi_{2}\preceq\beta}\left\{\pi_{2}\cdot{\bm{q}}_{2}+\tau{%
\mathbb{H}}(\pi_{2})\right\}
\displaystyle F_{\beta,\tau}({\bm{q}}_{1})-F_{\beta,\tau}({\bm{q}}_{2})
\displaystyle=\sup_{\pi_{1}\preceq\beta}\left\{\pi_{1}\cdot{\bm{q}}_{1}+\tau{%
\mathbb{H}}(\pi_{1})\right\}-\sup_{\pi_{2}\preceq\beta}\left\{\pi_{2}\cdot{\bm%
{q}}_{2}+\tau{\mathbb{H}}(\pi_{2})\right\}
\displaystyle=\sup_{\pi_{1}\preceq\beta}\left\{\inf_{\pi_{2}\preceq\beta}\pi_{%
1}\cdot{\bm{q}}_{1}-\pi_{2}\cdot{\bm{q}}_{2}+\tau{\mathbb{H}}(\pi_{1})-\tau{%
\mathbb{H}}(\pi_{2})\right\}
\displaystyle=\sup_{\pi_{1}\preceq\beta}\left\{\inf_{\pi_{2}\preceq\beta}\pi_{%
1}\cdot{\bm{q}}_{1}-\pi_{2}\cdot{\bm{q}}_{2}+\tau{\mathbb{H}}(\pi_{1})-\tau{%
\mathbb{H}}(\pi_{2})\right\}
\displaystyle\leq\sup_{\pi\preceq\beta}\left\{\pi\cdot{\bm{q}}_{1}-\pi\cdot{%
\bm{q}}_{2}\right\}
\displaystyle\leq\sup_{\pi\preceq\beta}\left\{\pi\cdot{\bm{q}}_{1}-\pi\cdot{%
\bm{q}}_{2}\right\}
\displaystyle\leq\max_{a:\beta(a)>0}\ q_{1}(a)-q_{2}(a)
\displaystyle\leq\max_{a:\beta(a)>0}\ q_{1}(a)-q_{2}(a)
\displaystyle\leq\max_{a}\ q_{1}(a)-q_{2}(a)\,,
\displaystyle\leq\max_{a}\ q_{1}(a)-q_{2}(a)\,,
\pi_{2}=\pi_{1}
\tilde{v}
\tilde{q}
\displaystyle\tilde{q}^{\pi}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}}[\tilde{%
v}^{\pi}(s^{\prime})]\,,\ \ \tilde{v}^{\pi}(s)=\mathbb{E}^{\pi}\left[\sum_{t=0%
}^{\infty}\gamma^{t}(r(s_{t},a_{t})-\tau\log\pi(a_{t}|s_{t}))\Big{|}s_{0}=s%
\right]\,.
\displaystyle\tilde{q}^{\pi}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}}[\tilde{%
v}^{\pi}(s^{\prime})]\,,\ \ \tilde{v}^{\pi}(s)=\mathbb{E}^{\pi}\left[\sum_{t=0%
}^{\infty}\gamma^{t}(r(s_{t},a_{t})-\tau\log\pi(a_{t}|s_{t}))\Big{|}s_{0}=s%
\right]\,.
\displaystyle({\mathcal{T}}^{\pi}q)(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime},a%
^{\prime}\sim P^{\pi}(\cdot|s,a)}[{q}(s^{\prime},a^{\prime})-\tau\log\pi(a^{%
\prime}|s^{\prime})]\,.
\displaystyle({\mathcal{T}}^{\pi}q)(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime},a%
^{\prime}\sim P^{\pi}(\cdot|s,a)}[{q}(s^{\prime},a^{\prime})-\tau\log\pi(a^{%
\prime}|s^{\prime})]\,.
\pi
\tilde{q}^{\pi}
\tilde{q}^{\pi}={\mathcal{T}}^{\pi}\tilde{q}^{\pi}
|{\mathcal{A}}|<\infty
{\mathcal{T}}^{\pi}
\tilde{v}^{\pi}
\tilde{q}^{\pi}
\displaystyle\tilde{v}^{\pi}(s)=\mathbb{E}^{\pi}\left[\sum_{t=0}^{\infty}%
\gamma^{t}(r(s_{t},a_{t})-\tau\log\pi(a_{t}|s_{t}))\Big{|}s_{0}=s\right]
\displaystyle\tilde{v}^{\pi}(s)=\mathbb{E}^{\pi}\left[\sum_{t=0}^{\infty}%
\gamma^{t}(r(s_{t},a_{t})-\tau\log\pi(a_{t}|s_{t}))\Big{|}s_{0}=s\right]
\displaystyle=\mathbb{E}^{\pi}\left[r(s_{0},a_{0})-\tau\log\pi(a_{0}|s_{0})+%
\gamma\sum_{i=0}^{\infty}\gamma^{i}(r(s_{i+1},a_{i+1})-\tau\log\pi(a_{i+1}|s_{%
i+1}))\Big{|}s_{0}=s\right]
\displaystyle=\mathbb{E}^{\pi}\left[r(s_{0},a_{0})-\tau\log\pi(a_{0}|s_{0})+%
\gamma\sum_{i=0}^{\infty}\gamma^{i}(r(s_{i+1},a_{i+1})-\tau\log\pi(a_{i+1}|s_{%
i+1}))\Big{|}s_{0}=s\right]
\displaystyle=\mathbb{E}_{a\sim\pi(s)}\left[r(s,a)-\tau\log\pi(a|s)+\gamma%
\mathbb{E}_{s^{\prime}}\left[\mathbb{E}^{\pi}\left[\sum_{t=0}^{\infty}\gamma^{%
t}(r(s_{t},a_{t})-\tau\log\pi(a_{t}|s_{t}))\Big{|}s_{0}=s^{\prime}\right]%
\right]\right]
\displaystyle=\mathbb{E}_{a\sim\pi(s)}\left[r(s,a)-\tau\log\pi(a|s)+\gamma%
\mathbb{E}_{s^{\prime}}\left[\mathbb{E}^{\pi}\left[\sum_{t=0}^{\infty}\gamma^{%
t}(r(s_{t},a_{t})-\tau\log\pi(a_{t}|s_{t}))\Big{|}s_{0}=s^{\prime}\right]%
\right]\right]
\displaystyle=\mathbb{E}_{a\sim\pi(s)}\left[r(s,a)-\tau\log\pi(a|s)+\gamma%
\mathbb{E}_{s^{\prime}\sim P(s,a)}[\tilde{v}^{\pi}(s^{\prime})]\right]
\displaystyle=\mathbb{E}_{a\sim\pi(s)}\left[r(s,a)-\tau\log\pi(a|s)+\gamma%
\mathbb{E}_{s^{\prime}\sim P(s,a)}[\tilde{v}^{\pi}(s^{\prime})]\right]
\displaystyle=\mathbb{E}_{a\sim\pi(s)}\left[\tilde{q}^{\pi}(s,a)-\tau\log\pi(a%
|s)\right]\,.
\displaystyle=\mathbb{E}_{a\sim\pi(s)}\left[\tilde{q}^{\pi}(s,a)-\tau\log\pi(a%
|s)\right]\,.
\displaystyle\tilde{q}^{\pi}(s,a)=r(s,a)+\mathbb{E}_{s^{\prime}}[\tilde{v}^{%
\pi}(s^{\prime})]
\displaystyle\tilde{q}^{\pi}(s,a)
\displaystyle=r(s,a)+\mathbb{E}_{s^{\prime}}[\tilde{v}^{\pi}(s^{\prime})]
\displaystyle=r(s,a)+\mathbb{E}_{s^{\prime}}[\mathbb{E}_{a\sim\pi(s^{\prime})}%
\left[\tilde{q}^{\pi}(s^{\prime},a^{\prime})-\tau\log\pi(a^{\prime}|s^{\prime}%
)\right]]
\displaystyle=r(s,a)+\mathbb{E}_{s^{\prime}}[\mathbb{E}_{a\sim\pi(s^{\prime})}%
\left[\tilde{q}^{\pi}(s^{\prime},a^{\prime})-\tau\log\pi(a^{\prime}|s^{\prime}%
)\right]]
\displaystyle=r(s,a)+\mathbb{E}_{s^{\prime},a^{\prime}\sim P^{\pi}(s,a)}[%
\tilde{q}^{\pi}(s^{\prime},a^{\prime})-\tau\log\pi(a^{\prime}|s^{\prime})]
\displaystyle=r(s,a)+\mathbb{E}_{s^{\prime},a^{\prime}\sim P^{\pi}(s,a)}[%
\tilde{q}^{\pi}(s^{\prime},a^{\prime})-\tau\log\pi(a^{\prime}|s^{\prime})]
\displaystyle={\mathcal{T}}^{\pi}\tilde{q}^{\pi}\,.
\displaystyle={\mathcal{T}}^{\pi}\tilde{q}^{\pi}\,.
|{\mathcal{A}}|<\infty
\log\pi(a|s)
s,a
{\mathcal{T}}^{\pi}
\tilde{q}^{\pi}
{\mathcal{T}}^{\pi}
q
\tilde{q}^{\pi}
q={\mathcal{T}}^{\pi}q
\pi
q
\displaystyle\|({\mathcal{T}}^{\pi})^{k}q-\tilde{q}^{\pi}\|_{\infty}\leq\gamma%
^{k}\|q-\tilde{q}^{\pi}\|_{\infty}\,.
\displaystyle\|({\mathcal{T}}^{\pi})^{k}q-\tilde{q}^{\pi}\|_{\infty}\leq\gamma%
^{k}\|q-\tilde{q}^{\pi}\|_{\infty}\,.
k=0
k-1
\displaystyle\|({\mathcal{T}}^{\pi})^{k}q-\tilde{q}^{\pi}\|_{\infty}=\max_{s,a%
}\left|({\mathcal{T}}^{\pi})^{k}q(s,a)-\tilde{q}^{\pi}(s,a)\right|
\displaystyle\|({\mathcal{T}}^{\pi})^{k}q-\tilde{q}^{\pi}\|_{\infty}
\displaystyle=\max_{s,a}\left|({\mathcal{T}}^{\pi})^{k}q(s,a)-\tilde{q}^{\pi}(%
s,a)\right|
\displaystyle=\max_{s,a}\left|{\mathcal{T}}^{\pi}({\mathcal{T}}^{\pi})^{k-1}q(%
s,a)-{\mathcal{T}}^{\pi}\tilde{q}^{\pi}(s,a)\right|
\displaystyle=\max_{s,a}\left|{\mathcal{T}}^{\pi}({\mathcal{T}}^{\pi})^{k-1}q(%
s,a)-{\mathcal{T}}^{\pi}\tilde{q}^{\pi}(s,a)\right|
\displaystyle=\gamma\max_{s,a}\left|\mathbb{E}_{s^{\prime},a^{\prime}\sim P^{%
\pi}(s,a)}\left[({\mathcal{T}}^{\pi})^{k-1}q(s^{\prime},a^{\prime})-\tilde{q}^%
{\pi}(s^{\prime},a^{\prime})\right]\right|
\displaystyle=\gamma\max_{s,a}\left|\mathbb{E}_{s^{\prime},a^{\prime}\sim P^{%
\pi}(s,a)}\left[({\mathcal{T}}^{\pi})^{k-1}q(s^{\prime},a^{\prime})-\tilde{q}^%
{\pi}(s^{\prime},a^{\prime})\right]\right|
\displaystyle\leq\gamma\max_{s,a}\left|({\mathcal{T}}^{\pi})^{k-1}q(s,a)-%
\tilde{q}^{\pi}(s,a)\right|
\displaystyle\leq\gamma\max_{s,a}\left|({\mathcal{T}}^{\pi})^{k-1}q(s,a)-%
\tilde{q}^{\pi}(s,a)\right|
\displaystyle=\gamma^{k}\|q-\tilde{q}^{\pi}\|_{\infty}\,,
\displaystyle=\gamma^{k}\|q-\tilde{q}^{\pi}\|_{\infty}\,,
{\mathcal{T}}^{\pi}
\pi
q_{1}\geq q_{2}
{\mathcal{T}}^{\pi}q_{1}\geq{\mathcal{T}}^{\pi}q_{2}
q_{1}\geq q_{2}
s,a
\displaystyle({\mathcal{T}}^{\pi}q_{1})(s,a)-({\mathcal{T}}^{\pi}q_{2})(s,a)=%
\gamma\mathbb{E}_{s^{\prime},a^{\prime}\sim P^{\pi}(s,a)}\left[q_{1}(s^{\prime%
},a^{\prime})-q_{2}(s^{\prime},a^{\prime})\right]\geq 0\,.
\displaystyle({\mathcal{T}}^{\pi}q_{1})(s,a)-({\mathcal{T}}^{\pi}q_{2})(s,a)=%
\gamma\mathbb{E}_{s^{\prime},a^{\prime}\sim P^{\pi}(s,a)}\left[q_{1}(s^{\prime%
},a^{\prime})-q_{2}(s^{\prime},a^{\prime})\right]\geq 0\,.
\pi
\pi\preceq\beta
\pi^{\prime}
\displaystyle\pi^{\prime}(\cdot|s)\propto{\beta(\cdot|s)\exp\left(\frac{\tilde%
{q}^{\pi}(s,:)}{\tau}-\log\beta(\cdot|s)\right)}\,.
\displaystyle\pi^{\prime}(\cdot|s)\propto{\beta(\cdot|s)\exp\left(\frac{\tilde%
{q}^{\pi}(s,:)}{\tau}-\log\beta(\cdot|s)\right)}\,.
\pi^{\prime}\preceq\beta
\tilde{q}^{\pi^{\prime}}\geq\tilde{q}^{\pi}
\pi^{\prime}
s\in{\mathcal{S}}
\displaystyle\pi^{\prime}(\cdot|s)\cdot\left(\tilde{q}^{\pi}(s,:)-\tau\log%
\tilde{\pi}(\cdot|s)\right)\geq\pi(\cdot|s)\cdot\left(\tilde{q}^{\pi}(s,:)-%
\tau\log\pi(\cdot|s)\right)\,.
\displaystyle\pi^{\prime}(\cdot|s)\cdot\left(\tilde{q}^{\pi}(s,:)-\tau\log%
\tilde{\pi}(\cdot|s)\right)\geq\pi(\cdot|s)\cdot\left(\tilde{q}^{\pi}(s,:)-%
\tau\log\pi(\cdot|s)\right)\,.
s,a\in{\mathcal{S}}\times{\mathcal{A}}
\displaystyle\tilde{q}^{\pi}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime},a^{%
\prime}\sim P^{\pi}(\cdot|s,a)}[\tilde{q}^{\pi}(s^{\prime},a^{\prime})-\tau%
\log\pi(a^{\prime}|s^{\prime})]
\displaystyle\tilde{q}^{\pi}(s,a)
\displaystyle=r(s,a)+\gamma\mathbb{E}_{s^{\prime},a^{\prime}\sim P^{\pi}(\cdot%
|s,a)}[\tilde{q}^{\pi}(s^{\prime},a^{\prime})-\tau\log\pi(a^{\prime}|s^{\prime%
})]
\displaystyle\leq r(s,a)+\gamma\mathbb{E}_{s^{\prime},a^{\prime}\sim P^{\pi^{%
\prime}}(\cdot|s,a)}[\tilde{q}^{\pi}(s^{\prime},a^{\prime})-\tau\log\pi^{%
\prime}(a^{\prime}|s^{\prime})]
\displaystyle\leq r(s,a)+\gamma\mathbb{E}_{s^{\prime},a^{\prime}\sim P^{\pi^{%
\prime}}(\cdot|s,a)}[\tilde{q}^{\pi}(s^{\prime},a^{\prime})-\tau\log\pi^{%
\prime}(a^{\prime}|s^{\prime})]
\displaystyle\leq\dots
\displaystyle\leq\dots
\displaystyle\leq\tilde{q}^{\pi^{\prime}}(s,a)\,,
\displaystyle\leq\tilde{q}^{\pi^{\prime}}(s,a)\,,
\tilde{q}^{\pi}
\beta
\displaystyle\max_{\pi\preceq\beta}\tilde{v}^{\pi}(s)\quad\text{for all $s\in{%
\mathcal{S}}$}
s\in{\mathcal{S}}
\displaystyle\max_{\pi\preceq\beta}\tilde{v}^{\pi}(s)\quad\text{for all $s\in{%
\mathcal{S}}$}
s\in{\mathcal{S}}
\tau>0
\displaystyle({\mathcal{T}}^{*}_{\beta}q)(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{%
\prime}\sim P(\cdot|s,a)}\left[\tau\log\sum\nolimits_{a^{\prime}:\beta(a^{%
\prime}|s^{\prime})>0}\exp\left({{q}(s^{\prime},a^{\prime})}/{\tau}\right)\right]
\displaystyle({\mathcal{T}}^{*}_{\beta}q)(s,a)
\displaystyle=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim P(\cdot|s,a)}\left[\tau%
\log\sum\nolimits_{a^{\prime}:\beta(a^{\prime}|s^{\prime})>0}\exp\left({{q}(s^%
{\prime},a^{\prime})}/{\tau}\right)\right]
\displaystyle=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim P(\cdot|s,a)}\left[F_{%
\beta,\tau}(q(s^{\prime},:))\right]
\displaystyle=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim P(\cdot|s,a)}\left[F_{%
\beta,\tau}(q(s^{\prime},:))\right]
\gamma<1
q^{*}={\mathcal{T}}^{*}_{\beta}q^{*}
{\mathcal{T}}^{*}_{\beta}
q_{1}
q_{2}
\displaystyle\left\|{\mathcal{T}}_{\beta}^{*}q_{1}-{\mathcal{T}}_{\beta}^{*}q_%
{2}\right\|_{\infty}=\gamma\max_{s,a}\left|{\mathcal{T}}_{\beta}^{*}q_{1}(s,a)%
-{\mathcal{T}}_{\beta}^{*}q_{2}(s,a)\right|
\displaystyle\left\|{\mathcal{T}}_{\beta}^{*}q_{1}-{\mathcal{T}}_{\beta}^{*}q_%
{2}\right\|_{\infty}
\displaystyle=\gamma\max_{s,a}\left|{\mathcal{T}}_{\beta}^{*}q_{1}(s,a)-{%
\mathcal{T}}_{\beta}^{*}q_{2}(s,a)\right|
\displaystyle=\gamma\max_{s,a}\left|\mathbb{E}_{s^{\prime}\sim P(\cdot|s,a)}%
\left[F_{\beta,\tau}(q_{1}(s^{\prime},:))-F_{\beta,\tau}(q_{2}(s^{\prime},:))%
\right]\right|
\displaystyle=\gamma\max_{s,a}\left|\mathbb{E}_{s^{\prime}\sim P(\cdot|s,a)}%
\left[F_{\beta,\tau}(q_{1}(s^{\prime},:))-F_{\beta,\tau}(q_{2}(s^{\prime},:))%
\right]\right|
\displaystyle\leq\gamma\max_{s}\left|F_{\beta,\tau}(q_{1}(s,:))-F_{\beta,\tau}%
(q_{2}(s,:))\right|
\displaystyle\leq\gamma\max_{s}\left|F_{\beta,\tau}(q_{1}(s,:))-F_{\beta,\tau}%
(q_{2}(s,:))\right|
\displaystyle\leq\gamma\max_{s,a}\left|q_{1}(s,a)-q_{2}(s,a)\right|
\displaystyle\leq\gamma\max_{s,a}\left|q_{1}(s,a)-q_{2}(s,a)\right|
\displaystyle=\gamma\left\|q_{1}-q_{2}\right\|\,,
\displaystyle=\gamma\left\|q_{1}-q_{2}\right\|\,,
{\mathcal{T}}_{\beta}^{*}
\tilde{q}^{*}_{\beta}
{\mathcal{T}}^{*}_{\beta}
q
q\geq{\mathcal{T}}^{*}_{\beta}q
\pi
q\geq\tilde{q}^{\pi}
\pi
q\geq{\mathcal{T}}_{\beta}^{*}q
q\geq({\mathcal{T}}^{\pi})^{k}q
k\geq 0
\displaystyle q\geq{\mathcal{T}}^{*}_{\beta}q=r(s,a)+\gamma\mathbb{E}_{s^{%
\prime}}[F_{\beta,\tau}(q(s^{\prime},:))]
\displaystyle q\geq{\mathcal{T}}^{*}_{\beta}q
\displaystyle=r(s,a)+\gamma\mathbb{E}_{s^{\prime}}[F_{\beta,\tau}(q(s^{\prime}%
,:))]
\displaystyle\geq r(s,a)+\gamma\mathbb{E}_{s^{\prime}}\left[\sum_{a^{\prime}}%
\pi(a^{\prime}|s^{\prime})(q(s^{\prime},a^{\prime})-\tau\log\pi(a^{\prime}|s^{%
\prime}))\right]
\displaystyle\geq r(s,a)+\gamma\mathbb{E}_{s^{\prime}}\left[\sum_{a^{\prime}}%
\pi(a^{\prime}|s^{\prime})(q(s^{\prime},a^{\prime})-\tau\log\pi(a^{\prime}|s^{%
\prime}))\right]
\displaystyle={\mathcal{T}}^{\pi}q\,,
\displaystyle={\mathcal{T}}^{\pi}q\,,
\displaystyle q\geq{\mathcal{T}}^{\pi}q\geq{\mathcal{T}}^{\pi}{\mathcal{T}}^{*%
}_{\beta}q\geq{\mathcal{T}}^{\pi}{\mathcal{T}}^{\pi}q\geq\cdots\geq({\mathcal{%
T}}^{\pi})^{k}q\,.
\displaystyle q\geq{\mathcal{T}}^{\pi}q\geq{\mathcal{T}}^{\pi}{\mathcal{T}}^{*%
}_{\beta}q\geq{\mathcal{T}}^{\pi}{\mathcal{T}}^{\pi}q\geq\cdots\geq({\mathcal{%
T}}^{\pi})^{k}q\,.
s\in{\mathcal{S}}
\tilde{v}^{*}_{\beta}(s)=\max_{\pi\preceq\beta}\tilde{v}^{*}(s)
\tilde{v}_{\beta}^{*}\geq\max_{\pi\preceq\beta}\tilde{v}^{\pi}
\displaystyle\tilde{v}_{\beta}^{*}=F_{\beta,\tau}(\tilde{q}_{\beta}^{*})
\displaystyle\tilde{v}_{\beta}^{*}
\displaystyle=F_{\beta,\tau}(\tilde{q}_{\beta}^{*})
\displaystyle=\tilde{\pi}_{\beta}^{*}\cdot\left(\tilde{q}_{\beta}^{*}-\tau\log%
\tilde{\pi}_{\beta}^{*}\right)
\displaystyle=\tilde{\pi}_{\beta}^{*}\cdot\left(\tilde{q}_{\beta}^{*}-\tau\log%
\tilde{\pi}_{\beta}^{*}\right)
\displaystyle\geq\pi\cdot\left(\tilde{q}_{\beta}^{*}-\tau\log\pi\right)\quad(%
\pi\preceq\beta)
\displaystyle\geq\pi\cdot\left(\tilde{q}_{\beta}^{*}-\tau\log\pi\right)\quad(%
\pi\preceq\beta)
\displaystyle\geq\pi\cdot\left(\tilde{q}^{\pi}-\tau\log\pi\right)\quad(\pi%
\preceq\beta)
\displaystyle\geq\pi\cdot\left(\tilde{q}^{\pi}-\tau\log\pi\right)\quad(\pi%
\preceq\beta)
\displaystyle=\tilde{v}^{\pi}\,,
\displaystyle=\tilde{v}^{\pi}\,,
\max_{\pi\preceq\beta}\tilde{v}^{\pi}\geq\tilde{v}_{\beta}^{*}
\tilde{q}_{\beta}^{*}=\tilde{q}^{\tilde{\pi}_{\beta}^{*}}
\tilde{q}_{\beta}^{*}
{\mathcal{T}}^{*}_{\beta}
{\mathcal{T}}^{*}_{\beta}\tilde{q}^{\tilde{\pi}_{\beta}^{*}}=\tilde{q}^{\tilde%
{\pi}_{\beta}^{*}}
(s,a)
\displaystyle{\mathcal{T}}^{*}_{\beta}\tilde{q}^{\tilde{\pi}_{\beta}^{*}}(s,a)%
=r(s,a)+\gamma\mathbb{E}_{s^{\prime}}\left[F_{\beta,\tau}(\tilde{q}^{\tilde{%
\pi}_{\beta}^{*}}(s^{\prime},:))\right]
\displaystyle{\mathcal{T}}^{*}_{\beta}\tilde{q}^{\tilde{\pi}_{\beta}^{*}}(s,a)
\displaystyle=r(s,a)+\gamma\mathbb{E}_{s^{\prime}}\left[F_{\beta,\tau}(\tilde{%
q}^{\tilde{\pi}_{\beta}^{*}}(s^{\prime},:))\right]
\displaystyle=r(s,a)+\gamma\mathbb{E}_{s^{\prime}}\left[\sum_{a^{\prime}}%
\tilde{\pi}_{\beta}^{*}(a^{\prime}|s^{\prime})\left(\tilde{q}^{\tilde{\pi}_{%
\beta}^{*}}(s^{\prime},a^{\prime})-\tau\log\tilde{\pi}_{\beta}^{*}(a^{\prime}|%
s^{\prime})\right)\right]
\displaystyle=r(s,a)+\gamma\mathbb{E}_{s^{\prime}}\left[\sum_{a^{\prime}}%
\tilde{\pi}_{\beta}^{*}(a^{\prime}|s^{\prime})\left(\tilde{q}^{\tilde{\pi}_{%
\beta}^{*}}(s^{\prime},a^{\prime})-\tau\log\tilde{\pi}_{\beta}^{*}(a^{\prime}|%
s^{\prime})\right)\right]
\displaystyle={\mathcal{T}}^{\tilde{\pi}_{\beta}^{*}}\tilde{q}^{\tilde{\pi}_{%
\beta}^{*}}(s,a)
\displaystyle={\mathcal{T}}^{\tilde{\pi}_{\beta}^{*}}\tilde{q}^{\tilde{\pi}_{%
\beta}^{*}}(s,a)
\displaystyle=\tilde{q}^{\tilde{\pi}_{\beta}^{*}}(s,a)\,,
\displaystyle=\tilde{q}^{\tilde{\pi}_{\beta}^{*}}(s,a)\,,
\displaystyle\max_{\pi\preceq\beta}\tilde{v}^{\pi}\geq\tilde{v}^{\tilde{\pi}_{%
\beta}^{*}}=\tilde{\pi}_{\beta}^{*}\cdot\left(\tilde{q}^{\tilde{\pi}_{\beta}^{%
*}}-\tau\log\tilde{\pi}_{\beta}^{*}\right)=\tilde{\pi}_{\beta}^{*}\cdot\left(%
\tilde{q}_{\beta}^{*}-\tau\log\tilde{\pi}_{\beta}^{*}\right)=\tilde{v}^{*}_{%
\beta}\,,
\displaystyle\max_{\pi\preceq\beta}\tilde{v}^{\pi}\geq\tilde{v}^{\tilde{\pi}_{%
\beta}^{*}}=\tilde{\pi}_{\beta}^{*}\cdot\left(\tilde{q}^{\tilde{\pi}_{\beta}^{%
*}}-\tau\log\tilde{\pi}_{\beta}^{*}\right)=\tilde{\pi}_{\beta}^{*}\cdot\left(%
\tilde{q}_{\beta}^{*}-\tau\log\tilde{\pi}_{\beta}^{*}\right)=\tilde{v}^{*}_{%
\beta}\,,
\tilde{q}_{\beta}^{*}=\tilde{q}^{\tilde{\pi}_{\beta}^{*}}
\tilde{q}_{\beta}^{*}
\displaystyle\tilde{q}^{*}_{\beta}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}%
\sim P(\cdot|s,a)}\left[\tau\log\sum_{a^{\prime}:\beta(a^{\prime}|s^{\prime})>%
0}\exp\left({\tilde{q}_{\beta}^{*}(s^{\prime},a^{\prime})}/{\tau}\right)\right%
]\,,
\displaystyle\tilde{q}^{*}_{\beta}(s,a)=r(s,a)+\gamma\mathbb{E}_{s^{\prime}%
\sim P(\cdot|s,a)}\left[\tau\log\sum_{a^{\prime}:\beta(a^{\prime}|s^{\prime})>%
0}\exp\left({\tilde{q}_{\beta}^{*}(s^{\prime},a^{\prime})}/{\tau}\right)\right%
]\,,
\tilde{\pi}^{*}_{\beta}
\displaystyle\tilde{\pi}_{\beta}^{*}(a|s)\propto\beta(a|s)\exp\left({\tilde{q}%
^{*}_{\beta}(s,a)}/{\tau}-\log\beta(a|s)\right)\,.
\displaystyle\tilde{\pi}_{\beta}^{*}(a|s)\propto\beta(a|s)\exp\left({\tilde{q}%
^{*}_{\beta}(s,a)}/{\tau}-\log\beta(a|s)\right)\,.
\tilde{q}^{*}_{\beta}\rightarrow q^{*}_{\beta}
\tilde{\pi}_{\beta}^{*}\rightarrow\pi_{\beta}^{*}
\tau\rightarrow 0
\tilde{q}^{*}_{\beta}(s,a)=\max_{\pi\preceq\beta}\tilde{q}^{*}(s,a)
s,a
\tilde{q}^{*}
1\%
99\%
10
10
-20
-20
10
0
-20
10
5
95\%
10
0
-20
10
5
95\%
2
4\%
96\%
10
10
95\%
2
4\%
96\%
10
10
95\%
10
10
10
10
10
5
95\%
10
5
95\%
10
5
10
5
10
5
10
5
10
10
10
10
5
5
5
5
13\times 13
+1
0
0.9
10
100
\tau
0.01
4
10
10
10
100
9900
[0.1,0.03,0.01,0.003,0.001]
[0.1,0.03,0.01,0.003,0.001,0.0003,0.0001,0.00003]
\tau
2
256
2
64
100
0.995\times target\_weight+0.005\times learning\_weight
0.8
70
0.8
5
500
2000
1000
10
\{3\times 10^{-4},1\times 10^{-4},3\times 10^{-5}\}
\tau
\{1.0,0.5,0.33,0.1,0.01\}
\lambda
\{1.0,0.5,0.33,0.1,0.01\}
\{0.9,0.7\}
\{10.0,3.0\}
\alpha=2.5
\{0.003,0.001,0.0003,0.0001,3e-5,1e-5\}
\tau
\{1.0,0.5,0.1,0.05,0.01\}
\lambda=1.0
\alpha=5.0
