\mathbf{w}
\mathbf{X}_{\text{train}}
\mathbf{y}_{\text{train}}
\displaystyle\operatorname{P}\left(\mathbf{w}|\mathbf{X}_{\text{train}},%
\mathbf{y}_{\text{train}}\right)=\frac{\operatorname{P}\left(\mathbf{y}_{\text%
{train}}|\mathbf{X}_{\text{train}},\mathbf{w}\right)\operatorname{P}\left(%
\mathbf{w}\right)}{\operatorname{P}\left(\mathbf{y}_{\text{train}}|\mathbf{X}_%
{\text{train}}\right)}.
\displaystyle\operatorname{P}\left(\mathbf{w}|\mathbf{X}_{\text{train}},%
\mathbf{y}_{\text{train}}\right)
\displaystyle=\frac{\operatorname{P}\left(\mathbf{y}_{\text{train}}|\mathbf{X}%
_{\text{train}},\mathbf{w}\right)\operatorname{P}\left(\mathbf{w}\right)}{%
\operatorname{P}\left(\mathbf{y}_{\text{train}}|\mathbf{X}_{\text{train}}%
\right)}.
\mathbf{y}_{\text{test}}
\mathbf{X}_{\text{test}}
\operatorname{P}\left(\mathbf{y}_{\text{test}}\mid\mathbf{X}_{\text{test}},%
\mathbf{X}_{\text{train}},\mathbf{y}_{\text{train}}\right)=\int\operatorname{P%
}\left(\mathbf{y}_{\text{test}}\mid\mathbf{X}_{\text{test}},\mathbf{w}\right)%
\operatorname{P}\left(\mathbf{w}|\mathbf{X}_{\text{train}},\mathbf{y}_{\text{%
train}}\right)d\mathbf{w}.
\mathbf{X}_{\text{train}}\in\mathbb{R}^{N_{\text{train}}\times M}
\displaystyle\operatorname{P}_{\text{EmpCov}}\left(\mathbf{w}|\mathbf{X}_{%
\text{train}}\right)=\mathcal{N}\left(\mathbf{w};\mathbf{0},\tfrac{1}{M}\left(%
\tfrac{1}{N_{\text{train}}}\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{\text{%
train}}\right)\right)
\displaystyle\operatorname{P}_{\text{EmpCov}}\left(\mathbf{w}|\mathbf{X}_{%
\text{train}}\right)
\displaystyle=\mathcal{N}\left(\mathbf{w};\mathbf{0},\tfrac{1}{M}\left(\tfrac{%
1}{N_{\text{train}}}\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{\text{train}}%
\right)\right)
N_{\text{train}}
M
\mathbf{w}\in\mathbb{R}^{M}
\tfrac{1}{MN_{\text{train}}}\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{\text{%
train}}
\displaystyle\operatorname{P}_{\text{Zellner-G}}\left(\mathbf{w}|\mathbf{X}_{%
\text{train}}\right)=\mathcal{N}\left(\mathbf{w};\mathbf{0},\tfrac{1}{M}\left(%
\tfrac{1}{N_{\text{train}}}\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{\text{%
train}}\right)^{-1}\right).
\displaystyle\operatorname{P}_{\text{Zellner-G}}\left(\mathbf{w}|\mathbf{X}_{%
\text{train}}\right)
\displaystyle=\mathcal{N}\left(\mathbf{w};\mathbf{0},\tfrac{1}{M}\left(\tfrac{%
1}{N_{\text{train}}}\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{\text{train}}%
\right)^{-1}\right).
21.9\%
10.6\%
24.6\%
12.4\%
C
W
H
C\times C
N_{\text{mini}}=128
HW\times HW=784\times 784
\mathbf{f}=\mathbf{X}\mathbf{w}\in\mathbb{R}^{P}
P
\displaystyle\operatorname{P}_{\text{EmpCov}}\left(\mathbf{f}\middle|\mathbf{X%
}_{\text{test}}\right)=\mathcal{N}\left(\mathbf{f};\mathbf{0},\tfrac{1}{MN_{%
\text{train}}}\mathbf{X}_{\text{test}}\left(\mathbf{X}_{\text{train}}^{\top}%
\mathbf{X}_{\text{train}}\right)\mathbf{X}_{\text{test}}^{\top}\right)
\displaystyle\operatorname{P}_{\text{EmpCov}}\left(\mathbf{f}\middle|\mathbf{X%
}_{\text{test}}\right)
\displaystyle=\mathcal{N}\left(\mathbf{f};\mathbf{0},\tfrac{1}{MN_{\text{train%
}}}\mathbf{X}_{\text{test}}\left(\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{%
\text{train}}\right)\mathbf{X}_{\text{test}}^{\top}\right)
\mathbf{f}
\displaystyle\operatorname{ShiftEmpCov}(\mathbf{X}_{\text{test}};\mathbf{X}_{%
\text{train}})=\mathbf{X}_{\text{test}}\left(\tfrac{1}{N_{\text{train}}}%
\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{\text{train}}\right)^{1/2}.
\displaystyle\operatorname{ShiftEmpCov}(\mathbf{X}_{\text{test}};\mathbf{X}_{%
\text{train}})=\mathbf{X}_{\text{test}}\left(\tfrac{1}{N_{\text{train}}}%
\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{\text{train}}\right)^{1/2}.
\operatorname{ShiftEmpCov}
\mathbf{X}_{\text{test}}
\mathbf{X}_{\text{train}}
\mathbf{f}
\mathbf{f}=\operatorname{ShiftEmpCov}(\mathbf{X}_{\text{test}};\mathbf{X}_{%
\text{train}})\mathbf{w}
\operatorname{P}\left(\mathbf{w}\right)=\mathcal{N}\left(0,\tfrac{1}{M}\mathbf%
{I}\right)
\mathbf{f}
\displaystyle\operatorname{P}_{\operatorname{ShiftEmpCov}}\left(\mathbf{y}_{%
\text{train}}|\mathbf{X}_{\text{train}},\mathbf{w}\right)=\text{Categorical}(%
\mathbf{y}_{\text{train}};\pi_{\operatorname{ShiftEmpCov};\mathbf{X}_{\text{%
train}}}(\mathbf{X}_{\text{train}},\mathbf{w})),
\displaystyle\operatorname{P}_{\operatorname{ShiftEmpCov}}\left(\mathbf{y}_{%
\text{train}}|\mathbf{X}_{\text{train}},\mathbf{w}\right)
\displaystyle=\text{Categorical}(\mathbf{y}_{\text{train}};\pi_{\operatorname{%
ShiftEmpCov};\mathbf{X}_{\text{train}}}(\mathbf{X}_{\text{train}},\mathbf{w})),
\displaystyle\operatorname{P}_{\operatorname{ShiftEmpCov}}\left(\mathbf{y}_{%
\text{test}}|\mathbf{X}_{\text{test}},\mathbf{w},\mathbf{X}_{\text{train}}%
\right)=\text{Categorical}(\mathbf{y}_{\text{test}};\pi_{\operatorname{%
ShiftEmpCov};\mathbf{X}_{\text{train}}}(\mathbf{X}_{\text{test}},\mathbf{w})).
\displaystyle\operatorname{P}_{\operatorname{ShiftEmpCov}}\left(\mathbf{y}_{%
\text{test}}|\mathbf{X}_{\text{test}},\mathbf{w},\mathbf{X}_{\text{train}}\right)
\displaystyle=\text{Categorical}(\mathbf{y}_{\text{test}};\pi_{\operatorname{%
ShiftEmpCov};\mathbf{X}_{\text{train}}}(\mathbf{X}_{\text{test}},\mathbf{w})).
\pi_{\operatorname{ShiftEmpCov};\mathbf{X}_{\text{train}}}
\mathbf{X}_{\text{train}}
\mathbf{X}_{\text{train}}
\mathbf{X}_{\text{test}}
\mathbf{w}
\pi_{\operatorname{ShiftEmpCov};\mathbf{X}_{\text{train}}}(\bm{\cdot},\mathbf{%
w})
\pi_{\operatorname{ShiftEmpCov};\mathbf{X}_{\text{train}}}(\bm{\cdot},\mathbf{%
w})
\displaystyle\operatorname{ShiftMatch}(\mathbf{H}_{\text{test}};\mathbf{H}_{%
\text{train}})=\mathbf{\tilde{H}}_{\text{test}}\left(\tfrac{1}{N_{\text{test}}%
}\mathbf{\tilde{H}}_{\text{test}}^{\top}\mathbf{\tilde{H}}_{\text{test}}\right%
)^{-1/2}\left(\tfrac{1}{N_{\text{train}}}\mathbf{\tilde{H}}_{\text{train}}^{%
\top}\mathbf{\tilde{H}}_{\text{train}}\right)^{1/2}+\mathbf{M}_{\text{train}},
\displaystyle\operatorname{ShiftMatch}(\mathbf{H}_{\text{test}};\mathbf{H}_{%
\text{train}})=\mathbf{\tilde{H}}_{\text{test}}\left(\tfrac{1}{N_{\text{test}}%
}\mathbf{\tilde{H}}_{\text{test}}^{\top}\mathbf{\tilde{H}}_{\text{test}}\right%
)^{-1/2}\left(\tfrac{1}{N_{\text{train}}}\mathbf{\tilde{H}}_{\text{train}}^{%
\top}\mathbf{\tilde{H}}_{\text{train}}\right)^{1/2}+\mathbf{M}_{\text{train}},
\mathbf{\tilde{H}}_{\text{test}}
\mathbf{\tilde{H}}_{\text{train}}
\mathbf{M}_{\text{train}}
\displaystyle\!\!\!\tfrac{1}{N_{\text{test}}}\left(\operatorname{ShiftMatch}(%
\mathbf{H}_{\text{test}};\mathbf{H}_{\text{train}}){-}\mathbf{M}_{\text{train}%
}\right)\left(\operatorname{ShiftMatch}(\mathbf{H}_{\text{test}};\mathbf{H}_{%
\text{train}}){-}\mathbf{M}_{\text{train}}\right)^{\top}{=}\tfrac{1}{N_{\text{%
train}}}\mathbf{\tilde{H}}_{\text{train}}^{\top}\mathbf{\tilde{H}}_{\text{%
train}}
\displaystyle\!\!\!\tfrac{1}{N_{\text{test}}}\left(\operatorname{ShiftMatch}(%
\mathbf{H}_{\text{test}};\mathbf{H}_{\text{train}}){-}\mathbf{M}_{\text{train}%
}\right)\left(\operatorname{ShiftMatch}(\mathbf{H}_{\text{test}};\mathbf{H}_{%
\text{train}}){-}\mathbf{M}_{\text{train}}\right)^{\top}{=}\tfrac{1}{N_{\text{%
train}}}\mathbf{\tilde{H}}_{\text{train}}^{\top}\mathbf{\tilde{H}}_{\text{%
train}}
\displaystyle\operatorname{ShiftMatch}(\mathbf{H}_{\text{train}};\mathbf{H}_{%
\text{train}})=\mathbf{\tilde{H}}_{\text{train}}+\mathbf{M}_{\text{train}}=%
\mathbf{H}_{\text{train}},
\displaystyle\operatorname{ShiftMatch}(\mathbf{H}_{\text{train}};\mathbf{H}_{%
\text{train}})=\mathbf{\tilde{H}}_{\text{train}}+\mathbf{M}_{\text{train}}=%
\mathbf{H}_{\text{train}},
\displaystyle\operatorname{P}_{\operatorname{ShiftMatch}}\left(\mathbf{y}_{%
\text{train}}|\mathbf{X}_{\text{train}},\mathbf{w}\right)=\text{Categorical}(%
\mathbf{y}_{\text{train}};\pi_{\operatorname{ShiftMatch};\mathbf{X}_{\text{%
train}}}(\mathbf{X}_{\text{train}},\mathbf{w}))
\displaystyle\operatorname{P}_{\operatorname{ShiftMatch}}\left(\mathbf{y}_{%
\text{train}}|\mathbf{X}_{\text{train}},\mathbf{w}\right)
\displaystyle=\text{Categorical}(\mathbf{y}_{\text{train}};\pi_{\operatorname{%
ShiftMatch};\mathbf{X}_{\text{train}}}(\mathbf{X}_{\text{train}},\mathbf{w}))
\displaystyle\operatorname{P}_{\operatorname{ShiftMatch}}\left(\mathbf{y}_{%
\text{test}}|\mathbf{X}_{\text{test}},\mathbf{w},\mathbf{X}_{\text{train}}%
\right)=\text{Categorical}(\mathbf{y}_{\text{test}};\pi_{\operatorname{%
ShiftMatch};\mathbf{X}_{\text{train}}}(\mathbf{X}_{\text{test}},\mathbf{w}))
\displaystyle\operatorname{P}_{\operatorname{ShiftMatch}}\left(\mathbf{y}_{%
\text{test}}|\mathbf{X}_{\text{test}},\mathbf{w},\mathbf{X}_{\text{train}}\right)
\displaystyle=\text{Categorical}(\mathbf{y}_{\text{test}};\pi_{\operatorname{%
ShiftMatch};\mathbf{X}_{\text{train}}}(\mathbf{X}_{\text{test}},\mathbf{w}))
\displaystyle\pi_{\operatorname{ShiftMatch};\mathbf{X}_{\text{train}}}(\mathbf%
{X}_{\text{train}},\mathbf{w})=\pi(\mathbf{X}_{\text{train}},\mathbf{w})
\displaystyle\pi_{\operatorname{ShiftMatch};\mathbf{X}_{\text{train}}}(\mathbf%
{X}_{\text{train}},\mathbf{w})
\displaystyle=\pi(\mathbf{X}_{\text{train}},\mathbf{w})
\displaystyle\operatorname{P}_{\operatorname{ShiftMatch}}\left(\mathbf{y}_{%
\text{train}}|\mathbf{X}_{\text{train}},\mathbf{w}\right)=\operatorname{P}%
\left(\mathbf{y}_{\text{train}}|\mathbf{X}_{\text{train}},\mathbf{w}\right)
\displaystyle\operatorname{P}_{\operatorname{ShiftMatch}}\left(\mathbf{y}_{%
\text{train}}|\mathbf{X}_{\text{train}},\mathbf{w}\right)
\displaystyle=\operatorname{P}\left(\mathbf{y}_{\text{train}}|\mathbf{X}_{%
\text{train}},\mathbf{w}\right)
\operatorname{P}
\pi
\displaystyle\operatorname{P}_{\operatorname{ShiftMatch}}\left(\mathbf{w}|%
\mathbf{y}_{\text{train}},\mathbf{X}_{\text{train}}\right)\propto\operatorname%
{P}_{\operatorname{ShiftMatch}}\left(\mathbf{y}_{\text{train}}|\mathbf{X}_{%
\text{train}},\mathbf{w}\right)\operatorname{P}\left(\mathbf{w}\right)
\displaystyle\operatorname{P}_{\operatorname{ShiftMatch}}\left(\mathbf{w}|%
\mathbf{y}_{\text{train}},\mathbf{X}_{\text{train}}\right)
\displaystyle\propto\operatorname{P}_{\operatorname{ShiftMatch}}\left(\mathbf{%
y}_{\text{train}}|\mathbf{X}_{\text{train}},\mathbf{w}\right)\operatorname{P}%
\left(\mathbf{w}\right)
\displaystyle=\operatorname{P}\left(\mathbf{y}_{\text{train}}|\mathbf{X}_{%
\text{train}},\mathbf{w}\right)\operatorname{P}\left(\mathbf{w}\right)\propto%
\operatorname{P}\left(\mathbf{w}|\mathbf{y}_{\text{train}},\mathbf{X}_{\text{%
train}}\right).
\displaystyle=\operatorname{P}\left(\mathbf{y}_{\text{train}}|\mathbf{X}_{%
\text{train}},\mathbf{w}\right)\operatorname{P}\left(\mathbf{w}\right)\propto%
\operatorname{P}\left(\mathbf{w}|\mathbf{y}_{\text{train}},\mathbf{X}_{\text{%
train}}\right).
CHW
C
H
W
CHW\times CHW
\mathcal{O}(C^{3}H^{3}W^{3})
C
HW\times HW
H\times H
W\times W
\mathbf{X}_{\text{train}}\in\mathbb{R}^{N_{\text{train}}\times HW}
\mathbf{X}_{\text{uncor}}\in\mathbb{R}^{N_{\text{test}}\times HW}
\mathbf{S}\in\mathbb{R}^{HW\times HW}
\displaystyle\mathbf{X}_{\text{cor}}=\mathbf{X}_{\text{uncor}}\mathbf{S}\in%
\mathbb{R}^{N_{\text{test}}\times HW}.
\displaystyle\mathbf{X}_{\text{cor}}=\mathbf{X}_{\text{uncor}}\mathbf{S}\in%
\mathbb{R}^{N_{\text{test}}\times HW}.
\mathbf{X}_{\text{train}}
\mathbf{X}_{\text{uncor}}
\mathbf{S}
\displaystyle\mathbf{X}_{\text{train}}=\mathbf{U}_{\text{train}}\mathbf{D}%
\mathbf{V}^{\top}
\displaystyle\mathbf{X}_{\text{train}}
\displaystyle=\mathbf{U}_{\text{train}}\mathbf{D}\mathbf{V}^{\top}
\displaystyle\mathbf{X}_{\text{uncor}}=\mathbf{U}_{\text{test}}\mathbf{D}%
\mathbf{V}^{\top}
\displaystyle\mathbf{X}_{\text{uncor}}
\displaystyle=\mathbf{U}_{\text{test}}\mathbf{D}\mathbf{V}^{\top}
\displaystyle\mathbf{S}=\mathbf{V}\mathbf{D}_{\text{s}}\mathbf{V}^{\top}.
\displaystyle\mathbf{S}
\displaystyle=\mathbf{V}\mathbf{D}_{\text{s}}\mathbf{V}^{\top}.
\mathbf{V}
\mathbf{D}
\mathbf{X}_{\text{train}}
\mathbf{X}_{\text{uncor}}
\mathbf{V}
\displaystyle\mathbf{X}_{\text{cor}}=\mathbf{X}_{\text{uncor}}\mathbf{S}=%
\mathbf{U}_{\text{test}}\mathbf{D}\mathbf{V}^{\top}\mathbf{V}\mathbf{D}_{\text%
{s}}\mathbf{V}^{\top}=\mathbf{U}_{\text{test}}\mathbf{D}\mathbf{D}_{\text{s}}%
\mathbf{V}^{\top}.
\displaystyle\mathbf{X}_{\text{cor}}=\mathbf{X}_{\text{uncor}}\mathbf{S}=%
\mathbf{U}_{\text{test}}\mathbf{D}\mathbf{V}^{\top}\mathbf{V}\mathbf{D}_{\text%
{s}}\mathbf{V}^{\top}=\mathbf{U}_{\text{test}}\mathbf{D}\mathbf{D}_{\text{s}}%
\mathbf{V}^{\top}.
\displaystyle\operatorname{ShiftMatch}\left(\mathbf{X}_{\text{cor}};\mathbf{X}%
_{\text{train}}\right)=\mathbf{X}_{\text{cor}}\left(\tfrac{1}{N_{\text{test}}}%
\mathbf{X}_{\text{cor}}\mathbf{X}_{\text{cor}}\right)^{-1/2}\left(\tfrac{1}{N_%
{\text{train}}}\mathbf{X}_{\text{train}}\mathbf{X}_{\text{train}}\right)^{1/2}
\displaystyle\operatorname{ShiftMatch}\left(\mathbf{X}_{\text{cor}};\mathbf{X}%
_{\text{train}}\right)
\displaystyle=\mathbf{X}_{\text{cor}}\left(\tfrac{1}{N_{\text{test}}}\mathbf{X%
}_{\text{cor}}\mathbf{X}_{\text{cor}}\right)^{-1/2}\left(\tfrac{1}{N_{\text{%
train}}}\mathbf{X}_{\text{train}}\mathbf{X}_{\text{train}}\right)^{1/2}
\displaystyle=\mathbf{U}_{\text{test}}\left(\mathbf{D}\mathbf{D}_{\text{s}}%
\right)\mathbf{V}^{\top}\left(\mathbf{V}\left(\mathbf{D}\mathbf{D}_{\text{s}}%
\right)^{-1}\mathbf{V}\right)\left(\mathbf{V}\mathbf{D}\mathbf{V}^{\top}\right%
)=\mathbf{U}_{\text{test}}\mathbf{D}\mathbf{V}^{\top}=\mathbf{X}_{\text{uncor}}
\displaystyle=\mathbf{U}_{\text{test}}\left(\mathbf{D}\mathbf{D}_{\text{s}}%
\right)\mathbf{V}^{\top}\left(\mathbf{V}\left(\mathbf{D}\mathbf{D}_{\text{s}}%
\right)^{-1}\mathbf{V}\right)\left(\mathbf{V}\mathbf{D}\mathbf{V}^{\top}\right%
)=\mathbf{U}_{\text{test}}\mathbf{D}\mathbf{V}^{\top}=\mathbf{X}_{\text{uncor}}
50
24.6\%
12.4\%
1,280
1,280
\uparrow
\downarrow
\mathbf{f}=\mathbf{X}_{\text{test}}\mathbf{w}
\operatorname{P}\left(\mathbf{f}|\mathbf{X}_{\text{test}}\right)
\mathbf{f}=\mathbf{X}_{\text{test}}\mathbf{w}
\mathbf{w}
\mathbf{X}_{\text{test}}
\operatorname{P}\left(\mathbf{f}|\mathbf{X}_{\text{test}}\right)
\displaystyle\operatorname{P}\left(\mathbf{f}|\mathbf{X}_{\text{test}}\right)=%
\mathcal{N}\left(\mathbf{f};\bm{\mu},\mathbf{\Sigma}\right).
\displaystyle\operatorname{P}\left(\mathbf{f}|\mathbf{X}_{\text{test}}\right)
\displaystyle=\mathcal{N}\left(\mathbf{f};\bm{\mu},\mathbf{\Sigma}\right).
\operatorname{P}\left(\mathbf{f}|\mathbf{X}\right)
\bm{\mu}
\mathbf{\Sigma}
\displaystyle\bm{\mu}=\operatorname{E}\left[\mathbf{f}|\mathbf{X}_{\text{test}%
}\right]=\mathbf{X}_{\text{test}}\operatorname{E}\left[\mathbf{w}\right]=%
\mathbf{0}
\displaystyle\bm{\mu}
\displaystyle=\operatorname{E}\left[\mathbf{f}|\mathbf{X}_{\text{test}}\right]%
=\mathbf{X}_{\text{test}}\operatorname{E}\left[\mathbf{w}\right]=\mathbf{0}
\operatorname{E}\left[\mathbf{w}\right]=\mathbf{0}
\displaystyle\mathbf{\Sigma}=\operatorname{E}\left[\mathbf{f}\mathbf{f}^{\top}%
|\mathbf{X}\right]=\mathbf{X}_{\text{test}}\operatorname{E}\left[\mathbf{w}%
\mathbf{w}^{\top}\right]\mathbf{X}_{\text{test}}^{\top}=\tfrac{1}{CN_{\text{%
train}}}\mathbf{X}_{\text{test}}\left(\mathbf{X}_{\text{train}}^{\top}\mathbf{%
X}_{\text{train}}\right)\mathbf{X}_{\text{test}}^{\top}
\displaystyle\mathbf{\Sigma}
\displaystyle=\operatorname{E}\left[\mathbf{f}\mathbf{f}^{\top}|\mathbf{X}%
\right]=\mathbf{X}_{\text{test}}\operatorname{E}\left[\mathbf{w}\mathbf{w}^{%
\top}\right]\mathbf{X}_{\text{test}}^{\top}=\tfrac{1}{CN_{\text{train}}}%
\mathbf{X}_{\text{test}}\left(\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{%
\text{train}}\right)\mathbf{X}_{\text{test}}^{\top}
\operatorname{E}\left[\mathbf{w}\mathbf{w}^{T}\right]=\tfrac{1}{CN_{\text{%
train}}}\mathbf{X}_{\text{train}}^{\top}\mathbf{X}_{\text{train}}
\bm{\mu}
\mathbf{S}
\mathbf{L}
\mathbf{L}
\mathbf{X}
\mathbf{w}
\mathbf{L}
\mathbf{X}
\mathbf{w}
L
\displaystyle\operatorname{P}\left(\mathbf{L}\middle|\mathbf{X}\right)=\int d%
\mathbf{w}\operatorname{P}\left(\mathbf{L}\middle|\mathbf{w},\mathbf{X}\right)%
\operatorname{P}\left(\mathbf{X}\right).
\displaystyle\operatorname{P}\left(\mathbf{L}\middle|\mathbf{X}\right)=\int d%
\mathbf{w}\operatorname{P}\left(\mathbf{L}\middle|\mathbf{w},\mathbf{X}\right)%
\operatorname{P}\left(\mathbf{X}\right).
\operatorname{P}\left(\mathbf{L}\middle|\mathbf{X}\right)
\displaystyle\mathbf{X}\rightarrow\mathbf{L}\rightarrow\mathbf{y}.
\displaystyle\mathbf{X}\rightarrow\mathbf{L}\rightarrow\mathbf{y}.
\mathbf{X}=(\mathbf{X}_{\text{train}},\mathbf{X}_{\text{test}})
\mathbf{L}=(\mathbf{L}_{\text{train}},\mathbf{L}_{\text{test}})
\mathbf{y}=(\mathbf{y}_{\text{train}},\mathbf{y}_{\text{test}})
\operatorname{P}\left(\mathbf{L}\middle|\mathbf{X}\right)
\operatorname{P}\left(\mathbf{y}\middle|\mathbf{L}\right)
\mathbf{L}
\mathbf{y}_{\text{test}}
\mathbf{L}
\mathbf{X}
\mathbf{y}_{\text{train}}
\displaystyle\operatorname{P}\left(\mathbf{L}\middle|\mathbf{X},\mathbf{y}_{%
\text{train}}\right)\propto\operatorname{P}\left(\mathbf{y}_{\text{train}}%
\middle|\mathbf{L}_{\text{train}}\right)\operatorname{P}\left(\mathbf{L}%
\middle|\mathbf{X}\right).
\displaystyle\operatorname{P}\left(\mathbf{L}\middle|\mathbf{X},\mathbf{y}_{%
\text{train}}\right)
\displaystyle\propto\operatorname{P}\left(\mathbf{y}_{\text{train}}\middle|%
\mathbf{L}_{\text{train}}\right)\operatorname{P}\left(\mathbf{L}\middle|%
\mathbf{X}\right).
\mathbf{L}=(\mathbf{L}_{\text{train}},\mathbf{L}_{\text{test}})
\mathbf{X}=(\mathbf{X}_{\text{train}},\mathbf{X}_{\text{test}})
\operatorname{P}\left(\mathbf{L}\middle|\mathbf{X}\right)
\operatorname{P}\left(\mathbf{y}_{\text{train}}\middle|\mathbf{L}_{\text{train%
}}\right)
\displaystyle\operatorname{P}\left(\mathbf{y}_{\text{test}}\middle|\mathbf{X},%
\mathbf{y}_{\text{train}}\right)=\int d\mathbf{L}\operatorname{P}\left(\mathbf%
{y}_{\text{test}}\middle|\mathbf{L}\right)\operatorname{P}\left(\mathbf{L}%
\middle|\mathbf{X},\mathbf{y}_{\text{train}}\right),
\displaystyle\operatorname{P}\left(\mathbf{y}_{\text{test}}\middle|\mathbf{X},%
\mathbf{y}_{\text{train}}\right)
\displaystyle=\int d\mathbf{L}\operatorname{P}\left(\mathbf{y}_{\text{test}}%
\middle|\mathbf{L}\right)\operatorname{P}\left(\mathbf{L}\middle|\mathbf{X},%
\mathbf{y}_{\text{train}}\right),
HW\times HW
C
HW\times HW
\mathbf{X}_{\text{test}}
\mathbf{X}_{\text{train}}
M
L
\{\phi_{1}^{m}(\cdot),\ldots,\phi_{L}^{m}(\cdot)\},m\in\{1,\ldots,M\}
m=1,2,\cdots,M
M
\mathbf{H}_{\text{train}}^{0}\leftarrow\mathbf{X}_{\text{train}}
\ell=0,1,\cdots,L-1
\mathbf{M}_{\text{train}}^{\ell,m},\bm{Q}_{\text{train}}^{\ell,.}
\mathbf{M}_{\text{train}}^{\ell,m}\leftarrow\text{Average}(\mathbf{H}_{\text{%
train}}^{\ell})
\mathbf{\tilde{H}}_{\text{train}}^{\ell}\leftarrow\mathbf{H}_{\text{train}}^{%
\ell}-\mathbf{M}_{\text{train}}^{\ell}
\bm{Q}_{\text{train}}^{\ell,m}=\left(\tfrac{1}{N_{\text{train}}^{\ell}}(%
\mathbf{\tilde{H}}_{\text{train}}^{\ell})^{\top}(\mathbf{\tilde{H}}_{\text{%
train}}^{\ell})\right)^{1/2}
\mathbf{H}_{\text{train}}^{\ell+1}\leftarrow\phi_{\ell+1}(\mathbf{H}_{\text{%
train}}^{\ell})
(\mathbf{M}_{\text{train}}^{\ell,m},\bm{Q}_{\text{train}}^{\ell,m}),\ell\in\{0%
,\ldots,L-1\}
p\leftarrow\bm{0}
m=1,2,\cdots,M
M
(\mathbf{M}_{\text{train}}^{\ell,m},\bm{Q}_{\text{train}}^{\ell,m}),\ell\in\{0%
,\ldots,L-1\}
\mathbf{H}_{\text{test}}^{0}\leftarrow\mathbf{X}_{\text{test}}
\ell=0,1,\cdots,L-1
\mathbf{M}_{\text{test}}^{\ell}\leftarrow\text{Average}(\mathbf{H}_{\text{test%
}}^{\ell})
\mathbf{\tilde{H}}_{\text{test}}^{\ell}\leftarrow\mathbf{H}_{\text{test}}^{%
\ell}-\mathbf{M}_{\text{test}}^{\ell}
\bm{Q}_{\text{test}}^{*\ell}=\left(\tfrac{1}{N_{\text{test}}^{\ell}}\mathbf{%
\tilde{H}}_{\text{test}}^{\top}\mathbf{\tilde{H}}_{\text{test}}\right)^{-1/2}
\mathbf{H}_{\text{test}}^{\ell+1}\leftarrow\phi^{m}_{\ell+1}\left(\mathbf{%
\tilde{H}}_{\text{test}}^{\ell}\bm{Q}_{\text{test}}^{*\ell}\bm{Q}_{\text{train%
}}^{\ell,m}+\mathbf{M}_{\text{train}}^{\ell,m}\right)
p\leftarrow p+\frac{1}{M}f(\mathbf{H}_{\text{test}}^{L})
f
p
0.05
10^{-4}
