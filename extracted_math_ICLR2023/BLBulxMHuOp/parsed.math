E(x)
x
x
E(x)
x
\mathbf{Notation}
x
z
p(x,z)
p(x)
p(z)
H(x)=\mathbb{E}_{p(x)}[-\log p(x)]
H(z|x)=\mathbb{E}_{p(x,z)}[-\log p(z|x)]
D_{KL}(p\|q)=\mathbb{E}_{p(x)}\left[\log\frac{p(x)}{q(x)}\right]
I(x,z)=H(x)-H(x|z)
\delta
\delta_{u}(v)=\left\{\begin{array}[]{ll}0&u\neq v\\
1&u=v\end{array}\right.
\left\{x_{i}\in\mathbb{R}^{d}\right\}_{i=1}^{N}
q(x)
\epsilon
N(\epsilon)=\mathcal{N}(0,\sigma^{2}I_{d})
\tilde{x}
\tilde{x}=x+\epsilon
\tilde{x}\sim q_{\sigma}(\tilde{x}|x)
r=g_{\beta}\circ f_{\alpha}
f_{\alpha}:\mathcal{X}\to\mathcal{Z}
\mathcal{X}
\mathcal{Z}
g_{\beta}:\mathcal{Z}\to\mathcal{X}
z
x\to\tilde{x}\to z
q(x,\tilde{x},z)=q(x)q_{\sigma}(\tilde{x}|x)q_{\alpha}(z|\tilde{x})
q_{\alpha}(z|\tilde{x})=\delta_{f(\tilde{x})}(z)
\displaystyle\mathcal{L}_{DAE}=\mathbb{E}_{q(x,\tilde{x})}\mathbb{E}_{q_{%
\alpha}(z|\tilde{x})}\log q_{\beta}(x|z)
\displaystyle\mathcal{L}_{DAE}
\displaystyle=\mathbb{E}_{q(x,\tilde{x})}\mathbb{E}_{q_{\alpha}(z|\tilde{x})}%
\log q_{\beta}(x|z)
\displaystyle=\mathbb{E}_{\tilde{x}\sim q_{\sigma}(\tilde{x})}\left[\|r(\tilde%
{x},\sigma)-x\|^{2}\right],
\displaystyle=\mathbb{E}_{\tilde{x}\sim q_{\sigma}(\tilde{x})}\left[\|r(\tilde%
{x},\sigma)-x\|^{2}\right],
\displaystyle q_{\sigma}(\tilde{x})=\int q(x)q_{\sigma}(\tilde{x}|x)dx.
\displaystyle q_{\sigma}(\tilde{x})
\displaystyle=\int q(x)q_{\sigma}(\tilde{x}|x)dx.
r^{*}(\tilde{x})
\sigma\to 0
\displaystyle r^{*}(\tilde{x},\sigma)=\arg\cdot\min_{r}\mathbb{E}_{\tilde{x}%
\sim q_{\sigma}(\tilde{x})}\left[\|r(\tilde{x})-x\|^{2}\right]
\displaystyle r^{*}(\tilde{x},\sigma)
\displaystyle=\arg\cdot\min_{r}\mathbb{E}_{\tilde{x}\sim q_{\sigma}(\tilde{x})%
}\left[\|r(\tilde{x})-x\|^{2}\right]
\displaystyle=\tilde{x}+\sigma^{2}\nabla_{x}\log q_{\sigma}(\tilde{x}).
\displaystyle=\tilde{x}+\sigma^{2}\nabla_{x}\log q_{\sigma}(\tilde{x}).
r^{*}(x)-x
\nabla_{x}\log q(x)
\sigma\to 0
x
\mathcal{X}
x\sim q(x)
z=f(x)
\mathcal{Z}
I(x,z)
\displaystyle\mathbb{E}_{q(x,\tilde{x})}\mathbb{E}_{q_{\alpha}(z|\tilde{x})}%
\log q_{\beta}(x|z)
\displaystyle\mathbb{E}_{q(x,\tilde{x})}\mathbb{E}_{q_{\alpha}(z|\tilde{x})}%
\log q_{\beta}(x|z)
\displaystyle=\mathbb{E}_{q(z,x)}\log q_{\beta}(x|z)
\displaystyle=\mathbb{E}_{q(z,x)}\log q_{\beta}(x|z)
\displaystyle\leq\mathbb{E}_{q(z,x)}\log q_{\beta}(x|z)+H_{q}(x)
\displaystyle\leq\mathbb{E}_{q(z,x)}\log q_{\beta}(x|z)+H_{q}(x)
\displaystyle=I_{q}(x,z)\qed
\displaystyle=I_{q}(x,z)\qed
x_{1},x_{2},\ldots,x_{N}\sim q(x)
q(x)
p_{\theta}(x)=\frac{1}{Z(\theta)}\exp\left(-U_{\theta}(x)\right),
U_{\theta}
\theta
Z(\theta)=\int_{x}\exp\left(-U_{\theta}(x)\right)dx
U_{\theta}(x)
\theta
L(\theta)=\mathbb{E}_{q(x)}\left[-\log p_{\theta}(x)\right]\approx\frac{1}{N}%
\sum_{i=1}^{N}-\log p_{\theta}\left(x_{i}\right).
L(\theta)
\displaystyle\nabla_{\theta}L(\theta)=\mathbb{E}_{q(x)}\left[\nabla_{\theta}U_%
{\theta}(x)\right]-\mathbb{E}_{p_{\theta}(x)}\left[\nabla_{\theta}U_{\theta}(x%
)\right]
\displaystyle\nabla_{\theta}L(\theta)
\displaystyle=\mathbb{E}_{q(x)}\left[\nabla_{\theta}U_{\theta}(x)\right]-%
\mathbb{E}_{p_{\theta}(x)}\left[\nabla_{\theta}U_{\theta}(x)\right]
p_{\theta}(x)
x_{t+1}=x_{t}-\eta\nabla_{x}U_{\theta}\left(x_{t}\right)+\sqrt{2\eta}e_{t},%
\quad e_{t}\sim\mathcal{N}(0,I)
\eta
x\to 0
t\to\infty
x_{t}
p_{\theta}(x)
p_{\theta}(x)
r_{\varphi}=g_{\beta}\circ f_{\alpha}
h_{\gamma}
\mathcal{Z}
\mathcal{X}
r_{\varphi}=g_{\beta}\circ f_{\alpha}
h_{\gamma}
\mathcal{Z}
\mathcal{X}
r_{\varphi}(\tilde{x},\sigma)=g_{\beta}\circ f_{\alpha}(\tilde{x},\sigma)
\mathcal{X}
\mathcal{X}
\tilde{x}\sim q_{\sigma}(\tilde{x}|x)
\varphi=(\alpha,\beta)
q_{\varphi}(z)
z=f_{\alpha}(\tilde{x},\sigma)
h_{\gamma}(z)
z
\mathcal{Z}
\mathcal{X}
g_{\beta}
f_{\alpha}
q(x)=\frac{q(x|\tilde{x})q(\tilde{x})}{q(\tilde{x}|x)}=\frac{q(x|\tilde{x})q(%
\tilde{x})}{q_{\sigma}(\tilde{x}|x)}\propto\frac{q(x|\tilde{x})}{q_{\sigma}(%
\tilde{x}|x)}
\tilde{x}
U(x)\approx\log q(x|\tilde{x})-\sigma_{const}
\sigma
U_{\varphi}^{c}(x,\sigma)=\frac{1}{2\sigma^{2}}\left\|x-r_{\varphi}(\tilde{x},%
\sigma)\right\|^{2}.
p(x)
x\approx h_{\gamma}(z)
p(z)=p_{x}(h_{\gamma}(z))|(\det(dh_{\gamma}/dz))|
p_{\varphi,\gamma}(x,z)=\frac{p_{\gamma}(x,z)e^{-U_{\varphi}^{c}(x)}}{Z(%
\varphi,\gamma)},Z(\varphi,\gamma)=\int p_{\gamma}(x)e^{-U_{\varphi}^{c}(x)}dx%
,p_{\gamma}(x,z)=p_{\gamma}(z)p_{\gamma}(x|z)
z=f_{\alpha}(\tilde{x},\sigma)
x\sim q(x)
\mathcal{Z}
U_{\gamma}^{s}
\displaystyle U_{\gamma}^{s}(z,\sigma)=\frac{1}{2\sigma^{2}}\left\|h_{\gamma}(%
z)-r_{\varphi}\left(\tilde{h}_{\gamma}(z),\sigma\right)\right\|^{2},
\displaystyle U_{\gamma}^{s}(z,\sigma)=\frac{1}{2\sigma^{2}}\left\|h_{\gamma}(%
z)-r_{\varphi}\left(\tilde{h}_{\gamma}(z),\sigma\right)\right\|^{2},
\displaystyle\tilde{h}_{\gamma}(z)=h_{\gamma}(z)+\epsilon,\quad\epsilon\sim%
\mathcal{N}\left(0,\sigma^{2}I_{d}\right).
\displaystyle\tilde{h}_{\gamma}(z)=h_{\gamma}(z)+\epsilon,\quad\epsilon\sim%
\mathcal{N}\left(0,\sigma^{2}I_{d}\right).
p_{\gamma}(z)
q(z|\tilde{x})
p_{\gamma}(z)=\frac{1}{Z(\gamma)}\exp\left(-U_{\gamma}^{s}(z,\sigma)\right).
z
h_{\gamma}
U_{\varphi}^{c}(x,\sigma)
\mathcal{X}
x_{1},x_{2},\ldots,x_{N}\sim q(x)
z\to x\to\tilde{x}
p(x,\tilde{x},z)=p(z)p(x|z)p(\tilde{x}|x)
p(\tilde{x}|x)=q_{\sigma}(\tilde{x}|x)
\varphi
\gamma
\tilde{x}
\displaystyle\log p(\tilde{x})=\mathbb{E}_{q(x,z|\tilde{x})}\log\frac{p(x,%
\tilde{x},z)}{q(x,z|\tilde{x})}
\displaystyle\log p(\tilde{x})
\displaystyle=\mathbb{E}_{q(x,z|\tilde{x})}\log\frac{p(x,\tilde{x},z)}{q(x,z|%
\tilde{x})}
\displaystyle+D_{KL}(q(x,z|\tilde{x})||p(x,z|\tilde{x}))
\displaystyle+D_{KL}(q(x,z|\tilde{x})||p(x,z|\tilde{x}))
\displaystyle\geq\mathbb{E}_{q(x,z|\tilde{x})}\log\frac{p(x,\tilde{x},z)}{q(x,%
z|\tilde{x})}.
\displaystyle\geq\mathbb{E}_{q(x,z|\tilde{x})}\log\frac{p(x,\tilde{x},z)}{q(x,%
z|\tilde{x})}.
\displaystyle\arg\max_{\varphi,\gamma}\mathbb{E}_{q(\tilde{x})}\mathbb{E}_{q(x%
,z|\tilde{x})}\left[\log\frac{p(x,\tilde{x},z)}{q(x,z|\tilde{x})}\right]
\displaystyle\arg\max_{\varphi,\gamma}\mathbb{E}_{q(\tilde{x})}\mathbb{E}_{q(x%
,z|\tilde{x})}\left[\log\frac{p(x,\tilde{x},z)}{q(x,z|\tilde{x})}\right]
\displaystyle\arg\max_{\varphi,\gamma}\mathbb{E}_{q(x,\tilde{x},z)}[\log p(x,%
\tilde{x},z)]
\displaystyle\arg\max_{\varphi,\gamma}\mathbb{E}_{q(x,\tilde{x},z)}[\log p(x,%
\tilde{x},z)]
\displaystyle=\arg\max_{\varphi,\gamma}\mathbb{E}_{q(x,\tilde{x},z)}\left[\log
p%
_{\varphi,\gamma}(x,z)p(\tilde{x}\mid x)\right]
\displaystyle=\arg\max_{\varphi,\gamma}\mathbb{E}_{q(x,\tilde{x},z)}\left[\log
p%
_{\varphi,\gamma}(x,z)p(\tilde{x}\mid x)\right]
\displaystyle=\arg\max_{\varphi,\gamma}\mathbb{E}_{q(x,\tilde{x},z)}\left[\log
p%
_{\varphi,\gamma}(x,z)\right]
\displaystyle=\arg\max_{\varphi,\gamma}\mathbb{E}_{q(x,\tilde{x},z)}\left[\log
p%
_{\varphi,\gamma}(x,z)\right]
\displaystyle=\arg\max_{\varphi,\gamma}\underbrace{\mathbb{E}_{q(x,z)}\left[%
\log p_{\gamma}(x,z)\right]}_{\text{Semantic energy model}}
\displaystyle=\arg\max_{\varphi,\gamma}\underbrace{\mathbb{E}_{q(x,z)}\left[%
\log p_{\gamma}(x,z)\right]}_{\text{Semantic energy model}}
\displaystyle-\underbrace{\mathbb{E}_{q(x)}\left[U_{\varphi}^{c}(x)-\log Z(%
\varphi,\gamma)\right]}_{\text{Texture energy model}}
\displaystyle-\underbrace{\mathbb{E}_{q(x)}\left[U_{\varphi}^{c}(x)-\log Z(%
\varphi,\gamma)\right]}_{\text{Texture energy model}}
H[q(x,z|\tilde{x})]
q(x,z|\tilde{x})=q(x|\tilde{x})q(z|\tilde{x})
\varphi,\gamma
\varphi
\gamma
\displaystyle\arg\max_{\gamma}\mathbb{E}_{q(x,z)}\left[\log p_{\gamma}(x,z)\right]
\displaystyle\arg\max_{\gamma}\mathbb{E}_{q(x,z)}\left[\log p_{\gamma}(x,z)\right]
\displaystyle=\arg\max_{\gamma}\mathbb{E}_{q(x,z)}\left[\log p_{\gamma}(z)+%
\log p_{\gamma}(x\mid z)\right].
\displaystyle=\arg\max_{\gamma}\mathbb{E}_{q(x,z)}\left[\log p_{\gamma}(z)+%
\log p_{\gamma}(x\mid z)\right].
h_{\gamma}
\mathcal{L}_{Dec}^{\gamma}=\mathbb{E}_{x\sim q(\tilde{x})}\left[\left\|h_{%
\gamma}\left(f_{\alpha}(\tilde{x},\sigma)\right)-x\right\|^{2}\right].
\displaystyle\mathbb{E}_{q(x)}\nabla_{\varphi}\left[U_{\varphi}^{c}(x)+\log Z(%
\varphi,\gamma)\right]
\displaystyle\mathbb{E}_{q(x)}\nabla_{\varphi}\left[U_{\varphi}^{c}(x)+\log Z(%
\varphi,\gamma)\right]
\displaystyle=\mathbb{E}_{q(x)}\left[\nabla_{\varphi}U_{\varphi}^{c}(x)\right]%
-\mathbb{E}_{p_{\varphi,\gamma}(x,z)}\left[\nabla_{\varphi}U_{\varphi}^{c}(x)%
\right].
\displaystyle=\mathbb{E}_{q(x)}\left[\nabla_{\varphi}U_{\varphi}^{c}(x)\right]%
-\mathbb{E}_{p_{\varphi,\gamma}(x,z)}\left[\nabla_{\varphi}U_{\varphi}^{c}(x)%
\right].
p_{\gamma}(z)
\mathcal{Z}
p_{(\varphi,\gamma)}(x,z)
p_{\gamma}(z)
\mathcal{Z}
K
K=20
z^{t+1}=z^{t}-\eta_{1}\nabla_{z}U_{\gamma}^{s}\left(z^{t},\sigma\right)+\sqrt{%
2\eta_{1}}e_{t},\quad e_{t}\sim\mathcal{N}(0,I).
p_{\varphi}(x|z)
z^{K}\sim\hat{p_{\gamma}}(z)
\hat{p}
x^{0}=h_{\gamma}(z^{K})
x^{t+1}=x^{t}-\eta_{2}\nabla_{x}U_{\varphi}^{c}\left(x^{t},\sigma\right)+\sqrt%
{2\eta_{2}}e_{t},\quad e_{t}\sim\mathcal{N}(0,I).
x^{0}
T
T=90
x_{1},x_{2},\ldots,x_{N}\sim q(x)
K
T
\eta_{1}
\eta_{2}
L
\{\sigma_{i}\}_{i=1}^{S}
\varphi,\gamma,
Y
l=1\to L
\{x_{i}\}_{i=1}^{n}
\{\sigma_{i}\}_{i=1}^{n}
\Delta\varphi=\nabla_{\varphi}\mathcal{L}_{DAE}^{\varphi}
\Delta\gamma=\nabla_{\gamma}\mathcal{L}_{Dec}^{\gamma}
\varphi,\gamma
\Delta\varphi,\Delta\gamma
t=0\to K-1
z^{t+1}=z^{t}-\eta_{1}\nabla_{z}U_{\gamma}^{s}\left(z^{t},\sigma\right)+\sqrt{%
2\eta_{1}}e_{t}
x^{0}=h_{\gamma}(z^{K})
t=0\to T-1
x^{t+1}=x^{t}-\eta_{2}\nabla_{x}U_{\varphi}^{c}\left(x^{t},\sigma\right)+\sqrt%
{2\eta_{2}}e_{t}
\Delta\gamma=\sum_{i=1}^{n}\left[\nabla_{\gamma}U_{\gamma}^{s}\left(z_{i},%
\sigma_{i}\right)\right]
\qquad-\sum_{i=1}^{n}\left[\nabla_{\gamma}U_{\gamma}^{s}\left(z_{i}^{K},\sigma%
_{i}\right)\right]
\Delta\varphi=\sum_{i=1}^{n}\left[\nabla_{\varphi}U_{\varphi}^{c}\left(x_{i},%
\sigma_{i}\right)\right]
\qquad-\sum_{i=1}^{n}\left[\nabla_{\varphi}U_{\varphi}^{c}\left(x_{i}^{T},%
\sigma_{i}\right)\right]
\varphi,\gamma
\Delta\varphi,\Delta\gamma
Y=x^{T}
\varphi,\gamma,Y
\mathcal{X}
\mathcal{Z}
\mathcal{X}
\mathcal{Z}
\mathcal{X}
c(x|\tilde{x})=r_{\varphi}(\tilde{x},\sigma)
\tilde{x}
\sigma
\tilde{x}
c(x|\tilde{x})
\sigma
\tilde{x}
c(x|\tilde{x})
c(x|\tilde{x})
\nabla_{x}U_{\varphi}^{c}(x,\sigma)\approx\nabla_{x}\log p(x)-\frac{\partial r%
(x)}{\partial x}\left(\nabla_{x}\log p(x)\right).
r(x)\approx x
\frac{\partial r(x)}{\partial x}
1
\mathcal{X}
c(x|\tilde{x})
\mathcal{M}
\mathcal{M}=supp(h_{\gamma}\left(z^{K}\right)),z^{K}\sim\hat{p}_{\gamma}(z).
x^{0}\in\mathcal{M}
c(x|\tilde{x})
\mathcal{M}
\mathcal{M}
\mathcal{X}
r_{\varphi}=g_{\beta}\circ f_{\alpha}
\displaystyle\mathcal{L}(\alpha,\beta)=\mathbb{E}_{q(x)}[\mathbb{E}_{q_{\alpha%
}(z|x)}\left[\log q_{\beta}(x|z)\right]
\displaystyle\mathcal{L}(\alpha,\beta)
\displaystyle=\mathbb{E}_{q(x)}[\mathbb{E}_{q_{\alpha}(z|x)}\left[\log q_{%
\beta}(x|z)\right]
\displaystyle-KL\left(q_{\alpha}(z|x)\|p(z)\right)].
\displaystyle-KL\left(q_{\alpha}(z|x)\|p(z)\right)].
\displaystyle\mathbb{E}_{q(x)}KL\left(q_{\alpha}(z|x)||p(z)\right)=\int q_{%
\alpha}(x,z)\log\frac{q_{\alpha}(z|x)}{p(z)}dxdz
\displaystyle\mathbb{E}_{q(x)}KL\left(q_{\alpha}(z|x)||p(z)\right)=\int q_{%
\alpha}(x,z)\log\frac{q_{\alpha}(z|x)}{p(z)}dxdz
\displaystyle\geq\int q_{\alpha}(x,z)\log\frac{q_{\alpha}(z|x)}{p(z)}dxdz-KL%
\left(q_{\alpha}(z)||p(z)\right)
\displaystyle\geq\int q_{\alpha}(x,z)\log\frac{q_{\alpha}(z|x)}{p(z)}dxdz-KL%
\left(q_{\alpha}(z)||p(z)\right)
\displaystyle=\int q_{\alpha}(x,z)\left[\log\frac{q_{\alpha}(z|x)}{p(z)}-\log%
\frac{q_{\alpha}(z)}{p(z)}\right]dxdz
\displaystyle=\int q_{\alpha}(x,z)\left[\log\frac{q_{\alpha}(z|x)}{p(z)}-\log%
\frac{q_{\alpha}(z)}{p(z)}\right]dxdz
\displaystyle=\int q_{\alpha}(x,z)\log\frac{q_{\alpha}(z|x)}{q_{\alpha}(z)}dxdz
\displaystyle=\int q_{\alpha}(x,z)\log\frac{q_{\alpha}(z|x)}{q_{\alpha}(z)}dxdz
\displaystyle=I_{q}(x,z)
\displaystyle=I_{q}(x,z)
\nabla_{x}U_{\varphi}(x,\sigma)=\frac{1}{\sigma^{2}}(x-r(\tilde{x}))-\frac{1}{%
\sigma^{2}}(x-r(\tilde{x}))\nabla_{x}r(\tilde{x}).
\mathbb{E}_{p(x,\tilde{x})}\left[\left\|s_{\theta}(\tilde{{x}},\sigma)+\frac{%
\tilde{x}-x}{\sigma^{2}}\right\|^{2}\right].
s_{\theta}(x)
s_{\theta}(x)
\times
\times
\times
L=3,K=20,T=90
L=3,K=40,T=100
\eta_{1}=0.1
\eta_{2}=0.01
S=128
\sigma_{1}=1
\sigma_{S}=0.01
5\times 10^{-5}
[-1,1]
p=0.5
h_{\gamma}(z^{0})
h_{\gamma}(z^{K})
z^{0}\sim\mathcal{N}(0,I)
x^{0}\sim\mathcal{N}(0,I)
h_{\gamma}(z^{0})
h_{\gamma}(z^{K})
z^{0}\sim\mathcal{N}(0,I)
x^{0}\sim\mathcal{N}(0,I)
50k
\times
\times
\uparrow
\downarrow
\mathbf{9.03}
\mathbf{7.76}
\mathbf{8.76}
\mathbf{21.24}
\downarrow
\mathbf{14.1}
64\times 64
64\times 64
\mathcal{Z}
\mathcal{X}
\geq
\sigma
S
\sigma
\mathcal{Z}
\mathcal{X}
\sigma
\downarrow
\sigma_{1}=0.01,\sigma_{128}=3
\sigma_{1}=0.01,\sigma_{128}=2
\sigma_{1}=0.01,\sigma_{128}=1
\mathbf{50.02}
\sigma_{1}=0.01,\sigma_{128}=0.5
S=64
S=128
\mathbf{50.02}
S=256
-U_{\varphi}^{c}\left(x,\sigma\right)
\sigma=0.05
\mathbf{0.62}
\mathbf{0.99}
\mathbf{0.86}
\mathbf{0.62}
\mathbf{0.99}
\uparrow
-U_{\varphi}^{c}\left(x,\sigma\right)
\uparrow
-U_{\varphi}^{c}\left(x,\sigma\right)
