1
10
50
3\times 32\times 32=3072
3072
12\times 4\times 4=192
16
192\times 16=3072
12\rightarrow 9\rightarrow 6\rightarrow 3
2\times 2
738
10
73.8
8
16
10
8\times 16=128
3131
2\%
3\times 32\times 32=3072
N
c=1,\dots,C
\mathcal{X}_{c}=\{x_{c,1},\dots,x_{c,N}\}
M
c
\Theta_{c}=\{\theta_{c,1},\dots,\theta_{c,M}\}
\Theta=\{\Theta_{1},\dots,\Theta_{C}\}
\theta
x
g(x)
x
f(\theta;\phi_{d})
d
\phi_{d}
\theta
D
\phi=\{\phi_{1},\dots,\phi_{D}\}
\displaystyle L(\Theta,\phi)=\frac{1}{C}\sum_{c=1}^{C}\frac{1}{2}\left\|\frac{%
1}{N}\sum_{n=1}^{N}g(x_{c,n})-\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f(%
\theta_{c,m};\phi_{d}))\right\|_{2}^{2}
\displaystyle L(\Theta,\phi)=\frac{1}{C}\sum_{c=1}^{C}\frac{1}{2}\left\|\frac{%
1}{N}\sum_{n=1}^{N}g(x_{c,n})-\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f(%
\theta_{c,m};\phi_{d}))\right\|_{2}^{2}
g(\cdot)
g(x)
n
g(f(\theta;\phi))
d
m
\nabla_{\Theta,\phi}L(\Theta,\phi)
\{n\}_{n=1}^{N}
\{c\}_{c=1}^{C}
\{m\}_{m=1}^{M}
\{d\}_{d=1}^{D}
m\sim\text{Uniform}(1,M)
d\sim\text{Uniform}(1,D)
\hat{L}
\mathbb{E}_{m,d}[\nabla_{\Theta,\phi}\hat{L}(\Theta,\phi)]-\nabla_{\Theta,\phi%
}L(\Theta,\phi)
\displaystyle\nabla_{\Theta,\phi}\frac{1}{C}\sum_{c=1}^{C}\frac{1}{2}\Bigg{\{}%
\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f(\theta_{c,m};\phi_{d}))^{\mkern-1.%
5mu\mathsf{T}}g(f(\theta_{c,m};\phi_{d}))
\displaystyle\nabla_{\Theta,\phi}\frac{1}{C}\sum_{c=1}^{C}\frac{1}{2}\Bigg{\{}
\displaystyle\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f(\theta_{c,m};\phi_{d}%
))^{\mkern-1.5mu\mathsf{T}}g(f(\theta_{c,m};\phi_{d}))
\displaystyle-\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}\sum_{d^{\prime}=1}^{D}\sum_{m%
=1}^{M}\sum_{m^{\prime}=1}^{M}g(f(\theta_{c,m};\phi_{d}))^{\mkern-1.5mu\mathsf%
{T}}g(f(\theta_{c,m^{\prime}};\phi_{d^{\prime}}))\Bigg{\}}.
\displaystyle-\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}\sum_{d^{\prime}=1}^{D}\sum_{m%
=1}^{M}\sum_{m^{\prime}=1}^{M}g(f(\theta_{c,m};\phi_{d}))^{\mkern-1.5mu\mathsf%
{T}}g(f(\theta_{c,m^{\prime}};\phi_{d^{\prime}}))\Bigg{\}}.
g(f(\theta_{c,m};\phi))^{\mkern-1.5mu\mathsf{T}}g(f(\theta_{c,m^{\prime}};\phi))
g(f(\theta_{c,m};\phi_{d}))^{\mkern-1.5mu\mathsf{T}}g(f(\theta_{c,m};\phi_{d^{%
\prime}}))
\theta
\theta\in\Theta_{c}
\mathcal{X}_{c}
\theta^{\prime}\in\Theta_{c}\backslash\{\theta\}
f(\cdot;\phi_{d})
m
d
n\sim\text{Uniform}(1,N)
c
\tilde{L}
\text{Var}_{n}(\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi))
\displaystyle\frac{1}{C^{2}}\sum_{c=1}^{C}V_{c}^{\mkern-1.5mu\mathsf{T}}\left%
\{\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})g(x_{c,n})^{\mkern-1.5mu\mathsf{T}}-\left%
(\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})\right)\left(\frac{1}{N}\sum_{n=1}^{N}g(x_%
{c,n})\right)^{\mkern-1.5mu\mathsf{T}}\right\}V_{c}
\displaystyle\frac{1}{C^{2}}\sum_{c=1}^{C}V_{c}^{\mkern-1.5mu\mathsf{T}}\left%
\{\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})g(x_{c,n})^{\mkern-1.5mu\mathsf{T}}-\left%
(\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})\right)\left(\frac{1}{N}\sum_{n=1}^{N}g(x_%
{c,n})\right)^{\mkern-1.5mu\mathsf{T}}\right\}V_{c}
V_{c}=\frac{1}{DM}\sum_{d=1}^{d}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f(\theta_{%
c,m};\phi_{d}))
g(x_{c,n})
n=1,\dots,N
g(\cdot)
g(x_{c,n})
g(\cdot)
\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)
\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})
w_{1},\dots,w_{K}
K
g(\cdot)
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\min(N_{\text{total}},256)
N_{\text{total}}
\min(N_{\text{total}},256)
N_{\text{total}}
\times
\times
\times
\times
\times
\times
30720
\times
\times
=1
=
=
H,W
12\times H/8\times W/8
H,W
12\times H/8\times W/8
12\times H/8\times W/8
9\times H/4\times W/4
6\times H/2\times W/2
3\times H\times W
3\times H\times W
H,W
12\times H/4\times W/4
H,W
12\times H/4\times W/4
12\times H/4\times W/4
6\times H/2\times W/2
3\times H\times W
3\times H\times W
1
12\times 4\times 4
13
8
0.47\%
10
12\times 4\times 4
160
12
2.88\%
12\times 8\times 8
200
16
0.88\%
1
12\times 4\times 4
13
8
0.47\%
10
12\times 4\times 4
160
12
2.88\%
12\times 8\times 8
200
16
0.88\%
1
12\times 4\times 4
16
8
1.92\%
10
12\times 4\times 4
160
12
0.29\%
1
12\times 8\times 8
16
8
0.24\%
10
12\times 16\times 16
64
16
0.04\%
0.01
L_{c}(\Theta,\phi):=\frac{1}{2}\left\|\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})-%
\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f_{c,m,d})\right\|_{2}^{2}
f_{c,m,d}:=f(\theta_{c,m};\phi_{d})
\nabla_{\Theta,\phi}L_{c}(\Theta,\phi)
\displaystyle\nabla_{\Theta,\phi}L_{c}(\Theta,\phi)
\displaystyle\nabla_{\Theta,\phi}L_{c}(\Theta,\phi)
\displaystyle=\nabla_{\Theta,\phi}\frac{1}{2}\left\|\frac{1}{N}\sum_{n=1}^{N}g%
(x_{c,n})-\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f_{c,m,d})\right\|_{2}^{2}
\displaystyle=\nabla_{\Theta,\phi}\frac{1}{2}\left\|\frac{1}{N}\sum_{n=1}^{N}g%
(x_{c,n})-\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f_{c,m,d})\right\|_{2}^{2}
\displaystyle=-\frac{1}{NDM}\sum_{n=1}^{N}\sum_{d=1}^{D}\sum_{m=1}^{M}\nabla_{%
\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}g(x_{c,n})+\frac{1}{D^{2}M^{2%
}}\sum_{d=1}^{D}\sum_{d^{\prime}=1}^{D}\sum_{m=1}^{M}\sum_{m^{\prime}=1}^{M}%
\nabla_{\Theta,\phi}g(f_{c,m^{\prime},d^{\prime}})^{\mkern-1.5mu\mathsf{T}}g(f%
_{c,m,d})
\displaystyle=-\frac{1}{NDM}\sum_{n=1}^{N}\sum_{d=1}^{D}\sum_{m=1}^{M}\nabla_{%
\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}g(x_{c,n})+\frac{1}{D^{2}M^{2%
}}\sum_{d=1}^{D}\sum_{d^{\prime}=1}^{D}\sum_{m=1}^{M}\sum_{m^{\prime}=1}^{M}%
\nabla_{\Theta,\phi}g(f_{c,m^{\prime},d^{\prime}})^{\mkern-1.5mu\mathsf{T}}g(f%
_{c,m,d})
m\sim\text{Uniform}(1,M)
d\sim\text{Uniform}(1,D)
\displaystyle\mathbb{E}_{m,d}[\nabla_{\Theta,\phi}\hat{L}_{c}(\Theta,\phi)]
\displaystyle\mathbb{E}_{m,d}[\nabla_{\Theta,\phi}\hat{L}_{c}(\Theta,\phi)]
\displaystyle=\mathbb{E}_{m,d}\left[\nabla_{\Theta,\phi}\frac{1}{2}\left\|%
\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})-g(f_{c,m,d})\right\|_{2}^{2}\right]
\displaystyle=\mathbb{E}_{m,d}\left[\nabla_{\Theta,\phi}\frac{1}{2}\left\|%
\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})-g(f_{c,m,d})\right\|_{2}^{2}\right]
\displaystyle=\mathbb{E}_{m,d}\left[-\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})^{%
\mkern-1.5mu\mathsf{T}}\nabla_{\Theta,\phi}g(f_{c,m,d})+\nabla_{\Theta,\phi}g(%
f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}g(f_{c,m,d})\right]
\displaystyle=\mathbb{E}_{m,d}\left[-\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})^{%
\mkern-1.5mu\mathsf{T}}\nabla_{\Theta,\phi}g(f_{c,m,d})+\nabla_{\Theta,\phi}g(%
f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}g(f_{c,m,d})\right]
\displaystyle=-\frac{1}{NDM}\sum_{n=1}^{N}\sum_{d=1}^{D}\sum_{m=1}^{M}\nabla_{%
\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}g(x_{c,n})+\frac{1}{DM}\sum_{%
d=1}^{D}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}%
}g(f_{c,m,d}))
\displaystyle=-\frac{1}{NDM}\sum_{n=1}^{N}\sum_{d=1}^{D}\sum_{m=1}^{M}\nabla_{%
\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}g(x_{c,n})+\frac{1}{DM}\sum_{%
d=1}^{D}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}%
}g(f_{c,m,d}))
\displaystyle\mathbb{E}_{m,d}[\nabla_{\Theta,\phi}\hat{L}(\Theta,\phi)]-\nabla%
_{\Theta,\phi}L(\Theta,\phi)
\displaystyle\mathbb{E}_{m,d}[\nabla_{\Theta,\phi}\hat{L}(\Theta,\phi)]-\nabla%
_{\Theta,\phi}L(\Theta,\phi)
\displaystyle=\frac{1}{C}\sum_{c=1}^{C}\left(\mathbb{E}_{m,d}[\nabla_{\Theta,%
\phi}\hat{L}_{c}(\Theta,\phi)]-\nabla_{\Theta,\phi}L_{c}(\Theta,\phi)\right)
\displaystyle=\frac{1}{C}\sum_{c=1}^{C}\left(\mathbb{E}_{m,d}[\nabla_{\Theta,%
\phi}\hat{L}_{c}(\Theta,\phi)]-\nabla_{\Theta,\phi}L_{c}(\Theta,\phi)\right)
\displaystyle=\nabla_{\Theta,\phi}\frac{1}{C}\sum_{c=1}^{C}\frac{1}{2}\Bigg{\{%
}\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}%
g(f_{c,m,d})-\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}\sum_{d^{\prime}=1}^{D}\sum_{m=%
1}^{M}\sum_{m^{\prime}=1}^{M}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}g(f_{c,m^{%
\prime},d^{\prime}})\Bigg{\}}.
\displaystyle=\nabla_{\Theta,\phi}\frac{1}{C}\sum_{c=1}^{C}\frac{1}{2}\Bigg{\{%
}\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}%
g(f_{c,m,d})-\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}\sum_{d^{\prime}=1}^{D}\sum_{m=%
1}^{M}\sum_{m^{\prime}=1}^{M}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}g(f_{c,m^{%
\prime},d^{\prime}})\Bigg{\}}.
\displaystyle\text{Var}_{n}(\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi))
\displaystyle\text{Var}_{n}(\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi))
\displaystyle=\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)%
\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)^{\mkern-1.5mu\mathsf{T}}\right]-%
\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)\right]\mathbb{E%
}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)\right]^{\mkern-1.5mu%
\mathsf{T}}
\displaystyle=\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)%
\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)^{\mkern-1.5mu\mathsf{T}}\right]-%
\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)\right]\mathbb{E%
}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)\right]^{\mkern-1.5mu%
\mathsf{T}}
n\sim\text{Uniform}(1,N)
c
\displaystyle\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)\right]
\displaystyle\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)\right]
\displaystyle=\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\frac{1}{C}\sum_{c=1}^{C%
}\frac{1}{2}\left\|g(x_{c,n})-\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f_{c,m%
,d})\right\|_{2}^{2}\right]
\displaystyle=\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\frac{1}{C}\sum_{c=1}^{C%
}\frac{1}{2}\left\|g(x_{c,n})-\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f_{c,m%
,d})\right\|_{2}^{2}\right]
\displaystyle=\mathbb{E}_{n}\left[\frac{1}{C}\sum_{c=1}^{C}\left(-\frac{1}{DM}%
\sum_{d=1}^{D}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu%
\mathsf{T}}g(x_{c,n})+\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}\sum_{d^{\prime}=1}^{D%
}\sum_{m=1}^{M}\sum_{m^{\prime}=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m^{\prime},d^%
{\prime}})^{\mkern-1.5mu\mathsf{T}}g(f_{c,m,d})\right)\right]
\displaystyle=\mathbb{E}_{n}\left[\frac{1}{C}\sum_{c=1}^{C}\left(-\frac{1}{DM}%
\sum_{d=1}^{D}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu%
\mathsf{T}}g(x_{c,n})+\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}\sum_{d^{\prime}=1}^{D%
}\sum_{m=1}^{M}\sum_{m^{\prime}=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m^{\prime},d^%
{\prime}})^{\mkern-1.5mu\mathsf{T}}g(f_{c,m,d})\right)\right]
\displaystyle=\frac{1}{C}\sum_{c=1}^{C}\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M%
}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}\left(-\mathbb{E}_{n%
}[g(x_{c,n})]+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{\prime}=1}^{M}g(f_{c%
,m^{\prime},d^{\prime}})\right)
\displaystyle=\frac{1}{C}\sum_{c=1}^{C}\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M%
}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}}\left(-\mathbb{E}_{n%
}[g(x_{c,n})]+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{\prime}=1}^{M}g(f_{c%
,m^{\prime},d^{\prime}})\right)
\displaystyle=\frac{1}{C}\sum_{c=1}^{C}V_{c}^{\mkern-1.5mu\mathsf{T}}\left(-%
\mathbb{E}_{n}[g(x_{c,n})]+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{\prime}%
=1}^{M}g(f_{c,m^{\prime},d^{\prime}})\right)
\displaystyle=\frac{1}{C}\sum_{c=1}^{C}V_{c}^{\mkern-1.5mu\mathsf{T}}\left(-%
\mathbb{E}_{n}[g(x_{c,n})]+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{\prime}%
=1}^{M}g(f_{c,m^{\prime},d^{\prime}})\right)
V_{c}:=\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m,d})
\displaystyle\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)%
\right]\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)\right]^{%
\mkern-1.5mu\mathsf{T}}
\displaystyle\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)%
\right]\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)\right]^{%
\mkern-1.5mu\mathsf{T}}
\displaystyle=\frac{1}{C}\sum_{c=1}^{C}V_{c}^{\mkern-1.5mu\mathsf{T}}\left(-%
\mathbb{E}_{n}[g(x_{c,n})]+\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f_{c,m,d}%
)\right)\cdot
\displaystyle=\frac{1}{C}\sum_{c=1}^{C}V_{c}^{\mkern-1.5mu\mathsf{T}}\left(-%
\mathbb{E}_{n}[g(x_{c,n})]+\frac{1}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}g(f_{c,m,d}%
)\right)\cdot
\displaystyle\qquad\frac{1}{C}\sum_{c^{\prime}=1}^{C}\left(-\mathbb{E}_{n}[g(x%
_{c^{\prime},n})]+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{\prime}=1}^{M}g(%
f_{c^{\prime},m^{\prime},d^{\prime}})\right)^{\mkern-1.5mu\mathsf{T}}V_{c^{%
\prime}}
\displaystyle\qquad\frac{1}{C}\sum_{c^{\prime}=1}^{C}\left(-\mathbb{E}_{n}[g(x%
_{c^{\prime},n})]+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{\prime}=1}^{M}g(%
f_{c^{\prime},m^{\prime},d^{\prime}})\right)^{\mkern-1.5mu\mathsf{T}}V_{c^{%
\prime}}
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}\sum_{c^{\prime}=1}^{C}V_{c}^{%
\mkern-1.5mu\mathsf{T}}\bigg{(}\mathbb{E}_{n}[g(x_{c,n})]\mathbb{E}_{n}[g(x_{c%
^{\prime},n})]^{\mkern-1.5mu\mathsf{T}}-\frac{2}{DM}\sum_{d=1}^{D}\sum_{m=1}^{%
M}\mathbb{E}_{n}[g(x_{c,n})]^{\mkern-1.5mu\mathsf{T}}g(f_{c^{\prime},m,d})
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}\sum_{c^{\prime}=1}^{C}V_{c}^{%
\mkern-1.5mu\mathsf{T}}\bigg{(}\mathbb{E}_{n}[g(x_{c,n})]\mathbb{E}_{n}[g(x_{c%
^{\prime},n})]^{\mkern-1.5mu\mathsf{T}}-\frac{2}{DM}\sum_{d=1}^{D}\sum_{m=1}^{%
M}\mathbb{E}_{n}[g(x_{c,n})]^{\mkern-1.5mu\mathsf{T}}g(f_{c^{\prime},m,d})
\displaystyle\qquad\qquad\qquad\qquad\ \ +\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}%
\sum_{d^{\prime}=1}^{D}\sum_{m=1}^{M}\sum_{m^{\prime}=1}^{M}g(f_{c,m,d})^{%
\mkern-1.5mu\mathsf{T}}g(f_{c^{\prime},m^{\prime},d^{\prime}})\bigg{)}V_{c^{%
\prime}}
\displaystyle\qquad\qquad\qquad\qquad\ \ +\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}%
\sum_{d^{\prime}=1}^{D}\sum_{m=1}^{M}\sum_{m^{\prime}=1}^{M}g(f_{c,m,d})^{%
\mkern-1.5mu\mathsf{T}}g(f_{c^{\prime},m^{\prime},d^{\prime}})\bigg{)}V_{c^{%
\prime}}
\displaystyle\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)%
\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)^{\mkern-1.5mu\mathsf{T}}\right]
\displaystyle\mathbb{E}_{n}\left[\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)%
\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi)^{\mkern-1.5mu\mathsf{T}}\right]
\displaystyle=\mathbb{E}_{n}\Bigg{[}\Bigg{\{}\frac{1}{C}\sum_{c=1}^{C}\frac{1}%
{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu%
\mathsf{T}}\left(-g(x_{c,n})+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{%
\prime}=1}^{M}g(f_{c,m^{\prime},d^{\prime}})\right)\Bigg{\}}\cdot
\displaystyle=\mathbb{E}_{n}\Bigg{[}\Bigg{\{}\frac{1}{C}\sum_{c=1}^{C}\frac{1}%
{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu%
\mathsf{T}}\left(-g(x_{c,n})+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{%
\prime}=1}^{M}g(f_{c,m^{\prime},d^{\prime}})\right)\Bigg{\}}\cdot
\displaystyle\qquad\quad\ \Bigg{\{}\frac{1}{C}\sum_{c=1}^{C}\frac{1}{DM}\sum_{%
d=1}^{D}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}%
}\left(-g(x_{c,n})+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{\prime}=1}^{M}g%
(f_{c,m^{\prime},d^{\prime}})\right)\Bigg{\}}^{\mkern-1.5mu\mathsf{T}}\Bigg{]}
\displaystyle\qquad\quad\ \Bigg{\{}\frac{1}{C}\sum_{c=1}^{C}\frac{1}{DM}\sum_{%
d=1}^{D}\sum_{m=1}^{M}\nabla_{\Theta,\phi}g(f_{c,m,d})^{\mkern-1.5mu\mathsf{T}%
}\left(-g(x_{c,n})+\frac{1}{DM}\sum_{d^{\prime}=1}^{D}\sum_{m^{\prime}=1}^{M}g%
(f_{c,m^{\prime},d^{\prime}})\right)\Bigg{\}}^{\mkern-1.5mu\mathsf{T}}\Bigg{]}
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}\sum_{c^{\prime}=1}^{C}V_{c}^{%
\mkern-1.5mu\mathsf{T}}\Bigg{(}\mathbb{E}_{n}[g(x_{c,n})g(x_{c^{\prime},n})^{%
\mkern-1.5mu\mathsf{T}}]-\frac{2}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}\mathbb{E}_{n%
}[g(x_{c,n})]^{\mkern-1.5mu\mathsf{T}}g(f_{c^{\prime},m,d})
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}\sum_{c^{\prime}=1}^{C}V_{c}^{%
\mkern-1.5mu\mathsf{T}}\Bigg{(}\mathbb{E}_{n}[g(x_{c,n})g(x_{c^{\prime},n})^{%
\mkern-1.5mu\mathsf{T}}]-\frac{2}{DM}\sum_{d=1}^{D}\sum_{m=1}^{M}\mathbb{E}_{n%
}[g(x_{c,n})]^{\mkern-1.5mu\mathsf{T}}g(f_{c^{\prime},m,d})
\displaystyle\qquad\qquad\qquad\qquad\ \ +\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}%
\sum_{d^{\prime}=1}^{D}\sum_{m=1}^{M}\sum_{m^{\prime}=1}^{M}g(f_{c,m,d})^{%
\mkern-1.5mu\mathsf{T}}g(f_{c^{\prime},m^{\prime},d^{\prime}})\Bigg{)}V_{c^{%
\prime}}
\displaystyle\qquad\qquad\qquad\qquad\ \ +\frac{1}{D^{2}M^{2}}\sum_{d=1}^{D}%
\sum_{d^{\prime}=1}^{D}\sum_{m=1}^{M}\sum_{m^{\prime}=1}^{M}g(f_{c,m,d})^{%
\mkern-1.5mu\mathsf{T}}g(f_{c^{\prime},m^{\prime},d^{\prime}})\Bigg{)}V_{c^{%
\prime}}
\displaystyle\text{Var}_{n}(\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi))
\displaystyle\text{Var}_{n}(\nabla_{\Theta,\phi}\tilde{L}(\Theta,\phi))
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}\sum_{c^{\prime}=1}^{C}V_{c}^{%
\mkern-1.5mu\mathsf{T}}\Bigg{(}\mathbb{E}_{n}\left[g(x_{c,n})g(x_{c^{\prime},n%
})\right]^{\mkern-1.5mu\mathsf{T}}-\mathbb{E}_{n}[g(x_{c,n})]\mathbb{E}_{n}[g(%
x_{c^{\prime},n})]^{\mkern-1.5mu\mathsf{T}}\Bigg{)}V_{c^{\prime}}
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}\sum_{c^{\prime}=1}^{C}V_{c}^{%
\mkern-1.5mu\mathsf{T}}\Bigg{(}\mathbb{E}_{n}\left[g(x_{c,n})g(x_{c^{\prime},n%
})\right]^{\mkern-1.5mu\mathsf{T}}-\mathbb{E}_{n}[g(x_{c,n})]\mathbb{E}_{n}[g(%
x_{c^{\prime},n})]^{\mkern-1.5mu\mathsf{T}}\Bigg{)}V_{c^{\prime}}
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}V_{c}^{\mkern-1.5mu\mathsf{T}}\left%
(\mathbb{E}_{n}[g(x_{c,n})g(x_{c,n})^{\mkern-1.5mu\mathsf{T}}]-\mathbb{E}_{n}[%
g(x_{c,n})]\mathbb{E}_{n}[g(x_{c,n})]^{\mkern-1.5mu\mathsf{T}}\right)V_{c}
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}V_{c}^{\mkern-1.5mu\mathsf{T}}\left%
(\mathbb{E}_{n}[g(x_{c,n})g(x_{c,n})^{\mkern-1.5mu\mathsf{T}}]-\mathbb{E}_{n}[%
g(x_{c,n})]\mathbb{E}_{n}[g(x_{c,n})]^{\mkern-1.5mu\mathsf{T}}\right)V_{c}
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}V_{c}\left\{\frac{1}{N}\sum_{n=1}^{%
N}g(x_{c,n})g(x_{c,n})^{\mkern-1.5mu\mathsf{T}}-\left(\frac{1}{N}\sum_{n=1}^{N%
}g(x_{c,n})\right)\left(\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})\right)^{\mkern-1.5%
mu\mathsf{T}}\right\}V_{c}^{\mkern-1.5mu\mathsf{T}}
\displaystyle=\frac{1}{C^{2}}\sum_{c=1}^{C}V_{c}\left\{\frac{1}{N}\sum_{n=1}^{%
N}g(x_{c,n})g(x_{c,n})^{\mkern-1.5mu\mathsf{T}}-\left(\frac{1}{N}\sum_{n=1}^{N%
}g(x_{c,n})\right)\left(\frac{1}{N}\sum_{n=1}^{N}g(x_{c,n})\right)^{\mkern-1.5%
mu\mathsf{T}}\right\}V_{c}^{\mkern-1.5mu\mathsf{T}}
g(x_{c,n})
g(x_{c^{\prime},n})
n
