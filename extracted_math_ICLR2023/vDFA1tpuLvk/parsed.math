10^{60}
t=0,\dots,T
z_{t}
q(z_{t}|x)=\mathcal{N}(z_{t}|\alpha_{t}x_{t},\sigma_{t}^{2}I),
\alpha_{t}\in\mathbb{R}^{+}
\sigma_{t}\in\mathbb{R}^{+}
q(z_{t}|z_{s})=\mathcal{N}(z_{t}|\alpha_{t|s}z_{s},~{}\sigma_{t|s}^{2}I),
t>s
\alpha_{t|s}=\alpha_{t}/\alpha_{s}
\sigma_{t|s}^{2}=\sigma_{t}^{2}-\alpha_{t|s}^{2}\sigma_{s}^{2}
q(z_{0},z_{1},\ldots,z_{T}|x)=q(z_{0}|x)\prod\nolimits_{t=1}^{T}q(z_{t}|z_{t-1%
}).
q(z_{s}|x,z_{t})=N(z_{s}|\mu_{t\rightarrow s}(x,z_{t}),\sigma_{t\rightarrow s}%
^{2}I),
\mu_{t\rightarrow s}(x,z_{t})
\sigma_{t\rightarrow s}
\mu_{t\rightarrow s}(x,z_{t})=\frac{\alpha_{t|s}\sigma_{s}^{2}}{\sigma_{t}^{2}%
}z_{t}+\frac{\alpha_{s}\sigma_{t|s}^{2}}{\sigma_{t}^{2}}x\quad\text{and}\quad%
\sigma_{t\rightarrow s}=\frac{\sigma_{t|s}\sigma_{s}}{\sigma_{t}}.
p(z_{s}|z_{t})=\mathcal{N}(z_{s}|\mu_{t\rightarrow s}(\hat{x},z_{t}),\sigma_{t%
\rightarrow s}^{2}I).
\hat{x}
\varphi
z_{t}=\alpha_{t}x+\sigma_{t}
\varphi
\epsilon,\hat{\epsilon}=\phi(z_{t},t)
\hat{x}=(1/\alpha_{t})~{}z_{t}-(\sigma_{t}/\alpha_{t})~{}\hat{\epsilon}
\mathcal{L}(t)=||\epsilon-\hat{\epsilon}_{t}||^{2}
\mathrm{x}
\mathrm{C}
\mathrm{x}
\mathrm{C}
\varphi
\hat{\epsilon}=\epsilon(z_{t},\mathcal{T},\text{controlnet}(z_{t}+\mathcal{E}_%
{\text{2D}})),
\mathcal{T}
\mathcal{E}_{\text{2D}}
\mathcal{G}
\{\bm{x},\bm{h}\}
\bm{x}
\in\mathbb{R}^{N\times 3}
\bm{h}
\in\mathbb{R}^{N\times d}
\bm{x}^{l+1},\bm{h}^{l+1}=\mathrm{EGCL}[\bm{x}^{l},\bm{h}^{l}]
\displaystyle\mathrm{m}_{ij}=\phi_{e}\left(\bm{h}_{i}^{l},\bm{h}_{j}^{l},d_{ij%
}^{2}\right),\,\bm{h}_{i}^{l+1}=\phi_{h}(\bm{h}_{i}^{l},{\sum_{j\neq i}}%
\mathrm{m}_{ij}),
\displaystyle\mathrm{m}_{ij}
\displaystyle=\phi_{e}\left(\bm{h}_{i}^{l},\bm{h}_{j}^{l},d_{ij}^{2}\right),\,%
\bm{h}_{i}^{l+1}=\phi_{h}(\bm{h}_{i}^{l},{\sum_{j\neq i}}\mathrm{m}_{ij}),
\displaystyle\bm{x}_{i}^{l+1}=\bm{x}_{i}^{l}+\sum_{j\neq i}\frac{\bm{x}_{i}^{l%
}-\bm{x}_{j}^{l}}{d_{ij}+1}\phi_{x}\left(\bm{h}_{i}^{l},\bm{h}_{j}^{l},d_{ij}^%
{2}\right),
\displaystyle\bm{x}_{i}^{l+1}
\displaystyle=\bm{x}_{i}^{l}+\sum_{j\neq i}\frac{\bm{x}_{i}^{l}-\bm{x}_{j}^{l}%
}{d_{ij}+1}\phi_{x}\left(\bm{h}_{i}^{l},\bm{h}_{j}^{l},d_{ij}^{2}\right),
l
d_{ij}=\|x_{i}^{l}-x_{j}^{l}\|_{2}
\phi_{e}
\phi_{h}
\phi_{x}
\hat{\bm{\epsilon}}
\hat{\bm{\epsilon}}=[\hat{\bm{\epsilon}}^{x},\hat{\bm{\epsilon}}^{h}]
\varphi
\displaystyle\hat{\bm{\epsilon}}=[\hat{\bm{\epsilon}}^{x},\hat{\bm{\epsilon}}^%
{h}]=\varphi(\bm{z}_{t},t)=\text{EGNN}(\bm{z}_{t},t)-[\bm{z}_{t}^{x},0].
\displaystyle\hat{\bm{\epsilon}}=[\hat{\bm{\epsilon}}^{x},\hat{\bm{\epsilon}}^%
{h}]=\varphi(\bm{z}_{t},t)=\text{EGNN}(\bm{z}_{t},t)-[\bm{z}_{t}^{x},0].
\mathbf{z}_{0}
\mathbf{z}_{t}
m
\mathbf{z}_{t-1}^{\textrm{known}}\sim\mathcal{N}(\sqrt{\bar{\alpha}_{t-1}}%
\mathbf{z}_{0},(1-\bar{\alpha}_{t-1})\mathbf{I})
\mathbf{z}_{t-1}^{\textrm{unknown}}\sim\mathcal{N}(\bm{\mu}_{\theta}(\mathbf{z%
}_{t},t),\bm{\Sigma}_{\theta}(\mathbf{z}_{t},t))
\mathbf{z}_{t-1}=m\odot\mathbf{z}_{t-1}^{\textrm{known}}+(1-m)\odot\mathbf{z}_%
{t-1}^{\textrm{unknown}}
\bm{z}_{t-1}
\bm{z}_{t}
\mathbf{z}_{t}\sim\mathcal{N}(\sqrt{{\alpha}_{t-1}}\mathbf{z}_{t-1},(1-{\alpha%
}_{t-1})\mathbf{I})
c
C_{t}
Z_{t}
c
C_{t}
Z_{t}
c
h
\bm{x}_{i}^{l+1},\bm{h}_{i}^{l+1}
\displaystyle\bm{x}_{i}^{l+1}=\bm{x}_{i}^{l+1}+\operatorname{zeroconv}(\Delta
control%
\_\bm{x}_{i}^{l+1})
\displaystyle\bm{x}_{i}^{l+1}
\displaystyle=\bm{x}_{i}^{l+1}+\operatorname{zeroconv}(\Delta control\_\bm{x}_%
{i}^{l+1})
\displaystyle\bm{h}_{i}^{l+1}=\bm{h}_{i}^{l+1}+\operatorname{zeroconv}(control%
\_\bm{h}_{i}^{l+1}),
\displaystyle\bm{h}_{i}^{l+1}
\displaystyle=\bm{h}_{i}^{l+1}+\operatorname{zeroconv}(control\_\bm{h}_{i}^{l+%
1}),
control
\Delta control\_\bm{x}_{i}^{l+1}:=control\_\bm{x}_{i}^{l+1}-control\_\bm{x}_{i%
}^{l}
\bm{x}
1\times 1
u
p\sim U(0,1)
u
t
\displaystyle\bm{h}=\bm{h}_{t}+\operatorname{zeroconv}(sub\_\bm{h})
\displaystyle\bm{h}
\displaystyle=\bm{h}_{t}+\operatorname{zeroconv}(sub\_\bm{h})
\displaystyle\bm{x}=\bm{x}_{t}+\operatorname{zeroconv}(sub\_\bm{x})
\displaystyle\bm{x}
\displaystyle=\bm{x}_{t}+\operatorname{zeroconv}(sub\_\bm{x})
sub
\bm{h}
t
t
\displaystyle\bm{h}=\operatorname{concat}(\bm{h}_{\texttt{feature}},t/2)\ %
\text{(in main network)}
\displaystyle\bm{h}
\displaystyle=\operatorname{concat}(\bm{h}_{\texttt{feature}},t/2)\ \text{(in %
main network)}
\displaystyle\bm{h}=\operatorname{concat}(\bm{h}_{\texttt{feature}},t)\ \ \ \ %
\ \text{(in controlnet)}
\displaystyle\bm{h}
\displaystyle=\operatorname{concat}(\bm{h}_{\texttt{feature}},t)\ \ \ \ \ %
\text{(in controlnet)}
t
t
\bm{x}
\varphi
\varphi^{\prime}
\varphi
t\sim\mathcal{U}(0,\dots,T),\ \bm{\epsilon}_{t}\sim\mathcal{N}(0,\textbf{I}),p%
\sim\mathcal{U}(0,1)
\bm{u}
\bm{z}_{t}\leftarrow\alpha_{t}\bm{x}+\sigma_{t}\bm{\epsilon}_{t}
\bm{c}\leftarrow\alpha\cdot\bm{\mu}
\alpha
\bm{c}_{t}\leftarrow\bm{z}_{t}+\bm{c}
\hat{\bm{\epsilon}}_{t}\leftarrow\varphi(\bm{z}_{t},\varphi^{\prime}(\bm{c}_{t%
},t),t/2)
\|\bm{\epsilon}-\hat{\bm{\epsilon}}_{t}\|^{2}
\bm{u}
\varphi
\varphi^{\prime}
\bm{u}
\bm{z}_{T}\sim\mathcal{N}(0,\textbf{I})
t
T,\ T-1,\ \dots\ 1
\bm{\epsilon}_{t}\sim\mathcal{N}(0,\textbf{I})
\bm{c}\leftarrow\alpha\cdot\bm{\mu}
\bm{c}_{t}\leftarrow\bm{z}_{t}+\bm{c}
\hat{\bm{\epsilon}}_{t}\leftarrow\varphi(\bm{z}_{t},\varphi^{\prime}(\bm{c}_{t%
},t),t/2)
\bm{z}_{t-1}\leftarrow(1/\alpha_{t|s})\cdot\bm{z}_{t}-\sigma_{t|s}^{2}/({%
\alpha}_{t|s}\sigma_{t})\cdot\hat{\bm{\epsilon}}_{t}+\sigma_{t\rightarrow s}%
\cdot\bm{\epsilon}
\bm{x}\sim p(\bm{x}|\bm{z}_{0},\bm{u})
\bm{u}
\bm{x}
p(\bm{z}_{T}|\bm{u})=\mathcal{N}(\bm{z}_{T};f(\bm{u}),I)
f
\varphi
\bm{z}_{t}
\bm{u}
p(\bm{z}_{0}|\bm{u})
\bm{u}
\varphi
\bm{h}
\bm{x}
\bm{z}_{t}
\bm{u}
\operatorname{zeroconv}(\Delta control\_{\bm{x}}_{i}^{l+1})
\varphi
\bm{z}_{t}
\bm{u}
\bm{u}
\bm{z}_{t}
\mathcal{N}(0,I)
\%
\uparrow
\downarrow
\%
\uparrow
\%
\uparrow
\%
\uparrow
\downarrow
\%
\uparrow
\%
\uparrow
\%
\uparrow
\downarrow
p\sim U(0.2,0.5)
\%
\uparrow
\%
\uparrow
\%
\uparrow
\%
\uparrow
\%
\uparrow
\%
\uparrow
\%
\uparrow
\%
\uparrow
