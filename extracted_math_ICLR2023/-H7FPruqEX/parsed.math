(\mathcal{S},\mathcal{A},p,r,\gamma)
\mathcal{S}
\mathcal{A}
p:\mathcal{S}\times\mathcal{A}\times\mathcal{S}\to[0,1]
r:\mathcal{S}\times\mathcal{A}\to\mathbb{R}
\gamma
\pi:\mathcal{S}\times\mathcal{A}\to[0,1]
\mbox{maximize}\ \mathcal{J}=\mathbb{E}_{traj\sim\pi}\left[\sum_{t}\gamma^{t}r%
(s_{t},a_{t})\right],
traj=\{s_{0},a_{0},r_{0},\dots\}
\pi
\mathcal{J}
V^{\pi}(s)=\mathbb{E}_{\pi}\left[\sum_{t}\gamma^{t}r_{t}|s_{0}=s\right]
Q^{\pi}(s,a)=\mathbb{E}_{\pi}\left[\sum_{t}\gamma^{t}r_{t}|s_{0}=s,a_{0}=a\right]
A^{\pi}(s,a)=Q^{\pi}(s,a)-V^{\pi}(s)
Q_{\theta}
Q^{\pi}
\mbox{minimize}\ \mathbb{E}_{\pi}[(Q^{\pi}(s,a)-Q_{\theta}(s,a))^{2}],
Q^{\pi}
\lambda
\mathcal{J}
\pi_{\theta}
\nabla_{\theta}\mathcal{J}=\mathbb{E}_{\pi}[\Psi(s,a)\nabla_{\theta}\log\pi_{%
\theta}(a|s)].
\Psi=\sum_{t=0}^{\infty}\gamma^{t}r_{t}
\Psi(s,a)
\Psi(s,a)=r+\gamma V^{\tilde{\pi}}(s^{\prime})-V_{\theta}(s)
V^{\tilde{\pi}}
V_{\theta}
V^{\pi}
Q_{\theta}
Q^{\pi}
\pi_{\theta}
\theta
\tau
\tau
\theta\leftarrow\theta+\eta\mathbb{E}_{\pi}[(Q^{\pi}-Q_{\theta})\nabla_{\theta%
}Q_{\theta}]
\theta\leftarrow\theta+\eta\mathbb{E}_{\pi}[(Q^{\pi}-V_{\theta})\nabla_{\theta%
}\log\pi_{\theta}]
\pi
Q
V
\pi
pg
\textbf{E}\rightarrow\textbf{I}\rightarrow\textbf{E}\rightarrow\textbf{I}\cdots
\pi
Q
V
\pi
pg
\textbf{E}\rightarrow\textbf{I}\rightarrow\textbf{E}\rightarrow\textbf{I}\cdots
<x,y>
<x,y>=\arccos(\frac{x\cdot y}{||x||\cdot||y||})
\arccos:[-1,1]\rightarrow[0,\pi]
\beta
\beta\overset{def}{=}<\mathbb{E}_{\pi}[(Q^{\pi}-Q_{\theta})\nabla_{\theta}Q_{%
\theta}],\,\mathbb{E}_{\pi}[(Q^{\pi}-V_{\theta})\nabla_{\theta}\log\pi_{\theta%
}]>.
\beta=0
\cos(\beta)=1
\beta=\pi/2
\cos(\beta)=0
\beta=\pi
\cos(\beta)=-1
Q^{\pi}
Q_{\theta}
\pi
\pi_{\theta}
\beta>0
\beta=0
\beta=0
\beta
\beta=0
\theta
\chi
\theta
\chi\overset{def}{=}\mathbb{E}_{\pi}[\cos<\nabla_{\theta}Q_{\theta},\nabla_{%
\theta}\log\pi_{\theta}>].
\chi
\chi=1
\nabla_{\theta}Q_{\theta}=\nabla_{\theta}\log\pi_{\theta}
\chi
\cos(\beta)
\chi
\cos(\beta)
\beta
\chi
\cos(\beta)
\chi
\chi
\cos(\beta)
\arccos(\chi)
\beta
\pi/2
\chi=1
\cos(\beta)
1
\tau\in\mathbb{R}_{+}
sg
stop\ gradient
V_{\theta}
A_{\theta}
\theta
\pi_{\theta}
Q_{\theta}
\left\{\begin{aligned} &\pi_{\theta}(\cdot|s)=\text{softmax}(A_{\theta}(s,%
\cdot)/\tau),\\
&\bar{A}_{\theta}(s,a)=A_{\theta}(s,a)-\sum_{a^{\prime}}sg(\pi_{\theta}(a^{%
\prime}|s))A_{\theta}(s,a^{\prime}),\\
&Q_{\theta}(s,a)=\bar{A}_{\theta}(s,a)+sg(V_{\theta}(s)).\end{aligned}\right.
sg
sg
\bar{A}_{\theta}=A_{\theta}-\mathbb{E}_{\pi}[A_{\theta}]=A_{\theta}-sg(\pi_{%
\theta})\cdot A_{\theta}
sg
sg
\pi_{\theta}
\pi_{\theta}
sg
Q_{\theta}=\bar{A}_{\theta}+sg(V_{\theta})
sg
Q_{\theta}=\bar{A}_{\theta}+sg(V_{\theta})
Q_{\theta}
Q^{\pi}
Q_{\theta}=A_{\theta}+V_{\theta}
\mathbb{E}_{\pi}[A_{\theta}]=0
\mathbb{E}_{\pi}[Q_{\theta}]=V_{\theta}
Q_{\pi}
Q_{\theta}=A_{\theta}-\mathbb{E}_{\pi}[A_{\theta}]+V_{\theta}
\mathbb{E}_{\pi}[Q_{\theta}]=V_{\theta}
\theta
V,Q,A,\pi
V
Q
V^{\tilde{\pi}}
Q^{\tilde{\pi}}
V^{\tilde{\pi}}
Q^{\tilde{\pi}}
\theta
\displaystyle L_{V}(\theta)=\mathbb{E}_{\pi}[(V^{\tilde{\pi}}-V)^{2}],\ L_{Q}(%
\theta)=\mathbb{E}_{\pi}[(Q^{\tilde{\pi}}-Q)^{2}],
\displaystyle L_{V}(\theta)=\mathbb{E}_{\pi}[(V^{\tilde{\pi}}-V)^{2}],\ L_{Q}(%
\theta)=\mathbb{E}_{\pi}[(Q^{\tilde{\pi}}-Q)^{2}],
\theta
\displaystyle\nabla_{\theta}L_{V}(\theta)=\mathbb{E}_{\pi}\left[(V^{\tilde{\pi%
}}-V)\nabla_{\theta}V\right],\ \nabla_{\theta}L_{Q}(\theta)=\mathbb{E}_{\pi}%
\left[(Q^{\tilde{\pi}}-Q)\nabla_{\theta}Q\right].
\displaystyle\nabla_{\theta}L_{V}(\theta)=\mathbb{E}_{\pi}\left[(V^{\tilde{\pi%
}}-V)\nabla_{\theta}V\right],\ \nabla_{\theta}L_{Q}(\theta)=\mathbb{E}_{\pi}%
\left[(Q^{\tilde{\pi}}-Q)\nabla_{\theta}Q\right].
\theta
\displaystyle\nabla_{\theta}\mathcal{J}(\tau,\theta)=\mathbb{E}_{\pi}\left[%
\tau(Q^{\tilde{\pi}}-V)\nabla_{\theta}\log\pi\right],
\displaystyle\nabla_{\theta}\mathcal{J}(\tau,\theta)=\mathbb{E}_{\pi}\left[%
\tau(Q^{\tilde{\pi}}-V)\nabla_{\theta}\log\pi\right],
\mathcal{J}(\tau,\theta)=\tau\mathbb{E}_{\pi}[\sum\gamma^{t}r_{t}]
\tau
\tau
\theta
\alpha_{1}\nabla_{\theta}L_{V}+\alpha_{2}\nabla_{\theta}L_{Q}+\alpha_{3}\nabla%
_{\theta}\mathcal{J}.
(V,Q,\pi)
\nabla_{\theta}Q=(\textbf{1}-\pi)\nabla_{\theta}A=\tau\nabla_{\theta}\log\pi.
\textbf{g}=(\textbf{1}-\pi)\nabla_{\theta}A.
\displaystyle\nabla_{\theta}L_{Q}=\mathbb{E}_{\pi}\left[(Q^{\tilde{\pi}}-Q)%
\textbf{g}\right],\nabla_{\theta}\mathcal{J}=\mathbb{E}_{\pi}\left[(Q^{\tilde{%
\pi}}-V)\textbf{g}\right].
\displaystyle\nabla_{\theta}L_{Q}=\mathbb{E}_{\pi}\left[(Q^{\tilde{\pi}}-Q)%
\textbf{g}\right],\nabla_{\theta}\mathcal{J}=\mathbb{E}_{\pi}\left[(Q^{\tilde{%
\pi}}-V)\textbf{g}\right].
\nabla_{\theta}L_{Q}
\nabla_{\theta}\mathcal{J}
\chi=1
Q
\pi
\tau
\nabla_{\theta}L_{Q}
\nabla_{\theta}\mathcal{J}
\nabla_{\theta}\mathcal{J}=\nabla_{\theta}L_{Q}+\mathbb{E}_{\pi}\left[(Q-V)%
\textbf{g}\right].
\mathbb{E}_{\pi}\left[(Q-V)\textbf{g}\right]
Q
Q
\nabla_{\theta}\mathcal{J}
\theta
Q
Q
(V,Q,\pi)
\mathbb{E}_{\pi}\left[(Q-V)\textbf{g}\right]=\tau\mathbb{E}_{\pi}\left[(Q-V)%
\nabla_{\theta}\log\pi\right]=-\tau^{2}\nabla_{\theta}\textbf{H}[\pi],
\nabla_{\theta}L_{Q}=\nabla_{\theta}\mathcal{J}+\tau^{2}\nabla_{\theta}\textbf%
{H}[\pi].
\nabla_{\theta}L_{Q}
\nabla_{\theta}L_{Q}
\theta
\alpha_{2}\nabla_{\theta}L_{Q}
\delta^{{\color[rgb]{0,0,1}DR}}_{t}{=}r_{t}+\gamma{\color[rgb]{0,0,1}V}(s_{t+1%
})-{\color[rgb]{0,0,1}Q}(s_{t},a_{t})
\delta^{{\color[rgb]{1,.5,0}V}/{\color[rgb]{0,1,0}Q}}_{t}{=}r_{t}+\gamma{%
\color[rgb]{1,.5,0}V}(s_{t+1})/{\color[rgb]{0,1,0}Q}(s_{t+1},a_{t+1})-{\color[%
rgb]{1,.5,0}V}(s_{t})/{\color[rgb]{0,1,0}Q}(s_{t},a_{t})
V^{\tilde{\pi}}
\mathbb{E}_{\mu}[V_{t}+\sum_{k\geq 0}\gamma^{k}c_{[t:t+k-1]}\rho_{t+k}{\color[%
rgb]{0,0,1}\delta^{DR}_{t+k}}]
\mathbb{E}_{\mu}[V_{t}+\sum_{k\geq 0}\gamma^{k}c_{[t:t+k-1]}\rho_{t+k}{\color[%
rgb]{1,.5,0}\delta^{V}_{t+k}}]
Q^{\tilde{\pi}}
\mathbb{E}_{\mu}[Q_{t}+\sum_{k\geq 0}\gamma^{k}{\color[rgb]{0,0,1}c_{[t+1:t+k-%
1]}(1_{\{k=0\}}+1_{\{k>0\}}\rho_{t+k})\delta^{DR}_{t+k}}]
\mathbb{E}_{\mu}[Q_{t}+\sum_{k\geq 0}\gamma^{k}{\color[rgb]{0,1,0}c_{[t+1:t+k]%
}\delta^{Q}_{t+k}}]
\nabla\mathcal{J}
\mathbb{E}_{\mu}[\rho_{t}({\color[rgb]{0,0,1}Q_{t}^{\tilde{\pi}}}-V_{t})\nabla%
\log\pi]
\mathbb{E}_{\mu}[\rho_{t}({\color[rgb]{1,.5,0}r_{t}+V_{t+1}^{\tilde{\pi}}}-V_{%
t})\nabla\log\pi]
\mu
V^{\tilde{\pi}}
Q^{\tilde{\pi}}
(V,Q,\pi)
\nabla L_{V}=\mathbb{E}_{\pi}[(V^{\pi}-V_{\theta})\nabla V_{\theta}]
\nabla L_{Q}=\mathbb{E}_{\pi}[(Q^{\pi}-Q_{\theta})\nabla Q_{\theta}]
\nabla\mathcal{J}=\mathbb{E}_{\pi}[(Q^{\pi}-V_{\theta})\nabla\log\pi_{\theta}]
<a,b>
a,b\in\{\nabla L_{V},\nabla L_{Q},\nabla\mathcal{J}\}
a
b
\cos<\nabla Q,\nabla\log\pi>
\chi
\mathbb{E}_{\pi}[\cos<\nabla_{\theta}Q_{\theta},\nabla_{\theta}\log\pi_{\theta%
}>]
\frac{x\cdot y}{||x||\cdot||y||}
\frac{x\cdot y}{\max(||x||,10^{-8})\cdot\max(||y||,10^{-8})}
\begin{array}[]{c|ccc|ccc}\hline\cr\hline\cr&\text{PPO}&&\text{PPO+CASA}&\text%
{R2D2}&&\text{R2D2+CASA}\\
\hline\cr&&\hbox{\multirowsetup$\Rightarrow$}&(V,A)=(V_{\theta},A_{\theta})&&%
\hbox{\multirowsetup$\Rightarrow$}&(V,A)=(V_{\theta},A_{\theta})\\
\text{Func.}&(V,logit)=(V_{\theta},logit_{\theta})&&\pi=\text{softmax}(A/\tau)%
&(V,A)=(V_{\theta},A_{\theta})&&\pi=\text{softmax}(A/\tau)\\
\text{Approx.}&\pi=\text{softmax}(logit)&&\bar{A}=A-sg(\pi)\cdot A&Q=A+V&&\bar%
{A}=A-sg(\pi)\cdot A\\
&&&Q=\bar{A}+sg(V)&&&Q=\bar{A}+sg(V)\\
\hline\cr\text{Gradient}&0.5\nabla L_{V}+\nabla\mathcal{J}&\Rightarrow&0.5%
\nabla L_{V}+\nabla L_{Q}+\nabla\mathcal{J}&\nabla L_{Q}&\Rightarrow&0.5\nabla
L%
_{V}+\nabla L_{Q}+\nabla\mathcal{J}\\
\hline\cr\hline\cr\end{array}
\epsilon
\arg\max Q
\pi_{surrogate}=\text{softmax}(A/\tau)
\chi=1
\alpha_{1},\alpha_{2},\alpha_{3}
\cos(\beta)
\chi
\pi
Q
\begin{array}[]{c|c}\hline\cr\hline\cr\text{PPO+CASA}&Q=A_{\theta}-sg(\pi_{%
\theta})\cdot A_{\theta}+sg(V_{\theta})\\
\hline\cr\text{type 1}&Q=A_{\theta}-\pi_{\theta}\cdot A_{\theta}+sg(V_{\theta}%
)\\
\hline\cr\text{type 2}&Q=A_{\theta}-sg(\pi_{\theta})\cdot A_{\theta}+V_{\theta%
}\\
\hline\cr\text{type 3}&Q=A_{\theta}+sg(V_{\theta})\\
\hline\cr\text{type 4}&Q=A_{\theta}+V_{\theta}\\
\hline\cr\text{type 5}&Q=Q_{\theta}\\
\hline\cr\hline\cr\end{array}
\&
sg
\pi
sg
V_{\theta}
\&
sg
V
Q_{\theta}
Q^{\pi}
\&
sg
\pi
sg
V_{\theta}
\&
sg
V
Q_{\theta}
Q^{\pi}
\nabla Q\propto\nabla\log\pi
\chi=1
Q=A-\mathbb{E}_{\pi}[A]+sg(V)
0.5\cdot\nabla L_{V}+\nabla L_{Q}+\nabla\mathcal{J}
\chi
\cos(\beta)
(\chi,\cos(\beta))
(\chi,\cos(\beta))
\chi
\cos(\beta)
(\chi,\cos(\beta))
(\chi,\cos(\beta))
sg\text{-}V
no\text{-}sg\text{-}V
sg\text{-}V
\chi
\cos(\beta)
no\text{-}sg\text{-}V
sg\text{-}V
\chi=1
\cos(\beta)
\pi
Q^{\pi}
\chi
\cos(\beta)
\chi
\cos(\beta)
\%
\%
\%
\chi
\chi=1
\pi
\chi=1
\pi
\chi
\pi
\pi
Q_{w}
w
\pi_{\theta}
\theta
Q_{w}
\mathbb{E}_{\pi}[(Q^{\pi}-Q_{w})\nabla_{w}Q_{w}]=0
\nabla_{w}Q_{w}=\nabla_{\theta}\log\pi_{\theta},
\nabla_{\theta}\mathcal{J}=\mathbb{E}_{\pi}[Q_{w}\nabla_{\theta}\log\pi_{%
\theta}].
w=\theta
Q_{w}
\pi_{\theta}
Q_{\theta}
\theta
\pi_{\theta}
\theta
Q_{\theta}
\mathbb{E}_{\pi}[(Q^{\pi}-Q_{\theta})\nabla_{\theta}Q_{\theta}]=0
\nabla_{\theta}Q_{\theta}=\nabla_{\theta}\log\pi_{\theta},
\nabla_{\theta}\mathcal{J}=\mathbb{E}_{\pi}[Q_{\theta}\nabla_{\theta}\log\pi_{%
\theta}].
\chi\overset{def}{=}\mathbb{E}_{\pi}[\cos<\nabla_{\theta}Q_{\theta},\nabla_{%
\theta}\log\pi_{\theta}>].
\chi=1
\nabla_{\theta}Q_{\theta}=\nabla_{\theta}\log\pi_{\theta}
\nabla_{\theta}Q_{\theta}\propto\nabla_{\theta}\log\pi_{\theta}
\chi=1
\chi=1
\nabla_{\theta}Q_{\theta}\propto\nabla_{\theta}\log\pi_{\theta}
\chi=1
\nabla_{\theta}Q_{\theta}\propto\nabla_{\theta}\log\pi_{\theta}
\nabla_{\theta}Q_{\theta}\propto\nabla_{\theta}\log\pi_{\theta}
\nabla_{\theta}Q_{\theta}=\nabla_{\theta}\log\pi_{\theta}
\chi=1
\nabla_{\theta}Q_{\theta}=\nabla_{\theta}\log\pi_{\theta}
\nabla_{\theta}Q_{\theta}\propto\nabla_{\theta}\log\pi_{\theta}
<\nabla_{\theta}Q_{\theta},\nabla_{\theta}\log\pi_{\theta}>=0
\chi
\chi=\mathbb{E}_{\pi}[\cos<\nabla_{\theta}Q_{\theta},\nabla_{\theta}\log\pi_{%
\theta}>]=\mathbb{E}_{\pi}[1]=1.
\chi\leq 1
\cos(x)
x
0
\pi
\chi=1
\cos<\nabla_{\theta}Q_{\theta},\nabla_{\theta}\log\pi_{\theta}>=0
\nabla_{\theta}Q_{\theta}\propto\nabla_{\theta}\log\pi_{\theta}
\begin{array}[]{c|c|c|c}\hline\cr\hline\cr&\text{Function Approximation}&\text%
{Train Gradients}&\text{Cosine of Interested Angles}\\
\hline\cr\text{PPO}&(V,logit)=(V_{\theta},logit_{\theta})&0.5\nabla L_{V}+%
\nabla\mathcal{J}&\\
&\pi=\text{softmax}(logit)&&\\
\hline\cr\text{PPO ver.1}&(Q,logit)=(Q_{\theta},logit_{\theta}),&0.5\nabla L_{%
V}+\nabla\mathcal{J}&\cos<\nabla L_{Q},\nabla\mathcal{J}>\\
&\pi=\text{softmax}(logit)&&\cos<\nabla Q,\nabla\log\pi>\\
&V=sg(\pi)\cdot Q&&\\
\hline\cr\text{PPO ver.2}&(Q,logit)=(Q_{\theta},logit_{\theta}),&0.5\nabla L_{%
V}+\nabla L_{Q}+\nabla\mathcal{J}&\cos<\nabla L_{Q},\nabla\mathcal{J}>\\
&pi=\text{softmax}(logit)&&\cos<\nabla Q,\nabla\log\pi>\\
&V=sg(\pi)\cdot Q&&\\
\hline\cr\text{PPO+CASA}&(V,A)=(V_{\theta},A_{\theta}),&0.5\nabla L_{V}+\nabla
L%
_{Q}+\nabla\mathcal{J}&\cos<\nabla L_{Q},\nabla\mathcal{J}>\\
&\pi=\text{softmax}(A/\tau),&&\cos<\nabla Q,\nabla\log\pi>\\
&\bar{A}=A-sg(\pi)\cdot A&&\\
&Q=\bar{A}+sg(V)&&\\
\hline\cr\hline\cr\end{array}
\nabla L_{Q}
\nabla L_{Q}
\begin{array}[]{c|c|c|c}\hline\cr\hline\cr&\text{Function Approximation}&\text%
{Train Gradients}&\text{Cosine of Interested Angles}\\
\hline\cr\text{R2D2}&(V,A)=(V_{\theta},A_{\theta})&\nabla L_{Q}&\cos<\nabla L_%
{Q},\nabla\mathcal{J}>\\
&Q=A+V&&\\
&\pi=\text{softmax}(A/\tau)&&\\
\hline\cr\text{R2D2 ver.1}&(V,A)=(V_{\theta},A_{\theta})&0.5\nabla L_{V}+%
\nabla L_{Q}&\cos<\nabla L_{Q},\nabla\mathcal{J}>\\
&Q=A+V&&\\
&\pi=\text{softmax}(A/\tau)&&\\
\hline\cr\text{R2D2+CASA}&(V,A)=(V_{\theta},A_{\theta}),&0.5\nabla L_{V}+%
\nabla L_{Q}+\nabla\mathcal{J}&\cos<\nabla L_{Q},\nabla\mathcal{J}>\\
&\pi=\text{softmax}(A/\tau),&&\\
&\bar{A}=A-sg(\pi)\cdot A&&\\
&Q=\bar{A}+sg(V)&&\\
\hline\cr\hline\cr\end{array}
\nabla L_{V}
\nabla L_{V}
\beta\overset{def}{=}<\mathbb{E}_{\pi}[(Q^{\pi}-Q_{\theta})\nabla_{\theta}Q_{%
\theta}],\,\mathbb{E}_{\pi}[(Q^{\pi}-V_{\theta})\nabla_{\theta}\log\pi_{\theta%
}]>
\chi\overset{def}{=}\mathbb{E}_{\pi}[\cos<\nabla_{\theta}Q_{\theta},\nabla_{%
\theta}\log\pi_{\theta}>]
L_{V}(\theta)=\mathbb{E}_{\pi}[(V^{\pi}-V_{\theta})^{2}],\ L_{Q}(\theta)=%
\mathbb{E}_{\pi}[(Q^{\pi}-Q_{\theta})^{2}],
\nabla_{\theta}\mathcal{J}(\theta)=\mathbb{E}_{\pi}\left[(Q^{\pi}-V_{\theta})%
\nabla_{\theta}\log\pi\right].
V^{\pi}
Q^{\pi}
\cos<\nabla Q,\nabla\log\pi>=\mathbb{E}_{\pi}[\cos<\nabla_{\theta}Q_{\theta},%
\nabla_{\theta}\log\pi_{\theta}>],
\displaystyle\cos<\nabla L_{Q},\nabla\mathcal{J}>=\cos<\mathbb{E}_{\pi}[(Q^{%
\pi}-Q_{\theta})\nabla_{\theta}Q_{\theta}],\,\mathbb{E}_{\pi}[(Q^{\pi}-V_{%
\theta})\nabla_{\theta}\log\pi_{\theta}]>,
\displaystyle\cos<\nabla L_{Q},\nabla\mathcal{J}>=\cos<\mathbb{E}_{\pi}[(Q^{%
\pi}-Q_{\theta})\nabla_{\theta}Q_{\theta}],\,\mathbb{E}_{\pi}[(Q^{\pi}-V_{%
\theta})\nabla_{\theta}\log\pi_{\theta}]>,
\displaystyle\cos<\nabla L_{V},\nabla\mathcal{J}>=\cos<\mathbb{E}_{\pi}[(V^{%
\pi}-V_{\theta})\nabla_{\theta}V_{\theta}],\,\mathbb{E}_{\pi}[(Q^{\pi}-V_{%
\theta})\nabla_{\theta}\log\pi_{\theta}]>,
\displaystyle\cos<\nabla L_{V},\nabla\mathcal{J}>=\cos<\mathbb{E}_{\pi}[(V^{%
\pi}-V_{\theta})\nabla_{\theta}V_{\theta}],\,\mathbb{E}_{\pi}[(Q^{\pi}-V_{%
\theta})\nabla_{\theta}\log\pi_{\theta}]>,
\displaystyle\cos<\nabla L_{V},\nabla L_{Q}>=\cos<\mathbb{E}_{\pi}[(V^{\pi}-V_%
{\theta})\nabla_{\theta}V_{\theta}],\,\mathbb{E}_{\pi}[(Q^{\pi}-Q_{\theta})%
\nabla_{\theta}Q_{\theta}]>.
\displaystyle\cos<\nabla L_{V},\nabla L_{Q}>=\cos<\mathbb{E}_{\pi}[(V^{\pi}-V_%
{\theta})\nabla_{\theta}V_{\theta}],\,\mathbb{E}_{\pi}[(Q^{\pi}-Q_{\theta})%
\nabla_{\theta}Q_{\theta}]>.
\nabla_{\theta}L_{V}
\nabla_{\theta}\mathcal{J}
\nabla_{\theta}L_{Q}
\cos(\beta)
\chi
V_{\theta}
sg(\pi)\cdot Q_{\theta}
Q_{\theta}
V_{\theta}
Q_{\theta}
\epsilon
\epsilon
\arg\max Q_{\theta}
\arg\max Q_{\theta}
\text{softmax}(A_{\theta}/\tau)=\text{softmax}(Q_{\theta}/\tau)\overset{\tau%
\rightarrow 0+}{\longrightarrow}\arg\max Q_{\theta}
\pi_{surrogate}=\text{softmax}(A_{\theta}/\tau)
\pi_{surrogate}
\epsilon
\tau=1
\left\{\begin{aligned} &\pi=\text{softmax}(A),\\
&\bar{A}=A-\mathbb{E}_{\pi}[A],\\
&Q=\bar{A}+sg(V).\end{aligned}\right.
\text{softmax}(A)
\mathbb{E}_{\pi}[A]
a_{0},\dots,a_{k}
A(s,a_{0}),\dots,A(s,a_{k})
K(\cdot,\cdot)
a
A(s,a)
A(s,a)=\frac{1}{Z_{a}}(K(a_{0},a)A(s,a_{0})+\dots+K(a_{k},a)A(s,a_{k})),
Z_{a}=\sum_{i=0}^{k}K(a_{i},a)
K(\cdot,a)
a
|\{A(s,a_{0}),\dots,A(s,a_{k})\}|
\text{softmax}(A)
\mathbb{E}_{\pi}[A]
V
\left\{\begin{aligned} &\pi(s,a)=\exp(A(s,a))/\int_{a}\exp(A(s,a))da,\\
&\bar{A}(s,a)=A(s,a)-\int_{a}sg(\pi(s,a))A(s,a)da,\\
&Q(s,a)=\bar{A}(s,a)+sg(V(s)).\end{aligned}\right.
\displaystyle\nabla\log\pi(s,a)=\nabla A(s,a)-\frac{\nabla\int_{a}\exp(A(s,a))%
da}{\int_{a}\exp(A(s,a))da}
\displaystyle\nabla\log\pi(s,a)
\displaystyle=\nabla A(s,a)-\frac{\nabla\int_{a}\exp(A(s,a))da}{\int_{a}\exp(A%
(s,a))da}
\displaystyle=\nabla A(s,a)-\frac{\int_{a}\exp(A(s,a))\nabla A(s,a)da}{\int_{a%
}\exp(A(s,a))da}
\displaystyle=\nabla A(s,a)-\frac{\int_{a}\exp(A(s,a))\nabla A(s,a)da}{\int_{a%
}\exp(A(s,a))da}
\displaystyle=\nabla A(s,a)-\int_{a}\frac{\exp(A(s,a))}{\int_{a}\exp(A(s,a))da%
}\nabla A(s,a)da
\displaystyle=\nabla A(s,a)-\int_{a}\frac{\exp(A(s,a))}{\int_{a}\exp(A(s,a))da%
}\nabla A(s,a)da
\displaystyle=\nabla A(s,a)-\int_{a}\pi(s,a)\nabla A(s,a)da
\displaystyle=\nabla A(s,a)-\int_{a}\pi(s,a)\nabla A(s,a)da
\displaystyle=\nabla\bar{A}(s,a)=\nabla Q(s,a).
\displaystyle=\nabla\bar{A}(s,a)=\nabla Q(s,a).
(V,Q,\pi)
\tilde{\pi}_{VTrace}=\tilde{\pi}_{ReTrace}
(V,Q,\pi)
V
Q
\tilde{\pi}_{VTrace}=\tilde{\pi}_{ReTrace}
(V,Q)
V
\displaystyle V_{DR}^{\tilde{\pi}}(s_{t})\overset{def}{=}\mathbb{E}_{\mu}[V(s_%
{t})+\sum_{k\geq 0}\gamma^{k}c_{[t:t+k-1]}\rho_{t+k}\delta^{DR}_{t+k}],
\displaystyle V_{DR}^{\tilde{\pi}}(s_{t})
\displaystyle\overset{def}{=}\mathbb{E}_{\mu}[V(s_{t})+\sum_{k\geq 0}\gamma^{k%
}c_{[t:t+k-1]}\rho_{t+k}\delta^{DR}_{t+k}],
\mu
\delta^{DR}_{t}\overset{def}{=}r_{t}+\gamma V(s_{t+1})-Q(s_{t},a_{t})
\rho_{t}\overset{def}{=}\min\{\frac{\pi_{t}}{\mu_{t}},\bar{\rho}\}
c_{t}\overset{def}{=}\min\{\frac{\pi_{t}}{\mu_{t}},\bar{c}\}
c_{[t:t+k]}\overset{def}{=}\prod_{i=0}^{k}c_{t+i}
Q
\displaystyle Q_{DR}^{\tilde{\pi}}(s_{t},a_{t})\overset{def}{=}\mathbb{E}_{s_{%
t+1},r_{t}\sim p(\cdot,\cdot|s_{t},a_{t})}[r_{t}+\gamma V_{DR}^{\tilde{\pi}}(s%
_{t+1})]
\displaystyle Q_{DR}^{\tilde{\pi}}(s_{t},a_{t})
\displaystyle\overset{def}{=}\mathbb{E}_{s_{t+1},r_{t}\sim p(\cdot,\cdot|s_{t}%
,a_{t})}[r_{t}+\gamma V_{DR}^{\tilde{\pi}}(s_{t+1})]
\displaystyle=\mathbb{E}_{\mu}[Q(s_{t},a_{t})+\sum_{k\geq 0}\gamma^{k}c_{[t+1:%
t+k-1]}\tilde{\rho}_{t,k}\delta^{DR}_{t+k}],
\displaystyle=\mathbb{E}_{\mu}[Q(s_{t},a_{t})+\sum_{k\geq 0}\gamma^{k}c_{[t+1:%
t+k-1]}\tilde{\rho}_{t,k}\delta^{DR}_{t+k}],
\tilde{\rho}_{t,k}=1_{\{k=0\}}+1_{\{k>0\}}\rho_{t+k}
\bar{A}=A-\mathbb{E}_{\pi}[A]
Q=\bar{A}+sg(V)
\displaystyle\mathscr{T}(Q)\overset{def}{=}\mathbb{E}_{\mu}[Q(s_{t},a_{t})+%
\sum_{k\geq 0}\gamma^{k}c_{[t+1:t+k-1]}\tilde{\rho}_{t,k}\delta^{DR}_{t+k}],
\displaystyle\mathscr{T}(Q)\overset{def}{=}\mathbb{E}_{\mu}[Q(s_{t},a_{t})+%
\sum_{k\geq 0}\gamma^{k}c_{[t+1:t+k-1]}\tilde{\rho}_{t,k}\delta^{DR}_{t+k}],
\displaystyle\mathscr{S}(V)\overset{def}{=}\mathbb{E}_{\mu}[V(s_{t})+\sum_{k%
\geq 0}\gamma^{k}c_{[t:t+k-1]}\rho_{t,k}\delta^{DR}_{t+k}],
\displaystyle\mathscr{S}(V)\overset{def}{=}\mathbb{E}_{\mu}[V(s_{t})+\sum_{k%
\geq 0}\gamma^{k}c_{[t:t+k-1]}\rho_{t,k}\delta^{DR}_{t+k}],
\displaystyle\mathscr{U}(Q,V)=(\mathscr{T}(Q)-\mathbb{E}_{\pi}[Q]+\mathscr{S}(%
V),\mathscr{S}(V)),
\displaystyle\mathscr{U}(Q,V)=(\mathscr{T}(Q)-\mathbb{E}_{\pi}[Q]+\mathscr{S}(%
V),\mathscr{S}(V)),
\displaystyle\mathscr{U}^{(n)}(Q,V)=\mathscr{U}(\mathscr{U}^{(n-1)}(Q,V)),
\displaystyle\mathscr{U}^{(n)}(Q,V)=\mathscr{U}(\mathscr{U}^{(n-1)}(Q,V)),
\mathscr{U}^{(n)}(Q,V)\rightarrow(Q^{\tilde{\pi}},V^{\tilde{\pi}})
\tilde{\pi}(a|s)=\frac{\min\left\{\bar{\rho}\mu(a|s),\pi(a|s)\right\}}{\sum_{b%
\in\mathcal{A}}\min\left\{\bar{\rho}\mu(b|s),\pi(b|s)\right\}}.
n\rightarrow+\infty
(V,Q)
(V^{\tilde{\pi}},Q^{\tilde{\pi}})
\displaystyle\tilde{\pi}(a|s)=\frac{\min\left\{\bar{\rho}\mu(a|s),\pi(a|s)%
\right\}}{\sum_{b\in\mathcal{A}}\min\left\{\bar{\rho}\mu(b|s),\pi(b|s)\right\}}.
\displaystyle\tilde{\pi}(a|s)=\frac{\min\left\{\bar{\rho}\mu(a|s),\pi(a|s)%
\right\}}{\sum_{b\in\mathcal{A}}\min\left\{\bar{\rho}\mu(b|s),\pi(b|s)\right\}}.
\pi=softmax(A/\tau)
\nabla\log\pi=(\textbf{1}-\pi)\frac{\nabla A}{\tau}
sg
\bar{A}=A-\mathbb{E}_{\pi}[A]
Q=\bar{A}+sg(V)
\nabla Q=(\textbf{1}-\pi)\nabla A
Q=\bar{A}+sg(V)=A-sg(\pi)\cdot A+sg(V)
\nabla Q=(\textbf{1}-\pi)\nabla A
\log\pi
\nabla\log\pi=(\textbf{1}-\pi)\nabla(A/\tau)=(\textbf{1}-\pi)\frac{\nabla A}{\tau}
\bar{A}=A-\mathbb{E}_{\pi}[A]
Q=\bar{A}+sg(V),\pi=softmax(A/\tau)
\mathbb{E}_{\pi}\left[(Q-V)\nabla\log\pi\right]=-\tau\nabla\textbf{H}[\pi].
\pi=\exp(A/\tau)/Z,\ Z=\int_{\mathcal{A}}\exp(A/\tau),
A=\tau\log\pi+\tau\log Z.
\mathbb{E}_{\pi}\left[f(s)\nabla\log\pi(\cdot|s)\right]=0
\mathbb{E}_{\pi}\left[\mathbb{E}_{\pi}[A]\cdot\nabla\log\pi\right]=0,
\mathbb{E}_{\pi}\left[\log Z\cdot\nabla\log\pi\right]=0.
\displaystyle\mathbb{E}_{\pi}\left[(Q-V)\nabla\log\pi\right]=\mathbb{E}_{\pi}%
\left[A\nabla\log\pi\right]-\mathbb{E}_{\pi}\left[\mathbb{E}_{\pi}[A]\cdot%
\nabla\log\pi\right]
\displaystyle\mathbb{E}_{\pi}\left[(Q-V)\nabla\log\pi\right]
\displaystyle=\mathbb{E}_{\pi}\left[A\nabla\log\pi\right]-\mathbb{E}_{\pi}%
\left[\mathbb{E}_{\pi}[A]\cdot\nabla\log\pi\right]
\displaystyle=\tau\mathbb{E}_{\pi}\left[\log\pi\nabla\log\pi\right]+\tau%
\mathbb{E}_{\pi}\left[\log Z\cdot\nabla\log\pi\right]
\displaystyle=\tau\mathbb{E}_{\pi}\left[\log\pi\nabla\log\pi\right]+\tau%
\mathbb{E}_{\pi}\left[\log Z\cdot\nabla\log\pi\right]
\displaystyle=\tau\mathbb{E}_{\pi}\left[\log\pi\nabla\log\pi\right].
\displaystyle=\tau\mathbb{E}_{\pi}\left[\log\pi\nabla\log\pi\right].
\displaystyle\nabla\textbf{H}[\pi]=-\nabla\int_{\mathcal{A}}\pi_{i}\log\pi_{i}
\displaystyle\nabla\textbf{H}[\pi]
\displaystyle=-\nabla\int_{\mathcal{A}}\pi_{i}\log\pi_{i}
\displaystyle=-\int_{\mathcal{A}}\nabla\pi_{i}\cdot\log\pi_{i}-\int_{\mathcal{%
A}}\pi_{i}\nabla\log\pi_{i}
\displaystyle=-\int_{\mathcal{A}}\nabla\pi_{i}\cdot\log\pi_{i}-\int_{\mathcal{%
A}}\pi_{i}\nabla\log\pi_{i}
\displaystyle=-\int_{\mathcal{A}}\pi_{i}\nabla\log\pi_{i}\cdot\log\pi_{i}-\int%
_{\mathcal{A}}\pi_{i}\frac{\nabla\pi_{i}}{\pi_{i}}
\displaystyle=-\int_{\mathcal{A}}\pi_{i}\nabla\log\pi_{i}\cdot\log\pi_{i}-\int%
_{\mathcal{A}}\pi_{i}\frac{\nabla\pi_{i}}{\pi_{i}}
\displaystyle=-\mathbb{E}_{\pi}\left[\log\pi\nabla\log\pi\right].
\displaystyle=-\mathbb{E}_{\pi}\left[\log\pi\nabla\log\pi\right].
\mathbb{E}_{\pi}\left[(Q-V)\nabla\log\pi\right]=-\tau\nabla\textbf{H}[\pi]
\bar{A}=A-\mathbb{E}_{\pi}[A]
Q=\bar{A}+sg(V)
\displaystyle\mathscr{T}(Q)\overset{def}{=}\mathbb{E}_{\mu}[Q(s_{t},a_{t})+%
\sum_{k\geq 0}\gamma^{k}c_{[t+1:t+k-1]}\tilde{\rho}_{t,k}\delta^{DR}_{t+k}],
\displaystyle\mathscr{T}(Q)\overset{def}{=}\mathbb{E}_{\mu}[Q(s_{t},a_{t})+%
\sum_{k\geq 0}\gamma^{k}c_{[t+1:t+k-1]}\tilde{\rho}_{t,k}\delta^{DR}_{t+k}],
\displaystyle\mathscr{S}(V)\overset{def}{=}\mathbb{E}_{\mu}[V(s_{t})+\sum_{k%
\geq 0}\gamma^{k}c_{[t:t+k-1]}\rho_{t,k}\delta^{DR}_{t+k}],
\displaystyle\mathscr{S}(V)\overset{def}{=}\mathbb{E}_{\mu}[V(s_{t})+\sum_{k%
\geq 0}\gamma^{k}c_{[t:t+k-1]}\rho_{t,k}\delta^{DR}_{t+k}],
\displaystyle\mathscr{U}(Q,V)=(\mathscr{T}(Q)-\mathbb{E}_{\pi}[Q]+\mathscr{S}(%
V),\mathscr{S}(V)),
\displaystyle\mathscr{U}(Q,V)=(\mathscr{T}(Q)-\mathbb{E}_{\pi}[Q]+\mathscr{S}(%
V),\mathscr{S}(V)),
\displaystyle\mathscr{U}^{(n)}(Q,V)=\mathscr{U}(\mathscr{U}^{(n-1)}(Q,V)),
\displaystyle\mathscr{U}^{(n)}(Q,V)=\mathscr{U}(\mathscr{U}^{(n-1)}(Q,V)),
\mathscr{U}^{(n)}(Q,V)\rightarrow(Q^{\tilde{\pi}},V^{\tilde{\pi}})
\tilde{\pi}(a|s)=\frac{\min\left\{\bar{\rho}\mu(a|s),\pi(a|s)\right\}}{\sum_{b%
\in\mathcal{A}}\min\left\{\bar{\rho}\mu(b|s),\pi(b|s)\right\}}.
n\rightarrow+\infty
\mathscr{T}(Q)-\mathbb{E}_{\pi}[Q]+\mathscr{S}(V)
Q
Q=\bar{A}+sg(V)
Q
V
\nabla L_{Q}(\theta)
\nabla L_{V}(\theta)
Q
\nabla L_{Q}(\theta)
A
\nabla L_{V}(\theta)
V
V
Q
-\mathbb{E}_{\pi}[Q]+\mathscr{S}(V)
\displaystyle\widetilde{\mathscr{T}}(Q)=-\mathbb{E}_{\pi}[Q]+\mathscr{T}(Q),
\displaystyle\widetilde{\mathscr{T}}(Q)
\displaystyle=-\mathbb{E}_{\pi}[Q]+\mathscr{T}(Q),
\displaystyle\widetilde{\mathscr{U}}(Q,V)=(\widetilde{\mathscr{T}}(Q),\mathscr%
{S}(V)),
\displaystyle\widetilde{\mathscr{U}}(Q,V)
\displaystyle=(\widetilde{\mathscr{T}}(Q),\mathscr{S}(V)),
\displaystyle\widetilde{\mathscr{U}}^{(n)}(Q,V)=\widetilde{\mathscr{U}}(%
\widetilde{\mathscr{U}}^{(n-1)}(Q,V)).
\displaystyle\widetilde{\mathscr{U}}^{(n)}(Q,V)
\displaystyle=\widetilde{\mathscr{U}}(\widetilde{\mathscr{U}}^{(n-1)}(Q,V)).
\widetilde{\mathscr{T}}^{(n)}(Q)
A^{*}
n\rightarrow\infty
V
V
Q
A^{*}
V
\mathscr{S}^{(n)}(V)
V^{*}
n\rightarrow\infty
\widetilde{\mathscr{U}}^{(n)}(Q,V)\rightarrow(A^{*},V^{*})\ \ as\ \ n%
\rightarrow+\infty.
\mathscr{U}(Q,V)=(\widetilde{\mathscr{T}}(Q)+\mathscr{S}(V),\mathscr{S}(V)),
\widetilde{\mathscr{T}}(Q)+\mathscr{S}(V)
Q
\mathscr{S}(V)
V
\displaystyle\mathscr{U}^{(2)}(Q,V)=\mathscr{U}(\widetilde{\mathscr{T}}(Q)+%
\mathscr{S}(V),\mathscr{S}(V))
\displaystyle\mathscr{U}^{(2)}(Q,V)
\displaystyle=\mathscr{U}(\widetilde{\mathscr{T}}(Q)+\mathscr{S}(V),\mathscr{S%
}(V))
\displaystyle=(\mathscr{T}(\widetilde{\mathscr{T}}(Q)+\mathscr{S}(V))-\mathscr%
{S}(V)+\mathscr{S}^{(2)}(V),\mathscr{S}^{(2)}(V))
\displaystyle=(\mathscr{T}(\widetilde{\mathscr{T}}(Q)+\mathscr{S}(V))-\mathscr%
{S}(V)+\mathscr{S}^{(2)}(V),\mathscr{S}^{(2)}(V))
\displaystyle=(\widetilde{\mathscr{T}}^{(2)}(Q)+\mathscr{S}^{(2)}(V),\mathscr{%
S}^{(2)}(V)).
\displaystyle=(\widetilde{\mathscr{T}}^{(2)}(Q)+\mathscr{S}^{(2)}(V),\mathscr{%
S}^{(2)}(V)).
\displaystyle\mathscr{U}^{(n)}(Q,V)=(\widetilde{\mathscr{T}}^{(n)}(Q)+\mathscr%
{S}^{(n)}(V),\mathscr{S}^{(n)}(V))
\displaystyle\mathscr{U}^{(n)}(Q,V)
\displaystyle=(\widetilde{\mathscr{T}}^{(n)}(Q)+\mathscr{S}^{(n)}(V),\mathscr{%
S}^{(n)}(V))
\displaystyle\rightarrow(A^{*}+V^{*},V^{*})\ \ as\ \ n\rightarrow+\infty.
\displaystyle\rightarrow(A^{*}+V^{*},V^{*})\ \ as\ \ n\rightarrow+\infty.
\tilde{\pi}(a|s)=\frac{\min\left\{\bar{\rho}\mu(a|s),\pi(a|s)\right\}}{\sum_{b%
\in\mathcal{A}}\min\left\{\bar{\rho}\mu(b|s),\pi(b|s)\right\}}.
\mathbb{E}_{\mu}[\rho_{t}(r_{t}+\gamma V_{t+1}-V_{t})|\mathscr{F}_{t}]=0,
\mathscr{U}(Q^{\tilde{\pi}},V^{\tilde{\pi}})=(Q^{\tilde{\pi}},V^{\tilde{\pi}})
(A^{*}+V^{*},V^{*})=(Q^{\tilde{\pi}},V^{\tilde{\pi}}).
\bar{A}=A-\mathbb{E}_{\pi}[A]
Q=\bar{A}+sg(V)
\mathscr{T}(Q)\overset{def}{=}\mathbb{E}_{\mu}[Q(s_{t},a_{t})+\sum_{k\geq 0}%
\gamma^{k}c_{[t+1:t+k-1]}\tilde{\rho}_{t,k}\delta^{DR}_{t+k}]
Q
\mathscr{T}(Q)
Q=A+sg(V)
V
Q
Q
V
A
V
V^{*}
\bar{A}=A-\mathbb{E}_{\pi}[A]
\mathbb{E}_{\pi}[\bar{A}]=0
A
\mathbb{E}_{\pi}[Q]=V^{*}
\widetilde{\mathscr{T}}(Q)\overset{def}{=}-\mathbb{E}_{\pi}[Q]+\mathscr{T}(Q).
\widetilde{\mathscr{T}}(Q)
Q_{t}=Q(s_{t},a_{t}),A_{t}=A(s_{t},a_{t}),V^{*}_{t}=V^{*}(s_{t}).
\tilde{\rho}_{t,0}=1
\mathscr{F}
\widetilde{\mathscr{T}}
\displaystyle\widetilde{\mathscr{T}}(Q)=\mathbb{E}_{\mu}[A_{t}+\sum_{k\geq 0}%
\gamma^{k}c_{[t+1:t+k-1]}\tilde{\rho}_{t,k}\delta^{DR}_{t+k}]
\displaystyle\widetilde{\mathscr{T}}(Q)
\displaystyle=\mathbb{E}_{\mu}[A_{t}+\sum_{k\geq 0}\gamma^{k}c_{[t+1:t+k-1]}%
\tilde{\rho}_{t,k}\delta^{DR}_{t+k}]
\displaystyle=\mathbb{E}_{\mu}[-V^{*}_{t}+\sum_{k\geq 0}\gamma^{k}c_{[t+1:t+k-%
1]}\tilde{\rho}_{t,k}r_{t+k}+\sum_{k\geq 0}\gamma^{k+1}c_{[t+1:t+k-1]}\Delta_{%
k}],
\displaystyle=\mathbb{E}_{\mu}[-V^{*}_{t}+\sum_{k\geq 0}\gamma^{k}c_{[t+1:t+k-%
1]}\tilde{\rho}_{t,k}r_{t+k}+\sum_{k\geq 0}\gamma^{k+1}c_{[t+1:t+k-1]}\Delta_{%
k}],
\Delta_{k}=\mathbb{E}_{\mu}\left[\tilde{\rho}_{t,k}V^{*}_{t+k+1}-c_{t+k}\tilde%
{\rho}_{t,k+1}Q_{t+k+1}|\mathscr{F}_{t+k}\right].
Q
\mathbb{E}_{\mu}[V_{t+k+1}^{*}|\mathscr{F}_{t+k}]=\mathbb{E}_{\mu}[\mathbb{E}_%
{\pi}[Q_{t+k+1}|\mathscr{F}_{t+k+1}]|\mathscr{F}_{t+k}],\\

\Delta_{k}=\mathbb{E}_{\mu}[(\tilde{\rho}_{t,k}\frac{\pi_{t+k+1}}{\mu_{t+k+1}}%
-c_{t+k}\tilde{\rho}_{t,k+1})Q_{t+k+1}|\mathscr{F}_{t+k}].
Q_{1}=A_{1}+sg(V^{*})
Q_{2}=A_{2}+sg(V^{*})
\mathbb{E}_{\mu}[(\tilde{\rho}_{t,k}\frac{\pi_{t+k+1}}{\mu_{t+k+1}}-c_{t+k}%
\tilde{\rho}_{t,k+1})|\mathscr{F}_{t+k}]\geq 0,
||\widetilde{\mathscr{T}}(Q_{1})-\widetilde{\mathscr{T}}(Q_{2})||\leq\mathcal{%
C}||Q_{1}-Q_{2}||,
\displaystyle\mathcal{C}=\mathbb{E}_{\mu}[\sum_{k\geq 0}\gamma^{k+1}c_{[t+1:t+%
k-1]}(\tilde{\rho}_{t,k}\frac{\pi_{t+k+1}}{\mu_{t+k+1}}-c_{t+k}\tilde{\rho}_{t%
,k+1})]
\displaystyle\mathcal{C}
\displaystyle=\mathbb{E}_{\mu}[\sum_{k\geq 0}\gamma^{k+1}c_{[t+1:t+k-1]}(%
\tilde{\rho}_{t,k}\frac{\pi_{t+k+1}}{\mu_{t+k+1}}-c_{t+k}\tilde{\rho}_{t,k+1})]
\displaystyle=\mathbb{E}_{\mu}[1-1+\sum_{k\geq 0}\gamma^{k+1}c_{[t+1:t+k-1]}%
\left(\tilde{\rho}_{t,k}-c_{t+k}\tilde{\rho}_{t,k+1}\right)]
\displaystyle=\mathbb{E}_{\mu}[1-1+\sum_{k\geq 0}\gamma^{k+1}c_{[t+1:t+k-1]}%
\left(\tilde{\rho}_{t,k}-c_{t+k}\tilde{\rho}_{t,k+1}\right)]
\displaystyle=1-(1-\gamma)\mathbb{E}_{\mu}[\sum_{k\geq 0}\gamma^{k}c_{[t+1:t+k%
-1]}\tilde{\rho}_{t,k}]
\displaystyle=1-(1-\gamma)\mathbb{E}_{\mu}[\sum_{k\geq 0}\gamma^{k}c_{[t+1:t+k%
-1]}\tilde{\rho}_{t,k}]
\displaystyle\leq 1-(1-\gamma)<1.
\displaystyle\leq 1-(1-\gamma)<1.
\widetilde{\mathscr{T}}(Q)
A^{*}
\mathscr{T}(Q)
A^{*}+V^{*}
Q=A+sg(V)
\mathbb{E}_{\pi}[A]=0
\mathscr{S}(V)\overset{def}{=}\mathbb{E}_{\mu}[V(s_{t})+\sum_{k\geq 0}\gamma^{%
k}c_{[t:t+k-1]}\rho_{t,k}\delta^{DR}_{t+k}]
V
\mathscr{S}(V)
\Delta_{k}=\mathbb{E}_{\mu}\left[\left(\rho_{t+k}-c_{t+k}\rho_{t+k+1}\right)V_%
{t+k+1}-c_{t+k}\rho_{t+k+1}A^{*}_{t+k+1}|\mathscr{F}_{t+k}\right],
\Delta^{1}_{k}-\Delta^{2}_{k}=\mathbb{E}_{\mu}\left[\left(\rho_{t+k}-c_{t+k}%
\rho_{t+k+1}\right)\cdot(V^{1}_{t+k+1}-V^{2}_{t+k+1})|\mathscr{F}_{t+k}\right].
V
Q
\pi
\beta_{1}
\beta_{2}
\epsilon
n
n
(r,0,1)
\gamma
\epsilon
\lambda
\tau
Q_{t}^{\tilde{\pi}}=h(\sum_{i=0}^{n-1}\gamma^{i}r_{t+i}+\gamma^{n}h^{-1}(\text%
{Double}(Q_{t+n})))
h
h(x)=\text{sign}(x)\cdot(\sqrt{|x|+1}-1)+10^{-3}x
n
\epsilon
\epsilon\sim 0.4^{\text{uniform}(1,8)}
\alpha
\gamma
\tau
\log(|r|+1.0)\cdot(2\cdot 1_{\{r\geq 0\}}-1_{\{r<0\}})
\gamma
V
\alpha_{1}
Q
\alpha_{2}
\pi
\alpha_{3}
\tau
\bar{c}
\bar{\rho}
