(q,d^{+},d^{-})
\mathcal{D}^{+}
\mathcal{D}
q
\mathcal{L}=\sum_{q}\sum_{d^{+}\in\mathcal{D}^{+}}\sum_{d^{-}\in\mathcal{D}^{-%
}}l(s(\textbf{h}_{q},\textbf{h}_{d^{+}}),s(\textbf{h}_{q},\textbf{h}_{d^{-}}))
l(\cdot)
s(\cdot)
\textbf{h}_{q}
\textbf{h}_{d}
\mathcal{D}^{-}
\{(q,d^{+},\{d^{-}\}_{i=1}^{n})\}
(q,d^{+})
\{d^{-}\}_{i=1}^{n}
\mathcal{L}=-\log\frac{exp(s^{+})}{exp(s^{+})+\sum_{i=1}^{n}exp(s_{i}^{-})}
s^{+}
s(\textbf{h}_{q},\textbf{h}_{d^{+}})
s^{-}
s(\textbf{h}_{q},\textbf{h}_{d^{-}})
s^{+}
s_{j}^{-}
\displaystyle\frac{\partial\mathcal{L}}{\partial s^{+}}=-\frac{\sum_{i=1}^{n}%
exp(s_{i}^{-})}{exp(s^{+})+\sum_{i=1}^{n}exp(s_{i}^{-})},
\displaystyle\frac{\partial\mathcal{L}}{\partial s^{+}}
\displaystyle=-\frac{\sum_{i=1}^{n}exp(s_{i}^{-})}{exp(s^{+})+\sum_{i=1}^{n}%
exp(s_{i}^{-})},
\displaystyle\frac{\partial\mathcal{L}}{\partial s_{j}^{-}}=\frac{exp(s_{j}^{-%
})}{exp(s^{+})+\sum_{i=1}^{n}exp(s_{i}^{-})}
\displaystyle\frac{\partial\mathcal{L}}{\partial s_{j}^{-}}
\displaystyle=\frac{exp(s_{j}^{-})}{exp(s^{+})+\sum_{i=1}^{n}exp(s_{i}^{-})}
exp(s_{j}^{-})
K
s^{+}\approx s^{-}
s^{+}\approx s^{-}
s^{+}\approx s^{-}
(q,d^{+},d^{-})
\theta
\theta
\theta=|\arccos(\frac{s(\textbf{h}_{q},\textbf{h}_{d^{+}})}{||\textbf{h}_{q}||%
\cdot||\textbf{h}_{d^{+}}||})-\arccos(\frac{s(\textbf{h}_{q},\textbf{h}_{d^{-}%
})}{||\textbf{h}_{q}||\cdot||\textbf{h}_{d^{-}}||})
\theta=60^{\circ}
\mathcal{D}_{q}^{-}
q
s(\textbf{h}_{q},\textbf{h}_{d^{-}})
s(\textbf{h}_{d^{+}},\textbf{h}_{d^{-}})
d^{-}\in\textbf{TopK}_{s(q,\mathcal{D}^{-})}
s(\textbf{h}_{q},\textbf{h}_{d^{+}})\approx s(\textbf{h}_{q},\textbf{h}_{d^{-}})
s(\textbf{h}_{d^{+}},\textbf{h}_{d^{-}})\geq s(\textbf{h}_{q},\textbf{h}_{d^{-%
}})
s(\textbf{h}_{q},\textbf{h}_{d^{+}})\approx s(\textbf{h}_{q},\textbf{h}_{d^{-}})
p_{d^{-}}^{(q)}\propto exp(-\frac{1}{4}*(s^{-}-s^{+})^{2})
s^{-}
s^{+}
s(\textbf{h}_{q},\textbf{h}_{d^{-}})
s(\textbf{h}_{q},\textbf{h}_{d^{+}})
s^{+}\approx s^{-}
\textbf{TopK}_{s(q,\mathcal{D}^{-})}
\mathcal{\tilde{D}}_{q}^{-}
p_{d^{-}}\propto\text{ReLU}(s(\textbf{h}_{d^{+}},\textbf{h}_{d^{-}})-s(\textbf%
{h}_{q},\textbf{h}_{d^{-}}))
\mathcal{\tilde{D}}_{q}^{-}
\{(q,\mathcal{D}^{+})\}
\mathcal{D}
\mathcal{\hat{D}}_{q}^{-}
\mathcal{D}
\textbf{TopK}_{s(q,\mathcal{D}^{-})}
\mathcal{D}
\mathcal{\tilde{D}}_{q}^{-}
\textbf{TopK}_{s(q,\mathcal{D}^{-})}
p_{d^{-}}^{(q)}
\mathcal{\hat{D}}_{q}^{-}=\{d^{-}\}_{i=1}^{n}
p_{d^{-}}
\mathcal{\tilde{D}}_{q}^{-}
@10
@k
@20
@100
k
@10
@50
@10
@100
1:15
\mathcal{D}_{q}^{-}=\textbf{TopK}_{s(q,\mathcal{D}^{-})}
\mathcal{D}_{q}^{-}=\textbf{TopK}_{s(d^{+},\mathcal{D}^{-})}
\textbf{TopK}_{s(q,\mathcal{D}^{-})}
\textbf{TopK}_{s(d^{+},\mathcal{D}^{-})}
\textbf{TopK}_{s(q,\mathcal{D}^{-})}
\textbf{TopK}_{s(d^{+},\mathcal{D}^{-})}
k
k
\{1,5,11,15\}
\text{Cost}_{D}
\text{Cost}_{C}
t=2000
\text{Cost}_{C/t}=0.055s
