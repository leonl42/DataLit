\times
\times
m
v
1/M
M
1/N
N
\rm P_{os}
\times
\times
t
t-1
m
v
\theta_{0}
m_{0}\leftarrow 0
v_{0}\leftarrow 0
t\leftarrow 0
N\leftarrow\#\ of\ micro\-batches
\theta_{t}
t\leftarrow t+1
g_{t,i}\leftarrow\frac{1}{N}\nabla_{\theta}f_{t,i}(\theta_{t-1})
m_{t}=\beta_{1}m_{t-1}+(1-\beta_{1})\sum_{i=0}^{N-1}g_{t,i}
v_{t}=\beta_{2}v_{t-1}+(1-\beta_{2})[{\color[rgb]{0,0,1}(\sum_{i=0}^{N-1}g_{t,%
i})^{2}}v.s.{\color[rgb]{1,0,0}\sum_{i=0}^{N-1}(g_{t,i}^{2})}]
\hat{m_{t}}\leftarrow\frac{m_{t}}{1-\beta_{1}^{t}}
\hat{v_{t}}\leftarrow\frac{v_{t}}{1-\beta_{2}^{t}}
\theta_{t}\leftarrow\theta_{t-1}-\frac{\alpha\hat{m_{t}}}{\sqrt{\hat{v_{t}}}+\epsilon}
\theta_{0}
m_{0}\leftarrow 0
v_{0}\leftarrow 0
t\leftarrow 0
N\leftarrow\#\ of\ micro-batches
M\leftarrow\#\ of\ layers
\theta_{t}
t\leftarrow t+1
m_{t}\leftarrow\beta_{1}m_{t-1}
v_{t}\leftarrow\beta_{2}v_{t-1}
g_{t,i,j}\leftarrow\frac{1}{N}\nabla_{\theta}f_{t,i,j}(\theta_{t-1})
g_{t,i,j}
m_{t,j}\leftarrow m_{t,j}+(1-\beta_{1})g_{t,i,j}
v_{t,j}\leftarrow v_{t,j}+(1-\beta_{2}){\color[rgb]{1,0,0}{g_{t,i,j}^{2}}}
g_{t,i,j}
g_{t,i,j}
\hat{m_{t}}\leftarrow\frac{m_{t}}{1-\beta_{1}^{t}}
\hat{v_{t}}\leftarrow\frac{v_{t}}{1-\beta_{2}^{t}}
\theta_{t}\leftarrow\theta_{t-1}-\frac{\alpha\hat{m_{t}}}{\sqrt{\hat{v_{t}}}+\epsilon}
m_{t}
v_{t}
v_{t}
v_{t}
\frac{1}{N}
g_{t,i,j}
g_{t,i,j}
g_{t,i,j}^{2}
m_{t,j}
v_{t,j}
g_{t,i,j}
\frac{1}{M}
m_{t}
\frac{1}{\sqrt{v}}
f_{t}
\theta_{t}
R(T)=\sum_{t=1}^{T}[f_{t}(\theta_{t})-f_{t}(\theta^{*})]
f_{t}(\theta_{t})
f_{t}(\theta^{*})
O(\sqrt{T})
g_{1:T,i,\ b}\in\mathbb{R}^{t}
i^{th}
b^{th}
T
\alpha_{t}
t^{-\frac{1}{2}}
\beta_{1,t}
\lambda
g_{t}=\nabla f_{t}(\theta_{t})
g_{1:t}
\|g_{t}\|_{2}\leq G
\|g_{t}\|_{\infty}\leq G_{\infty}
\sum_{t=1}^{T}\sqrt{\frac{g^{2}_{t,i}}{t}}\leq 2G_{\infty}\|g_{1:T,i}\|_{2}
\gamma\triangleq\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}
\beta_{1},\beta_{2}\in[0,1)
\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}<1
g_{t}
\|g_{t}\|^{2}\leq G
\|g_{t}\|_{\infty}\leq G_{\infty}
N
\sum_{t=1}^{T}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}}}\leq\frac{2}{1-%
\gamma}\frac{1}{\sqrt{1-\beta_{2}}}\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|_{2}
\beta_{1},\beta_{2}\in[0,1)
\gamma=\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}<1
N
f_{t}
\|\nabla f_{t}(\theta)\|\leq G
\|\nabla f_{t}(\theta)\|_{\infty}\leq G_{\infty}
\theta\in R^{d}
m,n\in\{1,...,T\}
\theta_{t}
\|\theta_{n}-\theta_{m}\|_{2}\leq D
\|\theta_{n}-\theta_{m}\|_{\infty}\leq D_{\infty}
T\geq 1
R(T)\leq\frac{D^{2}}{2\alpha(1-\beta_{1})}\sum_{i=1}^{d}\sqrt{T\hat{v}_{T,i}}+%
\sum_{i=1}^{d}\frac{D^{2}_{\infty}G_{\infty}\sqrt{1-\beta_{2}}}{2\alpha(1-%
\beta_{1})(1-\lambda)^{2}}
+\frac{\alpha(\beta_{1}+1)G_{\infty}}{(1-\beta_{1})\sqrt{1-\beta_{2}}}\sum_{i=%
1}^{d}\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|_{2}
O(\frac{1}{\sqrt{T}})
f_{t}
\|\nabla f_{t}(\theta)\|\leq G
\|\nabla f_{t}(\theta)\|_{\infty}\leq G_{\infty}
\theta\in R^{d}
m,n\in\{1,...,T\}
\theta_{t}
\|\theta_{n}-\theta_{m}\|_{2}\leq D
\|\theta_{n}-\theta_{m}\|_{\infty}\leq D_{\infty}
\sum_{i=1}^{d}\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|\leq dG_{\infty}\sqrt{T}
\frac{R(T)}{T}=O(\frac{1}{\sqrt{T}})
m_{t}
v_{t}
m_{t}
v_{t}
g_{t,i}\leftarrow\frac{1}{N}\nabla_{\theta}f_{t,i}(\theta_{t-1})
v_{t-1}
M\beta_{2}
\beta_{2}
m_{t}=\beta_{1}m_{t-1}+(1-\beta_{1})\sum_{i=0}^{N-1}g_{t,i}=\beta_{1}m_{t-1}
+(1-\beta_{1})\sum_{i=0}^{N-1}\frac{\nabla_{\theta}f_{t,i}(\theta_{t-1})}{N}
v_{t}=M\beta_{2}v_{t-1}+(1-\beta_{2})\sum_{i=0}^{N-1}g_{t,i}^{2}=M\beta_{2}v_{%
t-1}
+(1-\beta_{2})\sum_{i=0}^{N-1}(\frac{\nabla_{\theta}f_{t,i}(\theta_{t-1})}{N})%
^{2}
m_{t}
m_{t}
v_{t}
M^{2}
v_{t}
m_{t}
v_{t}
m_{t}=\beta_{1}m_{t-1}+(1-\beta_{1})\sum_{i=0}^{NM-1}\frac{\nabla_{\theta}f_{t%
,i}(\theta_{t-1})}{NM}
v_{t}=\beta_{2}v_{t-1}+(1-\beta_{2})\sum_{i=0}^{NM-1}(\frac{\nabla_{\theta}f_{%
t,i}(\theta_{t-1})}{NM})^{2}
m_{t}
v_{t}
m_{t}
v_{t}
g_{t,i}\leftarrow\frac{1}{N}\nabla_{\theta}f_{t,i}(\theta_{t-1})
m_{t}
v_{t}
L=24,H=1024,A=16,340M
\frac{\sqrt{\hat{v_{t}}}}{\sqrt{\hat{v_{t}^{\prime}}}}
\frac{\sqrt{\hat{v_{t}}}}{\sqrt{\hat{v_{t}^{\prime}}}}
\theta_{t}\leftarrow\theta_{t-1}-\frac{\alpha\hat{m_{t}}}{\sqrt{\hat{v_{t}}}}
\sqrt{\hat{v_{t}}}/\sqrt{\hat{v_{t}}^{\prime}}
\sqrt{\hat{v_{t}}}/\sqrt{\hat{v_{t}}^{\prime}}
P_{os}
P_{os}
P_{os}
P_{os}
P_{os+g}
P_{os}
P_{os}
2\%
P_{os}
P_{os}
P_{os+g}
P_{os+g}
\times
\times
N
b
f:R_{d}\rightarrow R
x,y\in R^{d}
\lambda\in[0,1]
\lambda f(x)+(1-\lambda)f(y)\geq f(\lambda x+(1-\lambda)y)
f:R^{d}\rightarrow R
x,y\in R^{d}
f(y)\geq f(x)+\nabla f(x)^{T}(y-x)
g_{t}=\nabla f_{t}(\theta_{t})
g_{1:t}
\|g_{t}\|_{2}\leq G
\|g_{t}\|_{\infty}\leq G_{\infty}
\sum_{t=1}^{T}\sqrt{\frac{g^{2}_{t,i}}{t}}\leq 2G_{\infty}\|g_{1:T,i}\|_{2}
\gamma\triangleq\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}
\beta_{1},\beta_{2}\in[0,1)
\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}<1
g_{t}
\|g_{t}\|^{2}\leq G
\|g_{t}\|_{\infty}\leq G_{\infty}
N
\sum_{t=1}^{T}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}}}\leq\frac{2}{1-%
\gamma}\frac{1}{\sqrt{1-\beta_{2}}}{\color[rgb]{1,0,0}\sum_{b=1}^{N}\|g_{1:T,i%
,\ b}\|_{2}}
\displaystyle\sum_{t=1}^{T}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}}}=%
\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}}}+\frac{\sqrt{1-%
\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\frac{(\sum_{k=1}^{T}(1-\beta_{1})\beta_%
{1}^{T-k}g_{k,i})^{2}}{\sqrt{T\sum_{j=1}^{T}(1-\beta_{2})\beta_{2}^{T-j}g_{j,i%
}^{2}}}
\displaystyle\sum_{t=1}^{T}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}}}
\displaystyle=\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}}}+%
\frac{\sqrt{1-\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\frac{(\sum_{k=1}^{T}(1-%
\beta_{1})\beta_{1}^{T-k}g_{k,i})^{2}}{\sqrt{T\sum_{j=1}^{T}(1-\beta_{2})\beta%
_{2}^{T-j}g_{j,i}^{2}}}
\displaystyle\leq\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}%
}}+\frac{\sqrt{1-\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\sum_{k=1}^{T}\frac{((1%
-\beta_{1})\beta_{1}^{T-k}g_{k,i})^{2}}{\sqrt{T(1-\beta_{2})\beta_{2}^{T-k}g_{%
k,i}^{2}}}
\displaystyle\leq\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}%
}}+\frac{\sqrt{1-\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\sum_{k=1}^{T}\frac{((1%
-\beta_{1})\beta_{1}^{T-k}g_{k,i})^{2}}{\sqrt{T(1-\beta_{2})\beta_{2}^{T-k}g_{%
k,i}^{2}}}
\displaystyle\leq\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}%
}}+\frac{\sqrt{1-\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\frac{(1-\beta_{1})^{2}%
}{\sqrt{T(1-\beta_{2})}}\sum_{k=1}^{T}T(\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}%
)^{T-k}\|g_{k,i}\|_{2}
\displaystyle\leq\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}%
}}+\frac{\sqrt{1-\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\frac{(1-\beta_{1})^{2}%
}{\sqrt{T(1-\beta_{2})}}\sum_{k=1}^{T}T(\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}%
)^{T-k}\|g_{k,i}\|_{2}
\displaystyle=\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}}}+%
\frac{\sqrt{1-\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\frac{(1-\beta_{1})^{2}}{%
\sqrt{T(1-\beta_{2})}}\sum_{k=1}^{T}T(\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}})^%
{T-k}\|\sum_{b=1}^{N}g_{k,i,\ b}\|_{2}
\displaystyle=\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}}}+%
\frac{\sqrt{1-\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\frac{(1-\beta_{1})^{2}}{%
\sqrt{T(1-\beta_{2})}}\sum_{k=1}^{T}T(\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}})^%
{T-k}\|\sum_{b=1}^{N}g_{k,i,\ b}\|_{2}
\displaystyle\leq\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}%
}}+\frac{\sqrt{1-\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\frac{(1-\beta_{1})^{2}%
}{\sqrt{T(1-\beta_{2})}}\sum_{k=1}^{T}T(\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}%
)^{T-k}\sum_{b=1}^{N}\|g_{k,i,\ b}\|_{2}
\displaystyle\leq\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}%
}}+\frac{\sqrt{1-\beta_{2}^{T}}}{(1-\beta_{1}^{T})^{2}}\frac{(1-\beta_{1})^{2}%
}{\sqrt{T(1-\beta_{2})}}\sum_{k=1}^{T}T(\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}%
)^{T-k}\sum_{b=1}^{N}\|g_{k,i,\ b}\|_{2}
\displaystyle\leq\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}%
}}+\frac{T}{\sqrt{T(1-\beta_{2})}}\sum_{k=1}^{T}\gamma^{T-k}\sum_{b=1}^{N}\|g_%
{1:T,i,\ b}\|_{2}
\displaystyle\leq\sum_{t=1}^{T-1}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}%
}}+\frac{T}{\sqrt{T(1-\beta_{2})}}\sum_{k=1}^{T}\gamma^{T-k}\sum_{b=1}^{N}\|g_%
{1:T,i,\ b}\|_{2}
\displaystyle\leq\sum_{t=1}^{T}\frac{\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|_{2}}{%
\sqrt{t(1-\beta_{2})}}\sum_{j=0}^{T-t}t\gamma^{j}
\displaystyle\leq\sum_{t=1}^{T}\frac{\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|_{2}}{%
\sqrt{t(1-\beta_{2})}}\sum_{j=0}^{T-t}t\gamma^{j}
\displaystyle\leq\sum_{t=1}^{T}\frac{\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|_{2}}{%
\sqrt{t(1-\beta_{2})}}\sum_{j=0}^{T}t\gamma^{j}
\displaystyle\leq\sum_{t=1}^{T}\frac{\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|_{2}}{%
\sqrt{t(1-\beta_{2})}}\sum_{j=0}^{T}t\gamma^{j}
\sum_{t=1}^{T}\frac{\hat{m}^{2}_{t,i}}{\sqrt{t\hat{v}_{t,i}}}\leq\frac{2G_{%
\infty}}{(1-\gamma)^{2}\sqrt{(1-\beta_{2})}}\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|_{2}
\hfill\square
f_{t}
\|\nabla f_{t}(\theta)\|\leq G
\|\nabla f_{t}(\theta)\|_{\infty}\leq G_{\infty}
\theta\in R^{d}
\theta_{t}
\|\theta_{n}-\theta_{m}\|_{2}\leq D
\|\theta_{n}-\theta_{m}\|_{\infty}\leq D_{\infty}
m,n\in\{1,...,T\}
\beta_{1},\beta_{2}\in[0,1)
\frac{\beta_{1}^{2}}{\sqrt{\beta_{2}}}<1
N
\alpha_{t}=\frac{\alpha}{\sqrt{t}}
\beta_{1,t}=\beta_{1}\lambda^{t-1},\lambda\in(0,1)
T\geq 1
R(T)\leq\frac{D^{2}}{2\alpha(1-\beta_{1})}\sum_{i=1}^{d}\sqrt{T\hat{v}_{T,i}}+%
\frac{\alpha(\beta_{1}+1)G_{\infty}}{(1-\beta_{1})\sqrt{1-\beta_{2}}}{\color[%
rgb]{1,0,0}\sum_{i=1}^{d}\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|_{2}}+\sum_{i=1}^{d}%
\frac{D^{2}_{\infty}G_{\infty}\sqrt{1-\beta_{2}}}{2\alpha(1-\beta_{1})(1-%
\lambda)^{2}}
\sum_{i=1}^{d}\sum_{b=1}^{N}\|g_{1:T,i,\ b}\|_{2}
\sum_{i=1}^{d}\|g_{1:T,i}\|_{2}
\hfill\square
\frac{R(T)}{T}=O(\frac{1}{\sqrt{T}})
