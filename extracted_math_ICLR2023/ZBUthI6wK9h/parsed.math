k
k
k=2
d_{1},d_{2}
k
k
k=2
d_{1},d_{2}
G_{C}=(O,P)
o\in O
p\in P
p_{ij}
o_{i}
o_{j}
o_{j}
o_{i}
{\mathcal{D}}=\{d_{1},\dots,d_{m}\}
G_{C}
C_{d},\,d\in{\cal D}
d
D\coloneqq\bigcup_{k=1}^{m}C_{d_{k}}
G_{C}
\rho_{i}
o_{i}
\rho_{i}
o_{i}
\tau_{i}
\tau_{j}\geq\tau_{i}+\rho_{i},\quad\forall(i,j)\in P\cup D
o_{i}
\tau_{i}=\max_{k}\{\tau_{k}+\rho_{k}|(k,i)\in P\cup D\}
P\cup D
\tau_{i}=0
o_{i}\in O
(O,P\cup D)
T
x
T(x)\coloneqq\max_{i}(\tau_{i}+\rho_{i})-\min_{i}(\tau_{i})
s_{0}
s_{n}
s_{t}
a_{t}
s_{t+1}
t
o_{t}
\forall k:(k,t)\in P
o_{k}
s_{t}
(O,P\cup D)
x
T(x)
\{\rho_{i}\}_{i=1}^{n}
U(x){=}\sum_{i}{\rho_{i}}/T(x)
x
{\bm{s}}{=}(s_{0},s_{1},\dots,s_{n})
s_{t}
s_{0}
s_{n}
\mathcal{T}
\mathcal{T}_{x}
x
F:\mathcal{T}\rightarrow\mathbb{R}^{+}
P({\bm{s}})=F({\bm{s}})/Z
Z=\sum_{{\bm{s}}\in\mathcal{T}}F({\bm{s}})
R(x)=\sum_{{\bm{s}}\in\mathcal{T}_{x}}F({\bm{s}})
P(x)=\sum_{{\bm{s}}\in\mathcal{T}_{x}}F({\bm{s}})/Z
P(x)\propto R(x)
Z=\sum_{x}R(x)
P({\bm{s}})=\prod_{t=1}^{n}P_{F}(s_{t}|s_{t-1})
{\bm{s}}
s_{0}
P_{B}
P({\bm{s}}|s_{n}=x)=\prod_{t=1}^{n}P_{B}(s_{t-1}|s_{t})
F({\bm{s}})
{\bm{s}}\in{\cal T}_{x}
P_{F}
P_{B}
Z\prod_{t=1}^{n}P_{F}(s_{t}|s_{t-1})=R(x)\prod_{t=1}^{n}P_{B}(s_{t-1}|s_{t})
Z
P_{F}
P_{B}
\log{Z}
G_{C}
P_{F}
\log{Z}
\log{Z}
\log{Z}
{\bm{s}}
P_{F}
P_{B}
{\bm{\theta}}
\zeta({\bm{s}};{\bm{\theta}})=\log{R(x)}+\sum_{t=1}^{n}\log{P_{B}(s_{t-1}|s_{t%
};{\bm{\theta}})}-\sum_{t=1}^{n}\log{P_{F}(s_{t}|s_{t-1};{\bm{\theta}})}
\zeta({\bm{s}};{\bm{\theta}})
\log{Z}
G_{C}
\zeta({\bm{s}};{\bm{\theta}})
{\bm{s}}
\mathcal{L}_{\text{V}}({\bm{s}};{\bm{\theta}})=\left(\zeta({\bm{s}};{\bm{%
\theta}})-\mathbb{E}_{\bm{s}}\left[\zeta({\bm{s}};{\bm{\theta}})\right]\right)%
^{2}
\mathbb{E}_{\bm{s}}\left[\zeta({\bm{s}})\right]
P_{F}
P_{B}
Z
Z
G_{C}
\log{R(x;m,\sigma)}=(U(x)-m)/\sigma
U(x)
x
m
\sigma\in{\mathbb{R}^{+}}
R(x;m,\sigma)
P_{F}
P_{B}
\sigma
{R(x;m,\sigma)}
\sigma
\{R_{i}\}_{i=1}^{\infty}
x
R_{i}(x)\rightarrow R(x)
i\rightarrow\infty
F^{R}
R
\{F^{R_{i}}\}_{i=1}^{\infty}
F^{R_{i}}({\bm{s}})\rightarrow F^{R}({\bm{s}})
{\bm{s}}\in\mathcal{T}
[\log{\sigma_{min}},\log{\sigma_{max}}]
\sigma_{min}
\mathcal{U}(\sigma_{min},\sigma_{max})
\sigma
e_{\sigma}
\texttt{lin}(h,e_{\sigma})=\texttt{lin}_{\mathrm{scale}}(e_{\sigma})\odot%
\texttt{lin}(h)+\texttt{lin}_{\mathrm{shift}}(e_{\sigma})\,
\texttt{lin}_{\mathrm{scale}}
\texttt{lin}_{\mathrm{shift}}
\odot
\sigma=0.005
\sigma=0.25
U(x)
d_{\text{inv}}
d_{\text{sen}}
\times 2
d_{\text{inv}}
d_{\text{sen}}
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\sigma=0.005
d_{\text{inv}}
d_{\text{sen}}
\log Z
d_{\text{inv}}
d_{\text{sen}}
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
F^{R}
F:\mathcal{T}\rightarrow\mathbb{R}_{\geq 0}
R
F^{R}:\mathcal{T}\rightarrow\mathbb{R}_{\geq 0}
x
R(x)=\sum_{{\bm{s}}\in\mathcal{T}_{x}}F^{R}({\bm{s}})
\sum_{{\bm{s}}\in\mathcal{T}_{x}}F^{R}({\bm{s}})\eqqcolon F^{R}(x)
x
\{R_{i}\}_{i=1}^{\infty}
x
R_{i}(x)\rightarrow R(x)
i\rightarrow\infty
F^{R}
R
\{F^{R_{i}}\}_{i=1}^{\infty}
F^{R_{i}}({\bm{s}})\rightarrow F^{R}({\bm{s}})
{\bm{s}}\in\mathcal{T}
\{x_{i}\}_{i=1}^{M}
F^{R_{i}}({\bm{s}}=(s_{0},\dots,x))\coloneqq\begin{cases}F^{R}({\bm{s}})\frac{%
R_{i}(x)}{R(x)}&\quad\text{if }R(x)>0,\\
\frac{R_{i}(x)}{|\mathcal{T}_{x}|}&\quad\text{else.}\\
\end{cases}
F^{R_{i}}
R_{i}
F^{R_{i}}\geq 0
x
R(x)>0
\displaystyle\begin{split}F^{R_{i}}(x)&=\sum_{{\bm{s}}\in\mathcal{T}_{x}}F^{R_%
{i}}({\bm{s}})=\frac{R_{i}(x)}{R(x)}\sum_{{\bm{s}}\in\mathcal{T}_{x}}F^{R}({%
\bm{s}})\\
&=\frac{R_{i}(x)}{R(x)}R(x)=R_{i}(x).\end{split}
\displaystyle\begin{split}F^{R_{i}}(x)&=\sum_{{\bm{s}}\in\mathcal{T}_{x}}F^{R_%
{i}}({\bm{s}})=\frac{R_{i}(x)}{R(x)}\sum_{{\bm{s}}\in\mathcal{T}_{x}}F^{R}({%
\bm{s}})\\
&=\frac{R_{i}(x)}{R(x)}R(x)=R_{i}(x).\end{split}
F^{R_{i}}(x)=R_{i}(x)
R(x)=0
{\bm{s}}\in\mathcal{T}
x
R(x)>0
F^{R_{i}}({\bm{s}})=\frac{R_{i}(x)}{R(x)}F^{R}({\bm{s}})\rightarrow F^{R}({\bm%
{s}}).
R(x)=0
F^{R}({\bm{s}})=0
F^{R_{i}}({\bm{s}})=\frac{R_{i}(x)}{|\mathcal{T}_{x}|}\rightarrow\frac{R(x)}{|%
\mathcal{T}_{x}|}=0,
F^{R_{i}}
F^{R}
\blacksquare
\log{R_{\sigma_{i}}}\coloneqq\log{R(x;m,\sigma_{i})}=(U(x)-m)/\sigma_{i}
\sigma_{i}\searrow\sigma_{0}
\epsilon>0
F^{R_{\sigma_{0}}}
(\sigma_{0},\sigma_{0}+\delta)
F^{R_{\sigma}}
F^{R_{\sigma}}({\bm{s}})-F^{R_{\sigma_{0}}}({\bm{s}})<\epsilon
{\bm{s}}\in\mathcal{T}
F^{R_{\sigma_{i}}}({\bm{s}})
F^{R_{\sigma_{0}}}({\bm{s}})
{\bm{s}}\in\mathcal{T}
i
0
\log Z
\begin{split}\mathcal{L}_{\mathrm{TB}}({\bm{s}};{\bm{\theta}})=&\>\frac{1}{2}%
\biggl{(}\log Z(G_{C};{\bm{\theta}}_{Z})+\sum_{t=1}^{n}\log P_{F}(s_{t}|s_{t-1%
};{\bm{\theta}}_{P})\\
&-\log R(x)-\sum_{t=1}^{n}\log P_{B}(s_{t-1}|s_{t};{\bm{\theta}}_{P})\biggr{)}%
^{2}\end{split}
G_{C}
{\bm{\theta}}_{P}
{\bm{\theta}}_{Z}
\begin{split}\mathcal{L}_{\mathrm{TB}}({\bm{s}};{\bm{\theta}})=&\>\frac{1}{2}%
\biggl{(}\underbrace{\sum_{t=1}^{n}\log P_{F}(s_{t}|s_{t-1};{\bm{\theta}}_{P})%
}_{\varphi_{\mathrm{F}}}\\
&-\biggl{(}\underbrace{\log R(x)+\sum_{t=1}^{n}\log P_{B}(s_{t-1}|s_{t};{\bm{%
\theta}}_{P})-\log Z(G_{C};{\bm{\theta}}_{Z})}_{\varphi_{\mathrm{RBZ}}}\biggr{%
)}\biggr{)}^{2}\end{split}
\varphi_{\mathrm{F}}
{\bm{s}}
\varphi_{\mathrm{RBZ}}
{\bm{s}}
{\bm{\theta}}
\log Z^{*}(G_{C})
\varphi_{\mathrm{RBZ}^{*}}=\log R(x)+\sum_{t=1}^{n}\log P_{B}(s_{t-1}|s_{t})-%
\log Z^{*}(G_{C})
\varphi_{\mathrm{RBZ}^{*}}
\mathcal{L}^{*}_{\mathrm{TB}}({\bm{s}};{\bm{\theta}})
\mathcal{L}^{*}_{\mathrm{TB}}({\bm{s}};{\bm{\theta}})
P_{F}
{\bm{s}}
\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}^{*}}>0\,.
\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}^{*}}
\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}^{*}}<\log Z^{*}(G_{C})-\log Z(G_{C}%
;{\bm{\theta}}_{Z})
\displaystyle\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}^{*}}
\displaystyle\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}^{*}}
\displaystyle<\log Z^{*}(G_{C})-\log Z(G_{C};{\bm{\theta}}_{Z})
\displaystyle<\log Z^{*}(G_{C})-\log Z(G_{C};{\bm{\theta}}_{Z})
\displaystyle\Rightarrow\varphi_{\mathrm{F}}
\displaystyle\Rightarrow
\displaystyle\varphi_{\mathrm{F}}
\displaystyle<\log Z^{*}(G_{C})-\log Z(G_{C};{\bm{\theta}}_{Z})+\varphi_{%
\mathrm{RBZ}^{*}}
\displaystyle<\log Z^{*}(G_{C})-\log Z(G_{C};{\bm{\theta}}_{Z})+\varphi_{%
\mathrm{RBZ}^{*}}
\displaystyle\Rightarrow\varphi_{\mathrm{F}}
\displaystyle\Rightarrow
\displaystyle\varphi_{\mathrm{F}}
\displaystyle<\varphi_{\mathrm{RBZ}}
\displaystyle<\varphi_{\mathrm{RBZ}}
\displaystyle\Rightarrow\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}}
\displaystyle\Rightarrow
\displaystyle\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}}
\displaystyle<0
\displaystyle<0
-\nabla_{{\bm{\theta}}_{P}}\mathcal{L}_{\mathrm{TB}}({\bm{s}};{\bm{\theta}})
\mathcal{L}^{*}_{\mathrm{TB}}({\bm{s}};{\bm{\theta}})
\displaystyle\>\langle-\nabla_{{\bm{\theta}}_{P}}\mathcal{L}_{\mathrm{TB}}({%
\bm{s}};{\bm{\theta}}),\nabla_{{\bm{\theta}}_{P}}\mathcal{L}^{*}_{\mathrm{TB}}%
({\bm{s}};{\bm{\theta}})\rangle
\displaystyle\>\langle-\nabla_{{\bm{\theta}}_{P}}\mathcal{L}_{\mathrm{TB}}({%
\bm{s}};{\bm{\theta}}),\nabla_{{\bm{\theta}}_{P}}\mathcal{L}^{*}_{\mathrm{TB}}%
({\bm{s}};{\bm{\theta}})\rangle
\displaystyle=\>\langle-(\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}})\nabla_{{%
\bm{\theta}}_{P}}\varphi_{\mathrm{F}},(\varphi_{\mathrm{F}}-\varphi_{\mathrm{%
RBZ}^{*}})\nabla_{{\bm{\theta}}_{P}}\varphi_{\mathrm{F}}\rangle
\displaystyle=
\displaystyle\>\langle-(\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}})\nabla_{{%
\bm{\theta}}_{P}}\varphi_{\mathrm{F}},(\varphi_{\mathrm{F}}-\varphi_{\mathrm{%
RBZ}^{*}})\nabla_{{\bm{\theta}}_{P}}\varphi_{\mathrm{F}}\rangle
\displaystyle>\>0
\displaystyle>
\displaystyle\>0
\varphi_{\mathrm{F}}-\varphi_{\mathrm{RBZ}^{*}}<0
\log Z(G_{C};{\bm{\theta}}_{Z})
\log Z(G_{C};{\bm{\theta}}_{Z})
b
P_{F}
P_{F}
L
l
1\leq l\leq L
\displaystyle\hat{h}^{(l)}=h^{(l-1)}+\texttt{MHA}_{\text{Topoformer}}(\texttt{%
LayerNorm}(h^{(l-1)}))
\displaystyle\hat{h}^{(l)}
\displaystyle=h^{(l-1)}+\texttt{MHA}_{\text{Topoformer}}(\texttt{LayerNorm}(h^%
{(l-1)}))
\displaystyle h^{(l)}=\hat{h}^{(l)}+\texttt{MLP}(\texttt{LayerNorm}(\hat{h}^{(%
l)}))
\displaystyle h^{(l)}
\displaystyle=\hat{h}^{(l)}+\texttt{MLP}(\texttt{LayerNorm}(\hat{h}^{(l)}))
\texttt{MHA}_{\text{Topoformer}}
h^{(0)}
\displaystyle\texttt{MLP}(\hat{h}^{(l)})=\texttt{lin}_{2}(\texttt{ReLU}(%
\texttt{lin}_{1}(\hat{h}^{(l)})))
\displaystyle\texttt{MLP}(\hat{h}^{(l)})=\texttt{lin}_{2}(\texttt{ReLU}(%
\texttt{lin}_{1}(\hat{h}^{(l)})))
\sigma
\texttt{lin}_{1}(\hat{h}^{(l)})
\texttt{lin}_{1}(\hat{h}^{(l)},e_{\sigma})
\displaystyle e_{\sigma}=\texttt{ReLU}(\texttt{lin}_{b}(\texttt{ReLU}(\texttt{%
lin}_{a}(\sigma))))
\displaystyle e_{\sigma}
\displaystyle=\texttt{ReLU}(\texttt{lin}_{b}(\texttt{ReLU}(\texttt{lin}_{a}(%
\sigma))))
\displaystyle\texttt{lin}_{1}(\hat{h}^{(l)},e_{\sigma})=\texttt{lin}_{\mathrm{%
scale}}(e_{\sigma})\odot\texttt{lin}_{1}(\hat{h}^{(l)})+\texttt{lin}_{\mathrm{%
shift}}(e_{\sigma})
\displaystyle\texttt{lin}_{1}(\hat{h}^{(l)},e_{\sigma})
\displaystyle=\texttt{lin}_{\mathrm{scale}}(e_{\sigma})\odot\texttt{lin}_{1}(%
\hat{h}^{(l)})+\texttt{lin}_{\mathrm{shift}}(e_{\sigma})
e_{\sigma}
l
-1
0
1
0
1
0
1
0
d_{\text{inv}}
d_{\text{sen}}
f(m)=am+b
m
a
b
a
b
\mathcal{U}(0,1)
3
1.5
3
0.01
0.03
0.01
1
0.01
