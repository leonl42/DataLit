r=100
a_{1}
T=0.01
r=100
a_{2}
r=10
100
0.01*100
r=100
T=0.01
r=100
T=0.01
\beta
t=0
s_{0}
s_{t}
0\leq t\leq H
a_{t}
r_{t}
t<H
s_{t+1}
\tau:=(s_{t},a_{t},r_{t})_{t=0}^{H}
\tau_{i:j}:=(s_{t},a_{t},r_{t})_{t=i}^{j}
\tau_{0:-1}
\tau
R(\tau):=\sum_{t=0}^{H}r_{t}
\mathcal{M}
\mathcal{M}
\mathcal{R}
\mathcal{T}
s_{0}
r_{t}\sim\mathcal{R}(\tau_{0:t-1},s_{t},a_{t})
s_{t+1}\sim\mathcal{T}(\tau_{0:t-1},s_{t},a_{t})
\mathcal{D}
\tau
\pi
\pi
a_{t}
\tau_{0:t-1}
s_{t}
z
\pi
\mathcal{L}_{\mathrm{RCSL}}(\pi):=\mathbb{E}_{\tau\sim\mathcal{D}}\left[\sum_{%
t=0}^{H}-\log\pi(a_{t}|\tau_{0:t-1},s_{t},z(\tau))\right],
z(\tau)
R(\tau)
\pi
z
z
t=0
z
t
t
z
\pi_{z}
\pi
z
V_{\mathcal{M}}(\pi_{z})
\pi_{z}
\mathcal{M}
V_{\mathcal{M}}(\pi_{z}):=\mathbb{E}_{\tau\sim\mathrm{Pr}[\cdot|\pi_{z},%
\mathcal{M}]}\left[R(\tau)\right].
\pi_{z}
z
z\approx V_{\mathcal{M}}(\pi_{z})
\pi
z
V_{\mathcal{M}}(\pi_{z})\neq z
q(z|\tau)
q
p(z|s_{0})
\displaystyle\mathcal{L}_{\mathrm{VAE}}(\pi,q,p):=\mathbb{E}_{\tau\sim\mathcal%
{D},z\sim q(z|\tau)}\left[\sum_{t=0}^{H}-\log\pi(a_{t}|\tau_{0:t-1},s_{t},z)%
\right]+\beta\cdot\mathbb{E}_{\tau\sim\mathcal{D}}\left[D_{\mathrm{KL}}(q(z|%
\tau)\|p(z|s_{0}))\right].
\displaystyle\mathcal{L}_{\mathrm{VAE}}(\pi,q,p):=\mathbb{E}_{\tau\sim\mathcal%
{D},z\sim q(z|\tau)}\left[\sum_{t=0}^{H}-\log\pi(a_{t}|\tau_{0:t-1},s_{t},z)%
\right]+\beta\cdot\mathbb{E}_{\tau\sim\mathcal{D}}\left[D_{\mathrm{KL}}(q(z|%
\tau)\|p(z|s_{0}))\right].
\beta
\beta\geq 1
z
\beta<1
z
\beta
\beta<1
z(\tau)
R(\tau)
q(z|\tau)
z
z
r_{t},s_{t+1}
\tau_{0:t-1},s_{t},a_{t}
z
r_{t},s_{t+1}
\displaystyle\mathcal{L}_{\mathrm{DoC}}(\pi,q):=~{}\mathbb{E}_{\tau\sim%
\mathcal{D},z\sim q(z|\tau)}\left[\sum_{t=0}^{H}-\log\pi(a_{t}|\tau_{0:t-1},s_%
{t},z)\right]
\displaystyle\mathcal{L}_{\mathrm{DoC}}(\pi,q):=
\displaystyle~{}\mathbb{E}_{\tau\sim\mathcal{D},z\sim q(z|\tau)}\left[\sum_{t=%
0}^{H}-\log\pi(a_{t}|\tau_{0:t-1},s_{t},z)\right]
\displaystyle\mathrm{s.t.}~{}~{}~{}\mathrm{MI}(r_{t};z~{}|~{}\tau_{0:t-1},s_{t%
},a_{t})=0,\mathrm{MI}(s_{t+1};z~{}|~{}\tau_{0:t-1},s_{t},a_{t})=0,
\displaystyle\mathrm{s.t.}~{}~{}~{}
\displaystyle\mathrm{MI}(r_{t};z~{}|~{}\tau_{0:t-1},s_{t},a_{t})=0,\mathrm{MI}%
(s_{t+1};z~{}|~{}\tau_{0:t-1},s_{t},a_{t})=0,
\displaystyle~{}\forall~{}\tau_{0:t-1},s_{t},a_{t}~{}\text{and}~{}0\leq t\leq H,
\displaystyle~{}\forall~{}\tau_{0:t-1},s_{t},a_{t}~{}\text{and}~{}0\leq t\leq H,
\mathrm{MI}(r_{t};z|\tau_{0:t-1},s_{t},a_{t})
r_{t}
z
\tau_{0:t-1},s_{t},a_{t}
r_{t},z
\mathcal{D},q
\mathrm{MI}(s_{t+1};z|\tau_{0:t-1},s_{t},a_{t})
q
r
z
s_{t+1}
z
\displaystyle\mathrm{MI}(r_{t};z|\tau_{0:t-1},s_{t},a_{t})
\displaystyle\mathrm{MI}(
\displaystyle r_{t};z|\tau_{0:t-1},s_{t},a_{t})
\displaystyle=~{}D_{\mathrm{KL}}\left(\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t},a%
_{t}]\|\mathrm{Pr}[r_{t}|\tau_{0:t-1},s_{t},a_{t}]\mathrm{Pr}[z|\tau_{0:t-1},s%
_{t},a_{t}]\right)
\displaystyle=
\displaystyle~{}D_{\mathrm{KL}}\left(\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t},a_%
{t}]\|\mathrm{Pr}[r_{t}|\tau_{0:t-1},s_{t},a_{t}]\mathrm{Pr}[z|\tau_{0:t-1},s_%
{t},a_{t}]\right)
\displaystyle=~{}\mathbb{E}_{\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t},a_{t}]}%
\left[\log\left(\frac{\mathrm{Pr}[r_{t}|z,\tau_{0:t-1},s_{t},a_{t}]}{\mathrm{%
Pr}[r_{t}|\tau_{0:t-1},s_{t},a_{t}]}\right)\right]
\displaystyle=
\displaystyle~{}\mathbb{E}_{\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t},a_{t}]}%
\left[\log\left(\frac{\mathrm{Pr}[r_{t}|z,\tau_{0:t-1},s_{t},a_{t}]}{\mathrm{%
Pr}[r_{t}|\tau_{0:t-1},s_{t},a_{t}]}\right)\right]
\displaystyle=~{}\mathbb{E}_{\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t},a_{t}]}%
\log\mathrm{Pr}[r_{t}|z,\tau_{0:t-1},s_{t},a_{t}]-\mathbb{E}_{\mathrm{Pr}[r_{t%
}|\tau_{0:t-1},s_{t},a_{t}]}\log\mathrm{Pr}[r_{t}|\tau_{0:t-1},s_{t},a_{t}].
\displaystyle=
\displaystyle~{}\mathbb{E}_{\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t},a_{t}]}\log%
\mathrm{Pr}[r_{t}|z,\tau_{0:t-1},s_{t},a_{t}]-\mathbb{E}_{\mathrm{Pr}[r_{t}|%
\tau_{0:t-1},s_{t},a_{t}]}\log\mathrm{Pr}[r_{t}|\tau_{0:t-1},s_{t},a_{t}].
z
\omega(r_{t}|\tau_{0:t-1},s_{t},a_{t})
f:\Omega\mapsto\mathbb{R}
\omega(r_{t}|z,\tau_{0:t-1},s_{t},a_{t})\propto\rho(r_{t})\exp{\{f(r_{t},z,%
\tau_{0:t-1},s_{t},a_{t})\}},
\rho
\rho
\omega
\displaystyle\max_{\omega}~{}\mathbb{E}_{\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t%
},a_{t}]}\left[\log\omega(r_{t}|\tau_{0:t-1},s_{t},a_{t})\right]
\displaystyle\max_{\omega}~{}\mathbb{E}_{\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t%
},a_{t}]}\left[\log\omega(r_{t}|\tau_{0:t-1},s_{t},a_{t})\right]
\displaystyle=\max_{f}\mathbb{E}_{\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t},a_{t}%
]}\left[f(r_{t},z,\tau_{0:t-1},s_{t},a_{t})-\log\mathbb{E}_{\rho(\tilde{r})}%
\left[\exp\{f(\tilde{r},z,\tau_{0:t-1},s_{t},a_{t})\}\right]\right].
\displaystyle=
\displaystyle\max_{f}\mathbb{E}_{\mathrm{Pr}[r_{t},z|\tau_{0:t-1},s_{t},a_{t}]%
}\left[f(r_{t},z,\tau_{0:t-1},s_{t},a_{t})-\log\mathbb{E}_{\rho(\tilde{r})}%
\left[\exp\{f(\tilde{r},z,\tau_{0:t-1},s_{t},a_{t})\}\right]\right].
\mathrm{MI}(s_{t+1};z|\tau_{0:t-1},s_{t},a_{t})
\pi
q(z|\tau)
\displaystyle\mathcal{L}_{\mathrm{DoC}}(\pi,q)=\max_{f}\mathbb{E}_{\tau\sim%
\mathcal{D},z\sim q(z|\tau)}\left[\sum_{t=0}^{H}-\log\pi(a_{t}|\tau_{0:t-1},s_%
{t},z)\right]
\displaystyle\mathcal{L}_{\mathrm{DoC}}(\pi,q)=\max_{f}\mathbb{E}_{\tau\sim%
\mathcal{D},z\sim q(z|\tau)}\left[\sum_{t=0}^{H}-\log\pi(a_{t}|\tau_{0:t-1},s_%
{t},z)\right]
\displaystyle+\beta\cdot\sum_{t=0}^{H}\mathbb{E}_{\tau\sim\mathcal{D},z\sim q(%
z|\tau)}\left[f(r_{t},s_{t+1},z,\tau_{0:t-1},s_{t},a_{t})-\log\mathbb{E}_{\rho%
(\tilde{r},\tilde{s}^{\prime})}\left[\exp\{f(\tilde{r},\tilde{s}^{\prime},z,%
\tau_{0:t-1},s_{t},a_{t})\}\right]\right].
\displaystyle+
\displaystyle\beta\cdot\sum_{t=0}^{H}\mathbb{E}_{\tau\sim\mathcal{D},z\sim q(z%
|\tau)}\left[f(r_{t},s_{t+1},z,\tau_{0:t-1},s_{t},a_{t})-\log\mathbb{E}_{\rho(%
\tilde{r},\tilde{s}^{\prime})}\left[\exp\{f(\tilde{r},\tilde{s}^{\prime},z,%
\tau_{0:t-1},s_{t},a_{t})\}\right]\right].
\pi(\cdot|\cdot,\cdot,\cdot)
p(\cdot)
V(\cdot)
s_{0}
K
z^{*};V^{*}
\rhd
k=1
K
z_{k}\sim p(z|s_{0})
\rhd
V(z_{k})>V^{*}
z^{*}=z_{k}
V^{*}=V
\rhd
\pi(\cdot|\cdot,\cdot,z^{*})
\rhd
z^{*}
z
z
z
z
z
p(z|s_{0})
z
V(z)
z
\mathcal{L}_{\text{aux}}(V,p)=\mathbb{E}_{\tau\sim\mathcal{D},z\sim q(z|\tau)}%
\bigg{[}\left(V(z)-R(\tau)\right)^{2}+D_{\mathrm{KL}}(\text{stopgrad}(q(z|\tau%
))\|p(z|s_{0}))\bigg{]}.
q(z|\tau)
p
q
q
\mathcal{L}_{\mathrm{DoC}}
\mathcal{L}_{\text{aux}}
V
\pi
\pi_{z}
\mathcal{M}
V(z)
\pi
V
z
z
V
\pi_{z}
V(z)=V_{\mathcal{M}}(\pi_{z})
\pi,V
\tau_{0:t-1},s_{t},a_{t}
\mathrm{Pr}[\tau_{0:t-1},s_{t},a_{t}|\mathcal{D}]>0
\mathrm{Pr}[\hat{r}_{t}=r_{t}|\tau_{0:t-1},s_{t},a_{t},\mathcal{D}]=\mathcal{R%
}(\hat{r}_{t}|\tau_{0:t-1},s_{t},a_{t})
\mathrm{Pr}[\hat{s}_{t+1}=s_{t+1}|\tau_{0:t-1},s_{t},a_{t},\mathcal{D}]=%
\mathcal{T}(\hat{s}_{t+1}|\tau_{0:t-1},s_{t},a_{t})
\hat{r}_{t},\hat{s}_{t+1}
\pi
V
q
V(z)=\mathbb{E}_{\tau\sim\mathrm{Pr}[\cdot|z,\mathcal{D}]}\left[R(\tau)\right]
\pi(\hat{a}|\tau_{0:t-1},s_{t},z)=\mathrm{Pr}\left[\hat{a}=a_{t}|\tau_{0:t-1},%
s_{t},z,\mathcal{D}\right]
\pi,V,q
q
\mathrm{MI}(r_{t};z|\tau_{0:t-1},s_{t},a_{t})=\mathrm{MI}(s_{t+1};z|\tau_{0:t-%
1},s_{t},a_{t})=0,
\tau_{0:t-1},s_{t},a_{t}
\mathrm{Pr}[\tau_{0:t-1},s_{t},a_{t}|\mathcal{D}]>0
V
\pi
z
\mathrm{Pr}[z|q,\mathcal{D}]>0
z
\tau
q
\mathcal{M}
\mathcal{R}(\tau_{0:t-1},s_{t},a_{t})=\mathcal{R}(\tilde{\tau}_{0:t-1},s_{t},a%
_{t})
\mathcal{T}(\tau_{0:t-1},s_{t},a_{t})=\mathcal{T}(\tilde{\tau}_{0:t-1},s_{t},a%
_{t})
\tau,\tilde{\tau},s_{t},a_{t}
\mathcal{R}(s_{t},a_{t}),\mathcal{T}(s_{t},a_{t})
\pi
V
q
V(z)=\mathbb{E}_{\tau\sim\mathrm{Pr}[\cdot|z,\mathcal{D}]}\left[R(\tau)\right]
\pi(\hat{a}|s_{t},z)=\mathrm{Pr}\left[\hat{a}=a_{t}|s_{t},z,\mathcal{D}\right]
\pi
\pi,V,q
q
\mathrm{MI}(r_{t};z|s_{t},a_{t})=\mathrm{MI}(s_{t+1};z|s_{t},a_{t})=0,
s_{t},a_{t}
\mathrm{Pr}[s_{t},a_{t}|\mathcal{D}]>0
V
\pi
z
\mathrm{Pr}[z|q,\mathcal{D}]>0
a_{1},a_{2}
\texttt{Bern}(1-p)
\texttt{Bern}(p)
a_{1}
\texttt{Bern}(1-p)
\pi_{D}(a_{1})=p
p
\pi_{\text{RCSL}}(a_{1}|r=1)=\pi_{\text{RCSL}}(a_{2}|r=1)=0.5
a_{1}
\texttt{Bern}(1-p)
p<0.5
a_{1}
\texttt{Bern}(1-p)
p<0.5
\pi_{D}(a_{1})=p
p
p
a_{1}
\texttt{Bern}(1-p)
p<0.5
\pi_{D}(a_{1})=p
p
p
r\sim\texttt{Bern}(1-p)
p
p\in\{0.1,...,0.5\}
r=1
p
p
p
0.5
p
0.5\cdot(1-p)
100
100
p=\frac{1}{3}
0.7
p
\epsilon
\epsilon=0.3
\epsilon=0.5
\epsilon=0.7
p
1-p
p
\epsilon
\epsilon=0.5
\epsilon=0.7
p
1-p
p
\epsilon
\epsilon=0.5
\epsilon=0.7
(1-e^{-0.01\cdot t})\cdot\sin(t)\cdot\sigma
t
\sigma\in[0,1]
\beta
\beta=1
\beta
\beta
z
DoC
q
\mathrm{MI}(r_{t};z|\tau_{0:t-1},s_{t},a_{t})=\mathrm{MI}(s_{t+1};z|\tau_{0:t-%
1},s_{t},a_{t})=0,
\tau_{0:t-1},s_{t},a_{t}
\mathrm{Pr}[\tau_{0:t-1},s_{t},a_{t}|\mathcal{D}]>0
\displaystyle\mathrm{Pr}\left[\hat{r}=r_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,%
\mathcal{D}\right]=\mathcal{R}(\hat{r}_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t}),
\displaystyle\mathrm{Pr}\left[\hat{r}=r_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,%
\mathcal{D}\right]
\displaystyle=\mathcal{R}(\hat{r}_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t}),
\displaystyle\mathrm{Pr}\left[\hat{s}_{t+1}=s_{t+1}~{}|~{}\tau_{0:t-1},s_{t},a%
_{t},z,\mathcal{D}\right]=\mathcal{T}(\hat{s}_{t+1}~{}|~{}\tau_{0:t-1},s_{t},a%
_{t}),
\displaystyle\mathrm{Pr}\left[\hat{s}_{t+1}=s_{t+1}~{}|~{}\tau_{0:t-1},s_{t},a%
_{t},z,\mathcal{D}\right]
\displaystyle=\mathcal{T}(\hat{s}_{t+1}~{}|~{}\tau_{0:t-1},s_{t},a_{t}),
\tau_{0:t-1},s_{t},a_{t},z
\hat{r},\hat{s}_{t+1}
\mathrm{Pr}[\tau_{0:t-1},s_{t},a_{t},z|\mathcal{D}]>0
\mathrm{MI}(r_{t};z|\tau_{0:t-1},s_{t},a_{t})=\mathbb{E}_{(r_{t},z)\sim\mathrm%
{Pr}[\cdot|\tau_{0:t-1},s_{t},a_{t},\mathcal{D}]}\left[\log\frac{\mathrm{Pr}%
\left[r_{t}|\tau_{0:t-1},s_{t},a_{t},z,\mathcal{D}\right]}{\mathrm{Pr}\left[r_%
{t}|\tau_{0:t-1},s_{t},a_{t},\mathcal{D}\right]}\right]
=\mathbb{E}_{z\sim\mathrm{Pr}[\cdot|\tau_{0:t-1},s_{t},a_{t},\mathcal{D}]}%
\left[D_{\mathrm{KL}}(\mathrm{Pr}[r|\tau_{0:t-1},s_{t},a_{t},z,\mathcal{D}]\|%
\mathrm{Pr}[r|\tau_{0:t-1},s_{t},a_{t},\mathcal{D}])\right].
\mathrm{MI}(r_{t};z|\tau_{0:t-1},s_{t},a_{t})=0
\mathrm{Pr}\left[r|\tau_{0:t-1},s_{t},a_{t},z,\mathcal{D}\right]=\mathrm{Pr}[r%
|\tau_{0:t-1},s_{t},a_{t},\mathcal{D}],
\tau_{0:t-1},s_{t},a_{t},z
\mathrm{Pr}[z|\tau_{0:t-1},s_{t},a_{t},\mathcal{D}]>0
\mathrm{Pr}[r|\tau_{0:t-1},s_{t},a_{t},\mathcal{D}]=\mathcal{R}(r|\tau_{0:t-1}%
,s_{t},a_{t}),
\pi,q
q
\mathrm{MI}(r_{t};z|\tau_{0:t-1},s_{t},a_{t})=\mathrm{MI}(s_{t+1};z|\tau_{0:t-%
1},s_{t},a_{t})=0,
\tau_{0:t-1},s_{t},a_{t}
\mathrm{Pr}[\tau_{0:t-1},s_{t},a_{t}|\mathcal{D}]>0
\mathrm{Pr}\left[\tau~{}|~{}z,\mathcal{D}\right]=\mathrm{Pr}\left[\tau~{}|~{}%
\pi_{z},\mathcal{M}\right],
\tau
z
\mathrm{Pr}[z|q,\mathcal{D}]>0
\mathrm{Pr}\left[\tau~{}|~{}z,\mathcal{D}\right]
\mathrm{Pr}\left[\tau~{}|~{}z,\mathcal{D}\right]=\prod_{t=0}^{H}\mathrm{Pr}%
\left[a_{t}~{}|~{}\tau_{0:t-1},s_{t},z,\mathcal{D}\right]\\
\cdot\prod_{t=0}^{H}\mathrm{Pr}\left[r_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,%
\mathcal{D}\right]\\
\cdot\prod_{t=0}^{H-1}\mathrm{Pr}\left[s_{t+1}~{}|~{}\tau_{0:t-1},s_{t},a_{t},%
z,\mathcal{D}\right].
\tau
\mathrm{Pr}\left[\tau~{}|~{}z,\mathcal{D}\right]>0
\tau
\mathrm{Pr}\left[a_{t}~{}|~{}\tau_{0:t-1},s_{t},z,\mathcal{D}\right]=\pi_{z}(a%
_{t}|\tau_{0:t-1},s_{t}).
\displaystyle\mathrm{Pr}\left[r_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,\mathcal{%
D}\right]=\mathcal{R}(r_{t}|\tau_{0:t-1},s_{t},a_{t})
\displaystyle\mathrm{Pr}\left[r_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,\mathcal{%
D}\right]
\displaystyle=\mathcal{R}(r_{t}|\tau_{0:t-1},s_{t},a_{t})
\displaystyle\mathrm{Pr}\left[s_{t+1}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,%
\mathcal{D}\right]=\mathcal{T}(s_{t+1}|\tau_{0:t-1},s_{t},a_{t}).
\displaystyle\mathrm{Pr}\left[s_{t+1}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,%
\mathcal{D}\right]
\displaystyle=\mathcal{T}(s_{t+1}|\tau_{0:t-1},s_{t},a_{t}).
\tau
\mathrm{Pr}\left[\tau~{}|~{}z,\mathcal{D}\right]>0
\displaystyle\mathrm{Pr}\left[\tau~{}|~{}z,\mathcal{D}\right]=\prod_{t=0}^{H}%
\pi_{z}(a_{t}|\tau_{0:t-1},s_{t})\cdot\prod_{t=0}^{H}\mathcal{R}(r_{t}|\tau_{0%
:t-1},s_{t},a_{t})\cdot\prod_{t=0}^{H-1}\mathcal{T}(s_{t+1}|\tau_{0:t-1},s_{t}%
,a_{t})
\displaystyle\mathrm{Pr}\left[\tau~{}|~{}z,\mathcal{D}\right]
\displaystyle=\prod_{t=0}^{H}\pi_{z}(a_{t}|\tau_{0:t-1},s_{t})\cdot\prod_{t=0}%
^{H}\mathcal{R}(r_{t}|\tau_{0:t-1},s_{t},a_{t})\cdot\prod_{t=0}^{H-1}\mathcal{%
T}(s_{t+1}|\tau_{0:t-1},s_{t},a_{t})
\displaystyle=\mathrm{Pr}\left[\tau~{}|~{}\pi_{z},\mathcal{M}\right].
\displaystyle=\mathrm{Pr}\left[\tau~{}|~{}\pi_{z},\mathcal{M}\right].
\mathrm{Pr}\left[\tau~{}|~{}z,\mathcal{D}\right]=0
\mathrm{Pr}\left[\tau_{0:t}~{}|~{}z,\mathcal{D}\right]=0
\mathrm{Pr}\left[\tau_{0:t}~{}|~{}\pi_{z},\mathcal{M}\right]=0
t
t=-1
t>-1
\mathrm{Pr}\left[\tau_{0:t}~{}|~{}z,\mathcal{D}\right]=\mathrm{Pr}\left[\tau_{%
0:t-1}~{}|~{}z,\mathcal{D}\right]\cdot\mathrm{Pr}\left[s_{t}~{}|~{}\tau_{0:t-2%
},s_{t-1},a_{t-1},z,\mathcal{D}\right]\cdot\mathrm{Pr}\left[a_{t}~{}|~{}\tau_{%
0:t-1},s_{t},z,\mathcal{D}\right]\cdot\\
\mathrm{Pr}\left[r_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,\mathcal{D}\right],
\mathrm{Pr}\left[\tau_{0:t}~{}|~{}\pi_{z},\mathcal{M}\right]=\mathrm{Pr}\left[%
\tau_{0:t-1}~{}|~{}\pi_{z},\mathcal{M}\right]\cdot\mathcal{T}(s_{t}|\tau_{0:t-%
2},s_{t-1},a_{t-1})\cdot\pi_{z}(a_{t}|\tau_{0:t-1},s_{t})\cdot\\
\mathcal{R}(r_{t}|\tau_{0:t-1},s_{t},a_{t}).
\mathrm{Pr}\left[\tau_{0:t}~{}|~{}z,\mathcal{D}\right]=0
\mathrm{Pr}\left[\tau_{0:t}~{}|~{}\pi_{z},\mathcal{M}\right]>0
\mathrm{Pr}\left[\tau_{0:t-1}~{}|~{}z,\mathcal{D}\right]>0
\mathrm{Pr}\left[s_{t}~{}|~{}\tau_{0:t-2},s_{t-1},a_{t-1},z,\mathcal{D}\right]%
=\mathcal{T}(s_{t}|\tau_{0:t-2},s_{t-1},a_{t-1}),
\mathcal{T}(s_{t}|\tau_{0:t-2},s_{t-1},a_{t-1})>0
\mathrm{Pr}\left[s_{t}~{}|~{}\tau_{0:t-2},s_{t-1},a_{t-1},z,\mathcal{D}\right]>0
\mathrm{Pr}\left[a_{t}~{}|~{}\tau_{0:t-1},s_{t},z,\mathcal{D}\right]=\pi_{z}(a%
_{t}|\tau_{0:t-1},s_{t}),
\pi_{z}(a_{t}|\tau_{0:t-1},s_{t})>0
\mathrm{Pr}\left[a_{t}~{}|~{}\tau_{0:t-1},s_{t},z,\mathcal{D}\right]>0
\mathrm{Pr}\left[r_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,\mathcal{D}\right]=%
\mathcal{R}(r_{t}|\tau_{0:t-1},s_{t},a_{t}),
\mathcal{R}(r_{t}|\tau_{0:t-1},s_{t},a_{t})>0
\mathrm{Pr}\left[r_{t}~{}|~{}\tau_{0:t-1},s_{t},a_{t},z,\mathcal{D}\right]>0
\mathrm{Pr}\left[\tau_{0:t}~{}|~{}z,\mathcal{D}\right]>0
V(z)
\displaystyle V(z)=\int\mathrm{Pr}\left[\hat{\tau}=\tau~{}|~{}z,\mathcal{D}%
\right]\cdot R(\hat{\tau})~{}d\hat{\tau}.
\displaystyle V(z)
\displaystyle=\int\mathrm{Pr}\left[\hat{\tau}=\tau~{}|~{}z,\mathcal{D}\right]%
\cdot R(\hat{\tau})~{}d\hat{\tau}.
\displaystyle V(z)=\int\mathrm{Pr}\left[\hat{\tau}=\tau~{}|~{}z,\mathcal{D}%
\right]\cdot R(\hat{\tau})~{}d\hat{\tau}
\displaystyle V(z)
\displaystyle=\int\mathrm{Pr}\left[\hat{\tau}=\tau~{}|~{}z,\mathcal{D}\right]%
\cdot R(\hat{\tau})~{}d\hat{\tau}
\displaystyle=\int\mathrm{Pr}\left[\hat{\tau}=\tau~{}|~{}\pi_{z},\mathcal{M}%
\right]\cdot R(\hat{\tau})~{}d\hat{\tau}
\displaystyle=\int\mathrm{Pr}\left[\hat{\tau}=\tau~{}|~{}\pi_{z},\mathcal{M}%
\right]\cdot R(\hat{\tau})~{}d\hat{\tau}
\displaystyle=V_{\mathcal{M}}(\pi_{z}),
\displaystyle=V_{\mathcal{M}}(\pi_{z}),
\pi,V,q
q
\mathrm{MI}(r_{t};z|\tau_{0:t-1},s_{t},a_{t})=\mathrm{MI}(s_{t+1};z|\tau_{0:t-%
1},s_{t},a_{t})=0,
\tau_{0:t-1},s_{t},a_{t}
\mathrm{Pr}[\tau_{0:t-1},s_{t},a_{t}|\mathcal{D}]>0
V
\pi
z
\mathrm{Pr}[z|q,\mathcal{D}]>0
\pi_{z}^{\mathrm{hist}}(\hat{a}~{}|~{}\tau_{0:t-1},s_{t})=\mathrm{Pr}\left[%
\hat{a}=a_{t}~{}|~{}\tau_{0:t-1},s_{t},z,\mathcal{D}\right].
\mathrm{Pr}\left[\tau~{}|~{}z,\mathcal{D}\right]=\mathrm{Pr}\left[\tau~{}|~{}%
\pi_{z}^{\mathrm{hist}},\mathcal{M}\right],
\tau
V(z)=V_{\mathcal{M}}(\pi_{z}^{\mathrm{hist}}),
z
\mathrm{Pr}[z~{}|~{}q,\mathcal{D}]>0
V_{\mathcal{M}}(\pi_{z}^{\mathrm{hist}})=V_{\mathcal{M}}(\pi_{z})
\tilde{\pi}_{z}
\mathrm{Pr}\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}\pi_{z}^{\mathrm{hist}},%
\mathcal{M}\right]=\mathrm{Pr}\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}\tilde{%
\pi}_{z},\mathcal{M}\right],
t,\hat{s},\hat{a}
V_{\mathcal{M}}(\pi_{z}^{\mathrm{hist}})=V_{\mathcal{M}}(\tilde{\pi}_{z}).
\tilde{\pi}_{z}=\pi_{z}
\mathrm{Pr}\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}\pi_{z}^{\mathrm{hist}},%
\mathcal{M}\right]=\mathrm{Pr}\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}z,%
\mathcal{D}\right].
t,\hat{s},\hat{a}
\displaystyle\tilde{\pi}_{z}(\hat{a}=a_{t}|\hat{s}=s_{t})=\frac{\mathrm{Pr}%
\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}\tilde{\pi}_{z},\mathcal{M}\right]}{%
\mathrm{Pr}\left[\hat{s}=s_{t}~{}|\tilde{\pi}_{z},\mathcal{M}\right]}
\displaystyle\tilde{\pi}_{z}(\hat{a}=a_{t}|\hat{s}=s_{t})
\displaystyle=\frac{\mathrm{Pr}\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}\tilde{%
\pi}_{z},\mathcal{M}\right]}{\mathrm{Pr}\left[\hat{s}=s_{t}~{}|\tilde{\pi}_{z}%
,\mathcal{M}\right]}
\displaystyle=\frac{\mathrm{Pr}\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}\pi^{%
\mathrm{hist}}_{z},\mathcal{M}\right]}{\mathrm{Pr}\left[\hat{s}=s_{t}~{}|~{}%
\pi^{\mathrm{hist}}_{z},\mathcal{M}\right]}
\displaystyle=\frac{\mathrm{Pr}\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}\pi^{%
\mathrm{hist}}_{z},\mathcal{M}\right]}{\mathrm{Pr}\left[\hat{s}=s_{t}~{}|~{}%
\pi^{\mathrm{hist}}_{z},\mathcal{M}\right]}
\displaystyle=\frac{\mathrm{Pr}\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}z,%
\mathcal{D}\right]}{\mathrm{Pr}\left[\hat{s}=s_{t}~{}|~{}z,\mathcal{D}\right]}
\displaystyle=\frac{\mathrm{Pr}\left[\hat{s}=s_{t},\hat{a}=a_{t}~{}|~{}z,%
\mathcal{D}\right]}{\mathrm{Pr}\left[\hat{s}=s_{t}~{}|~{}z,\mathcal{D}\right]}
\displaystyle=\pi_{z}(\hat{a}=a_{t}|\hat{s}=s_{t}),
\displaystyle=\pi_{z}(\hat{a}=a_{t}|\hat{s}=s_{t}),
\pi_{z}
DoC
q
\mathrm{MI}(r_{t};z|s_{t},a_{t})=\mathrm{MI}(s_{t+1};z|s_{t},a_{t})=0,
s_{t},a_{t}
\mathrm{Pr}[s_{t},a_{t}|\mathcal{D}]>0
\displaystyle\mathrm{Pr}\left[\hat{r}=r_{t}~{}|~{}s_{t},a_{t},z,\mathcal{D}%
\right]=\mathcal{R}(\hat{r}_{t}~{}|~{}s_{t},a_{t}),
\displaystyle\mathrm{Pr}\left[\hat{r}=r_{t}~{}|~{}s_{t},a_{t},z,\mathcal{D}\right]
\displaystyle=\mathcal{R}(\hat{r}_{t}~{}|~{}s_{t},a_{t}),
\displaystyle\mathrm{Pr}\left[\hat{s}_{t+1}=s_{t+1}~{}|~{}s_{t},a_{t},z,%
\mathcal{D}\right]=\mathcal{T}(\hat{s}_{t+1}~{}|~{}s_{t},a_{t}),
\displaystyle\mathrm{Pr}\left[\hat{s}_{t+1}=s_{t+1}~{}|~{}s_{t},a_{t},z,%
\mathcal{D}\right]
\displaystyle=\mathcal{T}(\hat{s}_{t+1}~{}|~{}s_{t},a_{t}),
s_{t},a_{t},z
\hat{r},\hat{s}_{t+1}
\mathrm{Pr}[s_{t},a_{t},z|\mathcal{D}]>0
\tau
\mathcal{D}
\mathcal{M}^{\dagger}
\mathcal{M}^{\dagger}
\mathcal{M}
(a,r,s^{\prime})
a
\mathcal{M}
r
s^{\prime}
\mathcal{M}
\mathcal{M}^{\dagger}
(a,r,s^{\prime})
r
s^{\prime}
\tau=(s_{t},a_{t},r_{t})_{t=0}^{H}
\mathcal{M}
\tau^{\dagger}=(s_{t},(a_{t},r_{t},s_{t+1}),r_{t})_{t=0}^{H}
\mathcal{M}^{\dagger}
\mathcal{D}^{\dagger}
\pi^{\dagger}
\pi^{\dagger}((\hat{a},\hat{r},\hat{s}^{\prime})|s_{t},z)=\mathrm{Pr}[(\hat{a}%
,\hat{r},\hat{s}^{\prime})=(a_{t},r_{t},s_{t+1})|s_{t},z,\mathcal{D}^{\dagger}]
V(z)=V_{\mathcal{M}^{\dagger}}(\pi^{\dagger}_{z}).
V_{\mathcal{M}^{\dagger}}(\pi^{\dagger}_{z})=V_{\mathcal{M}}(\pi_{z})
\tau^{\dagger}\sim\mathrm{Pr}[\cdot|\pi_{z}^{\dagger},\mathcal{M}^{\dagger}]
(s_{t},(a_{t},r_{t},s_{t+1}),r_{t},s_{t+1}),
\pi_{z}^{\dagger}
\mathrm{Pr}[\hat{a}=a_{t}|s_{t},\pi^{\dagger}_{z}]=\mathrm{Pr}[\hat{a}=a_{t}|s%
_{t},z,\mathcal{D}^{\dagger}]=\pi_{z}(\hat{a}|s_{t}).
\pi_{z}^{\dagger}
\displaystyle\mathrm{Pr}[\hat{r}=r_{t}|s_{t},a_{t},\pi^{\dagger}_{z}]=\mathrm{%
Pr}[\hat{r}=r_{t}|s_{t},a_{t},z,\mathcal{D}^{\dagger}]=\mathcal{R}(\hat{r}|s_{%
t},a_{t}),
\displaystyle\mathrm{Pr}[\hat{r}=r_{t}|s_{t},a_{t},\pi^{\dagger}_{z}]
\displaystyle=\mathrm{Pr}[\hat{r}=r_{t}|s_{t},a_{t},z,\mathcal{D}^{\dagger}]=%
\mathcal{R}(\hat{r}|s_{t},a_{t}),
\displaystyle\mathrm{Pr}[\hat{s}_{t+1}=s_{t+1}|s_{t},a_{t},\pi^{\dagger}_{z}]=%
\mathrm{Pr}[\hat{s}_{t+1}=s_{t+1}|s_{t},a_{t},z,\mathcal{D}^{\dagger}]=%
\mathcal{T}(\hat{s}_{t+1}|s_{t},a_{t}).
\displaystyle\mathrm{Pr}[\hat{s}_{t+1}=s_{t+1}|s_{t},a_{t},\pi^{\dagger}_{z}]
\displaystyle=\mathrm{Pr}[\hat{s}_{t+1}=s_{t+1}|s_{t},a_{t},z,\mathcal{D}^{%
\dagger}]=\mathcal{T}(\hat{s}_{t+1}|s_{t},a_{t}).
\tau^{\dagger}=(s_{t},(a_{t},r_{t},s_{t+1}),r_{t})_{t=0}^{H}
\pi^{\dagger}_{z},\mathcal{M}^{\dagger}
\tau=(s_{t},a_{t},r_{t})_{t=0}^{H}
\mathcal{M}
\mathrm{Pr}[\tau^{\dagger}|\pi^{\dagger}_{z},\mathcal{M}^{\dagger}]=\mathrm{Pr%
}[\tau|\pi_{z},\mathcal{M}]
R(\tau^{\dagger})=R(\tau)
V_{\mathcal{M}^{\dagger}}(\pi^{\dagger}_{z})=V_{\mathcal{M}}(\pi_{z}),
\mathcal{M}
\mathcal{D},q
\mathrm{Pr}[\hat{s}_{t+1}=s_{t}~{}|~{}s_{t},a_{t},z,\mathcal{D}]=\mathrm{Pr}[%
\hat{s}_{t+1}=s_{t}~{}|~{}s_{t},a_{t},\mathcal{D}],
s_{t},a_{t},z,\hat{s}_{t+1}
\mathrm{Pr}[s_{t},a_{t},z|q,\mathcal{D}]>0
\pi
\pi(\hat{a}|s_{t},z)=\mathrm{Pr}[\hat{a}=a_{t}|s_{t},z,\mathcal{D}].
z
\mathrm{Pr}[z|q,\mathcal{D}]>0
\tau
\mathrm{Pr}[\tau~{}|~{}\pi_{z},\mathcal{M}]>0~{}~{}\mathrm{if~{}and~{}only~{}%
if}~{}~{}\mathrm{Pr}[\tau~{}|~{}z,\mathcal{D}]>0.
a_{0}\in\{0,1\}
a_{1}\in\{0,1\}
a_{0},a_{1}
\displaystyle\tau_{0}=\langle a_{0}=0,a_{1}=0\rangle,
\displaystyle\tau_{0}
\displaystyle=\langle a_{0}=0,a_{1}=0\rangle,
\displaystyle\tau_{1}=\langle a_{0}=1,a_{1}=1\rangle,
\displaystyle\tau_{1}
\displaystyle=\langle a_{0}=1,a_{1}=1\rangle,
\displaystyle\tau_{2}=\langle a_{0}=0,a_{1}=1\rangle,
\displaystyle\tau_{2}
\displaystyle=\langle a_{0}=0,a_{1}=1\rangle,
\displaystyle\tau_{3}=\langle a_{0}=1,a_{1}=0\rangle.
\displaystyle\tau_{3}
\displaystyle=\langle a_{0}=1,a_{1}=0\rangle.
q
z
\displaystyle z_{0}=q(\tau_{0})=q(\tau_{1}),
\displaystyle z_{0}
\displaystyle=q(\tau_{0})=q(\tau_{1}),
\displaystyle z_{1}=q(\tau_{2})=q(\tau_{3}).
\displaystyle z_{1}
\displaystyle=q(\tau_{2})=q(\tau_{3}).
\mathcal{D}
\tau_{0},\tau_{1},\tau_{2},\tau_{3}
\pi
z_{0}
\displaystyle\pi(\cdot|s_{0},z_{0})=[0.5,0.5],
\displaystyle\pi(\cdot|s_{0},z_{0})
\displaystyle=[0.5,0.5],
\displaystyle\pi(\cdot|s_{1},z_{0})=[0.5,0.5].
\displaystyle\pi(\cdot|s_{1},z_{0})
\displaystyle=[0.5,0.5].
\pi(\cdot|\cdot,z_{0})
\tau_{2},\tau_{3}
\tau_{2},\tau_{3}
z_{0}
\mathcal{D}
\mathcal{D}=\{\tau^{(m)}\}_{m=1}^{M}
\tau^{(m)}=(s_{t}^{(m)},a_{t}^{(m)},r_{t}^{(m)})_{t=0}^{H}
\{s_{0}^{(m)}\}_{m=1}^{M}
\{R^{(m)}\}_{m=1}^{M}
q_{\phi}(\cdot)
\pi_{\theta_{1}}(\cdot,\cdot)
V_{\theta_{2}}(\cdot)
p_{\psi}(\cdot)
f_{w}(\cdot)
\rho(r,s^{\prime})
\eta
B
\{(\tau=(s_{t},a_{t},r_{t})_{t=0}^{H})^{(m)}\}_{m=1}^{B}
\mathcal{D}
m=1,\dots,B
z
q_{\phi}(\tau)
\mathcal{L}_{\mathrm{DoC}}+\mathcal{L}_{aux}
\phi\leftarrow\phi-\eta\nabla_{\phi}\hat{\mathcal{L}}
\psi\leftarrow\psi-\eta\nabla_{\psi}\text{stopgrad}(\hat{\mathcal{L}},\phi)
w\leftarrow w+\eta\nabla_{w}\hat{\mathcal{L}}
\theta_{1}\leftarrow\theta_{1}-\eta\nabla_{\theta_{1}}\hat{\mathcal{L}}
\theta_{2}\leftarrow\theta_{2}-\eta\nabla_{\theta_{1}}\hat{\mathcal{L}}
\pi_{\theta_{1}}(\cdot,\cdot),V_{\theta_{2}}(\cdot),p_{\psi}(\cdot)
3
1
128
128
64
K
20
5
K_{f}
K
1
6000
3600
5000
50
1
0.1
10^{-4}
0.25
10^{-4}
10^{5}
\beta
1.0
0.1,1.0,10
p=\frac{1}{3}
p
\epsilon
(1-e^{-0.01\cdot t})\cdot\sin(t)\cdot\sigma
t
\sigma\in[0,1]
p
\epsilon
p
\epsilon
