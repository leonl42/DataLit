\mathtt{hankook.lee@lgresearch.ai,\{jongheonj,jinwoos\}@kaist.ac.kr,sejun.park%
000@gmail.com}
p_{\text{data}}(\mathbf{x})
p_{\theta}(\mathbf{x})\propto\exp(-E_{\theta}(\mathbf{x}))
(f_{\theta},g_{\theta})
p_{\text{data}}(\mathbf{x},\mathbf{z})
h_{\phi}
h_{\phi}
\tilde{\mathbf{z}}\sim p_{\theta}(\tilde{\mathbf{z}})
\mathbf{z}_{i}=h_{\phi}(t_{i}(\mathbf{x}))/\lVert h_{\phi}(t_{i}(\mathbf{x}))%
\rVert_{2}
t_{i}\sim\mathcal{T}
\mathtt{sg}(\cdot)
(f_{\theta},g_{\theta})
p_{\text{data}}(\mathbf{x},\mathbf{z})
h_{\phi}
h_{\phi}
\tilde{\mathbf{z}}\sim p_{\theta}(\tilde{\mathbf{z}})
\mathbf{z}_{i}=h_{\phi}(t_{i}(\mathbf{x}))/\lVert h_{\phi}(t_{i}(\mathbf{x}))%
\rVert_{2}
t_{i}\sim\mathcal{T}
\mathtt{sg}(\cdot)
p_{\text{data}}(\mathbf{z}|\mathbf{x})
h_{\phi}
\mathbf{z}:=h_{\phi}(\mathbf{x})
\mathbf{x}
\mathbf{z}\sim p_{\text{data}}(\cdot|\mathbf{x})
\lVert\mathbf{z}\rVert_{2}=1
p_{\theta}(\mathbf{x},\mathbf{z})
p_{\text{data}}(\mathbf{x},\mathbf{z})
f:=f_{\theta}(\mathbf{x})
\lVert f\rVert_{2}
f/\lVert f\rVert_{2}
p_{\theta}(\mathbf{x})
p_{\theta}(\mathbf{z}|\mathbf{x})
p_{\theta}(\mathbf{x})
p_{\theta}(\mathbf{z}|\mathbf{x})
\tilde{\mathbf{z}}\sim p_{\theta}(\mathbf{z})
\rightarrow
p_{\theta}(\mathbf{x}|\mathbf{z})
\{\mathbf{x}^{(i)}\}_{i=1}^{N}
p_{\text{data}}(\mathbf{x})
p_{\theta}(\mathbf{x})
\theta
p_{\text{data}}(\mathbf{x})
p_{\theta}(\mathbf{x})
\mathbb{R}^{d_{\mathbf{x}}}
\mathbf{x}\in\mathbb{R}^{d_{\mathbf{x}}}
\displaystyle p_{\theta}(\mathbf{x})=\frac{\exp(-E_{\theta}(\mathbf{x}))}{Z_{%
\theta}},\quad\quad Z_{\theta}=\int_{\mathbb{R}^{d_{\mathbf{x}}}}\exp(-E_{%
\theta}(\mathbf{x}))d\mathbf{x},
\displaystyle p_{\theta}(\mathbf{x})=\frac{\exp(-E_{\theta}(\mathbf{x}))}{Z_{%
\theta}},\quad\quad Z_{\theta}=\int_{\mathbb{R}^{d_{\mathbf{x}}}}\exp(-E_{%
\theta}(\mathbf{x}))d\mathbf{x},
E_{\theta}(\mathbf{x})
\theta
Z_{\theta}
\theta
p_{\theta}
p_{\text{data}}
\theta
p_{\text{data}}
p_{\theta}
\displaystyle D_{\text{KL}}(p_{\text{data}}\|p_{\theta})=-\mathbb{E}_{\mathbf{%
x}\sim p_{\text{data}}}[\log p_{\theta}(\mathbf{x})]+\text{Constant},
\displaystyle D_{\text{KL}}(p_{\text{data}}\|p_{\theta})
\displaystyle=-\mathbb{E}_{\mathbf{x}\sim p_{\text{data}}}[\log p_{\theta}(%
\mathbf{x})]+\text{Constant},
\displaystyle\nabla_{\theta}D_{\text{KL}}(p_{\text{data}}\|p_{\theta})=\mathbb%
{E}_{\mathbf{x}\sim p_{\text{data}}}[\nabla_{\theta}E_{\theta}(\mathbf{x})]-%
\mathbb{E}_{\tilde{\mathbf{x}}\sim p_{\theta}}[\nabla_{\theta}E_{\theta}(%
\tilde{\mathbf{x}})].
\displaystyle\nabla_{\theta}D_{\text{KL}}(p_{\text{data}}\|p_{\theta})
\displaystyle=\mathbb{E}_{\mathbf{x}\sim p_{\text{data}}}[\nabla_{\theta}E_{%
\theta}(\mathbf{x})]-\mathbb{E}_{\tilde{\mathbf{x}}\sim p_{\theta}}[\nabla_{%
\theta}E_{\theta}(\tilde{\mathbf{x}})].
(t+1)
\tilde{\mathbf{x}}^{(t)}
\tilde{\mathbf{x}}^{(t+1)}
\displaystyle\tilde{\mathbf{x}}^{(t+1)}\leftarrow\tilde{\mathbf{x}}^{(t)}+%
\frac{\varepsilon^{2}}{2}\underbrace{\nabla_{\mathbf{x}}\log p_{\theta}(\tilde%
{\mathbf{x}}^{(t)})}_{=-\nabla_{\mathbf{x}}E_{\theta}(\tilde{\mathbf{x}}^{(t)}%
)}+\varepsilon\bm{\delta}^{(t)},\quad\bm{\delta}^{(t)}\sim\mathcal{N}(0,I),
\displaystyle\tilde{\mathbf{x}}^{(t+1)}\leftarrow\tilde{\mathbf{x}}^{(t)}+%
\frac{\varepsilon^{2}}{2}\underbrace{\nabla_{\mathbf{x}}\log p_{\theta}(\tilde%
{\mathbf{x}}^{(t)})}_{=-\nabla_{\mathbf{x}}E_{\theta}(\tilde{\mathbf{x}}^{(t)}%
)}+\varepsilon\bm{\delta}^{(t)},\quad\bm{\delta}^{(t)}\sim\mathcal{N}(0,I),
\varepsilon>0
\tilde{\mathbf{x}}^{(0)}
\mathcal{N}
\tilde{\mathbf{x}}^{(T)}
p_{\theta}
\varepsilon
T
p_{\theta}(\mathbf{x},\mathbf{z})\propto\exp(-E_{\theta}(\mathbf{x},\mathbf{z}))
\mathbf{x}
\mathbf{z}
p_{\text{data}}(\mathbf{x})
p_{\theta}(\mathbf{x})
\displaystyle\nabla_{\theta}D_{\text{KL}}(p_{\text{data}}\|p_{\theta})=\mathbb%
{E}_{\mathbf{x}\sim p_{\text{data}}(\mathbf{x})}[\nabla_{\theta}E_{\theta}(%
\mathbf{x})]-\mathbb{E}_{\tilde{\mathbf{x}}\sim p_{\theta}(\tilde{\mathbf{x}})%
}[\nabla_{\theta}E_{\theta}(\tilde{\mathbf{x}})]
\displaystyle\nabla_{\theta}D_{\text{KL}}(p_{\text{data}}\|p_{\theta})
\displaystyle=\mathbb{E}_{\mathbf{x}\sim p_{\text{data}}(\mathbf{x})}[\nabla_{%
\theta}E_{\theta}(\mathbf{x})]-\mathbb{E}_{\tilde{\mathbf{x}}\sim p_{\theta}(%
\tilde{\mathbf{x}})}[\nabla_{\theta}E_{\theta}(\tilde{\mathbf{x}})]
\displaystyle=\mathbb{E}_{\mathbf{x}\sim p_{\text{data}}(\mathbf{x}),\mathbf{z%
}\sim p_{\theta}(\mathbf{z}|\mathbf{x})}[\nabla_{\theta}E_{\theta}(\mathbf{x},%
\mathbf{z})]-\mathbb{E}_{\tilde{\mathbf{x}}\sim p_{\theta}(\tilde{\mathbf{x}})%
,\mathbf{z}\sim p_{\theta}(\mathbf{z}|\tilde{\mathbf{x}})}[\nabla_{\theta}E_{%
\theta}(\tilde{\mathbf{x}},\mathbf{z})],
\displaystyle=\mathbb{E}_{\mathbf{x}\sim p_{\text{data}}(\mathbf{x}),\mathbf{z%
}\sim p_{\theta}(\mathbf{z}|\mathbf{x})}[\nabla_{\theta}E_{\theta}(\mathbf{x},%
\mathbf{z})]-\mathbb{E}_{\tilde{\mathbf{x}}\sim p_{\theta}(\tilde{\mathbf{x}})%
,\mathbf{z}\sim p_{\theta}(\mathbf{z}|\tilde{\mathbf{x}})}[\nabla_{\theta}E_{%
\theta}(\tilde{\mathbf{x}},\mathbf{z})],
E_{\theta}(\mathbf{x})
E_{\theta}(\mathbf{x})=-\log\int\exp(-E_{\theta}(\mathbf{x},\mathbf{z}))d%
\mathbf{z}
h_{\phi}:\mathbb{R}^{d_{\mathbf{x}}}\rightarrow\mathbb{R}^{d_{\mathbf{z}}}
\phi
(\mathbf{x},\mathbf{x}_{+})
(\mathbf{x},\mathbf{x}_{-})
\text{sim}(h_{\phi}(\mathbf{x}),h_{\phi}(\mathbf{x}_{+}))
\text{sim}(h_{\phi}(\mathbf{x}),h_{\phi}(\mathbf{x}_{-}))
\text{sim}(\cdot,\cdot)
\mathbb{R}^{d_{\mathbf{z}}}
\mathcal{B}=\{\mathbf{x}^{(i)}\}_{i=1}^{n}
\{\mathbf{v}_{j}^{(i)}:=t_{j}^{(i)}(\mathbf{x}^{(i)})\}_{j\in\{1,2\}}
\mathbf{x}^{(i)}
t_{j}^{(i)}\sim\mathcal{T}
(\mathbf{v}_{1}^{(i)},\mathbf{v}_{2}^{(i)})
(\mathbf{v}_{1}^{(i)},\mathbf{v}_{2}^{(k)})
k\neq i
\mathcal{L}_{\text{SimCLR}}
\displaystyle\mathcal{L}_{\text{SimCLR}}(\mathcal{B};\phi,\tau)=\frac{1}{2n}%
\sum_{i=1}^{n}\sum_{j=1,2}\mathcal{L}_{\text{NT-Xent}}\left(h_{\phi}(\mathbf{v%
}_{j}^{(i)}),h_{\phi}(\mathbf{v}_{3-j}^{(i)}),\{h_{\phi}(\mathbf{v}_{l}^{(k)})%
\}_{k\neq i,l\in\{1,2\}};\tau\right),
\displaystyle\mathcal{L}_{\text{SimCLR}}(\mathcal{B};\phi,\tau)=\frac{1}{2n}%
\sum_{i=1}^{n}\sum_{j=1,2}\mathcal{L}_{\text{NT-Xent}}\left(h_{\phi}(\mathbf{v%
}_{j}^{(i)}),h_{\phi}(\mathbf{v}_{3-j}^{(i)}),\{h_{\phi}(\mathbf{v}_{l}^{(k)})%
\}_{k\neq i,l\in\{1,2\}};\tau\right),
\displaystyle\mathcal{L}_{\text{NT-Xent}}(\mathbf{z},\mathbf{z}_{+},\{\mathbf{%
z}_{-}\};\tau)=-\log\frac{\exp(\text{sim}(\mathbf{z},\mathbf{z}_{+})/\tau)}{%
\exp(\text{sim}(\mathbf{z},\mathbf{z}_{+})/\tau)+\sum_{\mathbf{z}_{-}}\exp(%
\text{sim}(\mathbf{z},\mathbf{z}_{-})/\tau)},
\displaystyle\mathcal{L}_{\text{NT-Xent}}(\mathbf{z},\mathbf{z}_{+},\{\mathbf{%
z}_{-}\};\tau)=-\log\frac{\exp(\text{sim}(\mathbf{z},\mathbf{z}_{+})/\tau)}{%
\exp(\text{sim}(\mathbf{z},\mathbf{z}_{+})/\tau)+\sum_{\mathbf{z}_{-}}\exp(%
\text{sim}(\mathbf{z},\mathbf{z}_{-})/\tau)},
\text{sim}(\mathbf{u},\mathbf{v})=\mathbf{u}^{\top}\mathbf{v}/\lVert\mathbf{u}%
\rVert_{2}\lVert\mathbf{v}\rVert_{2}
\tau
\mathcal{L}_{\text{NT-Xent}}
p_{\theta}(\mathbf{x})\propto\exp(-E_{\theta}(\mathbf{x}))
p_{\text{data}}(\mathbf{x})
\mathbf{z}\sim p_{\text{data}}(\mathbf{z}|\mathbf{x})
\mathbf{x}
p_{\text{data}}(\mathbf{x},\mathbf{z})=p_{\text{data}}(\mathbf{x})p_{\text{%
data}}(\mathbf{z}|\mathbf{x})
p_{\theta}(\mathbf{x},\mathbf{z})
p_{\text{data}}(\mathbf{x},\mathbf{z})
p_{\text{data}}(\mathbf{x}|\mathbf{z})
p_{\text{data}}(\mathbf{x})
p_{\text{data}}(\mathbf{z}|\mathbf{x})
p_{\text{data}}(\mathbf{z}|\mathbf{x})
p_{\text{data}}(\mathbf{z}|\mathbf{x})
h_{\phi}:\mathbb{R}^{d_{\mathbf{x}}}\rightarrow\mathbb{R}^{d_{\mathbf{z}}}
\phi
\mathcal{L}_{\text{SimCLR}}
\mathcal{T}
h_{\phi}
\mathbf{z}\sim p_{\text{data}}(\mathbf{z}|\mathbf{x})
\displaystyle\mathbf{z}\sim p_{\text{data}}(\mathbf{z}|\mathbf{x})\quad%
\Leftrightarrow\quad\mathbf{z}=h_{\phi}(t(\mathbf{x}))/\lVert h_{\phi}(t(%
\mathbf{x}))\rVert_{2},t\sim\mathcal{T}.
\displaystyle\mathbf{z}\sim p_{\text{data}}(\mathbf{z}|\mathbf{x})\quad%
\Leftrightarrow\quad\mathbf{z}=h_{\phi}(t(\mathbf{x}))/\lVert h_{\phi}(t(%
\mathbf{x}))\rVert_{2},t\sim\mathcal{T}.
f_{\theta}:\mathbb{R}^{d_{\mathbf{x}}}\rightarrow\mathbb{R}^{d_{\mathbf{z}}}
\theta
p_{\theta}(\mathbf{x},\mathbf{z})
\mathbf{z}\sim p_{\text{data}}(\mathbf{z}|\mathbf{x})
f_{\theta}(\mathbf{x})/\lVert f_{\theta}(\mathbf{x})\rVert_{2}
p_{\theta}(\mathbf{z}|\mathbf{x})
\lVert f_{\theta}(\mathbf{x})\rVert_{2}
p_{\theta}(\mathbf{x})
p_{\theta}(\mathbf{x})
p_{\theta}(\mathbf{z}|\mathbf{x})
p_{\theta}(\mathbf{z}|\mathbf{x})
g_{\theta}:\mathbb{S}^{d_{\mathbf{z}}-1}\rightarrow\mathbb{S}^{d_{\mathbf{z}}-1}
f_{\theta}(\mathbf{x})/\lVert f_{\theta}(\mathbf{x})\rVert_{2}
\ell_{2}
f_{\theta}(\mathbf{x})/\lVert f_{\theta}(\mathbf{x})\rVert_{2}
p_{\text{data}}(\mathbf{z})
E_{\theta}(\mathbf{x},\mathbf{z})
\displaystyle E_{\theta}(\mathbf{x},\mathbf{z})=\frac{1}{2}\lVert f_{\theta}(%
\mathbf{x})\rVert_{2}^{2}-\beta g_{\theta}\left(\frac{f_{\theta}(\mathbf{x})}{%
\lVert f_{\theta}(\mathbf{x})\rVert_{2}}\right)^{\top}\mathbf{z},
\displaystyle E_{\theta}(\mathbf{x},\mathbf{z})
\displaystyle=\frac{1}{2}\lVert f_{\theta}(\mathbf{x})\rVert_{2}^{2}-\beta g_{%
\theta}\left(\frac{f_{\theta}(\mathbf{x})}{\lVert f_{\theta}(\mathbf{x})\rVert%
_{2}}\right)^{\top}\mathbf{z},
\displaystyle E_{\theta}(\mathbf{x})=-\log\int_{\mathbb{S}^{d-1}}\exp(-E_{%
\theta}(\mathbf{x},\mathbf{z}))d\mathbf{z}=\frac{1}{2}\lVert f_{\theta}(%
\mathbf{x})\rVert_{2}^{2}+\text{Constant},
\displaystyle E_{\theta}(\mathbf{x})
\displaystyle=-\log\int_{\mathbb{S}^{d-1}}\exp(-E_{\theta}(\mathbf{x},\mathbf{%
z}))d\mathbf{z}=\frac{1}{2}\lVert f_{\theta}(\mathbf{x})\rVert_{2}^{2}+\text{%
Constant},
\beta\geq 0
E_{\theta}(\mathbf{x})
\lVert f_{\theta}(\mathbf{x})\rVert_{2}
\int_{\mathbb{S}^{d-1}}\exp(\beta g_{\theta}\left({f_{\theta}(\mathbf{x})}/{%
\lVert f_{\theta}(\mathbf{x})\rVert_{2}}\right)^{\top}\mathbf{z})d\mathbf{z}
\mathbf{x}
p_{\text{data}}(\mathbf{x},\mathbf{z})
p_{\theta}(\mathbf{x},\mathbf{z})
h_{\phi}
p_{\theta}
\{\mathbf{x}^{(i)}\}_{i=1}^{n}
n
\{\tilde{\mathbf{x}}^{(i)}\}_{i=1}^{n}\sim p_{\theta}(\mathbf{x})
p_{\text{data}}
p_{\theta}
\mathbf{z}^{(i)}\sim p_{\text{data}}(\mathbf{z}|\mathbf{x}^{(i)})
\tilde{\mathbf{z}}^{(i)}\sim p_{\theta}(\mathbf{z}|\tilde{\mathbf{x}}^{(i)})
i
p_{\theta}(\mathbf{z}|\mathbf{x}^{(i)})
\tilde{\mathbf{z}}^{(i)}:=g_{\theta}(f_{\theta}(\mathbf{x})/\lVert f_{\theta}(%
\mathbf{x})\rVert_{2})
\mathcal{B}:=\{(\mathbf{x}^{(i)},\mathbf{z}^{(i)})\}_{i=1}^{n}
\tilde{\mathcal{B}}:=\{(\tilde{\mathbf{x}}^{(i)},\tilde{\mathbf{z}}^{(i)})\}_{%
i=1}^{n}
\mathcal{L}_{\text{EBM}}
\theta
\displaystyle\mathcal{L}_{\text{EBM}}(\mathcal{B},\tilde{\mathcal{B}};\theta,%
\alpha,\beta)=\frac{1}{n}\sum_{i=1}^{n}E_{\theta}(\mathbf{x}^{(i)},\mathbf{z}^%
{(i)})-E_{\theta}(\tilde{\mathbf{x}}^{(i)})+\alpha\cdot(E_{\theta}(\mathbf{x}^%
{(i)})^{2}+E_{\theta}(\tilde{\mathbf{x}}^{(i)})^{2}),
\displaystyle\mathcal{L}_{\text{EBM}}(\mathcal{B},\tilde{\mathcal{B}};\theta,%
\alpha,\beta)=\frac{1}{n}\sum_{i=1}^{n}E_{\theta}(\mathbf{x}^{(i)},\mathbf{z}^%
{(i)})-E_{\theta}(\tilde{\mathbf{x}}^{(i)})+\alpha\cdot(E_{\theta}(\mathbf{x}^%
{(i)})^{2}+E_{\theta}(\tilde{\mathbf{x}}^{(i)})^{2}),
D_{\text{KL}}(p_{\text{data}}\|p_{\theta})
\tilde{\mathbf{z}}
\mathbb{E}_{\tilde{\mathbf{z}}\sim p_{\theta}(\tilde{\mathbf{z}}|\tilde{%
\mathbf{x}})}[\nabla_{\theta}E_{\theta}(\tilde{\mathbf{x}},\tilde{\mathbf{z}})%
]=\nabla_{\theta}E_{\theta}(\tilde{\mathbf{x}})
\alpha
h_{\phi}
\mathcal{L}_{\text{SimCLR}}
\{\tilde{\mathbf{z}}^{(i)}\}_{i=1}^{n}
\mathcal{L}_{\text{LE}}
\phi
\displaystyle\mathcal{L}_{\text{LE}}(\mathcal{B},\tilde{\mathcal{B}};\phi,\tau%
)=\frac{1}{2n}\sum_{i=1}^{n}\sum_{j=1,2}\mathcal{L}_{\text{NT-Xent}}\left(%
\mathbf{z}^{(i)}_{j},\mathbf{z}^{(i)}_{3-j},\{\mathbf{z}_{l}^{(k)}\}_{k\neq i,%
l\in\{1,2\}}\cup\{\tilde{\mathbf{z}}^{(i)}\}_{i=1}^{n};\tau\right),
\displaystyle\mathcal{L}_{\text{LE}}(\mathcal{B},\tilde{\mathcal{B}};\phi,\tau%
)=\frac{1}{2n}\sum_{i=1}^{n}\sum_{j=1,2}\mathcal{L}_{\text{NT-Xent}}\left(%
\mathbf{z}^{(i)}_{j},\mathbf{z}^{(i)}_{3-j},\{\mathbf{z}_{l}^{(k)}\}_{k\neq i,%
l\in\{1,2\}}\cup\{\tilde{\mathbf{z}}^{(i)}\}_{i=1}^{n};\tau\right),
\mathcal{L}_{\text{NT-Xent}}
\tau
\mathbf{z}^{(i)}_{j}:=h_{\phi}(t_{j}^{(i)}(\mathbf{x}^{(i)}))
\{t_{j}^{(i)}\}\sim\mathcal{T}
\{\tilde{\mathbf{z}}^{(i)}\}_{i=1}^{n}
h_{\phi}
(f_{\theta},g_{\theta})
\min_{\phi,\theta}\mathbb{E}_{\mathcal{B},\tilde{\mathcal{B}}}[\mathcal{L}_{%
\text{EBM}}(\mathcal{B},\tilde{\mathcal{B}};\theta,\alpha,\beta)+\mathcal{L}_{%
\text{LE}}(\mathcal{B},\tilde{\mathcal{B}};\phi,\tau)]
(f_{\theta},g_{\theta})
h_{\phi}
\dagger
\ddagger
\dagger
\ddagger
\times
\times
N=2
N=8
\underline{652\text{h}}
E_{\theta}(\mathbf{x})
\times
\times
\times
f_{\theta}
\times
4\times
\times
\times
\times
\times
p_{\theta}(\mathbf{x})\propto\exp(-E_{\theta}(\mathbf{x}))
p_{\theta}(\mathbf{x},\mathbf{z})\propto E_{\theta}(\mathbf{x},\mathbf{z})
\mathbf{x}
\displaystyle s(\mathbf{x}):=\frac{1}{2}\lVert f_{\theta}(\mathbf{x})\rVert_{2%
}^{2}-\beta g_{\theta}\left(\frac{f_{\theta}(\mathbf{x})}{\lVert f_{\theta}(%
\mathbf{x})\rVert_{2}}\right)^{\top}\frac{h_{\phi}(\mathbf{x})}{\lVert h_{\phi%
}(\mathbf{x})\rVert_{2}}.
\displaystyle s(\mathbf{x}):=\frac{1}{2}\lVert f_{\theta}(\mathbf{x})\rVert_{2%
}^{2}-\beta g_{\theta}\left(\frac{f_{\theta}(\mathbf{x})}{\lVert f_{\theta}(%
\mathbf{x})\rVert_{2}}\right)^{\top}\frac{h_{\phi}(\mathbf{x})}{\lVert h_{\phi%
}(\mathbf{x})\rVert_{2}}.
p_{\theta}(\mathbf{x}|\mathbf{z})\propto\exp(-E_{\theta}(\mathbf{x},\mathbf{z}))
\mathbf{x}
\mathbf{z}\sim p_{\text{data}}(\mathbf{z}|\mathbf{x})
h_{\phi}
E_{\theta}(\mathbf{x},\mathbf{z})
\{\mathbf{x}^{(i)}\}
\{\mathbf{x}^{(i)}\}
\mathbf{z}^{(i)}\sim p_{\text{data}}(\cdot|\mathbf{x}^{(i)})
i
\bar{\mathbf{z}}:=\sum_{i}\mathbf{z}^{(i)}/\lVert\sum_{i}\mathbf{z}^{(i)}%
\rVert_{2}
p_{\theta}(\mathbf{x}|\bar{\mathbf{z}})
\{\mathbf{x}^{(i)}\}
\{\mathbf{x}^{(i)}_{y}\}
y
\tilde{\mathbf{x}}_{y}\sim p_{\theta}(\cdot|\bar{\mathbf{z}}_{y})
y
\{\tilde{\mathbf{x}}_{y}\}
\{\tilde{\mathbf{x}}_{y}\}
c
(i,j)
\mathbb{P}_{\tilde{\mathbf{x}}_{i}}(c(\tilde{\mathbf{x}}_{i})=j)
\tilde{\mathbf{x}}_{y}
y
y
E(\mathbf{x}|c_{1})
E(\mathbf{x}|c_{2})
c_{1}
c_{2}
p_{\theta}(\mathbf{x}|c_{1}\text{ and }c_{2})\propto\exp(-E(\mathbf{x}|c_{1})-%
E(\mathbf{x}|c_{2}))
E(\mathbf{x}|\mathbf{z})
\mathbf{z}
\times
\bar{\mathbf{z}}_{a}
a\in\mathcal{A}:=\{\text{Young},\text{Female},\text{Smiling}\}
\displaystyle E_{\theta}(\mathbf{x}|\mathcal{A}):=\frac{1}{2}\lVert f_{\theta}%
(\mathbf{x})\rVert_{2}-\beta\sum_{a\in\mathcal{A}}\text{sim}(g_{\theta}(f_{%
\theta}(\mathbf{x})/\lVert f_{\theta}(\mathbf{x})\rVert_{2}),\bar{\mathbf{z}}_%
{a}),
\displaystyle E_{\theta}(\mathbf{x}|\mathcal{A}):=\frac{1}{2}\lVert f_{\theta}%
(\mathbf{x})\rVert_{2}-\beta\sum_{a\in\mathcal{A}}\text{sim}(g_{\theta}(f_{%
\theta}(\mathbf{x})/\lVert f_{\theta}(\mathbf{x})\rVert_{2}),\bar{\mathbf{z}}_%
{a}),
\text{sim}(\cdot,\cdot)
\{\text{Young},\text{Female}\}
p_{\theta}(\mathbf{z}|\mathbf{x})
p_{\text{data}}(\mathbf{z}|\mathbf{x})
\tilde{\mathbf{z}}\sim p_{\theta}(\cdot)
g_{\theta}
p_{\text{data}}(\mathbf{x})
\beta\in\{0.1,0.01,0.001\}
\beta=0.01
h_{\phi}
g_{\theta}
p_{\theta}(\tilde{\mathbf{z}})
\downarrow
\uparrow
\beta=0
\beta
\beta
\beta
\downarrow
\uparrow
\downarrow
\uparrow
f
p(\mathbf{x})
(f_{\theta},g_{\theta})
h_{\phi}
\mathcal{T}
\alpha,\beta,\tau>0
\mathtt{sg}(\cdot)
\mathcal{B}
\tilde{\mathcal{B}}
\{\mathbf{x}^{(i)}\}_{i=1}^{n}\sim p_{\text{data}}(\mathbf{x})
\{\tilde{\mathbf{x}}^{(i)}\}_{i=1}^{n}\sim p_{\theta}(\mathbf{x})
\mathbf{z}^{(i)}\leftarrow\mathtt{sg}\left(h_{\phi}(t^{(i)}(\mathbf{x}^{(i)}))%
/\lVert h_{\phi}(t^{(i)}(\mathbf{x}^{(i)}))\rVert_{2}\right)
t^{(i)}\sim\mathcal{T}
\tilde{\mathbf{z}}^{(i)}\leftarrow\mathtt{sg}\left(g_{\theta}(f_{\theta}(%
\tilde{\mathbf{x}}^{(i)})/\lVert f_{\theta}(\tilde{\mathbf{x}}^{(i)})\rVert_{2%
})\right)
\mathcal{L}_{\text{EBM}}
\mathcal{L}_{\text{EBM}}\leftarrow\frac{1}{n}\sum_{i=1}^{n}E_{\theta}(\mathbf{%
x}^{(i)},\mathbf{z}^{(i)})-E_{\theta}(\tilde{\mathbf{x}}^{(i)})+\alpha\cdot(E_%
{\theta}(\mathbf{x}^{(i)})^{2}+E_{\theta}(\tilde{\mathbf{x}}^{(i)})^{2})
\mathcal{L}_{\text{LE}}
\mathbf{z}^{(i)}_{j}\leftarrow h_{\phi}(t^{(i)}_{j}(\mathbf{x}^{(i)}))
t^{(i)}_{j}\sim\mathcal{T}
\mathcal{L}_{\text{LE}}\leftarrow\frac{1}{2n}\sum_{i=1}^{n}\sum_{j=1,2}%
\mathcal{L}_{\text{NT-Xent}}\left(\mathbf{z}^{(i)}_{j},\mathbf{z}^{(i)}_{3-j},%
\{\mathbf{z}_{l}^{(k)}\}_{k\neq i,l\in\{1,2\}}\cup\{\tilde{\mathbf{z}}^{(i)}\}%
_{i=1}^{n};\tau\right)
\theta
\phi
\mathcal{L}_{\text{EBM}}+\mathcal{L}_{\text{LE}}
f_{\theta}
f_{\theta}:\mathbb{R}^{3\times 32\times 32}\rightarrow\mathbb{R}^{128}
g_{\theta}
g_{\theta}(\mathbf{u})=W_{2}\sigma(W_{1}\mathbf{u})\in\mathbb{R}^{128}
h_{\phi}
f_{\theta}
\mathbf{x}\in\mathbb{R}^{3\times 32\times 32}
32\times 32
16\times 16
8\times 8
f_{\theta}(\mathbf{x})\in\mathbb{R}^{128}
f_{\theta}
\mathbf{x}\in\mathbb{R}^{3\times 32\times 32}
32\times 32
16\times 16
8\times 8
f_{\theta}(\mathbf{x})\in\mathbb{R}^{128}
(3,32,32)
(3,32,32)
(3,32,32)
(3,16,16)
(3,8,8)
f_{\theta}(\mathbf{x})
\begin{matrix}\tt Conv(3\times 3,64)&\\
\tt ResBlock(64)&\times 1\\
\tt AvgPool(2\times 2)&\\
\tt ResBlock(64)&\times 1\\
\tt AvgPool(2\times 2)&\\
\tt ResBlock(128)&\times 1\\
\tt AvgPool(2\times 2)&\\
\tt ResBlock(128)&\times 1\\
\tt GlobalAvgPool&\\
\tt MLP(128,2048,128)&\end{matrix}
\begin{matrix}\tt Conv(3\times 3,128)&\\
\tt ResBlock(128)&\times 2\\
\tt AvgPool(2\times 2)&\\
\tt ResBlock(128)&\times 2\\
\tt AvgPool(2\times 2)&\\
\tt ResBlock(256)&\times 2\\
\tt AvgPool(2\times 2)&\\
\tt ResBlock(256)&\times 2\\
\tt GlobalAvgPool&\\
\tt MLP(256,2048,128)&\end{matrix}
\begin{matrix}\left\{\begin{matrix}\tt Conv(3\times 3,256)&\\
\tt ResBlock(256)&\times 2\\
\tt AvgPool(2\times 2)&\\
\tt ResBlock(256)&\times 2\\
\tt AvgPool(2\times 2)&\\
\tt ResBlock(256)&\times 2\\
\tt AvgPool(2\times 2)&\\
\tt ResBlock(256)&\times 2\\
\tt GlobalAvgPool&\\
\end{matrix}\right\}\times 3\\
\tt Concat\rightarrow MLP(768,2048,128)\end{matrix}
\theta
\beta_{1}=0
\beta_{2}=0.999
10^{-4}
\phi
3\times 10^{-2}
5\times 10^{-4}
0.9
\mathcal{T}
\mathcal{T}
\alpha=1
\beta=0.01
\beta
256
h_{\phi}
\tilde{\mathbf{x}}\sim p_{\theta}
t\sim\mathcal{T}
p(\mathbf{x})
p(\mathbf{z}|\mathbf{x})
p(\mathbf{x})
p(\mathbf{z}|\mathbf{x})
p(\mathbf{x})
p(\mathbf{z}|\mathbf{x})
E(\mathbf{x})=g^{\prime}_{\theta}(f_{\theta}(\mathbf{x}))\in\mathbb{R}
E(\mathbf{z}|\mathbf{x})=\mathbf{z}^{\top}g_{\theta}(f(\mathbf{x}))
f
g
g^{\prime}
p(\mathbf{x})
f_{\theta}(\mathbf{x})
p(\mathbf{z}|\mathbf{x})
f_{\theta}(\mathbf{x})
p(\mathbf{x})
p(\mathbf{z}|\mathbf{x})
f_{\theta}(\mathbf{x})
f_{\theta}(\mathbf{x})
g_{\theta}(f_{\theta}(\mathbf{x}))
g_{\theta}(f_{\theta}(\mathbf{x}))
h_{\phi}(\mathbf{x})
h_{\phi}(\mathbf{x})
f_{\theta}(\mathbf{x})
g_{\theta}(f_{\theta}(\mathbf{x}))
h_{\phi}(\mathbf{x})
f_{\theta}(\mathbf{x})
g_{\theta}(f_{\theta}(\mathbf{x}))
h_{\phi}(\mathbf{x})
g_{\theta}
f_{\theta}(\mathbf{x})/\lVert f_{\theta}(\mathbf{x})\rVert_{2}
p_{\text{data}}(\mathbf{z})
h_{\theta}(\mathbf{x})/\lVert h_{\theta}(\mathbf{x})\rVert_{2}
p_{\text{data}}(\mathbf{z})
f_{\theta}(\mathbf{x})/\lVert f_{\theta}(\mathbf{x})\rVert_{2}
p_{\theta}(\mathbf{x})\propto\exp(-\lVert f_{\theta}(\mathbf{x})\rVert_{2}^{2})
f_{\theta}(\mathbf{x})
g_{\theta}(f_{\theta}(\mathbf{x}))
h_{\phi}(\mathbf{x})
f_{\theta}(\mathbf{x})
h_{\phi}(\mathbf{x})
g_{\theta}
p_{1}(\mathbf{x})\propto\exp(f_{1}(\mathbf{x}))
f_{1}(\mathbf{x})\in\mathbb{R}
p_{2}(\mathbf{x})\propto\exp(\lVert f_{2}(\mathbf{x})\rVert_{2}^{2})
f_{2}(\mathbf{x})\in\mathbb{R}^{d}
\mathcal{X}
\mathbf{x}
\mathcal{X}=[0,255]^{HWC}
b:=\min_{\mathbf{x}\in\mathcal{X}}f_{1}(\mathbf{x})
f_{1}
p_{3}(\mathbf{x})\propto\exp(f_{1}(\mathbf{x})-b)
p_{1}
p_{3}
p_{2}
f_{2}
\sqrt{f_{1}(\mathbf{x})-b}
p_{1}
p_{2}
