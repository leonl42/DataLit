z^{T}
z^{T}
\epsilon
t
z^{t}
z^{0}
\mathcal{P}
\mathcal{W}_{\text{p}}=\text{CLIP}_{\text{text}}(\mathcal{P})
c_{\text{p}}
l
\mathcal{X}^{t}
f_{Q}(\cdot)
Q^{t}\in R^{(n,h\times w,d)}
n
d
\mathcal{W}_{\text{p}}
K_{\text{p}},V_{\text{p}}\in R^{(n,l,d)}
f_{K}(\cdot),f_{V}(\cdot)
f_{M}(\cdot)
M^{t}=f_{M}(Q^{t},K_{p})=\text{Softmax}(\frac{Q^{t}K_{\text{p}}^{T}}{\sqrt{d}}%
),\;M^{t}\in R^{(n,h\times w,l)}.
d
d
M_{t}
\xi(\cdot)
\mathcal{C}=\{c_{1},c_{2},\ldots,c_{k}\}
\begin{split}\mathbb{W}=[{\color[rgb]{0,0,0}\mathcal{W}_{\text{p}},}\mathcal{W%
}_{1},\mathcal{W}_{2},\ldots,\mathcal{W}_{k}],\;\mathcal{W}_{i}=\text{CLIP}_{%
\text{text}}(c_{i}),\;i=1,\ldots k.\end{split}
\mathcal{W}_{i}
\mathcal{W}_{p}
\langle
\rangle
\langle
\rangle
\mathcal{W}_{p}
\overline{\mathcal{W}}_{i}
\mathcal{\overline{W}}_{\text{p}}
K_{\text{p}}
M^{t}
\mathbb{W}
M^{t}
k
\mathcal{C}
\mathbb{V}=[{\color[rgb]{0,0,0}f_{V}(\mathcal{W}_{\text{p}}),f_{V}(\mathcal{%
\overline{W}}_{1}),\ldots,f_{V}(\mathcal{\overline{W}}_{k})}]=[{\color[rgb]{%
0,0,0}V_{\text{p}}},V_{1},\dots,V_{k}].
O^{t}=\frac{1}{(k+1)}\sum_{i}(M^{t}V_{i}),i=\text{p},1,2,\ldots,k.
\mathcal{P}
\xi
\psi
\phi
x
\mathcal{C}=[c_{1},\ldots,c_{k}]
\xi(\mathcal{P})
\mathcal{W}_{\text{p}}\leftarrow\text{CLIP}_{\text{text}}(\mathcal{P})
\mathcal{W}_{i}\leftarrow\text{CLIP}_{\text{text}}(c_{i});%
\lx@algorithmic@hfill i=1,\ldots,k
t=T,T-1,\ldots,1
\phi
\mathcal{X}^{t}
Q^{t}\leftarrow f_{Q}(\mathcal{X}^{t})
K_{\text{p}}\leftarrow f_{K}(\mathcal{W}_{\text{p}})
V_{i}\leftarrow f_{V}(\mathcal{\overline{W}}_{i});\lx@algorithmic@hfill i=%
\text{p},1,\ldots,k
M^{t}
Q^{t},K_{\text{p}}
{O}^{t}
M^{t},\{V_{i}\}
z^{0}
\psi(\cdot)
f_{V}(\mathcal{W}_{p})
M^{t}
Q^{t},K_{p}
M_{t}
\mathbb{M}=\{M^{t}_{p},M^{t}_{1},\ldots\}
\mathcal{C}
\mathbb{V}
{\color[rgb]{0,0,0}\mathbb{K}=\{f_{K}(\mathcal{W}_{i})\},\;\mathbb{M}^{t}=\{f_%
{M}(Q^{t},K_{i})\}},\;i={\color[rgb]{0,0,0}\text{p}},1,2,\ldots,k.
{\color[rgb]{0,0,0}O^{t}=\frac{1}{(k+1)}\sum_{i}(M_{i}^{t}V_{k})},i={\color[%
rgb]{0,0,0}\text{p}},1,2,\ldots,k.
O^{t}
x
\uparrow
\downarrow
\uparrow
\downarrow
\downarrow
\downarrow
\sim
\mathcal{W}_{\text{full}}
M_{t}
\mathbb{V}
