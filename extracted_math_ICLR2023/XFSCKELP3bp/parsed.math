t
t
l_{2}
t
t
t
f:\Omega\to\mathbb{R}
\|f\|_{\infty}=\sup_{\bx\in\Omega}|f(\bx)|
\|f\|_{p}=(\int_{\Omega}|f(\bx)|^{p}d\bx)^{1/p}
\bx
\|\bx\|_{p}
p
1\leq p\leq\infty
\PP(A)
A
z
P_{z}
p_{z}
N(\mu,\Sigma)
\bI_{d}
d\times d
\cD_{n}=\{\bx_{1},\cdots,\bx_{n}\}\subset\RR^{d}
\bx_{i}
P_{\bx}
\bz_{1},\cdots,\bz_{n}\in\RR^{d_{z}}
\cD_{n}
d_{z}
d
f(\bx)
\RR^{d}\to\RR^{d_{z}}
\bz_{i}=f(\bx_{i})
\bP\in\RR^{n\times n}
\cD_{n}
\bz_{1},\cdots,\bz_{n}
\bQ\in\RR^{n\times n}
\bP
\bx_{j}
\bx_{i}
\bx_{i}
i\neq j
P_{j|i}=\frac{\exp(-\|\bx_{i}-\bx_{j}\|_{2}^{2}{/2\sigma_{i}^{2}})}{\sum_{k%
\neq i}\exp(-\|\bx_{i}-\bx_{k}\|_{2}^{2}{/2\sigma_{i}^{2}})},
\sigma_{i}
\bx_{i}
Q_{j|i}
\bQ
\bP
\displaystyle\inf_{\bz_{1},\cdots,\bz_{n}}\sum_{i=1}^{n}\sum_{j=1}^{n}P_{j|i}%
\log\frac{P_{j|i}}{Q_{j|i}}.
\displaystyle\inf_{\bz_{1},\cdots,\bz_{n}}\sum_{i=1}^{n}\sum_{j=1}^{n}P_{j|i}%
\log\frac{P_{j|i}}{Q_{j|i}}.
f
P
t
\bx_{i}
\bx_{i}^{\prime}
\bx_{i}^{\prime\prime}
\cD_{n}^{\prime}=\{\bx_{1}^{\prime},\cdots,\bx_{n}^{\prime}\},
\cD_{n}^{\prime\prime}=\{\bx_{1}^{\prime\prime},\cdots,\bx_{n}^{\prime\prime}
l({\bx_{i}^{\prime}},\bx_{i}^{\prime\prime})=-\log\frac{\exp(\mathrm{sim}(f({%
\bx_{i}^{\prime}}),f(\bx_{i}^{\prime\prime}))/\tau)}{\sum_{\bx\in{\cD_{n}^{%
\prime}}\cup\cD_{n}^{\prime\prime}\backslash\{\bx_{i}^{\prime}\}}\exp(\mathrm{%
sim}(f({\bx_{i}^{\prime}}),f(\bx))/\tau)},
\mathrm{sim}(\bz_{1},\bz_{2})=\langle\frac{\bz_{1}}{\|\bz_{1}\|_{2}},\frac{\bz%
_{2}}{\|\bz_{2}\|_{2}}\rangle
\tau
L_{{\mathrm{InfoNCE}}}:=\frac{1}{2n}\sum_{i=1}^{n}\rbr{l({\bx_{i}^{\prime%
\prime}},\bx_{i}^{\prime})+l(\bx_{i}^{\prime},{\bx_{i}^{\prime\prime}})}
\tilde{\cD}_{2n}={\cD_{n}^{\prime\prime}}\cup\cD^{\prime}_{n}
\tilde{\bx}_{2i-1}={\bx_{i}^{\prime\prime}}
\tilde{\bx}_{2i}=\bx_{i}^{\prime}
l_{2}
\sigma_{i}^{2}\equiv\tau
i\neq j
\tilde{Q}_{j|i}=\frac{\exp(\mathrm{sim}(f(\tilde{\bx}_{i}),f(\tilde{\bx}_{j}))%
/\tau)}{\sum_{k\neq i}\exp(\mathrm{sim}(f(\tilde{\bx}_{i}),f(\tilde{\bx}_{k}))%
/\tau)}.
\tilde{P}_{j|i}=\begin{cases}{\color[rgb]{0,0,0}1},&\text{if }\tilde{\bx_{i}}%
\text{ and }{\color[rgb]{0,0,0}\tilde{\bx}_{j}}\text{ are positive pairs}\\
0,&\text{otherwise, }\end{cases}
\displaystyle\sum_{i=1}^{2n}\sum_{j=1}^{2n}\tilde{P}_{j|i}\log\frac{\tilde{P}_%
{j|i}}{\tilde{Q}_{j|i}}=\sum_{k=1}^{n}\rbr{-\log(\tilde{Q}_{2k-1|2k})-\log(%
\tilde{Q}_{2k|2k-1})},
\displaystyle\sum_{i=1}^{2n}\sum_{j=1}^{2n}\tilde{P}_{j|i}\log\frac{\tilde{P}_%
{j|i}}{\tilde{Q}_{j|i}}
\displaystyle=\sum_{k=1}^{n}\rbr{-\log(\tilde{Q}_{2k-1|2k})-\log(\tilde{Q}_{2k%
|2k-1})},
L_{\mathrm{InfoNCE}}
n
\bP
\bQ
\bP
\bP
l_{p}
\RR^{d}
\bP
\bz_{i}
d
m
P_{\bx}\sim\frac{1}{m}\sum_{i=1}^{m}N(\bmu_{i},\sigma^{2}\bI_{d})
d=2
m=5
\sigma=0.1
\bx
\bx^{\prime}\sim N(\bmu_{1},\sigma^{2}\bI_{d})
1
l_{2}
1
l_{2}
\bx\in\RR^{d}
\bx^{\prime}=\bx+\delta
\delta
\phi(\bx)
\bx_{i}
\bt\in\RR^{d}
P_{\bt|\bx_{i}}=\PP(\bx_{i}\mbox{ and }\bx_{i}^{\prime}=\bt
|\bx_{i})=\phi(\bt-\bx_{i})
l_{2}
\RR^{d}
\bx_{i}
\bx_{j}
\bx_{i}^{\prime}=\bx_{i}+\lambda(\bx_{j}-\bx_{i})
\lambda\in(0,1)
\bx_{1},\bx_{2}\sim P_{x}
\lambda(\bx_{1}-\bx_{2})
p_{\lambda}(\bx)
P_{\bx_{1},\bx_{2}}=P_{\bx_{2},\bx_{1}}=p_{\lambda}(\bx_{1}-\bx_{2})
d
m<d
\bmu_{1},\cdots,\bmu_{m}
(m-1)
\RR^{d}
\bmu_{i}
\bS_{\mu}
\bS_{\mu}
p_{\lambda}(\bx)
\bS_{\mu}
P_{\bx_{2},\bx_{1}}
\bS_{\mu}
\bS_{\mu}
\bmu_{i}
d
m-1
l_{2}
\RR^{d}
m\ll d
(d_{z}-1)
f(\bx_{i})=f(\bx_{i}^{\prime})
i=1,\cdots,n
n
n
d
d=2
d\geq n-1
(n-1)
(n-1)
\RR^{d}
-1/(n-1)
L_{\mathrm{InfoNCE}}
n\to\infty
d=1,\ d_{z}=2,\ m=4,\ \mu_{i}=i
\sigma=0.1
\to
\to
\to
d=1
f
C(f)=\EE_{\bx,\bx^{\prime}}\frac{\|f(\bx)-f(\bx^{\prime})\|_{2}}{\|\bx-\bx^{%
\prime}\|_{2}},
\bx_{1},\bx_{2}
\bx_{1},\cdots,\bx_{n}\in\RR^{d}
\bz_{1},\cdots,\bz_{n}\in\RR^{d_{z}}
n
(d_{z}-1)
Q
P
C(f)
\bx_{1},\cdots,\bx_{n}\in\RR^{d}
\|\bx_{i}-\bx_{j}\|_{2}>0
i,j
\bz_{1},\cdots,\bz_{n}\in\RR^{d_{z}}
n
(d_{z}-1)
P=(p_{ij})_{n\times n}
Q=(q_{ij})_{n\times n}
\bx_{i}
\bz_{i}
\pi
\{1,\cdots,n\}
T
Q^{\pi}
\pi
Q
C_{1}(P,\ Q^{\pi})=\sum_{i\neq j}\frac{q_{\pi(i)\pi(j)}}{p_{ij}}\quad\mbox{and%
}\quad\pi^{*}=\argmin_{\pi\in T}\ C_{1}(P,\ Q^{\pi}).
\pi^{*}
\|\bar{P}-{Q}^{\pi}\|_{F}
\|\cdot\|_{F}
\bar{P}=(\bar{p}_{ij})_{n\times n}
\bar{p}_{ij}=-1/p_{ij}
C(f)
q_{ij}=-\|f(\bx_{i})-f(\bx_{j})\|_{2}
C(f)
C(f)
\bz_{1},\cdots,\bz_{n}
3!=6
\to
\to
\to
C(f)
C(f)
2
l_{2}
\RR
t
t
x
t
x
t
\displaystyle\frac{1}{2n}\sum_{i=1}^{n}\ p_{ii^{\prime}}\cdot\rbr{l(\bx_{i},%
\bx_{i}^{\prime})+l(\bx_{i}^{\prime},\bx_{i})}.
\displaystyle\frac{1}{2n}\sum_{i=1}^{n}\ p_{ii^{\prime}}\cdot\rbr{l(\bx_{i},%
\bx_{i}^{\prime})+l(\bx_{i}^{\prime},\bx_{i})}.
p_{ii^{\prime}}
P
p_{ii^{\prime}}\propto\exp(\mathrm{IoU}(\bx_{i},\bx_{i}^{\prime})/{\tau^{%
\prime}}),
{\tau^{\prime}}>0
{\tau^{\prime}}
{\tau^{\prime}}
{\tau^{\prime}}=1
t
\bQ
\bP
t
t
\bQ
L_{\mathrm{InfoNCE}}
\displaystyle\frac{1}{n}\sum_{i=1}^{n}-\log\frac{\rbr{1+\|f(\bx_{i})-f(\bx_{i}%
^{\prime})\|^{2}_{2}/(\tau\ t_{df})}^{-(t_{df}+1)/2}}{\sum_{1\leq j\neq k\leq 2%
n}\rbr{1+\|f(\tilde{\bx}_{j})-f(\tilde{\bx}_{k})\|^{2}_{2}/(\tau\ t_{df})}^{-(%
t_{df}+1)/2}},
\displaystyle\frac{1}{n}\sum_{i=1}^{n}-\log\frac{\rbr{1+\|f(\bx_{i})-f(\bx_{i}%
^{\prime})\|^{2}_{2}/(\tau\ t_{df})}^{-(t_{df}+1)/2}}{\sum_{1\leq j\neq k\leq 2%
n}\rbr{1+\|f(\tilde{\bx}_{j})-f(\tilde{\bx}_{k})\|^{2}_{2}/(\tau\ t_{df})}^{-(%
t_{df}+1)/2}},
t_{df}
t
l_{2}
\bQ
t
t
t
t
d_{z}
d_{z}=128
t
d_{z}=8
t
t
t_{df}=1
d_{z}=2
t_{df}
d_{z}
t_{df}
t_{df}=5
t_{df}
d_{z}
t_{df}
\tau
t
t
t
t
t
t
t
t
t
t
t
t
t
t
f
t
t
d_{z}=2
t
a_{i}
b_{i}
b_{i}
\bar{b}
\sum_{i}\mathrm{sim}(a_{i},\bar{b})
\bx_{i}
\bt\in\RR^{d}
P_{\bt|\bx_{i}}=\PP(\bx_{i}\mbox{ and }\bx_{i}^{\prime}=\bt\mbox{ form a %
positive pair }|\bx_{i})=\phi(\bt-\bx_{i}).
\sigma^{2}\bI
\phi(\bt-\bx_{i})\propto\exp(-\|\bt-\bx_{i}\|_{2}^{2}/2\sigma^{2})
l_{2}
\bt
\bx_{i}
C(f)
C(f)
C(f)
C(f)
C(f)
l_{2}
C(f)
l_{2}
t
C(f)
C(f)
C(f)
l_{2}
C(f)
l_{2}
t
C(f)
C(f)
C(f)
t
t
C(f)
l_{2}
t
C(f)
l_{2}
t
P
Q
0<x_{1}<\cdots<x_{m}
0<y_{1}<\cdots<y_{m}
\sum_{i=1}^{m}x_{i}^{2}=\sum_{i=1}^{m}y_{i}^{2}=1
\pi
\{1,\cdots,m\}
T
\argmin_{\pi\in T}\sum_{i=1}^{m}\frac{y_{\pi(i)}}{x_{i}}\ =\ \argmin_{\pi\in T%
}\sum_{i=1}^{m}(x_{i}-y_{\pi(i)})^{2}:=\pi^{*},
\pi^{*}(i)=i
i=1,\cdots,m
\sum_{i=1}^{m}\frac{y_{\pi(i)}}{x_{i}}\geq\sum_{i=1}^{m}\frac{y_{i}}{x_{i}}.
\displaystyle\sum_{i=1}^{m}(x_{i}-y_{\pi(i)})^{2}=\sum_{i=1}^{m}x_{i}^{2}+\sum%
_{i=1}^{m}y_{i}^{2}-2\sum_{i=1}^{m}x_{i}\cdot y_{\pi(i)}\geq 2-2\sum_{i=1}^{m}%
x_{i}\cdot y_{i}.
\displaystyle\sum_{i=1}^{m}(x_{i}-y_{\pi(i)})^{2}
\displaystyle=\sum_{i=1}^{m}x_{i}^{2}+\sum_{i=1}^{m}y_{i}^{2}-2\sum_{i=1}^{m}x%
_{i}\cdot y_{\pi(i)}\geq 2-2\sum_{i=1}^{m}x_{i}\cdot y_{i}.
f
\sum_{i}f(x_{i})/x_{1}
\displaystyle\|\bar{P}-{Q}^{\pi}\|_{F}=\sum_{i\neq j}\rbr{\frac{1}{p_{ij}}+{q_%
{\pi(i)\pi(j)}}}^{2}
\displaystyle\|\bar{P}-{Q}^{\pi}\|_{F}
\displaystyle=\sum_{i\neq j}\rbr{\frac{1}{p_{ij}}+{q_{\pi(i)\pi(j)}}}^{2}
\displaystyle=\sum_{i\neq j}\frac{1}{p_{ij}^{2}}+\sum_{i\neq j}{q_{\pi(i)\pi(j%
)}}^{2}+2\sum_{i\neq j}\frac{q_{\pi(i)\pi(j)}}{p_{ij}}
\displaystyle=\sum_{i\neq j}\frac{1}{p_{ij}^{2}}+\sum_{i\neq j}{q_{\pi(i)\pi(j%
)}}^{2}+2\sum_{i\neq j}\frac{q_{\pi(i)\pi(j)}}{p_{ij}}
\displaystyle=2C_{1}(P,Q^{\pi})+\sum_{i\neq j}\frac{1}{p_{ij}^{2}}+\sum_{i\neq
j%
}{q_{ij}}^{2}
\displaystyle=2C_{1}(P,Q^{\pi})+\sum_{i\neq j}\frac{1}{p_{ij}^{2}}+\sum_{i\neq
j%
}{q_{ij}}^{2}
C_{1}(P,Q^{\pi})
\|\bar{P}-{Q}^{\pi}\|_{F}
L_{\mathrm{InfoNCE}}=\frac{1}{2n}\sum_{i=1}^{n}\rbr{l(\bx_{i},\bx_{i}^{\prime}%
)+l(\bx_{i}^{\prime},\bx_{i})}
l(\bx_{i},\bx_{i}^{\prime})=-\log\frac{\exp(\mathrm{sim}(f(\bx_{i}),f(\bx_{i}^%
{\prime}))/\tau)}{\sum_{x\in\cD_{n}\cup\cD_{n}^{\prime}\backslash\{\bx_{i}\}}%
\exp(\mathrm{sim}(f(\bx_{i}),f(\bx))/\tau)}.
\tau=1
l(\bx_{i},\bx_{i}^{\prime})
(f(\bx_{i}),f(\bx_{i}^{\prime}))
\frac{x}{x+c}
x>0
c>0
L_{\mathrm{InfoNCE}}
f(\bx_{i})=f(\bx_{i}^{\prime})
i=1,\ldots,n
L_{\mathrm{InfoNCE}}
f(\bx_{i})
L_{\mathrm{InfoNCE}}\geq L_{\mathrm{uniform}}
\displaystyle L_{\mathrm{uniform}}=\frac{1}{n}\sum_{i=1}^{n}-\log\frac{e}{e+%
\sum_{j\neq i}\exp(\mathrm{sim}(f(\bx_{i}),f(\bx_{j})))}
\displaystyle L_{\mathrm{uniform}}
\displaystyle=\frac{1}{n}\sum_{i=1}^{n}-\log\frac{e}{e+\sum_{j\neq i}\exp(%
\mathrm{sim}(f(\bx_{i}),f(\bx_{j})))}
\displaystyle\geq\log\rbr{\frac{1}{n}\sum_{i=1}^{n}\rbr{1+\frac{1}{e}\sum_{j%
\neq i}\exp(\mathrm{sim}(f(\bx_{i}),f(\bx_{j})))}}
\displaystyle\geq\log\rbr{\frac{1}{n}\sum_{i=1}^{n}\rbr{1+\frac{1}{e}\sum_{j%
\neq i}\exp(\mathrm{sim}(f(\bx_{i}),f(\bx_{j})))}}
\displaystyle\geq\log\rbr{1+\frac{1}{n\cdot e}{\sum_{1\leq i\neq j\leq n}\exp(%
\mathrm{sim}(f(\bx_{i}),f(\bx_{j})))}}.
\displaystyle\geq\log\rbr{1+\frac{1}{n\cdot e}{\sum_{1\leq i\neq j\leq n}\exp(%
\mathrm{sim}(f(\bx_{i}),f(\bx_{j})))}}.
L_{\mathrm{uniform}}
\bx_{i}
f
f
L_{\mathrm{InfoNCE}}
\bx_{i}
f(\bx_{i})
f_{n}^{*}
C(f)
\displaystyle f_{n}^{*}:=\argmin_{f}C_{n}(f)=\argmin_{f}\sum_{1\leq i\neq j%
\leq n}\frac{\|f(\bx_{i})-f(\bx_{j})\|_{2}}{\|\bx_{i}-\bx_{j}\|_{2}},
\displaystyle f_{n}^{*}:=\argmin_{f}C_{n}(f)=\argmin_{f}\sum_{1\leq i\neq j%
\leq n}\frac{\|f(\bx_{i})-f(\bx_{j})\|_{2}}{\|\bx_{i}-\bx_{j}\|_{2}},
f_{n}^{*}
q_{ij}=-\|f(\bx_{i})-f(\bx_{j})\|_{2}
p_{ij}=-\|\bx_{i}-\bx_{j}\|_{2}
C(f)
q_{ij}=-\|f(\bx_{i})-f(\bx_{j})\|_{2}
t
\Omega\subset\RR^{d}
\bx_{i}\in\Omega
t
\bx_{i}^{\prime}=t(\bx_{i})
\Omega
t
H(\cdot,\cdot)
p(\bx)
\bx
p(\cdot|\bx)
\displaystyle q_{f}(\bx^{\prime}|\bx)=C_{f}(\bx)^{-1}\frac{p(\bx^{\prime})}{1+%
\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}},\mbox{ with }C_{f}(\bx)=\int_{\Omega}\frac%
{p(\bx^{\prime})}{1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}}{\rm d}\bx^{\prime}.
\displaystyle q_{f}(\bx^{\prime}|\bx)=C_{f}(\bx)^{-1}\frac{p(\bx^{\prime})}{1+%
\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}},\mbox{ with }C_{f}(\bx)=\int_{\Omega}\frac%
{p(\bx^{\prime})}{1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}}{\rm d}\bx^{\prime}.
\displaystyle\EE_{\bx\sim p(\bx)}(H(p(\cdot|\bx),q_{f}(\cdot|\bx))=L_{a}(f)+L_%
{u}(f),
\displaystyle\EE_{\bx\sim p(\bx)}(H(p(\cdot|\bx),q_{f}(\cdot|\bx))=L_{a}(f)+L_%
{u}(f),
t
\displaystyle L_{a}=\EE_{\bx\sim p(\bx)}\EE_{\bx\sim p(\bx^{\prime}|\bx)}\log(%
1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}),
\displaystyle L_{a}=
\displaystyle\EE_{\bx\sim p(\bx)}\EE_{\bx\sim p(\bx^{\prime}|\bx)}\log(1+\|f(%
\bx)-f(\bx^{\prime})\|_{2}^{2}),
\displaystyle L_{u}=\EE_{\bx\sim p(\bx)}\log\EE_{\tilde{\bx}\sim p(\tilde{\bx}%
)}(1+\|f(\bx)-f(\tilde{\bx})\|_{2}^{2})^{-1}.
\displaystyle L_{u}=
\displaystyle\EE_{\bx\sim p(\bx)}\log\EE_{\tilde{\bx}\sim p(\tilde{\bx})}(1+\|%
f(\bx)-f(\tilde{\bx})\|_{2}^{2})^{-1}.
\displaystyle H(p(\cdot|\bx),q_{f}(\cdot|\bx))
\displaystyle H(p(\cdot|\bx),q_{f}(\cdot|\bx))
\displaystyle=-\int_{\Omega}p(\bx^{\prime}|\bx)\log\left(\frac{p(\bx^{\prime})%
}{1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}}\right){\rm d}\bx^{\prime}+\log C_{f}(\bx)
\displaystyle=
\displaystyle-\int_{\Omega}p(\bx^{\prime}|\bx)\log\left(\frac{p(\bx^{\prime})}%
{1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}}\right){\rm d}\bx^{\prime}+\log C_{f}(\bx)
\displaystyle=\int_{\Omega}p(\bx^{\prime}|\bx)\log(1+\|f(\bx)-f(\bx^{\prime})%
\|_{2}^{2}){\rm d}\bx^{\prime}-\int_{\Omega}p(\bx^{\prime}|\bx)\log(p(\bx^{%
\prime})){\rm d}\bx^{\prime}+\log\int_{\Omega}\frac{p(\bx^{\prime})}{1+\|f(\bx%
)-f(\bx^{\prime})\|_{2}^{2}}{\rm d}\bx^{\prime}
\displaystyle=
\displaystyle\int_{\Omega}p(\bx^{\prime}|\bx)\log(1+\|f(\bx)-f(\bx^{\prime})\|%
_{2}^{2}){\rm d}\bx^{\prime}-\int_{\Omega}p(\bx^{\prime}|\bx)\log(p(\bx^{%
\prime})){\rm d}\bx^{\prime}+\log\int_{\Omega}\frac{p(\bx^{\prime})}{1+\|f(\bx%
)-f(\bx^{\prime})\|_{2}^{2}}{\rm d}\bx^{\prime}
\displaystyle=\int_{\Omega}p(\bx^{\prime}|\bx)\log(1+\|f(\bx)-f(\bx^{\prime})%
\|_{2}^{2}){\rm d}\bx^{\prime}-\int_{\Omega}p(\bx^{\prime}|\bx)\log(p(\bx^{%
\prime})){\rm d}\bx^{\prime}+\log\EE_{\bx^{\prime}\sim p(\bx^{\prime})}(1+\|f(%
\bx)-f(\bx^{\prime})\|_{2}^{2})^{-1}.
\displaystyle=
\displaystyle\int_{\Omega}p(\bx^{\prime}|\bx)\log(1+\|f(\bx)-f(\bx^{\prime})\|%
_{2}^{2}){\rm d}\bx^{\prime}-\int_{\Omega}p(\bx^{\prime}|\bx)\log(p(\bx^{%
\prime})){\rm d}\bx^{\prime}+\log\EE_{\bx^{\prime}\sim p(\bx^{\prime})}(1+\|f(%
\bx)-f(\bx^{\prime})\|_{2}^{2})^{-1}.
\bx
\displaystyle\EE_{\bx\sim p(\bx)}H(p(\cdot|\bx),q_{f}(\cdot|\bx))
\displaystyle\EE_{\bx\sim p(\bx)}H(p(\cdot|\bx),q_{f}(\cdot|\bx))
\displaystyle=\EE_{\bx\sim p(\bx)}\EE_{\bx^{\prime}\sim p(\bx^{\prime}|\bx)}%
\log(1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2})+\EE_{\bx\sim p(\bx)}\log\EE_{\tilde%
{\bx}\sim p(\tilde{\bx})}(1+\|f(\bx)-f(\tilde{\bx})\|_{2}^{2})^{-1}
\displaystyle=
\displaystyle\EE_{\bx\sim p(\bx)}\EE_{\bx^{\prime}\sim p(\bx^{\prime}|\bx)}%
\log(1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2})+\EE_{\bx\sim p(\bx)}\log\EE_{\tilde%
{\bx}\sim p(\tilde{\bx})}(1+\|f(\bx)-f(\tilde{\bx})\|_{2}^{2})^{-1}
\displaystyle-\int_{\Omega}\int_{\Omega}p(\bx)p(\bx^{\prime}|\bx)\log(p(\bx^{%
\prime})){\rm d}\bx^{\prime}{\rm d}\bx
\displaystyle-\int_{\Omega}\int_{\Omega}p(\bx)p(\bx^{\prime}|\bx)\log(p(\bx^{%
\prime})){\rm d}\bx^{\prime}{\rm d}\bx
\displaystyle=L_{a}(f)+L_{u}(f)-C_{p},
\displaystyle=
\displaystyle L_{a}(f)+L_{u}(f)-C_{p},
\displaystyle C_{p}=\int_{\Omega}\int_{\Omega}p(\bx)p(\bx^{\prime}|\bx)\log(p(%
\bx^{\prime})){\rm d}\bx^{\prime}{\rm d}\bx=\int_{\Omega}\int_{\Omega}p(\bx,%
\bx^{\prime})\log(p(\bx^{\prime})){\rm d}\bx^{\prime}{\rm d}\bx
\displaystyle C_{p}
\displaystyle=\int_{\Omega}\int_{\Omega}p(\bx)p(\bx^{\prime}|\bx)\log(p(\bx^{%
\prime})){\rm d}\bx^{\prime}{\rm d}\bx=\int_{\Omega}\int_{\Omega}p(\bx,\bx^{%
\prime})\log(p(\bx^{\prime})){\rm d}\bx^{\prime}{\rm d}\bx
f
\displaystyle\EE_{\bx\sim p(\bx)}H(p(\cdot|\bx),q_{f}(\cdot|\bx))
\displaystyle\EE_{\bx\sim p(\bx)}H(p(\cdot|\bx),q_{f}(\cdot|\bx))
\displaystyle=\int_{\Omega}p(\bx)\frac{1}{p(\bx)}\int_{\Omega}p(\bx,\bx^{%
\prime})\log\left(\frac{p(\bx^{\prime})}{1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}}%
\right){\rm d}\bx^{\prime}{\rm d}\bx
\displaystyle=
\displaystyle\int_{\Omega}p(\bx)\frac{1}{p(\bx)}\int_{\Omega}p(\bx,\bx^{\prime%
})\log\left(\frac{p(\bx^{\prime})}{1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}}\right%
){\rm d}\bx^{\prime}{\rm d}\bx
\displaystyle-\int_{\Omega}\int_{\Omega}\frac{p(\bx)p(\bx^{\prime})}{1+\|f(\bx%
)-f(\bx^{\prime})\|_{2}^{2}}{\rm d}\bx{\rm d}\bx^{\prime}
\displaystyle-\int_{\Omega}\int_{\Omega}\frac{p(\bx)p(\bx^{\prime})}{1+\|f(\bx%
)-f(\bx^{\prime})\|_{2}^{2}}{\rm d}\bx{\rm d}\bx^{\prime}
\displaystyle=\int_{\Omega}\int_{\Omega}p(\bx,\bx^{\prime})\log\left(\frac{p(%
\bx^{\prime})}{1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}}\right){\rm d}\bx^{\prime}%
{\rm d}\bx
\displaystyle=
\displaystyle\int_{\Omega}\int_{\Omega}p(\bx,\bx^{\prime})\log\left(\frac{p(%
\bx^{\prime})}{1+\|f(\bx)-f(\bx^{\prime})\|_{2}^{2}}\right){\rm d}\bx^{\prime}%
{\rm d}\bx
\displaystyle-\int_{\Omega}\int_{\Omega}\frac{p(\bx)p(\bx^{\prime})}{1+\|f(\bx%
)-f(\bx^{\prime})\|_{2}^{2}}{\rm d}\bx{\rm d}\bx^{\prime}.
\displaystyle-\int_{\Omega}\int_{\Omega}\frac{p(\bx)p(\bx^{\prime})}{1+\|f(\bx%
)-f(\bx^{\prime})\|_{2}^{2}}{\rm d}\bx{\rm d}\bx^{\prime}.
L_{a}
L_{u}
t
L_{\mathrm{InfoNCE}}
t
p(\cdot|\bx)=q_{f}(\cdot|\bx)
f
p(\cdot|\bx)=q_{f}(\cdot|\bx)
P_{j|i}
Q_{j|i}
f^{*}
\displaystyle p(\cdot|\bx)=q_{f^{*}}(\cdot|\bx),
\displaystyle p(\cdot|\bx)=q_{f^{*}}(\cdot|\bx),
\bx\in\Omega
\displaystyle C_{f^{*}}(\bx)^{-1}\frac{p(\bx^{\prime})}{1+\|f^{*}(\bx)-f^{*}(%
\bx^{\prime})\|_{2}^{2}}\propto C(\bx)^{-1}p(\bx^{\prime}|\bx)
\displaystyle C_{f^{*}}(\bx)^{-1}\frac{p(\bx^{\prime})}{1+\|f^{*}(\bx)-f^{*}(%
\bx^{\prime})\|_{2}^{2}}\propto C(\bx)^{-1}p(\bx^{\prime}|\bx)
\displaystyle\Leftrightarrow\ C_{f^{*}}(\bx)^{-1}\frac{1}{1+\|f^{*}(\bx)-f^{*}%
(\bx^{\prime})\|_{2}^{2}}\propto C(\bx)^{-1}\frac{p(\bx,\bx^{\prime})}{p(\bx)p%
(\bx^{\prime})},
\displaystyle\Leftrightarrow\ 
\displaystyle C_{f^{*}}(\bx)^{-1}\frac{1}{1+\|f^{*}(\bx)-f^{*}(\bx^{\prime})\|%
_{2}^{2}}\propto C(\bx)^{-1}\frac{p(\bx,\bx^{\prime})}{p(\bx)p(\bx^{\prime})},
C(\bx)=\int p(\bx^{\prime}|\bx){\rm d}\bx^{\prime}
t
f
\|f\|_{2}=1
f
t
\bx^{\prime}
\bx
p(\bx^{\prime}|\bx)
\bx
\bx^{\prime}
t
\bx^{\prime}
\bx
\bx_{1}
\bx_{2}
p(\bx=\bx_{1},\bx^{\prime}=\bx_{2})
\|f^{*}(\bx_{1})-f^{*}(\bx_{2})\|_{2}
\bx_{1}
\bx_{2}
p(\bx=\bx_{1},\bx^{\prime}=\bx_{2})
\RR^{2}
\cX
\cZ
p_{x}
p_{z}
c_{x}:\cX\times\cX\to\RR
c_{z}:\cZ\times\cZ\to\RR
D:\RR\times\RR\to\RR
GW_{p}(p_{x},p_{z}|c_{x},c_{z}):=\rbr{\inf_{\pi\in\prod(p_{x},p_{z})}\int_{\cX%
^{2}\times\cZ^{2}}D(c_{x}(x,x^{\prime}),c_{z}(z,z^{\prime}))^{p}d\pi(x,z)d\pi(%
x^{\prime},z^{\prime})}^{1/p},
\prod(p_{x},p_{z})
\cX\times\cZ
p_{x}
p_{z}
D(c_{x},c_{z})
|c_{x}-c_{z}|
c_{x}(x,x^{\prime})
\|x-x^{\prime}\|_{p}
z=f(x)
c_{z}(z_{i},z_{j})=\log(\tilde{Q}_{j|i})
\tilde{Q}
c_{x}(x_{i},x_{j})=P_{j|i}
\tilde{P}
D(c_{x},c_{z})=c_{x}\rbr{\log({c_{x}})-\log({c_{z}})}
\displaystyle GW_{1}(p_{x},p_{f(x)})\leq\EE_{x,x^{\prime}}\rbr{D(c_{x}(x,x^{%
\prime}),c_{z}(f(x),f(x^{\prime})))},
\displaystyle GW_{1}(p_{x},p_{f(x)})\leq\EE_{x,x^{\prime}}\rbr{D(c_{x}(x,x^{%
\prime}),c_{z}(f(x),f(x^{\prime})))},
p_{z}
p_{x}
t
t
t
t_{df}
\tau
t
t
t_{df}=5
t
r_{1},r_{2}
r_{1}\cap r_{2}
r_{1}\cup r_{2}
t
t
d=128
t
t
t
t
t_{df}
d_{z}
t_{df}
d_{z}
t_{df}
t_{df}
d_{z}
d_{z}
1,2,4,8
t_{df}=1
t_{df}=5
t_{df}=10
d_{z}
16,32,64,128
t_{df}=5
d_{z}=1,2,4
t
t
t_{df}
L_{\mathrm{InfoNCE}}
\tau
\tau
t_{df}
Q_{i,j}
\bz_{i}
\bz_{j}
t
\tau
t
\tau=0.5
\tau
t
\tau=5
t_{df}
\tau
t_{df}=10
\tau=5
t
1\times 10^{-4}
1\times 10^{-1}
1\times 10^{-6}
1\times 10^{-3}
t
t
t
t
t
t
t
t
t
t
t
t
l_{2}
t
t
t
t
t
t
t
t
