\mathcal{D}=\{x_{n},{y}_{n}^{(i)},v_{n}^{(i)}\}_{n=1,\cdots,D}^{i=1,\cdots,M}
{x}_{n}\in\mathbbm{R}^{H\times W\times 3}
M
\geq 1
{y}_{n}^{(1)},\cdots,{y}_{n}^{(M)}
v_{n}^{(1)},\cdots,v_{n}^{(M)}\in[0,1]
\sum_{i}v_{n}^{(i)}=1
{y}_{n}^{(i)}\in\mathcal{Y}\coloneqq\{1,\cdots,C\}^{H\times W}
C
H,W
\{{y}_{n}^{(i)},v_{n}^{(i)}\}
x_{n}
\mu_{\theta}(y\mid x)\in P_{\mathcal{Y}}
P_{\mathcal{Y}}
\ell:P_{\mathcal{Y}}\times P_{\mathcal{Y}}\to\mathbbm{R}
\mu_{\theta}(\cdot|x_{n})
x_{n}
\nu_{n}
\mathcal{D}
\min_{\theta}\frac{1}{D}\sum_{n=1}^{D}\ell(\mu_{\theta}(y\mid x_{n}),\nu_{n})%
\quad\text{where }\nu_{n}\coloneqq\sum_{i=1}^{M}v_{n}^{(i)}\delta({y_{n}^{(i)}})
\mu_{\theta}(y\mid x)
\ell
K
\{\mathcal{E}_{k}\}_{k=1}^{K}
y
x
P_{k}(y|x)
\mathcal{E}_{k}
\pi_{k}(x)
\mathcal{E}_{k}
P_{k}(y|x)
P_{k}(z_{k})
z_{k}
x
F(x,z_{k})
x
s\in\mathcal{Y}
k
\mathcal{G}(\bm{\pi}(x))
\bm{\pi}(x)=[\pi_{1}(x),\cdots,\pi_{K}(x)]
z_{k}
P_{k}(z_{k})
s
F(\cdot)
s=F(x,z_{k})\quad\text{where }k\sim\mathcal{G}(\bm{\pi}(x)),z_{k}\sim P_{k}(z_%
{k}).
K
\mathcal{E}_{k}
f_{e}(\cdot)
f_{d}(\cdot)
\{P_{k}(z_{k})\}
\{P_{k}(z_{k})=N(m_{k},\sigma_{k}I),k=1,\cdots,K\}
m_{k}\in R^{L}
I
L\times L
x
f_{e}(x)
u_{g}
f_{d}(u_{g},z_{k})
u_{g}
z_{k}
k
u_{g}\in R^{F_{1}\times H^{\prime}\times W^{\prime}}
F_{1}
H^{\prime}\times W^{\prime}
u_{d}\in R^{F_{2}\times H\times W}
z_{k}
z_{k}
\tilde{z}_{k}^{b}=w_{1}z_{k}\in R^{F_{2}}
\tilde{z}_{k}^{w}=w_{2}z_{k}\in R^{F_{2}}
\bar{u}_{d}^{k}[:,i,j]=(u_{d}[:,i,j]+\tilde{z}_{k}^{b})\cdot\tilde{z}_{k}^{w}
(i,j)\in[1,H]\times[1,W]
1\times 1
\theta_{s}
f_{e}(\cdot)
u_{g}
u_{g}
\bar{u}_{g}=\text{AvgPool}(u_{g})\in R^{F_{1}}
\bm{\pi}(x)
\theta_{\pi}
\mu_{\theta}(y\mid x)
N
\{s^{(i)}\}_{i=1}^{N}
\frac{1}{N}\sum_{i=1}^{N}\delta(s^{(i)})
S
\{s_{k}^{(i)}\}_{i=1}^{S}
k
\mu_{\theta}
\hat{\mu}_{\theta}
\hat{\mu}_{\theta}(y\mid x)=\sum_{k=1}^{K}\frac{\pi_{k}(x)}{S}\sum_{i=1}^{S}%
\delta(s_{k}^{(i)})
s_{k}^{(i)}=F(x,z_{k}^{(i)})
z_{k}^{(i)}\sim N(m_{k},\sigma_{k}I)
\sum_{i=1}^{N}u^{(i)}\delta(s^{(i)})
u^{(i)}
N
\mu_{\theta}(y\mid x_{n})
\nu_{n}
x_{n}
\mathcal{D}
\mu_{\theta}(y\mid x_{n})
\nu_{n}
c:\mathcal{Y}\times\mathcal{Y}\to\mathbbm{R}
\min_{\theta}\sum_{n=1}^{D}W_{c}({\mu}_{\theta}(y\mid x_{n}),\nu_{n})\quad%
\text{where }W_{c}(\mu,\nu)\coloneqq\inf_{\gamma\in\Pi(\mu,\nu)}\int_{\mathcal%
{Y}\times\mathcal{Y}}c(s,y)d\gamma(s,y).
\Pi(\mu,\nu)
\mathcal{Y}\times\mathcal{Y}
\mu
\nu
\hat{\mu}_{\theta}(y\mid x)=\sum_{i=1}^{N}u^{(i)}\delta(s^{(i)})
\nu=\sum_{j=1}^{M}v^{(j)}\delta({y^{(j)}})
\displaystyle\min_{\theta_{s},\theta_{\pi}}\sum_{n}\sum_{i,j}\mathbf{P}_{ij}^{%
*}c(s_{n}^{(i)}(\theta_{s}),y_{n}^{(j)})\quad\text{where }\mathbf{P^{*}}=%
\mathop{\arg\min}\limits_{\mathbf{P}\in\mathbf{U}}\sum_{i,j}\mathbf{P}_{ij}%
\mathbf{C}_{ij}
\displaystyle\min_{\theta_{s},\theta_{\pi}}\sum_{n}\sum_{i,j}\mathbf{P}_{ij}^{%
*}c(s_{n}^{(i)}(\theta_{s}),y_{n}^{(j)})\quad\text{where }\mathbf{P^{*}}=%
\mathop{\arg\min}\limits_{\mathbf{P}\in\mathbf{U}}\sum_{i,j}\mathbf{P}_{ij}%
\mathbf{C}_{ij}
\displaystyle\mathbf{U}\coloneqq\{\mathbf{P}\in\mathbbm{R}_{+}^{N\times M}:%
\mathbf{P}\mathbbm{1}_{M}=\mathbf{u}_{n}(\theta_{\pi}),\mathbf{P}^{T}\mathbbm{%
1}_{N}=\mathbf{v}_{n}\}
\displaystyle\mathbf{U}\coloneqq\{\mathbf{P}\in\mathbbm{R}_{+}^{N\times M}:%
\mathbf{P}\mathbbm{1}_{M}=\mathbf{u}_{n}(\theta_{\pi}),\mathbf{P}^{T}\mathbbm{%
1}_{N}=\mathbf{v}_{n}\}
\mathbf{C}\in\mathbbm{R}^{N\times M}
\mathbf{C}_{ij}\coloneqq c(s^{(i)},y^{(j)})
\mathbf{P}
\mathbf{U}
\mathbf{P}
\mathbf{P}
\mathbf{u}(x;{\theta_{\pi}})
\theta_{\pi}
\mathbf{P}
\displaystyle\min_{\theta_{s},\theta_{\pi}}\sum_{n}\sum_{i,j}\mathbf{P}_{ij}^{%
*}c(s_{n}^{(i)}(\theta_{s}),y_{n}^{(j)})+\beta KL(\sum_{j}\mathbf{P}^{*}_{ij}|%
|\mathbf{u}_{n}(\theta_{\pi}))
\displaystyle\min_{\theta_{s},\theta_{\pi}}\sum_{n}\sum_{i,j}\mathbf{P}_{ij}^{%
*}c(s_{n}^{(i)}(\theta_{s}),y_{n}^{(j)})+\beta KL(\sum_{j}\mathbf{P}^{*}_{ij}|%
|\mathbf{u}_{n}(\theta_{\pi}))
\displaystyle\text{where }\mathbf{P^{*}}=\mathop{\arg\min}\limits_{\mathbf{P}%
\in\mathbf{U^{\prime}}}\sum_{i,j}\mathbf{P}_{ij}\mathbf{C}_{ij}\quad\mathbf{U^%
{\prime}}\coloneqq\{\mathbf{P}\in\mathbbm{R}_{+}^{N\times M}:\mathbf{P}%
\mathbbm{1}_{M}\leq\gamma,\mathbf{P}^{T}\mathbbm{1}_{N}=\mathbf{v}_{n}\}
\displaystyle\text{where }\mathbf{P^{*}}=\mathop{\arg\min}\limits_{\mathbf{P}%
\in\mathbf{U^{\prime}}}\sum_{i,j}\mathbf{P}_{ij}\mathbf{C}_{ij}\quad\mathbf{U^%
{\prime}}\coloneqq\{\mathbf{P}\in\mathbbm{R}_{+}^{N\times M}:\mathbf{P}%
\mathbbm{1}_{M}\leq\gamma,\mathbf{P}^{T}\mathbbm{1}_{N}=\mathbf{v}_{n}\}
\beta
\gamma\in[\frac{1}{N},1]
\gamma_{0}<1
\gamma=1
128\times 128
2^{5}=32
K=4
S=4
\gamma_{0}=1/2
\beta=1
\beta=10
K=35
S=2
\gamma_{0}=1/32
\beta=1
\downarrow
\downarrow
\downarrow
\uparrow
\downarrow
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
{\dagger}
*
S=
\downarrow
\uparrow
\downarrow
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
S=16
\downarrow
\uparrow
\downarrow
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
k
\mathcal{G}(\bm{\pi})
\mathcal{D}
M
K
S
B
\eta
\beta,\gamma
\theta_{s}
\theta_{\pi}
\theta_{s},\theta_{\pi}
\{x_{n},y^{(j)}_{n},v^{(j)}_{n}\}_{j=1,\cdots,M}^{n=1,\cdots,B}
\mathcal{D}
k=1,\cdots,K
t=1,\cdots,S
\{z_{n}^{(k,t)}\}^{n=1,\cdots,B}\sim P_{k}
s_{n}^{(k,t)}\leftarrow F(x,z_{n}^{(k,t)};\theta_{s})
{n=1,\cdots,B}
u_{n}^{(k,t)}\leftarrow\frac{1}{S}\pi_{k}(x;\theta_{\pi})
{n=1,\cdots,B}
\{s_{n}^{(i)},u_{n}^{(i)}\}_{i=1,\cdots,N}
N=K\times S
\mathbf{C}_{n}
\mathbf{C}_{n}[i,j]=c({s_{n}^{(i)}},{y_{n}^{(j)}})
{n=1,\cdots,B}
\mathbf{P}^{*}_{n}
\mathbf{C}_{n},\mathbf{u}_{n},\mathbf{v}_{n},\gamma
{n=1,\cdots,B}
\ell\leftarrow\frac{1}{B}\sum_{n=1}^{B}\left(\langle\mathbf{P}^{*}_{n},\mathbf%
{C}_{n}(\theta_{s})\rangle+\beta KL(\mathbf{P}^{*}_{n}\mathbbm{1}_{M}||\mathbf%
{u}_{n}(\theta_{\pi}))\right)
\theta_{s},\theta_{\pi}\leftarrow\text{Adam}({\nabla}^{\text{soft}}\ell,\eta)
\mathbf{P^{*}}
\mathbf{P^{*}}=\mathop{\arg\min}\limits_{\mathbf{P}\in\mathbf{U^{\prime}}}\sum%
_{i,j}\mathbf{P}_{ij}\mathbf{C}_{ij}\quad\mathbf{U^{\prime}}\coloneqq\{\mathbf%
{P}\in\mathbbm{R}_{+}^{N\times M}:\mathbf{P}\mathbbm{1}_{M}\leq\gamma,\mathbf{%
P}^{T}\mathbbm{1}_{N}=\mathbf{v}_{n}\}
\gamma=1
\mathbf{U^{\prime}}\coloneqq\{\mathbf{P}\in\mathbbm{R}_{+}^{N\times M}:\mathbf%
{P}^{T}\mathbbm{1}_{N}=\mathbf{v}_{n}\}
O(N)
\gamma<1
\mathbf{P}\mathbbm{1}_{M}\leq\gamma
O(NMlog(N))
\sum_{j}\mathbf{P}^{*}_{ij}
\mathbf{P}^{*}
g_{1},\cdots,g_{G}
k,k^{\prime}
(s^{k},s^{k^{\prime}})\geq G_{0}
s^{k}\coloneqq\frac{1}{S}\sum_{t}s^{k,t}
k\in[K]
G_{0}
\ell
\{s^{(i)},u^{(i)}\}_{i=1}^{N}
\mathbf{P}^{*}
G_{0}
{\nabla}^{\text{soft}}_{\mathbf{u}}\ell
g_{1},\cdots,g_{G}\leftarrow\text{Clustering}(\mathbf{s},G_{0})
\mathbf{o}\leftarrow\mathbf{P}^{*}\mathbbm{1}_{M}
m\in 1\cdots G
{\bar{u}}^{(m)}\leftarrow\frac{1}{|g_{m}|}\sum_{i\in{g_{m}}}u^{(i)}
{\bar{o}}^{(m)}\leftarrow\frac{1}{|g_{m}|}\sum_{i\in g_{m}}o^{(i)}
{\nabla}^{\text{soft}}_{u^{(i)}}\ell(u^{(i)},o^{(i)})\leftarrow{\nabla}_{{\bar%
{u}}^{(m)}}\ell({\bar{u}}^{(m)},{\bar{o}}^{(m)})\quad(i\in g_{m})
{\nabla}^{\text{soft}}_{\mathbf{u}}\ell
u_{g}\in R^{F_{1}\times H^{\prime}\times W^{\prime}}
F_{1}=192
u_{d}\in R^{F_{2}\times H\times W}
F_{2}=32.
\mathbf{v}
1e^{-5}
1e^{-3}
\gamma
\hat{y}
s
d(\cdot)
\mathcal{D}^{2}_{GED}(\mu,\nu)\coloneqq 2E_{\hat{y}\sim\mu,y\sim\nu}[d(\hat{y}%
,y)]-E_{y,y^{\prime}\sim\nu}[d(y,y^{\prime})]-E_{\hat{y},\hat{y}^{\prime}\sim{%
\mu}}[d(\hat{y},\hat{y}^{\prime})].
\mathbf{P}
\mathcal{W}_{IoU}(\mu,\nu)\coloneqq\max_{\mathbf{P}}\sum_{i,j}\mathbf{P}_{i,j}%
\text{IoU}(\hat{y}_{i},y_{j})\quad\text{s.t. }\mathbf{P}\mathbbm{1}_{M}=%
\mathbf{u},\mathbf{P}^{T}\mathbbm{1}_{N}=\mathbf{v}.
\mathbf{P}
\mathbf{P}
\text{ECE}\coloneqq E_{\hat{P}}\left[\left|P(\hat{Y}=Y|\hat{P}=p)-p\right|\right]
Y
\hat{Y}
\hat{P}
\theta_{s}
\{P,\theta_{\pi}\}
\theta_{s}
\{P,\theta_{\pi}\}
{l_{1}(u,P)=\langle P,C\rangle\quad u\in\mathbb{A},P\in\mathbb{B}(u)=\{P\in%
\mathbb{R}^{+}:P\mathbf{1}_{M}=u,P^{T}\mathbf{1}_{N}=v\}.}
{l_{2}(u,P)=\langle P,C\rangle+\beta KL(P\mathbf{1}_{M}||u)\quad u\in\mathbb{A%
},P\in\mathbb{C}=\{P\in\mathbb{R}^{+}:P^{T}\mathbf{1}_{N}=v\}.}
C
C(s(\theta_{s}),y)
u
u(\theta_{\pi})
\mathbb{A}
u
u\in\mathbb{R}^{+},\sum_{i}u_{i}=1
l_{2}
\beta
l_{2}
l_{1}
\theta_{s}
P
\beta
l_{2}
l_{1}
\Omega_{1}
\Omega_{2}
l_{1}
l_{2}
\Omega_{1}\subseteq\Omega_{2}
\Omega_{c}=\Omega_{2}-\Omega_{1}
P^{*},u^{*}=\operatorname*{arg\,min}_{P,u\in\Omega_{1}}l_{1}
\hat{P},\hat{u}=\operatorname*{arg\,min}_{P,u\in\Omega_{2}}l_{2}.
P^{*},u^{*}\in\Omega_{1}
\hat{P},\hat{u}\in\Omega_{1}
\hat{P}\mathbf{1}_{M}=\hat{u}
l_{2}
l_{1}(P^{*},u^{*})\leq l_{1}(\hat{P},\hat{u})=l_{2}(\hat{P},\hat{u})\leq l_{2}%
(P^{*},u^{*})=l_{1}(P^{*},u^{*})
l_{1}(\hat{P},\hat{u})=l_{1}(P^{*},u^{*})=\operatorname*{arg\,min}_{\quad P,u%
\in\Omega_{1}}l_{1}(P,u)
l_{2}
l_{1}
P^{*},u^{*}\in\Omega_{1}
\hat{P},\hat{u}\in\Omega_{c}
KL(P\mathbf{1}_{M}||u)>0
\mathbb{A}
u
\hat{P}\mathbf{1}_{M}\in\mathbb{A}
\hat{P},{u^{\prime}}\in\Omega_{1}
u^{\prime}=\hat{P}\mathbf{1}_{M}
l_{2}({P}^{*},u^{*})\leq l_{2}(\hat{P},u^{\prime})<l_{2}(\hat{P},\hat{u})
\hat{P},\hat{u}
\hat{P}\mathbf{1}_{M}\notin\mathbb{A}
\beta
\langle\hat{P},C\rangle+\beta KL(\hat{P}\mathbf{1}_{M}||\hat{u})>\langle{P}^{*%
},C\rangle+0=\langle{P}^{*},C\rangle+\beta KL({P}^{*}\mathbf{1}_{M}||{u}^{*})
\hat{P},\hat{u}
\beta
l_{2}
\Omega_{1}
l_{1}
\bar{P}=
\operatorname*{arg\,min}_{P\in\mathbb{C}}\langle P,C\rangle
\bar{u}
=\operatorname*{arg\,min}_{{u}\in\mathbb{A}}KL(P\mathbf{1}_{M}||u)
\bar{P},\bar{u}
l_{2}
l_{1}
\bar{P}=
\operatorname*{arg\,min}_{P\in\mathbb{C}}\langle P,C\rangle
\bar{u}
=\operatorname*{arg\,min}_{{u}\in\mathbb{A}}KL(\bar{P}\mathbf{1}_{M}||u)
l_{2}
l_{1}
KL(\bar{P}\mathbf{1}_{M}||\bar{u})=0
\bar{P},\bar{u}\in\Omega_{1}
\mathbb{B}=\{P\in\mathbb{R}^{+}:P\mathbf{1}_{M}=u,P^{T}\mathbf{1}_{N}=v\}
\mathbb{C}=\{P\in\mathbb{R}^{+}:P^{T}\mathbf{1}_{N}=v\}
\mathbb{B}\subseteq\mathbb{C}
\operatorname*{arg\,min}_{P\in\mathbb{C}}\langle{P},C\rangle\leq\operatorname*%
{arg\,min}_{P\in\mathbb{B}}\langle{P},C\rangle
l_{2}(P^{*},u^{*})\leq l_{2}(\bar{P},\bar{u})=l_{1}(\bar{P},\bar{u})\leq l_{1}%
(P^{*},u^{*})
KL({P}^{*}\mathbf{1}_{M}||{u}^{*})=0
l_{2}(P^{*},u^{*})=l_{1}(P^{*},u^{*})
\bar{P},\bar{u}
l_{1},l_{2}
\uparrow
\uparrow
\downarrow
\downarrow
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\downarrow
\downarrow
\uparrow
\uparrow
\downarrow
\downarrow
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\downarrow
\uparrow
\downarrow
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\downarrow
\uparrow
\downarrow
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\downarrow
\uparrow
\downarrow
\pm
\pm
\pm
\pm
\pm
\pm
\downarrow
\uparrow
\downarrow
S=35
(1-\frac{4}{17})\approx 0.76
\downarrow
\uparrow
\downarrow
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
