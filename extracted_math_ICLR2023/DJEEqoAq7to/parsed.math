7.5\times
20\times
3\%
20\times
50\times
40
90\%
10\%
90\%
20\times
20\times
50\times
90\%
{\dagger}
{\dagger}
\sim 99\%
\sim 99\%
\sim 95\%
\sim 95\%
\sim 70\%
\sim 50\%
\sim 90\%
\mathbf{\sim 95\%}
50\%
\mathcal{M}=\langle\mathcal{S},\mathcal{A},r,\mathbb{P},\gamma\rangle
\mathcal{S}
\mathcal{A}
r
\mathbb{P}
\gamma
t
s_{t}\in\mathcal{S}
a_{t}\in\mathcal{A}
\pi:\mathcal{S}\rightarrow\mathcal{A}
r(s_{t},a_{t})
\pi
(s,a)
\displaystyle Q_{\pi}(s,a)=\mathbb{E}_{\pi}\left[\sum_{i=t}^{T}\gamma^{i-t}r(s%
_{i},a_{i})|s_{t}=s,a_{t}=a\right].
\displaystyle Q_{\pi}(s,a)=\mathbb{E}_{\pi}\left[\sum_{i=t}^{T}\gamma^{i-t}r(s%
_{i},a_{i})|s_{t}=s,a_{t}=a\right].
\pi(s;\phi)
\phi
Q(s,a;\theta)
\theta
\pi^{*}(s;\phi^{*})
J^{*}=\max_{\phi}\mathbb{E}_{\pi(\phi)}[\sum_{i=0}^{T}\gamma^{i-t}r(s_{i},a_{i%
})|s_{0},a_{0}]
\mathcal{T}_{1}
Q(s,a;\theta^{\prime})
\mathcal{T}_{1}=r(s,a)+\gamma Q\left(s^{\prime},a^{\prime};\theta^{\prime}\right)
(s,a)
a^{\prime}=\pi(s^{\prime};\phi)
\displaystyle\mathcal{L}(\theta)=\mathbb{E}_{\pi(\phi)}\left[Q(s,a;\theta)-%
\mathcal{T}_{1}\right]^{2}.
\displaystyle\mathcal{L}(\theta)=\mathbb{E}_{\pi(\phi)}\left[Q(s,a;\theta)-%
\mathcal{T}_{1}\right]^{2}.
\pi(s;\phi)
\nabla_{\phi}J(\phi)=\mathbb{E}_{\pi(\phi)}\left[\left.\nabla_{a}Q_{\pi}(s,a;%
\theta)\right|_{a=\pi(s;\phi)}\nabla_{\phi}\pi(s;\phi)\right].
Q^{*}
Q^{*}
Q^{*}
Q^{*}
\odot
M_{\theta}
\theta
\zeta_{t}=\frac{\zeta_{0}}{2}(1+\cos(\frac{\pi t}{T_{\text{end}}}))
\zeta_{0}
T_{\text{end}}
k
O((1-s)N\log N))
s
10000
N_{l}
l
\theta_{l}
l
M_{\theta_{l}}
l
s_{l}
l
L
\zeta_{t}
t
l
k=\zeta_{t}(1-s_{l})N_{l}
\mathbb{I}_{\text{drop}}=\text{ArgTopK}(-|\theta_{l}\odot M_{\theta_{l}}|,k)
\mathbb{I}_{\text{grow}}=\text{ArgTopK}_{i\notin\theta_{l}\odot M_{\theta_{l}}%
\backslash\mathbb{I}_{\text{drop}}}(|\nabla_{\theta_{l}}L,k|)
M_{\theta_{l}}
\mathbb{I}_{\text{drop}}
\mathbb{I}_{\text{grow}}
\theta_{l}\leftarrow\theta_{l}\odot M_{\theta_{l}}
\mathcal{T}_{1}=r_{t}+\gamma Q(s_{t+1},\pi(s_{t+1});\theta)
\widehat{\theta}=\theta\odot M_{\theta}
\theta
\widehat{\theta}
\epsilon(s,a)=Q(s,a;{\theta})-Q_{\pi}(s,a)
\mathcal{T}_{n}=\sum_{k=0}^{n-1}\gamma^{k}r_{t+k}+\gamma^{n}Q(s_{t+n},\pi(s_{t%
+n});\theta)
N
N
\mathcal{T}_{n}
Q_{\pi}
\pi
b
\displaystyle\mathbb{E}_{b}[\mathcal{T}_{n}(s,a)]-Q_{\pi}(s,a)=\underbrace{%
\left(\mathbb{E}_{b}[\mathcal{T}_{n}(s,a)]-\mathbb{E}_{\pi}[\mathcal{T}_{n}(s,%
a)]\right)}_{\text{Policy inconsistency error}}+\gamma^{n}\underbrace{\mathbb{%
E}_{\pi}[\epsilon(s_{n},\pi(s_{n}))]}_{\text{Network fitting error}}
\displaystyle\mathbb{E}_{b}[\mathcal{T}_{n}(s,a)]-Q_{\pi}(s,a)=\underbrace{%
\left(\mathbb{E}_{b}[\mathcal{T}_{n}(s,a)]-\mathbb{E}_{\pi}[\mathcal{T}_{n}(s,%
a)]\right)}_{\text{Policy inconsistency error}}+\gamma^{n}\underbrace{\mathbb{%
E}_{\pi}[\epsilon(s_{n},\pi(s_{n}))]}_{\text{Network fitting error}}
\gamma^{n}
r_{t},r_{t+1},\cdots,r_{t+n}
\pi
b
\widehat{\mathcal{L}}(\theta)
\mathcal{B}_{t}
\displaystyle\widehat{\mathcal{L}}(\theta)=\frac{1}{|\mathcal{B}_{t}|}\sum_{(s%
_{i},a_{i})\sim\mathcal{B}_{t}}(Q(s_{i},a_{i};\theta)-{\cal{T}})^{2}
\displaystyle\widehat{\mathcal{L}}(\theta)=\frac{1}{|\mathcal{B}_{t}|}\sum_{(s%
_{i},a_{i})\sim\mathcal{B}_{t}}(Q(s_{i},a_{i};\theta)-{\cal{T}})^{2}
\mathcal{B}_{t}
\mathcal{D}(\mathcal{B},\phi)=\frac{1}{K}\sum_{(s_{i},a_{i})\in\text{OldK}(%
\mathcal{B})}\parallel\pi(s_{i};\phi)-a_{i}\parallel_{2},
\mathcal{B}
\text{OldK}(\mathcal{B})
K
\mathcal{B}
\pi(\cdot;\phi)
K
\mathcal{D}(\mathcal{B},\phi)
\Delta_{b}
\mathcal{D}(\mathcal{B},\phi)
D_{0}
\mathcal{B}
\mathcal{D}
D_{0}
\pm\%3
30
5000
3\%
7.5\times
25\times
25\times
96\%
85\%
95\%
5\times
20\times
12\times
20\times
7\times
12\times
\cdot
3
7.5\times
20\times
3\%
20\times
50\times
l
l
n^{(in)}
\mathbf{x}
n^{(out)}
\mathbf{y}
N=n^{(in)}\times n^{(out)}
\theta\in\mathbb{R}^{n^{(out)}\times n^{(in)}}
M_{\theta}\in\mathbb{\{}0,1\}^{n^{(out)}\times n^{(in)}}
n^{(out)}\times n^{(in)}
\theta
\mathbf{x}
s
1
N
s
\theta
M_{\theta}
\Theta((1-s)N)
O((1-s)N+n^{(in)}+n^{(out)})
\theta
O((1-s)N\log N)
K
L
l
l
O((1-s)N+n^{(in)}+n^{(out)})
\mathbf{g}^{(x)}:=\frac{\partial L}{\partial\mathbf{x}}
\mathbf{g}^{(y)}:=\frac{\partial L}{\partial\mathbf{y}}
\mathbf{g}^{(\theta)}:=\frac{\partial L}{\partial\theta}
\theta
(1-s)N
\mathbf{g}^{(\theta)}
(1-s)N
K
N
\theta_{ji}
i
j
L
\theta_{ji}
g^{(\theta)}_{ji}:=\frac{\partial L}{\partial\theta_{ji}}=\frac{\partial L}{%
\partial y_{j}}\frac{y_{j}}{\partial\theta_{ji}}=g^{(y)}_{j}x_{i}.
n^{(out)}\times n^{(in)}
\mathbf{g}^{(\theta)}
\mathbf{g}^{(y)}\mathbf{x}^{T}
K
n^{(out)}
O(n^{(out)}+n^{(in)}+\lvert U\rvert+(1-s)N)
S
U
O(\log N)
O((1-s)N\log N)
\mathbf{x}
\mathbf{g}^{(y)}
S_{0}
N
s
U
S
\lvert S\rvert=(1-s)N
S\supseteq S_{0}
S\cap U=\emptyset
S\leftarrow S_{0}
\lvert x\rvert
\sigma_{1},\ldots,\sigma_{n^{(in)}}
\lvert x_{\sigma_{1}}\rvert\geq\lvert x_{\sigma_{2}}\rvert\geq\cdots\geq\lvert
x%
_{\sigma_{n^{(in)}}}\rvert
H
3
j=1\ldots n^{(out)}
(\lvert g^{(y)}_{j}x_{\sigma_{1}}\rvert,j,1)
H
\lvert S\rvert<(1-s)N
(w,j,i)
H
(j,\sigma_{i})\notin S
(j,\sigma_{i})\notin U
S\leftarrow S\cup(j,\sigma_{i})
i<n^{(in)}
(\lvert g^{(y)}_{j}x_{\sigma_{i+1}}\rvert,j,i+1)
H
S
p_{\pi}(s_{t+1},a_{t+1},\cdots,s_{t+n},a_{t+n}|s_{t},a_{t})
s_{t}
a_{t}
\pi
\mathbb{E}_{\pi}
\mathbb{E}_{(s_{t+1},a_{t+1},\cdots,s_{t+n},a_{t+n})\sim p_{\pi}(\cdot|s_{t},a%
_{t})}
\mathbb{E}_{b}
\mathbb{E}_{(s_{t+1},a_{t+1},\cdots,s_{t+n},a_{t+n})\sim p_{b}(\cdot|s_{t},a_{%
t})}
\pi
b
Q_{\pi}(s,a)
\pi
Q_{\pi}(s,a)=\mathbb{E}_{\pi}\left[\sum_{i=t}^{T}\gamma^{i-t}r\left(s_{i},a_{i%
}\right)|s_{t}=s,a_{t}=a\right]
\epsilon(s,a)
\epsilon(s,a)=Q(s,a;{\theta})-Q_{\pi}(s,a)
\displaystyle\mathbb{E}_{b}[{\cal{T}}_{n}(s_{t},a_{t})]-Q_{\pi}(s_{t},a_{t})
\displaystyle\mathbb{E}_{b}[{\cal{T}}_{n}(s_{t},a_{t})]-Q_{\pi}(s_{t},a_{t})
\displaystyle=\,\mathbb{E}_{b}[\sum_{k=0}^{n-1}\gamma^{k}r_{t+k}+\gamma^{n}Q(s%
_{t+n},\pi(s_{t+n});\theta)]-\mathbb{E}_{\pi}[\sum_{k=0}^{n-1}\gamma^{k}r_{t+k%
}+\gamma^{n}Q_{\pi}(s_{t+n},\pi(s_{t+n}))]
\displaystyle=
\displaystyle\,\mathbb{E}_{b}[\sum_{k=0}^{n-1}\gamma^{k}r_{t+k}+\gamma^{n}Q(s_%
{t+n},\pi(s_{t+n});\theta)]-\mathbb{E}_{\pi}[\sum_{k=0}^{n-1}\gamma^{k}r_{t+k}%
+\gamma^{n}Q_{\pi}(s_{t+n},\pi(s_{t+n}))]
\displaystyle=\,\mathbb{E}_{b}[\sum_{k=0}^{n-1}\gamma^{k}r_{t+k}+\gamma^{n}Q(s%
_{t+n},\pi(s_{t+n});\theta)]-\mathbb{E}_{\pi}[\sum_{k=0}^{n-1}\gamma^{k}r_{t+k%
}+\gamma^{n}Q(s_{t+n},\pi(s_{t+n});\theta)]
\displaystyle=
\displaystyle\,\mathbb{E}_{b}[\sum_{k=0}^{n-1}\gamma^{k}r_{t+k}+\gamma^{n}Q(s_%
{t+n},\pi(s_{t+n});\theta)]-\mathbb{E}_{\pi}[\sum_{k=0}^{n-1}\gamma^{k}r_{t+k}%
+\gamma^{n}Q(s_{t+n},\pi(s_{t+n});\theta)]
\displaystyle+\mathbb{E}_{\pi}[\gamma^{n}(Q(s_{t+n},\pi(s_{t+n});\theta)-Q_{%
\pi}(s_{t+n},\pi(s_{t+n})))]
\displaystyle+\mathbb{E}_{\pi}[\gamma^{n}(Q(s_{t+n},\pi(s_{t+n});\theta)-Q_{%
\pi}(s_{t+n},\pi(s_{t+n})))]
\displaystyle=\,(\mathbb{E}_{b}[{\cal{T}}_{n}(s_{t},a_{t})]-\mathbb{E}_{\pi}[{%
\cal{T}}_{n}(s_{t},a_{t})])+\gamma^{n}\mathbb{E}_{\pi}[\epsilon(s_{t+n},\pi(s_%
{t+n}))].
\displaystyle=
\displaystyle\,(\mathbb{E}_{b}[{\cal{T}}_{n}(s_{t},a_{t})]-\mathbb{E}_{\pi}[{%
\cal{T}}_{n}(s_{t},a_{t})])+\gamma^{n}\mathbb{E}_{\pi}[\epsilon(s_{t+n},\pi(s_%
{t+n}))].
\mathbb{E}_{\pi}[\gamma^{n}(Q(s_{t+n},a_{t+n};\theta))]
\mathcal{T}_{n}(s,a)
\epsilon(s,a)
\Delta_{b}
B_{\text{min}}
B_{\text{max}}
B_{\text{min}}
B_{\text{max}}
(B_{\text{min}},B_{\text{max}})
D_{0}
\pi
{\cal{B}}
t
\Delta_{b}
D_{0}
\rho
B_{\text{min}},B_{\text{max}}
t
{\cal{B}}
{\cal{B}}
t
\Delta_{b}=0
|\mathcal{B}|\in(B_{\text{min}},B_{\text{max}})
(s_{i},a_{i})
\mathcal{D}(\pi)>D_{0}
{\cal{B}}\leftarrow
\rho
{\cal{B}}
p(s^{\prime}|s,a)
\rho_{\pi,t}^{(s)}
t
\pi
\rho_{\pi,t}^{(s,a)}
t
\pi
\mu_{\pi}(\tau)
\tau=(s_{t},a_{t},s_{t+1},\cdots,s_{t+n},a_{t+n})
\pi
d_{\pi}
\pi
d_{\pi}(s)=\sum_{t=0}^{\infty}\gamma^{t}\text{Pr}(s_{t}=s),a_{t}\sim\pi(\cdot|%
s_{t})
D_{\text{KL}}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},a_{t}))=\sum_{%
k=1}^{n}\mathbb{E}_{s_{t+k}\sim\rho_{b,t+k}^{(s)}}D_{\text{KL}}(b(\cdot|s_{t+k%
})||\pi(\cdot|s_{t+k}))
\displaystyle\mu_{\pi}(\tau|s_{t},a_{t})=\prod_{k=1}^{n}\pi(a_{t+k}|s_{t+k})p(%
s_{t+k}|s_{t+k-1},a_{t+k-1}).
\displaystyle\mu_{\pi}(\tau|s_{t},a_{t})=\prod_{k=1}^{n}\pi(a_{t+k}|s_{t+k})p(%
s_{t+k}|s_{t+k-1},a_{t+k-1}).
\displaystyle D_{KL}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},a_{t}))%
=\sum_{\tau}\mu_{b}(\tau|s_{t},a_{t})\log\dfrac{\mu_{b}(\tau|s_{t},a_{t})}{\mu%
_{\pi}(\tau|s_{t},a_{t})}
\displaystyle D_{KL}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},a_{t}))=
\displaystyle\sum_{\tau}\mu_{b}(\tau|s_{t},a_{t})\log\dfrac{\mu_{b}(\tau|s_{t}%
,a_{t})}{\mu_{\pi}(\tau|s_{t},a_{t})}
\displaystyle=\sum_{\tau}\left[\mu_{b}(\tau|s_{t},a_{t})\log\dfrac{\prod_{k=1}%
^{n}b(a_{t+k}|s_{t+k})}{\prod_{k=1}^{n}\pi(a_{t+k}|s_{t+k})}\right]
\displaystyle=
\displaystyle\sum_{\tau}\left[\mu_{b}(\tau|s_{t},a_{t})\log\dfrac{\prod_{k=1}^%
{n}b(a_{t+k}|s_{t+k})}{\prod_{k=1}^{n}\pi(a_{t+k}|s_{t+k})}\right]
\displaystyle=\sum_{k=1}^{n}\sum_{\tau}[\mu_{b}(\tau)\log\dfrac{b(a_{t+k}|s_{t%
+k})}{\pi(a_{t+k}|s_{t+k})}].
\displaystyle=
\displaystyle\sum_{k=1}^{n}\sum_{\tau}[\mu_{b}(\tau)\log\dfrac{b(a_{t+k}|s_{t+%
k})}{\pi(a_{t+k}|s_{t+k})}].
\displaystyle\mathbb{E}_{\tau\sim\mu_{b}(\cdot)}[\log\dfrac{\mu_{b}(\tau|s_{t}%
,a_{t})}{\mu_{\pi}(\tau|s_{t},a_{t})}]=\mathbb{E}_{(s_{t+k},a_{t+k})\sim\rho_{%
b,t}^{(s,a)}(\cdot)}[\log\dfrac{\mu_{b}(\tau|s_{t},a_{t})}{\mu_{\pi}(\tau|s_{t%
},a_{t})}],
\displaystyle\mathbb{E}_{\tau\sim\mu_{b}(\cdot)}[\log\dfrac{\mu_{b}(\tau|s_{t}%
,a_{t})}{\mu_{\pi}(\tau|s_{t},a_{t})}]=\mathbb{E}_{(s_{t+k},a_{t+k})\sim\rho_{%
b,t}^{(s,a)}(\cdot)}[\log\dfrac{\mu_{b}(\tau|s_{t},a_{t})}{\mu_{\pi}(\tau|s_{t%
},a_{t})}],
\displaystyle D_{KL}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},a_{t}))%
=\sum_{k=1}^{n}\sum_{(s_{t+k},a_{t+k})}\rho_{b,t+k}^{(s,a)}\log\dfrac{b(a_{t+k%
}|s_{t+k})}{\pi(a_{t+k}|s_{t+k})}
\displaystyle D_{KL}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},a_{t}))=
\displaystyle\sum_{k=1}^{n}\sum_{(s_{t+k},a_{t+k})}\rho_{b,t+k}^{(s,a)}\log%
\dfrac{b(a_{t+k}|s_{t+k})}{\pi(a_{t+k}|s_{t+k})}
\displaystyle=\sum_{k=1}^{n}\mathbb{E}_{s_{t+k}\sim\rho_{b,t+k}^{(s)}}D_{\text%
{KL}}(b(\cdot|s_{t+k})||\pi(\cdot|s_{t+k})).
\displaystyle=
\displaystyle\sum_{k=1}^{n}\mathbb{E}_{s_{t+k}\sim\rho_{b,t+k}^{(s)}}D_{\text{%
KL}}(b(\cdot|s_{t+k})||\pi(\cdot|s_{t+k})).
\displaystyle|\mathbb{E}_{b}[\mathcal{T}_{n}]-\mathbb{E}_{\pi}[\mathcal{T}_{n}%
]|\leq(\frac{1-\gamma^{n}}{1-\gamma}r_{m}+\gamma^{n}Q_{m})\sqrt{\frac{1}{2}%
\sum_{k=1}^{n}\mathbb{E}_{s\sim\rho_{b,t}^{(s)}(\cdot)}D_{\text{KL}}(b(\cdot|s%
)||\pi(\cdot|s))},
\displaystyle|\mathbb{E}_{b}[\mathcal{T}_{n}]-\mathbb{E}_{\pi}[\mathcal{T}_{n}%
]|\leq(\frac{1-\gamma^{n}}{1-\gamma}r_{m}+\gamma^{n}Q_{m})\sqrt{\frac{1}{2}%
\sum_{k=1}^{n}\mathbb{E}_{s\sim\rho_{b,t}^{(s)}(\cdot)}D_{\text{KL}}(b(\cdot|s%
)||\pi(\cdot|s))},
r_{m}=\sup r-\inf r,Q_{m}=\sup Q(s,a;\theta)-\inf Q(s,a;\theta)
\displaystyle|\mathbb{E}_{b}[\mathcal{T}_{n}]-\mathbb{E}_{\pi}[\mathcal{T}_{n}%
]|=|\mathbb{E}_{\tau\sim\mu_{b}(\cdot|s_{t},a_{t})}[\mathcal{T}_{n}]-\mathbb{E%
}_{\tau\sim\mu_{\pi}(\cdot|s_{t},a_{t})}[\mathcal{T}_{n}]|
\displaystyle|\mathbb{E}_{b}[\mathcal{T}_{n}]-\mathbb{E}_{\pi}[\mathcal{T}_{n}%
]|=
\displaystyle|\mathbb{E}_{\tau\sim\mu_{b}(\cdot|s_{t},a_{t})}[\mathcal{T}_{n}]%
-\mathbb{E}_{\tau\sim\mu_{\pi}(\cdot|s_{t},a_{t})}[\mathcal{T}_{n}]|
\displaystyle\leq(\sup\mathcal{T}_{n}-\inf\mathcal{T}_{n})D_{\text{TV}}(\mu_{b%
}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},a_{t})).
\displaystyle\leq
\displaystyle(\sup\mathcal{T}_{n}-\inf\mathcal{T}_{n})D_{\text{TV}}(\mu_{b}(%
\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},a_{t})).
\displaystyle D_{\text{TV}}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},%
a_{t}))\leq\sqrt{\frac{D_{\text{KL}}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(%
\cdot|s_{t},a_{t}))}{2}}.
\displaystyle D_{\text{TV}}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},%
a_{t}))\leq\sqrt{\frac{D_{\text{KL}}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(%
\cdot|s_{t},a_{t}))}{2}}.
\displaystyle|\mathbb{E}_{b}[\mathcal{T}_{n}]-\mathbb{E}_{\pi}[\mathcal{T}_{n}%
]|\leq(\sum_{k=0}^{n-1}\gamma^{k}r_{m}+\gamma^{n}Q_{m})\sqrt{\frac{D_{\text{KL%
}}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},a_{t}))}{2}}.
\displaystyle|\mathbb{E}_{b}[\mathcal{T}_{n}]-\mathbb{E}_{\pi}[\mathcal{T}_{n}%
]|\leq
\displaystyle(\sum_{k=0}^{n-1}\gamma^{k}r_{m}+\gamma^{n}Q_{m})\sqrt{\frac{D_{%
\text{KL}}(\mu_{b}(\cdot|s_{t},a_{t})||\mu_{\pi}(\cdot|s_{t},a_{t}))}{2}}.
\displaystyle|\mathbb{E}_{b}[\mathcal{T}_{n}]-\mathbb{E}_{\pi}[\mathcal{T}_{n}%
]|\leq(\frac{1-\gamma^{n}}{1-\gamma}r_{m}+\gamma^{n}Q_{m})\sqrt{\frac{1}{2}%
\sum_{k=1}^{n}\mathbb{E}_{s\sim\rho_{b,t}^{(s)}(\cdot)}D_{\text{KL}}(b(\cdot|s%
)||\pi(\cdot|s))}.
\displaystyle|\mathbb{E}_{b}[\mathcal{T}_{n}]-\mathbb{E}_{\pi}[\mathcal{T}_{n}%
]|\leq
\displaystyle(\frac{1-\gamma^{n}}{1-\gamma}r_{m}+\gamma^{n}Q_{m})\sqrt{\frac{1%
}{2}\sum_{k=1}^{n}\mathbb{E}_{s\sim\rho_{b,t}^{(s)}(\cdot)}D_{\text{KL}}(b(%
\cdot|s)||\pi(\cdot|s))}.
\mathcal{L}(\theta)
\hat{\mathcal{L}}(\theta)
\pi
b
\displaystyle|\mathcal{L}(\theta)-\hat{\mathcal{L}}(\theta)|\leq\frac{2\gamma}%
{1-\gamma}\Delta\mathbb{E}_{s\sim d_{b}}\left[\sqrt{\frac{1}{2}D_{\text{KL}}(%
\pi(\cdot|s),b(\cdot|s))}\right],
\displaystyle|\mathcal{L}(\theta)-\hat{\mathcal{L}}(\theta)|\leq\frac{2\gamma}%
{1-\gamma}\Delta\mathbb{E}_{s\sim d_{b}}\left[\sqrt{\frac{1}{2}D_{\text{KL}}(%
\pi(\cdot|s),b(\cdot|s))}\right],
\Delta=\sup|(Q(s,a;\theta)-\mathcal{T}(s,a))^{2}|
\displaystyle\mathcal{L}(\theta)=\mathbb{E}_{(s_{i},a_{i})\sim d_{\pi}}[(Q(s_{%
i},a_{i};\theta)-\mathcal{T}(s_{i},a_{i}))^{2}],\hat{\mathcal{L}}(\theta)=%
\mathbb{E}_{(s_{i},a_{i})\sim d_{b}}[(Q(s_{i},a_{i};\theta)-\mathcal{T}(s_{i},%
a_{i}))^{2}].
\displaystyle\mathcal{L}(\theta)=\mathbb{E}_{(s_{i},a_{i})\sim d_{\pi}}[(Q(s_{%
i},a_{i};\theta)-\mathcal{T}(s_{i},a_{i}))^{2}],\hat{\mathcal{L}}(\theta)=%
\mathbb{E}_{(s_{i},a_{i})\sim d_{b}}[(Q(s_{i},a_{i};\theta)-\mathcal{T}(s_{i},%
a_{i}))^{2}].
\displaystyle\Delta=\sup|(Q(s,a;\theta)-\mathcal{T}(s,a))^{2}|.
\displaystyle\Delta=\sup|(Q(s,a;\theta)-\mathcal{T}(s,a))^{2}|.
\displaystyle|\mathcal{L}(\theta)-\hat{\mathcal{L}}(\theta)|=|\mathbb{E}_{(s_{%
i},a_{i})\sim d_{b}}[(Q(s_{i},a_{i};\theta)-\mathcal{T}(s_{i},a_{i}))^{2}]-%
\mathbb{E}_{(s_{i},a_{i})\sim d_{\pi}}[(Q(s_{i},a_{i};\theta)-\mathcal{T}(s_{i%
},a_{i}))^{2}]|
\displaystyle|\mathcal{L}(\theta)-\hat{\mathcal{L}}(\theta)|=
\displaystyle|\mathbb{E}_{(s_{i},a_{i})\sim d_{b}}[(Q(s_{i},a_{i};\theta)-%
\mathcal{T}(s_{i},a_{i}))^{2}]-\mathbb{E}_{(s_{i},a_{i})\sim d_{\pi}}[(Q(s_{i}%
,a_{i};\theta)-\mathcal{T}(s_{i},a_{i}))^{2}]|
\displaystyle\leq 2D_{\text{TV}}(d_{\pi},d_{b})\Delta,
\displaystyle\leq
\displaystyle 2D_{\text{TV}}(d_{\pi},d_{b})\Delta,
\displaystyle D_{\text{TV}}(d_{\pi},d_{b})\leq\frac{\gamma}{1-\gamma}\mathbb{E%
}_{s\sim d_{b}}[D_{\text{TV}}(\pi(\cdot|s),b(\cdot|s))].
\displaystyle D_{\text{TV}}(d_{\pi},d_{b})\leq\frac{\gamma}{1-\gamma}\mathbb{E%
}_{s\sim d_{b}}[D_{\text{TV}}(\pi(\cdot|s),b(\cdot|s))].
\displaystyle|\mathcal{L}(\theta)-\hat{\mathcal{L}}(\theta)|\leq\frac{2\gamma}%
{1-\gamma}\Delta\mathbb{E}_{s\sim d_{b}}[D_{\text{TV}}(\pi(\cdot|s),b(\cdot|s)%
)].
\displaystyle|\mathcal{L}(\theta)-\hat{\mathcal{L}}(\theta)|\leq
\displaystyle\frac{2\gamma}{1-\gamma}\Delta\mathbb{E}_{s\sim d_{b}}[D_{\text{%
TV}}(\pi(\cdot|s),b(\cdot|s))].
\displaystyle|\mathcal{L}(\theta)-\hat{\mathcal{L}}(\theta)|\leq\frac{2\gamma}%
{1-\gamma}\Delta\mathbb{E}_{s\sim d_{b}}[\sqrt{\frac{1}{2}D_{\text{KL}}(\pi(%
\cdot|s),b(\cdot|s))}].
\displaystyle|\mathcal{L}(\theta)-\hat{\mathcal{L}}(\theta)|\leq
\displaystyle\frac{2\gamma}{1-\gamma}\Delta\mathbb{E}_{s\sim d_{b}}[\sqrt{%
\frac{1}{2}D_{\text{KL}}(\pi(\cdot|s),b(\cdot|s))}].
L
\displaystyle(1-S)\sum_{l}I_{l}O_{l}=\sum_{l=1}^{L}(1-S_{l})I_{l}O_{l},
\displaystyle(1-S)\sum_{l}I_{l}O_{l}
\displaystyle=\sum_{l=1}^{L}(1-S_{l})I_{l}O_{l},
\displaystyle 1-S_{l}=k\frac{I_{l}+O_{l}}{I_{l}*O_{l}},
\displaystyle 1-S_{l}
\displaystyle=k\frac{I_{l}+O_{l}}{I_{l}*O_{l}},
S
S_{l}
l
I_{l}
l
O_{l}
l
k
\Delta_{m}
\Delta_{b}
T_{0}
\displaystyle\mathcal{T}_{1}=\,r_{t}+\gamma Q(s_{t+1},\pi(s_{t+1});\theta),
\displaystyle\mathcal{T}_{1}=
\displaystyle\,r_{t}+\gamma Q(s_{t+1},\pi(s_{t+1});\theta),
\displaystyle{\cal{T}}_{n}=\,\sum_{k=0}^{n-1}\gamma^{k}r_{t+k}+\gamma^{n}Q(s_{%
t+n},\pi(s_{t+n});\theta).
\displaystyle{\cal{T}}_{n}=
\displaystyle\,\sum_{k=0}^{n-1}\gamma^{k}r_{t+k}+\gamma^{n}Q(s_{t+n},\pi(s_{t+%
n});\theta).
\displaystyle\mathcal{T}_{1}=r_{t}+\gamma(Q(s_{t+1},\tilde{a}_{t+1};\theta)-%
\alpha\log\pi(\tilde{a}_{t+1}|s_{t+1})),
\displaystyle\mathcal{T}_{1}=r_{t}+\gamma(Q(s_{t+1},\tilde{a}_{t+1};\theta)-%
\alpha\log\pi(\tilde{a}_{t+1}|s_{t+1})),
\tilde{a}_{t+1}\sim\pi(\cdot|s_{t+1})
n
\displaystyle\mathcal{T}_{n}=\sum_{k=0}^{n-1}\gamma^{k}r_{t}+\gamma^{n}Q(s_{t+%
n},\tilde{a}_{t+n};\theta)-\alpha\sum_{k=0}^{n-1}\gamma^{k+1}\log\pi(\tilde{a}%
_{t+k+1}|s_{t+k+1}),
\displaystyle\mathcal{T}_{n}=\sum_{k=0}^{n-1}\gamma^{k}r_{t}+\gamma^{n}Q(s_{t+%
n},\tilde{a}_{t+n};\theta)-\alpha\sum_{k=0}^{n-1}\gamma^{k+1}\log\pi(\tilde{a}%
_{t+k+1}|s_{t+k+1}),
\tilde{a}_{t+k+1}\sim\pi(\cdot|s_{t+k+1}),k=0,1,\cdots,n-1
Q_{\theta_{1}}
Q_{\theta_{2}}
\pi_{\phi}
\theta_{1}
\theta_{2}
\phi
M_{\theta_{1}}
M_{\theta_{2}}
M_{\phi}
S^{(c)}
S^{(a)}
\theta_{1}\leftarrow\theta_{1}\odot M_{\theta_{1}}
\theta_{2}\leftarrow\theta_{2}\odot M_{\theta_{2}}
\phi\leftarrow\phi\odot M_{\phi}
\theta_{1}^{\prime}\leftarrow\theta_{1}
\theta_{2}^{\prime}\leftarrow\theta_{2}
\phi^{\prime}\leftarrow\phi
\cal{B}
t=1
T
a_{t}\sim\pi_{\phi}(s_{t})+\epsilon
\epsilon\sim{\cal{N}}(0,\sigma)
r_{t}
s_{t+1}
(s_{t},a_{t},r_{t},s_{t+1})
\cal{B}
t
\Delta_{b}=0
N=1
t<T_{0}
B
(s_{i},a_{i},r_{i},s_{i+1},a_{i+1},\cdots,s_{i+N})
\cal{B}
\tilde{a}\leftarrow\pi_{\phi^{\prime}}(s_{i+N})+\epsilon
\epsilon\sim clip({\cal{N}}(0,\tilde{\sigma}),-c,c)
y\leftarrow\sum_{k=0}^{N-1}\gamma^{k}r_{i+k}+\gamma^{N}\min_{j=1,2}Q_{\theta_{%
j}^{\prime}}(s_{i+N},\tilde{a})
\theta_{j}\leftarrow\theta_{j}-\lambda\nabla_{\theta_{j}}\frac{1}{B}\sum(y-Q_{%
\theta_{j}}(s_{i},a_{i}))^{2}
j=1,2
t
\Delta_{m}=0
(Q_{\theta_{j}})
j=1,2
t
d=0
\phi\leftarrow\phi-\lambda\nabla_{\phi}(-\frac{1}{B}\sum Q_{\theta_{1}}(s_{i},%
a_{i}))
t/d
\Delta_{m}=0
(\pi_{\phi})
\theta^{\prime}_{i}\leftarrow\tau\theta_{i}+(1-\tau)\theta^{\prime}_{i}
\phi^{\prime}\leftarrow\tau\phi+(1-\tau)\phi^{\prime}
\theta^{\prime}_{i}\leftarrow\theta^{\prime}_{i}\odot M_{\theta_{i}}
\phi^{\prime}\leftarrow\phi^{\prime}\odot M_{\phi}
Q_{\theta_{1}}
Q_{\theta_{2}}
\pi_{\phi}
\theta_{1}
\theta_{2}
\phi
M_{\theta_{1}}
M_{\theta_{2}}
M_{\phi}
S^{(c)}
S^{(a)}
\theta_{1}\leftarrow\theta_{1}\odot M_{\theta_{1}}
\theta_{2}\leftarrow\theta_{2}\odot M_{\theta_{2}}
\phi\leftarrow\phi\odot M_{\phi}
\theta_{1}^{\prime}\leftarrow\theta_{1}
\theta_{2}^{\prime}\leftarrow\theta_{2}
\cal{B}
t=1
T
a_{t}\sim\pi_{\phi}(s_{t})
r_{t}
s_{t+1}
(s_{t},a_{t},r_{t},s_{t+1})
\cal{B}
t
\Delta_{b}=0
N=1
t<T_{0}
B
(s_{i},a_{i},r_{i},s_{i+1},a_{i+1},\cdots,s_{i+N})
\cal{B}
\tilde{a}_{i+k+1}\sim\pi(\cdot|s_{i+k+1}),k=0,1,\cdots,N-1
y\leftarrow\sum_{k=0}^{N-1}\gamma^{k}r_{i+k}+\gamma^{N}\min_{j=1,2}Q_{\theta_{%
j}^{\prime}}(s_{i+N},\tilde{a}_{i+N})-\alpha\sum_{k=0}^{N-1}\gamma^{k+1}\log%
\pi(\tilde{a}_{i+k+1}|s_{i+k+1})
\theta_{j}\leftarrow\theta_{j}-\lambda\nabla_{\theta_{j}}\frac{1}{B}\sum(y-Q_{%
\theta_{j}}(s_{i},a_{i}))^{2}
j=1,2
t
\Delta_{m}=0
(Q_{\theta_{j}})
j=1,2
\phi\leftarrow\phi-\lambda\nabla_{\phi}(-\frac{1}{B}\sum\min_{j=1,2}Q_{\theta_%
{j}}(s_{i},a_{i}))
t/d
\Delta_{m}=0
(\pi_{\phi})
\alpha\leftarrow\alpha-\lambda\nabla_{\alpha}\frac{1}{B}\sum(-\alpha\log\pi(a_%
{i}|s_{i})-\alpha\overline{\mathcal{H}})
\theta^{\prime}_{i}\leftarrow\tau\theta_{i}+(1-\tau)\theta^{\prime}_{i}
\theta^{\prime}_{i}\leftarrow\theta^{\prime}_{i}\odot M_{\theta_{i}}
12
2
L
\displaystyle M=\sum_{l=1}^{L}(1-S_{l})I_{l}O_{l},
\displaystyle M=\sum_{l=1}^{L}(1-S_{l})I_{l}O_{l},
\theta_{1}
\theta_{2}
\displaystyle\theta_{j}\leftarrow\theta_{j}-\lambda\nabla_{\theta_{j}}\frac{1}%
{B}\sum(\mathcal{T}_{n}-Q(s_{i},a_{i};\theta_{j}))^{2},
\displaystyle\theta_{j}\leftarrow\theta_{j}-\lambda\nabla_{\theta_{j}}\frac{1}%
{B}\sum(\mathcal{T}_{n}-Q(s_{i},a_{i};\theta_{j}))^{2},
j=1,2
B
n
\displaystyle\mathcal{T}_{n}=\sum_{k=0}^{N-1}\gamma^{k}r_{i+k}+\gamma^{N}\min_%
{j=1,2}Q(s_{i+N},\tilde{a};\theta_{j}^{\prime})
\displaystyle\mathcal{T}_{n}=\sum_{k=0}^{N-1}\gamma^{k}r_{i+k}+\gamma^{N}\min_%
{j=1,2}Q(s_{i+N},\tilde{a};\theta_{j}^{\prime})
\theta_{j}^{\prime}
\text{FLOPs}_{\text{update\_critic}}=\text{FLOPs}_{\text{TD\_target}}+\text{%
FLOPs}_{\text{compute\_loss}}+\text{FLOPs}_{\text{backward\_pass}},
\text{FLOPs}_{\text{TD\_target}}
\text{FLOPs}_{\text{compute\_loss}}
\text{FLOPs}_{\text{backward\_pass}}
\displaystyle\text{FLOPs}_{\text{TD\_target}}=\,B\times(\text{FLOPs}_{\text{%
Actor}}+2\text{FLOPs}_{\text{Critic}}),
\displaystyle\text{FLOPs}_{\text{TD\_target}}=
\displaystyle\,B\times(\text{FLOPs}_{\text{Actor}}+2\text{FLOPs}_{\text{Critic%
}}),
\displaystyle\text{FLOPs}_{\text{compute\_loss}}=\,B\times 2\text{FLOPs}_{%
\text{Critic}}.
\displaystyle\text{FLOPs}_{\text{compute\_loss}}=
\displaystyle\,B\times 2\text{FLOPs}_{\text{Critic}}.
\text{FLOPs}_{\text{backward\_pass}}
\text{FLOPs}_{\text{backward\_pass}}=B\times\underline{2}\times 2\text{FLOPs}_%
{\text{Critic}},
\underline{2}
\text{FLOPs}_{\text{update\_critic}}=B\times(\text{FLOPs}_{\text{Actor}}+8%
\text{FLOPs}_{\text{Critic}}).
\phi
\displaystyle\phi\leftarrow\phi-\lambda\nabla_{\phi}(-\frac{1}{B}\sum Q(s_{i},%
a_{i};\theta_{1})),
\displaystyle\phi\leftarrow\phi-\lambda\nabla_{\phi}(-\frac{1}{B}\sum Q(s_{i},%
a_{i};\theta_{1})),
\theta_{1}
\text{FLOPs}_{\text{update\_actor}}=\text{FLOPs}_{\text{compute\_loss}}+\text{%
FLOPs}_{\text{backward\_pass}},
\displaystyle\text{FLOPs}_{\text{compute\_loss}}=\,B\times(\text{FLOPs}_{\text%
{Actor}}+\text{FLOPs}_{\text{Critic}}),
\displaystyle\text{FLOPs}_{\text{compute\_loss}}=
\displaystyle\,B\times(\text{FLOPs}_{\text{Actor}}+\text{FLOPs}_{\text{Critic}%
}),
\displaystyle\text{FLOPs}_{\text{backward\_pass}}=\,B\times 2\text{FLOPs}_{%
\text{Actor}}.
\displaystyle\text{FLOPs}_{\text{backward\_pass}}=
\displaystyle\,B\times 2\text{FLOPs}_{\text{Actor}}.
\text{FLOPs}_{\text{update\_actor}}=B\times(3\text{FLOPs}_{\text{Actor}}+\text%
{FLOPs}_{\text{Critic}})
\displaystyle\theta_{j}\leftarrow\theta_{j}-\lambda\nabla_{\theta_{j}}\frac{1}%
{B}\sum(\mathcal{T}_{n}-Q_{\theta_{j}}(s_{i},a_{i}))^{2}
\displaystyle\theta_{j}\leftarrow\theta_{j}-\lambda\nabla_{\theta_{j}}\frac{1}%
{B}\sum(\mathcal{T}_{n}-Q_{\theta_{j}}(s_{i},a_{i}))^{2}
j=1,2
B
n
\theta_{j}^{\prime}
\displaystyle\text{FLOPs}_{\text{TD\_target}}=B\times(2\text{FLOPs}_{\text{%
Actor}}+2\text{FLOPs}_{\text{Critic}}).
\displaystyle\text{FLOPs}_{\text{TD\_target}}=B\times(2\text{FLOPs}_{\text{%
Actor}}+2\text{FLOPs}_{\text{Critic}}).
\text{FLOPs}_{\text{update\_critic}}=B\times(2\text{FLOPs}_{\text{Actor}}+8%
\text{FLOPs}_{\text{Critic}}).
\theta_{j}
\displaystyle\text{FLOPs}_{\text{compute\_loss}}=B\times(\text{FLOPs}_{\text{%
Actor}}+2\text{FLOPs}_{\text{Critic}}).
\displaystyle\text{FLOPs}_{\text{compute\_loss}}=B\times(\text{FLOPs}_{\text{%
Actor}}+2\text{FLOPs}_{\text{Critic}}).
\text{FLOPs}_{\text{backward\_pass}}=\,B\times 2\text{FLOPs}_{\text{Actor}}.
\text{FLOPs}_{\text{update\_actor}}=B\times(3\text{FLOPs}_{\text{Actor}}+2%
\text{FLOPs}_{\text{Critic}}).
<5\%
90\%
85\%
90\%
85\%
98\%
95\%
98\%
95\%
97\%
95\%
97\%
95\%
96\%
88\%
96\%
88\%
90\%
80\%
90\%
80\%
98\%
95\%
98\%
95\%
90\%
90\%
90\%
90\%
90\%
75\%
90\%
75\%
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
5\times 10^{4}
1\times 10^{5}
2\times 10^{5}
1\times 10^{6}
\zeta
\Delta_{m}
\Delta_{b}
D_{0}
T_{0}
\zeta
\zeta=0
\zeta
0.9
\zeta=0.1
\zeta=0.3
\zeta=0.5
\zeta=0.7
\zeta=0.9
\Delta_{m}
\Delta_{m}=\infty
1\times 10^{4}
\Delta_{m}=
1\times 10^{3}
\Delta_{m}=
3\times 10^{3}
\Delta_{m}=
1\times 10^{4}
\Delta_{m}=
3\times 10^{4}
\Delta_{m}=
1\times 10^{5}
\Delta_{m}=\infty
\Delta_{b}
\Delta_{b}=\infty
\Delta_{b}
\Delta_{b}=
1\times 10^{3}
\Delta_{b}=
3\times 10^{3}
\Delta_{b}=
1\times 10^{4}
\Delta_{b}=
3\times 10^{4}
\Delta_{b}=
1\times 10^{5}
\Delta_{b}=\infty
D_{0}
D_{0}=\infty
D_{0}=0.1
0.2
D_{0}=0.05
D_{0}=0.1
D_{0}=0.2
D_{0}=0.3
D_{0}=0.5
D_{0}=\infty
T_{0}
T_{0}=0
T_{0}=\infty
T_{0}
T_{0}=0
T_{0}=
1\times 10^{5}
T_{0}=
2\times 10^{5}
T_{0}=
3\times 10^{5}
T_{0}=
4\times 10^{5}
T_{0}=
5\times 10^{5}
T_{0}=\infty
5721.8\pm 173.0
5097.3\pm 228.9
3835.0\pm 762.5
3835.0\pm 762.5
4248.4\pm 1588.7
4916.2\pm 1058.5
5536.4\pm 152.0
5829.9\pm 295.5
5070.5\pm 335.2
5147.0\pm 493.3
5482.0\pm 603.0
5899.1\pm 520.6
92
99
85
98
\sim 63000
\sim 72000
5\%
90\%
256
1024
99\%
92\%
85\%
92\%
85\%
92\%
92\%
99\%
95\%
99\%
95\%
99\%
99\%
98\%
96\%
98\%
96\%
98\%
98\%
M_{\theta_{l}}
\theta_{l}=\theta_{l}\odot M_{\theta_{l}}
l
28-111
27
(256\times 111)
(256\times 111)
(256\times 111)
(256\times 111)
(256\times 256)
(256\times 256)
(256\times 256)
(256\times 256)
(1\times 256)
(1\times 256)
(1\times 256)
(1\times 256)
