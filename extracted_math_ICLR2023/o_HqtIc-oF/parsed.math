s\in S
a\in A
r(s,a)
P(s^{\prime}|s,a)
s
s^{\prime}
a
\gamma
\pi^{*}
\pi^{*}=\arg\max_{\pi}\mathbb{E}\left[\sum_{t=0}^{\infty}\gamma^{t}r_{t}\right]
Q
V
Q
L_{TD}(\theta)=\mathbb{E}\left[\left(r+\gamma\max_{a^{\prime}}Q(s^{\prime},a^{%
\prime};\theta)-Q(s,a;\theta)\right)^{2}\right].
p
[a_{1},a_{2},\dots,a_{n}]
a_{i}
i
s_{i}=[p,a_{1},a_{2},\dots,a_{i}]
+
-
+
-
+
-
V
n
V^{n}
m
l
l^{m}
\max Q
Q_{\theta}
V
Q_{\theta}
Q_{\hat{\theta}}
V_{\psi}
V_{\psi}
Q_{\theta}
Q_{\hat{\theta}}
Q_{\theta}
V
Q_{\theta}
Q_{\hat{\theta}}
V_{\psi}
V_{\psi}
Q_{\theta}
Q_{\hat{\theta}}
+
-
r+\gamma\max_{a^{\prime}}Q(s^{\prime},a^{\prime};\theta)
Q^{*}(s,a)=\frac{1}{2}(R(s,a)+\gamma\max_{a^{\prime}}Q^{*}(s^{\prime},a^{%
\prime}))
Q^{*}(s,a)
s
a
R(s,a)
\gamma
\max_{a^{\prime}}Q^{*}(s^{\prime},a^{\prime})
s^{\prime}
[p,a_{1},a_{2},\dots,a_{n}]
a_{i}
+
-
V^{n}
V
n
V^{n}
\max_{a\in\mathcal{A}}Q(s,a)
Q(s,a)
V
\mathcal{L}{V}(\psi)=\mathbb{E}_{(s,a)\sim\mathcal{D}}\left[L_{2}^{\tau}\left(%
Q_{\theta}(s,a)-V_{\psi}(s)\right)\right]
L_{2}^{\tau}(u)=|\tau-\bm{1}\mathrm{(u<0)}|u^{2}
\tau\in(0,1)
\mathcal{D}
Q_{\theta}
V_{\psi}
\tau
\lim_{\tau\to 1}V_{\psi}(s)=\max_{a}Q^{*}_{\theta}(s,a)
\tau
\arg\min_{Q}\alpha(\mathbb{E}_{s\sim D,a\sim\mu}\left[Q(s,a)\right]-\mathbb{E}%
_{s\sim D,a\sim\hat{\pi}_{\beta}}\left[Q(s,a)\right])
\mu
\hat{\pi}_{\beta}
L_{CQL}(\psi)=\alpha(\mathbb{E}_{s\sim D,a\sim\mu}\left[L_{2}^{\tau_{1}}\left(%
Q_{\hat{\theta}}(s,a)-V_{\psi}(s)\right)\right]-\mathbb{E}_{s\sim D,a\sim\hat{%
\pi}_{\beta}}\left[L_{2}^{\tau_{2}}\left(Q_{\theta}(s,a)-V_{\psi}(s)\right)%
\right])
\tau_{1}
\tau_{2}
\tau_{1}
\tau_{2}
Q_{\hat{\theta}}
Q_{\theta}
Q_{\hat{\theta}}
Q_{\theta}
\tau
V_{\psi}(s^{\prime})
\max_{a^{\prime}}Q^{*}(s^{\prime},a^{\prime})
L_{Q}(\theta)=\mathbb{E}\left[\left(\frac{1}{2}(R(s,a)+\gamma V_{\psi}(s^{%
\prime}))-Q_{\theta}(s,a)\right)^{2}\right]
L_{CQL}(\psi)=\alpha(\mathbb{E}_{s\sim D,a\sim\mu}\left[L_{2}^{\tau_{1}}\left(%
Q_{\hat{\theta}}(s,a)-V_{\psi}(s)\right)\right]-\mathbb{E}_{s\sim D,a\sim\hat{%
\pi}_{\beta}}\left[L_{2}^{\tau_{2}}\left(Q_{\theta}(s,a)-V_{\psi}(s)\right)%
\right])
L(\theta,\psi)=L_{Q}(\theta)+L_{CQL}(\psi)
Q_{\hat{\theta}}
\alpha
\tau
\gamma=0.99
\alpha=1
\tau_{1}=0.3
\tau_{1}=0.5
\tau_{1}=0.3
\tau=0.5
\tau_{1}=0.3
\tau=0.5
\tau_{1}
\tau_{1}
\tau
\tau_{1}
\tau_{1}
n*m
m
\max Q
n
m
n
\tau
\tau_{1}
\tau_{2}
\tau_{1}=0.3
\tau_{1}
\tau_{1}
\tau_{1}=0.5
\tau
\tau=0.9
\tau
\max Q
\tau
\tau_{1}
\tau_{2}
\gamma
\alpha
\alpha_{\text{soft}}
\tau_{1}=0.3
\tau_{2}=0.9
\tau_{1}=0.5
\tau_{2}=0.9
+
-
Q(s,a)=p(+)=\mathrm{softmax}(\text{logit}_{+})=\sigma(\text{logit}_{+}-\text{%
logit}_{-})
Q^{*}
Q^{*}(s,a)=\frac{1}{2}(R(s,a)+\gamma\max_{a^{\prime}}Q^{*}(s^{\prime},a^{%
\prime}))
\mathcal{T}
\mathcal{T}Q(s,a)=\frac{1}{2}(R(s,a)+\gamma\max_{a^{\prime}}Q(s^{\prime},a^{%
\prime}))
\mathcal{T}
\|\cdot\|_{\infty}
Q_{1}
Q_{2}
\displaystyle\|\mathcal{T}Q_{1}-\mathcal{T}Q_{2}\|_{\infty}=\sup_{s,a}\left|%
\mathcal{T}Q_{1}(s,a)-\mathcal{T}Q_{2}(s,a)\right|
\displaystyle\|\mathcal{T}Q_{1}-\mathcal{T}Q_{2}\|_{\infty}
\displaystyle=\sup_{s,a}\left|\mathcal{T}Q_{1}(s,a)-\mathcal{T}Q_{2}(s,a)\right|
\displaystyle=\sup_{s,a}\left|\frac{1}{2}\gamma\left(\max_{a^{\prime}}Q_{1}(s^%
{\prime},a^{\prime})-\max_{a^{\prime}}Q_{2}(s^{\prime},a^{\prime})\right)\right|
\displaystyle=\sup_{s,a}\left|\frac{1}{2}\gamma\left(\max_{a^{\prime}}Q_{1}(s^%
{\prime},a^{\prime})-\max_{a^{\prime}}Q_{2}(s^{\prime},a^{\prime})\right)\right|
\displaystyle\leq\frac{1}{2}\gamma\sup_{s,a}\left|\max_{a^{\prime}}Q_{1}(s^{%
\prime},a^{\prime})-\max_{a^{\prime}}Q_{2}(s^{\prime},a^{\prime})\right|
\displaystyle\leq\frac{1}{2}\gamma\sup_{s,a}\left|\max_{a^{\prime}}Q_{1}(s^{%
\prime},a^{\prime})-\max_{a^{\prime}}Q_{2}(s^{\prime},a^{\prime})\right|
\displaystyle\leq\frac{1}{2}\gamma\sup_{s^{\prime},a^{\prime}}\left|Q_{1}(s^{%
\prime},a^{\prime})-Q_{2}(s^{\prime},a^{\prime})\right|
\displaystyle\leq\frac{1}{2}\gamma\sup_{s^{\prime},a^{\prime}}\left|Q_{1}(s^{%
\prime},a^{\prime})-Q_{2}(s^{\prime},a^{\prime})\right|
\displaystyle=\frac{1}{2}\gamma\|Q_{1}-Q_{2}\|_{\infty}
\displaystyle=\frac{1}{2}\gamma\|Q_{1}-Q_{2}\|_{\infty}
0<\gamma<1
0<\frac{1}{2}\gamma<1
\mathcal{T}
L=\frac{1}{2}\gamma
\mathcal{T}
\tau
V_{\psi}
\lim_{\tau\to 1}V_{\psi}(s)=\max_{a\in\mathcal{A},\pi_{\beta}(a|s)>0}Q^{*}(s,a)
\tau\to 0
V_{\psi}
\lim_{\tau\rightarrow 0}V_{\tau}(s)=\min_{a\in\mathcal{A}}Q^{*}(s,a)
x^{*}
m_{\tau}
\tau\rightarrow 0
\lim_{\tau\rightarrow 0}m_{\tau}=\inf\{x:F_{X}(x)>0\}=x^{*}
\tau_{1}
\tau_{2}
0<\tau_{1}<\tau_{2}<1
m_{\tau_{1}}\leq m_{\tau_{2}}
\tau\to 0
m_{\tau}
V_{\psi}
\tau\to 0
\tau_{1}
\tau_{2}
0<\tau_{1}<\tau_{2}<1
V_{\tau_{1}}(s)\leq V_{\tau_{2}}(s)
Q^{*}(s,a)
\tau\to 0
V_{\psi}
\lim_{\tau\rightarrow 0}V_{\tau}(s)=\inf_{a\in\text{supp}(\pi_{\beta})}Q^{*}(s%
,a)
\lim_{\tau\rightarrow 0}V_{\tau}(s)=\min_{a\in\mathcal{A},\pi_{\beta}(a|s)>0}Q%
^{*}(s,a)
\tau_{1}
\tau_{2}
Q^{*}(s,a)
\max_{a\sim\hat{\pi}_{\beta}}Q_{\theta}(s,a)\lesssim Q^{*}(s,a)\lesssim\min_{a%
\sim\mu}Q_{\hat{\theta}}(s,a)
\lesssim
\arg\min_{Q}\alpha(\mathbb{E}_{s\sim D,a\sim\mu}\left[Q(s,a)\right]-\mathbb{E}%
_{s\sim D,a\sim\hat{\pi}_{\beta}}\left[Q(s,a)\right])
\mu
\hat{\pi}_{\beta}
\mathbb{E}_{s\sim D,a\sim\mu}\left[Q(s,a)\right]
\mathbb{E}_{s\sim D,a\sim\hat{\pi}_{\beta}}\left[Q(s,a)\right]
\mathbb{E}_{s\sim D,a\sim\mu}[Q(s,a)]
\log\sum{a}\exp(Q(s,a))
\tau
\begin{split}L_{CQL}(\psi)=\alpha(&\mathbb{E}_{s\sim D,a\sim\mu}[L_{2}^{\tau_{%
1}}(Q_{\hat{\theta}}(s,a)-V_{\psi}(s))]\\
&-\mathbb{E}_{s\sim D,a\sim\hat{\pi}_{\beta}}[L_{2}^{\tau_{2}}(Q_{\theta}(s,a)%
-V_{\psi}(s))])\end{split}
\tau_{1}
Q_{\hat{\theta}}
V_{\psi}(s)\lesssim\min_{a\sim\mu}Q_{\hat{\theta}}(s,a)
\tau_{2}
Q_{\theta}
V_{\psi}(s)\gtrsim\max_{a\sim\hat{\pi}_{\beta}}Q_{\theta}(s,a)
\mu
\hat{\pi}_{\beta}
\tau_{1}
\tau_{2}
Q_{\hat{\theta}}
Q_{\theta}
Q^{*}(s,a)
L_{CQL}(\psi)\approx\min_{a\sim\mu}Q_{\hat{\theta}}(s,a)-\max_{a\sim\hat{\pi}_%
{\beta}}Q_{\theta}(s,a)
\max_{a\sim\hat{\pi}_{\beta}}Q_{\theta}(s,a)\lesssim\min_{a\sim\mu}Q_{\hat{%
\theta}}(s,a)
\tau_{1}
Q_{\hat{\theta}}(s,a)
\tau_{1}
\tau_{2}
Q_{\hat{\theta}}
Q_{\theta}
Q_{\hat{\theta}}
L_{2}^{\tau}
D
Q_{\theta}
Q_{\hat{\theta}}
\alpha_{\text{soft}}
V_{\psi}
\tau_{1}
\tau_{2}
\alpha
Q_{\theta}
Q_{\hat{\theta}}
V_{\psi}
\hat{\theta}\leftarrow\theta
S=(s_{1},s_{2},s_{3})\sim D
R=(r_{1},r_{2},r_{3})\sim D
y=\frac{1}{2}(r+\gamma V_{\psi}(S^{\prime}))
L_{Q}(\theta)=\frac{1}{2}(Q_{\theta}(S)-y)^{2}
\mu
L_{\mu}=L_{2}^{\tau_{1}}(Q_{\hat{\theta}}(S)-V_{\psi}(S))
\hat{\pi}_{\beta}
L_{\hat{\pi}}=L_{2}^{\tau_{2}}(Q_{\theta}(S)-V_{\psi}(S))
L_{CQL}(\psi)=\alpha(L_{\mu}-L_{\hat{\pi}})
\theta\leftarrow\theta-\nabla_{\theta}L_{Q}(\theta)
\psi\leftarrow\psi-\nabla_{\psi}L_{CQL}(\psi)
\hat{\theta}\leftarrow(1-\alpha_{\text{soft}})\hat{\theta}+\alpha_{\text{soft}}\theta
i
s_{i}=[p,a_{1},a_{2},\dots,a_{i}]
s_{1}
p
a_{1}
s_{2}
p
a_{1}
a_{2}
r_{i}
a_{i}
\gamma=0.99
\alpha=1
\alpha_{\text{soft}}=0.01
2e-5
\tau_{1}=0.3
\tau_{2}=0.9
\tau_{1}=0.5
\tau_{2}=0.9
