f_{1}
f_{\text{IRM}}
x
y
x
f_{1}
f_{\text{IRM}}
x
y
x
6
10\%
3
{\cal D}=\{{\cal D}^{e}\}_{e\in{{\mathcal{E}}_{\text{all}}}}
{{\mathcal{E}}_{\text{all}}}
{\cal D}^{e}=\{X^{e}_{i},Y^{e}_{i}\}
e\in{{\mathcal{E}}_{\text{all}}}
{\mathbb{P}}^{e}
\{{\cal D}^{e}\}_{e\in{{\mathcal{E}}_{\text{tr}}}}
f:{\mathcal{X}}\rightarrow{\mathcal{Y}}
\max_{e\in{{\mathcal{E}}_{\text{all}}}}{\mathcal{L}}_{e}(f)
{\mathcal{L}}_{e}
e
f=w\circ\varphi
\varphi:{\mathcal{X}}\rightarrow{\mathcal{Z}}
w:{\mathcal{Z}}\rightarrow{\mathcal{Y}}
\varphi
w
\varphi
m
\{{\mathcal{L}}_{i}\}_{i=1}^{m}
\min_{\theta}{\bm{L}}(\theta)\!=\!({\mathcal{L}}_{1}(\theta),...,{\mathcal{L}}%
_{m}(\theta))^{T}
\theta
\bar{\theta}
{\bm{L}}(\theta)\preceq{\bm{L}}(\bar{\theta})
{\mathcal{L}}_{i}(\theta)\leq{\mathcal{L}}_{i}(\bar{\theta})
i
{\bm{L}}(\theta)\neq{\bm{L}}(\bar{\theta})
\theta^{*}
\theta
\theta^{*}
{\mathcal{P}}
\varphi
\varphi
{{\mathcal{E}}_{\text{tr}}}
\min_{w,\varphi}\ \sum_{e\in{{\mathcal{E}}_{\text{tr}}}}{\mathcal{L}}_{e}(w%
\circ\varphi),\text{s.t.}\ w\in\operatorname*{arg\,min}_{\bar{w}:{\mathcal{Z}}%
\rightarrow{\mathcal{Y}}}{\mathcal{L}}_{e}(\bar{w}\circ\varphi),\ \forall e\in%
{{\mathcal{E}}_{\text{tr}}}.
{{\mathcal{E}}_{\text{tr}}}
{\mathcal{W}}
w
\varPhi
\varphi
f=w\circ\varphi
{\mathcal{I}}({{\mathcal{E}}_{\text{tr}}})
{\mathcal{I}}({{\mathcal{E}}_{\text{tr}}})
{\mathcal{W}}
{\mathcal{Z}}=\mathbb{R}^{d}
d=1,{\mathcal{W}}={\mathcal{S}}=\mathbb{R}^{1}
\text{IRM}_{\mathcal{S}}
\min_{\varphi}\ \sum_{e\in{{\mathcal{E}}_{\text{tr}}}}{\mathcal{L}}_{e}(%
\varphi),\text{s.t.}\ \nabla_{w|w=1}{\mathcal{L}}_{e}(w\cdot\varphi)=0,\ %
\forall e\in{{\mathcal{E}}_{\text{tr}}}.
\min_{\varphi}\sum_{e\in{{\mathcal{E}}_{\text{tr}}}}{\mathcal{L}}_{e}(\varphi)%
+\lambda|\nabla_{w|w=1}{\mathcal{L}}_{e}(w\cdot\varphi)|^{2}.
\text{IRM}_{\mathcal{S}}
\alpha_{e},\beta_{e}\in[0,1]
{\cal D}_{e}=\{X^{e},Y^{e}\}
Y^{e}:={\text{Rad}}(0.5),\ X^{e}:=(X^{e}_{1},X^{e}_{2}),\ X_{1}^{e}:=Y^{e}{%
\cdot}{\text{Rad}}(\alpha_{e}),\ X^{e}_{2}:=Y^{e}{\cdot}{\text{Rad}}(\beta_{e}),
{\text{Rad}}(\sigma)
-1
\sigma
+1
1-\sigma
{{\mathcal{E}}_{\alpha}}=\{(\alpha,\beta_{e}):0<\beta_{e}<1\}
X^{e}_{1}
\alpha
e
X^{e}_{2}
\beta_{e}
e
{\mathcal{I}}_{\mathcal{S}}({{\mathcal{E}}_{\text{tr}}})
\text{IRM}_{\mathcal{S}}
{\mathcal{I}}({{\mathcal{E}}_{\text{tr}}})\subseteq{\mathcal{I}}_{\mathcal{S}}%
({{\mathcal{E}}_{\text{tr}}})
\text{IRM}_{\mathcal{S}}
{{\mathcal{E}}_{\text{tr}}}\!=\!\{(0.1,0.11),(0.1,0.4)\}
\text{IRM}_{\mathcal{S}}
f_{1},f_{\text{IRM}}\in{\mathcal{I}}_{\mathcal{S}}({{\mathcal{E}}_{\text{tr}}})
\text{IRM}_{\mathcal{S}}
f_{1}
f_{\text{IRM}}
f_{1}
\lambda
\text{IRM}_{\mathcal{S}}
\min_{\varphi}({\mathcal{L}}_{\text{ERM}},{\mathcal{L}}_{\text{IRM}})^{T},
{\mathcal{L}}_{\text{ERM}}=\frac{1}{|{{\mathcal{E}}_{\text{tr}}}|}\sum_{e\in{{%
\mathcal{E}}_{\text{tr}}}}{\mathcal{L}}_{e}
{\mathcal{L}}_{\text{IRM}}=\sum_{e}|\nabla_{w|w=1}{\mathcal{L}}_{e}(w\cdot%
\varphi)|^{2}
\{{\mathcal{L}}_{e}\}_{e\in{{\mathcal{E}}_{\text{tr}}}}
{\mathcal{P}}({\mathcal{L}}_{1}(\theta),...,{\mathcal{L}}_{m}(\theta))
({\mathcal{L}}_{1}(\theta),...,{\mathcal{L}}_{m}(\theta))
f_{\text{IRM}}\notin{\mathcal{P}}({\mathcal{L}}_{1},{\mathcal{L}}_{2})
f_{\text{IRM}}
\text{IRM}_{\mathcal{S}}
f_{\text{IRM}}\notin{\mathcal{P}}({\mathcal{L}}_{1},{\mathcal{L}}_{2},{%
\mathcal{L}}_{\text{IRM}})
f_{\text{IRM}}\notin{\mathcal{P}}({\mathcal{L}}_{\text{ERM}},{\mathcal{L}}_{%
\text{IRM}})
f_{\text{IRM}}
f_{1}
f_{\text{IRM}}
\text{IRM}_{\mathcal{S}}
\vspace{-0.05in}\partial{\mathcal{L}}_{t}/\partial f_{\text{IRM}}=\mathbf{0},%
\ {\mathcal{L}}_{t}\in\{\text{$\sum$}_{e\in{{\mathcal{E}}_{\text{tr}}}}\lambda%
_{e}{\mathcal{L}}_{e}|\text{$\sum$}_{e\in{{\mathcal{E}}_{\text{tr}}}}\lambda_{%
e}=1\},
{\mathcal{L}}_{t}
\lambda_{e}
\text{IRM}_{\mathcal{S}}
{\mathcal{L}}_{t}
\{\lambda_{e}\}_{e\in{{\mathcal{E}}_{\text{tr}}}}\geq-\beta
{\mathcal{L}}_{\text{VREx}}:={\text{var}}(\{{\mathcal{L}}_{e}\}_{e\in{{%
\mathcal{E}}_{\text{tr}}}})
{\mathcal{L}}_{\text{VREx}}
f_{\text{IRM}}
f_{\text{IRM}}
{\mathcal{L}}_{\text{VREx}}
f_{\text{IRM}}
(\text{\text{IRMX}})\qquad\qquad\qquad\qquad\min_{\varphi}({\mathcal{L}}_{%
\text{ERM}},{\mathcal{L}}_{\text{IRM}},{\mathcal{L}}_{\text{VREx}})^{T}.\qquad%
\qquad\qquad\qquad
\text{IRM}_{\mathcal{S}}
\text{IRM}_{\mathcal{S}}
\alpha\in(0,1)
\mathcal{E}\coloneqq\{(\alpha,\beta_{e}):\beta_{e}\in(0,1)\}
\mathcal{I}_{X}
\mathcal{I}_{X}(\mathcal{E})=\mathcal{I}(\mathcal{E})
f\in{\mathcal{P}}({\mathcal{L}}_{\text{ERM}},{\mathcal{L}}_{\text{IRM}},{%
\mathcal{L}}_{\text{VREx}})
{\mathcal{L}}_{\text{IRM}}=0
{\mathcal{L}}_{\text{VREx}}=0
{\mathcal{L}}_{\text{ERM}}
{\mathcal{L}}_{\text{IRM}}\leq\epsilon_{\text{IRM}}
{\mathcal{L}}_{\text{VREx}}\leq\epsilon_{\text{VREx}}
\epsilon_{\text{IRM}}\rightarrow 0,\epsilon_{\text{VREx}}\rightarrow 0
\epsilon_{\text{IRM}},\epsilon_{\text{VREx}}>0
{\mathcal{L}}_{\text{IRM}}
{\mathcal{L}}_{\text{VREx}}
x
[-2,2]
x
[-2,2]
f:=w\circ\varphi
\varphi
{{\mathcal{E}}_{\text{all}}}
e_{1},e_{2}\in{{\mathcal{E}}_{\text{all}}}
\mathbb{E}_{{\mathcal{D}}_{e_{1}}}[Y|\varphi(X)=z]=\mathbb{E}_{{\mathcal{D}}_{%
e_{2}}}[Y|\varphi(X)=z],
z\in{\mathcal{Z}}_{\varphi}^{e_{1}}\cap{\mathcal{Z}}_{\varphi}^{e_{2}}
{\mathcal{Z}}_{\varphi}^{e}:=\{\varphi(X)|(X,Y)\in\text{supp}({\mathcal{D}}_{e%
})\}
Y=\sin(X_{1})+1
X_{1}
x
X_{2}
y
Y
Y
\varphi
X_{1}
X_{2}
X_{1}
[-2,2]
X_{2}
x
[-2,2]
f_{\text{ood}}
{\mathcal{F}}
f_{\text{ood}}
\bm{L}_{\text{ood}}=\{{\mathcal{L}}_{\text{ood}}^{i}\}_{i=1}^{m}
\bm{L}_{\text{ood}}
\vspace{-0.03in}\bm{L}_{\text{ood}}(f_{\text{ood}})\preceq\bm{L}_{\text{ood}}(%
f),\forall f\neq f_{\text{ood}}\in{\mathcal{F}},
\bm{L}_{\text{ood}}
\vspace{-0.02in}\text{$\min$}_{f}({\mathcal{L}}_{\text{ERM}},\bm{L}_{\text{ood%
}})^{T},
\bm{L}_{\text{ood}}
\bm{\epsilon}_{\text{ood}}
\bm{L}_{\text{ood}}(f_{\text{ood}})=\bm{\epsilon}_{\text{ood}}\preceq\bm{L}_{%
\text{ood}}(f),\forall f\neq f_{\text{ood}}\in{\mathcal{F}}
\epsilon_{\text{inv}}
(\epsilon_{\text{inv}},\bm{\epsilon}_{\text{ood}})^{T}=({\mathcal{L}}_{\text{%
ERM}}(f_{\text{ood}}),\bm{L}_{\text{ood}}(f_{\text{ood}}))^{T}
{\bm{p}}_{\text{ood}}=(\epsilon^{-1}_{\text{inv}},\bm{\epsilon}^{-1}_{\text{%
ood}})^{T}
\text{${\bm{p}}_{\text{ood}}$}_{i}{\mathcal{L}}_{i}=\text{${\bm{p}}_{\text{ood%
}}$}_{j}{\mathcal{L}}_{j},\forall{\mathcal{L}}_{i},{\mathcal{L}}_{j}\in\bm{L}
f_{\text{ood}}
{\bm{p}}_{\text{ood}}
{\mathcal{L}}_{\text{ERM}}
{\bm{p}}_{\text{ood}}
{\bm{p}}_{\text{ood}}
{\bm{p}}_{\text{ood}}
{\bm{g}}_{b}
{\bm{g}}_{\text{dsc}}
{\bm{g}}_{b}
{\bm{g}}_{\text{dsc}}
\epsilon
|\text{${\bm{p}}_{\text{ood}}$}_{i}{\mathcal{L}}_{i}-\text{${\bm{p}}_{\text{%
ood}}$}_{j}{\mathcal{L}}_{j}|\leq\epsilon,\forall{\mathcal{L}}_{i},{\mathcal{L%
}}_{j}\in\bm{L}
\gamma\in(0,1)
\epsilon,\delta>0
{\mathcal{F}}
I_{\text{PAIR}}
p_{\max}\coloneqq\max_{i\in I_{\text{PAIR}}}{p_{i}}
L_{\textup{max}}\coloneqq\max_{i\in I_{\text{PAIR}}}{L_{i}}
\lvert D\rvert\geq(32L_{\textup{max}}^{2}p_{\max}^{2}/\delta^{2})\log[{2(m+1)%
\lvert\mathcal{F}\rvert/\gamma}]
1-\gamma
\epsilon
f_{\text{ood}}
(1,1e10,1e12)
\epsilon_{\text{inv}}
\bm{\epsilon}_{\text{ood}}
w
17.1\pm 0.9
73.3\pm 0.9
45.2
67.3\pm 1.9
76.8\pm 3.2
72.1
68.6\pm 0.7
82.9\pm 1.3
75.8
65.8\pm 2.9
81.6\pm 2.0
73.7
\text{{PAIR-o}}_{f}
68.6\pm 0.9
\mathbf{83.7}\pm 1.2
76.2
\text{{PAIR-o}}_{\varphi}
68.6\pm 0.8
\mathbf{83.7}\pm 1.2
76.2
\text{{PAIR-o}}_{w}
\mathbf{69.2\pm 0.7}
\mathbf{83.7}\pm 1.2
\mathbf{76.5}
72.2\pm 0.2
86.5\pm 0.3
79.4
75
90
82.5
50
50
50
10
(1,1e10,1e12)
w
f
\varphi
\text{{PAIR-o}}_{w}
\downarrow
70.3
\pm
56.0
\pm
32.3
\pm
30.8
\pm
0.45
\pm
29.9
\pm
4.50
59.5
\pm
65.6
\pm
31.7
\pm
\mathbf{32.7}
\pm
0.44
\pm
28.4
\pm
5.50
68.4
\pm
70.0
\pm
30.8
\pm
23.8
\pm
0.39
\pm
23.0
\pm
6.83
64.2
\pm
66.3
\pm
30.0
\pm
15.1
\pm
0.43
\pm
8.2
\pm
7.67
71.5
\pm
64.9
\pm
27.2
\pm
27.6
\pm
0.40
\pm
7.5
\pm
7.00
74.3
\pm
73.9
\pm
34.6
\pm
24.8
\pm
0.43
\pm
10.1
\pm
4.33
\mathbf{74.7}
\pm
70.8
\pm
33.5
\pm
24.0
\pm
\mathbf{0.48}
\pm
\mathbf{31.9}
\pm
2.67
67.0
\pm
74.3
\pm
33.7
\pm
26.6
\pm
0.45
\pm
28.7
\pm
4.00
74.0
\pm
\mathbf{75.2}
\pm
\mathbf{35.5}
\pm
27.9
\pm
0.47
\pm
28.8
\pm
\mathbf{2.17}
6
(1,1e10,1e12)
x
y
x
y
\Delta
\Delta
\Delta
71.0
\mathbf{73.4}
10.0
87.2
79.5
95.5
76.9
46.7
\mathbf{41.8}
57.4
39.7
71.0
\mathbf{73.4}
10.0
86.5
79.9
97.1
75.3
46.1
41.2
56.7
35.6
\checkmark
71.6
73.3
10.9
+0.9
87.0
81.4
96.8
77.5
+2.2
43.1
41.1
55.2
38.7
+3.1
72.6
73.1
9.9
87.7
82.1
98.0
79.6
48.4
40.3
57.9
40.0
\checkmark
\mathbf{72.7}
73.2
13.0
+3.1
86.7
\mathbf{83.2}
\mathbf{97.8}
81.4
+1.8
48.4
40.3
57.9
40.0
+0.0
72.3
72.6
9.9
82.3
80.8
95.8
78.9
48.4
35.6
55.4
40.1
\checkmark
67.4
64.8
\mathbf{24.2}
+14.3
85.3
81.7
97.4
79.7
+0.8
40.4
38.3
48.8
37.0
+1.4
72.2
73.1
9.9
\mathbf{88.4}
82.2
97.7
81.6
49.2
40.6
57.9
40.4
\checkmark
69.1
70.9
22.6
+12.7
87.4
82.6
97.5
\mathbf{82.2}
+0.6
\mathbf{51.0}
40.7
\mathbf{58.2}
\mathbf{40.8}
+0.3
10\%
{\mathcal{X}}=\mathbb{R}^{n}
{\mathcal{Y}}=\mathbb{R}
{\mathcal{Z}}=\mathbb{R}^{d}
\varphi
\varphi:{\mathcal{X}}\rightarrow{\mathcal{Z}}
w
w:{\mathcal{Z}}\rightarrow{\mathcal{Y}}
f\in{\mathcal{F}}
f=w\circ\varphi:{\mathcal{X}}\rightarrow{\mathcal{Y}}
w
f
w\cdot\varphi
{{\mathcal{E}}_{\text{all}}}
{{\mathcal{E}}_{\text{tr}}}
e
{\cal D}^{e},{\cal D}_{e}
e
\{X_{i}^{e},Y_{i}^{e}\}
\mathbb{P}^{e}
{\cal D}
{\cal D}=\{{\cal D}^{e}\}_{e\in{{\mathcal{E}}_{\text{all}}}}
{\mathcal{I}}({\mathcal{E}})
{\mathcal{E}}
{\mathcal{L}}_{e}
{\cal D}^{e}
\bm{L}
\{{\mathcal{L}}_{i}\}_{i=1}^{m}
m
\theta
{\mathcal{P}}(\bm{L})
\bm{L}
{\bm{p}}_{\text{ood}}
\bm{G}\in\mathbb{R}^{m\times d}
m
\bm{L}
\theta\in\mathbb{R}^{d}
{\mathcal{L}}_{i}
{\bm{g}}\in\mathbb{R}^{d}
{\mathcal{S}}^{m+1}
m
m
\{\beta\in\mathbb{R}^{m+1}_{+}|\sum_{i=1}^{m+1}\beta_{i}=1\}
{\cal D}=\{{\cal D}^{e}\}_{e\in{{\mathcal{E}}_{\text{all}}}}
{{\mathcal{E}}_{\text{all}}}
{\cal D}^{e}=\{X^{e}_{i},Y^{e}_{i}\}
e\in{{\mathcal{E}}_{\text{all}}}
{\mathbb{P}}^{e}
\{{\cal D}^{e}\}_{e\in{{\mathcal{E}}_{\text{tr}}}}
f:{\mathcal{X}}\rightarrow{\mathcal{Y}}
\max_{e\in{{\mathcal{E}}_{\text{all}}}}{\mathcal{L}}_{e}(f)
{\mathcal{L}}_{e}
e
{\mathcal{X}}
{\mathcal{Y}}
f=w\circ\varphi
\varphi:{\mathcal{X}}\rightarrow{\mathcal{Z}}
w:{\mathcal{Z}}\rightarrow{\mathcal{Y}}
\varphi
w
(X,Y)
Y
Y
Y
w
\varphi
\varphi
m
\{{\mathcal{L}}_{i}\}_{i=1}^{m}
\min_{\theta}{\bm{L}}(\theta)\!=\!({\mathcal{L}}_{1}(\theta),...,{\mathcal{L}}%
_{m}(\theta))^{T}
\theta
\bar{\theta}
{\bm{L}}(\theta)\preceq{\bm{L}}(\bar{\theta})
{\mathcal{L}}_{i}(\theta)\leq{\mathcal{L}}_{i}(\bar{\theta})
i
{\bm{L}}(\theta)\neq{\bm{L}}(\bar{\theta})
\theta^{*}
\theta^{*}
{\mathcal{P}}
\hat{\mathcal{Y}}=\mathbb{R},\mathcal{Y}\subseteq\mathbb{R}
\ell
\ell_{\textup{sq}}(\hat{y},y)\coloneqq\frac{1}{2}(\hat{y}-y)^{2}
\ell_{\textup{log}}(\hat{y},y)\coloneqq\log{(1+\exp{(-\hat{y}y)})}
\mathcal{Y}=\{-1,1\}
\varphi:{\mathcal{X}}\rightarrow{\mathcal{Z}}
w:{\mathcal{Z}}\rightarrow{\mathcal{Y}}
\varphi
{{\mathcal{E}}_{\text{all}}}
\displaystyle\min_{w,\varphi}\ \sum_{e\in{{\mathcal{E}}_{\text{tr}}}}{\mathcal%
{L}}_{e}(w\circ\varphi),
\displaystyle\min_{w,\varphi}
\displaystyle\ \sum_{e\in{{\mathcal{E}}_{\text{tr}}}}{\mathcal{L}}_{e}(w\circ%
\varphi),
\displaystyle\text{s.t.}\ w\in\operatorname*{arg\,min}_{\bar{w}:{\mathcal{Z}}%
\rightarrow{\mathcal{Y}}}{\mathcal{L}}_{e}(\bar{w}\circ\varphi),\ \forall e\in%
{{\mathcal{E}}_{\text{tr}}}.
\displaystyle\ w\in\operatorname*{arg\,min}_{\bar{w}:{\mathcal{Z}}\rightarrow{%
\mathcal{Y}}}{\mathcal{L}}_{e}(\bar{w}\circ\varphi),\ \forall e\in{{\mathcal{E%
}}_{\text{tr}}}.
{{\mathcal{E}}_{\text{tr}}}
{\mathcal{W}}
w
\varPhi
\varphi
w\circ\varphi
{\mathcal{I}}({{\mathcal{E}}_{\text{tr}}})
{\mathcal{I}}({{\mathcal{E}}_{\text{tr}}})
{\mathcal{W}}
{\mathcal{Z}}=\mathbb{R}^{d}
d=1,{\mathcal{W}}={\mathcal{S}}=\mathbb{R}^{1}
{\mathcal{W}}
\text{IRM}_{\mathcal{S}}
\min_{\varphi}\ \sum_{e\in{{\mathcal{E}}_{\text{tr}}}}{\mathcal{L}}_{e}(%
\varphi),\text{s.t.}\ \nabla_{w|w=1}{\mathcal{L}}_{e}(w\cdot\varphi)=0,\ %
\forall e\in{{\mathcal{E}}_{\text{tr}}}.
{\mathcal{I}}_{\mathcal{S}}({{\mathcal{E}}_{\text{tr}}})
\text{IRM}_{\mathcal{S}}
{\mathcal{I}}({{\mathcal{E}}_{\text{tr}}})\subseteq{\mathcal{I}}_{\mathcal{S}}%
({{\mathcal{E}}_{\text{tr}}})
\min_{\varphi}\sum_{e\in{{\mathcal{E}}_{\text{tr}}}}{\mathcal{L}}_{e}(\varphi)%
+\lambda|\nabla_{w|w=1}{\mathcal{L}}_{e}(w\cdot\varphi)|^{2}.
\text{IRM}_{\mathcal{S}}
\alpha_{e},\beta_{e}\in[0,1]
{\cal D}_{e}
Y\!:=\!{\text{Rad}}(0.5),X_{1}\!:=\!Y{\cdot}{\text{Rad}}(\alpha_{e}),X_{2}\!:=%
\!Y{\cdot}{\text{Rad}}(\beta_{e}),
{\text{Rad}}(\sigma)
-1
\sigma
+1
1-\sigma
e
(\alpha_{e},\beta_{e})
{{\mathcal{E}}_{\alpha}}\!=\!\{(\alpha,\beta_{e})\!:\!0\!<\!\beta_{e}\!<\!1\}
X_{1}
\alpha
e
{{\mathcal{E}}_{\text{tr}}}:=\{(0.25,0.1),(0.25,0.2)\}
\text{IRM}_{\mathcal{S}}
f_{\text{IRM}}
{\mathcal{I}}({{\mathcal{E}}_{\text{tr}}})\subseteq{\mathcal{I}}_{\mathcal{S}}%
({{\mathcal{E}}_{\text{tr}}})
\text{IRM}_{\mathcal{S}}
{{\mathcal{E}}_{\text{tr}}}:=\{(0.1,0.11),(0.1,0.4)\}
\text{IRM}_{\mathcal{S}}
f_{0},f_{1},f_{2},f_{\text{IRM}}\in{\mathcal{I}}_{\mathcal{S}}({{\mathcal{E}}_%
{\text{tr}}})
\text{IRM}_{\mathcal{S}}
f_{1}
f_{\text{IRM}}
f_{1}
\alpha<0.1464
\alpha>0.8356
{\mathcal{I}}({{\mathcal{E}}_{\text{tr}}})\subsetneq{\mathcal{I}}_{\mathcal{S}%
}({{\mathcal{E}}_{\text{tr}}})
\text{IRM}_{\mathcal{S}}
\text{IRM}_{\mathcal{S}}
f_{\text{IRM}}
{{\mathcal{E}}_{\text{tr}}}:=\{(0.1,0.11),(0.1,0.4)\}
\varphi(1,-1)=-\varphi(-1,1)
\varphi(1,1)=-\varphi(-1,-1)
\lambda
\text{IRM}_{\mathcal{S}}
50
y
x
{{\mathcal{E}}_{\text{tr}}}:=\{(0.1,0.2),(0.1,0.25)\}
(1,1e10,1e12)
(\text{\text{IRMX}})\qquad\qquad\qquad\qquad\min_{\varphi}({\mathcal{L}}_{%
\text{ERM}},{\mathcal{L}}_{\text{IRM}},{\mathcal{L}}_{\text{VREx}})^{T}.\qquad%
\qquad\qquad\qquad
\text{IRM}_{\mathcal{S}}
\text{IRM}_{\mathcal{S}}
{\mathcal{I}}_{\mathcal{S}}({\mathcal{E}})
\text{IRM}_{\mathcal{S}}
{\mathcal{L}}_{\text{IRM}}
{{\mathcal{E}}_{\text{tr}}}=\{(0.25,0.1),(0.25,\beta)\}
\beta
{\text{var}}(\{{\mathcal{L}}_{e}\}_{e\in{{\mathcal{E}}_{\text{tr}}}})
{\mathcal{L}}_{\text{IRM}}
\{{\mathcal{L}}_{e}\}_{e\in{{\mathcal{E}}_{\text{tr}}}}
f:=w\circ\varphi
\varphi
{{\mathcal{E}}_{\text{all}}}
e_{1},e_{2}\in{{\mathcal{E}}_{\text{all}}}
\mathbb{E}_{{\mathcal{D}}_{e_{1}}}[Y|\varphi(X)=z]=\mathbb{E}_{{\mathcal{D}}_{%
e_{2}}}[Y|\varphi(X)=z],
z\in{\mathcal{Z}}_{\varphi}^{e_{1}}\cap{\mathcal{Z}}_{\varphi}^{e_{2}}
{\mathcal{Z}}_{\varphi}^{e}:=\{\varphi(X)|(X,Y)\in\text{supp}({\mathcal{D}}_{e%
})\}
{\mathcal{X}}:\mathbb{R}^{2}\rightarrow{\mathcal{Y}}:\mathbb{R}
X
X=(X_{1},X_{2})
X_{1}
Y=\sin(X_{1})+1
X_{2}
Y
(-4,-4)
(4,4)
x
[-2,2]
(-4,-4)
(4,4)
x
[-2,2]
\{(-3,-3),(-2,1)\}
1
\{(-1,2),(3,3)\}
2
(-0.9,-2.2)
\{(0.9,0.11),(0.11,0.1)\}
(1,2)
\{(1,-0.3),(-0.3,0.1)\}
\varphi
X_{1}
X_{2}
[-2,2]
X_{2}
x
[-2,2]
3
128
2500
1000
10000
150
1e-4
1e
1e-2
1e1
6
(1,1e4,1e16),(1,1e4,1e12),(1,1e6,1e8),(1,1e8,1e4),(1,1e4,1e4),(1,1e8,1e8)
(1,1e4,1e12),(1,1e8,1e4),(1,1e4,1e4),(1,1e8,1e8)
0.06
0.32
f_{\text{ood}}
\bm{L}_{\text{ood}}=\{{\mathcal{L}}_{\text{ood}}^{i}\}_{i=1}^{m}
\bm{L}_{\text{ood}}(f_{\text{ood}})\preceq\bm{L}_{\text{ood}}(f),\forall f\neq
f%
_{\text{ood}}\in{\mathcal{F}},
{\mathcal{F}}
\bm{L}_{\text{ood}}
\text{$\min$}_{f}({\mathcal{L}}_{\text{ERM}},\bm{L}_{\text{ood}})^{T},
\bm{L}_{\text{ood}}
\bm{\epsilon}_{\text{ood}}
\bm{L}_{\text{ood}}(f_{\text{ood}})=\bm{\epsilon}_{\text{ood}}\preceq\bm{L}_{%
\text{ood}}(f),\forall f\neq f_{\text{ood}}\in{\mathcal{F}}
\epsilon_{\text{inv}}
(\epsilon_{\text{inv}},\bm{\epsilon}_{\text{ood}})^{T}=({\mathcal{L}}_{\text{%
ERM}}(f_{\text{ood}}),\bm{L}_{\text{ood}}(f_{\text{ood}}))^{T}
{\bm{p}}_{\text{ood}}=(\frac{1}{\epsilon}_{\text{inv}},\bm{\frac{1}{\epsilon}}%
_{\text{ood}})^{T}
\bm{L}(f)^{T}{\bm{p}}_{\text{ood}}
{\bm{p}}_{\text{ood}}
{\mathcal{L}}_{\text{ERM}}
{\bm{p}}_{\text{ood}}
{\bm{g}}_{\text{des}}
\bm{L}(f)^{T}{\bm{p}}_{\text{ood}}
\bm{G}
\bm{L}
t
\beta^{*}
\displaystyle\beta^{*}=\text{$\arg\max$}_{\beta\in{\mathcal{S}}^{m+1}}\ (\bm{G%
}\beta)^{T}{\bm{g}}_{b},
\displaystyle\beta^{*}=\text{$\arg\max$}_{\beta\in{\mathcal{S}}^{m+1}}
\displaystyle\ (\bm{G}\beta)^{T}{\bm{g}}_{b},
\displaystyle\ \text{s.t.}\ (\bm{G}\beta)^{T}\bm{G}_{j}\geq{\bm{g}}_{b}^{T}\bm%
{G}_{j},\ \forall j\in\bar{J}-J^{*},
\displaystyle\ (\bm{G}\beta)^{T}\bm{G}_{j}\geq{\bm{g}}_{b}^{T}\bm{G}_{j},\ %
\forall j\in\bar{J}-J^{*},
\displaystyle\ (\bm{G}\beta)^{T}\bm{G}_{j}\geq 0,\ \forall j\in J^{*},
\displaystyle\ (\bm{G}\beta)^{T}\bm{G}_{j}\geq 0,\ \forall j\in J^{*},
{\mathcal{S}}^{m+1}=\{\beta\in\mathbb{R}^{m+1}_{+}|\sum_{i=1}^{m+1}\beta_{i}=1\}
{\bm{g}}_{b}
{\bm{p}}_{\text{ood}}
J=\{j|G_{j}^{T}{\bm{g}}_{b}>0\}
{\bm{g}}_{b}
\bar{J}=\{j|G_{j}^{T}{\bm{g}}_{b}\leq 0\}
{\bm{g}}_{b}
J^{*}=\{j|L_{j}\text{${\bm{p}}_{\text{ood}}$}_{j}=\max_{j^{\prime}}(L_{j^{%
\prime}}\text{${\bm{p}}_{\text{ood}}$}_{j^{\prime}})\}
{\bm{g}}_{b}
{\bm{g}}_{b}={\bm{p}}\odot(\log((m+1)\hat{\bm{L}})-\mu(\bm{L})),
\odot
\mu(\bm{L})
\mu(\bm{L})=\text{KL}(\hat{\bm{L}}|\mathbf{1}/m)=\sum_{i}^{m+1}\hat{\bm{L}}_{i%
}\log(m\hat{\bm{L}}_{i}),
\hat{\bm{L}}
\hat{\bm{L}}_{i}=\text{${\bm{p}}_{\text{ood}}$}_{i}\bm{L}_{i}/\sum_{j}^{m+1}{%
\bm{p}}_{j}\bm{L}_{j}.
\mathcal{D_{\mathrm{tr}}}=\{X_{i},Y_{i}\}_{i=1}^{N}
\mathcal{D_{\mathrm{tr}}}=\{{\cal D}^{e}\}_{e\in{{\mathcal{E}}_{\text{tr}}}}
\eta
b
d
{\bm{p}}_{\text{ood}}
{\mathcal{L}}_{\text{ERM}}
m
\bm{L}_{\text{ood}}=\{{\mathcal{L}}_{\text{ood}}^{i}\}_{i=1}^{m}
e_{p}
e_{b}
\theta
f=w\circ\varphi
i=1
e_{p}
\{X_{j},Y_{j}\}_{j=1}^{b}
f
\{\widehat{Y}_{j}\}_{j=1}^{b}=f(\{X_{j}\}_{j=1}^{b})
L_{\text{ERM}}
\{\widehat{Y}_{j}\}_{j=1}^{b}
f
{\mathcal{L}}_{\text{ERM}}
\eta
i=1
e_{b}
D^{e}\in\texttt{permute}(\{{\cal D}^{e}\}_{e}\in{{\mathcal{E}}_{\text{tr}}})
D^{e}
\{X_{j}^{e},Y_{j}^{e}\}_{j=1}^{b}\sim D^{e}
f
\{\widehat{Y}_{j}^{e}\}_{j=1}^{b}=f(\{X_{j}^{e}\}_{j=1}^{b})
{\mathcal{L}}_{\text{ERM}}
{\mathcal{L}}_{\text{ood}}
\bm{L}
\bm{G}=\partial\bm{L}/\partial\theta
\mu(\bm{L})
{\bm{g}}_{b}
J,J^{*},\bar{J}
\beta^{*}
\theta^{i+1}=\theta^{i}-\eta\bm{G}\beta^{*}
L_{\text{ERM}}
m
\bm{L}_{\text{ood}}
9
21
\eta_{0}
\bm{L}^{(i+1)}=(L_{\text{ERM}},L_{i},...,L_{m})^{T}
\theta^{(t+1)}
\eta\in[0,\eta_{0}]
{\mathcal{A}}^{t}
{\mathcal{A}}^{t}
\bm{L}^{*}\in{\mathcal{A}}^{t}
{\mathcal{A}}^{t}
{\mathcal{A}}^{t}
{\bm{p}}_{\text{ood}}
s_{\text{PAIR}}=\bm{L}^{T}\hat{{\bm{p}}}_{\text{ood}},
\hat{{\bm{p}}}_{\text{ood}}
{\bm{p}}_{\text{ood}}/\sum_{i=1}^{m+1}\text{${\bm{p}}_{\text{ood}}$}_{i}
c
c
\mathcal{D_{\mathrm{tr}}}
{\mathcal{H}}
R
{\mathcal{L}}=\{{\mathcal{L}}_{1}^{t},{\mathcal{L}}_{2}^{t},...,{\mathcal{L}}_%
{(m+1)}^{t}\}_{t=1}^{T}
(m+1)
{\mathcal{L}}_{\text{ERM}}
\bm{L}_{\text{ood}}=\{{\mathcal{L}}_{\text{ood}}^{i}\}_{i=1}^{m}
{\mathcal{A}}=\{A_{\text{tr}}^{t},A_{\text{val}}^{t}\}_{t=1}^{T}
T
{\bm{p}}_{\text{ood}}
c
p
r=1
R
{\bm{p}}_{\text{ood}}
T
{\mathcal{S}}=\{s^{t}\}_{t=1}^{T}
c
\widehat{{\mathcal{S}}}=\{s^{t}\}_{t=c}^{T}
s_{*}=\operatorname*{arg\,max}_{t}\widehat{{\mathcal{S}}}
R
{\mathcal{S}}=\{s_{*}^{r}\}_{r=1}^{R}
{\mathcal{A}}_{\text{val}}=\{A_{\text{val}}^{s_{*}^{r}}\}_{r=1}^{R}
\bar{A}_{\text{val}}=(\max{\mathcal{A}}_{\text{val}}-\min{\mathcal{A}}_{\text{%
val}})*p+\min{\mathcal{A}}_{\text{val}}
\bar{A}_{\text{val}}
\bar{{\mathcal{H}}}
r_{*}=\operatorname*{arg\,max}_{r\in\bar{{\mathcal{H}}}}s_{*}^{r}
r_{*}
{\bm{p}}_{\text{ood}}
\epsilon
{\bm{p}}_{\text{ood}}
(1,1e10,1e12)
1e2
\beta^{*}
\partial\bm{L}/\partial\varphi(X)
\partial\bm{L}/\partial w
\min_{\varphi}\sum_{e\in{{\mathcal{E}}_{\text{tr}}}}{\mathcal{L}}_{e}(\varphi)%
+\lambda|\nabla_{w|w=1}{\mathcal{L}}_{e}(w\cdot\varphi)|^{2}.
\nabla_{w|w=1.0}{\mathcal{L}}_{e}(w\cdot\varphi)=\frac{\partial\mathbb{E}^{e}%
\big{[}\ell(w\cdot\varphi(X^{e}),Y^{e})\big{]}}{\partial w}\Big{|}_{w=1.0}=%
\mathbb{E}^{e}\bigg{[}\frac{\partial\ell(w\cdot\varphi(X^{e}),Y^{e})}{\partial
w%
}\Big{|}_{w=1.0}\bigg{]}
\displaystyle\|\nabla_{w|w=1.0}{\mathcal{L}}_{e}(w\cdot\varphi)\|^{2}=\Big{(}%
\frac{\partial\mathbb{E}^{e}\big{[}\ell(w\cdot\varphi(X^{e}),Y^{e})\big{]}}{%
\partial w}\Big{|}_{w=1.0}\Big{)}^{2}
\displaystyle\|\nabla_{w|w=1.0}{\mathcal{L}}_{e}(w\cdot\varphi)\|^{2}
\displaystyle=\Big{(}\frac{\partial\mathbb{E}^{e}\big{[}\ell(w\cdot\varphi(X^{%
e}),Y^{e})\big{]}}{\partial w}\Big{|}_{w=1.0}\Big{)}^{2}
\displaystyle=\Big{(}\mathbb{E}^{e}\bigg{[}\frac{\partial\ell(w\cdot\varphi(X^%
{e}),Y^{e})}{\partial w}\Big{|}_{w=1.0}\bigg{]}\Big{)}^{2},
\displaystyle=\Big{(}\mathbb{E}^{e}\bigg{[}\frac{\partial\ell(w\cdot\varphi(X^%
{e}),Y^{e})}{\partial w}\Big{|}_{w=1.0}\bigg{]}\Big{)}^{2},
\mathbb{E}[X]^{2}=\mathbb{E}[AB],
A
B
X
{\mathcal{X}}
\displaystyle\|\nabla_{w|w=1.0}{\mathcal{L}}_{e}(w\cdot\varphi)\|^{2}=\mathbb{%
E}^{e}\bigg{[}\Big{(}\frac{\partial\ell(w\cdot\varphi(X^{e}),Y^{e})}{\partial w%
}\Big{|}_{w=1.0}\Big{)}\Big{(}\frac{\partial\ell(w\cdot\varphi(\tilde{X}^{e}),%
\tilde{Y}^{e})}{\partial w}\Big{|}_{w=1.0}\Big{)}\bigg{]},
\displaystyle\|\nabla_{w|w=1.0}{\mathcal{L}}_{e}(w\cdot\varphi)\|^{2}
\displaystyle=\mathbb{E}^{e}\bigg{[}\Big{(}\frac{\partial\ell(w\cdot\varphi(X^%
{e}),Y^{e})}{\partial w}\Big{|}_{w=1.0}\Big{)}\Big{(}\frac{\partial\ell(w\cdot%
\varphi(\tilde{X}^{e}),\tilde{Y}^{e})}{\partial w}\Big{|}_{w=1.0}\Big{)}\bigg{%
]},
\displaystyle=\bigg{[}\mathbb{E}^{e}\Big{(}\frac{\partial\ell(w\cdot\varphi(X^%
{e}),Y^{e})}{\partial w}\Big{|}_{w=1.0}\Big{)}\mathbb{E}^{e}\Big{(}\frac{%
\partial\ell(w\cdot\varphi(\tilde{X}^{e}),\tilde{Y}^{e})}{\partial w}\Big{|}_{%
w=1.0}\Big{)}\bigg{]},
\displaystyle=\bigg{[}\mathbb{E}^{e}\Big{(}\frac{\partial\ell(w\cdot\varphi(X^%
{e}),Y^{e})}{\partial w}\Big{|}_{w=1.0}\Big{)}\mathbb{E}^{e}\Big{(}\frac{%
\partial\ell(w\cdot\varphi(\tilde{X}^{e}),\tilde{Y}^{e})}{\partial w}\Big{|}_{%
w=1.0}\Big{)}\bigg{]},
(X^{e},Y^{e})\sim\mathbb{P}^{e}
(\tilde{X}^{e},\tilde{Y}^{e})\sim\mathbb{P}^{e}
\mathbb{P}^{e}
e
\mathbb{E}^{e}\Big{(}\frac{\partial\ell(w\cdot\varphi(X^{e}),Y^{e})}{\partial w%
}\Big{|}_{w=1.0}\Big{)}
\mathbb{E}^{e}\Big{(}\frac{\partial\ell(w\cdot\varphi(\tilde{X}^{e}),\tilde{Y}%
^{e})}{\partial w}\Big{|}_{w=1.0}\Big{)}
\mathbb{E}^{e}\Big{(}\frac{\partial\ell(w\cdot\varphi(X^{e}),Y^{e})}{\partial w%
}\Big{|}_{w=1.0}\Big{)}
C
\mathbb{E}^{e}\Big{(}\frac{\partial\ell(w\cdot\varphi(X^{e}),Y^{e})}{\partial w%
}\Big{|}_{w=1.0}\Big{)}+C
0
\mathbb{E}^{e}\Big{(}\frac{\partial\ell(w\cdot\varphi(X^{e}),Y^{e})}{\partial w%
}\Big{|}_{w=1.0}\Big{)}
C
\mathbb{E}^{e}\Big{(}\frac{\partial\ell(w\cdot\varphi(X^{e}),Y^{e})}{\partial w%
}\Big{|}_{w=1.0}\Big{)}
-C
C
1
1e-4
C
1e-2
{\mathcal{X}}\rightarrow{\mathcal{Y}}
f:{\mathcal{X}}\rightarrow\widehat{{\mathcal{Y}}}
l:\widehat{{\mathcal{Y}}}\times{\mathcal{Y}}\rightarrow\mathbb{R}_{\geq 0}
\widehat{\mathcal{Y}}=\mathbb{R},\mathcal{Y}\subseteq\mathbb{R}
\ell
\ell_{\textup{sq}}(\hat{y},y)\coloneqq\frac{1}{2}(\hat{y}-y)^{2}
\ell_{\textup{log}}(\hat{y},y)\coloneqq\log{(1+\exp{(-\hat{y}y)})}
\mathcal{Y}=\{-1,1\}
\alpha\in(0,1)
\mathcal{E}\coloneqq\{(\alpha,\beta_{e}):\beta_{e}\in(0,1)\}
\mathcal{I}_{X}
{\mathcal{I}}_{{\mathcal{S}}\cap X}(\mathcal{E})=\mathcal{I}(\mathcal{E})
{\mathcal{I}}_{X}({\mathcal{E}})
{\mathcal{I}}_{X}({\mathcal{E}})
\text{IRM}_{\mathcal{S}}
{\mathcal{I}}_{\mathcal{S}}({\mathcal{E}})
{\mathcal{L}}_{\text{VREx}}:={\text{var}}(\{{\mathcal{L}}_{e}\}_{e\in{{%
\mathcal{E}}_{\text{tr}}}}).
{\mathcal{L}}_{\text{VREx}}
{\mathcal{L}}_{e_{1}}={\mathcal{L}}_{e_{2}},\ \forall e_{1},e_{2}\in{{\mathcal%
{E}}_{\text{tr}}}
\mathcal{I}_{X}(\mathcal{E})\coloneqq\{f:\mathcal{X}\rightarrow\hat{\mathcal{Y%
}}\mid\mathcal{L}_{e_{1}}(f)=\mathcal{L}_{e_{2}}(f),\forall e_{1},e_{2}\in%
\mathcal{E}\}
\min_{f\in\mathcal{I}_{X}(\mathcal{E}_{\textup{tr}})}{\sum_{e\in\mathcal{E}_{%
\textup{tr}}}{\mathcal{L}_{e}(f)}}.
{\mathcal{I}}_{X}
f=w\circ\varphi
\mathcal{I}(\mathcal{E})
(X_{e},Y_{e})\sim\mathcal{D}_{e}
\text{If }\begin{cases}\ell=\ell_{\textup{sq}},\,\mathbb{E}_{\mathcal{D}_{e}}[%
Y_{e}^{2}]\text{ is identical},\text{the distribution of }\varphi(X_{e})\text{%
 is identical (or }f\equiv 0\text{)}\\
\ell=\ell_{\textup{log}}\text{ and }H(Y_{e}|\varphi(X_{e}))\text{ is identical%
}\end{cases}\text{for all }e\in\mathcal{E},
\mathcal{I}(\mathcal{E})\subseteq\mathcal{I}_{X}(\mathcal{E})
f=w\circ\varphi\in\mathcal{I}(\mathcal{E})
{\mathbb{E}}_{\mathcal{D}_{e_{1}}}[Y\mid\varphi(X)=z]={\mathbb{E}}_{\mathcal{D%
}_{e_{2}}}[Y\mid\varphi(X)=z],
e_{1},e_{2}\in\mathcal{E}
z\in\mathcal{Z}
\varphi(X)
\mathcal{Z}
\ell_{\textup{sq}}
\displaystyle\mathcal{L}_{e}(f)=\frac{1}{2}\mathbb{E}_{\mathcal{D}_{e}}[(f(X)-%
Y)^{2}]
\displaystyle\mathcal{L}_{e}(f)
\displaystyle=\frac{1}{2}\mathbb{E}_{\mathcal{D}_{e}}[(f(X)-Y)^{2}]
\displaystyle=\frac{1}{2}\mathbb{E}_{\mathcal{D}_{e}}[f(X)^{2}-2f(X)Y+Y^{2}]
\displaystyle=\frac{1}{2}\mathbb{E}_{\mathcal{D}_{e}}[f(X)^{2}-2f(X)Y+Y^{2}]
\displaystyle=\frac{1}{2}\mathbb{E}_{\mathcal{D}_{e}}\big{[}\mathbb{E}_{%
\mathcal{D}_{e}}[w\circ\varphi(X)^{2}-2w\circ\varphi(X)Y\mid\varphi(X)]\big{]}%
+\frac{1}{2}\mathbb{E}_{\mathcal{D}_{e}}[Y^{2}],
\displaystyle=\frac{1}{2}\mathbb{E}_{\mathcal{D}_{e}}\big{[}\mathbb{E}_{%
\mathcal{D}_{e}}[w\circ\varphi(X)^{2}-2w\circ\varphi(X)Y\mid\varphi(X)]\big{]}%
+\frac{1}{2}\mathbb{E}_{\mathcal{D}_{e}}[Y^{2}],
w
e\in\mathcal{E}
z\in\mathcal{Z}
\mathbb{E}_{\mathcal{D}_{e}}[w(z)^{2}-2w(z)Y\mid\varphi(X)=z]=w(z)^{2}-2w(z)%
\mathbb{E}_{\mathcal{D}_{e}}[Y\mid\varphi(X)=z].
\mathbb{E}_{\mathcal{D}_{e}}[Y^{2}]
\varphi(X)
f\equiv 0
e\in\mathcal{E}
e_{1},e_{2}\in\mathcal{E}
\mathcal{L}_{e_{1}}(f)=\mathcal{L}_{e_{2}}(f).
\ell_{\textup{log}}
w
\displaystyle w(z)=\log{\left(\frac{\Pr_{\mathcal{D}_{e}}[Y=1\mid\varphi(X)=z]%
}{\Pr_{\mathcal{D}_{e}}[Y=-1\mid\varphi(X)=z]}\right)}=\log{\left(\frac{1+%
\mathbb{E}_{\mathcal{D}_{e}}[Y\mid\varphi(X)=z]}{1-\mathbb{E}_{\mathcal{D}_{e}%
}[Y\mid\varphi(X)=z]}\right)},
\displaystyle w(z)=\log{\left(\frac{\Pr_{\mathcal{D}_{e}}[Y=1\mid\varphi(X)=z]%
}{\Pr_{\mathcal{D}_{e}}[Y=-1\mid\varphi(X)=z]}\right)}=\log{\left(\frac{1+%
\mathbb{E}_{\mathcal{D}_{e}}[Y\mid\varphi(X)=z]}{1-\mathbb{E}_{\mathcal{D}_{e}%
}[Y\mid\varphi(X)=z]}\right)},
e\in\mathcal{E}
z\in\mathcal{Z}
\mathcal{L}_{e}(f)=\mathbb{E}_{\mathcal{D}_{e}}[H(Y|\varphi(X)=z)]=H(Y|\varphi%
(X))
\alpha\in(0,1)
\mathcal{E}\coloneqq\{(\alpha,\beta_{e}):\beta_{e}\in(0,1)\}
f
\mathcal{I}_{X}(\mathcal{E})\cap\mathcal{I}_{\mathcal{S}}(\mathcal{E})=%
\mathcal{I}(\mathcal{E})
\mathcal{I}(\mathcal{E})
f_{0}\equiv 0
\ell_{\textup{sq}}
\ell_{\textup{log}}
f_{\textup{IRM}}(x_{1},x_{2})=(1-2\alpha)\cdot x_{1}
\ell=\ell_{\textup{sq}}
f_{\textup{IRM}}(x_{1},x_{2})=\log{\frac{1-\alpha}{\alpha}}\cdot x_{1}
\ell=\ell_{\textup{log}}
\ell_{\textup{sq}}
\mathcal{L}_{e}(f)=\frac{1}{2}\mathbb{E}_{\mathcal{D}_{e}}[f(X)^{2}-2f(X)Y+Y^{%
2}]
Y^{2}\equiv 1
f\in\mathcal{I}_{X}(\mathcal{E})
\mathbb{E}_{\mathcal{D}_{e}}[f(X)^{2}-2f(X)Y]
e\in\mathcal{E}
\displaystyle f\in\mathcal{I}_{\mathcal{S}}(\mathcal{E})\Rightarrow\nabla_{w%
\mid w=1}{\mathcal{L}_{e}(f)=0}\text{ for all }e\in\mathcal{E}
\displaystyle f\in\mathcal{I}_{\mathcal{S}}(\mathcal{E})
\displaystyle\Rightarrow\nabla_{w\mid w=1}{\mathcal{L}_{e}(f)=0}\text{ for all%
 }e\in\mathcal{E}
\displaystyle\Rightarrow\mathbb{E}_{\mathcal{D}_{e}}{[f(X)^{2}]}=\mathbb{E}_{%
\mathcal{D}_{e}}{[f(X)Y]}\text{ for all }e\in\mathcal{E}.
\displaystyle\Rightarrow\mathbb{E}_{\mathcal{D}_{e}}{[f(X)^{2}]}=\mathbb{E}_{%
\mathcal{D}_{e}}{[f(X)Y]}\text{ for all }e\in\mathcal{E}.
f\in\mathcal{I}_{X}(\mathcal{E})\cap\mathcal{I}_{\mathcal{S}}(\mathcal{E})
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}{[f(X)^{2}]}\text{ and }\mathbb{E}_{%
\mathcal{D}_{e}}{[f(X)Y]}\text{ are identical for all }e\in\mathcal{E},
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}{[f(X)^{2}]}\text{ and }\mathbb{E}_{%
\mathcal{D}_{e}}{[f(X)Y]}\text{ are identical for all }e\in\mathcal{E},
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}{[f(X)^{2}]}=\mathbb{E}_{\mathcal{D}_%
{e}}{[f(X)Y]}\text{ for all }e\in\mathcal{E}.
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}{[f(X)^{2}]}=\mathbb{E}_{\mathcal{D}_%
{e}}{[f(X)Y]}\text{ for all }e\in\mathcal{E}.
f_{(1,1)}\coloneqq f(X_{1}=1,X_{2}=1)
f_{(1,-1)},f_{(-1,1)},f_{(-1,-1)}
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}{[f(X)^{2}]}={}\frac{1-\alpha}{2}%
\left(f_{(1,1)}^{2}+f_{(-1,-1)}^{2}\right)+\frac{\alpha}{2}\left(f_{(1,-1)}^{2%
}+f_{(-1,1)}^{2}\right)
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}{[f(X)^{2}]}={}
\displaystyle\frac{1-\alpha}{2}\left(f_{(1,1)}^{2}+f_{(-1,-1)}^{2}\right)+%
\frac{\alpha}{2}\left(f_{(1,-1)}^{2}+f_{(-1,1)}^{2}\right)
\displaystyle+\frac{\beta_{e}(1-2\alpha)}{2}\left(-f_{(1,1)}^{2}-f_{(-1,-1)}^{%
2}+f_{(1,-1)}^{2}+f_{(-1,1)}^{2}\right),
\displaystyle+\frac{\beta_{e}(1-2\alpha)}{2}\left(-f_{(1,1)}^{2}-f_{(-1,-1)}^{%
2}+f_{(1,-1)}^{2}+f_{(-1,1)}^{2}\right),
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}{[f(X)Y]}={}\frac{1-\alpha}{2}\left(f%
_{(1,1)}-f_{(-1,-1)}\right)+\frac{\alpha}{2}\left(f_{(-1,1)}-f_{(1,-1)}\right)
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}{[f(X)Y]}={}
\displaystyle\frac{1-\alpha}{2}\left(f_{(1,1)}-f_{(-1,-1)}\right)+\frac{\alpha%
}{2}\left(f_{(-1,1)}-f_{(1,-1)}\right)
\displaystyle-\frac{\beta_{e}}{2}\left(f_{(1,1)}-f_{(-1,-1)}+f_{(-1,1)}-f_{(1,%
-1)}\right).
\displaystyle-\frac{\beta_{e}}{2}\left(f_{(1,1)}-f_{(-1,-1)}+f_{(-1,1)}-f_{(1,%
-1)}\right).
\alpha,\beta_{e}\in(0,1)
\begin{cases}f_{(1,1)}-f_{(-1,-1)}+f_{(-1,1)}-f_{(1,-1)}=0,\\
-f_{(1,1)}^{2}-f_{(-1,-1)}^{2}+f_{(1,-1)}^{2}+f_{(-1,1)}^{2}=0.\end{cases}%
\Rightarrow\begin{cases}f_{(1,1)}-f_{(-1,-1)}=-\left(f_{(-1,1)}-f_{(1,-1)}%
\right),\\
f_{(1,1)}^{2}+f_{(-1,-1)}^{2}=f_{(1,-1)}^{2}+f_{(-1,1)}^{2}.\end{cases}
f_{(1,1)}^{2}+f_{(-1,-1)}^{2}=(1-2\alpha)\left(f_{(1,1)}-f_{(-1,-1)}\right)
f
f_{0}
f_{\textup{IRM}}
f
f_{(1,1)}=-f_{(-1,-1)}
f_{(1,-1)}=-f_{(-1,1)}
\mathcal{I}_{X}(\mathcal{E})\cap\mathcal{I}_{\mathcal{S}}(\mathcal{E})
f_{(1,1)}=f_{(-1,-1)}=f_{(1,-1)}=f_{(-1,1)}=0
\begin{cases}f_{(1,1)}=1-2\alpha,\\
f_{(-1,-1)}=2\alpha-1,\\
f_{(1,-1)}=1-2\alpha,\\
f_{(-1,1)}=2\alpha-1.\end{cases}\Rightarrow f(x_{1},x_{2})=(1-2\alpha)\cdot x_%
{1}.
\ell_{\textup{log}}
\mathcal{L}_{e}(f)=\mathbb{E}_{\mathcal{D}_{e}}\big{[}\log{\big{(}1+\exp{(-f(X%
)Y)}\big{)}}\big{]}
f\in\mathcal{I}_{X}(\mathcal{E})\cap\mathcal{I}_{\mathcal{S}}(\mathcal{E})
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}\big{[}\log{\big{(}1+\exp{(-f(X)Y)}%
\big{)}}\big{]}\text{ is identical for all }e\in\mathcal{E},
\displaystyle\mathbb{E}_{\mathcal{D}_{e}}\left[\frac{-f(X)Y}{1+\exp{(f(X)Y)}}%
\right]=0.
f
f_{(1,1)}=-f_{(-1,-1)}
f_{(1,-1)}=-f_{(-1,1)}
\frac{(1+e^{f_{(1,1)}})^{2\alpha}}{(1+e^{-f_{(1,1)}})^{2-2\alpha}}=\frac{(1+e^%
{f_{(1,-1)}})^{2\alpha}}{(1+e^{-f_{(1,-1)}})^{2-2\alpha}}\Rightarrow f_{(1,1)}%
=f_{(1,-1)},
\frac{(1+e^{x})^{2\alpha}}{(1+e^{-x})^{2-2\alpha}}
e^{f_{(1,1)}}f_{(1,1)}\alpha-f_{(1,1)}(1-\alpha)=0\Rightarrow f_{(1,1)}=0\text%
{ or }f_{(1,1)}=\log{\frac{1-\alpha}{\alpha}}.
\mathcal{I}_{X}(\mathcal{E})\cap\mathcal{I}_{\mathcal{S}}(\mathcal{E})
f_{0}
f_{\textup{IRM}}
\alpha\in(0,1)
\mathcal{E}_{\textup{tr}}=\{(\alpha,\beta_{e_{1}}),(\alpha,\beta_{e_{2}})\}
\beta_{e_{1}},\beta_{e_{2}}\in(0,1)
\mathcal{I}_{X}(\mathcal{E}_{\textup{tr}})\cap\mathcal{I}_{\mathcal{S}}(%
\mathcal{E}_{\textup{tr}})=\mathcal{I}_{X}(\mathcal{E})\cap\mathcal{I}_{%
\mathcal{S}}(\mathcal{E})
\beta_{e_{1}},\beta_{e_{2}}
f
\gamma\in(0,1)
\epsilon,\delta>0
{\mathcal{F}}
I_{\text{PAIR}}
p_{\max}\coloneqq\max_{i\in I_{\text{PAIR}}}{p_{i}}
L_{\textup{max}}\coloneqq\max_{i\in I_{\text{PAIR}}}{L_{i}}
\lvert D\rvert\geq\frac{32L_{\textup{max}}^{2}p_{\max}^{2}}{\delta^{2}}\log{%
\frac{2(m+1)\lvert\mathcal{F}\rvert}{\gamma}}
1-\gamma
\epsilon
f_{\text{ood}}
{\bm{p}}_{\text{ood}}
\epsilon
{\bm{p}}_{\text{ood}}=(p_{\text{ERM}},p_{1},...,p_{m})^{T}=(\frac{1}{\epsilon_%
{\text{inv}}},\bm{\frac{1}{\epsilon}_{\text{ood}}})^{T}
{\mathcal{L}}_{\text{ERM}}
m
\bm{L}_{\text{ood}}=({\mathcal{L}}_{\text{ood}}^{1},{\mathcal{L}}_{\text{ood}}%
^{2},..,{\mathcal{L}}_{\text{ood}}^{m})^{T}
\displaystyle\bm{f}_{\text{PAIR}}\coloneqq{}\operatorname*{arg\,min}_{f\in%
\mathcal{F}}
\displaystyle\bm{f}_{\text{PAIR}}\coloneqq{}
\displaystyle\operatorname*{arg\,min}_{f\in\mathcal{F}}
\displaystyle{\mathcal{L}_{\text{ERM}}(f)}
\displaystyle{\mathcal{L}_{\text{ERM}}(f)}
\displaystyle p_{\text{ERM}}\mathcal{L}_{\text{ERM}}(f)=p_{1}\mathcal{L}_{%
\text{ood}}^{1}(f)=p_{2}\mathcal{L}_{\text{ood}}^{2}(f)=\cdots=p_{m}\mathcal{L%
}_{\text{ood}}^{m}(f).
\displaystyle p_{\text{ERM}}\mathcal{L}_{\text{ERM}}(f)=p_{1}\mathcal{L}_{%
\text{ood}}^{1}(f)=p_{2}\mathcal{L}_{\text{ood}}^{2}(f)=\cdots=p_{m}\mathcal{L%
}_{\text{ood}}^{m}(f).
\bm{f}_{\text{PAIR}}=f_{\text{ood}}
\bm{f}_{\text{PAIR}}
\epsilon
\displaystyle\bm{f}^{\epsilon}_{\text{PAIR}}\coloneqq{}\operatorname*{arg\,min%
}_{f\in\mathcal{F}}
\displaystyle\bm{f}^{\epsilon}_{\text{PAIR}}\coloneqq{}
\displaystyle\operatorname*{arg\,min}_{f\in\mathcal{F}}
\displaystyle{\mathcal{L}_{\text{ERM}}(f)}
\displaystyle{\mathcal{L}_{\text{ERM}}(f)}
\displaystyle\forall i,j\in I_{\text{PAIR}},i\neq j,\,\lvert p_{i}\mathcal{L}_%
{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq\epsilon,
\displaystyle\forall i,j\in I_{\text{PAIR}},i\neq j,\,\lvert p_{i}\mathcal{L}_%
{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq\epsilon,
I_{\text{PAIR}}\coloneqq\{\text{ERM},\text{ood}_{1},\text{ood}_{2},\ldots,%
\text{ood}_{m}\}
\bm{P}^{\epsilon}_{\text{PAIR}}\coloneqq\{f\mid\forall i,j\in I_{\text{PAIR}},%
i\neq j,\,\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq\epsilon\}
\bm{f}^{0}_{\text{PAIR}}=\bm{f}_{\text{PAIR}}
\epsilon
{\bm{p}}_{\text{ood}}
\displaystyle\hat{\bm{f}}^{\epsilon}_{\text{PAIR}}\coloneqq{}\operatorname*{%
arg\,min}_{f\in\mathcal{F}}
\displaystyle\hat{\bm{f}}^{\epsilon}_{\text{PAIR}}\coloneqq{}
\displaystyle\operatorname*{arg\,min}_{f\in\mathcal{F}}
\displaystyle{\widehat{\mathcal{L}}_{\text{ERM}}(f)}
\displaystyle{\widehat{\mathcal{L}}_{\text{ERM}}(f)}
\displaystyle\forall i,j\in I_{\text{PAIR}},i\neq j,\,\lvert p_{i}\widehat{%
\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)\rvert\leq\epsilon.
\displaystyle\forall i,j\in I_{\text{PAIR}},i\neq j,\,\lvert p_{i}\widehat{%
\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)\rvert\leq\epsilon.
\widehat{\bm{P}}^{\epsilon}_{\text{PAIR}}\coloneqq\{f\mid\forall i,j\in I_{%
\text{PAIR}},i\neq j,\,\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}\widehat{%
\mathcal{L}}_{j}(f)\rvert\leq\epsilon\}
\mathcal{F}
\delta=\min_{f\in\mathcal{F},\forall i,j\in I_{\text{PAIR}},i\neq j}{\big{%
\lvert}\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert-\epsilon%
\big{\rvert}}.
\nu
S
\nu
\mathcal{X}
\mathcal{F}
\ell
\mathcal{D}
\forall f\in\mathcal{F},\lvert\widehat{\mathcal{L}}(f)-\mathcal{L}(f)\rvert%
\leq\nu,
\mathcal{L}(f)\coloneqq\mathbb{E}_{(X,Y)\sim\mathcal{D}}[\ell(f(X),Y)]
\widehat{\mathcal{L}}(f)\coloneqq\frac{1}{\lvert S\rvert}\sum_{(X_{i},Y_{i})%
\in S}\ell(f(X_{i}),Y_{i})
\epsilon>0
\delta>0
p_{\max}\coloneqq\max_{i\in I_{\text{PAIR}}}{p_{i}}
\mathcal{D_{\mathrm{tr}}}
\frac{\delta}{4p_{\max}}
\mathcal{X}
\mathcal{F}
\mathcal{D}
\{\mathcal{L}_{\text{ERM}},\bm{L}_{\text{ood}}\}
\bm{P}^{\epsilon}_{\text{PAIR}}=\widehat{\bm{P}}^{\epsilon}_{\text{PAIR}}
\bm{P}^{\epsilon}_{\text{PAIR}}\subseteq\widehat{\bm{P}}^{\epsilon}_{\text{%
PAIR}}
\delta
f\in\mathcal{F}
\forall i,j\in I_{\text{PAIR}},i\neq j
\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq\epsilon-%
\delta\,\text{ or }\,\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)%
\rvert\geq\epsilon+\delta.
f\in\bm{P}^{\epsilon}_{\text{PAIR}}
\forall i,j\in I_{\text{PAIR}},i\neq j
\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq\epsilon%
\Rightarrow\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq%
\epsilon-\delta.
\displaystyle\lvert p_{i}\mathcal{L}_{i}(f)-p_{i}\widehat{\mathcal{L}}_{i}(f)+%
p_{j}\widehat{\mathcal{L}}_{j}(f)-p_{j}\mathcal{L}_{j}(f)+p_{i}\widehat{%
\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)\rvert\leq\epsilon-\delta
\displaystyle\lvert p_{i}\mathcal{L}_{i}(f)-p_{i}\widehat{\mathcal{L}}_{i}(f)+%
p_{j}\widehat{\mathcal{L}}_{j}(f)-p_{j}\mathcal{L}_{j}(f)+p_{i}\widehat{%
\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)\rvert\leq\epsilon-\delta
\displaystyle\Rightarrow{}\big{\lvert}\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)%
-p_{j}\widehat{\mathcal{L}}_{j}(f)\rvert-\lvert p_{i}\mathcal{L}_{i}(f)-p_{i}%
\widehat{\mathcal{L}}_{i}(f)+p_{j}\widehat{\mathcal{L}}_{j}(f)-p_{j}\mathcal{L%
}_{j}(f)\rvert\big{\rvert}\leq\epsilon-\delta
\displaystyle\Rightarrow{}
\displaystyle\big{\lvert}\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}%
\widehat{\mathcal{L}}_{j}(f)\rvert-\lvert p_{i}\mathcal{L}_{i}(f)-p_{i}%
\widehat{\mathcal{L}}_{i}(f)+p_{j}\widehat{\mathcal{L}}_{j}(f)-p_{j}\mathcal{L%
}_{j}(f)\rvert\big{\rvert}\leq\epsilon-\delta
\displaystyle\Rightarrow{}\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}%
\widehat{\mathcal{L}}_{j}(f)\rvert\leq\epsilon-\delta+\lvert p_{i}\mathcal{L}_%
{i}(f)-p_{i}\widehat{\mathcal{L}}_{i}(f)+p_{j}\widehat{\mathcal{L}}_{j}(f)-p_{%
j}\mathcal{L}_{j}(f)\rvert
\displaystyle\Rightarrow{}
\displaystyle\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L%
}}_{j}(f)\rvert\leq\epsilon-\delta+\lvert p_{i}\mathcal{L}_{i}(f)-p_{i}%
\widehat{\mathcal{L}}_{i}(f)+p_{j}\widehat{\mathcal{L}}_{j}(f)-p_{j}\mathcal{L%
}_{j}(f)\rvert
\displaystyle\Rightarrow{}\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}%
\widehat{\mathcal{L}}_{j}(f)\rvert\leq\epsilon-\delta+p_{i}\lvert\mathcal{L}_{%
i}(f)-\widehat{\mathcal{L}}_{i}(f)\rvert+p_{j}\lvert\widehat{\mathcal{L}}_{j}(%
f)-\mathcal{L}_{j}(f)\rvert,
\displaystyle\Rightarrow{}
\displaystyle\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L%
}}_{j}(f)\rvert\leq\epsilon-\delta+p_{i}\lvert\mathcal{L}_{i}(f)-\widehat{%
\mathcal{L}}_{i}(f)\rvert+p_{j}\lvert\widehat{\mathcal{L}}_{j}(f)-\mathcal{L}_%
{j}(f)\rvert,
\frac{\delta}{4p_{\max}}
\lvert\mathcal{L}_{i}(f)-\widehat{\mathcal{L}}_{i}(f)\rvert\leq\frac{\delta}{4%
p_{\max}},\forall i\in I_{\text{PAIR}}
\displaystyle\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L%
}}_{j}(f)\rvert\leq\epsilon-\delta+\frac{p_{i}\delta}{4p_{\max}}+\frac{p_{j}%
\delta}{4p_{\max}}
\displaystyle\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L%
}}_{j}(f)\rvert
\displaystyle\leq\epsilon-\delta+\frac{p_{i}\delta}{4p_{\max}}+\frac{p_{j}%
\delta}{4p_{\max}}
\displaystyle\leq\epsilon-\frac{\delta}{2},
\displaystyle\leq\epsilon-\frac{\delta}{2},
f\in\widehat{\bm{P}}^{\epsilon}_{\text{PAIR}}
\widehat{\bm{P}}^{\epsilon}_{\text{PAIR}}\subseteq\bm{P}^{\epsilon}_{\text{%
PAIR}}
f\in\widehat{\bm{P}}^{\epsilon}_{\text{PAIR}}
\forall i,j\in I_{\text{PAIR}},i\neq j
\displaystyle\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L%
}}_{j}(f)\rvert\leq\epsilon
\displaystyle\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{j}\widehat{\mathcal{L%
}}_{j}(f)\rvert\leq\epsilon
\displaystyle\Rightarrow{}\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{i}%
\mathcal{L}_{i}(f)+p_{j}\mathcal{L}_{j}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)+p%
_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq\epsilon
\displaystyle\Rightarrow{}
\displaystyle\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{i}\mathcal{L}_{i}(f)+%
p_{j}\mathcal{L}_{j}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)+p_{i}\mathcal{L}_{i}%
(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq\epsilon
\displaystyle\Rightarrow{}\big{\lvert}\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}%
\mathcal{L}_{j}(f)\rvert-\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{i}%
\mathcal{L}_{i}(f)+p_{j}\mathcal{L}_{j}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)%
\rvert\big{\rvert}\leq\epsilon
\displaystyle\Rightarrow{}
\displaystyle\big{\lvert}\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f%
)\rvert-\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{i}\mathcal{L}_{i}(f)+p_{j}%
\mathcal{L}_{j}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)\rvert\big{\rvert}\leq\epsilon
\displaystyle\Rightarrow{}\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(%
f)\rvert\leq\epsilon+\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{i}\mathcal{L}%
_{i}(f)+p_{j}\mathcal{L}_{j}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)\rvert
\displaystyle\Rightarrow{}
\displaystyle\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq%
\epsilon+\lvert p_{i}\widehat{\mathcal{L}}_{i}(f)-p_{i}\mathcal{L}_{i}(f)+p_{j%
}\mathcal{L}_{j}(f)-p_{j}\widehat{\mathcal{L}}_{j}(f)\rvert
\displaystyle\Rightarrow{}\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(%
f)\rvert\leq\epsilon+p_{i}\lvert\widehat{\mathcal{L}}_{i}(f)-\mathcal{L}_{i}(f%
)\rvert+p_{j}\lvert\mathcal{L}_{j}(f)-\widehat{\mathcal{L}}_{j}(f)\rvert
\displaystyle\Rightarrow{}
\displaystyle\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq%
\epsilon+p_{i}\lvert\widehat{\mathcal{L}}_{i}(f)-\mathcal{L}_{i}(f)\rvert+p_{j%
}\lvert\mathcal{L}_{j}(f)-\widehat{\mathcal{L}}_{j}(f)\rvert
\displaystyle\Rightarrow{}\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(%
f)\rvert\leq\epsilon+\frac{p_{i}\delta}{4p_{\max}}+\frac{p_{j}\delta}{4p_{\max}}
\displaystyle\Rightarrow{}
\displaystyle\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq%
\epsilon+\frac{p_{i}\delta}{4p_{\max}}+\frac{p_{j}\delta}{4p_{\max}}
\displaystyle{\color[rgb]{1,1,1}\Rightarrow{}}{\color[rgb]{1,1,1}\lvert p_{i}%
\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert}\leq\epsilon+\frac{\delta}{2},
\displaystyle{\color[rgb]{1,1,1}\Rightarrow{}}
\displaystyle{\color[rgb]{1,1,1}\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L%
}_{j}(f)\rvert}\leq\epsilon+\frac{\delta}{2},
\frac{\delta}{4p_{\max}}
\lvert p_{i}\mathcal{L}_{i}(f)-p_{j}\mathcal{L}_{j}(f)\rvert\leq\epsilon-%
\delta\Rightarrow f\in\bm{P}^{\epsilon}_{\text{PAIR}}
\widehat{\bm{P}}^{\epsilon}_{\text{PAIR}}\subseteq\bm{P}^{\epsilon}_{\text{%
PAIR}}
\bm{P}^{\epsilon}_{\text{PAIR}}=\widehat{\bm{P}}^{\epsilon}_{\text{PAIR}}
f\in\mathcal{F},X\in\mathcal{X},Y\in\mathcal{Y}
\lvert\ell(f(X),Y)\rvert\leq L_{\text{ERM}}<\infty
\bm{L}_{\text{ood}}
\forall i\in[m],\mathcal{L}_{\text{ood}}^{i}(f)=\mathbb{E}_{(X,Y)\sim\mathcal{%
D}}[\ell_{\text{ood}}^{i}(f(X),Y)]
\lvert\ell_{\text{ood}}^{i}(f(X),Y)\rvert\leq L_{\text{ood}}^{i}<\infty
\epsilon>0,\gamma\in(0,1)
\delta>0
p_{\max}\coloneqq\max_{i\in I_{\text{PAIR}}}{p_{i}}
L_{\textup{max}}\coloneqq\max_{i\in I_{\text{PAIR}}}{L_{i}}
\lvert\mathcal{D_{\mathrm{tr}}}\rvert\geq\frac{32L_{\textup{max}}^{2}p_{\max}^%
{2}}{\delta^{2}}\log{\frac{2(m+1)\lvert\mathcal{F}\rvert}{\gamma}}
1-\gamma
f^{\epsilon}_{\text{PAIR}}\in\bm{f}^{\epsilon}_{\text{PAIR}}
\hat{f}^{\epsilon}_{\text{PAIR}}\in\hat{\bm{f}}^{\epsilon}_{\text{PAIR}}
\mathcal{L}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}})\leq\mathcal{L}_{\text{ERM%
}}(\hat{f}^{\epsilon}_{\text{PAIR}})\leq\mathcal{L}_{\text{ERM}}(f^{\epsilon}_%
{\text{PAIR}})+\frac{\delta}{2p_{\max}}
D
\frac{\delta}{4p_{\max}}
\mathcal{X}
\mathcal{F}
\mathcal{D}
\{\mathcal{L}_{\text{ERM}},\bm{L}_{\text{ood}}\}
\bm{P}^{\epsilon}_{\text{PAIR}}=\widehat{\bm{P}}^{\epsilon}_{\text{PAIR}}
\mathcal{D_{\mathrm{tr}}}
\frac{\delta}{4p_{\max}}
\mathcal{L}_{\text{ERM}}
f^{\epsilon}_{\text{PAIR}}\in\bm{f}^{\epsilon}_{\text{PAIR}}
\hat{f}^{\epsilon}_{\text{PAIR}}\in\hat{\bm{f}}^{\epsilon}_{\text{PAIR}}
\begin{gathered}\big{\lvert}\mathcal{L}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}%
})-\widehat{\mathcal{L}}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}})\big{\rvert}%
\leq\frac{\delta}{4p_{\max}},\\
\big{\lvert}\mathcal{L}_{\text{ERM}}(\hat{f}^{\epsilon}_{\text{PAIR}})-%
\widehat{\mathcal{L}}_{\text{ERM}}(\hat{f}^{\epsilon}_{\text{PAIR}})\big{%
\rvert}\leq\frac{\delta}{4p_{\max}}.\end{gathered}
\displaystyle\mathcal{L}_{\text{ERM}}(\hat{f}^{\epsilon}_{\text{PAIR}})-\frac{%
\delta}{4p_{\max}}\leq\widehat{\mathcal{L}}_{\text{ERM}}(\hat{f}^{\epsilon}_{%
\text{PAIR}})\leq\widehat{\mathcal{L}}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}}%
)\leq\mathcal{L}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}})+\frac{\delta}{4p_{%
\max}}
\displaystyle\mathcal{L}_{\text{ERM}}(\hat{f}^{\epsilon}_{\text{PAIR}})-\frac{%
\delta}{4p_{\max}}\leq\widehat{\mathcal{L}}_{\text{ERM}}(\hat{f}^{\epsilon}_{%
\text{PAIR}})\leq\widehat{\mathcal{L}}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}}%
)\leq\mathcal{L}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}})+\frac{\delta}{4p_{%
\max}}
\displaystyle\Rightarrow{}\mathcal{L}_{\text{ERM}}(\hat{f}^{\epsilon}_{\text{%
PAIR}})\leq\mathcal{L}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}})+\frac{\delta}{%
2p_{\max}}.
\displaystyle\Rightarrow{}
\displaystyle\mathcal{L}_{\text{ERM}}(\hat{f}^{\epsilon}_{\text{PAIR}})\leq%
\mathcal{L}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}})+\frac{\delta}{2p_{\max}}.
\mathcal{L}_{\text{ERM}}(f^{\epsilon}_{\text{PAIR}})\leq\mathcal{L}_{\text{ERM%
}}(\hat{f}^{\epsilon}_{\text{PAIR}})\leq\mathcal{L}_{\text{ERM}}(f^{\epsilon}_%
{\text{PAIR}})+\frac{\delta}{2p_{\max}}.
\mathcal{D_{\mathrm{tr}}}
\frac{\delta}{4p_{\max}}
\mathcal{X}
\mathcal{F}
\mathcal{D}
\{\mathcal{L}_{\text{ERM}},\bm{L}_{\text{ood}}\}
i\in I_{\text{PAIR}}
\mathcal{L}_{i}(f)=\mathbb{E}_{(X,Y)\sim\mathcal{D}}[\ell_{i}(f(X),Y)]
\widehat{\mathcal{L}}_{i}(f)=\frac{1}{\lvert D\rvert}\sum_{(X_{j},Y_{j})\in D}%
\ell_{i}(f(X_{j}),Y_{j})
\lvert\ell_{i}(f(X),Y)\rvert\leq L_{i}\leq L_{\textup{max}},\forall f,X,Y
f\in\mathcal{F}
\Pr\left[\big{\lvert}\widehat{\mathcal{L}}_{i}(f)-\mathcal{L}_{i}(f)\big{%
\rvert}\geq\frac{\delta}{4p_{\max}}\right]\leq 2\exp{\left(\frac{-\lvert D%
\rvert\delta^{2}}{32L_{\textup{max}}^{2}p_{\max}^{2}}\right)}.
\gamma\in(0,1)
\lvert D\rvert\geq\frac{32L_{\textup{max}}^{2}p_{\max}^{2}}{\delta^{2}}\log{%
\frac{2(m+1)\lvert\mathcal{F}\rvert}{\gamma}},
\Pr\left[\exists f\in\mathcal{F},\big{\lvert}\widehat{\mathcal{L}}_{i}(f)-%
\mathcal{L}_{i}(f)\big{\rvert}\geq\frac{\delta}{4p_{\max}}\right]\leq\sum_{f%
\in\mathcal{F}}{\Pr\left[\big{\lvert}\widehat{\mathcal{L}}_{i}(f)-\mathcal{L}_%
{i}(f)\big{\rvert}\geq\frac{\delta}{4p_{\max}}\right]}\leq\frac{\gamma}{m+1}.
\displaystyle\Pr\left[\exists i\in I_{\text{PAIR}},\exists f\in\mathcal{F},%
\big{\lvert}\widehat{\mathcal{L}}_{i}(f)-\mathcal{L}_{i}(f)\big{\rvert}\geq%
\frac{\delta}{4p_{\max}}\right]
\displaystyle\Pr\left[\exists i\in I_{\text{PAIR}},\exists f\in\mathcal{F},%
\big{\lvert}\widehat{\mathcal{L}}_{i}(f)-\mathcal{L}_{i}(f)\big{\rvert}\geq%
\frac{\delta}{4p_{\max}}\right]
\displaystyle\leq{}\sum_{i\in I_{\text{PAIR}}}{\Pr\left[\exists f\in\mathcal{F%
},\big{\lvert}\widehat{\mathcal{L}}_{i}(f)-\mathcal{L}_{i}(f)\big{\rvert}\geq%
\frac{\delta}{4p_{\max}}\right]}\leq\gamma.
\displaystyle\leq{}
\displaystyle\sum_{i\in I_{\text{PAIR}}}{\Pr\left[\exists f\in\mathcal{F},\big%
{\lvert}\widehat{\mathcal{L}}_{i}(f)-\mathcal{L}_{i}(f)\big{\rvert}\geq\frac{%
\delta}{4p_{\max}}\right]}\leq\gamma.
1-\gamma
\forall i\in I_{\text{PAIR}},\forall f\in\mathcal{F},
\big{\lvert}\widehat{\mathcal{L}}_{i}(f)-\mathcal{L}_{i}(f)\big{\rvert}\leq%
\frac{\delta}{4p_{\max}},
\epsilon
\displaystyle\bm{f}_{\text{PAIR}}\coloneqq{}\operatorname*{arg\,min}_{f\in%
\mathcal{F}}
\displaystyle\bm{f}_{\text{PAIR}}\coloneqq{}
\displaystyle\operatorname*{arg\,min}_{f\in\mathcal{F}}
\displaystyle{\mathcal{L}_{\text{ERM}}(f)}
\displaystyle{\mathcal{L}_{\text{ERM}}(f)}
\displaystyle\mathcal{L}^{i}_{\text{PAIR}}(f)\leq\epsilon_{i},\forall i\in[m].
\displaystyle\mathcal{L}^{i}_{\text{PAIR}}(f)\leq\epsilon_{i},\forall i\in[m].
\epsilon
\epsilon_{i}\rightarrow\text{$\epsilon_{\text{ood}}$}_{i}
f_{\text{ood}}
\epsilon
4
256
1e-3
1e-3
500
\{0,50,100,150,200,250\}
\{1e1,1e2,1e3,1e4,1e5\}
10
0.9
0.01
0.1
\{1,1e1,1e2,1e3,1e4,1e5,1e6\}
\{0,50,100,150,200,250\}
\{1,1e1,1e2,1e3,1e4,1e5,1e6\}
1e6
1e12
\{1,1e1,1e2,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12\}
\{1e-2,1,1e2\}
1e-2
1e2
1e-2
1e2
1e-2
72.5
\pm
73.8
\pm
73.1
\pm
1e-2
33.64
\pm
34.20
\pm
34.43
\pm
73.5
\pm
74.3
\pm
73.2
\pm
30.25
\pm
33.75
\pm
33.7
\pm
1e2
72.1
\pm
70.1
\pm
74.3
\pm
1e2
21.33
\pm
21.00
\pm
13.14
\pm
\mathbf{75.2}
\pm
\mathbf{35.5}
\pm
[0,1]
1
0
0.01
150
x
y
x
y
\{(0.25,0.10),(0.25,0.20)\}
1e-3
1e5
2
\{0.01,0.02,0.04,0.1,0.2\}
\{0.1,0.2,0.4,0.8,1\}
1e12
1e8
1e8
1e12
\Delta
17.14
\pm
73.30
\pm
45.22
67.29
\pm
76.89
\pm
72.09
+0.00
55.48
\pm
76.01
\pm
65.75
\checkmark
56.09
\pm
75.66
\pm
65.88
-6.21
\checkmark
\checkmark
61.12
\pm
83.30
\pm
72.21
+0.12
\checkmark
\checkmark
\checkmark
60.69
\pm
83.70
\pm
72.20
+0.11
68.62
\pm
83.52
\pm
76.07
\checkmark
66.19
\pm
81.75
\pm
73.97
+1.88
\checkmark
\checkmark
68.89
\pm
\underline{83.80}
\pm
\underline{76.35}
+4.26
\checkmark
\checkmark
\checkmark
\underline{69.16}
\pm
\mathbf{83.96}
\pm
\mathbf{76.56}
+4.47
\mathbf{69.38}
\pm
77.29
\pm
73.34
\checkmark
66.20
\pm
81.07
\pm
73.63
+1.54
\checkmark
\checkmark
68.90
\pm
82.70
\pm
75.80
+2.49
\checkmark
\checkmark
\checkmark
68.78
\pm
84.02
\pm
76.40
+3.31
55.55
\pm
74.20
\pm
64.88
\checkmark
66.35
\pm
77.70
\pm
72.02
-0.07
\checkmark
\checkmark
64.99
\pm
75.70
\pm
70.35
-1.75
\checkmark
\checkmark
\checkmark
65.55
\pm
77.29
\pm
71.42
-0.67
58.67
\pm
76.27
\pm
68.97
\checkmark
51.22
\pm
74.20
\pm
62.71
-9.38
\checkmark
\checkmark
66.17
\pm
81.84
\pm
74.01
+1.91
\checkmark
\checkmark
\checkmark
66.51
\pm
82.12
\pm
74.32
+2.23
62.31
\pm
76.73
\pm
69.52
\checkmark
62.48
\pm
81.24
\pm
71.86
-0.23
\checkmark
\checkmark
59.52
\pm
82.82
\pm
71.17
-0.92
\checkmark
\checkmark
\checkmark
65.54
\pm
83.57
\pm
74.56
+2.47
72.08
\pm
86.53
\pm
79.31
79.31
\{0.01,0.02,0.04,0.1,0.2\}
1e12
1e8
1e2
(1e8,1e10,1e12)
\Delta
17.14
\pm
73.30
\pm
45.22
67.29
\pm
76.89
\pm
72.09
+0.00
\checkmark
56.09
\pm
75.66
\pm
65.88
-6.21
\checkmark
61.12
\pm
83.30
\pm
72.21
+0.12
\checkmark
60.69
\pm
83.70
\pm
72.20
+0.11
\checkmark
66.19
\pm
81.75
\pm
73.97
+1.88
\checkmark
68.89
\pm
83.80
\pm
76.35
+4.26
\checkmark
\mathbf{69.16}
\pm
\underline{83.96}
\pm
\underline{76.56}
\underline{+4.47}
\checkmark
66.20
\pm
81.07
\pm
73.63
+1.54
\checkmark
66.45
\pm
82.70
\pm
74.58
+2.49
\checkmark
67.57
\pm
83.22
\pm
75.40
+3.31
\checkmark
\checkmark
52.61
\pm
63.84
\pm
58.23
-13.9
\checkmark
\checkmark
68.35
\pm
81.25
\pm
74.80
+2.71
\checkmark
\checkmark
\underline{69.05}
\pm
83.11
\pm
76.08
+3.99
\checkmark
\checkmark
51.91
\pm
68.88
\pm
60.39
-11.7
\checkmark
\checkmark
59.70
\pm
74.59
\pm
67.15
-4.94
\checkmark
\checkmark
66.98
\pm
75.91
\pm
71.45
-0.65
\checkmark
\checkmark
64.83
\pm
79.34
\pm
72.09
+0.00
\checkmark
\checkmark
67.96
\pm
81.44
\pm
74.70
+2.61
\checkmark
\checkmark
68.19
\pm
81.89
\pm
75.04
+2.95
\checkmark
\checkmark
\checkmark
50.00
\pm
69.60
\pm
59.80
-12.3
\checkmark
\checkmark
\checkmark
66.89
\pm
83.46
\pm
75.18
+3.08
\checkmark
\checkmark
\checkmark
68.59
\pm
\mathbf{85.30}
\pm
\mathbf{76.95}
\mathbf{+4.85}
72.08
\pm
86.53
\pm
79.31
6
x
\#
\#
450,000
5
96\times 96
d
3
4
5
450,000
d
16
5
62
2013
2013
2015
2015
203,029
19,669
23
2009
2016
1,139
3
0,1,2
10
0
9
5
0
4
k
1
1e-4
1e-2
(1,1e10,1e12)
1e2
\times
\times
3
3
7
d\in\{90\%,80\%,10\%\}
(2,28,28)
d\in\{
\}
(3,224,224)
d\in\{
\}
(3,224,224)
0.00005
10^{\text{Uniform}(-5,-3.5)}
2^{\text{Uniform}(3,5.5)}
2^{\text{Uniform}(3,5)}
10^{\text{Uniform}(-6,-2)}
([0,0.1,0.5])
0.001
10^{\text{Uniform}(-4.5,-3.5)}
2^{\text{Uniform}(3,9)}
\lambda
10^{\text{Uniform}(1,4)}
\gamma
(0.9,0.99)
(0,5000)
80\%
20\%
20\%
20\%
3
20
20
1
20
5
10
50\%
9
5
10
\bm{L}
100
14.3\%
7.3\%
3.1\%
1.0\%
\Delta
\Delta
\Delta
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\Delta
\Delta
\Delta
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\Delta
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\Delta
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\Delta
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\Delta
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\Delta
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\Delta
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\checkmark
\pm
\pm
\pm
\pm
