0.1\%
<0.004\%
\mathcal{T}
\mathcal{T}:\mathbb{R}^{H\times W\times 3}\to\mathbb{R}^{H\times W\times C_{%
\mathcal{T}}},\quad C_{\mathcal{T}}\in\mathbb{N}.
C_{\mathcal{T}}
\mathcal{F}
\mathcal{T}
\hat{Y}^{q}
X^{q}
\mathcal{S}_{\mathcal{T}}
\hat{Y}^{q}=\mathcal{F}(X^{q};\mathcal{S}_{\mathcal{T}}),\quad\mathcal{S}_{%
\mathcal{T}}=\{(X^{i},Y^{i})\}_{i\leq N}.
\mathcal{F}
\mathcal{D}_{\text{train}}
\mathcal{T}_{\text{train}}
\mathcal{T}_{\text{test}}
\mathcal{D}_{\text{train}}
C_{\mathcal{T}}
\mathcal{T}:\mathbb{R}^{H\times W\times 3}\to\mathbb{R}^{H\times W\times C_{%
\mathcal{T}}}
C_{\mathcal{T}}
\mathcal{T}_{1},\cdots,\mathcal{T}_{C_{\mathcal{T}}}
\mathcal{T}_{c}:\mathbb{R}^{H\times W\times 3}\to\mathbb{R}^{H\times W\times 1}
\mathcal{F}
\mathcal{T}_{\text{test}}
\mathcal{T}_{\text{test}}
\mathcal{T}_{\text{test}}
\mathcal{D}_{\text{train}}
\mathcal{T}_{\text{test}}
\mathcal{T}
\mathcal{S}_{\mathcal{T}}
\mathcal{T}_{\text{train}}
\mathcal{S}_{\mathcal{T}_{\text{test}}}
X=\{\mathbf{x}_{j}\}_{j\leq M}
M=h\times w
\mathbf{x}_{j}
j
X^{q}=\{\mathbf{x}^{q}_{j}\}_{j\leq M}
\{(X^{i},Y^{i})\}_{i\leq N}=\{(\mathbf{x}_{k}^{i},\mathbf{y}_{k}^{i})\}_{k\leq
M%
,i\leq N}
\mathcal{T}
Y^{q}=\{\mathbf{y}_{j}^{q}\}_{j\leq M}
\displaystyle g(\mathbf{y}^{q}_{j})=\sum_{i\leq N}\sum_{k\leq M}\sigma\left(f_%
{\mathcal{T}}(\mathbf{x}^{q}_{j}),f_{\mathcal{T}}(\mathbf{x}^{i}_{k})\right)g(%
\mathbf{y}^{i}_{k}),
\displaystyle g(\mathbf{y}^{q}_{j})=\sum_{i\leq N}\sum_{k\leq M}\sigma\left(f_%
{\mathcal{T}}(\mathbf{x}^{q}_{j}),f_{\mathcal{T}}(\mathbf{x}^{i}_{k})\right)g(%
\mathbf{y}^{i}_{k}),
f_{\mathcal{T}}(\mathbf{x})=f(\mathbf{x};\theta,\theta_{\mathcal{T}})\in%
\mathbb{R}^{d}
g(\mathbf{y})=g(\mathbf{y};\phi)\in\mathbb{R}^{d}
\sigma:\mathbb{R}^{d}\times\mathbb{R}^{d}\to[0,1]
\hat{\mathbf{y}}^{q}_{j}=h(g(\mathbf{y}^{q}_{j}))
h\approx g^{-1}
\mathbf{y}
g
g(\mathbf{y})
\sigma(f(\mathbf{x}^{q}),f(\mathbf{x}^{i}))
\sigma(f_{\mathcal{T}}(\mathbf{x}^{q}),f_{\mathcal{T}}(\mathbf{x}^{i}))
\theta_{\mathcal{T}}
f_{\mathcal{T}}
h
g
\phi
f_{\mathcal{T}}
\theta_{\mathcal{T}}
f_{\mathcal{T}}
g
h
f_{\mathcal{T}}
g
h
f_{\mathcal{T}}
g
h
\theta
\theta_{\mathcal{T}}
\theta
\theta_{\mathcal{T}}
\mathcal{T}
\theta_{\mathcal{T}}
X^{q}
\{\mathbf{q}_{j}\}_{j\leq M}
\{(X^{i},Y^{i})\}_{i\leq N}
\{(\mathbf{k}_{k}^{i},\mathbf{v}_{k}^{i})\}_{k\leq M,i\leq N}
\mathbf{q}\in\mathbb{R}^{M\times d}
\mathbf{k},\mathbf{v}\in\mathbb{R}^{NM\times d}
\displaystyle\text{MHA}(\mathbf{q},\mathbf{k},\mathbf{v})=\text{Concat}(%
\mathbf{o}_{1},...,\mathbf{o}_{H})w^{O},
\displaystyle\text{MHA}(\mathbf{q},\mathbf{k},\mathbf{v})
\displaystyle=\text{Concat}(\mathbf{o}_{1},...,\mathbf{o}_{H})w^{O},
\displaystyle\text{where }\mathbf{o}_{h}=\text{Softmax}\left(\frac{\mathbf{q}w%
_{h}^{Q}(\mathbf{k}w_{h}^{K})^{\top}}{\sqrt{d_{H}}}\right)\mathbf{v}w_{h}^{V},
\displaystyle\text{where }\mathbf{o}_{h}
\displaystyle=\text{Softmax}\left(\frac{\mathbf{q}w_{h}^{Q}(\mathbf{k}w_{h}^{K%
})^{\top}}{\sqrt{d_{H}}}\right)\mathbf{v}w_{h}^{V},
H
d_{H}
w_{h}^{Q},w_{h}^{K},w_{h}^{V}\in\mathbb{R}^{d\times d_{H}}
w^{O}\in\mathbb{R}^{Hd_{H}\times d}
\mathbf{v}
\mathbf{q}
\mathbf{k}
\sigma
w_{h}^{Q},w_{h}^{K},w_{h}^{V}
h
M\to h\times w
\mathcal{D}_{\text{train}}
\mathcal{T}_{\text{train}}
\mathcal{T}
\mathcal{S}_{\mathcal{T}},\mathcal{Q}_{\mathcal{T}}
\mathcal{D}_{\text{train}}
\mathcal{Q}_{\mathcal{T}}
\mathcal{S}_{\mathcal{T}}
\mathcal{D}_{\text{train}}
\mathcal{F}(X^{q};\mathcal{S}_{\mathcal{T}})
X^{q}
\mathcal{S}_{\mathcal{T}}
f_{\mathcal{T}},g,h,\sigma
\underset{f_{\mathcal{T}},g,h,\sigma}{\text{min}}~{}\mathbb{E}_{\mathcal{S}_{%
\mathcal{T}},\mathcal{Q}_{\mathcal{T}}\sim\mathcal{D}_{\text{train}}}\left[%
\frac{1}{|\mathcal{Q}_{\mathcal{T}}|}\sum_{(X^{q},Y^{q})\in\mathcal{Q}_{%
\mathcal{T}}}\mathcal{L}\left(Y^{q},\mathcal{F}(X^{q};\mathcal{S}_{\mathcal{T}%
}))\right)\right],
\mathcal{L}
L1
h
\mathcal{T}_{\text{train}}
f_{\mathcal{T}}
\mathcal{D}_{\text{train}}
\mathcal{T}_{\text{test}}
\mathcal{S}_{\mathcal{T}_{\text{test}}}
f_{\mathcal{T}}
\mathcal{S}_{\mathcal{T}_{\text{test}}}
\tilde{\mathcal{S}}
\tilde{\mathcal{Q}}
\mathcal{S}_{\mathcal{T}_{\text{test}}}=\tilde{\mathcal{S}}\mathop{\dot{\cup}}%
\tilde{\mathcal{Q}}
\underset{\theta_{\mathcal{T}}}{\text{min}}~{}\mathbb{E}_{\tilde{\mathcal{S}},%
\tilde{\mathcal{Q}}\sim\mathcal{S}_{\mathcal{T}_{\text{test}}}}\left[\frac{1}{%
|\tilde{\mathcal{Q}}|}\sum_{(X^{q},Y^{q})\in\tilde{\mathcal{Q}}}\mathcal{L}%
\left(Y^{q},\mathcal{F}(X^{q};\tilde{\mathcal{S}})\right)\right],
\theta_{\mathcal{T}}
f_{\mathcal{T}}
\mathcal{S}_{\mathcal{T}_{\text{test}}}
\mathcal{S}_{\mathcal{T}_{\text{test}}}
5
\mathcal{T}_{\text{test}}
\mathcal{T}_{\text{train}}
[0,1]
\mathcal{T}_{\text{test}}
\mathcal{T}_{\text{test}}
\mathcal{T}_{\text{test}}
\mathcal{T}_{\text{train}}
\mathcal{T}_{\text{test}}
10
10
<0.004\%
0.28\%
<0.004\%
10
10
\mathcal{T}_{\text{train}}
\mathcal{T}_{\text{test}}
\mathcal{T}_{\text{train}}
\mathcal{T}_{\text{test}}
<0.004\%
0.1\%
10
<
<
[0,1]
(3,1),(11,2),(19,3)
3
5
[0,1]
p
[0,1]
p
[0,1]
p
[0,1]
p
[0,1]
224\times 224
g
3,6,9,12
3,6,9,12
[0,1]
[0,1]
0
1
0.1
\mathbf{q}\in\mathbb{R}^{M\times d}
\mathbf{k},\mathbf{v}\in\mathbb{R}^{NM\times d}
\displaystyle\text{MHA}(\mathbf{q},\mathbf{k},\mathbf{v})=\text{Concat}(%
\mathbf{o}_{1},...,\mathbf{o}_{H})w^{O},
\displaystyle\text{MHA}(\mathbf{q},\mathbf{k},\mathbf{v})
\displaystyle=\text{Concat}(\mathbf{o}_{1},...,\mathbf{o}_{H})w^{O},
\displaystyle\text{where }\mathbf{o}_{h}=\text{Softmax}\left(\frac{\mathbf{q}w%
_{h}^{Q}(\mathbf{k}w_{h}^{K})^{\top}}{\sqrt{d_{H}}}\right)\mathbf{v}w_{h}^{V},
\displaystyle\text{where }\mathbf{o}_{h}
\displaystyle=\text{Softmax}\left(\frac{\mathbf{q}w_{h}^{Q}(\mathbf{k}w_{h}^{K%
})^{\top}}{\sqrt{d_{H}}}\right)\mathbf{v}w_{h}^{V},
H
d_{H}
w_{h}^{Q},w_{h}^{K},w_{h}^{V}\in\mathbb{R}^{d\times d_{H}}
w^{O}\in\mathbb{R}^{Hd_{H}\times d}
w_{h}^{Q},w_{h}^{K},w_{h}^{V}
w^{O}
w_{h}^{Q}
w_{h}^{K}
\displaystyle\text{MHA}(\mathbf{q},\mathbf{k},\mathbf{v})=\mathbf{o}+\text{%
GELU}(\mathbf{o}w^{O}),
\displaystyle\text{MHA}(\mathbf{q},\mathbf{k},\mathbf{v})
\displaystyle=\mathbf{o}+\text{GELU}(\mathbf{o}w^{O}),
\displaystyle\text{where}~{}\mathbf{o}=\text{Concat}(\mathbf{o}_{1},\mathbf{o}%
_{2},\cdots,\mathbf{o}_{H}).
\displaystyle\text{where}~{}\mathbf{o}
\displaystyle=\text{Concat}(\mathbf{o}_{1},\mathbf{o}_{2},\cdots,\mathbf{o}_{H%
}).
10^{-5}
10^{-4}
\mathcal{T}_{\text{train}}
\mathcal{T}_{\text{test}}
64
16
256\times 256
224\times 224
256\times 256
(256\times 256)
C
C=5
\mathcal{T}_{\text{train}}
10
\mathcal{D}_{\text{train}}
\#1
10
10
