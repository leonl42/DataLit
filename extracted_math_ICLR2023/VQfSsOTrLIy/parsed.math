Q
Q
Q
Q
Q
Q
Q
Q
Q
Q
Q
Q
Q
Q
(\mathcal{S},\mathcal{A},T,r,\mathbb{P})
\mathcal{S}
\mathcal{A}
T\in\mathbb{N}
r
\mathbb{P}
\pi
\mathbb{E}\big{[}\sum_{i=0}^{T-1}{\gamma^{t}r_{i}}]
\gamma\in[0,1)
Q
\mathcal{T}Q_{\theta}(s,a):=r(s,a)+\gamma\mathbb{E}_{s^{\prime}\sim T(\cdot|s,%
a)}\big{[}\max_{a^{\prime}}Q_{\theta^{-}}(s^{\prime},a^{\prime})\big{]}.
\theta
Q
Q
\mathbb{E}_{(s,a,r,s^{\prime})}[(Q-\mathcal{T}Q)^{2}]
\mathcal{T}Q
\theta^{-}
(s,a,r,s^{\prime})
Q
\mathcal{D}_{\text{in}}=\{(s^{i}_{t},a^{i}_{t},r^{i}_{t},s^{i}_{t+1})\}_{i\in[%
m]}
Q
a^{\prime}
Q
s^{\prime}
(s^{\prime},a^{\prime})
\mathcal{D}_{\rm in}
K
Q
Q^{k}
k
Q
Q^{k}
\widehat{\mathcal{T}}Q_{\theta}^{k}(s,a):=r(s,a)+\gamma\widehat{\mathbb{E}}_{s%
^{\prime}\sim P(\cdot|s,a),a^{\prime}\sim\pi(\cdot|s)}\Big{[}Q^{k}_{\theta^{-}%
}(s^{\prime},a^{\prime})\Big{]}.
\widehat{\mathcal{T}}
\mathbb{E}[Q^{k}_{\theta^{-}}(s^{\prime},a^{\prime}){\,|\,}s,a]
Q
Q
Q
\mathcal{U}(s,a)
Q
\{Q^{k}\}_{k\in[K]}
\mathcal{U}(s,a):={\rm Std}(Q^{k}(s,a))=\sqrt{\frac{1}{K}\sum\nolimits_{k=1}^{%
K}\Big{(}Q^{k}(s,a)-\bar{Q}(s,a)\Big{)}^{2}}.
\bar{Q}
Q
Q
10
60
\mathbb{R}^{2}
x
y
x
(s,a)\rightarrow\widehat{\mathcal{T}}Q^{k}(s,a)
\mathcal{D}_{\rm in}
Q
x\rightarrow y
Q
Q
Q
\mathcal{D}_{\rm in}
\widehat{\mathcal{T}}^{\rm in}Q^{k}_{\theta}(s,a):=r(s,a)+\gamma\widehat{%
\mathbb{E}}_{s^{\prime}\sim P(\cdot|s,a),a^{\prime}\sim\pi(\cdot|s)}\Big{[}Q^{%
k}_{\theta^{-}}(s^{\prime},a^{\prime})-\beta_{\rm in}\colorbox{mine}{\mathcal{%
U}_{\theta^{-}}(s^{\prime},a^{\prime})}\Big{]},
\mathcal{U}_{\theta^{-}}(s^{\prime},a^{\prime})
(s^{\prime},a^{\prime})
\beta_{\text{in}}
\widehat{\mathbb{E}}_{s^{\prime}\sim P(\cdot|s,a),a^{\prime}\sim\pi(\cdot|s)}
(s,a,s^{\prime})
\mathcal{D}_{\text{in}}
a^{\prime}\sim\pi(\cdot{\,|\,}s^{\prime})
\pi
\widehat{\mathcal{T}}^{\rm in}Q^{k}_{\theta}(s,a)
Q^{k}_{\theta}(s,a)
\widehat{\mathcal{T}}^{\rm in}
Q
\widehat{\mathcal{T}}^{\rm in}
Q
Q^{k}_{\theta^{-}}(s^{\prime},a^{\prime})
\mathcal{U}_{\theta^{-}}(s^{\prime},a^{\prime})
\hat{r}(s,a):=r(s,a)-\mathcal{U}_{\theta}(s,a)
\hat{r}(s,a)
r(s,a)
(s,a)\in\mathcal{D}_{\rm in}
\mathcal{U}_{\theta}(s,a)
(s^{\prime},a^{\prime})
Q
Q
(s^{\text{ood}},a^{\text{ood}})\in\mathcal{D}_{\text{ood}}
\mathcal{D}_{\text{in}}
a^{\text{ood}}
\pi(\cdot{\,|\,}s^{\text{ood}})
\mathcal{D}_{\text{in}}
P(\cdot{\,|\,}s^{\text{ood}},a^{\text{ood}})
r(s^{\text{ood}},a^{\text{ood}})
\widehat{\mathcal{T}}^{\rm ood}Q^{k}_{\theta}(s^{\text{ood}},a^{\rm ood}):=Q^{%
k}_{\theta}(s^{\text{ood}},a^{\rm ood})-\beta_{\rm ood}\colorbox{mine}{%
\mathcal{U}_{\theta}(s^{\text{ood}},a^{\rm ood})},
\mathcal{U}_{\theta}(s^{\text{ood}},a^{\rm ood})
Q
\beta_{\rm ood}
Q
\max\{0,\mathcal{T}^{\rm ood}Q^{k}_{\theta}(s^{\text{ood}},a^{\rm ood})\}
\beta_{\text{ood}}
Q
\beta_{\rm ood}
\beta_{\rm ood}
\beta_{\rm ood}
\widehat{\mathcal{T}}^{\rm ood}Q^{k}
\beta_{\rm ood}
Q^{k}_{\theta}(s^{\text{ood}},a^{\rm ood})
\mathcal{L}_{\rm critic}=\widehat{\mathbb{E}}_{(s,a,r,s^{\prime})\sim\mathcal{%
D}_{\text{in}}}\big{[}(\widehat{\mathcal{T}}^{\rm in}Q^{k}-Q^{k})^{2}\big{]}+%
\widehat{\mathbb{E}}_{s^{\rm ood}\sim\mathcal{D}_{\text{in}},a^{\rm ood}\sim%
\pi}\big{[}(\widehat{\mathcal{T}}^{\rm ood}Q^{k}-Q^{k})^{2}\big{]},
Q
\pi_{\varphi}:=\max_{\varphi}\widehat{\mathbb{E}}_{s\sim\mathcal{D}_{\text{in}%
},a\sim\pi(\cdot|s)}\Big{[}\min_{k=1,\ldots,K}Q^{k}(s,a)\Big{]},
\varphi
Q
\xi
\xi
\{\Gamma_{t}\}_{t\in[T]}
\xi
1-\xi
|\widehat{\mathcal{T}}V_{t+1}(s,a)-\mathcal{T}V_{t+1}(s,a)|\leq\Gamma_{t}(s,a)
(s,a)\in{\mathcal{S}}\times\mathcal{A}
\mathcal{T}
\widehat{\mathcal{T}}
\mathcal{T}
\phi:\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}^{d}
\xi
\{\beta_{t}\}_{t\in[T]}
\Gamma^{\rm lcb}(s_{t},a_{t})=\beta_{t}\cdot\big{[}\phi(s_{t},a_{t})^{\top}%
\Lambda_{t}^{-1}\phi(s_{t},a_{t})\big{]}^{\nicefrac{{1}}{{2}}},
\Lambda_{t}=\sum_{i=1}^{m}\phi(s_{t}^{i},a_{t}^{i})\phi(s_{t}^{i},a_{t}^{i})^{%
\top}+\lambda\cdot\mathrm{\mathbf{I}}
\mathcal{D}_{\rm in}
\Gamma^{\rm lcb}(s_{t},a_{t})
\beta_{t}\cdot\mathcal{U}(s_{t},a_{t})
\Gamma^{\rm lcb}(s_{t},a_{t})
\beta_{t}
Q
Q
\mathcal{U}(s_{t},a_{t})
Q
\Gamma^{\rm lcb}(s_{t},a_{t})
L_{2}
L_{2}
L_{2}
(s^{\text{ood}},a^{\text{ood}},y)
L_{2}
\widetilde{\Lambda}=\sum\nolimits_{i=1}^{m}\phi(s_{t}^{i},a_{t}^{i})\phi(s_{t}%
^{i},a_{t}^{i})^{\top}+\sum\nolimits_{(s^{\text{ood}},a^{\text{ood}},y)\in%
\mathcal{D}_{\text{ood}}}\phi(s^{\text{ood}},a^{\text{ood}})\phi(s^{\text{ood}%
},a^{\text{ood}})^{\top},
\Lambda_{\text{ood}}=\sum_{(s^{\text{ood}},a^{\text{ood}},y)\in\mathcal{D}_{%
\text{ood}}}\phi(s^{\text{ood}},a^{\text{ood}})\phi(s^{\text{ood}},a^{\text{%
ood}})^{\top}
\lambda\cdot\mathrm{\mathbf{I}}
y
(s^{\text{ood}},a^{\text{ood}},y)
y=\mathcal{T}V_{h+1}(s^{\text{ood}},a^{\text{ood}})
\xi
\Lambda_{\mathrm{ood}}\succeq\lambda\cdot I
(s^{\text{\rm ood}},a^{\text{\rm ood}},y)\in\mathcal{D}_{\text{\rm ood}}
y=\mathcal{T}V_{t+1}(s^{\text{\rm ood}},a^{\text{\rm ood}})
\beta_{t}=\mathcal{O}\bigl{(}T\cdot\sqrt{d}\cdot\text{log}(T/\xi)\bigr{)}
\Gamma^{\rm lcb}_{t}(s_{t},a_{t})=\beta_{t}\big{[}\phi(s_{t},a_{t})^{\top}%
\Lambda_{t}^{-1}\phi(s_{t},a_{t})\big{]}^{\nicefrac{{1}}{{2}}}
\xi
y=\mathcal{T}V_{t+1}(s^{\text{ood}},a^{\text{ood}})
\xi
(s^{\text{ood}},a^{\text{ood}})
Q(s^{\text{ood}},a^{\text{ood}})
\mathcal{T}V_{t+1}
y=Q(s^{\text{ood}},a^{\text{ood}})-\Gamma^{\rm lcb}(s^{\text{ood}},a^{\text{%
ood}})
\Gamma^{\rm lcb}(s^{\text{ood}},a^{\text{ood}})
\Lambda_{\mathrm{ood}}
Q
Q
Q
Q
Q
Q
Q^{k}_{\theta}
p_{k}
p_{k}
Q
Q^{k}_{p}=Q^{k}_{\theta}+p_{k}
Q^{k}_{\theta}
p_{k}
Q
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
15
Q
Q
a_{\rm offline}
a_{\rm policy}
a_{\rm rand}
a_{\rm noise1}=a_{\rm offline}+\mathcal{N}(0,0.1)
a_{\rm noise2}=a_{\rm offline}+\mathcal{N}(0,0.5)
Q
(s,a_{\rm noise2})
(s,a_{\rm random})
(s,a_{\rm offline})
(s,a_{\rm noise1})
(s,a_{\rm offline})
Q
(s,a_{\rm policy})
Q
Q
K
Q
K\geq 6
\widehat{\mathcal{T}}^{\rm in}
\beta_{\rm in}
\widehat{\mathcal{T}}^{\rm in}
\beta_{\rm in}
\{0.1,0.01,0.001,0.0001\}
\beta_{\rm in}\in[0.0001,0.01]
\beta_{\rm ood}
\beta_{\rm ood}
\beta_{\rm ood}
\beta_{\rm ood}
y=0
L_{2}
\gamma=1
\phi:\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}^{d}
\phi
\pi
\phi
Q^{\pi}(s^{i}_{t},a^{i}_{t})=\widehat{w}_{t}^{\top}\phi(s^{i}_{t},a^{i}_{t}).
w_{t}
\widehat{w}_{t}=\min_{w\in\mathbb{R}^{d}}\sum^{m}_{i=1}\bigl{(}\phi(s^{i}_{t},%
a^{i}_{t})^{\top}w-r(s^{i}_{t},a^{i}_{t})-V_{t+1}(s^{i}_{t+1})\bigr{)}^{2}+%
\lambda\cdot\|w\|_{2}^{2},
V_{t+1}
(t+1)
r(s^{i}_{t},a^{i}_{t})+V_{t+1}(s^{i}_{t+1})
\widehat{w}_{t}=\Lambda^{-1}_{t}\sum^{m}_{i=1}\phi(s^{i}_{t},a^{i}_{t})\bigl{(%
}V_{t+1}(s^{i}_{t+1})+r(s^{i}_{t},a^{i}_{t})\bigr{)},\quad\Lambda_{t}=\sum^{m}%
_{i=1}\phi(s^{i}_{t},a^{i}_{t})\phi(s^{i}_{t},a^{i}_{t})^{\top}+\lambda\cdot%
\mathrm{\mathbf{I}}.
\Lambda_{t}
w_{t}
Q_{t}(s_{t},a_{t})\approx\widehat{w}_{t}^{\top}\phi(s_{t},a_{t})
\Gamma^{\rm lcb}(s_{t},a_{t})=\beta_{t}\cdot\big{[}\phi(s_{t},a_{t})^{\top}%
\Lambda_{t}^{-1}\phi(s_{t},a_{t})\big{]}^{\nicefrac{{1}}{{2}}},
Q
\widehat{Q}_{t}(s_{t},a_{t})
Q_{t}
\Gamma^{\rm lcb}(s_{t},a_{t})
\displaystyle\widehat{Q}_{t}(s_{t},a_{t})=\>Q_{t}(s_{t},a_{t})-\Gamma^{\rm lcb%
}(s_{t},a_{t})
\displaystyle\widehat{Q}_{t}(s_{t},a_{t})=
\displaystyle\>Q_{t}(s_{t},a_{t})-\Gamma^{\rm lcb}(s_{t},a_{t})
\displaystyle=w_{t}^{\top}\phi(s_{t},a_{t})-\Gamma^{\rm lcb}(s_{t},a_{t}),
\displaystyle=
\displaystyle w_{t}^{\top}\phi(s_{t},a_{t})-\Gamma^{\rm lcb}(s_{t},a_{t}),
w_{t}
\Gamma^{\rm lcb}(s_{t},a_{t})
\Gamma^{\rm lcb}
b^{i}_{t}=r(s^{i}_{t},a^{i}_{t})+V_{t+1}(s^{i}_{t+1})
Q
Q_{t}
V_{t+1}
(t+1)
Q
Q_{t}(s_{t},a_{t})=\widehat{w}_{t}^{\top}\phi(s_{t},a_{t})
\epsilon
\epsilon=b^{i}_{t}-{w}_{t}^{\top}\phi(s_{t},a_{t}),
w_{t}
\mathcal{D}_{\rm in}=\{(s^{i}_{t},a^{i}_{t},s^{i}_{t+1})\}_{i\in[m]}
\widehat{w}_{t}
w
\mathcal{D}_{\rm in}
w\sim\mathcal{N}(0,\mathrm{\mathbf{I}}/\lambda)
\Gamma^{\rm lcb}
\epsilon
\mathcal{N}(0,1)
(s^{i}_{t},a^{i}_{t})
w_{t}
\mathcal{D}_{\rm in}
\text{\rm Var}_{\widehat{w}_{t}}\bigl{(}Q_{t}(s^{i}_{t},a^{i}_{t})\bigr{)}=%
\text{\rm Var}_{\widehat{w}_{t}}\bigl{(}\phi(s^{i}_{t},a^{i}_{t})^{\top}%
\widehat{w}_{t}\bigr{)}=\phi(s^{i}_{t},a^{i}_{t})^{\top}\Lambda^{-1}_{t}\phi(s%
^{i}_{t},a^{i}_{t}),\quad\forall(s^{i}_{t},a^{i}_{t})\in\mathcal{S}\times%
\mathcal{A}.
\epsilon\sim\mathcal{N}(0,1)
b^{i}_{t}\>|\>(s^{i}_{t},a^{i}_{t}),\widehat{w}\sim\mathcal{N}\bigl{(}\widehat%
{w}_{t}^{\top}\phi(s^{i}_{t},a^{i}_{t}),1\bigr{)}.
w\sim\mathcal{N}(0,\mathrm{\mathbf{I}}/\lambda)
\widehat{w}_{t}=w\>|\>\mathcal{D}_{\rm in}
\log p(\widehat{w}\>|\>\mathcal{D}_{\rm in})=\log p(\widehat{w})+\log p(%
\mathcal{D}_{\rm in}\>|\>\widehat{w})+{\rm Const.},
p(\cdot)
\displaystyle\log p(\widehat{w}\>|\>\mathcal{D}_{\rm in})=-\|\widehat{w}\|^{2}%
/2-\sum^{m}_{i=1}\|\widehat{w}^{\top}\phi(s^{i}_{t},a^{i}_{t})-y^{i}_{t}\|^{2}%
/2+{\rm Const.}
\displaystyle\log p(\widehat{w}\>|\>\mathcal{D}_{\rm in})
\displaystyle=-\|\widehat{w}\|^{2}/2-\sum^{m}_{i=1}\|\widehat{w}^{\top}\phi(s^%
{i}_{t},a^{i}_{t})-y^{i}_{t}\|^{2}/2+{\rm Const.}
\displaystyle=-(\widehat{w}-\mu_{t})^{\top}\Lambda^{-1}_{t}(\widehat{w}-\mu_{t%
})/2+{\rm Const.},
\displaystyle=-(\widehat{w}-\mu_{t})^{\top}\Lambda^{-1}_{t}(\widehat{w}-\mu_{t%
})/2+{\rm Const.},
\mu_{t}=\Lambda^{-1}_{t}\sum^{m}_{i=1}\phi(s^{i}_{t},a^{i}_{t})y^{i}_{t},%
\qquad\Lambda_{t}=\sum_{i=1}^{m}\phi(s_{t}^{i},a_{t}^{i})\phi(s_{t}^{i},a_{t}^%
{i})^{\top}+\lambda\cdot\mathrm{\mathbf{I}}.
\widehat{w}_{t}=w\>|\>\mathcal{D}_{\rm in}\sim\mathcal{N}(\mu_{t},\Lambda^{-1}%
_{t})
(s_{t},a_{t})\in\mathcal{S}\times\mathcal{A}
\text{\rm Var}\bigl{(}\phi(s^{i}_{t},a^{i}_{t})^{\top}\widehat{w}_{t}\bigr{)}=%
\text{\rm Var}\bigl{(}Q_{t}(s^{i}_{t},a^{i}_{t})\bigr{)}=\phi(s^{i}_{t},a^{i}_%
{t})^{\top}\Lambda^{-1}_{t}\phi(s^{i}_{t},a^{i}_{t}),
Q
\text{\rm Var}\bigl{(}Q(s_{t},a_{t})\bigr{)}=\phi(s_{t},a_{t})^{\top}\Lambda^{%
-1}_{t}\phi(s_{t},a_{t})
\mathcal{U}(s_{t},a_{t})\approx\text{\rm Std}\bigl{(}Q^{k}(s_{t},a_{t})\bigr{)},
Q
Q
\mathcal{U}(s,a)
(s,a)
\mathcal{U}(s,a)\approx\Gamma^{\rm lcb}(s,a)/\beta_{t}=\frac{1}{\sqrt{N_{s,a}+%
\lambda}}.
d=|\mathcal{S}|\times|\mathcal{A}|
j
\phi(s,a)\in\mathbb{R}^{d}
j\in[0,d-1]
\phi(s_{j},a_{j})=\begin{bmatrix}\begin{smallmatrix}0\\
\vdots\\
1\\
\vdots\\
0\end{smallmatrix}\end{bmatrix}\in\mathbb{R}^{d},\qquad\phi(s_{j},a_{j})\phi(s%
_{j},a_{j})^{\top}=\begin{bmatrix}\begin{smallmatrix}0&\cdots&0&\cdots&0\\
\vdots&\ddots&&&\vdots\\
0&&1&&0\\
\vdots&&&\ddots&\vdots\\
0&\cdots&0&\cdots&0\\
\end{smallmatrix}\end{bmatrix}\in\mathbb{R}^{d\times d},
\phi(s_{j},a_{j})
1
j
0
\Lambda_{j}=\sum_{i=0}^{m}\phi(s_{j}^{i},a_{j}^{i})\phi(s_{j}^{i},a_{j}^{i})^{%
\top}+\lambda\cdot\mathrm{\mathbf{I}}
\phi(s_{j},a_{j})\phi(s_{j},a_{j})^{\top}
(s_{j},a_{j})\in\mathcal{D}_{\rm in}
\small\Lambda_{j}=\begin{bmatrix}\begin{smallmatrix}n_{0}+\lambda&0&&\cdots&0%
\\
0&n_{1}+\lambda&&\cdots&0\\
\vdots&&\ddots&&\vdots\\
0&\cdots&&\!\!\!\!\!\!\!\!n_{j}+\lambda&0\\
\vdots&&&\>\>\>\>\>\>\ddots&\vdots\\
0&\cdots&&\cdots&n_{d-1}+\lambda\end{smallmatrix}\end{bmatrix},
j
\Lambda_{j}
(s_{j},a_{j})
n_{j}=N_{s_{j},a_{j}}.
\big{[}\phi(s_{j},a_{j})^{\top}\Lambda_{j}^{-1}\phi(s_{j},a_{j})\big{]}^{%
\nicefrac{{1}}{{2}}}=\frac{1}{\sqrt{N_{s_{j},a_{j}}+\lambda}},
Q
\mathbb{P}_{t}(s_{t+1}\,|\,s_{t},a_{t})=\langle\psi(s_{t+1}),\phi(s_{t},a_{t})%
\rangle,\quad r(s_{t},a_{t})=\theta^{\top}\phi(s_{t},a_{t}),\quad\forall(s_{t+%
1},a_{t},s_{t})\in\mathcal{S}\times\mathcal{A}\times\mathcal{S},
\phi:{\mathcal{S}}\times\mathcal{A}\mapsto\mathbb{R}^{d}
r:{\mathcal{S}}\times\mathcal{A}\mapsto[0,1]
\|\phi\|_{2}\leq 1
\mathcal{D}_{\rm in}
\widehat{w}_{t}=\Lambda^{-1}_{t}\sum^{m}_{i=1}\phi(s^{i}_{t},a^{i}_{t})\bigl{(%
}V_{t+1}(s^{i}_{t+1})+r(s^{i}_{t},a^{i}_{t})\bigr{)},\quad\Lambda_{t}=\sum^{m}%
_{i=1}\phi(s^{i}_{t},a^{i}_{t})\phi(s^{i}_{t},a^{i}_{t})^{\top}+\lambda\cdot%
\mathrm{\mathbf{I}}.
L_{2}
\lambda\cdot\|w\|_{2}^{2}
\phi^{\top}w^{i}_{t}
\mathcal{D}_{\rm in}
L_{2}
L_{2}
\widetilde{w}^{i}_{t}=\min_{w\in\mathbb{R}^{d}}\sum^{m}_{i=1}\bigl{(}\phi(s^{i%
}_{t},a^{i}_{t})^{\top}w-r(s^{i}_{t},a^{i}_{t})-V_{t+1}(s^{i}_{t+1})\bigr{)}^{%
2}+\sum_{(s^{\text{ood}},a^{\text{ood}},y)\in\mathcal{D}_{\text{ood}}}\bigl{(}%
\phi(s^{\text{ood}},a^{\text{ood}})^{\top}w-y\bigr{)}^{2}.
\widetilde{w}^{i}_{t}=\widetilde{\Lambda}^{-1}_{t}\biggl{(}\sum^{m}_{i=1}\phi(%
s^{i}_{t},a^{i}_{t})\bigl{(}r(s^{i}_{t},a^{i}_{t})+V_{t+1}(s^{i}_{t+1})\bigr{)%
}+\sum_{(s^{\text{ood}},a^{\text{ood}},y)\in\mathcal{D}_{\text{ood}}}\phi(s^{%
\text{ood}},a^{\text{ood}})y\biggr{)},
\widetilde{\Lambda}_{t}=\sum^{m}_{i=1}\phi(s^{i}_{t},a^{i}_{t})\phi(s^{i}_{t},%
a^{i}_{t})^{\top}+\sum_{(s^{\text{ood}},a^{\text{ood}},y)\in\mathcal{D}_{\text%
{ood}}}\phi(s^{\text{ood}},a^{\text{ood}})\phi(s^{\text{ood}},a^{\text{ood}})^%
{\top}.
y=0
(s^{\text{ood}},a^{\text{ood}},y)\in\mathcal{D}_{\text{ood}}
\Lambda_{\text{ood}}^{-1}
\Lambda_{\text{ood}}=\sum_{(s^{\text{ood}},a^{\text{ood}},y)\in\mathcal{D}_{%
\text{ood}}}\phi(s^{\text{ood}},a^{\text{ood}})\phi(s^{\text{ood}},a^{\text{%
ood}})^{\top}.
\mathcal{D}_{\text{ood}}=\{(s^{j},a^{j},0)\}_{j\in[d]}
\phi(s^{j},a^{j})=\lambda\cdot e^{j}
e^{j}\in\mathbb{R}^{d}
j
\Lambda_{\text{ood}}=\lambda\cdot\mathrm{\mathbf{I}}
\widetilde{N}_{s_{j},a_{j}}=N_{s_{j},a_{j}}+N^{\text{ood}}_{s_{j},a_{j}},
N_{s_{j},a_{j}}
(s_{j},a_{j})
N^{\text{ood}}_{s_{j},a_{j}}
(s_{j},a_{j})
y
Q
Q
y
\widetilde{\Lambda}_{t}
y
\xi
\xi
\{\Gamma_{t}\}_{t\in[T]}
\xi
1-\xi
|\widehat{\mathcal{T}}V_{t+1}(s,a)-\mathcal{T}V_{t+1}(s,a)|\leq\Gamma_{t}(s,a)
(s,a)\in{\mathcal{S}}\times\mathcal{A}
\mathcal{T}
\widehat{\mathcal{T}}
\mathcal{T}
\mathcal{T}
\mathcal{T}V(s,a)=\mathbb{E}[r(s,a)+V(s^{\prime}){\,|\,}s,a]
\widehat{\mathcal{T}}V_{t+1}
\widehat{\mathcal{T}}V_{t+1}
\widehat{\mathcal{T}}V_{t+1}(s_{t},a_{t})=\phi(s_{t},a_{t})^{\top}\widetilde{w%
}_{t},
\widetilde{w}_{t}
\xi
y
\xi
\Lambda_{\text{ood}}\succeq\lambda\cdot\mathrm{\mathbf{I}}
(s^{\text{\rm ood}},a^{\text{\rm ood}},y)\in\mathcal{D}_{\text{\rm ood}}
y=\mathcal{T}V_{t+1}(s^{\text{\rm ood}},a^{\text{\rm ood}})
\beta_{t}=\mathcal{O}\bigl{(}T\cdot\sqrt{d}\cdot\text{log}(T/\xi)\bigr{)}
\Gamma^{\rm lcb}_{t}(s_{t},a_{t})=\beta_{t}\big{[}\phi(s_{t},a_{t})^{\top}%
\Lambda_{t}^{-1}\phi(s_{t},a_{t})\big{]}^{\nicefrac{{1}}{{2}}}
\xi
\widehat{\mathcal{T}}
\widehat{\mathcal{T}}V_{t+1}(s_{t},a_{t})=\phi(s_{t},a_{t})^{\top}\widetilde{w%
}_{t},
\mathcal{T}V_{t+1}(s,a)-\widehat{\mathcal{T}}V_{t+1}(s,a)=\phi(s,a)^{\top}(w_{%
t}-\widetilde{w}_{t}).
w_{t}
w_{t}=\theta+\int_{{\mathcal{S}}}V_{t+1}(s_{t+1})\psi(s_{t+1})\text{d}s_{t+1},
\theta
\psi
\displaystyle\mathcal{T}V_{t+1}(s,a)-\widehat{\mathcal{T}}V_{t+1}(s,a)=\phi(s,%
a)^{\top}(w_{t}-\widetilde{w}_{t})
\displaystyle\mathcal{T}V_{t+1}(s,a)-\widehat{\mathcal{T}}V_{t+1}(s,a)
\displaystyle=\phi(s,a)^{\top}(w_{t}-\widetilde{w}_{t})
\displaystyle=\phi(s,a)^{\top}w_{t}-\phi(s,a)^{\top}\widetilde{\Lambda}^{-1}_{%
t}\sum^{m}_{i=1}\phi(s^{i}_{t},a^{i}_{t})\bigl{(}r(s^{i}_{t},a^{i}_{t})+V^{i}_%
{t+1}(s^{i}_{t+1})\bigr{)}
\displaystyle=\phi(s,a)^{\top}w_{t}-\phi(s,a)^{\top}\widetilde{\Lambda}^{-1}_{%
t}\sum^{m}_{i=1}\phi(s^{i}_{t},a^{i}_{t})\bigl{(}r(s^{i}_{t},a^{i}_{t})+V^{i}_%
{t+1}(s^{i}_{t+1})\bigr{)}
\displaystyle\quad-\phi(s,a)^{\top}\widetilde{\Lambda}^{-1}_{t}\sum_{(s^{\text%
{ood}},a^{\text{ood}},y)\in\mathcal{D}_{\text{ood}}}\phi(s^{\text{ood}},a^{%
\text{ood}})y.
\displaystyle\quad-\phi(s,a)^{\top}\widetilde{\Lambda}^{-1}_{t}\sum_{(s^{\text%
{ood}},a^{\text{ood}},y)\in\mathcal{D}_{\text{ood}}}\phi(s^{\text{ood}},a^{%
\text{ood}})y.
\widetilde{w}_{t}
\widetilde{\Lambda}_{t}
w_{t}
\displaystyle\phi(s,a)^{\top}w_{t}=\phi(s,a)^{\top}\widetilde{\Lambda}_{t}^{-1%
}\widetilde{\Lambda}_{t}w_{t}
\displaystyle\phi
\displaystyle(s,a)^{\top}w_{t}=\phi(s,a)^{\top}\widetilde{\Lambda}_{t}^{-1}%
\widetilde{\Lambda}_{t}w_{t}
\displaystyle=\phi(s,a)^{\top}\widetilde{\Lambda}_{t}^{-1}\biggl{(}\sum^{m}_{i%
=1}\phi(s^{i}_{t},a^{i}_{t})\mathcal{T}V_{t+1}(s_{t},a_{t})+\sum_{(s^{\text{%
ood}},a^{\text{ood}},y)\in\mathcal{D}_{\text{ood}}}\phi(s^{\text{ood}},a^{%
\text{ood}})\mathcal{T}V_{t+1}(s^{\text{ood}},a^{\text{ood}})\biggr{)}.
\displaystyle=\phi(s,a)^{\top}\widetilde{\Lambda}_{t}^{-1}\biggl{(}\sum^{m}_{i%
=1}\phi(s^{i}_{t},a^{i}_{t})\mathcal{T}V_{t+1}(s_{t},a_{t})+\sum_{(s^{\text{%
ood}},a^{\text{ood}},y)\in\mathcal{D}_{\text{ood}}}\phi(s^{\text{ood}},a^{%
\text{ood}})\mathcal{T}V_{t+1}(s^{\text{ood}},a^{\text{ood}})\biggr{)}.
\mathcal{T}V_{t+1}(s,a)-\widehat{\mathcal{T}}V_{t+1}(s,a)=\text{(i)}+\text{(ii%
)},
\displaystyle\text{(i)}=\phi(s,a)^{\top}\widetilde{\Lambda}^{-1}_{t}\sum^{m}_{%
i=1}\phi(s^{i}_{t},a^{i}_{t})\bigl{(}\mathcal{T}V_{t+1}(s^{i}_{t},a^{i}_{t})-r%
(s^{i}_{t},a^{i}_{t})-V^{i}_{t+1}(s^{i}_{t+1})\bigr{)},
\displaystyle=\phi(s,a)^{\top}\widetilde{\Lambda}^{-1}_{t}\sum^{m}_{i=1}\phi(s%
^{i}_{t},a^{i}_{t})\bigl{(}\mathcal{T}V_{t+1}(s^{i}_{t},a^{i}_{t})-r(s^{i}_{t}%
,a^{i}_{t})-V^{i}_{t+1}(s^{i}_{t+1})\bigr{)},
\displaystyle\text{(ii)}=\phi(s,a)^{\top}\widetilde{\Lambda}_{t}^{-1}\sum_{(s^%
{\text{ood}},a^{\text{ood}},y)\in\mathcal{D}_{\text{ood}}}\phi(s^{\text{ood}},%
a^{\text{ood}})\bigl{(}\mathcal{T}V_{t+1}(s^{\text{ood}},a^{\text{ood}})-y%
\bigr{)}.
\displaystyle=\phi(s,a)^{\top}\widetilde{\Lambda}_{t}^{-1}\sum_{(s^{\text{ood}%
},a^{\text{ood}},y)\in\mathcal{D}_{\text{ood}}}\phi(s^{\text{ood}},a^{\text{%
ood}})\bigl{(}\mathcal{T}V_{t+1}(s^{\text{ood}},a^{\text{ood}})-y\bigr{)}.
\Lambda_{\text{ood}}\succeq\lambda\cdot I
|\text{(i)}|\leq\beta_{t}\cdot\big{[}\phi(s_{t},a_{t})^{\top}\Lambda_{t}^{-1}%
\phi(s_{t},a_{t})\big{]}^{\nicefrac{{1}}{{2}}},
1-\xi
\beta_{t}=\mathcal{O}\bigl{(}T\cdot\sqrt{d}\cdot\text{log}(T/\xi)\bigr{)}
y=\mathcal{T}V_{t+1}(s^{\text{ood}},a^{\text{ood}})
\text{(ii)}=0
|\mathcal{T}V_{t+1}(s,a)-\widehat{\mathcal{T}}V_{t+1}(s,a)|\leq\beta_{t}\cdot%
\big{[}\phi(s_{t},a_{t})^{\top}\Lambda_{t}^{-1}\phi(s_{t},a_{t})\big{]}^{%
\nicefrac{{1}}{{2}}}
(s,a)\in{\mathcal{S}}\times\mathcal{A}
1-\xi
V^{*}(s_{1})-V^{\pi_{1}}(s_{1})\leq\sum^{T}_{t=1}\mathbb{E}_{\pi^{*}}\bigl{[}%
\Gamma_{t}^{\rm lcb}(s_{t},a_{t}){\,|\,}s_{1}\bigr{]}
y=\mathcal{T}V_{t+1}(s^{\text{ood}},a^{\text{ood}})
\xi
(s^{\text{ood}},a^{\text{ood}})
Q_{t+1}(s,a)
\mathcal{T}V_{t+1}
y=Q_{t+1}(s^{\text{ood}},a^{\text{ood}})-\Gamma_{t+1}(s^{\text{ood}},a^{\text{%
ood}})
\Gamma_{t+1}(s^{\text{ood}},a^{\text{ood}})
\Lambda_{\mathrm{ood}}
K
Q
Q
\theta
\theta^{-}
\pi
\varphi
\beta_{\rm in}
\beta_{\rm ood}
H
h=0
h<H
(s,a,r,s^{\prime})
\mathcal{D}_{\rm in}
\mathcal{U}_{\theta^{-}}(s^{\prime},a^{\prime})
Q
|Q_{\theta}^{k}(s,a)-\widehat{\mathcal{T}}^{\rm in}Q^{k}(s,a)|^{2}
N_{\rm ood}
a^{\rm ood}
s
\mathcal{U}_{\theta}(s,a^{\rm ood})
Q
Q
|Q^{k}_{\theta}(s,a^{\rm ood})-\widehat{\mathcal{T}}^{\rm ood}Q^{k}(s,a^{\rm
ood%
})|^{2}
|Q_{\theta}^{k}(s,a)-\widehat{\mathcal{T}}^{\rm in}Q^{k}(s,a)|^{2}+|Q_{\theta}%
^{k}(s,a^{\rm ood})-\widehat{\mathcal{T}}^{\rm ood}Q^{k}(s,a^{\rm ood})|^{2}
\theta
\pi_{\varphi}
\min_{k}Q^{k}(s,a_{\pi})-\log\pi_{\varphi}(a_{\pi}|s)
Q
\theta^{-}\leftarrow(1-\tau)\theta^{-}+\tau\theta
\beta_{\rm in}
\beta_{\rm ood}
K
Q
\beta_{\rm in}
\widehat{\mathcal{T}}^{\rm in}
\beta_{\rm ood}
5.0\rightarrow 0.2
\widehat{\mathcal{T}}^{\rm ood}
\tau
\gamma
lr
lr
H
N_{\rm ood}
Q
\min_{j=1,\dots,K}Q_{j}
\bar{Q}-\beta_{0}\cdot{\rm Std}(Q_{j})
\beta_{0}
\beta_{\rm in}
\beta_{\rm ood}
Q
Q
Q
Q
K=6,8
10
K
K=10
Q
Q
\widehat{\mathcal{T}}^{\rm in}
Q
Q
Q
\beta_{\rm in}
\beta_{\rm in}\in\{0.1,0.01,0.001,0.0001\}
\beta_{\rm in}
\beta_{\rm in}
\beta_{\rm in}
\beta_{\text{in}}
\beta_{\rm in}\in[0.0001,0.01]
\beta_{\rm in}=0.01
\beta^{\rm in}
\beta^{\rm in}
\beta_{\rm ood}
\beta_{\rm ood}
\beta_{\rm ood}
\beta_{\rm ood}\in\{0.01,0.1,1.0\}
\beta_{\rm ood}=1.0
\beta_{\rm ood}\in\{0.1,0.01\}
\beta_{\rm ood}
\beta^{\rm ood}
\beta^{\rm ood}
Q
(s,a)\sim\mathcal{D}_{\rm in}
Q
\beta_{\rm ood}
\beta_{\rm ood}
\beta^{\rm ood}
\mathcal{D}_{\rm in}
\beta^{\rm ood}
\mathcal{D}_{\rm in}
K
Q
Q
N_{\rm ood}
N_{\rm ood}\in\{0,2,5,10\}
N_{\rm ood}=0)
N_{\rm ood}=2)
N_{\rm ood}
Q
Q
y^{\rm ood}=0
y^{\rm ood}=0
y^{\rm ood}=0
Q
Q
(s,a)
a
y^{\rm ood}=0
Q
Q
(s,a)
a
y^{\rm ood}=0
Q
Q
(s,a_{\pi})
a_{\pi}\sim\pi(a|s)
\pi
y^{\rm ood}=0
Q
Q
(s,a_{\pi})
a_{\pi}\sim\pi(a|s)
\pi
Q
\widehat{\mathcal{T}}^{\rm in}
L_{2}
L_{2}
L_{2}
Q
L_{2}
Q
L_{2}
\{1e-2,1e-4\}
Q
Q
Q
Q
\rm{Unif}(a,b)
(a,b)
(-0.2,0)
(a,b)
(-1.0,0)
Q
L_{2}
24
\beta_{\rm in}=0.0001
\beta_{\rm ood}=0.01
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
M_{\rm task}*N_{\rm seed}
\hat{F}(\tau)=\hat{F}(\tau;x_{1:M,1:N})=\frac{1}{M}\sum_{m=1}^{M}\frac{1}{N}%
\sum_{n=1}^{N}\mathbbm{1}[x_{m,n}\geq\tau].
\eta=50.0
\tau
y=0.5
\tau
y=0.5
