B^{i}
C
B^{1},\ldots,B^{i},\ldots,B^{n}
{\bf p}^{i}=(p^{i}_{1},\ldots,p^{i}_{c},\ldots,p^{i}_{C})
B^{i}
{\bf p}^{i}=(0.5,0.25,0.25)
x^{i}_{j}\in B^{i}
j=1,\ldots,|B^{i}|
{\bf p}^{i}
i
B^{i}
t
n
n
\propto
k
n
B^{1},\ldots,B^{n}
B^{i}
B^{i}=\{x_{j}\}_{j=1}^{|B^{i}|}
B^{i}
p_{c}^{i}=\frac{|\{j\mid j\in[|B^{i}|],Y^{i}_{c,j}=1\}|}{|B^{i}|}
c\in[C]
a
[a]
\{1,\ldots,a\}
C
Y^{i}\in\{Y\mid Y\in\{0,1\}^{C\times|B^{i}|},\forall j\in[|B^{i}|],\sum_{c=1}^%
{C}Y_{c,j}=1\}
f
f
\hat{Y}^{1},\ldots\hat{Y}^{n}
\displaystyle\min_{\hat{Y}^{1},\ldots\hat{Y}^{n},f}\sum_{i=1}^{n}\sum_{j=1}^{|%
B^{i}|}\ell(x^{i}_{j},\hat{Y}^{i}_{:,j},f)
\displaystyle\min_{\hat{Y}^{1},\ldots\hat{Y}^{n},f}
\displaystyle\sum_{i=1}^{n}\sum_{j=1}^{|B^{i}|}\ell(x^{i}_{j},\hat{Y}^{i}_{:,j%
},f)
\displaystyle\mathrm{s.t.}~{}~{}\forall i\in[n],\forall c\in[C],\frac{|\{j\mid
j%
\in[|B^{i}|],\hat{Y}^{i}_{c,j}=1\}|}{|B^{i}|}=p_{c}^{i},
\displaystyle\mathrm{s.t.}~{}~{}
\displaystyle\forall i\in[n],\forall c\in[C],\frac{|\{j\mid j\in[|B^{i}|],\hat%
{Y}^{i}_{c,j}=1\}|}{|B^{i}|}=p_{c}^{i},
Y_{:,j}
j
Y
\ell
f
\hat{Y}^{1},\ldots,\hat{Y}^{n}
\hat{Y}^{1},\ldots,\hat{Y}^{n}
f
f
\hat{Y}^{1},\ldots,\hat{Y}^{n}
f
\hat{Y}^{1}[t],\ldots,\hat{Y}^{n}[t]
f[t]
t
\hat{Y}^{i}[t]
B^{i}
t
f[t]
t
f[t]
\hat{Y}^{1}[t],\ldots,\hat{Y}^{n}[t]
f[t]
\hat{Y}^{1}[t],\ldots,\hat{Y}^{n}[t]
\hat{Y}^{1}[t],\ldots,\hat{Y}^{n}[t]
\mathcal{Y}^{i}
Y^{i}
i\in[n]
\mathcal{Y}^{i}=\{Y\mid Y\in\{0,1\}^{C\times|B^{i}|},\forall j\in[|B^{i}|],%
\sum_{c=1}^{C}Y_{c,j}=1,~{}\mathrm{and}~{}\forall c\in[C],\sum_{j=1}^{|B^{i}|}%
Y_{c,j}=k_{c}^{i}\}
k_{c}^{i}=|B^{i}|p^{i}_{c}
c
B^{i}
B^{i}
L^{i}\in[0,1]^{C\times|B^{i}|}
c
x^{i}_{j}
L^{i}_{c,j}
\hat{Y}^{i}[1]\in\mathcal{Y}^{i}
(i\in[n])
f[0]
t=1,\ldots,T
i\in[n]
f[t]
f[t-1]
\ell
((x^{1}_{1},\hat{Y}^{1}_{:,1}[t]),\ldots,(x^{n}_{|B^{n}|},\hat{Y}^{n}_{:,|B^{n%
}|}[t]))
L^{i}[t]
\hat{Y}^{i}[t]
L^{i}[1],\ldots,L^{i}[t]
t
\displaystyle L^{i}_{c,j}[t]=\begin{cases}1-\mathrm{conf}(x^{i}_{j},c,f[t])&%
\hat{Y}_{c,j}^{i}[t]=1\\
{\displaystyle\max_{c\in[C]}}~{}\mathrm{conf}(x^{i}_{j},c,f[t])-\mathrm{conf}(%
x^{i}_{j},c,f[t])&\text{otherwise},\end{cases}
\displaystyle L^{i}_{c,j}[t]=\begin{cases}1-\mathrm{conf}(x^{i}_{j},c,f[t])&%
\hat{Y}_{c,j}^{i}[t]=1\\
{\displaystyle\max_{c\in[C]}}~{}\mathrm{conf}(x^{i}_{j},c,f[t])-\mathrm{conf}(%
x^{i}_{j},c,f[t])&\text{otherwise},\end{cases}
\mathrm{conf}
f
x^{i}_{j}
c
f[t]
x_{j}^{i}
c
x_{j}^{i}
c
f[t]
c
x_{j}^{i}
x_{j}^{i}
c
f[t]
c
f[t]
x_{j}^{i}
c
x_{j}^{i}
c
f[t]
c
x_{j}^{i}
x_{j}^{i}
c
\max_{c\in[C]}~{}\mathrm{conf}(x^{i}_{j},c,f[t])
x_{j}^{i}
c
f[t]
L^{i}_{c,j}[t]
B^{i}
x^{i}_{j}
t
\hat{Y}_{:,j}^{i}[t]^{\top}L_{:,j}^{i}[t]
\hat{Y}^{i}[t]
B^{i}
\sum_{j=1}^{|B^{i}|}\hat{Y}_{:,j}^{i}[t]^{\top}L_{:,j}^{i}[t]
\hat{Y}^{i}[t]
\sum_{j=1}^{|B^{i}|}\hat{Y}_{:,j}^{i}[t]^{\top}L_{:,j}^{i}[t]
L^{i}[t]
\hat{Y}^{i}[t]
L^{i}[t]
\hat{Y}^{i}[t]
\sum_{j=1}^{|B^{i}|}\hat{Y}_{:,j}^{i}[t]^{\top}L_{:,j}^{i}[t]
\displaystyle(\hat{Y}^{i})^{*}=\mathop{\rm arg~{}min}\limits_{\hat{Y}^{i}\in%
\mathcal{Y}^{i}}\sum_{t=1}^{T}\sum_{j=1}^{|B^{i}|}\hat{Y}_{:,j}^{i\top}L_{:,j}%
^{i}[t].
\displaystyle(\hat{Y}^{i})^{*}=\mathop{\rm arg~{}min}\limits_{\hat{Y}^{i}\in%
\mathcal{Y}^{i}}\sum_{t=1}^{T}\sum_{j=1}^{|B^{i}|}\hat{Y}_{:,j}^{i\top}L_{:,j}%
^{i}[t].
(\hat{Y}^{i})^{*}
(\hat{Y}^{i})^{*}
T
\hat{Y}^{i}[t]
B^{i}
\displaystyle R_{T}^{i}=\sum_{t=1}^{T}\sum_{j=1}^{|B^{i}|}\hat{Y}_{:,j}^{i}[t]%
^{\top}L_{:,j}^{i}[t]-\sum_{t=1}^{T}\sum_{j=1}^{|B^{i}|}(\hat{Y}_{:,j}^{i})^{*%
\top}L_{:,j}^{i}[t].
\displaystyle R_{T}^{i}=\sum_{t=1}^{T}\sum_{j=1}^{|B^{i}|}\hat{Y}_{:,j}^{i}[t]%
^{\top}L_{:,j}^{i}[t]-\sum_{t=1}^{T}\sum_{j=1}^{|B^{i}|}(\hat{Y}_{:,j}^{i})^{*%
\top}L_{:,j}^{i}[t].
L^{i}[t]
L^{i}[1],\allowbreak\ldots,\allowbreak L^{i}[T]
Z^{i}\in\mathbb{R}^{C\times|B^{i}|}
\eta
L^{i}[t]
\eta
t
L^{i}[t]
L^{i}[1],\ldots,\allowbreak L^{i}[T]
\mathbb{E}[R^{i}_{T}]=O(|B^{i}|\sqrt{T\ln|\mathcal{Y}^{i}|})
|\mathcal{Y}_{i}|
(B^{1},{\bf p}^{1}),\ldots,(B^{n},{\bf p}^{n})
T
f[0]
\ell
\eta>0
f[T]
\forall i\in[n]
\hat{Y}^{i}[1]\in\mathcal{Y}^{i}
Z^{i}\in\mathbb{R}^{C\times|B^{i}|}
t=1,\ldots,T
f[t]
f[t-1]
\ell
((x^{1}_{1},\hat{Y}^{1}_{:,1}[t]),\ldots,(x^{n}_{|B^{n}|},\hat{Y}^{n}_{:,|B^{n%
}|}[t]))
i=1,\ldots,n
L^{i}[t]
{Z}_{c,j}^{i}\sim\mathcal{N}(0,1)
c\in[C]
j\in[|B^{i}|]
\displaystyle\hat{Y}^{i}[t+1]=\arg\min_{\hat{Y}^{i}\in\mathcal{Y}^{i}}\left(%
\sum_{\tau=1}^{t}\sum_{j=1}^{|B^{i}|}\hat{Y}_{:,j}^{i\top}(L_{:,j}^{i}[t]+\eta
Z%
_{:,j}^{i})\right)
\displaystyle\hat{Y}^{i}[t+1]=\arg\min_{\hat{Y}^{i}\in\mathcal{Y}^{i}}\left(%
\sum_{\tau=1}^{t}\sum_{j=1}^{|B^{i}|}\hat{Y}_{:,j}^{i\top}(L_{:,j}^{i}[t]+\eta
Z%
_{:,j}^{i})\right)
\displaystyle\min_{\hat{Y}^{i}\in\{0,1\}^{C\times|B^{i}|}}\sum_{\tau=1}^{t}%
\sum_{j=1}^{|B^{i}|}\left(\hat{Y}_{:,j}^{i}[t]^{\top}L_{:,j}^{i}[t]+\eta\hat{Y%
}_{:,j}^{i\top}Z_{:,j}^{i}\right)
\displaystyle\min_{\hat{Y}^{i}\in\{0,1\}^{C\times|B^{i}|}}
\displaystyle\sum_{\tau=1}^{t}\sum_{j=1}^{|B^{i}|}\left(\hat{Y}_{:,j}^{i}[t]^{%
\top}L_{:,j}^{i}[t]+\eta\hat{Y}_{:,j}^{i\top}Z_{:,j}^{i}\right)
\displaystyle\mathrm{s.t.}\quad\quad\forall j\in[|B^{i}|],\sum_{c=1}^{C}\hat{Y%
}_{c,j}^{i}=1,~{}~{}\forall c\in[C],\sum_{j=1}^{|B^{i}|}\hat{Y}_{c,j}^{i}=k_{c%
}^{i}.
\displaystyle\mathrm{s.t.}\quad\quad
\displaystyle\forall j\in[|B^{i}|],\sum_{c=1}^{C}\hat{Y}_{c,j}^{i}=1,~{}~{}%
\forall c\in[C],\sum_{j=1}^{|B^{i}|}\hat{Y}_{c,j}^{i}=k_{c}^{i}.
\displaystyle\ell_{\mathrm{prop}}(B^{i},{\bf p}^{i},f)=-\sum_{c=1}^{C}p_{c}^{i%
}\log\frac{1}{|B^{i}|}\sum_{j=1}^{|B^{i}|}\mathrm{conf}(x_{j}^{i},c,f).
\displaystyle\ell_{\mathrm{prop}}(B^{i},{\bf p}^{i},f)=-\sum_{c=1}^{C}p_{c}^{i%
}\log\frac{1}{|B^{i}|}\sum_{j=1}^{|B^{i}|}\mathrm{conf}(x_{j}^{i},c,f).
\Pi
\displaystyle L^{i}_{c,j}[t]=1-\mathrm{conf}(x^{i}_{j},c,f[t]).
\displaystyle L^{i}_{c,j}[t]=1-\mathrm{conf}(x^{i}_{j},c,f[t]).
L^{i}[t]
\hat{Y}^{i}[t+1]=\arg\min_{\hat{Y}^{i}\in\mathcal{Y}^{i}}\sum_{j=1}^{|B^{i}|}%
\hat{Y}_{:,j}^{i\top}L_{:,j}^{i}[t]
0.0003
400
\eta
5
102400
7:3
64,128,256,512,1024,2048,4096
1024
n
100
n
\Pi
\Pi
\sum_{t}\hat{Y}^{i\top}L^{i}[t]
\Pi
64,128,256,512,1024
