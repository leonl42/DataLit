r_{\theta}(x,y)
x
y
r_{\theta}(x,y)
y
x
\pi_{\theta}
\mathcal{L}_{\text{PPO}}=\mathbb{E}_{(x,y)\sim D_{\pi}}[r_{\theta}(x,y)-\gamma%
\log\frac{\pi_{\theta}(y|x)}{\pi_{\text{SFT}}(y|x)}],
\pi_{\text{SFT}}
\gamma
\pi_{\text{ref}}
(y_{w},y_{l})
\displaystyle\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=-\mathbb{%
E}_{(x,y_{w},y_{l})\sim\mathcal{D}}
\displaystyle\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=-\mathbb{%
E}_{(x,y_{w},y_{l})\sim\mathcal{D}}
\displaystyle\left[\log\sigma\left(\beta\log\frac{\pi_{\theta}(y_{w}\mid x)}{%
\pi_{\text{ref}}(y_{w}\mid x)}-\beta\log\frac{\pi_{\theta}(y_{l}\mid x)}{\pi_{%
\text{ref}}(y_{l}\mid x)}\right)\right],
\displaystyle\left[\log\sigma\left(\beta\log\frac{\pi_{\theta}(y_{w}\mid x)}{%
\pi_{\text{ref}}(y_{w}\mid x)}-\beta\log\frac{\pi_{\theta}(y_{l}\mid x)}{\pi_{%
\text{ref}}(y_{l}\mid x)}\right)\right],
y_{w}
y_{l}
\beta
(Y,\bar{Y})
\mathop{\arg\max}\limits_{\theta}P(\bar{Y}|{Y};\theta),
\bar{Y}
Y
P(\bar{Y}|Y)
\bar{Y}
P(\bar{Y}|Y)
x
r_{\theta}(x,Y)
\{Y_{i}\}
\bar{Y}
\mathcal{L}_{\text{PPO}}=\mathbb{E}_{i}[P(\bar{Y}|Y_{i},x)-\gamma\log\frac{\pi%
_{\theta}(Y_{i}|x)}{\pi_{\text{SFT}}(Y_{i}|x)}].
(Y_{w},Y_{l})
Y_{w}
Y_{l}
n
\binom{n}{2}
(Y_{w},Y_{l})
\bar{Y}
\pi_{\text{ref}}
\displaystyle\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=-\mathbb{%
E}_{(x,\bar{Y},Y_{w},Y_{l})\sim\mathcal{D}}
\displaystyle\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=-\mathbb{%
E}_{(x,\bar{Y},Y_{w},Y_{l})\sim\mathcal{D}}
\displaystyle\left[\log\sigma\left(\beta\log\frac{\pi_{\theta}(Y_{w}\mid x)}{%
\pi_{\text{ref}}(Y_{w}\mid x)}-\beta\log\frac{\pi_{\theta}(Y_{l}\mid x)}{\pi_{%
\text{ref}}(Y_{l}\mid x)}\right)\right].
\displaystyle\left[\log\sigma\left(\beta\log\frac{\pi_{\theta}(Y_{w}\mid x)}{%
\pi_{\text{ref}}(Y_{w}\mid x)}-\beta\log\frac{\pi_{\theta}(Y_{l}\mid x)}{\pi_{%
\text{ref}}(Y_{l}\mid x)}\right)\right].
\pi_{\theta_{i}}
\pi_{\theta_{(i+1)}}
\pi_{\theta_{(i+1)}}
m
n
\text{ACR}=\frac{|m\cap n|}{|n|}
\beta
