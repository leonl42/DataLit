Q
Q
\{-1,0\}
\{0,1\}
Q
Q
Q
-1
0
0
1
Q
s
a
s^{+}
\xi
\mu
\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)
\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)
s
a
g
\pi
\xi
\mu
\rho^{+}(g)\rho_{\mu}(s)\pi(a\mid s,g)
\rho^{+}(g)\rho_{\mu}(s)\pi(a\mid s,g)
s
a
g
\pi
\xi
\mu
\rho^{+}(g)\rho_{\pi}(s,a\mid g)
\rho^{+}(g)\rho_{\pi}(s,a\mid g)
\mathcal{S}
\mathcal{A}
\rho^{0}
p
r
\mathcal{S}
\mathcal{A}
\rho^{0}(s)
p(s^{\prime}\mid s,a)
r(s,a)
\mu(a\mid s)
\mu:\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}^{+}
\mu
t
\rho^{0}
t=0
t+1
\displaystyle\rho^{t+1}_{\mu}(s^{\prime})=\int_{\mathcal{S}\times\mathcal{A}}p%
(s^{\prime}\mid s,a)\mu(a\mid s)\rho^{t}_{\mu}(s)\mathrm{d}s\mathrm{d}a
\displaystyle\rho^{t+1}_{\mu}(s^{\prime})=\int_{\mathcal{S}\times\mathcal{A}}p%
(s^{\prime}\mid s,a)\mu(a\mid s)\rho^{t}_{\mu}(s)\mathrm{d}s\mathrm{d}a
\text{Geom}(\gamma)
\displaystyle\rho_{\mu}(s)=(1-\gamma)\cdot\sum_{t=0}^{\infty}\gamma^{t}\cdot%
\rho^{t}_{\mu}(s)
\displaystyle\rho_{\mu}(s)=(1-\gamma)\cdot\sum_{t=0}^{\infty}\gamma^{t}\cdot%
\rho^{t}_{\mu}(s)
\gamma\in(0,1)
\displaystyle\mathcal{J}(\mu)=\dfrac{1}{1-\gamma}\int_{\mathcal{S}}\rho_{\mu}(%
s)\int_{\mathcal{A}}\mu(a\mid s)r(s,a)\mathrm{d}a\mathrm{d}s
\displaystyle\mathcal{J}(\mu)
\displaystyle=\dfrac{1}{1-\gamma}\int_{\mathcal{S}}\rho_{\mu}(s)\int_{\mathcal%
{A}}\mu(a\mid s)r(s,a)\mathrm{d}a\mathrm{d}s
\displaystyle=\mathbb{E}_{\begin{subarray}{c}\rho^{0}(s_{0})\mu(a_{0}\mid s_{0%
})\\
p(s_{1}\mid s_{0},a_{0})\mu(a_{1}\mid s_{1})\cdots\end{subarray}}\Bigg{[}\sum_%
{t=0}^{\infty}\gamma^{t}r(s_{t},a_{t})\Bigg{]}
\displaystyle=\mathbb{E}_{\begin{subarray}{c}\rho^{0}(s_{0})\mu(a_{0}\mid s_{0%
})\\
p(s_{1}\mid s_{0},a_{0})\mu(a_{1}\mid s_{1})\cdots\end{subarray}}\Bigg{[}\sum_%
{t=0}^{\infty}\gamma^{t}r(s_{t},a_{t})\Bigg{]}
p^{+}(s^{+}\mid s,a)
\mu
\displaystyle p^{+}_{\mu}(s^{+}\mid s,a)
\displaystyle p^{+}_{\mu}(s^{+}\mid s,a)
\displaystyle=(1-\gamma)p(s^{+}\mid s,a)+\gamma\mathbb{E}_{\begin{subarray}{c}%
p(s^{\prime}\mid s,a)\\
\mu(a^{\prime}\mid s^{\prime})\end{subarray}}[p^{+}_{\mu}(s^{+}\mid s^{\prime}%
,a^{\prime})]
\displaystyle=
\displaystyle(1-\gamma)p(s^{+}\mid s,a)+\gamma\mathbb{E}_{\begin{subarray}{c}p%
(s^{\prime}\mid s,a)\\
\mu(a^{\prime}\mid s^{\prime})\end{subarray}}[p^{+}_{\mu}(s^{+}\mid s^{\prime}%
,a^{\prime})]
\mathcal{G}
\pi:\mathcal{S}\times\mathcal{G}\times\mathcal{A}\rightarrow\mathbb{R}^{+}
0
-1
\displaystyle r(s,a,s^{\prime},s^{+})=-\mathds{1}(\lVert s^{\prime}-s^{+}%
\rVert>\epsilon)
\displaystyle r(s,a,s^{\prime},s^{+})=-\mathds{1}(\lVert s^{\prime}-s^{+}%
\rVert>\epsilon)
Q
f
P
Q
\displaystyle D_{f}(P\parallel Q)=\int_{X}q(x)f\bigg{(}\dfrac{p(x)}{q(x)}\bigg%
{)}\mathrm{d}x
\displaystyle D_{f}(P\parallel Q)
\displaystyle=\int_{X}q(x)f\bigg{(}\dfrac{p(x)}{q(x)}\bigg{)}\mathrm{d}x
\displaystyle\geq\sup_{T\in\mathcal{T}}\mathbb{E}_{x\sim P}[T(x)]-\mathbb{E}_{%
x\sim Q}[f^{*}(T(x))]
\displaystyle\geq\sup_{T\in\mathcal{T}}\mathbb{E}_{x\sim P}[T(x)]-\mathbb{E}_{%
x\sim Q}[f^{*}(T(x))]
f
f(1)=0
f^{*}
f
T
T:X\rightarrow\mathbb{R}
T
T^{*}(x)=f^{\prime}({p(x)}/{q(x)})
\rho^{\text{exp}}(s,a)
\displaystyle\operatorname*{arg\,min}_{\mu}D_{f}(\rho^{\text{exp}}(s,a)%
\parallel\rho^{\mu}(s,a))
\displaystyle\operatorname*{arg\,min}_{\mu}D_{f}(\rho^{\text{exp}}(s,a)%
\parallel\rho^{\mu}(s,a))
\displaystyle=\operatorname*{arg\,min}_{\mu}\max_{T}\mathbb{E}_{\rho^{\text{%
exp}}}[T(s,a)]-\mathbb{E}_{\rho^{\mu}}[f^{*}(T(s,a))]
\displaystyle=
\displaystyle\operatorname*{arg\,min}_{\mu}\max_{T}\mathbb{E}_{\rho^{\text{exp%
}}}[T(s,a)]-\mathbb{E}_{\rho^{\mu}}[f^{*}(T(s,a))]
\mu
\rho^{\mu}(s,a)
r(s,a)=f^{*}(T(s,a))
f
f(1)=0
\xi=(\rho^{0}(s),p(s^{\prime}\mid s,a),p(g))
\xi
\mathcal{D}=\{(s_{0},a_{0},s_{1},a_{1},\cdots)\}
\rho_{0}(s)
\mu(a\mid s)
p(s^{\prime}\mid s,a)
\pi(a\mid s,g)
p(g)
f
\mu
\displaystyle p_{\mu}(s,a,s^{+})=\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)
\displaystyle p_{\mu}(s,a,s^{+})=\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)
p_{\mu}^{+}
\rho_{\mu}(s,a)
\rho^{\text{exp}}(s,a)
\displaystyle p_{\pi}^{\text{BC}}(s,a,g)={p(g)}\rho_{\mu}(s)\pi(a\mid s,g)
\displaystyle p_{\pi}^{\text{BC}}(s,a,g)={p(g)}\rho_{\mu}(s)\pi(a\mid s,g)
\displaystyle\operatorname*{arg\,min}_{\pi}\mathcal{D}_{KL}(p_{\mu}(s,a,s^{+})%
\parallel p_{\pi}^{\text{BC}}(s,a,g))
\displaystyle\operatorname*{arg\,min}_{\pi}\mathcal{D}_{KL}(p_{\mu}(s,a,s^{+})%
\parallel p_{\pi}^{\text{BC}}(s,a,g))
\displaystyle=\operatorname*{arg\,min}_{\pi}\mathbb{E}_{\rho_{\mu}(s,a)p^{+}_{%
\mu}(s^{+}\mid s,a)}[-\log\pi(a\mid s,g)]
\displaystyle=
\displaystyle\operatorname*{arg\,min}_{\pi}\mathbb{E}_{\rho_{\mu}(s,a)p^{+}_{%
\mu}(s^{+}\mid s,a)}[-\log\pi(a\mid s,g)]
\pi
\displaystyle p_{\pi}(s,a,g)={p(g)}\rho_{\pi}(s,a\mid g)
\displaystyle p_{\pi}(s,a,g)={p(g)}\rho_{\pi}(s,a\mid g)
f
\pi
\displaystyle\mathcal{L}_{IL}={D_{f}(p(g)\rho_{\pi}(s,a|g)\parallel p_{\mu}^{+%
}(s^{+}|s,a)\rho_{\mu}(s,a))}
\displaystyle\mathcal{L}_{IL}={D_{f}(p(g)\rho_{\pi}(s,a|g)\parallel p_{\mu}^{+%
}(s^{+}|s,a)\rho_{\mu}(s,a))}
\pi
\displaystyle\mathcal{L}_{RL}=\mathbb{E}_{\pi}\bigg{[}\dfrac{\sum_{\Delta=0}%
\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g\mid s_{t},a_{t})\Delta}{\sum_{\Delta=0%
}\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g\mid s_{t},a_{t})}\bigg{]}
\displaystyle\mathcal{L}_{RL}=\mathbb{E}_{\pi}\bigg{[}\dfrac{\sum_{\Delta=0}%
\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g\mid s_{t},a_{t})\Delta}{\sum_{\Delta=0%
}\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g\mid s_{t},a_{t})}\bigg{]}
\mathcal{L}_{IL}
\mathcal{L}_{RL}
Q
Q
f
\displaystyle D_{f}(p_{\pi}(s,a,g)\parallel p_{\mu}(s,a,s^{+}))
\displaystyle D_{f}(p_{\pi}(s,a,g)\parallel p_{\mu}(s,a,s^{+}))
\displaystyle=\max_{T}\mathbb{E}_{\begin{subarray}{c}p(g)\\
\rho_{\pi}(s,a\mid g)\end{subarray}}[T(s,a,g)]-\mathbb{E}_{\begin{subarray}{c}%
\rho_{\mu}(s,a)\\
p^{+}_{\mu}(s^{+}\mid s,a)\end{subarray}}[f^{*}(T(s,a,s^{+}))]
\displaystyle=
\displaystyle\max_{T}\mathbb{E}_{\begin{subarray}{c}p(g)\\
\rho_{\pi}(s,a\mid g)\end{subarray}}[T(s,a,g)]-\mathbb{E}_{\begin{subarray}{c}%
\rho_{\mu}(s,a)\\
p^{+}_{\mu}(s^{+}\mid s,a)\end{subarray}}[f^{*}(T(s,a,s^{+}))]
T
r(s,a,g)=-T(s,a,g)
\displaystyle\max_{\pi}\min_{r}\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)%
\\
p^{+}_{\mu}(s^{+}\mid s,a)\end{subarray}}[f^{*}(-r(s,a,s^{+}))]+\mathbb{E}_{%
\begin{subarray}{c}p(g)\\
\rho_{\pi}(s,a\mid g)\end{subarray}}[r(s,a,g)]
\displaystyle\max_{\pi}\min_{r}\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)%
\\
p^{+}_{\mu}(s^{+}\mid s,a)\end{subarray}}[f^{*}(-r(s,a,s^{+}))]+\mathbb{E}_{%
\begin{subarray}{c}p(g)\\
\rho_{\pi}(s,a\mid g)\end{subarray}}[r(s,a,g)]
r
Q
Q(s,a,g)=r(s,a,g)+\gamma\cdot\mathcal{P}^{\pi}Q(s,a,g)
\mathcal{P}^{\pi}
\mathcal{P}^{\pi}Q(s,a,g)=\mathbb{E}_{p(s^{\prime}\mid s,a)\pi(a^{\prime}\mid s%
^{\prime},g)}[Q_{(}s^{\prime},a^{\prime},g)]
Q
\displaystyle\min_{Q}\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)\\
p^{+}_{\mu}(s^{+}\mid s,a)\end{subarray}}[f^{*}(-(Q-\gamma\cdot\mathcal{P}^{%
\pi}Q)(s,a,s^{+}))]
\displaystyle\min_{Q}\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)\\
p^{+}_{\mu}(s^{+}\mid s,a)\end{subarray}}[f^{*}(-(Q-\gamma\cdot\mathcal{P}^{%
\pi}Q)(s,a,s^{+}))]
\displaystyle+\mathbb{E}_{\begin{subarray}{c}p(g)\\
\rho_{\pi}(s,a\mid g)\end{subarray}}[(Q-\gamma\cdot\mathcal{P}^{\pi}Q)(s,a,g)]
\displaystyle+\mathbb{E}_{\begin{subarray}{c}p(g)\\
\rho_{\pi}(s,a\mid g)\end{subarray}}[(Q-\gamma\cdot\mathcal{P}^{\pi}Q)(s,a,g)]
\rho^{0}(s)
\pi(a\mid s,g)
Q
Q^{\pi}(s,a,g)
\rho_{\mu}(s,a)
\mu(a\mid s)
\pi
\displaystyle\mathbb{E}_{p(g){\color[rgb]{0,0,1}\rho_{\pi}(s,a\mid g)}}[(Q^{%
\pi}-\gamma\cdot\mathcal{P}^{\pi}Q^{\pi})({\color[rgb]{0,0,1}s},{\color[rgb]{%
0,0,1}a},g)]
\displaystyle\mathbb{E}_{p(g){\color[rgb]{0,0,1}\rho_{\pi}(s,a\mid g)}}[(Q^{%
\pi}-\gamma\cdot\mathcal{P}^{\pi}Q^{\pi})({\color[rgb]{0,0,1}s},{\color[rgb]{%
0,0,1}a},g)]
\displaystyle=\mathbb{E}_{p(g){\color[rgb]{1,0,0}{\rho_{\mu}(s,a)}}{\color[rgb%
]{0,0,1}\pi(\tilde{a}\mid s,g)}}[Q^{\pi}({\color[rgb]{1,0,0}s},{\color[rgb]{%
0,0,1}\tilde{a}},g)-\gamma\cdot\mathcal{P}^{\pi}Q^{\pi}({\color[rgb]{1,0,0}s},%
{\color[rgb]{1,0,0}a},g)]
\displaystyle=
\displaystyle\mathbb{E}_{p(g){\color[rgb]{1,0,0}{\rho_{\mu}(s,a)}}{\color[rgb]%
{0,0,1}\pi(\tilde{a}\mid s,g)}}[Q^{\pi}({\color[rgb]{1,0,0}s},{\color[rgb]{%
0,0,1}\tilde{a}},g)-\gamma\cdot\mathcal{P}^{\pi}Q^{\pi}({\color[rgb]{1,0,0}s},%
{\color[rgb]{1,0,0}a},g)]
\displaystyle\max_{\pi}\min_{Q}\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)p%
^{+}_{\mu}(s^{+}\mid s,a)\end{subarray}}\Big{\{}f^{*}(-(Q-\gamma\mathcal{P}^{%
\pi}Q)(s,a,s^{+}))
\displaystyle\max_{\pi}
\displaystyle\min_{Q}\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)p^{+}_{\mu}%
(s^{+}\mid s,a)\end{subarray}}\Big{\{}f^{*}(-(Q-\gamma\mathcal{P}^{\pi}Q)(s,a,%
s^{+}))
\displaystyle+\mathbb{E}_{p(g)\pi(\tilde{a}\mid s,g)}[Q(s,\tilde{a},g)-\gamma%
\mathcal{P}^{\pi}Q(s,a,g)]\Big{\}}
\displaystyle+
\displaystyle\mathbb{E}_{p(g)\pi(\tilde{a}\mid s,g)}[Q(s,\tilde{a},g)-\gamma%
\mathcal{P}^{\pi}Q(s,a,g)]\Big{\}}
f^{*}
f
f
f^{*}
((f^{*})^{*})(1)=0
\mathcal{L}_{IL}=\mathcal{D}_{f}(p_{\mu}(s,a,s^{+})\parallel p_{\pi}(s,a,g))
Q
\pi
\mathds{1}[s^{\prime}=g]
p(s^{\prime}\mid s,a)
\mathbb{R}^{+}
[0,1]
p(s^{\prime}=g\mid s,a)
\mathbb{R}^{+}
\{0,1\}
[0,1]
\displaystyle Q(s_{t},a,g)=-\dfrac{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+%
1+\Delta}=g\mid s_{t},a)\Delta}{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+1+%
\Delta}=g\mid s_{t},a)}
\displaystyle Q(s_{t},a,g)
\displaystyle=-\dfrac{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g%
\mid s_{t},a)\Delta}{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g%
\mid s_{t},a)}
\Delta
\gamma
Q
Q_{t}=\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}[(1-\dfrac{\beta_{t}}{\beta_{t}+%
\alpha_{t}^{(1)}})(-1+Q_{t+1})]
Q_{t}=Q(s_{t},a,g)
Q_{t+1}=\mathbb{E}_{\pi(s_{t+1},g)}[Q(s_{t+1},a^{\prime},g)]
\alpha_{t}^{(i)}=\sum_{\Delta=i}\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g\mid s_%
{t},a)
\beta_{t}=p(s_{t+1}=g\mid s_{t},a)
[1-{\beta_{t}}/{(\beta_{t}+\alpha_{t}^{(1)})}]
(-1+Q_{t+1})
t+1
\beta_{t}
Q_{t}
0
r=0
\alpha_{t}^{(1)}
r=-1
\epsilon\rightarrow 0
Q
\{-1,0\}
\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)\\
p(s^{\prime}\mid s,a)\\
p^{+}_{\mu}(s^{+}\mid s,a)\end{subarray}}[f^{*}(-(Q-\gamma\mathcal{P}^{\pi}Q)(%
s,a,s^{+}))-\beta Q(s,a,s^{\prime})]
\beta=(1-\gamma)
f^{*}
f^{*}(x)=(x-1)^{2}/2+3/2
Q
\pi
(s,a,s^{\prime})
a
s^{\prime}
Q
Q
Q
(s,a,s^{+})
(s,a,s^{\prime})
Q
w(s,a,s^{\prime},g)
\displaystyle w=\mathds{1}(Q(s,a,g)-\max_{a^{\prime}}Q(s^{\prime},a^{\prime},g%
)<\log\gamma_{\text{hdm}})
\displaystyle w=\mathds{1}(Q(s,a,g)-\max_{a^{\prime}}Q(s^{\prime},a^{\prime},g%
)<\log\gamma_{\text{hdm}})
Q
\{-1,0\}
\mathcal{L}_{\text{hdm}}
\displaystyle\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a,s^{\prime},g)\end{%
subarray}}[-w(s,a,s^{\prime},g)\cdot\log\text{softmax}Q(s,a,g)]
\displaystyle\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a,s^{\prime},g)\end{%
subarray}}[-w(s,a,s^{\prime},g)\cdot\log\text{softmax}Q(s,a,g)]
-\log\gamma_{\text{hdm}}
Q
Q
Q
-\infty
0
Q
Q
\log p(s^{\prime}=g\mid s,a)
Q
f
f
f
Q
r=1
r=0
(-1,0)
(0,1)
(0,1)
(-1,0)
(0,1)
(0,1)
\{-1,0\}
\{-1,0\}
\pi
s_{0}
s_{T}
\pi
\pi
s_{0}
s_{T}
\pi
Q
\gamma_{\text{hdm}}=0.95
\gamma_{\text{hdm}}=0.85
\gamma_{\text{hdm}}=0.75
\gamma_{\text{hdm}}
-\log\gamma_{\text{hdm}}
Q
Q
\gamma_{\text{hdm}}=0.95
\gamma_{\text{hdm}}=0.85
\gamma_{\text{hdm}}=0.75
\gamma_{\text{hdm}}
-\log\gamma_{\text{hdm}}
Q
\{-1,0\}
\pm
\pm
\pm
\pm
\pm
r=(0,1)
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
r=(-1,0)
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\pm
\{-1,0\}
\displaystyle Q(s,a,g)=\begin{cases}\gamma\cdot Q(s^{\prime},\pi(s^{\prime},g)%
,g)&s^{\prime}=g\\
-1+\gamma\cdot Q(s^{\prime},\pi(s^{\prime},g),g)&s^{\prime}\neq g\end{cases}
\displaystyle Q(s,a,g)=\begin{cases}\gamma\cdot Q(s^{\prime},\pi(s^{\prime},g)%
,g)&s^{\prime}=g\\
-1+\gamma\cdot Q(s^{\prime},\pi(s^{\prime},g),g)&s^{\prime}\neq g\end{cases}
\{0,1\}
Q(s,a,s^{\prime})
1
\displaystyle Q(s,a,g)=\begin{cases}1&s^{\prime}=g\\
\gamma\cdot Q(s^{\prime},\pi(s^{\prime},g),g)&s^{\prime}\neq g\end{cases}
\displaystyle Q(s,a,g)=\begin{cases}1&s^{\prime}=g\\
\gamma\cdot Q(s^{\prime},\pi(s^{\prime},g),g)&s^{\prime}\neq g\end{cases}
\{0,1\}
\displaystyle Q(s,a,g)=\begin{cases}1+\gamma\cdot Q(s^{\prime},\pi(s^{\prime},%
g),g)&s^{\prime}=g\\
\gamma\cdot Q(s^{\prime},\pi(s^{\prime},g),g)&s^{\prime}\neq g\end{cases}
\displaystyle Q(s,a,g)=\begin{cases}1+\gamma\cdot Q(s^{\prime},\pi(s^{\prime},%
g),g)&s^{\prime}=g\\
\gamma\cdot Q(s^{\prime},\pi(s^{\prime},g),g)&s^{\prime}\neq g\end{cases}
\{-1,0\}
Q
\{-1,0\}
Q
\{0,1\}
1/(1-\gamma)
Q
\{-1,0\}
(s^{\prime}=g)
Q
1
\{-1,0\}
Q
Q
(-1,0)
Q
\gamma_{\text{hdm}}
Q
\displaystyle\operatorname*{arg\,min}_{\pi}\mathcal{D}_{KL}(p_{\mu}(s,a,s^{+})%
\parallel p_{\pi}^{\text{BC}}(s,a,g))
\displaystyle\operatorname*{arg\,min}_{\pi}\mathcal{D}_{KL}(p_{\mu}(s,a,s^{+})%
\parallel p_{\pi}^{\text{BC}}(s,a,g))
\displaystyle=\operatorname*{arg\,min}_{\pi}\mathbb{E}_{\rho_{\mu}(s,a)p^{+}_{%
\mu}(s^{+}\mid s,a)}[-\log\pi(a\mid s,g)]
\displaystyle=
\displaystyle\operatorname*{arg\,min}_{\pi}\mathbb{E}_{\rho_{\mu}(s,a)p^{+}_{%
\mu}(s^{+}\mid s,a)}[-\log\pi(a\mid s,g)]
\displaystyle D_{KL}(P\parallel Q)=\int_{X}P(x)\log\dfrac{P(x)}{Q(x)}\mathrm{d}x
\displaystyle D_{KL}(P\parallel Q)=\int_{X}P(x)\log\dfrac{P(x)}{Q(x)}\mathrm{d}x
\displaystyle p_{\mu}(s,a,s^{+})=\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)
\displaystyle p_{\mu}(s,a,s^{+})
\displaystyle=\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)
\displaystyle p_{\pi}^{\text{BC}}(s,a,g)={p(g)}\rho_{\mu}(s)\pi(a\mid s,g)
\displaystyle p_{\pi}^{\text{BC}}(s,a,g)
\displaystyle={p(g)}\rho_{\mu}(s)\pi(a\mid s,g)
\displaystyle D_{KL}(p_{\mu}(s,a,s^{+})\parallel p_{\pi}^{\text{BC}}(s,a,g))=%
\mathbb{E}_{p_{\mu}(s,a,s^{+})}[\log p_{\mu}(s,a,s^{+})-\log p_{\pi}^{\text{BC%
}}(s,a,g)]
\displaystyle D_{KL}(p_{\mu}(s,a,s^{+})\parallel p_{\pi}^{\text{BC}}(s,a,g))
\displaystyle=\mathbb{E}_{p_{\mu}(s,a,s^{+})}[\log p_{\mu}(s,a,s^{+})-\log p_{%
\pi}^{\text{BC}}(s,a,g)]
\displaystyle=\mathbb{E}_{p_{\mu}(s,a,s^{+})}[\log p_{\mu}(s,a,s^{+})-\log{p(g%
)}-\log\rho_{\mu}(s)-\log\pi(a\mid s,g)]
\displaystyle=\mathbb{E}_{p_{\mu}(s,a,s^{+})}[\log p_{\mu}(s,a,s^{+})-\log{p(g%
)}-\log\rho_{\mu}(s)-\log\pi(a\mid s,g)]
\displaystyle=\mathbb{E}_{\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)}\bigg{[}%
\log\dfrac{p_{\mu}(s,a,s^{+})}{p(g)\rho_{\mu}(s)}-\log\pi(a\mid s,g)\bigg{]}
\displaystyle=\mathbb{E}_{\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)}\bigg{[}%
\log\dfrac{p_{\mu}(s,a,s^{+})}{p(g)\rho_{\mu}(s)}-\log\pi(a\mid s,g)\bigg{]}
\displaystyle\operatorname*{arg\,min}_{\pi}\mathcal{D}_{KL}(p_{\mu}(s,a,s^{+})%
\parallel p_{\pi}^{\text{BC}}(s,a,g))=\operatorname*{arg\,min}_{\pi}\mathbb{E}%
_{\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)}[-\log\pi(a\mid s,g)]
\displaystyle\operatorname*{arg\,min}_{\pi}\mathcal{D}_{KL}(p_{\mu}(s,a,s^{+})%
\parallel p_{\pi}^{\text{BC}}(s,a,g))=\operatorname*{arg\,min}_{\pi}\mathbb{E}%
_{\rho_{\mu}(s,a)p^{+}_{\mu}(s^{+}\mid s,a)}[-\log\pi(a\mid s,g)]
\pi(a\mid s,g)
Q
Q^{\pi}(s,a,g)
\rho_{\mu}(s,a)
\mu(a\mid s)
\pi
\mathbb{E}_{p(g){\color[rgb]{0,0,1}\rho_{\pi}(s,a\mid g)}}[(Q^{\pi}-\gamma%
\cdot\mathcal{P}^{\pi}Q^{\pi})({\color[rgb]{0,0,1}s},{\color[rgb]{0,0,1}a},g)]%
=\mathbb{E}_{p(g){\color[rgb]{1,0,0}{\rho_{\mu}(s,a)}}{\color[rgb]{0,0,1}\pi(%
\tilde{a}\mid s,g)}}[Q^{\pi}({\color[rgb]{1,0,0}s},{\color[rgb]{0,0,1}\tilde{a%
}},g)-\gamma\cdot\mathcal{P}^{\pi}Q^{\pi}({\color[rgb]{1,0,0}s},{\color[rgb]{%
1,0,0}a},g)]
\displaystyle\mathbb{E}_{p(g){\color[rgb]{0,0,1}\rho_{\pi}(s,a\mid g)}}[(Q^{%
\pi}-\gamma\cdot\mathcal{P}^{\pi}Q^{\pi})({\color[rgb]{0,0,1}s},{\color[rgb]{%
0,0,1}a},g)]
\displaystyle\mathbb{E}_{p(g){\color[rgb]{0,0,1}\rho_{\pi}(s,a\mid g)}}[(Q^{%
\pi}-\gamma\cdot\mathcal{P}^{\pi}Q^{\pi})({\color[rgb]{0,0,1}s},{\color[rgb]{%
0,0,1}a},g)]
\displaystyle=\mathbb{E}_{p(g)\color[rgb]{0,0,1}{\rho_{\pi}(s,a\mid g)}}[Q^{%
\pi}(s,a,g)-\gamma\mathbb{E}_{p(s^{\prime}\mid s,a),\pi(a^{\prime}\mid s^{%
\prime},g)}Q^{\pi}(s^{\prime},a^{\prime},g)]
\displaystyle=\mathbb{E}_{p(g)\color[rgb]{0,0,1}{\rho_{\pi}(s,a\mid g)}}[Q^{%
\pi}(s,a,g)-\gamma\mathbb{E}_{p(s^{\prime}\mid s,a),\pi(a^{\prime}\mid s^{%
\prime},g)}Q^{\pi}(s^{\prime},a^{\prime},g)]
\displaystyle=(1-\gamma)\sum_{t=0}^{\infty}\gamma^{t}\mathbb{E}_{\begin{%
subarray}{c}p(g)\color[rgb]{0,0,1}{\rho^{t}_{\pi}(s\mid g)}\\
\pi(a\mid s,g)\end{subarray}}\Big{[}Q^{\pi}(s,a,g)-\gamma\mathbb{E}_{\begin{%
subarray}{c}p(s^{\prime}\mid s,a)\\
\pi(a^{\prime}\mid s^{\prime},g)\end{subarray}}Q^{\pi}(s^{\prime},a^{\prime},g%
)\Big{]}
\displaystyle=(1-\gamma)\sum_{t=0}^{\infty}\gamma^{t}\mathbb{E}_{\begin{%
subarray}{c}p(g)\color[rgb]{0,0,1}{\rho^{t}_{\pi}(s\mid g)}\\
\pi(a\mid s,g)\end{subarray}}\Big{[}Q^{\pi}(s,a,g)-\gamma\mathbb{E}_{\begin{%
subarray}{c}p(s^{\prime}\mid s,a)\\
\pi(a^{\prime}\mid s^{\prime},g)\end{subarray}}Q^{\pi}(s^{\prime},a^{\prime},g%
)\Big{]}
\displaystyle=(1-\gamma)\sum_{t}^{\infty}\Bigg{\{}\gamma^{t}\mathbb{E}_{\begin%
{subarray}{c}p(g)\\
\color[rgb]{0,0,1}{\rho^{t}_{\pi}(s\mid g)}\\
\pi(a\mid s,g)\end{subarray}}[Q^{\pi}(s,a,g)]-\gamma^{t+1}\mathbb{E}_{\begin{%
subarray}{c}p(g)\\
\color[rgb]{0,0,1}{\rho^{t+1}_{\pi}(s\mid g)}\\
\pi(a\mid s,g)\end{subarray}}[Q^{\pi}(s,a,g)]\Bigg{\}}
\displaystyle=(1-\gamma)\sum_{t}^{\infty}\Bigg{\{}\gamma^{t}\mathbb{E}_{\begin%
{subarray}{c}p(g)\\
\color[rgb]{0,0,1}{\rho^{t}_{\pi}(s\mid g)}\\
\pi(a\mid s,g)\end{subarray}}[Q^{\pi}(s,a,g)]-\gamma^{t+1}\mathbb{E}_{\begin{%
subarray}{c}p(g)\\
\color[rgb]{0,0,1}{\rho^{t+1}_{\pi}(s\mid g)}\\
\pi(a\mid s,g)\end{subarray}}[Q^{\pi}(s,a,g)]\Bigg{\}}
\displaystyle=(1-\gamma)\mathbb{E}_{p(g),{\color[rgb]{1,0,0}{\rho^{0}(s)}},\pi%
(a\mid s,g)}[Q^{\pi}(s,a,g)]
\displaystyle=(1-\gamma)\mathbb{E}_{p(g),{\color[rgb]{1,0,0}{\rho^{0}(s)}},\pi%
(a\mid s,g)}[Q^{\pi}(s,a,g)]
\displaystyle=(1-\gamma)\sum_{t}^{\infty}\Bigg{\{}\gamma^{t}\mathbb{E}_{\begin%
{subarray}{c}p(g)\\
\color[rgb]{1,0,0}{\rho^{t}_{\mu}(s)}\\
\pi(a\mid s,g)\end{subarray}}[Q^{\pi}(s,a,g)]-\gamma^{t+1}\mathbb{E}_{\begin{%
subarray}{c}p(g)\\
\color[rgb]{1,0,0}{\rho^{t+1}_{\mu}(s)}\\
\pi(a\mid s,g)\end{subarray}}[Q^{\pi}(s,a,g)]\Bigg{\}}
\displaystyle=(1-\gamma)\sum_{t}^{\infty}\Bigg{\{}\gamma^{t}\mathbb{E}_{\begin%
{subarray}{c}p(g)\\
\color[rgb]{1,0,0}{\rho^{t}_{\mu}(s)}\\
\pi(a\mid s,g)\end{subarray}}[Q^{\pi}(s,a,g)]-\gamma^{t+1}\mathbb{E}_{\begin{%
subarray}{c}p(g)\\
\color[rgb]{1,0,0}{\rho^{t+1}_{\mu}(s)}\\
\pi(a\mid s,g)\end{subarray}}[Q^{\pi}(s,a,g)]\Bigg{\}}
\displaystyle=(1-\gamma)\sum_{t=0}^{\infty}\gamma^{t}\mathbb{E}_{\begin{%
subarray}{c}p(g)\color[rgb]{1,0,0}{\rho^{t}_{\mu}(s,a)}\\
{\color[rgb]{0,0,1}\pi(\tilde{a}\mid s,g)}\end{subarray}}[Q^{\pi}(s,{\color[%
rgb]{0,0,1}\tilde{a}},g)-\gamma\mathbb{E}_{\begin{subarray}{c}{\color[rgb]{%
1,0,0}p(s^{\prime}\mid s,a)}\\
\pi(a^{\prime}\mid s^{\prime},g)\end{subarray}}Q^{\pi}(s^{\prime},a^{\prime},g)]
\displaystyle=(1-\gamma)\sum_{t=0}^{\infty}\gamma^{t}\mathbb{E}_{\begin{%
subarray}{c}p(g)\color[rgb]{1,0,0}{\rho^{t}_{\mu}(s,a)}\\
{\color[rgb]{0,0,1}\pi(\tilde{a}\mid s,g)}\end{subarray}}[Q^{\pi}(s,{\color[%
rgb]{0,0,1}\tilde{a}},g)-\gamma\mathbb{E}_{\begin{subarray}{c}{\color[rgb]{%
1,0,0}p(s^{\prime}\mid s,a)}\\
\pi(a^{\prime}\mid s^{\prime},g)\end{subarray}}Q^{\pi}(s^{\prime},a^{\prime},g)]
\displaystyle=\mathbb{E}_{p(g){\color[rgb]{1,0,0}{\rho_{\mu}(s,a)}}{\color[rgb%
]{0,0,1}\pi(\tilde{a}\mid s,g)}}[Q^{\pi}(s,{\color[rgb]{0,0,1}\tilde{a}},g)-%
\gamma\mathbb{E}_{{\color[rgb]{1,0,0}p(s^{\prime}\mid s,a)},\pi(a^{\prime}\mid
s%
^{\prime},g)}Q^{\pi}(s^{\prime},a^{\prime},g)]
\displaystyle=\mathbb{E}_{p(g){\color[rgb]{1,0,0}{\rho_{\mu}(s,a)}}{\color[rgb%
]{0,0,1}\pi(\tilde{a}\mid s,g)}}[Q^{\pi}(s,{\color[rgb]{0,0,1}\tilde{a}},g)-%
\gamma\mathbb{E}_{{\color[rgb]{1,0,0}p(s^{\prime}\mid s,a)},\pi(a^{\prime}\mid
s%
^{\prime},g)}Q^{\pi}(s^{\prime},a^{\prime},g)]
Q
\displaystyle Q_{t}=Q(s_{t},a_{t},g)
\displaystyle Q_{t}
\displaystyle=Q(s_{t},a_{t},g)
\displaystyle Q_{t+1}=\mathbb{E}_{\pi(s_{t+1},g)}[Q(s_{t+1},a^{\prime},g)]
\displaystyle Q_{t+1}
\displaystyle=\mathbb{E}_{\pi(s_{t+1},g)}[Q(s_{t+1},a^{\prime},g)]
\displaystyle\beta_{t}=p(s_{t+1}=g\mid s_{t},a_{t})
\displaystyle\beta_{t}
\displaystyle=p(s_{t+1}=g\mid s_{t},a_{t})
\displaystyle\alpha_{t}^{(i)}=\sum_{\Delta=i}\gamma^{\Delta}p_{\pi}(s_{t+1+%
\Delta}=g\mid s_{t},a_{t})
\displaystyle\alpha_{t}^{(i)}
\displaystyle=\sum_{\Delta=i}\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g\mid s_{t}%
,a_{t})
\displaystyle 1/\mathbb{E}_{\pi(a\mid s_{t},g)}[\alpha_{t}^{(0)}]=\mathbb{E}_{%
\pi(a\mid s_{t},g)}[1/\alpha_{t}^{(0)}]
\displaystyle 1/\mathbb{E}_{\pi(a\mid s_{t},g)}[\alpha_{t}^{(0)}]
\displaystyle=\mathbb{E}_{\pi(a\mid s_{t},g)}[1/\alpha_{t}^{(0)}]
\displaystyle 1/\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}[\alpha_{t+1}^{(1)}]=%
\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}[1/\alpha_{t}^{(1)}]
\displaystyle 1/\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}[\alpha_{t+1}^{(1)}]
\displaystyle=\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}[1/\alpha_{t}^{(1)}]
\displaystyle 1/\alpha_{t}^{(1)}=\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})\pi(a_{%
t+1}^{\prime}\mid s_{t+1},g)}[1/\alpha_{t+1}^{(1)}]
\displaystyle 1/\alpha_{t}^{(1)}=\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})\pi(a_{%
t+1}^{\prime}\mid s_{t+1},g)}[1/\alpha_{t+1}^{(1)}]
Q_{t}=\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}[(1-\dfrac{\beta_{t}}{\beta_{t}+%
\alpha_{t}^{(1)}})(-1+Q_{t+1})]
Q
\displaystyle Q(s_{t},a_{t},g)=-\dfrac{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s%
_{t+1+\Delta}=g\mid s_{t},a_{t})\cdot\Delta}{\sum_{\Delta=0}\gamma^{\Delta}p_{%
\pi}(s_{t+1+\Delta}=g\mid s_{t},a_{t})}
\displaystyle Q(s_{t},a_{t},g)
\displaystyle=-\dfrac{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g%
\mid s_{t},a_{t})\cdot\Delta}{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+1+%
\Delta}=g\mid s_{t},a_{t})}
Q^{\pi}(s_{t},a_{t},g)
\displaystyle-\dfrac{\gamma p(s_{t+2}=g\mid s_{t},a_{t})+2\gamma^{2}p(s_{t+3}=%
g\mid s_{t},a_{t})+3\gamma^{3}p(s_{t+4}=g\mid s_{t},a_{t})+\cdots}{p(s_{t+1}=g%
\mid s_{t},a_{t})+\gamma p(s_{t+2}=g\mid s_{t},a_{t})+\gamma^{2}p(s_{t+3}=g%
\mid s_{t},a_{t})+\gamma^{3}p(s_{t+4}=g\mid s_{t},a_{t})+\cdots}
\displaystyle-\dfrac{\gamma p(s_{t+2}=g\mid s_{t},a_{t})+2\gamma^{2}p(s_{t+3}=%
g\mid s_{t},a_{t})+3\gamma^{3}p(s_{t+4}=g\mid s_{t},a_{t})+\cdots}{p(s_{t+1}=g%
\mid s_{t},a_{t})+\gamma p(s_{t+2}=g\mid s_{t},a_{t})+\gamma^{2}p(s_{t+3}=g%
\mid s_{t},a_{t})+\gamma^{3}p(s_{t+4}=g\mid s_{t},a_{t})+\cdots}
V(s_{t},g)
\displaystyle V(s_{t},g)=-\dfrac{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+1+%
\Delta}=g\mid s_{t})\cdot\Delta}{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+1+%
\Delta}=g\mid s_{t})}
\displaystyle V(s_{t},g)
\displaystyle=-\dfrac{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g%
\mid s_{t})\cdot\Delta}{\sum_{\Delta=0}\gamma^{\Delta}p_{\pi}(s_{t+1+\Delta}=g%
\mid s_{t})}
\displaystyle-\dfrac{\gamma p(s_{t+2}=g\mid s_{t})+2\gamma^{2}p(s_{t+3}=g\mid s%
_{t})+3\gamma^{3}p(s_{t+4}=g\mid s_{t})+\cdots}{p(s_{t+1}=g\mid s_{t})+\gamma p%
(s_{t+2}=g\mid s_{t})+\gamma^{2}p(s_{t+3}=g\mid s_{t})+\gamma^{3}p(s_{t+4}=g%
\mid s_{t})+\cdots}
\displaystyle-\dfrac{\gamma p(s_{t+2}=g\mid s_{t})+2\gamma^{2}p(s_{t+3}=g\mid s%
_{t})+3\gamma^{3}p(s_{t+4}=g\mid s_{t})+\cdots}{p(s_{t+1}=g\mid s_{t})+\gamma p%
(s_{t+2}=g\mid s_{t})+\gamma^{2}p(s_{t+3}=g\mid s_{t})+\gamma^{3}p(s_{t+4}=g%
\mid s_{t})+\cdots}
\mathbb{E}_{\pi(a\mid s_{t},g)}[Q(s_{t},a,g)]
\displaystyle-\mathbb{E}_{\pi(a\mid s_{t},g)}\bigg{[}\dfrac{\gamma p(s_{t+2}=g%
\mid s_{t},a)+2\gamma^{2}p(s_{t+3}=g\mid s_{t},a)+3\gamma^{3}p(s_{t+4}=g\mid s%
_{t},a)+\cdots}{p(s_{t+1}=g\mid s_{t},a)+\gamma p(s_{t+2}=g\mid s_{t},a)+%
\gamma^{2}p(s_{t+3}=g\mid s_{t},a)+\gamma^{3}p(s_{t+4}=g\mid s_{t},a)+\cdots}%
\bigg{]}
\displaystyle-\mathbb{E}_{\pi(a\mid s_{t},g)}\bigg{[}\dfrac{\gamma p(s_{t+2}=g%
\mid s_{t},a)+2\gamma^{2}p(s_{t+3}=g\mid s_{t},a)+3\gamma^{3}p(s_{t+4}=g\mid s%
_{t},a)+\cdots}{p(s_{t+1}=g\mid s_{t},a)+\gamma p(s_{t+2}=g\mid s_{t},a)+%
\gamma^{2}p(s_{t+3}=g\mid s_{t},a)+\gamma^{3}p(s_{t+4}=g\mid s_{t},a)+\cdots}%
\bigg{]}
\displaystyle p(s_{t+1+\Delta}=g\mid s_{t})=\mathbb{E}_{\pi(a\mid s_{t},g)}[p(%
s_{t+1+\Delta}=g\mid s_{t},a_{t})]
\displaystyle p(s_{t+1+\Delta}=g\mid s_{t})=\mathbb{E}_{\pi(a\mid s_{t},g)}[p(%
s_{t+1+\Delta}=g\mid s_{t},a_{t})]
V(s_{t},g)=\mathbb{E}_{\pi(a\mid s_{t},g)}[Q(s_{t},a,g)]
1/\mathbb{E}_{\pi(a\mid s_{t},g)}[\alpha_{t}^{(0)}]=\mathbb{E}_{\pi(a\mid s_{t%
})}[1/\alpha_{t}^{(0)}]
\displaystyle\mathbb{E}_{\pi(a\mid s_{t},g)}\bigg{[}\dfrac{1}{\sum_{\Delta=0}%
\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t},a)}\bigg{]}=\dfrac{1}{\sum_{\Delta%
=0}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t})}
\displaystyle\mathbb{E}_{\pi(a\mid s_{t},g)}\bigg{[}\dfrac{1}{\sum_{\Delta=0}%
\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t},a)}\bigg{]}=\dfrac{1}{\sum_{\Delta%
=0}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t})}
V^{\pi}(s_{t+1},g)
\displaystyle-\dfrac{\gamma p(s_{t+3}=g\mid s_{t+1})+2\gamma^{2}p(s_{t+4}=g%
\mid s_{t+1})+3\gamma^{3}p(s_{t+5}=g\mid s_{t+1})+\cdots}{p(s_{t+2}=g\mid s_{t%
+1})+\gamma p(s_{t+3}=g\mid s_{t+1})+\gamma^{2}p(s_{t+4}=g\mid s_{t+1})+\gamma%
^{3}p(s_{t+5}=g\mid s_{t+1})+\cdots}
\displaystyle-\dfrac{\gamma p(s_{t+3}=g\mid s_{t+1})+2\gamma^{2}p(s_{t+4}=g%
\mid s_{t+1})+3\gamma^{3}p(s_{t+5}=g\mid s_{t+1})+\cdots}{p(s_{t+2}=g\mid s_{t%
+1})+\gamma p(s_{t+3}=g\mid s_{t+1})+\gamma^{2}p(s_{t+4}=g\mid s_{t+1})+\gamma%
^{3}p(s_{t+5}=g\mid s_{t+1})+\cdots}
-1+V^{\pi}(s_{t+1},g)
\displaystyle-\dfrac{p(s_{t+2}=g\mid s_{t+1})+2\gamma p(s_{t+3}=g\mid s_{t+1})%
+3\gamma^{2}p(s_{t+4}=g\mid s_{t+1})+4\gamma^{3}p(s_{t+5}=g\mid s_{t+1})\cdots%
}{p(s_{t+2}=g\mid s_{t+1})+\gamma p(s_{t+3}=g\mid s_{t+1})+\gamma^{2}p(s_{t+4}%
=g\mid s_{t+1})+\gamma^{3}p(s_{t+5}=g\mid s_{t+1})+\cdots}
\displaystyle-\dfrac{p(s_{t+2}=g\mid s_{t+1})+2\gamma p(s_{t+3}=g\mid s_{t+1})%
+3\gamma^{2}p(s_{t+4}=g\mid s_{t+1})+4\gamma^{3}p(s_{t+5}=g\mid s_{t+1})\cdots%
}{p(s_{t+2}=g\mid s_{t+1})+\gamma p(s_{t+3}=g\mid s_{t+1})+\gamma^{2}p(s_{t+4}%
=g\mid s_{t+1})+\gamma^{3}p(s_{t+5}=g\mid s_{t+1})+\cdots}
\gamma
\displaystyle-\dfrac{\gamma p(s_{t+2}=g\mid s_{t+1})+2\gamma^{2}p(s_{t+3}=g%
\mid s_{t+1})+3\gamma^{3}p(s_{t+4}=g\mid s_{t+1})+\cdots}{\gamma p(s_{t+2}=g%
\mid s_{t+1})+\gamma^{2}p(s_{t+3}=g\mid s_{t+1})+\gamma^{3}p(s_{t+4}=g\mid s_{%
t+1})+\cdots}
\displaystyle-\dfrac{\gamma p(s_{t+2}=g\mid s_{t+1})+2\gamma^{2}p(s_{t+3}=g%
\mid s_{t+1})+3\gamma^{3}p(s_{t+4}=g\mid s_{t+1})+\cdots}{\gamma p(s_{t+2}=g%
\mid s_{t+1})+\gamma^{2}p(s_{t+3}=g\mid s_{t+1})+\gamma^{3}p(s_{t+4}=g\mid s_{%
t+1})+\cdots}
\Delta>0
\displaystyle p(s_{t+1+\Delta}=g\mid s_{t},a_{t})=\mathbb{E}_{p(s_{t+1}\mid s_%
{t},a_{t})}[p(s_{t+1+\Delta}=g\mid s_{t+1})]
\displaystyle p(s_{t+1+\Delta}=g\mid s_{t},a_{t})=\mathbb{E}_{p(s_{t+1}\mid s_%
{t},a_{t})}[p(s_{t+1+\Delta}=g\mid s_{t+1})]
\displaystyle\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}[-1+V^{\pi}(s_{t+1},g)]=-Z%
[\gamma p(s_{t+2}=g\mid s_{t},a_{t})+2\gamma^{2}p(s_{t+3}=g\mid s_{t},a_{t})+3%
\gamma^{3}p(s_{t+4}=g\mid s_{t},a_{t})+\cdots]
\displaystyle\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}[-1+V^{\pi}(s_{t+1},g)]
\displaystyle=-Z[\gamma p(s_{t+2}=g\mid s_{t},a_{t})+2\gamma^{2}p(s_{t+3}=g%
\mid s_{t},a_{t})+3\gamma^{3}p(s_{t+4}=g\mid s_{t},a_{t})+\cdots]
\displaystyle Z=\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}\bigg{[}\dfrac{1}{\sum_%
{\Delta=1}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t+1})}\bigg{]}
\displaystyle Z
\displaystyle=\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}\bigg{[}\dfrac{1}{\sum_{%
\Delta=1}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t+1})}\bigg{]}
\displaystyle\dfrac{Q^{\pi}(s_{t},a_{t},g)}{\mathbb{E}_{p(s_{t+1}\mid s_{t},a_%
{t})}[-1+V^{\pi}(s_{t+1},g)]}=\dfrac{\dfrac{1}{\mathbb{E}_{p(s_{t+1}\mid s_{t}%
,a_{t})}\bigg{[}\dfrac{1}{\gamma p(s_{t+2}=g\mid s_{t+1})+\gamma^{2}p(s_{t+3}=%
g\mid s_{t+1})+\cdots}\bigg{]}}}{p(s_{t+1}=g\mid s_{t},a_{t})+\gamma p(s_{t+2}%
=g\mid s_{t},a_{t})+\gamma^{2}p(s_{t+3}=g\mid s_{t},a_{t})+\cdots}
\displaystyle\dfrac{Q^{\pi}(s_{t},a_{t},g)}{\mathbb{E}_{p(s_{t+1}\mid s_{t},a_%
{t})}[-1+V^{\pi}(s_{t+1},g)]}=\dfrac{\dfrac{1}{\mathbb{E}_{p(s_{t+1}\mid s_{t}%
,a_{t})}\bigg{[}\dfrac{1}{\gamma p(s_{t+2}=g\mid s_{t+1})+\gamma^{2}p(s_{t+3}=%
g\mid s_{t+1})+\cdots}\bigg{]}}}{p(s_{t+1}=g\mid s_{t},a_{t})+\gamma p(s_{t+2}%
=g\mid s_{t},a_{t})+\gamma^{2}p(s_{t+3}=g\mid s_{t},a_{t})+\cdots}
1/\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}[\alpha_{t+1}^{(1)}]=\mathbb{E}_{p(s_%
{t+1}\mid s_{t},a_{t})}[1/\alpha_{t}^{(1)}]
\displaystyle\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}\bigg{[}\dfrac{1}{\sum_{%
\Delta=1}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t+1})}\bigg{]}=\dfrac{1}{%
\sum_{\Delta=1}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t},a_{t})}
\displaystyle\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}\bigg{[}\dfrac{1}{\sum_{%
\Delta=1}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t+1})}\bigg{]}=\dfrac{1}{%
\sum_{\Delta=1}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t},a_{t})}
\displaystyle\dfrac{Q^{\pi}(s_{t},a_{t},g)}{\mathbb{E}_{p(s_{t+1}\mid s_{t},a_%
{t})}[-1+V^{\pi}(s_{t+1},g)]}=\dfrac{\gamma p(s_{t+2}=g\mid s_{t},a_{t})+%
\gamma^{2}p(s_{t+3}=g\mid s_{t},a_{t})+\cdots}{p(s_{t+1}=g\mid s_{t},a_{t})+%
\gamma p(s_{t+2}=g\mid s_{t},a_{t})+\gamma^{2}p(s_{t+3}=g\mid s_{t},a_{t})+\cdots}
\displaystyle\dfrac{Q^{\pi}(s_{t},a_{t},g)}{\mathbb{E}_{p(s_{t+1}\mid s_{t},a_%
{t})}[-1+V^{\pi}(s_{t+1},g)]}
\displaystyle=\dfrac{\gamma p(s_{t+2}=g\mid s_{t},a_{t})+\gamma^{2}p(s_{t+3}=g%
\mid s_{t},a_{t})+\cdots}{p(s_{t+1}=g\mid s_{t},a_{t})+\gamma p(s_{t+2}=g\mid s%
_{t},a_{t})+\gamma^{2}p(s_{t+3}=g\mid s_{t},a_{t})+\cdots}
\displaystyle=\bigg{(}1-\dfrac{p(s_{t+1}=g\mid s_{t},a_{t})}{p(s_{t+1}=g\mid s%
_{t},a_{t})+\sum_{\Delta=1}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t},a_{t})}%
\bigg{)}
\displaystyle=\bigg{(}1-\dfrac{p(s_{t+1}=g\mid s_{t},a_{t})}{p(s_{t+1}=g\mid s%
_{t},a_{t})+\sum_{\Delta=1}\gamma^{\Delta}p(s_{t+1+\Delta}=g\mid s_{t},a_{t})}%
\bigg{)}
\displaystyle=\bigg{(}1-\dfrac{\beta_{t}}{\beta_{t}+\alpha_{t}^{(1)}}\bigg{)}
\displaystyle=\bigg{(}1-\dfrac{\beta_{t}}{\beta_{t}+\alpha_{t}^{(1)}}\bigg{)}
\displaystyle Q^{\pi}(s_{t},a_{t},g)=\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}%
\bigg{[}\Big{(}1-\dfrac{\beta_{t}}{\beta_{t}+\alpha_{t}^{(1)}}\Big{)}\Big{(}-1%
+\mathbb{E}_{\pi(s_{t+1},g)}[Q^{\pi}(s_{t+1},\cdot,g)]\Big{)}\bigg{]}
\displaystyle Q^{\pi}(s_{t},a_{t},g)
\displaystyle=\mathbb{E}_{p(s_{t+1}\mid s_{t},a_{t})}\bigg{[}\Big{(}1-\dfrac{%
\beta_{t}}{\beta_{t}+\alpha_{t}^{(1)}}\Big{)}\Big{(}-1+\mathbb{E}_{\pi(s_{t+1}%
,g)}[Q^{\pi}(s_{t+1},\cdot,g)]\Big{)}\bigg{]}
Q
\{-1,0\}
\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)\\
p(s^{\prime}\mid s,a)\\
p^{+}_{\mu}(s^{+}\mid s,a)\end{subarray}}[f^{*}(-(Q-\gamma\mathcal{P}^{\pi}Q)(%
s,a,s^{+}))-\beta Q(s,a,s^{\prime})]
\beta=(1-\gamma)
f^{*}
f^{*}(x)=(x-1)^{2}/2+3/2
p^{+}_{\mu}(s^{+}\mid s,a)
\displaystyle p^{+}_{\mu}(s^{+}\mid s,a)=(1-\gamma)p(s^{+}\mid s,a)+\gamma\int%
_{S\times A}p(s^{\prime}\mid s,a)\mu(a^{\prime}\mid s^{\prime})p^{+}_{\mu}(s^{%
+}\mid s^{\prime},a^{\prime})\mathrm{d}s^{\prime}\mathrm{d}a^{\prime}
\displaystyle p^{+}_{\mu}(s^{+}\mid s,a)
\displaystyle=(1-\gamma)p(s^{+}\mid s,a)+\gamma\int_{S\times A}p(s^{\prime}%
\mid s,a)\mu(a^{\prime}\mid s^{\prime})p^{+}_{\mu}(s^{+}\mid s^{\prime},a^{%
\prime})\mathrm{d}s^{\prime}\mathrm{d}a^{\prime}
f^{*}
\overline{c}
\displaystyle f^{*}(x)=(x-1)^{2}/2+\overline{c}
\displaystyle f^{*}(x)
\displaystyle=(x-1)^{2}/2+\overline{c}
f^{*}
\displaystyle\operatorname*{arg\,min}_{Q}\mathbb{E}_{\begin{subarray}{c}\rho_{%
\mu}(s,a)p(s^{\prime}\mid s,a)\end{subarray}}(1-\gamma)\cdot\Big{[}\dfrac{1}{2%
}\Big{(}-1+(\gamma\mathcal{P}^{\pi}Q-Q_{\theta})(s,a,s^{\prime})\Big{)}^{2}-%
\cdot Q_{\theta}(s,a,s^{\prime})\Big{]}
\displaystyle\operatorname*{arg\,min}_{Q}
\displaystyle\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)p(s^{\prime}\mid s,%
a)\end{subarray}}(1-\gamma)\cdot\Big{[}\dfrac{1}{2}\Big{(}-1+(\gamma\mathcal{P%
}^{\pi}Q-Q_{\theta})(s,a,s^{\prime})\Big{)}^{2}-\cdot Q_{\theta}(s,a,s^{\prime%
})\Big{]}
\displaystyle+\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)p(s^{\prime}\mid s%
,a)\mu(a^{\prime}\mid s^{\prime})p_{\mu}^{+}(s^{+}\mid s^{\prime},a^{\prime})%
\end{subarray}}\Big{[}\gamma\cdot\dfrac{1}{2}\Big{(}-1+(\gamma\mathcal{P}^{\pi%
}Q-Q_{\theta})(s,a,s^{+})\Big{)}^{2}\Big{]}
\displaystyle+\mathbb{E}_{\begin{subarray}{c}\rho_{\mu}(s,a)p(s^{\prime}\mid s%
,a)\mu(a^{\prime}\mid s^{\prime})p_{\mu}^{+}(s^{+}\mid s^{\prime},a^{\prime})%
\end{subarray}}\Big{[}\gamma\cdot\dfrac{1}{2}\Big{(}-1+(\gamma\mathcal{P}^{\pi%
}Q-Q_{\theta})(s,a,s^{+})\Big{)}^{2}\Big{]}
\mathcal{P}^{\pi}Q
Q
\displaystyle\operatorname*{arg\,min}_{Q}\mathbb{E}_{\begin{subarray}{c}\rho_{%
\mu}(s,a)p(s^{\prime}\mid s,a)p_{\mu}^{+}(s^{+}\mid s,a)\end{subarray}}\Big{[}%
\dfrac{1}{2}\Big{(}r(s,a,s^{\prime},s^{+})+(\gamma\mathcal{P}^{\pi}Q-Q_{\theta%
})(s,a,s^{+})\Big{)}^{2}\Big{]}
\displaystyle\operatorname*{arg\,min}_{Q}\mathbb{E}_{\begin{subarray}{c}\rho_{%
\mu}(s,a)p(s^{\prime}\mid s,a)p_{\mu}^{+}(s^{+}\mid s,a)\end{subarray}}\Big{[}%
\dfrac{1}{2}\Big{(}r(s,a,s^{\prime},s^{+})+(\gamma\mathcal{P}^{\pi}Q-Q_{\theta%
})(s,a,s^{+})\Big{)}^{2}\Big{]}
r(s,a,s^{\prime},s^{+})
\displaystyle\begin{cases}0&s^{\prime}=s^{+}\\
-1&s^{\prime}\neq s^{+}\end{cases}
\displaystyle\begin{cases}0&s^{\prime}=s^{+}\\
-1&s^{\prime}\neq s^{+}\end{cases}
3/2
f^{*}
((f^{*})^{*})(1)=0
f
[0.08,0.08,0.05,0.05,0.1]
\gamma_{\text{HDM}}
0.85
0.5
0.4
\tau
\gamma
L2
\gamma
\gamma_{\text{hdm}}
\gamma_{\text{hdm}}
\gamma_{\text{hdm}}
-\log\gamma_{\text{hdm}}
\gamma_{\text{hdm}}
Q
\gamma_{\text{hdm}}
\gamma_{\text{hdm}}
\gamma_{\text{hdm}}
-\log\gamma_{\text{hdm}}
\gamma_{\text{hdm}}
Q
\pi
s_{0}
s_{T}
\pi
\mathbb{E}_{s_{0}\cdots s_{T}\sim\pi}[-r_{\text{HER}}(\cdot,\cdot,s_{0},s_{T})]
\pi_{0}
\mathbb{E}_{s_{0}\cdots s_{T}\sim\pi_{0}}[-r_{\text{HER}}(\cdot,\cdot,s_{0},s_%
{T})]
\rho^{0}(s)
ag
\{-1,0\}
1
1
20
12
\{-1,0\}
1
1
\{0,1\}
\{-1,0\}
1
1
\{0,1\}
\{-1,0\}
