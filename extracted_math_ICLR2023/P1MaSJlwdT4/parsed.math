\mathcal{M}=\langle\mathcal{S},\mathcal{A},T,\gamma,R\rangle
\mathcal{S}
\mathcal{A}
T
\gamma
R
\mathcal{M}^{\prime}=\langle\mathcal{S},\mathcal{A},T,\gamma,R^{\prime}\rangle
R
\mathcal{M}^{\prime}
\mathcal{M}
\pi_{M^{\prime}}^{*}
\mathcal{M}^{\prime}
E_{a\sim\pi_{M^{\prime}}^{*}}\left[\sum_{t=0}^{\infty}\gamma^{t}R^{in}(s^{t},a%
^{t})\right]
E_{a\sim\pi_{M^{\prime}}^{*}}\left[\sum_{t=0}^{\infty}\gamma^{t}R^{ex}(s^{t},a%
^{t})\right]
\mathcal{M}
R^{ex}
R^{ex}
n
\boldsymbol{\rho}:S\times A\rightarrow\mathbb{R}^{n}
\boldsymbol{\rho}
R^{in}_{\phi}=\boldsymbol{w}_{\phi}\cdot\boldsymbol{\rho}
\boldsymbol{w}_{\phi}
\phi
\boldsymbol{w}_{\phi}
\pi_{\theta}
\phi
\pi_{\theta}=\arg\max_{\pi_{\theta}^{\prime}}J_{\text{inner }}(\pi_{\theta}^{%
\prime},\phi),\quad\text{where}
J_{\text{inner}}(\pi_{\theta},\phi)=E_{a\sim\pi_{\theta}}\left[\sum_{t=0}^{%
\infty}\gamma^{t}R^{in}(s,a|\boldsymbol{\rho}^{t},\phi)\right]
R^{in}(s^{t},a^{t}|\boldsymbol{\rho}^{t},\phi)=\boldsymbol{w}_{\phi}\cdot%
\boldsymbol{\rho}(s^{t},a^{t})
\phi
\pi_{\theta}
\phi=\arg\max_{\phi^{\prime}}J_{\text{outer}}(\phi^{\prime},\pi_{\theta}),%
\quad\text{where}
J_{\text{outer}}\left(\phi,\pi_{\theta}\right)=E_{a\sim\pi_{\theta}}^{\phi}%
\left[\sum_{t=0}^{\infty}\gamma^{t}R^{ex}(s^{t},a^{t})\right]
J_{\text{inner}}
J_{\text{outer}}
r^{ex}
\rho
\pi_{\theta}
w_{\phi}
w_{\phi}
\mathcal{D}
\mathcal{D^{\prime}}
w_{\phi}
a\sim\pi_{\theta}\left(a|s\right)
a
(s,a,s^{\prime},\rho)
\mathcal{D}
(s,a,r^{ex},s^{\prime},\rho)
\mathcal{D^{\prime}}
\mathcal{T}
\mathcal{D}
R^{in}
w_{\phi}
\pi_{\theta}
\mathcal{T}
\mathcal{T^{\prime}}
\mathcal{D^{\prime}}
(s,a)\sim\mathcal{T^{\prime}}
w_{\phi}
\mathcal{T^{\prime}}
\pi_{\theta}
R^{in}
\pi_{\theta}
w_{\phi}
\phi
R^{ex}
\phi
\pi_{\theta}
\phi
J_{\text{outer}}
\pi_{\theta}
\phi
J_{\text{outer}}
R^{ex}
R^{in}
z
z
\mathcal{Z}
z_{\text{ex}}
z_{\text{in}}
z_{\text{in}}
z_{\text{ex}}
\theta
\theta
\displaystyle\operatorname{J_{virtual}^{ex}}(\theta)=E_{a\sim\pi_{\theta}}^{%
\phi}\left[\sum_{t=0}^{\infty}\gamma^{t}R^{ex}(s^{t},a^{t})\right]
\displaystyle\operatorname{J_{virtual}^{ex}}(\theta)
\displaystyle=E_{a\sim\pi_{\theta}}^{\phi}\left[\sum_{t=0}^{\infty}\gamma^{t}R%
^{ex}(s^{t},a^{t})\right]
\displaystyle\operatorname{J_{virtual}^{in}}(\theta)=E_{a\sim\pi_{\theta}}%
\left[\sum_{t=0}^{\infty}\gamma^{t}R^{in}(s^{t},a^{t}|\boldsymbol{\rho}^{t},%
\phi)\right].
\displaystyle\operatorname{J_{virtual}^{in}}(\theta)
\displaystyle=E_{a\sim\pi_{\theta}}\left[\sum_{t=0}^{\infty}\gamma^{t}R^{in}(s%
^{t},a^{t}|\boldsymbol{\rho}^{t},\phi)\right].
R^{ex}
R^{in}
\phi
R^{ex}
R^{in}
\displaystyle\nabla_{\theta}\operatorname{J_{virtual}^{ex}}(\theta)=E_{\pi_{%
\theta}}\left[\nabla_{\theta}\log\pi_{\theta}(s,a)G^{ex}\right]
\displaystyle\nabla_{\theta}\operatorname{J_{virtual}^{ex}}(\theta)
\displaystyle=E_{\pi_{\theta}}\left[\nabla_{\theta}\log\pi_{\theta}(s,a)G^{ex}\right]
\displaystyle\nabla_{\theta}\operatorname{J_{virtual}^{in}}(\theta)=E_{\pi_{%
\theta}}\left[\nabla_{\theta}\log\pi_{\theta}(s,a)G^{in}_{\phi}\right]
\displaystyle\nabla_{\theta}\operatorname{J_{virtual}^{in}}(\theta)
\displaystyle=E_{\pi_{\theta}}\left[\nabla_{\theta}\log\pi_{\theta}(s,a)G^{in}%
_{\phi}\right]
G^{ex}
G^{in}
\boldsymbol{z}_{ex}:=\nabla_{\theta}\operatorname{J_{virtual}^{ex}}(\theta)~{}%
,\quad\boldsymbol{z}_{in}:=\nabla_{\theta}\operatorname{J_{virtual}^{in}}(%
\theta).
\zeta
\boldsymbol{z}_{ex}
\boldsymbol{z}_{in}
\boldsymbol{z}_{in}
\boldsymbol{z}_{ex}
\zeta
\cos{\zeta}
\cos\zeta
\cos{\zeta}
\displaystyle\mathop{\arg\min}_{\phi}\zeta=\mathop{\arg\max}_{\phi}\cos{\zeta}
\displaystyle\mathop{\arg\min}_{\phi}\zeta
\displaystyle=\mathop{\arg\max}_{\phi}\cos{\zeta}
\displaystyle=\mathop{\arg\max}_{\phi}\frac{\boldsymbol{z}_{ex}\cdot%
\boldsymbol{z}_{in}}{||\boldsymbol{z}_{ex}||\ ||\boldsymbol{z}_{in}||}
\displaystyle=\mathop{\arg\max}_{\phi}\frac{\boldsymbol{z}_{ex}\cdot%
\boldsymbol{z}_{in}}{||\boldsymbol{z}_{ex}||\ ||\boldsymbol{z}_{in}||}
\displaystyle=\mathop{\arg\max}_{\phi}\frac{\boldsymbol{z}_{ex}\cdot%
\boldsymbol{z}_{in}}{||\boldsymbol{z}_{in}||}.
\displaystyle=\mathop{\arg\max}_{\phi}\frac{\boldsymbol{z}_{ex}\cdot%
\boldsymbol{z}_{in}}{||\boldsymbol{z}_{in}||}.
(\boldsymbol{z}_{ex}\cdot\boldsymbol{z}_{in}-\beta||\boldsymbol{z}_{in}||)
\boldsymbol{z}_{ex}\cdot\boldsymbol{z}_{in}-\beta||\boldsymbol{z}_{in}||%
\propto\frac{\boldsymbol{z}_{ex}\cdot\boldsymbol{z}_{in}}{||\boldsymbol{z}_{in%
}||}\propto\cos{\zeta}\propto\zeta
\beta
J_{\text{outer}}(\phi,\pi_{\theta})
\nabla_{\phi}J_{\text{outer}}(\phi,\pi_{\theta})
\phi
\phi
\pi_{\theta}
\phi
J_{\text{outer}}
\displaystyle J_{\text{o}}(\phi)=\boldsymbol{z}_{ex}\cdot\boldsymbol{z}_{in}-%
\beta||\boldsymbol{z}_{in}||
\displaystyle J_{\text{o}}(\phi)
\displaystyle=\boldsymbol{z}_{ex}\cdot\boldsymbol{z}_{in}-\beta||\boldsymbol{z%
}_{in}||
\displaystyle=\nabla_{\theta}\operatorname{J_{virtual}^{ex}}\cdot\nabla_{%
\theta}\operatorname{J_{virtual}^{in}}-\beta||\boldsymbol{z}_{in}||
\displaystyle=\nabla_{\theta}\operatorname{J_{virtual}^{ex}}\cdot\nabla_{%
\theta}\operatorname{J_{virtual}^{in}}-\beta||\boldsymbol{z}_{in}||
\nabla_{\theta}\operatorname{J_{virtual}^{ex}}
\nabla_{\theta}\operatorname{J_{virtual}^{in}}
J_{\text{o}}
J_{\text{o}}(\phi)
\nabla_{\phi}J_{\text{o}}=\nabla_{\theta}\operatorname{J_{virtual}^{ex}}\cdot%
\nabla_{\phi}\nabla_{\theta}\operatorname{J_{virtual}^{in}}-\beta\nabla_{\phi}%
||\boldsymbol{z}_{in}||,
\displaystyle\nabla_{\phi}\nabla_{\theta}\operatorname{J_{virtual}^{in}}=\sum_%
{(s,a)\sim\mathcal{T^{\prime}}}\nabla_{\theta}\log\pi_{\theta}(s,a)\nabla_{%
\phi}G^{in}_{\phi}
\displaystyle\nabla_{\phi}\nabla_{\theta}\operatorname{J_{virtual}^{in}}=
\displaystyle\sum_{(s,a)\sim\mathcal{T^{\prime}}}\nabla_{\theta}\log\pi_{%
\theta}(s,a)\nabla_{\phi}G^{in}_{\phi}
\displaystyle=\sum_{(s,a)\sim\mathcal{T^{\prime}}}\nabla_{\theta}\log\pi_{%
\theta}(s,a)
\displaystyle=
\displaystyle\sum_{(s,a)\sim\mathcal{T^{\prime}}}\nabla_{\theta}\log\pi_{%
\theta}(s,a)
\displaystyle\qquad\cdot\sum_{i=t}^{\infty}\gamma^{i-t}\nabla_{\phi}r_{\phi}^{%
in}\left(s_{i},a_{i}\right)
\displaystyle\qquad\cdot\sum_{i=t}^{\infty}\gamma^{i-t}\nabla_{\phi}r_{\phi}^{%
in}\left(s_{i},a_{i}\right)
\displaystyle=\sum_{(s,a)\sim\mathcal{T^{\prime}}}\nabla_{\theta}\log\pi_{%
\theta}(s,a)
\displaystyle=
\displaystyle\sum_{(s,a)\sim\mathcal{T^{\prime}}}\nabla_{\theta}\log\pi_{%
\theta}(s,a)
\displaystyle\qquad\cdot\sum_{i=t}^{\infty}\gamma^{i-t}\nabla_{\phi}%
\boldsymbol{w}_{\phi}\cdot\boldsymbol{\rho}\left(s_{i},a_{i}\right)
\displaystyle\qquad\cdot\sum_{i=t}^{\infty}\gamma^{i-t}\nabla_{\phi}%
\boldsymbol{w}_{\phi}\cdot\boldsymbol{\rho}\left(s_{i},a_{i}\right)
\phi
J_{\text{o}}(\phi)
\phi
J_{\text{outer}}
\operatorname{J_{virtual}^{ex}}
J_{\text{outer}}
\nabla_{\phi}J_{\text{o}}
\nabla_{\phi}\operatorname{J_{virtual}^{ex}}
\nabla_{\phi}J_{\text{outer}}
\nabla_{\phi}J_{\text{o}}\propto\nabla_{\phi}\operatorname{J_{virtual}^{ex}}=%
\nabla_{\phi}J_{\text{outer}}
\theta
\theta^{\prime}
\displaystyle\theta^{\prime}=\theta+\alpha\nabla_{\theta}\operatorname{J_{%
virtual}^{in}}
\displaystyle\theta^{\prime}
\displaystyle=\theta+\alpha\nabla_{\theta}\operatorname{J_{virtual}^{in}}
\displaystyle=\theta+\alpha\sum_{(s,a)\sim\mathcal{T^{\prime}}}\nabla_{\theta}%
\log\pi_{\theta}(s,a)G^{in}_{\phi}.
\displaystyle=\theta+\alpha\sum_{(s,a)\sim\mathcal{T^{\prime}}}\nabla_{\theta}%
\log\pi_{\theta}(s,a)G^{in}_{\phi}.
\displaystyle\nabla_{\phi}\operatorname{J_{virtual}^{ex}}=\nabla_{\theta^{%
\prime}}\operatorname{J_{virtual}^{ex}}\nabla_{\phi}\theta^{\prime}
\displaystyle\nabla_{\phi}\operatorname{J_{virtual}^{ex}}
\displaystyle=\nabla_{\theta^{\prime}}\operatorname{J_{virtual}^{ex}}\nabla_{%
\phi}\theta^{\prime}
\displaystyle=\nabla_{\theta^{\prime}}\operatorname{J_{virtual}^{ex}}\nabla_{%
\phi}(\theta+\alpha\nabla_{\theta}\operatorname{J_{virtual}^{in}})
\displaystyle=\nabla_{\theta^{\prime}}\operatorname{J_{virtual}^{ex}}\nabla_{%
\phi}(\theta+\alpha\nabla_{\theta}\operatorname{J_{virtual}^{in}})
\displaystyle=\alpha\nabla_{\theta^{\prime}}\operatorname{J_{virtual}^{ex}}%
\nabla_{\phi}\nabla_{\theta}\operatorname{J_{virtual}^{in}}.
\displaystyle=\alpha\nabla_{\theta^{\prime}}\operatorname{J_{virtual}^{ex}}%
\nabla_{\phi}\nabla_{\theta}\operatorname{J_{virtual}^{in}}.
\phi
\phi
J_{\text{o}}
J_{\text{outer}}
J_{inner}
J_{inner}
\times
\rho
r\in
\rho
\rho
\sqrt{1/n}
\gamma
\beta
10^{-2}
10^{-3}
\beta
\beta=
\beta
\beta=
\beta\nabla_{\phi}||\boldsymbol{w}_{\phi}-\boldsymbol{w}_{init}||^{2}
\beta\nabla_{\phi}||z_{in}||
\beta
z_{in}
z_{ex}
z_{in}
z_{ex}
\rho
\rho
\gamma
\beta
10^{-3}
\infty
\infty
(-\infty,0)
[0,0.5)
[0.5,1)
[1,2)
[2,\infty)
[-\infty,-2)
[-2,-1)
[-1,0)
[2,\infty)
[-1,0)
