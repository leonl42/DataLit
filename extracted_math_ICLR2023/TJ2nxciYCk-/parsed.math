k
k
\sim 50
k
k
k
k
k
k
k
f(\boldsymbol{x};\boldsymbol{K},\boldsymbol{V})\doteq\sum_{i=1}^{d_{\text{ff}}%
}\Big{(}\sigma(\langle\boldsymbol{k}_{i},\boldsymbol{x}\rangle)\cdot%
\boldsymbol{v}_{i}\Big{)},~{}~{}\text{or equivalently,}~{}~{}f(\boldsymbol{x};%
\boldsymbol{K},\boldsymbol{V})\doteq\boldsymbol{V}\sigma(\boldsymbol{K}^{\top}%
\boldsymbol{x}),
\boldsymbol{x}\in I\!\!R^{d_{\text{model}}}
\boldsymbol{K}=[\boldsymbol{k}_{1},\ldots,\boldsymbol{k}_{d_{\text{ff}}}]\in I%
\!\!R^{d_{\text{model}}\times d_{\text{ff}}}
\boldsymbol{V}=[\boldsymbol{v}_{1},\ldots,\boldsymbol{v}_{d_{\text{ff}}}]\in I%
\!\!R^{d_{\text{model}}\times d_{\text{ff}}}
\sigma()
\sigma()
47.78\%
47.58\%
d_{\text{ff}}
i
\sigma(\langle\boldsymbol{k}_{i},\boldsymbol{x}\rangle)\cdot\boldsymbol{v}_{i}
\sigma(\langle\boldsymbol{k}_{i},\boldsymbol{x}\rangle)
\boldsymbol{a}\doteq\sigma(\boldsymbol{K}^{\top}\boldsymbol{x}),
d_{\text{ff}}
d_{\text{model}},d_{\text{ff}}
d_{\text{model}}=768
d_{\text{ff}}=3072
12
12
+12
\log
\log
10\times
21\times
d_{\text{ff}}
d_{\text{ff}}
d_{\text{ff}}
d_{\text{ff}}
p\%
p\in\{50\%,70\%,100\%\}
[-1,1]
p\%
p\in\{50\%,70\%,100\%\}
[-1,1]
p\%
p
70\%
100\%
100\%
<10\%
<10\%
f(\boldsymbol{x};\boldsymbol{V},\boldsymbol{\theta}):I\!\!R^{n}\to I\!\!R^{K}
f(\boldsymbol{x})=\boldsymbol{V}\sigma\big{(}\boldsymbol{p}(\boldsymbol{x};%
\boldsymbol{\theta})\big{)},
\boldsymbol{V}=[\boldsymbol{v}_{1},\ldots,\boldsymbol{v}_{d_{\text{ff}}}]\in I%
\!\!R^{K\times d_{\text{ff}}}
\sigma()
\boldsymbol{p}(\boldsymbol{x};\boldsymbol{\theta})
\boldsymbol{\theta}
\boldsymbol{p}=\boldsymbol{p}(\boldsymbol{x};\boldsymbol{\theta})
\ell_{\text{MSE}}(f(\boldsymbol{x}),\boldsymbol{y})\doteq\frac{1}{2}\|f(%
\boldsymbol{x})-\boldsymbol{y}\|_{2}^{2}
\boldsymbol{y}
\boldsymbol{V}
\boldsymbol{V}
\mathbb{E}\left[\boldsymbol{V}\right]=\textbf{0},~{}~{}\text{and}~{}~{}\mathbb%
{E}\left[\langle\boldsymbol{v}_{i},\boldsymbol{v}_{j}\rangle\right]\begin{%
cases}=0,&~{}\text{if}~{}i\neq j,\\
>0,&~{}\text{otherwise}.\end{cases}
\boldsymbol{v}_{i}=\textbf{0}
i^{*}
p_{i^{*}}>0
\mathbb{E}\left[\frac{\partial\ell_{\text{MSE}}(f(\boldsymbol{x}),\boldsymbol{%
y})}{\partial\boldsymbol{p}_{i^{*}}}\right]>0,
\boldsymbol{V}
\ell_{\text{CE}}(f(\boldsymbol{x}),\boldsymbol{y})=-\langle\boldsymbol{y},\log%
\frac{\exp(f(\boldsymbol{x}))}{\langle\exp(f(\boldsymbol{x})),\textbf{1}%
\rangle}\rangle
\boldsymbol{y}
\boldsymbol{V}
\boldsymbol{V}
\boldsymbol{V}
\mathbb{E}\left[\boldsymbol{V}\right]=\textbf{0}
i^{*}
p_{i^{*}}>0
\mathbb{E}\left[\frac{\partial\ell_{\text{CE}}(f(\boldsymbol{x}),\boldsymbol{y%
})}{\partial\boldsymbol{p}_{i^{*}}}\right]>0,
\boldsymbol{V}
p_{i^{*}}
\boldsymbol{V}
\boldsymbol{V}
\boldsymbol{y}
\boldsymbol{V}
k
k
k
k
k
d_{\text{model}}
d_{\text{ff}}
N
\mathcal{O}(Nd_{\text{model}}^{2}+N^{2}d_{\text{model}}+Nd_{\text{model}}d_{%
\text{ff}})
N
d_{\text{ff}}
d_{\text{model}}
\boldsymbol{V}\boldsymbol{a},
\boldsymbol{a}\in I\!\!R^{d_{\text{ff}}}
\boldsymbol{V}\in I\!\!R^{d_{\text{model}}\times d_{\text{ff}}}
2d_{\text{model}}\times d_{\text{ff}}
\boldsymbol{a}
s
2d_{\text{model}}\times s
1-\frac{s}{d_{\text{ff}}}
\frac{s}{d_{\text{ff}}}
2.7\%
1-\frac{s}{d_{\text{ff}}}
\sigma(\boldsymbol{K}^{\top}\boldsymbol{x}),
\boldsymbol{K}=[\boldsymbol{k}_{1},\ldots,\boldsymbol{k}_{d_{\text{ff}}}]\in I%
\!\!R^{d_{\text{model}}\times d_{\text{ff}}}
\boldsymbol{x}
k
k
\{\boldsymbol{k}_{i}\}_{i=1}^{d_{\text{ff}}}
\boldsymbol{x}
d_{\text{ff}}
d_{\text{ff}}
k
k
k
\sigma()
k
k
f(\boldsymbol{x};\boldsymbol{K},\boldsymbol{V})=\boldsymbol{V}\cdot\text{Top}_%
{k}\Big{(}\sigma(\boldsymbol{K}^{T}\boldsymbol{x})\Big{)},
\text{Top}_{k}(\cdot)
k
k
k
k=d_{\text{ff}}
k
k
k
k
k
k
k=128
k=256
0.3\%
k
k
k
k
k
k=128
k=256
0.3\%
k
k
k
k
k
k
k
k
k
k
k
k
k
d_{\text{ff}}
10\%
k\leq 128
k=256
k
k
k
k
k
p\%
p=80\%
p\in\{40\%,80\%\}
k
k
k
k
k
k=128
k
k
k
k
k
k
k
k
k
k=64
k=128
k
k
k
\beta_{1}=0.9,\beta_{2}=0.999
d_{\text{model}}
d_{\text{ff}}
d_{\text{model}}
d_{\text{ff}}
d_{\text{model}}
d_{\text{ff}}
1e-4
\in\{64,128,256\}
\in\{64,128,256\}
7\textsuperscript{th}
7\textsuperscript{th}
\beta_{1}=0.9,\beta_{2}=0.999
1
2
4
7\textsuperscript{th}
\beta_{1}=0.9,\beta_{2}=0.999
3e-3
\{1e-4,3e-4,1e-3,3e-3,1e-2\}
3e-3
k
k
k
k
k
k\in\{64,128,256\}
k
k
k=256
k
\ell_{1}
k
\ell_{1}
\lambda
\ell_{1}
\lambda\in\{0.001,0.01,0.1,1.0\}
\{0.001,0.01,0.1,1.0\}
\lambda
\lambda=0.001,0.01
\lambda=0.1
\lambda=1.0
\ell_{1}
\ell_{2}
\ell_{2}
\ell_{1}
\ell_{2}
\ell_{2}
\ell_{1}
\ell_{2}
\ell_{1}
\in\{0.001,0.01,0.1,1.0\}
\ell_{1}
\in\{0.001,0.01,0.1,1.0\}
\ell_{1}
\ell_{1}
\ell_{2}
\in\{0.001,0.01,0.1,1.0\}
\ell_{1}
\ell_{2}
\in\{0.001,0.01,0.1,1.0\}
\ell(f(\boldsymbol{x}),\boldsymbol{y})
\frac{\partial\ell}{\partial p_{i^{*}}}=\left\langle\frac{\partial\ell}{%
\partial f},\frac{\partial f}{\partial p_{i^{*}}}\right\rangle=\left\langle%
\frac{\partial\ell}{\partial f},\boldsymbol{v}_{i^{*}}\right\rangle.
\ell=\ell_{MSE}
\frac{\partial\ell_{MSE}}{\partial f}=f(\boldsymbol{x})-\boldsymbol{y}=\sum_{i%
}\sigma(p_{i})\cdot\boldsymbol{v}_{i}-\boldsymbol{y}.
\begin{split}\frac{\partial\ell_{MSE}}{\partial p_{i^{*}}}&=\left(\sum_{i}%
\sigma(p_{i})\langle\boldsymbol{v}_{i},\boldsymbol{v}_{i^{*}}\rangle\right)-%
\langle\boldsymbol{v}_{i^{*}},\boldsymbol{y}\rangle\\
&=\left(\sum_{i\neq i^{*}}\sigma(p_{i})\langle\boldsymbol{v}_{i},\boldsymbol{v%
}_{i^{*}}\rangle\right)+\sigma(p_{i^{*}})\langle\boldsymbol{v}_{i^{*}},%
\boldsymbol{v}_{i^{*}}\rangle-\langle\boldsymbol{v}_{i^{*}},\boldsymbol{y}%
\rangle\end{split}
\mathbb{E}\left[\frac{\partial\ell_{MSE}}{\partial p_{i^{*}}}\right]=0+\sigma(%
p_{i^{*}})\mathbb{E}\left[\langle\boldsymbol{v}_{i^{*}},\boldsymbol{v}_{i^{*}}%
\rangle\right]+0>0.
\ell=\ell_{CE}
\frac{\partial\ell_{CE}}{\partial f}=\frac{\exp(f(\boldsymbol{x}))}{\langle%
\exp(f(\boldsymbol{x})),\textbf{1}\rangle}-\boldsymbol{y}=\frac{\exp(\sum_{i}%
\sigma(p_{i})\cdot\boldsymbol{v}_{i})}{\langle\exp(\sum_{i}\sigma(p_{i})\cdot%
\boldsymbol{v}_{i}),\textbf{1}\rangle}-\boldsymbol{y}.
\begin{split}\frac{\partial\ell_{CE}}{\partial p_{i^{*}}}&=\frac{\langle\exp(%
\sum_{i}\sigma(p_{i})\cdot\boldsymbol{v}_{i}),\boldsymbol{v}_{i^{*}}\rangle}{%
\langle\exp(\sum_{i}\sigma(p_{i})\cdot\boldsymbol{v}_{i}),\textbf{1}\rangle}-%
\langle\boldsymbol{v}_{i^{*}},\boldsymbol{y}\rangle\end{split}
\begin{split}\left\langle\exp\left(\sum_{i}\sigma(p_{i})\cdot\boldsymbol{v}_{i%
}\right),\boldsymbol{v}_{i^{*}}\right\rangle&=\sum_{m}\left(v_{i^{*},m}\cdot%
\exp\left(\sum_{i}\sigma(p_{i})\cdot v_{im}\right)\right)\\
&=\sum_{m}\left(v_{i^{*},m}\cdot\exp\left(p_{i^{*}}\cdot v_{i^{*},m}\right)%
\cdot\exp\left(\sum_{i\neq i^{*}}\sigma(p_{i})\cdot v_{i,m}\right)\right)\end{split}
C_{m}^{(1)}=\exp\left(\sum_{i\neq i^{*}}\sigma(p_{i})\cdot v_{i,m}\right),
\begin{split}\frac{\partial\ell_{CE}}{\partial p_{i^{*}}}&=\sum_{m}\left(\frac%
{v_{i^{*},m}\cdot\exp\left(p_{i^{*}}\cdot v_{i^{*},m}\right)\cdot C_{m}^{(1)}}%
{\langle\exp(\sum_{i}\sigma(p_{i})\cdot\boldsymbol{v}_{i}),\textbf{1}\rangle}%
\right)-\langle\boldsymbol{v}_{i^{*}},\boldsymbol{y}\rangle\end{split}
\begin{split}\left\langle\exp\left(\sum_{i}\sigma(p_{i})\cdot\boldsymbol{v}_{i%
}\right),\textbf{1}\right\rangle&=\sum_{m^{\prime}}\exp\left(\sum_{i}\sigma(p_%
{i})\cdot v_{im^{\prime}}\right)\\
&=\sum_{m^{\prime}}\left(\exp\left(p_{i^{*}}\cdot v_{i^{*},m^{\prime}}\right)%
\cdot\exp\left(\sum_{i\neq i^{*}}\sigma(p_{i})\cdot v_{im^{\prime}}\right)%
\right)\\
&=\exp\left(p_{i^{*}}\cdot v_{i^{*},m}\right)\cdot\exp\left(\sum_{i\neq i^{*}}%
\sigma(p_{i})\cdot v_{i,m}\right)\\
&+\sum_{m^{\prime}\neq m}\left(\exp\left(p_{i^{*}}\cdot v_{i^{*},m^{\prime}}%
\right)\cdot\exp\left(\sum_{i\neq i^{*}}\sigma(p_{i})\cdot v_{im^{\prime}}%
\right)\right)\end{split}
\displaystyle C_{m}^{(2)}=\exp\left(\sum_{i\neq i^{*}}\sigma(p_{i})\cdot v_{i,%
m}\right),
\displaystyle C_{m}^{(3)}=\sum_{m^{\prime}\neq m}\left(\exp\left(p_{i^{*}}%
\cdot v_{i^{*},m^{\prime}}\right)\cdot\exp\left(\sum_{i\neq i^{*}}\sigma(p_{i}%
)\cdot v_{im^{\prime}}\right)\right),
\begin{split}\frac{\partial\ell_{CE}}{\partial p_{i^{*}}}&=\sum_{m}\left(\frac%
{v_{i^{*},m}\cdot\exp\left(p_{i^{*}}\cdot v_{i^{*},m}\right)\cdot C_{m}^{(1)}}%
{\exp\left(p_{i^{*}}\cdot v_{i^{*},m}\right)\cdot C_{m}^{(2)}+C_{m}^{(3)}}%
\right)-\langle\boldsymbol{v}_{i^{*}},\boldsymbol{y}\rangle.\end{split}
\boldsymbol{V}
V
\begin{split}\mathbb{E}\left[\frac{\partial\ell_{CE}}{\partial p_{i^{*}}}%
\right]&=\sum_{m}\mathbb{E}\left[\frac{v_{i^{*},m}\cdot\exp\left(p_{i^{*}}%
\cdot v_{i^{*},m}\right)\cdot C_{m}^{(1)}}{\exp\left(p_{i^{*}}\cdot v_{i^{*},m%
}\right)\cdot C_{m}^{(2)}+C_{m}^{(3)}}\right]-\mathbb{E}\left[\langle%
\boldsymbol{v}_{i^{*}},\boldsymbol{y}\rangle\right]\\
&=\sum_{m}\mathbb{E}_{\{v_{i,l}|(i,l)\neq(i^{*},m)\}}\left[\mathbb{E}_{v_{i^{*%
},m}}\left[\frac{v_{i^{*},m}\cdot\exp\left(p_{i^{*}}\cdot v_{i^{*},m}\right)%
\cdot C_{m}^{(1)}}{\exp\left(p_{i^{*}}\cdot v_{i^{*},m}\right)\cdot C_{m}^{(2)%
}+C_{m}^{(3)}}\right]\right]-\mathbb{E}\left[\langle\boldsymbol{v}_{i^{*}},%
\boldsymbol{y}\rangle\right].\end{split}
\mathbb{E}_{v_{i^{*},m}}\left[\right]
v_{i^{*},m}
\mathbb{E}_{\{v_{i,l}|(i,l)\neq(i^{*},m)\}}\left[\right]
\boldsymbol{V}
C_{m}^{(1)},C_{m}^{(2)}
C_{m}^{(3)}
v_{i^{*},m}
\boldsymbol{V}
\mathbb{E}_{v_{i^{*},m}}\left[\frac{v_{i^{*},m}\cdot\exp\left(p_{i^{*}}\cdot v%
_{i^{*},m}\right)\cdot C_{m}^{(1)}}{\exp\left(p_{i^{*}}\cdot v_{i^{*},m}\right%
)\cdot C_{m}^{(2)}+C_{m}^{(3)}}\right]>0,
\mathbb{E}\left[\langle\boldsymbol{v}_{i^{*}},\boldsymbol{y}\rangle\right]=0.
\mathbb{E}\left[\frac{\partial\ell_{CE}}{\partial p_{i^{*}}}\right]>0.
\mathsf{V}
p(v)
P(\mathsf{V}=0)\neq 1
C_{1},C_{2},C_{3}
p
\mathbb{E}\left[\frac{C_{1}\mathsf{V}\cdot\exp(pv)}{C_{2}\exp(p\mathsf{V})+C_{%
3}}\right]>\frac{C_{1}}{C_{2}+C_{3}}\mathbb{E}\left[\mathsf{V}\right].
p(v)
\begin{split}\mathbb{E}\left[\frac{C_{1}\mathsf{V}\cdot\exp(p\mathsf{V})}{C_{2%
}\exp(p\mathsf{V})+C_{3}}\right]=\mathbb{E}\left[\frac{C_{1}\mathsf{V}}{C_{2}+%
C_{3}\exp(-p\mathsf{V})}\right]=\int_{-\infty}^{\infty}\frac{C_{1}v}{C_{2}+C_{%
3}\exp(-pv)}p(v)dv\doteq\int_{-\infty}^{\infty}g(v)\cdot vp(v)dv.\end{split}
g(v)
v\in I\!\!R
g(v)\geq g(0)
v\geq 0
g(v)\leq g(0)
v\leq 0
\displaystyle\int_{-\infty}^{0}g(v)\cdot vp(v)dv\geq g(0)\int_{-\infty}^{0}vp(%
v)dv,
\displaystyle\int_{0}^{\infty}g(v)\cdot vp(v)dv\geq g(0)\int_{0}^{\infty}vp(v)dv.
P(\mathsf{V}=0)\neq 1
(a,b)
\int_{a}^{b}p(v)dv>0
b>a\geq 0
\int_{a}^{b}g(v)\cdot vp(v)dv>g(0)\int_{a}^{b}vp(v)dv.
\begin{split}\mathbb{E}\left[\frac{C_{1}\mathsf{V}\cdot\exp(p\mathsf{V})}{C_{2%
}\exp(p\mathsf{V})+C_{3}}\right]=\int_{-\infty}^{\infty}g(v)\cdot vp(v)dv>g(0)%
\mathbb{E}\left[\mathsf{V}\right]=\frac{C_{1}}{C_{2}+C_{3}}\mathbb{E}\left[%
\mathsf{V}\right].\end{split}
200
50\%
3\%
\boldsymbol{K},\boldsymbol{V}
