\displaystyle{{\bf A}}_{i}=\textsf{Softmax}({\bf Q}_{i}{\bf K}_{i}^{T}/\sqrt{d%
_{k}}),{\bf Z}_{i}={{\bf A}}_{i}{{\bf V}}_{i}
\displaystyle{{\bf A}}_{i}=
\displaystyle\textsf{Softmax}({\bf Q}_{i}{\bf K}_{i}^{T}/\sqrt{d_{k}}),{\bf Z}%
_{i}={{\bf A}}_{i}{{\bf V}}_{i}
\displaystyle\text{where }{\bf Q}_{i}={\bf Q}{{\bf W}}_{i}^{Q},{\bf K}_{i}={%
\bf K}{{\bf W}}_{i}^{K},{{\bf V}}_{i}={{\bf V}}{{\bf W}}_{i}^{V}
\displaystyle{\bf Q}_{i}={\bf Q}{{\bf W}}_{i}^{Q},{\bf K}_{i}={\bf K}{{\bf W}}%
_{i}^{K},{{\bf V}}_{i}={{\bf V}}{{\bf W}}_{i}^{V}
{\bf Q},{\bf K},{{\bf V}}
d_{k}
{\bf Z}_{i}
i
\{{{\bf W}}_{i}^{Q},{{\bf W}}_{i}^{K},{{\bf W}}_{i}^{V}\}
M
M
\displaystyle\textsf{Multi-head}({\bf Q},{\bf K},{{\bf V}})={\bf Z}{{\bf W}}^{%
O},\text{ with}
\displaystyle\textsf{Multi-head}({\bf Q},{\bf K},{{\bf V}})={\bf Z}{{\bf W}}^{%
O},\text{ with}
\displaystyle{\bf Z}=\textsf{Concat}({\bf Z}_{1},\cdots,{\bf Z}_{M})
\displaystyle{\bf Z}=\textsf{Concat}({\bf Z}_{1},\cdots,{\bf Z}_{M})
p
p
p
p(\bm{\theta}|\mathcal{D})\propto\exp(-U(\bm{\theta}))
\bm{\theta}\in\mathbb{R}^{d}
\mathcal{D}=\{D_{k}\}_{k=1}^{N}
U(\bm{\theta})\triangleq-\log p(\mathcal{D}|\bm{\theta})-\log p_{0}(\bm{\theta%
})=-\sum_{k=1}^{N}\log p(D_{k}|\bm{\theta})-\log p_{0}(\bm{\theta})
p_{0}
\bm{\theta}
\bm{\theta}
{{\bf W}}_{i}^{Q}
\bm{\theta}
M
\{\bm{\theta}^{(i)}\}_{i=1}^{M}
p(\bm{\theta}|\mathcal{D})
i
(\ell+1)
\epsilon_{\ell+1}
\displaystyle\bm{\theta}_{\ell+1}^{(i)}=\bm{\theta}_{\ell}^{(i)}+\epsilon_{%
\ell+1}\phi(\bm{\theta}_{\ell}^{(i)})
\displaystyle\bm{\theta}_{\ell+1}^{(i)}=\bm{\theta}_{\ell}^{(i)}+\epsilon_{%
\ell+1}\phi(\bm{\theta}_{\ell}^{(i)})
\displaystyle\phi(\bm{\theta}_{\ell}^{(i)})=\frac{1}{M}\sum_{j=1}^{M}[-\kappa(%
\bm{\theta}_{\ell}^{(j)},\bm{\theta}_{\ell}^{(i)})\nabla_{\bm{\theta}_{\ell}^{%
(j)}}U(\bm{\theta}_{\ell}^{(j)})
\displaystyle\phi(\bm{\theta}_{\ell}^{(i)})=
\displaystyle\frac{1}{M}\sum_{j=1}^{M}[-\kappa(\bm{\theta}_{\ell}^{(j)},\bm{%
\theta}_{\ell}^{(i)})\nabla_{\bm{\theta}_{\ell}^{(j)}}U(\bm{\theta}_{\ell}^{(j%
)})
\displaystyle+\nabla_{\bm{\theta}_{\ell}^{(j)}}\kappa(\bm{\theta}_{\ell}^{(j)}%
,\bm{\theta}_{\ell}^{(i)})]
\displaystyle+\nabla_{\bm{\theta}_{\ell}^{(j)}}\kappa(\bm{\theta}_{\ell}^{(j)}%
,\bm{\theta}_{\ell}^{(i)})]
\kappa(\cdot,\cdot)
\phi
p(\bm{\theta}|\mathcal{D})
p(\bm{\theta}|\mathcal{D})
\bm{\theta}_{\ell}^{(i)}
\displaystyle\phi(\bm{\theta}_{\ell}^{(i)})=\frac{1}{M}\sum_{j=1}^{M}[-\kappa(%
\bm{\theta}_{\ell}^{(j)},\bm{\theta}_{\ell}^{(i)})\nabla_{\bm{\theta}_{\ell}^{%
(j)}}U(\bm{\theta}_{\ell}^{(j)})+
\displaystyle\phi(\bm{\theta}_{\ell}^{(i)})=\frac{1}{M}\sum_{j=1}^{M}[-\kappa(%
\bm{\theta}_{\ell}^{(j)},\bm{\theta}_{\ell}^{(i)})\nabla_{\bm{\theta}_{\ell}^{%
(j)}}U(\bm{\theta}_{\ell}^{(j)})+
\displaystyle\nabla_{\bm{\theta}_{\ell}^{(j)}}\kappa(\bm{\theta}_{\ell}^{(j)},%
\bm{\theta}_{\ell}^{(i)})]-\beta^{-1}\nabla_{\bm{\theta}_{\ell}^{(i)}}U(\bm{%
\theta}_{\ell}^{(i)})+\sqrt{2\beta^{-1}\epsilon_{\ell}^{-1}}{\bm{\xi}}_{\ell}^%
{(i)}
\displaystyle\nabla_{\bm{\theta}_{\ell}^{(j)}}\kappa(\bm{\theta}_{\ell}^{(j)},%
\bm{\theta}_{\ell}^{(i)})]-\beta^{-1}\nabla_{\bm{\theta}_{\ell}^{(i)}}U(\bm{%
\theta}_{\ell}^{(i)})+\sqrt{2\beta^{-1}\epsilon_{\ell}^{-1}}{\bm{\xi}}_{\ell}^%
{(i)}
\beta>0
{\bm{\xi}}_{\ell}^{(i)}\sim\mathcal{N}(\bm{0},\bm{I})
\bm{x}
\bm{z}
\bm{z}=f_{att}(\bm{x};\bm{\theta})
\bm{\theta}
g(\cdot)
\displaystyle\bm{z}=g(\bm{z}_{1},...,\bm{z}_{M}),\quad\bm{z}_{i}=f_{att}(\bm{x%
};\bm{\theta}_{i})~{}.
\displaystyle\bm{z}=g(\bm{z}_{1},...,\bm{z}_{M}),\quad\bm{z}_{i}=f_{att}(\bm{x%
};\bm{\theta}_{i})~{}.
\bm{z}
\bm{z}=f_{att}(\bm{x};\bm{\theta})
\displaystyle\bm{\theta}\sim p(\bm{\theta}|\mathcal{D}),~{}~{}\bm{z}=f_{att}(%
\bm{x};\bm{\theta})~{},
\displaystyle\bm{\theta}\sim p(\bm{\theta}|\mathcal{D}),~{}~{}\bm{z}=f_{att}(%
\bm{x};\bm{\theta})~{},
\bm{\theta}
p(\bm{\theta}|\mathcal{D})\propto p(\mathcal{D}|\bm{\theta})p(\bm{\theta})
\bm{z}
p(\bm{z}|\bm{x},\mathcal{D})
\bm{z}
\bm{x}
\mathcal{D}
p(\bm{z}|\bm{x},\mathcal{D})=\int\delta_{f_{att}(\bm{x};\bm{\theta})}(\bm{z})p%
(\bm{\theta}|\mathcal{D})d\bm{\theta}~{}
\delta_{\bm{z}}(\cdot)
\bm{z}
p(\bm{z}|\bm{x},\mathcal{D})
M
p(\bm{\theta}|\mathcal{D})
\displaystyle\bm{z}=g(\bm{z}_{1},...,\bm{z}_{M})
\displaystyle\bm{z}=g(\bm{z}_{1},...,\bm{z}_{M})
\displaystyle\bm{z}_{i}=f_{att}(\bm{x};\bm{\theta}_{i}),\quad\text{with}\quad%
\bm{\theta}_{i}\sim p(\bm{\theta}|\mathcal{D})
\displaystyle\bm{z}_{i}=f_{att}(
\displaystyle\bm{x};\bm{\theta}_{i}),\quad\text{with}\quad\bm{\theta}_{i}\sim p%
(\bm{\theta}|\mathcal{D})
\bm{\theta}_{i}
p(\bm{\theta}|\mathcal{D})
\{\bm{\theta}_{i}\}_{i=1}^{M}
\{\bm{z}_{i}\}_{i=1}^{M}
p(\bm{\theta}|\mathcal{D})
p(\bm{z}|\bm{x};\bm{\theta})
M
\{\bm{\theta}_{i}\}_{i=1}^{M}
p(\bm{\theta}|\mathcal{D})
\nabla_{\bm{\theta}_{\ell}^{(i)}}U(\bm{\theta}_{\ell}^{(i)})
\bm{\theta}_{\ell}^{(i)}
\bm{\theta}^{(i)}
M
M
\mathcal{A}
\bm{\Theta}_{0}=\{\bm{\theta}_{i}\}_{i=1}^{M}
\bm{\Omega}_{0}
\mathcal{D}=\{D_{k}\}_{k=1}^{N}=\{(\bm{x}_{k},y_{k})\}_{k=1}^{N}
\hat{\bm{\Theta}}
\hat{\bm{\Omega}}
\ell
\hat{y}_{k}=\mathcal{A}(\bm{x}_{k};\bm{\Theta}_{\ell},\bm{\Omega}_{\ell}),\forall
k
\mathcal{L}(\{\hat{y}_{k}\},\{y_{k}\})
\bm{\Omega}_{\ell}
\varphi(\bm{\Omega}_{\ell})\leftarrow\nabla_{\bm{\Omega}_{\ell}}\mathcal{L}
i
\phi(\bm{\theta}_{\ell}^{(i)})
\bm{\theta}_{\ell}^{(i)}
\varphi(\bm{\theta}_{\ell}^{(i)})\leftarrow\epsilon_{\ell}\phi(\bm{\theta}_{%
\ell}^{(i)})
\bm{\Omega}_{\ell+1}\leftarrow\text{Optimizer}(\bm{\Omega}_{\ell},\varphi(\bm{%
\Omega}_{\ell}))
\bm{\Theta}_{\ell+1}\leftarrow\text{Optimizer}(\bm{\Theta}_{\ell},\varphi(\bm{%
\Theta}_{\ell}))
\textup{\it i})
\textup{\it ii})
O(\frac{1}{\sqrt{M}}+M\epsilon_{0}^{1/2}+e^{-\sum_{\ell}\epsilon_{\ell}})
M
\textup{\it i})
M
\frac{1}{\sqrt{M}}
M
\textup{\it ii})
M
M\epsilon_{0}^{1/2}
M
M
M
M
M
O(M\epsilon_{0})
M
M
\displaystyle{\bm{a}}=\textsf{Softmax}(\bm{v}^{\top}\textsf{tanh}({{\bf W}}{%
\bf H}^{\top})),\bm{z}={\bm{a}}{\bf H}
\displaystyle{\bm{a}}=\textsf{Softmax}(\bm{v}^{\top}\textsf{tanh}({{\bf W}}{%
\bf H}^{\top})),\bm{z}={\bm{a}}{\bf H}
{\bf H}\in\mathbb{R}^{n\times d}
n
d
\bm{v}\in\mathbb{R}^{1\times n}
{{\bf W}}\in\mathbb{R}^{d_{a}\times d}
\bm{v}\in\mathbb{R}^{d_{a}\times 1}
\bm{z}
{{\bf A}}=\textsf{Softmax}({{\bf V}}^{\top}\textsf{tanh}({{\bf W}}{\bf H}^{%
\top})),{\bf Z}={{\bf A}}{\bf H}
{{\bf V}}\in\mathbb{R}^{d_{a}\times M}
M
{{\bf A}}\in\mathbb{R}^{M\times n}
M
{\bf Z}\in\mathbb{R}^{M\times d}
\kappa(x,y)=\text{exp}(-\frac{1}{h}\|x-y\|_{2}^{2})
h={med}^{2}/\log M
med
\alpha
\epsilon
\alpha
\beta
\epsilon
\alpha
\epsilon
\alpha
\epsilon
V
y=x
y=x
M
B_{m}
B_{m}
B_{m}
\displaystyle\text{acc}(B_{m})=\frac{1}{|B_{m}|}\sum_{i\in B_{m}}\textbf{1}(%
\hat{y}_{i}=y_{i})
\displaystyle\text{acc}(B_{m})
\displaystyle=\frac{1}{|B_{m}|}\sum_{i\in B_{m}}\textbf{1}(\hat{y}_{i}=y_{i})
\displaystyle\text{conf}(B_{m})=\frac{1}{|B_{m}|}\sum_{i\in B_{m}}\hat{p}_{i}
\displaystyle\text{conf}(B_{m})
\displaystyle=\frac{1}{|B_{m}|}\sum_{i\in B_{m}}\hat{p}_{i}
\hat{p}_{i}
i
\text{ECE}=\sum_{m=1}^{M}\frac{|B_{m}|}{n}|\text{acc}(B_{m})-\text{conf}(B_{m})|
\displaystyle\text{OE}=\sum_{m=1}^{M}\frac{|B_{m}|}{n}[\text{conf}(B_{m})\times
\displaystyle\text{OE}=
\displaystyle\sum_{m=1}^{M}\frac{|B_{m}|}{n}[\text{conf}(B_{m})\times
\displaystyle\text{max}(\text{conf}(B_{m})-\text{acc}(B_{m}),0)]
\displaystyle\text{max}(\text{conf}(B_{m})-\text{acc}(B_{m}),0)]
i->j
i->j
\bm{\theta}
\bm{\theta}^{(i)}
\phi
\displaystyle\phi(\bm{\theta}_{\ell}^{(i)})=-\nabla_{\bm{\theta}_{\ell}^{(i)}}%
U(\bm{\theta}_{\ell}^{(i)})+\nabla_{\bm{\theta}_{\ell}^{(i)}}\frac{1}{M}\sum_{%
j=1}^{M}\frac{\bm{\theta}_{\ell}^{(i)}\bm{\theta}_{\ell}^{(j)}}{\|\bm{\theta}_%
{\ell}^{(i)}\|\|\bm{\theta}_{\ell}^{(j)}\|}
\displaystyle\phi(\bm{\theta}_{\ell}^{(i)})=-\nabla_{\bm{\theta}_{\ell}^{(i)}}%
U(\bm{\theta}_{\ell}^{(i)})+\nabla_{\bm{\theta}_{\ell}^{(i)}}\frac{1}{M}\sum_{%
j=1}^{M}\frac{\bm{\theta}_{\ell}^{(i)}\bm{\theta}_{\ell}^{(j)}}{\|\bm{\theta}_%
{\ell}^{(i)}\|\|\bm{\theta}_{\ell}^{(j)}\|}
\displaystyle\phi(\bm{\theta}_{\ell}^{(i)})=\frac{1}{M}\sum_{j=1}^{M}-\frac{%
\bm{\theta}_{\ell}^{(i)}\bm{\theta}_{\ell}^{(j)}}{\|\bm{\theta}_{\ell}^{(i)}\|%
\|\bm{\theta}_{\ell}^{(j)}\|}\nabla_{\bm{\theta}_{\ell}^{(j)}}U(\bm{\theta}_{%
\ell}^{(j)})
\displaystyle\phi(\bm{\theta}_{\ell}^{(i)})
\displaystyle=\frac{1}{M}\sum_{j=1}^{M}-\frac{\bm{\theta}_{\ell}^{(i)}\bm{%
\theta}_{\ell}^{(j)}}{\|\bm{\theta}_{\ell}^{(i)}\|\|\bm{\theta}_{\ell}^{(j)}\|%
}\nabla_{\bm{\theta}_{\ell}^{(j)}}U(\bm{\theta}_{\ell}^{(j)})
\displaystyle+\frac{1}{M}\sum_{j=1}^{M}\nabla_{\bm{\theta}_{\ell}^{(j)}}\frac{%
\bm{\theta}_{\ell}^{(i)}\bm{\theta}_{\ell}^{(j)}}{\|\bm{\theta}_{\ell}^{(i)}\|%
\|\bm{\theta}_{\ell}^{(j)}\|}
\displaystyle+\frac{1}{M}\sum_{j=1}^{M}\nabla_{\bm{\theta}_{\ell}^{(j)}}\frac{%
\bm{\theta}_{\ell}^{(i)}\bm{\theta}_{\ell}^{(j)}}{\|\bm{\theta}_{\ell}^{(i)}\|%
\|\bm{\theta}_{\ell}^{(j)}\|}
\frac{\bm{\theta}_{\ell}^{(i)}\bm{\theta}_{\ell}^{(j)}}{\|\bm{\theta}_{\ell}^{%
(i)}\|\|\bm{\theta}_{\ell}^{(j)}\|}
j\neq i
\nabla_{\bm{\theta}_{\ell}^{(j)}}
\nabla_{\bm{\theta}_{\ell}^{(i)}}
\nabla_{\bm{\theta}_{\ell}^{(i)}}
\nabla_{\bm{\theta}_{\ell}^{(j)}}
\kappa(\bm{\theta}_{\ell}^{(j)},\bm{\theta}_{\ell}^{(i)})
