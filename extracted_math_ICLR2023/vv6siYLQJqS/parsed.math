n
\mathbf{s}=[s_{1},\ldots,s_{n}]\in\mathbb{R}^{n}
\mathbf{P}\in\{0,1\}^{n\times n}
\mathbf{s}
\mathbf{s}_{\mathrm{o}}
\mathbf{s}_{\mathrm{o}}=\mathbf{P}^{\top}\mathbf{s},
f
\mathbf{s}
\mathbf{P}
\mathbf{P}=f(\mathbf{s}).
\mathbf{s}
\mathbf{X}=[\mathbf{x}_{1},\ldots,\mathbf{x}_{n}]^{\top}\in\mathbb{R}^{n\times
d}
d\gg 1
\mathbf{X}_{\mathrm{o}}=\mathbf{P}^{\top}\mathbf{X},
\mathbf{X}_{\mathrm{o}}
\mathbf{X}
g
\mathbf{x}\in\mathbb{R}^{d}
s\in\mathbb{R}
g
\mathbf{P}
\mathbf{x}
g
\{(\mathbf{X}^{(i)},\mathbf{P}_{\mathrm{gt}}^{(i)})\}_{i=1}^{N}
f([g(\mathbf{x}_{1}),\ldots,g(\mathbf{x}_{n})])
\mathbf{X}
g(\mathbf{X})
g(\mathbf{x})
(x^{\prime},y^{\prime})=\mathrm{swap}(x,y),
x^{\prime}=\min(x,y)
y^{\prime}=\max(x,y)
x
y
x>y
x^{\prime}=y
y^{\prime}=x
\min(\cdot,\cdot)
\max(\cdot,\cdot)
\min(x,y)=x\lfloor\sigma(y-x)\rceil+y\lfloor\sigma(x-y)\rceil\quad\textrm{and}%
\quad\max(x,y)=x\lfloor\sigma(x-y)\rceil+y\lfloor\sigma(y-x)\rceil,
\lfloor\cdot\rceil
\sigma(\cdot)\in[0,1]
\min
\max
\displaystyle\overline{\mathrm{min}}(x,y)=x\sigma(y-x)+y\sigma(x-y)\quad%
\textrm{and}\quad\overline{\mathrm{max}}(x,y)=x\sigma(x-y)+y\sigma(y-x),
\displaystyle\overline{\mathrm{min}}(x,y)=x\sigma(y-x)+y\sigma(x-y)\quad%
\textrm{and}\quad\overline{\mathrm{max}}(x,y)=x\sigma(x-y)+y\sigma(y-x),
\sigma(\cdot)
\sigma(x)
s
\sigma(x)
\sigma(x)=1
x\to\infty
\sigma(x)=0
x\to-\infty
\sigma(0)=0.5
\sigma(x)=1-\sigma(-x)
\sigma
\sigma_{\mathcal{O}}(x)=\begin{cases}-\frac{1}{16}(\beta x)^{-1}&\textrm{if}\ %
\beta x<-0.25,\\
1-\frac{1}{16}(\beta x)^{-1}&\textrm{if}\ \beta x>0.25,\\
\beta x+0.5&\textrm{otherwise},\end{cases}
\beta
\mathbf{P}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{soft}}
\mathbf{s}
\mathbf{P}_{i}
i
\mathbf{P}
\mathbf{P}_{i}
i
\mathbf{P}^{\top}=\mathbf{P}_{1}^{\top}\mathbf{P}_{2}^{\top}\cdots\mathbf{P}_{%
k}^{\top}=(\mathbf{P}_{k}\cdots\mathbf{P}_{2}\mathbf{P}_{1})^{\top}
k
k=5
\mathbf{P}
\mathbf{P}\in\mathbb{R}^{n\times n}
\sum_{i=1}^{n}[\mathbf{P}]_{ij}=1
\sum_{j=1}^{n}[\mathbf{P}]_{ij}=1
\min
\max
\overline{\mathrm{min}}
\overline{\mathrm{max}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{soft}}
x
y
|x-y|
x
y
|x-y|
\overline{\mathrm{min}}
\overline{\mathrm{max}}
x<y
x<\overline{\mathrm{min}}(x,y)
\overline{\mathrm{max}}(x,y)<y
x
y
x<y
x
y
x<x^{\prime}=\overline{\mathrm{min}}(x,y)\leq y^{\prime}=\overline{\mathrm{max%
}}(x,y)<y.
x^{\prime}-x
y-y^{\prime}
y-y^{\prime}=y-\overline{\mathrm{max}}(x,y)=x^{\prime}-x=\overline{\mathrm{min%
}}(x,y)-x>0,
\overline{\mathrm{min}}(x,y)-\min(x,y)
\max(x,y)-\overline{\mathrm{max}}(x,y)
x,y
y-\overline{\mathrm{max}}(x,y)=y(1-\sigma(y-x))-x\sigma(x-y)=y\sigma(x-y)-x(1-%
\sigma(y-x))=\overline{\mathrm{min}}(x,y)-x
\sigma(x-y)=1-\sigma(y-x)
x
y
k
k\to\infty
(\max(x,y)-\min(x,y))/2
\nabla_{x}\sigma(x)>0
\nabla_{x}\sigma(x)
x,y
\nabla_{x}\sigma(x)
\nabla_{x}\sigma(x)
|x-y|
x<y
x
y
\sigma(y-x)
0.5
1
|x-y|
(x^{\prime},y^{\prime})=\mathrm{swap}_{\mathrm{error}\textrm{-}\mathrm{free}}(%
x,y),
x^{\prime}=\left(\min(x,y)-\overline{\mathrm{min}}(x,y)\right)_{\mathrm{sg}}+%
\overline{\mathrm{min}}(x,y)\quad\textrm{and}\quad y^{\prime}=\left(\max(x,y)-%
\overline{\mathrm{max}}(x,y)\right)_{\mathrm{sg}}+\overline{\mathrm{max}}(x,y).
\mathrm{sg}
x^{\prime}=\min(x,y)
y^{\prime}=\max(x,y)
\overline{\mathrm{min}}
\overline{\mathrm{max}}
\mathrm{acc}_{\mathrm{em}}
\mathrm{acc}_{\mathrm{ew}}
\displaystyle x^{\prime}\!=\!\left((x\lfloor\sigma(y-x)\rceil\!+\!y\lfloor%
\sigma(x-y)\rceil)\!-\!(x\sigma(y-x)\!+\!y\sigma(x-y))\right)_{\mathrm{sg}}\!+%
\!(x\sigma(y-x)\!+\!y\sigma(x-y))
\displaystyle x^{\prime}
\displaystyle\!=\!\left((x\lfloor\sigma(y-x)\rceil\!+\!y\lfloor\sigma(x-y)%
\rceil)\!-\!(x\sigma(y-x)\!+\!y\sigma(x-y))\right)_{\mathrm{sg}}\!+\!(x\sigma(%
y-x)\!+\!y\sigma(x-y))
\displaystyle\!=\!x\left((\lfloor\sigma(y-x)\rceil\!-\!\sigma(y-x))_{\mathrm{%
sg}}\!+\!\sigma(y-x)\right)\!+\!y\left((\lfloor\sigma(x-y)\rceil\!-\!\sigma(x-%
y))_{\mathrm{sg}}\!+\!\sigma(x-y)\right),
\displaystyle\!=\!x\left((\lfloor\sigma(y-x)\rceil\!-\!\sigma(y-x))_{\mathrm{%
sg}}\!+\!\sigma(y-x)\right)\!+\!y\left((\lfloor\sigma(x-y)\rceil\!-\!\sigma(x-%
y))_{\mathrm{sg}}\!+\!\sigma(x-y)\right),
\displaystyle y^{\prime}\!=\!x\left((\lfloor\sigma(x-y)\rceil\!-\!\sigma(x-y))%
_{\mathrm{sg}}\!+\!\sigma(x-y)\right)\!+\!y\left((\lfloor\sigma(y-x)\rceil\!-%
\!\sigma(y-x))_{\mathrm{sg}}\!+\!\sigma(y-x)\right),
\displaystyle y^{\prime}
\displaystyle\!=\!x\left((\lfloor\sigma(x-y)\rceil\!-\!\sigma(x-y))_{\mathrm{%
sg}}\!+\!\sigma(x-y)\right)\!+\!y\left((\lfloor\sigma(y-x)\rceil\!-\!\sigma(y-%
x))_{\mathrm{sg}}\!+\!\sigma(y-x)\right),
n=2
\mathbf{P}
[x,y]
\mathbf{P}=\left[\begin{matrix}(\lfloor\sigma(y-x)\rceil-\sigma(y-x))_{\mathrm%
{sg}}+\sigma(y-x)&(\lfloor\sigma(x-y)\rceil-\sigma(x-y))_{\mathrm{sg}}+\sigma(%
x-y)\\
(\lfloor\sigma(x-y)\rceil-\sigma(x-y))_{\mathrm{sg}}+\sigma(x-y)&(\lfloor%
\sigma(y-x)\rceil-\sigma(y-x))_{\mathrm{sg}}+\sigma(y-x)\\
\end{matrix}\right].
\mathrm{swap}_{\mathrm{error}\textrm{-}\mathrm{free}}(\cdot,\cdot)
x^{\prime}-\min(x,y)
\max(x,y)-y^{\prime}
\mathbf{X}
\mathbf{s}
\mathbf{X}
\mathbf{s}
g:\mathbb{R}^{d}\to\mathbb{R}
[g(\mathbf{x}_{\pi_{1}}),g(\mathbf{x}_{\pi_{2}}),\ldots,g(\mathbf{x}_{\pi_{n}}%
)]=\pi([g(\mathbf{x}_{1}),g(\mathbf{x}_{2}),\ldots,g(\mathbf{x}_{n})]),
\pi_{i}=[\pi([1,2,\ldots,n])]_{i}\ \forall i\in[n]
\pi
\mathrm{att}(\mathbf{Q},\mathbf{K},\mathbf{V})=\mathrm{softmax}\left(\frac{%
\mathbf{Q}\mathbf{K}^{\top}}{\sqrt{d_{m}}}\right)\mathbf{V}\quad\textrm{and}%
\quad\mathrm{mha}(\mathbf{Q},\mathbf{K},\mathbf{V})=[\mathrm{head}_{1},\mathrm%
{head}_{2},\ldots,\mathrm{head}_{h}]\mathbf{W}_{o},
\mathrm{head}_{i}=\mathrm{att}(\mathbf{Q}\mathbf{W}_{q}^{(i)},\mathbf{K}%
\mathbf{W}_{k}^{(i)},\mathbf{V}\mathbf{W}_{v}^{(i)})
\mathbf{Q},\mathbf{K},\mathbf{V}\!\in\!\mathbb{R}^{n\times hd_{m}}
\mathbf{W}_{q}^{(i)},\mathbf{W}_{k}^{(i)},\mathbf{W}_{v}^{(i)}\!\in\!\mathbb{R%
}^{hd_{m}\times d_{m}}
\mathbf{W}_{o}\!\in\!\mathbb{R}^{hd_{m}\times hd_{m}}
\mathrm{mha}
\mathbf{X}
\mathrm{mha}(\mathbf{Z},\mathbf{Z},\mathbf{Z})
\mathbf{Z}=g^{\prime}(\mathbf{X})
\mathbf{Z}
g^{\prime}(\cdot)
\mathrm{mha}(\mathbf{Z},\mathbf{Z},\mathbf{Z})
\mathbf{z}_{1},\mathbf{z}_{2},\ldots,\mathbf{z}_{n}
\mathbf{Z}=[\mathbf{z}_{1},\mathbf{z}_{2},\ldots,\mathbf{z}_{n}]^{\top}
\mathbf{s}
\mathbf{s}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{soft}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{soft}}
g
\mathbf{P}_{\mathrm{soft}}
\mathbf{P}_{\mathrm{hard}}
\displaystyle\mathcal{L}_{\mathrm{soft}}=-\sum_{i=1}^{n}\sum_{j=1}^{n}[\mathbf%
{P}_{\mathrm{gt}}\log\mathbf{P}_{\mathrm{soft}}+(1-\mathbf{P}_{\mathrm{gt}})%
\log(1-\mathbf{P}_{\mathrm{soft}})]_{ij},
\displaystyle\mathcal{L}_{\mathrm{soft}}
\displaystyle=-\sum_{i=1}^{n}\sum_{j=1}^{n}[\mathbf{P}_{\mathrm{gt}}\log%
\mathbf{P}_{\mathrm{soft}}+(1-\mathbf{P}_{\mathrm{gt}})\log(1-\mathbf{P}_{%
\mathrm{soft}})]_{ij},
\displaystyle\mathcal{L}_{\mathrm{hard}}=\|\mathbf{X}_{\mathrm{o},\mathrm{hard%
}}-\mathbf{X}_{\mathrm{o},\mathrm{gt}}\|_{F}^{2}=\|\mathbf{P}_{\mathrm{hard}}^%
{\top}\mathbf{X}-\mathbf{P}_{\mathrm{gt}}^{\top}\mathbf{X}\|_{F}^{2},
\displaystyle\mathcal{L}_{\mathrm{hard}}
\displaystyle=\|\mathbf{X}_{\mathrm{o},\mathrm{hard}}-\mathbf{X}_{\mathrm{o},%
\mathrm{gt}}\|_{F}^{2}=\|\mathbf{P}_{\mathrm{hard}}^{\top}\mathbf{X}-\mathbf{P%
}_{\mathrm{gt}}^{\top}\mathbf{X}\|_{F}^{2},
\mathbf{P}_{\mathrm{gt}}
\mathcal{L}_{\mathrm{soft}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{hard}}
\|\mathbf{X}_{\mathrm{o},\mathrm{hard}}-\mathbf{X}_{\mathrm{o},\mathrm{gt}}\|_%
{F}^{2}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{gt}}
\mathbf{X}
g
\mathcal{L}=\mathcal{L}_{\mathrm{soft}}+\lambda\mathcal{L}_{\mathrm{hard}}
\lambda
\lambda
\mathcal{L}_{\mathrm{hard}}
\mathcal{L}_{\mathrm{hard}}
\mathrm{acc}_{\mathrm{em}}
\mathrm{acc}_{\mathrm{ew}}
\mathrm{acc}_{\mathrm{em}}=\frac{\sum_{i=1}^{N}\bigcap_{j=1}^{n}{\boldsymbol{1%
}}\big{(}\left[\hat{\mathbf{s}}^{(i)}\right]_{j}=\left[\tilde{\mathbf{s}}^{(i)%
}\right]_{j}\big{)}}{N}\quad\textrm{and}\quad\mathrm{acc}_{\mathrm{ew}}=\frac{%
\sum_{i=1}^{N}\sum_{j=1}^{n}{\boldsymbol{1}}\big{(}\left[\hat{\mathbf{s}}^{(i)%
}\right]_{j}=\left[\tilde{\mathbf{s}}^{(i)}\right]_{j}\big{)}}{Nn},
\mathrm{argsort}
\boldsymbol{1}(\cdot)
\hat{\mathbf{s}}^{(i)}=\mathrm{argsort}\left(\mathbf{P}^{(i)\top}_{\mathrm{gt}%
}\mathbf{s}^{(i)}\right)\quad\textrm{and}\quad\tilde{\mathbf{s}}^{(i)}=\mathrm%
{argsort}\left(\mathbf{P}^{(i)\top}\mathbf{s}^{(i)}\right).
\mathrm{acc}_{\mathrm{em}}
\mathrm{acc}_{\mathrm{ew}}
\mathrm{acc}_{\mathrm{em}}
\mathrm{acc}_{\mathrm{ew}}
\mathrm{acc}_{\mathrm{em}}
\mathrm{acc}_{\mathrm{ew}}
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
\times
2\times 2
3\times 3
\mathrm{argsort}
\mathcal{O}(n\log n)
\mathcal{O}(n)
\mathbf{X}
\mathbf{P}_{\mathrm{soft}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{soft}}^{\top}\mathbf{X}
\mathbf{P}_{\mathrm{soft}}
\mathbf{X}
\mathbf{P}_{\mathrm{hard}}^{\top}\mathbf{X}
\mathbf{X}
\mathrm{acc}_{\mathrm{em}}
\mathrm{acc}_{\mathrm{ew}}
x
y
x=4,y=0
x=8,y=0
k=\#\textrm{Swaps}
x
y
x=4,y=0
x=8,y=0
k=\#\textrm{Swaps}
9
15
\mathrm{acc}_{\mathrm{em}}
\mathrm{acc}_{\mathrm{ew}}
g
\mathbf{x}
s
n
[-10,10]
\mathbf{s}
n
\mathrm{acc}_{\mathrm{em}}
\mathrm{acc}_{\mathrm{ew}}
g
\mathbf{x}
s
n
[-10,10]
\mathbf{s}
n
\mathrm{acc}_{\mathrm{em}}
\mathrm{acc}_{\mathrm{ew}}
i
j
[\mathbf{P}]_{kk}=1
k\in[n]\backslash\{i,j\}
[\mathbf{P}]_{kl}=0
k\neq l
k,l\in[n]\backslash\{i,j\}
[\mathbf{P}]_{ii}=[\mathbf{P}]_{jj}=p
[\mathbf{P}]_{ij}=[\mathbf{P}]_{ji}=1-p
p
p=\sigma(y-x)
p=\lfloor\sigma(y-x)\rceil
\overline{\mathrm{min}}^{k}(x,y)
\overline{\mathrm{min}}^{k}(x,y)
\mathrm{swap}
\overline{\mathrm{min}}
\overline{\mathrm{max}}
k
\overline{\mathrm{min}}^{i}<\overline{\mathrm{min}}^{i+1}
\overline{\mathrm{max}}^{i+1}<\overline{\mathrm{max}}^{i}
\displaystyle\min(x,y)<\overline{\mathrm{min}}^{1}(x,y)<\overline{\mathrm{min}%
}^{2}(x,y)<\cdots<\overline{\mathrm{min}}^{k}(x,y)
\displaystyle\min(x,y)<\overline{\mathrm{min}}^{1}(x,y)<\overline{\mathrm{min}%
}^{2}(x,y)<\cdots<\overline{\mathrm{min}}^{k}(x,y)
\displaystyle\leq\overline{\mathrm{max}}^{k}(x,y)<\cdots<\overline{\mathrm{max%
}}^{2}(x,y)<\overline{\mathrm{max}}^{1}(x,y)<\max(x,y),
\displaystyle\leq\overline{\mathrm{max}}^{k}(x,y)<\cdots<\overline{\mathrm{max%
}}^{2}(x,y)<\overline{\mathrm{max}}^{1}(x,y)<\max(x,y),
\nabla_{x}\sigma(x)>0
\nabla_{x}\sigma(x)>0
0\leq\overline{\mathrm{max}}^{k+1}(x,y)-\overline{\mathrm{min}}^{k+1}(x,y)<%
\overline{\mathrm{max}}^{k}(x,y)-\overline{\mathrm{min}}^{k}(x,y)<\overline{%
\mathrm{max}}^{k-1}(x,y)-\overline{\mathrm{min}}^{k-1}(x,y).
\lim_{k\to\infty}\overline{\mathrm{max}}^{k}(x,y)-\overline{\mathrm{min}}^{k}(%
x,y)=0
\overline{\mathrm{min}}^{k}(x,y)=\overline{\mathrm{max}}^{k}(x,y)
k\to\infty
k\to\infty
(\max(x,y)-\min(x,y))/2
\overline{\mathrm{max}}^{k}(x,y)=(\min(x,y)+\max(x,y))/2
\nabla_{x}\sigma(x)>0
\sigma(\cdot)
x
y
x^{\prime}-\min(x,y)
\displaystyle x^{\prime}-\min(x,y)=\left(\min(x,y)-\overline{\mathrm{min}}(x,y%
)\right)_{\mathrm{sg}}+\overline{\mathrm{min}}(x,y)-\min(x,y)
\displaystyle x^{\prime}-\min(x,y)
\displaystyle=\left(\min(x,y)-\overline{\mathrm{min}}(x,y)\right)_{\mathrm{sg}%
}+\overline{\mathrm{min}}(x,y)-\min(x,y)
\displaystyle=\min(x,y)-\overline{\mathrm{min}}(x,y)+\overline{\mathrm{min}}(x%
,y)-\min(x,y)
\displaystyle=\min(x,y)-\overline{\mathrm{min}}(x,y)+\overline{\mathrm{min}}(x%
,y)-\min(x,y)
\displaystyle=0,
\displaystyle=0,
\max(x,y)-y^{\prime}
\mathbf{s}
\mathbf{P}
\mathbf{P}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{s}\in\mathbb{R}^{n}
\mathbf{P}_{\mathrm{hard}}\in\mathbb{R}^{n\times n}
\mathbf{s}_{\mathrm{o}}
\mathbf{s}
\mathbf{s}_{1}\in\mathbb{R}^{n_{1}}
\mathbf{s}_{2}\in\mathbb{R}^{n_{2}}
\mathbf{s}_{1}=[\mathbf{s}]_{1:n_{1}}
\mathbf{s}_{2}=[\mathbf{s}]_{n_{1}+1:n_{1}+n_{2}}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{1}\in\mathbb{R}^{n_{1}\times n_{1}}
\mathbf{P}_{2}\in\mathbb{R}^{n_{2}\times n_{2}}
\mathbf{P}_{1}
\mathbf{P}_{2}
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{soft}}
1\times 32
5\times 5
32\times 64
5\times 5
12544\times 64
64\times 1
1\times 32
5\times 5
32\times 64
5\times 5
12544\times 16
16\times 16
16\times 1
1\times 32
5\times 5
32\times 64
5\times 5
12544\times 64
64\times 64
64\times 1
3\times 32
5\times 5
32\times 64
5\times 5
64\times 128
5\times 5
128\times 256
5\times 5
2304\times 64
64\times 1
3\times 32
5\times 5
32\times 64
5\times 5
64\times 64
5\times 5
64\times 128
5\times 5
1152\times 32
32\times 32
32\times 1
3\times 32
5\times 5
32\times 64
5\times 5
64\times 128
5\times 5
128\times 256
5\times 5
2304\times 64
64\times 64
64\times 1
14\times 14
14\times 14
1\times 32
3\times 3
32\times 64
3\times 3
1024\times 64
64\times 1
14\times 14
14\times 14
1\times 32
3\times 3
32\times 32
3\times 3
512\times 16
16\times 16
16\times 1
16\times 16
16\times 16
3\times 32
3\times 3
32\times 64
3\times 3
1024\times 64
64\times 1
16\times 16
16\times 16
3\times 32
3\times 3
32\times 32
3\times 3
512\times 16
16\times 16
16\times 1
10^{-3.5}
10^{-4}
0.5
\mathbf{P}_{\mathrm{hard}}
\mathbf{P}_{\mathrm{soft}}
1
0.1
0.01
0.001
42
84
126
168
210
\lambda
\lambda
\boldsymbol{\lambda}
10^{-3}
\lambda
{\boldsymbol{\log}}_{\textbf{10}}
{\boldsymbol{\log}}_{\textbf{10}}
{\boldsymbol{\log}}_{\textbf{10}}
{\boldsymbol{\log}}_{\textbf{10}}
{\boldsymbol{\log}}_{\textbf{10}}
{\boldsymbol{\log}}_{\textbf{10}}
k
