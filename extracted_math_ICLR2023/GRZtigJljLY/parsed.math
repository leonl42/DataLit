\mathcal{D}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{train}}
\mathcal{H}=\{h_{1},\dotsc,h_{n}\}
\mathcal{H}
H
\mathrm{p}(H)
\omega\sim\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})
\omega
\omega
h
\mathcal{D}_{\mathrm{pool}}
y
x\in\mathcal{D}_{\mathrm{pool}}
x
\sigma\in[0,1]
\pi
\pi
\mathcal{D}_{\mathrm{train}}
\mathcal{D}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{train}}^{\pi}
\pi
\mathcal{D}_{\mathrm{train}}^{\pi}
\mathrm{p}_{\mathrm{ERR}}(\pi)
\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}}^{\pi})
\pi
\mathrm{cost}(\pi)\triangleq\max\left|\mathcal{D}_{\mathrm{train}}^{\pi}\right|
\pi
H\in\mathcal{H}
\sigma\in[0,1]
\sigma
\operatorname*{arg\,min}_{\pi}\mathrm{cost}(\pi),~{}\mathrm{s.t.}\>\mathrm{p}_%
{\mathrm{ERR}}(\pi)\leq\sigma
(\mathcal{H},d)
\mathcal{H}
d
\mathcal{V}\subseteq\mathcal{H}
\mathcal{S}=\{s_{1},...,s_{k}\}\subseteq\mathcal{V}
k
r^{\mathcal{S}}:\mathcal{V}\rightarrow[k]
\mathcal{V}
\mathcal{D}_{i}:=\{h\in\mathcal{V}\mid r^{\mathcal{S}}(h)=i\}
\forall i,j\in[k],r^{\mathcal{S}}(s_{i})=i
\forall h\in\mathcal{D}_{i},d(h,s_{i})\leq d(h,s_{j})
\mathcal{D}_{i}\subseteq\mathcal{V}
s_{i}\in\mathcal{S}
\mathcal{H}
\mathcal{V}\subseteq\mathcal{H}
\bar{\mathcal{D}}_{\mathrm{pool}}
h\in\mathcal{H}
v_{h}
\bar{\mathcal{D}}_{\mathrm{pool}}
d_{\mathrm{H}}(h,h^{\prime})
k
\mathcal{V}
d_{\mathrm{H}}^{\mathcal{S}}(\mathcal{V}):=\max_{h,h^{\prime}\in\mathcal{V}:r^%
{\mathcal{S}}(h)=r^{\mathcal{S}}(h^{\prime})}d_{\text{H}}(h,h^{\prime})
\mathcal{S}
\{h,h^{\prime}\}
d_{\mathrm{H}}^{\mathcal{S}}(\mathcal{V})
k
\mathcal{C}=\operatorname*{arg\,min}_{|\mathcal{S}|=k}d_{\mathrm{H}}^{\mathcal%
{S}}(\mathcal{V})
\{h,h^{\prime}\}
\mathcal{E}=\{\{h,h^{\prime}\}:r^{\mathcal{C}}(h)\neq r^{\mathcal{C}}(h^{%
\prime})\}
\mathcal{C}
\textsc{EC}^{2}
\mathcal{D}_{\mathrm{train}}
\omega
\{\hat{\omega},\hat{\omega}^{\prime}\}
\hat{\omega},\hat{\omega}^{\prime}
d_{\mathrm{H}}(\hat{\omega},\hat{\omega}^{\prime})
\hat{\omega},\hat{\omega}^{\prime}
\bar{\mathcal{D}}_{\mathrm{pool}}
\tau
\{\hat{\omega},\hat{\omega}^{\prime}\}\in\hat{\mathcal{E}}
x_{1:b}\triangleq\{x_{1},...,x_{b}\}
\begin{split}\Delta_{\textsc{BALanCe}}(x_{1:b}\mid\mathcal{D}_{\mathrm{train}}%
)\triangleq\mathbb{E}_{y_{1:b}}\mathbb{E}_{\omega,\omega^{\prime}\sim\mathrm{p%
}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}(\omega,%
\omega^{\prime})>\tau}\cdot\left(1-\lambda_{\omega,y_{1:b}}\lambda_{\omega^{%
\prime},y_{1:b}}\right)\end{split}
\lambda_{\omega,y_{1:b}}\triangleq\frac{\mathrm{p}(y_{1:b}\mid\omega,x_{1:b})}%
{\max_{y^{\prime}_{1:b}}\mathrm{p}(y^{\prime}_{1:b}\mid\omega,x_{1:b})}
\mathrm{p}(y^{\prime}_{1:b}\mid\omega,x_{1:b})=\text{const}~{}\forall y^{%
\prime}_{1:b},\omega
\mathbbm{1}_{d_{\mathrm{H}}(\hat{\omega}_{k},\hat{\omega}_{k}^{\prime})>\tau}
\tau
\tau
\varepsilon
\{\hat{\omega},\hat{\omega}^{\prime}\}
d_{\mathrm{H}}(\hat{\omega},\hat{\omega}^{\prime})
1-\lambda_{\hat{\omega}_{k},y_{1:b}}\lambda_{\hat{\omega}_{k}^{\prime},y_{1:b}}
y
\{\hat{\omega},\hat{\omega}^{\prime}\}
d_{\mathrm{H}}(\hat{\omega},\hat{\omega}^{\prime})>\tau
y_{1:b}
\Delta_{\textsc{BALanCe}}(x_{1:b})
\frac{1}{2K^{2}}\sum_{y_{1:b}}\sum_{k=1}^{K}\left(\mathrm{p}(y_{1:b}\mid\hat{%
\omega}_{k})+\mathrm{p}(y_{1:b}\mid\hat{\omega}_{k}^{\prime})\right)\sum_{k=1}%
^{K}\mathbbm{1}_{d_{\mathrm{H}}(\hat{\omega}_{k},\hat{\omega}_{k}^{\prime})>%
\tau}\left(1-\lambda_{\hat{\omega}_{k},y_{1:b}}\lambda_{\hat{\omega}_{k}^{%
\prime},y_{1:b}}\right).
\mathcal{D}_{\mathrm{train}}
\mathcal{D}_{\mathrm{pool}}
\bar{\mathcal{D}}_{\mathrm{pool}}
B
\beta
\tau
|\mathcal{C}|
K
\{\hat{\omega}_{k},\hat{\omega}_{k}^{\prime}\}_{k=1}^{K}
B
\mathcal{A}_{B}\leftarrow\mathrm{GreedySelection}(\mathcal{D}_{\mathrm{pool}},%
\bar{\mathcal{D}}_{\mathrm{pool}},\{\hat{\omega}_{k},\hat{\omega}_{k}^{\prime}%
\}_{k=1}^{K},\tau,B)
\mathcal{C}\subset\mathcal{D}_{\mathrm{pool}}
\mathrm{p}(x)\sim\Delta_{\textsc{BALanCe}}(x)^{\beta}
\mathcal{S}_{1:B},\mu_{1:B}\leftarrow
(\mathcal{C},\bar{\mathcal{D}}_{\mathrm{pool}},\{\hat{\omega}_{k},\hat{\omega}%
_{k}^{\prime}\}_{k=1}^{K},\tau,\beta,B)
\mathcal{A}_{B}\leftarrow\mu_{1:B}
\mathcal{A}_{B}
x
\Delta_{\textsc{BALanCe}}(x)
x
\Delta_{\textsc{BALanCe}}(x_{1:b-1}\cup\{x\})
b
y_{1:b}
x_{1:b}
b
\Delta_{\textsc{BALanCe}}(x_{1:b})
M
y_{1:b}
M
y_{1:b-1}
M
y_{b}
\mathcal{D}
\bar{\mathcal{D}}_{\mathrm{pool}}
\{\hat{\omega}_{k},\hat{\omega}_{k}^{\prime}\}_{k=1}^{K}
\tau
B
\mathcal{A}_{0}=\emptyset
b\in[B]
x\in\mathcal{D}\backslash\mathcal{A}_{b-1}
s_{x}\leftarrow\Delta_{\mathrm{\textsc{BALanCe}}}(\mathcal{A}_{b-1}\bigcup\{x\})
x_{b}\leftarrow\operatorname*{arg\,max}_{x\in\mathcal{D}\backslash\mathcal{A}_%
{b-1}}s_{x}
\mathcal{A}_{b}\leftarrow\mathcal{A}_{b-1}\bigcup\{x_{b}\}
\mathcal{A}_{B}=\{x_{1},\ldots,x_{B}\}
\mathcal{C}\subset\mathcal{D}_{\mathrm{pool}}
\bar{\mathcal{D}}_{\mathrm{pool}}
\{\hat{\omega}_{k},\hat{\omega}_{k}^{\prime}\}_{k=1}^{K}
\tau
\beta
B
\mathcal{O}=\{\mu_{j}\}^{B}_{j=1}\subset\mathcal{C}
\mathrm{p}(x)\sim\Delta_{\textsc{BALanCe}}(x)^{\beta}
\mathcal{O}
x\in\mathcal{C}
a_{x}\leftarrow\operatorname*{arg\,max}_{j}\mathrm{I}_{\Delta_{\textsc{BALanCe%
}}}(x,\mu_{j})
\mathcal{S}_{j}\leftarrow\{x\in\mathcal{C}:a_{x}=j\}
j\in[B]
\mu_{j}\leftarrow\operatorname*{arg\,max}_{y\in\mathcal{S}_{j}}\sum_{x\in%
\mathcal{S}_{j}}\mathrm{I}_{\Delta_{\textsc{BALanCe}}}(x,y)
\mathcal{S}_{1:B}
\mu_{1:B}
\mathrm{p}(x)\sim\Delta_{\textsc{BALanCe}}(x)^{\beta}
\mathrm{I}_{\Delta_{\textsc{BALanCe}}}(x,y)
x
y
\mathrm{I}_{\Delta_{\textsc{BALanCe}}}(x,y)=\Delta_{\textsc{BALanCe}}(x)+%
\Delta_{\textsc{BALanCe}}(y)-\Delta_{\textsc{BALanCe}}(\{x,y\})
\mathrm{I}_{\Delta_{\textsc{BALanCe}}}(x,y)
x
y
\Delta_{\textsc{BALanCe}}
\mathcal{C}\subset\mathcal{D}_{\mathrm{pool}}
\mathrm{p}(x)\sim\Delta_{\textsc{BALanCe}}(x)^{\beta}
B
\mathcal{C}
\{\hat{\omega}_{k},\hat{\omega}_{k}^{\prime}\}_{k=1}^{K}
\tau
\beta
B
\mathcal{O}
\mathrm{p}(x)\sim\Delta_{\textsc{BALanCe}}(x)^{\beta}
B
<50
\mathcal{D}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{train}}
\mathcal{D}_{\mathrm{val}}
\mathcal{D}_{\mathrm{test}}
\bar{\mathcal{D}}_{\mathrm{pool}}
\bar{\mathcal{D}}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{pool}}
B<50
B\geq 50
b<4
y_{1:b}
\Delta_{\mathrm{(Batch-)}\textsc{BALanCe}}
M=10,000
y_{1:b}
\Delta_{\mathrm{Batch-}\textsc{BALanCe}}
C
B
K
M
y_{1:b}
H
T
\mathcal{O}\left(|\mathcal{D}_{\mathrm{pool}}|(CK+\log B)\right)
\mathcal{O}\left(|\mathcal{D}_{\mathrm{pool}}|(CK+\log B)\right)
\mathcal{O}\left(|\mathcal{D}_{\mathrm{pool}}|(CK+\log B)\right)
\mathcal{O}\left(\left|\mathcal{D}_{\mathrm{pool}}\right|BMK\right)
\mathcal{O}(|\mathcal{D}_{\mathrm{pool}}|HB)
\mathcal{O}(|\mathcal{D}_{\mathrm{pool}}|HCB^{2})
\mathcal{O}\left(|\mathcal{D}_{\mathrm{pool}}|(C\cdot 2K+\log B)\right)
\mathcal{O}\left(\left|\mathcal{D}_{\mathrm{pool}}\right|BM\cdot 2K\right)
\mathcal{O}(|\mathcal{D}_{\mathrm{pool}}|C\cdot 2K+|\mathcal{C}|^{2}(C^{2}%
\cdot 2K+T))
B=1
B=3
B=10
K=100
\tau
\tau
\varepsilon/2
B=3
y_{1:b}
b=1,2,3
b\geq 4
B=1
K=100
B=1
K=100
B=3
K=100
B=3
K=100
B=10
K=100
B=10
K=100
B=10,K=100
B=10,K=100
B=10
K=100
B=10
K=100
B=5
K=10
B=5
K=10
B=5
K=10
B=5
K=10
B=5
K=10
B=5
K=10
y
x
y
x
B
\tau
\tau=\varepsilon/4
\tau\in[\varepsilon/8,\varepsilon/2]
\tau
\varepsilon/4
B=5
K=10
B
\tau=\varepsilon/8
\mathcal{C}
2B
\beta
\beta=1
\beta=1
B
\mathcal{C}
3B
\mathcal{D}_{\mathrm{pool}}
y
x
\mathbb{I}\left(y;\omega\mid x,\mathcal{D}_{\mathrm{train}}\right)=\mathbb{H}%
\left(y\mid x,\mathcal{D}_{\mathrm{train}}\right)-\mathbb{E}_{\mathrm{p}(%
\omega\mid\mathcal{D}_{\mathrm{train}})}\left[\mathbb{H}\left(y\mid x,\omega,%
\mathcal{D}_{\mathrm{train}}\right)\right]
\mathbb{H}
\Delta_{\mathrm{BatchBALD}}(x_{1:b}\mid\mathcal{D}_{\mathrm{train}})\triangleq%
\mathbb{I}(y_{1:b};\omega\mid x_{1:b},\mathcal{D}_{\mathrm{train}}).
\mathcal{H}=\{h_{1},\dotsc,h_{n}\}
d_{\mathrm{H}}(h_{i},h_{j})=\begin{cases}2^{1-i}-2^{1-j}&\text{if $i<j$,}\\
2^{1-j}-2^{1-i}&\text{o.w.}\end{cases}
i<j
d_{\mathrm{H}}(h_{i},h_{j})
h_{i}
h_{j}
i.i.d.
S\subseteq{}{\mathcal{H}}
h_{i}
\sigma
d_{\mathrm{H}}(h_{i},h_{j})
\log n
\sigma
h_{i},h_{j}
d_{\mathrm{H}}(h_{i},h_{j})>\sigma
h_{i}
h_{j}
h_{1},h_{2},\dots,h_{n}
\sigma
\log(1/\sigma)
\sigma
\frac{\log n}{\log({1/\sigma})}
n
\sigma=0
\textsc{EC}^{2}
\textsc{EC}^{2}
G=(\mathcal{H},\mathcal{E})
\mathcal{E}\triangleq\{\{h,h^{\prime}\}:r(h)\neq r(h^{\prime})\}
W:\mathcal{E}\rightarrow\mathbb{R}_{\geq 0}
W(\{h,h^{\prime}\})\triangleq\mathrm{p}(h)\cdot\mathrm{p}(h^{\prime})
x
y
y
\mathcal{E}(x,y)\triangleq\{\{h,h^{\prime}\}\in\mathcal{E}:\mathrm{p}(y\mid x,%
h)=0\vee\mathrm{p}(y\mid x,h^{\prime})=0\}
x
y
\textsc{EC}^{2}
\mathcal{D}_{\mathrm{train}}
f_{\mathrm{EC}^{2}}\left(\mathcal{D}_{\mathrm{train}}\right)\triangleq W\left(%
\bigcup_{\left(x,y\right)\in\mathcal{D}_{\mathrm{train}}}\mathcal{E}\left(x,y%
\right)\right)
\textsc{EC}^{2}
\textsc{EC}^{2}
\Delta_{\mathrm{EC}^{2}}\left(x\mid\mathcal{D}_{\mathrm{train}}\right)%
\triangleq\mathbb{E}_{y}\left[f\left(\mathcal{D}_{\mathrm{train}}\cup\left\{%
\left(x,y\right)\right\}\right)-f(\mathcal{D}_{\mathrm{train}})\mid\mathcal{D}%
_{\mathrm{train}}\right].
(x,y)
\lambda_{h,y}\triangleq\frac{\mathrm{p}(y\mid h,x)}{\max_{y^{\prime}}\mathrm{p%
}(y^{\prime}\mid h,x)}
\mathcal{D}_{\mathrm{train}}
y
x
\delta(x,y\mid\mathcal{D}_{\mathrm{train}})\triangleq\sum_{\{h,h^{\prime}\}\in%
\mathcal{E}}\mathrm{p}(h,\mathcal{D}_{\mathrm{train}})\mathrm{p}(h^{\prime},%
\mathcal{D}_{\mathrm{train}})\cdot(1-\lambda_{h,y}\lambda_{h^{\prime},y})
\mathcal{E}=\{\{h,h^{\prime}\}:r(h)\neq r(h^{\prime})\}
\delta
x
y
\nu(x,y\mid\mathcal{D}_{\mathrm{train}})\triangleq\sum_{\{h,h^{\prime}\}\in%
\mathcal{E}}\mathrm{p}(h,\mathcal{D}_{\mathrm{train}})\mathrm{p}(h^{\prime},%
\mathcal{D}_{\mathrm{train}})\cdot(1-\max_{h}\lambda^{2}_{h,y})
\Delta_{\textsc{ECED}}(x\mid\mathcal{D}_{\mathrm{train}})\triangleq\mathbb{E}_%
{y}\left[\delta(x,y\mid\mathcal{D}_{\mathrm{train}})-\nu(x,y\mid\mathcal{D}_{%
\mathrm{train}})\right].
\Delta_{\mathrm{ECED}}(x\mid\mathcal{D}_{\mathrm{train}})\triangleq\mathbb{E}_%
{y}\left[\sum_{\left\{\omega,\omega^{\prime}\right\}\in\mathcal{E}}W_{\omega,%
\omega^{\prime}}\left(1-\lambda_{\omega,y}\lambda_{\omega^{\prime},y}-\left(1-%
\max_{\omega}\lambda_{\omega,y}^{2}\right)\right)\right],
\mathcal{E}
\lambda_{\omega,y}=\frac{\mathrm{p}(y\mid\omega)}{\max_{y^{\prime}}\mathrm{p}(%
y^{\prime}\mid\omega)}
W_{\omega,\omega^{\prime}}
\{\omega,\omega^{\prime}\}
y
x
W_{\omega,\omega^{\prime}}=W_{\omega,\omega^{\prime}}\cdot\mathrm{p}(y\mid%
\omega)\mathrm{p}(y\mid\omega^{\prime})
1-\max_{\omega}\lambda_{\omega,y}^{2}
\{\omega,\omega^{\prime}\}\in\mathcal{E}
\epsilon
\{\omega,\omega^{\prime}\}
\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})
\{\omega,\omega^{\prime}\}\in\hat{\mathcal{E}}
\begin{split}&\Delta_{\mathrm{ECED}}(x\mid\mathcal{D}_{\mathrm{train}})\\
\approx&\mathbb{E}_{y}\left[\sum_{\left\{\omega,\omega^{\prime}\right\}\in%
\mathcal{E}}W_{\omega,\omega^{\prime}}\left(1-\lambda_{\omega,y}\lambda_{%
\omega^{\prime},y}\right)\right]\\
\approx&\mathbb{E}_{y}\left[\mathbb{E}_{\omega,\omega^{\prime}\sim\mathrm{p}(%
\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}(\omega,%
\omega^{\prime})>\tau}\cdot\frac{W_{\omega,\omega^{\prime}}}{\mathrm{p}(\omega%
\mid\mathcal{D_{\mathrm{train}}})\mathrm{p}(\omega^{\prime}\mid\mathcal{D_{%
\mathrm{train}}})}\cdot\left(1-\lambda_{\omega,y}\lambda_{\omega^{\prime},y}%
\right)\right]\\
\propto&\mathbb{E}_{y}\left[\mathbb{E}_{\omega,\omega^{\prime}\sim\mathrm{p}(%
\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}(\omega,%
\omega^{\prime})>\tau}\cdot\left(1-\lambda_{\omega,y}\lambda_{\omega^{\prime},%
y}\right)\right].\end{split}
\Delta_{\textsc{BALanCe}}(x\mid\mathcal{D}_{\mathrm{train}})
\Delta_{\textsc{BALanCe}}(x\mid\mathcal{D}_{\mathrm{train}})\triangleq\mathbb{%
E}_{y}\left[\mathbb{E}_{\omega,\omega^{\prime}\sim\mathrm{p}(\omega\mid%
\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}(\omega,\omega^{%
\prime})>\tau}\cdot\left(1-\lambda_{\omega,y}\lambda_{\omega^{\prime},y}\right%
)\right].
K
\Delta_{\textsc{BALanCe}}(x\mid\mathcal{D}_{\mathrm{train}})
\begin{split}&\Delta_{\textsc{BALanCe}}(x\mid\mathcal{D}_{\mathrm{train}})\\
=&\mathbb{E}_{\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbb{E}_{%
\mathrm{p}(y\mid\omega)}\left[\mathbb{E}_{\omega,\omega^{\prime}\sim\mathrm{p}%
(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}(\omega,%
\omega^{\prime})>\tau}\left(1-\lambda_{\omega,y}\lambda_{\omega^{\prime},y}%
\right)\right]\\
\approx&\sum_{\hat{y}}\left(\frac{1}{2K}\sum_{k=1}^{K}\mathrm{p}(\hat{y}\mid%
\hat{\omega}_{k})+\mathrm{p}(\hat{y}\mid\hat{\omega}_{k}^{\prime})\right)\left%
[\frac{1}{K}\sum_{k=1}^{K}\mathbbm{1}_{d_{\mathrm{H}}(\hat{\omega}_{k},\hat{%
\omega}_{k}^{\prime})>\tau}\left(1-\lambda_{\hat{\omega}_{k},\hat{y}}\lambda_{%
\hat{\omega}_{k}^{\prime},\hat{y}}\right)\right].\end{split}
x_{1:b}
\begin{split}\Delta_{\mathrm{Batch-}\textsc{BALanCe}}(x_{1:b}\mid\mathcal{D}_{%
\mathrm{train}})\triangleq\mathbb{E}_{y_{1:b}}\left[\mathbb{E}_{\omega,\omega^%
{\prime}\sim\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_%
{\mathrm{H}}(\omega,\omega^{\prime})>\tau}\cdot\left(1-\lambda_{\omega,y_{1:b}%
}\lambda_{\omega^{\prime},y_{1:b}}\right)\right].\end{split}
\Delta_{\mathrm{Batch-}\textsc{BALanCe}}(x_{1:b}\mid\mathcal{D}_{\mathrm{train%
}})
K
x_{1:b}
b
x_{1:b-1}
x_{b}
\begin{split}&\Delta_{\mathrm{Batch-}\textsc{BALanCe}}(x_{1:b}\mid\mathcal{D}_%
{\mathrm{train}})\\
=&\mathbb{E}_{\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbb{E}_{%
\mathrm{p}(y_{1:b}\mid\omega)}\left[\mathbb{E}_{\omega,\omega^{\prime}\sim%
\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}%
(\omega,\omega^{\prime})>\tau}\left(1-\lambda_{\omega,y_{1:b}}\lambda_{\omega^%
{\prime},y_{1:b}}\right)\right]\\
\approx&\sum_{\hat{y}_{1:b}}\left(\frac{1}{2K}\sum_{k=1}^{K}\mathrm{p}(\hat{y}%
_{1:b}\mid\hat{\omega}_{k})+\mathrm{p}(\hat{y}_{1:b}\mid\hat{\omega}_{k}^{%
\prime})\right)\left[\frac{1}{K}\sum_{k=1}^{K}\mathbbm{1}_{d_{\mathrm{H}}(\hat%
{\omega}_{k},\hat{\omega}_{k}^{\prime})>\tau}\left(1-\lambda_{\hat{\omega}_{k}%
,\hat{y}_{1:b}}\lambda_{\hat{\omega}_{k}^{\prime},\hat{y}_{1:b}}\right)\right]%
.\end{split}
b
y_{1:b}
M
y_{1:b}
\Delta_{\mathrm{Batch-}\textsc{BALanCe}}
\mathrm{p}(y_{1:b}\mid\omega)
\mathrm{p}(y_{1:b-1}\mid\omega)\cdot\mathrm{p}(y_{b}\mid\omega)
\begin{split}&\Delta_{\mathrm{Batch-}\textsc{BALanCe}}(x_{1:b}\mid\mathcal{D}_%
{\mathrm{train}})\\
\triangleq&\mathbb{E}_{y_{1:b}}\left[\mathbb{E}_{\mathrm{p}(\omega\mid\mathcal%
{D}_{\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}(\omega_{k},\omega_{k}^{%
\prime})>\tau}\left(1-\lambda_{\omega,y_{1:b}}\lambda_{\omega^{\prime},y_{1:b}%
}\right)\right]\\
=&\mathbb{E}_{\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbb{E}_{%
\mathrm{p}(y_{1:b}\mid\omega)}\left[\mathbb{E}_{\omega,\omega^{\prime}\sim%
\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}%
(\omega_{k},\omega_{k}^{\prime})>\tau}\left(1-\lambda_{\omega,y_{1:b}}\lambda_%
{\omega^{\prime},y_{1:b}}\right)\right]\\
=&\mathbb{E}_{\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbb{E}_{%
\mathrm{p}(y_{1:b-1}\mid\omega)}\mathbb{E}_{\mathrm{p}(y_{b}\mid\omega)}\left[%
\mathbb{E}_{\omega,\omega^{\prime}\sim\mathrm{p}(\omega\mid\mathcal{D}_{%
\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}(\omega_{k},\omega_{k}^{\prime})>%
\tau}\left(1-\lambda_{\omega,y_{1:b}}\lambda_{\omega^{\prime},y_{1:b}}\right)%
\right]\end{split}
M
y_{1:b-1}
\mathrm{p}(y_{1:b-1})
\mathrm{p}(y_{1:b-1})
\begin{split}&\Delta_{\mathrm{Batch-}\textsc{BALanCe}}(x_{1:b}\mid\mathcal{D}_%
{\mathrm{train}})\\
=&\mathbb{E}_{\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbb{E}_{%
\mathrm{p}(y_{1:b-1})}\frac{\mathrm{p}(y_{1:b-1}\mid\omega)}{\mathrm{p}(y_{1:b%
-1})}\mathbb{E}_{\mathrm{p}(y_{b}\mid\omega)}\left[\mathbb{E}_{\omega,\omega^{%
\prime}\sim\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{%
\mathrm{H}}(\omega,\omega^{\prime})>\tau}\left(1-\lambda_{\omega,y_{1:b}}%
\lambda_{\omega^{\prime},y_{1:b}}\right)\right]\\
=&\mathbb{E}_{\mathrm{p}(y_{1:b-1})}\mathbb{E}_{\mathrm{p}(\omega\mid\mathcal{%
D}_{\mathrm{train}})}\mathbb{E}_{\mathrm{p}(y_{b}\mid\omega)}\frac{\mathrm{p}(%
y_{1:b-1}\mid\omega)}{\mathrm{p}(y_{1:b-1})}\left[\mathbb{E}_{\omega,\omega^{%
\prime}\sim\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{%
\mathrm{H}}(\omega,\omega^{\prime})>\tau}\left(1-\lambda_{\omega,y_{1:b}}%
\lambda_{\omega^{\prime},y_{1:b}}\right)\right]\\
\approx&\frac{1}{M}\sum_{\hat{y}_{1:b-1}}^{M}\sum_{\hat{y}_{b}}\frac{\frac{1}{%
K}\sum^{K}_{k=1}\mathrm{p}(\hat{y}_{1:b-1}\mid\hat{\omega}_{k})\mathrm{p}(\hat%
{y}_{b}\mid\hat{\omega}_{k})+\mathrm{p}(\hat{y}_{1:b-1}\mid\hat{\omega}_{k}^{%
\prime})\mathrm{p}(\hat{y}_{b}\mid\hat{\omega}_{k}^{\prime})}{\mathrm{p}(\hat{%
y}_{1:b-1})}\cdot\\
&\qquad\qquad\qquad\left[\frac{1}{K}\sum_{k=1}^{K}\mathbbm{1}_{d_{\mathrm{H}}(%
\hat{\omega}_{k},\hat{\omega}_{k}^{\prime})>\tau}\left(1-\lambda_{\hat{\omega}%
_{k},\hat{y}_{1:b}}\lambda_{\hat{\omega}_{k}^{\prime},\hat{y}_{1:b}}\right)%
\right]\\
=&\left(\frac{1}{K}\mathbbm{1}_{d_{\mathrm{H}}(\hat{\omega}_{k},\hat{\omega}_{%
k}^{\prime})>\tau}\right)^{\top}\left(1-\frac{\hat{P}_{1:b-1}\otimes\hat{P}_{b%
}}{\hat{A}_{1:b}}\odot\frac{\hat{P}_{1:b-1}^{\prime}\otimes\hat{P}_{b}^{\prime%
}}{\hat{A}_{1:b}^{\prime}}\right)\left(\frac{1}{M}\frac{\hat{P}_{1:b-1}^{\top}%
\hat{P}_{b}+\hat{P}_{1:b-1}^{\prime\top}\hat{P}_{b}^{\prime}}{\mathbbm{1}^{%
\top}\left(\hat{P}_{1:b-1}+\hat{P}_{1:b-1}^{\prime}\right)}\right)^{\top}.\end%
{split}
\mathrm{p}(\hat{y}_{1:b-1}\mid\hat{\omega}_{k})
\mathrm{p}(\hat{y}_{1:b-1}\mid\hat{\omega}_{k}^{\prime})
M
\hat{P}_{1:b-1}
\hat{P}_{1:b-1}^{\prime}
\hat{P}_{1:b-1}
\hat{P}_{1:b-1}^{\prime}
K\times M
\odot
\otimes
\mathbbm{1}
K\times 1
\hat{P}_{1:b-1}^{\top}\hat{P}_{b}
\hat{P}_{1:b-1}^{\prime\top}\hat{P}_{b}^{\prime}
M\times C
1\times MC
\mathbbm{1}^{\top}\left(\hat{P}_{1:b-1}+\hat{P}_{1:b-1}^{\prime}\right)
\mathrm{p}(\hat{y}_{1:b-1}\mid\hat{\omega}_{k})
\hat{P}_{1:b-1}
\mathrm{p}(\hat{y}_{1:b-1}\mid\hat{\omega}_{k}^{\prime})
\hat{P}_{1:b-1}
b-1
\hat{P}_{1:b-1}
\hat{P}_{1:b-1}^{\prime}
K\times C^{b-1}
\mathrm{p}(\hat{y}_{b}\mid\hat{\omega}_{k})
\hat{P}_{b}
\mathrm{p}(\hat{y}_{b}\mid\hat{\omega}_{k}^{\prime})
\hat{P}_{b}^{\prime}
\hat{P}_{b}
\hat{P}_{b}^{\prime}
K\times C
\mathrm{p}(\hat{y}_{1:b})
\begin{split}\mathrm{p}(\hat{y}_{1:b})=&\frac{1}{2K}\sum_{k=1}^{K}\mathrm{p}(%
\hat{y}_{1:b}\mid\hat{\omega}_{k})+\mathrm{p}(\hat{y}_{1:b}\mid\hat{\omega}_{k%
}^{\prime})\\
=&\frac{1}{2K}\sum_{k=1}^{K}\mathrm{p}(\hat{y}_{1:b-1}\mid\hat{\omega}_{k})%
\mathrm{p}(\hat{y}_{b}\mid\hat{\omega}_{k})+\mathrm{p}(\hat{y}_{1:b-1}\mid\hat%
{\omega}_{k}^{\prime})\mathrm{p}(\hat{y}_{b}\mid\hat{\omega}_{k}^{\prime})\\
=&\frac{1}{2K}(\hat{P}_{1:b-1}^{\top}\hat{P}_{b}+\hat{P}_{1:b-1}^{\prime\top}%
\hat{P}_{b}^{\prime}).\end{split}
\hat{P}_{1:b-1}^{\top}\hat{P}_{b}
\hat{P}_{1:b-1}^{\prime\top}\hat{P}_{b}^{\prime}
1\times C^{b}
\max_{\hat{y}_{1:b-1}}\mathrm{p}(\hat{y}_{1:b-1}\mid\hat{\omega}_{k})
\hat{A}_{1:b-1}
\max_{\hat{y}^{\prime}_{1:b-1}}\mathrm{p}(\hat{y}^{\prime}_{1:b-1}\mid\hat{%
\omega}_{k}^{\prime})
\hat{A}^{\prime}_{1:b-1}
\hat{A}_{1:b-1}
\hat{A}^{\prime}_{1:b-1}
K\times 1
\lambda_{\hat{\omega},\hat{y}_{1:b}}
\begin{split}\hat{A}_{1:b}&=\hat{A}_{1:b-1}\odot\max_{\hat{y}_{b}}\hat{P}_{b};%
\\
\mathrm{p}(\hat{y}_{1:b}\mid\hat{\omega}_{k})&=\mathrm{p}(\hat{y}_{1:b-1}\mid%
\hat{\omega}_{k})\mathrm{p}(\hat{y}_{b}\mid\hat{\omega}_{k})=\hat{P}_{1:b-1}%
\otimes\hat{P}_{b};\\
\lambda_{\hat{\omega},\hat{y}_{1:b}}&=\frac{\mathrm{p}(\hat{y}_{1:b}\mid\hat{%
\omega}_{k})}{\max_{\hat{y}_{1:b}}\mathrm{p}(\hat{y}_{1:b}\mid\hat{\omega}_{k}%
)}=\frac{\hat{P}_{1:b-1}\otimes\hat{P}_{b}}{\hat{A}_{1:b}}.\end{split}
\odot
\otimes
\hat{A}_{1:b}^{\prime}
\mathrm{p}(\hat{y}_{1:b}\mid\hat{\omega}_{k}^{\prime})
\lambda_{\hat{\omega}^{\prime},\hat{y}_{1:b}}
\mathbbm{1}_{d_{\mathrm{H}}(\hat{\omega}_{k},\hat{\omega}_{k}^{\prime})>\tau}
K\times 1
\begin{split}&\Delta_{\mathrm{Batch-}\textsc{BALanCe}}(x_{1:b}\mid\mathcal{D}_%
{\mathrm{train}})\\
=&\mathbb{E}_{\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbb{E}_{%
\mathrm{p}(y_{1:b}\mid\omega)}\left[\mathbb{E}_{\omega,\omega^{\prime}\sim%
\mathrm{p}(\omega\mid\mathcal{D}_{\mathrm{train}})}\mathbbm{1}_{d_{\mathrm{H}}%
(\omega,\omega^{\prime})>\tau}\left(1-\lambda_{\omega,y_{1:b}}\lambda_{\omega^%
{\prime},y_{1:b}}\right)\right]\\
\approx&\sum_{\hat{y}_{1:b}}\left(\frac{1}{2K}\sum_{k=1}^{K}\mathrm{p}(\hat{y}%
_{1:b}\mid\hat{\omega}_{k})+\mathrm{p}(\hat{y}_{1:b}\mid\hat{\omega}_{k}^{%
\prime})\right)\left[\frac{1}{K}\sum_{k=1}^{K}\mathbbm{1}_{d_{\mathrm{H}}(\hat%
{\omega}_{k},\hat{\omega}_{k}^{\prime})>\tau}\left(1-\lambda_{\hat{\omega}_{k}%
,\hat{y}_{1:b}}\lambda_{\hat{\omega}_{k}^{\prime},\hat{y}_{1:b}}\right)\right]%
\\
=&\left(\frac{1}{K}\mathbbm{1}_{D(\hat{\omega}_{k},\hat{\omega}_{k}^{\prime})>%
\tau}\right)^{\top}\left(1-\frac{\hat{P}_{1:b-1}\otimes\hat{P}_{b}}{\hat{A}_{1%
:b}}\odot\frac{\hat{P}_{1:b-1}^{\prime}\otimes\hat{P}_{b}^{\prime}}{\hat{A}_{1%
:b}^{\prime}}\right)\left[\frac{1}{2K}(\hat{P}_{1:b-1}^{\top}\hat{P}_{b}+\hat{%
P}_{1:b-1}^{\prime\top}\hat{P}_{b}^{\prime})\right]^{\top}.\end{split}
B
B^{2}
|\mathcal{C}|=cB
c
\mathcal{D}_{\mathrm{val}}
\bar{\mathcal{D}}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{val}}
\bar{\mathcal{D}}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{val}}
\bar{\mathcal{D}}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{pool}}
\bar{\mathcal{D}}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{val}}
\bar{\mathcal{D}}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{val}}
\bar{\mathcal{D}}_{\mathrm{pool}}
\bar{\mathcal{D}}_{\mathrm{pool}}
B=1
K
K=50
K=100
K
K
\tau
\tau
K
\tau
K
\tau
\tau
\varepsilon
\tau=0.05,0.15,0.3
\tau=\varepsilon/2,\varepsilon/4,\varepsilon/8
\tau
\tau
\tau
\tau
K
\Delta_{\textsc{BALanCe}}
K
\Delta_{\textsc{BALanCe}}
K
\Delta_{\textsc{BALanCe}}
K
\Delta_{\textsc{BALanCe}}
K
\bar{\mathcal{D}}_{\mathrm{pool}}
\tau
\varepsilon/4
y
x
y
x
\bar{\mathcal{D}}_{\mathrm{pool}}
y
x
y
x
\bar{\mathcal{D}}_{\mathrm{pool}}
\mathcal{D}_{\mathrm{val}}
B=5,000
\tau=\varepsilon/4
k
K
2K
\bar{\mathcal{D}}_{\mathrm{pool}}
\tau
\tau
\geq\frac{\tau}{2}
K
K
0.887\pm 0.017
0.883\pm 0.012
0.881\pm 0.013
0.895\pm 0.009
0.917\pm 0.005
0.892\pm 0.023
0.883\pm 0.025
0.881\pm 0.014
0.926\pm 0.008
0.923\pm 0.008
0.929\pm 0.004
0.927\pm 0.010
\pm
\pm
K
B=5,000
