r^{1}
r^{2}
r^{2}
r^{1}
r^{2}
r^{1}
r^{1}
r^{2}
r^{2}
r^{1}
r^{2}
r^{1}
r^{1}
r^{2}
r^{2}
r^{1}
r^{2}
q_{i}
a_{i}
N
(r_{i},p_{i})
q_{i}
\tilde{q}_{i,f}
r^{n}_{i}
\tilde{p}^{n}_{i,f}
z
\tilde{z}
z
\tilde{z}
t
\textbf{{M}}_{\textbf{SFT}}
z
\tilde{z}
\textbf{{M}}_{\textbf{SFT}}
\textbf{{M}}_{\textbf{CREST}}
q_{i}
a_{i}
N
(r_{i},p_{i})
q_{i}
\tilde{q}_{i,f}
r^{n}_{i}
\tilde{p}^{n}_{i,f}
z
\tilde{z}
z
\tilde{z}
t
\textbf{{M}}_{\textbf{SFT}}
z
\tilde{z}
\textbf{{M}}_{\textbf{SFT}}
\textbf{{M}}_{\textbf{CREST}}
q
a
\mathcal{D}=\{(q_{i},a_{i})\}^{D}_{i=1}
F
q
r
p
r
p
N
r^{n}_{i}
q_{i}
p^{n}_{i}
n\in[1,N]
p^{n}_{i}
a_{i}
z^{n}_{i}
r^{n}_{i}
\tilde{q}_{i,f}
q_{i}
r^{n}_{i}
\tilde{z}^{n}_{i}
r^{n}_{i}
\tilde{q}_{i,f}
\textbf{{M}}_{\textbf{SFT}}
\textbf{{M}}_{\textbf{SFT}}
\textbf{{M}}_{\textbf{CREST}}
q_{i}
N
r^{n}_{i}
r^{n}_{i}\leftarrow\textbf{{M}}(q_{i})
r^{n}_{i}
n^{\text{th}}
i^{\text{th}}
p^{n}_{i}
q_{i}
r^{n}_{i}
p^{n}_{i}\leftarrow\textbf{{M}}(q_{i},r^{n}_{i})
a_{i}
q_{i}
p^{n}_{i}
r^{n}_{i}
F
q_{i}
z^{n}_{i}
p^{n}_{i}
a_{i}
z^{n}_{i}=\mathbf{1}(p^{n}_{i}=a_{i})
F
\{(\tilde{q}_{i,1},\tilde{a}_{i,1}),...,(\tilde{q}_{i,F},\tilde{a}_{i,F})\}
q_{i}
\tilde{a}_{i,f}
f^{\text{th}}
q_{i}
F
\tilde{p}^{n}_{i,f}\leftarrow\textbf{{M}}(\tilde{q}_{i,f},r^{n}_{i})
\tilde{q}_{i,f}
f^{\text{th}}
q_{i}
\tilde{z}
\tilde{z}^{n}_{i}=\sum_{f=1}^{F}\mathbf{1}(\tilde{p}^{n}_{i,f}=\tilde{a}_{i,f})
\mathcal{D}
z
\tilde{z}
\textbf{{M}}_{\textbf{SFT}}
q_{i}
q_{i}
F
z^{n}_{i}=1
\tilde{z}^{n}_{i}=F
t
t\in[0,F]
\mathcal{D_{\text{SFT}}}
\displaystyle\mathcal{D_{\text{SFT}}}=\{q_{i},r^{n}_{i},a_{i}|
\displaystyle\mathcal{D_{\text{SFT}}}=
\displaystyle\{q_{i},r^{n}_{i},a_{i}|
\displaystyle(n,i)\in\{(n,i)|z^{n}_{i}=1,\tilde{z}^{n}_{i}\geq F-t\}\}
\displaystyle(n,i)\in\{(n,i)|z^{n}_{i}=1,\tilde{z}^{n}_{i}\geq F-t\}\}
r
a
\textbf{{M}}_{\textbf{SFT}}
\textbf{{M}}_{\textbf{SFT}}
P_{z}
P_{\tilde{z}}
z
\tilde{z}
r^{w}
r^{l}
q
(r^{w},p^{w})
(r^{l},p^{l}
P_{\textit{total}}
P_{z}
P_{\tilde{z}}
\lambda
\lambda\in[0,1]
P_{\tilde{z}}
P_{\textit{total}}
\lambda
\textbf{{M}}_{\textbf{SFT}}
P_{\textit{total}}
\textbf{{M}}_{\textbf{CREST}}
P_{\textit{total}}
\displaystyle\mathcal{L_{\text{DPO}}}=-\mathbb{E}_{(r^{w}_{i},p^{w}_{i},r^{l}_%
{i},p^{l}_{i},q_{i})\sim P_{\textit{total}}}
\displaystyle\mathcal{L_{\text{DPO}}}=-\mathbb{E}_{(r^{w}_{i},p^{w}_{i},r^{l}_%
{i},p^{l}_{i},q_{i})\sim P_{\textit{total}}}
\displaystyle\Big{[}\log\sigma\Big{(}{\hat{r}_{\theta}(q_{i},r^{w}_{i},p^{w}_{%
i})}-\hat{r}_{\theta}(q_{i},r^{l}_{i},p^{l}_{i})\Big{)}\Big{]}
\displaystyle\Big{[}\log\sigma\Big{(}{\hat{r}_{\theta}(q_{i},r^{w}_{i},p^{w}_{%
i})}-\hat{r}_{\theta}(q_{i},r^{l}_{i},p^{l}_{i})\Big{)}\Big{]}
\displaystyle\hat{r}_{\theta}(q,r,p)=\beta\log{\frac{\pi_{\theta}(r,p|q)}{\pi_%
{\textit{ref}}(r,p|q)}}
\displaystyle\hat{r}_{\theta}(q,r,p)=\beta\log{\frac{\pi_{\theta}(r,p|q)}{\pi_%
{\textit{ref}}(r,p|q)}}
\pi_{\theta}(r,p|q)
\pi_{\textit{ref}}(r,p|q)
r
p
q
\theta
\pi_{\textit{ref}}
\pi_{\theta}
\pi_{\textit{ref}}
\textbf{{M}}_{\textbf{SFT}}
\pi_{\textit{ref}}
\beta
M_{\text{SFT}}
M_{\text{CREST}}
\text{Fine-tune (Label)}_{\text{CREST}}
T
TopP
N
5e-6
5e-3
\beta
5e-7
5e-5
\textbf{{M}}_{\textbf{SFT}}
\textit{M}_{\text{SFT}}
\textit{M}_{\text{CREST}}
\text{Fine-tune (Label)}_{\text{CREST}}
\textbf{{M}}_{\textbf{SFT}}
P_{\textit{total}}
\textbf{{M}}_{\textbf{SFT}}
\textbf{{M}}_{\textbf{CREST}}
\text{Fine-tune (Label)}_{\text{CREST}}
\textbf{{M}}_{\textbf{CREST}}
\textbf{{M}}_{\textbf{SFT}}
\tilde{z}
\textbf{{M}}_{\textbf{SFT}}
\tilde{z}
\textbf{{M}}_{\textbf{SFT}}
\textbf{{M}}_{\textbf{CREST}}
\text{Fine-tune (Label)}_{\text{CREST}}
\tilde{z}
z=1
z=0
z=0
\tilde{z}=3
z=0
\tilde{z}
z=1
z
\tilde{z}
\tilde{z}
\tilde{z}
z=1
z=0
z=0
\tilde{z}=3
z=0
\tilde{z}
z=1
z
\tilde{z}
\tilde{z}
\textbf{{M}}_{\textbf{SFT}}
t
t
t
\textbf{{M}}_{\textbf{SFT}}
t
t
t
z
\tilde{z}
t
\lambda
P_{\tilde{z}}
\textbf{{M}}_{\textbf{SFT}}
P_{z}
\textbf{{M}}_{\textbf{SFT /w }\boldsymbol{P_{z}}}
\textbf{{M}}_{\textbf{CREST}}
z=0
(z=1)
z
\tilde{z}
\tilde{z}
t
t
t
t
t=2
t
t
t=0
t=3
\tilde{z}=0
\lambda
P_{z}
P_{\tilde{z}}
\lambda
P_{\tilde{z}}
P_{z}
\lambda=0.6
P_{\tilde{z}}
\lambda
P_{z}
P_{\tilde{z}}
\lambda
P_{\tilde{z}}
P_{z}
\lambda=0.6
P_{\tilde{z}}
\lambda
P_{z}
P_{\tilde{z}}
\lambda
\lambda
\lambda=0.6
P_{\tilde{z}}
P_{z}
\textbf{{M}}_{\textbf{SFT}}
P_{\textit{total}}
P_{z}
\textbf{{M}}_{\textbf{CREST}}
M_{\text{SFT}}
M_{\text{SFT /w }P_{z}}
M_{\text{CREST}}
\textbf{{M}}_{\textbf{SFT}}
\tilde{z}
\tilde{z}=2
M_{\text{SFT}}
M_{\text{CREST}}
\text{Fine-tune (Label)}_{\text{CREST}}
\tilde{z}=5
z=1
\tilde{z}=4
z=1
\tilde{z}=3
z=1
\tilde{z}=2
z=1
z=0
z
\tilde{z}
z
\tilde{z}
z
\tilde{z}
z
z
\tilde{z}
\tilde{z}
\tilde{z}
\tilde{z}
\tilde{z}
\tilde{z}
z
\tilde{z}
\tilde{z}
z
\tilde{z}
\tilde{z}
z=0
\tilde{z}=2
\tilde{z}=4
\tilde{z}=5
P_{z}
P_{\tilde{z}}
z
\tilde{z}
P_{\text{total}}
P_{\tilde{z}}
P_{\text{total}}
\lambda
P_{z}
1-\lambda
P_{z}
P_{\tilde{z}}
P_{z}\leftarrow[]
z
P_{\tilde{z}}\leftarrow[]
\tilde{z}
q_{i}\in\mathcal{D}
(w,l)\in\{(w,l)|1\leq w\leq N,1\leq l\leq N\}
z^{w}_{i}=1
z^{l}_{i}=0
P_{z}\text{+=}\{q_{i},[r^{w}_{i},p^{w}_{i}],[r^{l}_{i},p^{l}_{i}]\}
z^{w}_{i}=z^{l}_{i}=1
\tilde{z}^{w}_{i}>\tilde{z}^{l}_{i}
P_{\tilde{z}}\text{+=}\{q_{i},[r^{w}_{i},p^{w}_{i}],[r^{l}_{i},p^{l}_{i}]\}
\textbf{{M}}_{\textbf{SFT}}
\lambda
q
\tilde{q}
