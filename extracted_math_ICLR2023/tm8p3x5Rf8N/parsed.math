224\times 224
s_{r}
s_{c}
(s_{r}w+s_{c}h-s_{r}s_{c})
(s_{r},s_{c})
X\in\mathcal{R}^{h\times w\times c}
\{P_{1},...,P_{N}\}
(s_{r},s_{c})
P_{i}\in\mathcal{R}^{(s_{r}w+s_{c}h-s_{r}s_{c})\times c},i\in\{1,2,...,N\}
N=\frac{h}{s_{r}}=\frac{w}{s_{c}}
X\in\mathcal{R}^{h\times w\times c}
X_{r}\in\mathcal{R}^{h\times w\times\frac{c}{2}}
X_{c}\in\mathcal{R}^{h\times w\times\frac{c}{2}}
\displaystyle X_{r}=[X_{r}^{1},...,X_{r}^{N_{r}}],X_{c}=[X_{c}^{1},...,X_{c}^{%
N_{c}}],
\displaystyle X_{r}=[X_{r}^{1},...,X_{r}^{N_{r}}],X_{c}=[X_{c}^{1},...,X_{c}^{%
N_{c}}],
N_{r}=h/s_{r}
N_{c}=w/s_{c}
X_{r}^{i}\in\mathcal{R}^{s_{r}\times w\times c}
s_{r}
X_{c}^{j}\in\mathcal{R}^{h\times s_{c}\times c}
s_{c}
\phi_{Q}
\phi_{K}
\phi_{V}
\displaystyle Y_{r}^{i}={\rm MSA}(\phi_{Q}(X_{r}^{i}),\phi_{K}(X_{r}^{i}),\phi%
_{V}(X_{r}^{i})),
\displaystyle Y_{r}^{i}={\rm MSA}(\phi_{Q}(X_{r}^{i}),\phi_{K}(X_{r}^{i}),\phi%
_{V}(X_{r}^{i})),
\displaystyle Y_{c}^{i}={\rm MSA}(\phi_{Q}(X_{c}^{i}),\phi_{K}(X_{c}^{i}),\phi%
_{V}(X_{c}^{i})),
\displaystyle Y_{c}^{i}={\rm MSA}(\phi_{Q}(X_{c}^{i}),\phi_{K}(X_{c}^{i}),\phi%
_{V}(X_{c}^{i})),
i\in\{1,2,...,N\}
Y\in\mathcal{R}^{h\times w\times c}
\displaystyle Y={\rm Concat}(Y_{r},Y_{c}),
\displaystyle Y={\rm Concat}(Y_{r},Y_{c}),
Y_{r}=[Y_{r}^{1},...,Y_{r}^{N_{r}}]
Y_{c}=[Y_{c}^{1},...,Y_{c}^{N_{c}}]
h
s_{r}
w
s_{c}
\frac{h}{s_{r}}=\frac{w}{s_{c}}
h\times w\times c
(s_{r},s_{c})
\mathcal{O}_{\text{Global}}=4hwc^{2}+2c(hw)^{2},
\mathcal{O}_{\text{Pale}}=4hwc^{2}+hwc(s_{c}h+s_{r}w+27)<<\mathcal{O}_{\text{%
Global}},
2hw>>(s_{c}h+s_{r}w+27)
l
\displaystyle\tilde{X}^{l}=X^{l-1}+\text{CPE}({X^{l-1}}),
\displaystyle\tilde{X}^{l}=X^{l-1}+\text{CPE}({X^{l-1}}),
\displaystyle\hat{X}^{l}=\tilde{X}^{l}+\text{PS-Attention}\Big{(}\text{LN}(%
\tilde{X}^{l})\Big{)},
\displaystyle\hat{X}^{l}=\tilde{X}^{l}+\text{PS-Attention}\Big{(}\text{LN}(%
\tilde{X}^{l})\Big{)},
\displaystyle X^{l}=\hat{X}^{l}+\text{MLP\Big{(}LN}(\hat{X}^{l})\Big{)},
\displaystyle X^{l}=\hat{X}^{l}+\text{MLP\Big{(}LN}(\hat{X}^{l})\Big{)},
\cdot
7\times 7
3\times 3
i
P_{i}
C_{i}
S_{i}
H_{i}
R_{i}
H_{i}
C_{i}
[2,2,16,2]
s_{r}=s_{c}=S_{i}=7
R_{i}=4
P_{1}=4
C_{1}=64
P_{1}=4
C_{1}=96
P_{1}=4
C_{1}=128
\begin{bmatrix}S_{1}=7\\
H_{1}=2\\
R_{1}=4\end{bmatrix}\times 2
\begin{bmatrix}S_{1}=7\\
H_{1}=2\\
R_{1}=4\end{bmatrix}\times 2
\begin{bmatrix}S_{1}=7\\
H_{1}=4\\
R_{1}=4\end{bmatrix}\times 2
P_{2}=2
C_{2}=128
P_{2}=2
C_{2}=192
P_{2}=2
C_{2}=256
\begin{bmatrix}S_{2}=7\\
H_{2}=4\\
R_{2}=4\end{bmatrix}\times 2
\begin{bmatrix}S_{2}=7\\
H_{2}=4\\
R_{2}=4\end{bmatrix}\times 2
\begin{bmatrix}S_{2}=7\\
H_{2}=8\\
R_{2}=4\end{bmatrix}\times 2
P_{3}=2
C_{3}=256
P_{3}=2
C_{3}=384
P_{3}=2
C_{3}=512
\begin{bmatrix}S_{3}=7\\
H_{3}=8\\
R_{3}=4\end{bmatrix}\times 16
\begin{bmatrix}S_{3}=7\\
H_{3}=8\\
R_{3}=4\end{bmatrix}\times 16
\begin{bmatrix}S_{3}=7\\
H_{3}=16\\
R_{3}=4\end{bmatrix}\times 16
P_{4}=2
C_{4}=512
P_{4}=2
C_{4}=768
P_{4}=2
C_{4}=1024
\begin{bmatrix}S_{4}=7\\
H_{4}=16\\
R_{4}=4\end{bmatrix}\times 2
\begin{bmatrix}S_{4}=7\\
H_{4}=16\\
R_{4}=4\end{bmatrix}\times 2
\begin{bmatrix}S_{4}=7\\
H_{4}=32\\
R_{4}=4\end{bmatrix}\times 2
224\times 224
384\times 384
{\star}
224\times 224
384\times 384
{\star}
{}^{\text{box}}
{}_{50}^{\text{box}}
{}_{75}^{\text{box}}
{}^{\text{mask}}
{}_{50}^{\text{mask}}
{}_{75}^{\text{mask}}
224\times 224
224\times 224
512\times 2048
224\times 224
512\times 2048
\{S_{1},S_{2},S_{3},S_{4}\}
S_{i}=7,i\in\{1,2,3,4\}
{}^{\text{box}}
{}^{\text{mask}}
{}^{\text{box}}
{}^{\text{mask}}
224\times 224
256\times 256
224\times 224
1280\times 800
{}^{\text{box}}
{}^{\text{mask}}
{}^{\text{box}}
{}^{\text{mask}}
{}^{\text{box}}
{}^{\text{mask}}
h\times w\times c
X\in\mathcal{R}^{h\times w\times c}
Q\in\mathcal{R}^{h\times w\times c}
K\in\mathcal{R}^{h\times w\times c}
V\in\mathcal{R}^{h\times w\times c}
Q
K
V
\displaystyle\mathcal{O}_{\text{Global}}^{\text{qkv}}=3hwc^{2}.
\displaystyle\mathcal{O}_{\text{Global}}^{\text{qkv}}=3hwc^{2}.
A
\text{softmax}(QK^{T}/\sqrt{d})
A
V
\displaystyle\mathcal{O}_{\text{Global}}^{\text{attn}}=2c(hw)^{2}.
\displaystyle\mathcal{O}_{\text{Global}}^{\text{attn}}=2c(hw)^{2}.
\displaystyle\mathcal{O}_{\text{Global}}^{\text{proj}}=hwc^{2}.
\displaystyle\mathcal{O}_{\text{Global}}^{\text{proj}}=hwc^{2}.
\displaystyle\mathcal{O}_{\text{Global}}=\mathcal{O}_{\text{Global}}^{\text{%
qkv}}+\mathcal{O}_{\text{Global}}^{\text{attn}}+\mathcal{O}_{\text{Global}}^{%
\text{proj}}
\displaystyle\mathcal{O}_{\text{Global}}=\mathcal{O}_{\text{Global}}^{\text{%
qkv}}+\mathcal{O}_{\text{Global}}^{\text{attn}}+\mathcal{O}_{\text{Global}}^{%
\text{proj}}
\displaystyle\quad\quad\ \ \ =4hwc^{2}+2c(hw)^{2}.
\displaystyle\quad\quad\ \ \ =4hwc^{2}+2c(hw)^{2}.
h\times w\times c
(s_{r},s_{c})
3\times 3
Q\in\mathcal{R}^{h\times w\times c}
K\in\mathcal{R}^{h\times w\times c}
V\in\mathcal{R}^{h\times w\times c}
\displaystyle\mathcal{O}_{\text{Pale}}^{\text{qkv}}=3(9hwc+hwc^{2})=27hwc+3hwc%
^{2}.
\displaystyle\mathcal{O}_{\text{Pale}}^{\text{qkv}}=3(9hwc+hwc^{2})=27hwc+3hwc%
^{2}.
\displaystyle\mathcal{O}_{\text{Pale}}^{\text{row}}=hw^{2}cs_{r},
\displaystyle\mathcal{O}_{\text{Pale}}^{\text{row}}=hw^{2}cs_{r},
\displaystyle\mathcal{O}_{\text{Pale}}^{\text{column}}=h^{2}wcs_{c}.
\displaystyle\mathcal{O}_{\text{Pale}}^{\text{column}}=h^{2}wcs_{c}.
\displaystyle\mathcal{O}_{\text{Pale}}^{\text{proj}}=hwc^{2}.
\displaystyle\mathcal{O}_{\text{Pale}}^{\text{proj}}=hwc^{2}.
\displaystyle\mathcal{O}_{\text{Pale}}=\mathcal{O}_{\text{Pale}}^{\text{qkv}}+%
\mathcal{O}_{\text{Pale}}^{\text{row}}+\mathcal{O}_{\text{Pale}}^{\text{column%
}}+\mathcal{O}_{\text{Pale}}^{\text{proj}}
\displaystyle\mathcal{O}_{\text{Pale}}=\mathcal{O}_{\text{Pale}}^{\text{qkv}}+%
\mathcal{O}_{\text{Pale}}^{\text{row}}+\mathcal{O}_{\text{Pale}}^{\text{column%
}}+\mathcal{O}_{\text{Pale}}^{\text{proj}}
\displaystyle\quad\quad=4hwc^{2}+hwc(s_{c}h+s_{r}w+27).
\displaystyle\quad\quad=4hwc^{2}+hwc(s_{c}h+s_{r}w+27).
2hw>>(s_{c}h+s_{r}w+27)
