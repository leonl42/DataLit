\displaystyle\operatorname{AdapterLayer}(\mathbf{x})=\mathbf{x}+\mathbf{W}_{1}%
(\phi(\mathbf{W}_{2}\mathbf{x}))
\displaystyle\operatorname{AdapterLayer}(\mathbf{x})=\mathbf{x}+\mathbf{W}_{1}%
(\phi(\mathbf{W}_{2}\mathbf{x}))
\mathbf{x}\in\mathbb{R}^{d}
\mathbf{W}_{1}\in\mathbb{R}^{d\times d^{\prime}}
\mathbf{W}_{2}\in\mathbb{R}^{d^{\prime}\times d}
d^{\prime}<d
\phi
K
\mathbf{c}
\mathbf{r}
\log\sum_{k}P(\mathbf{r},z=k|\mathbf{c};\bm{\theta})
\bm{\theta}
z\in\{1,\cdots,K\}
z
\displaystyle Q_{k}(\mathbf{c},\mathbf{r})=P(z=k|\mathbf{c},\mathbf{r};\bm{%
\theta})=\frac{P(\mathbf{r}|z=k,\mathbf{c};\bm{\theta})P(z=k|\mathbf{c};\bm{%
\theta})}{\sum_{k^{\prime}=1}^{K}P(\mathbf{r}|z=k^{\prime},\mathbf{c};\bm{%
\theta})P(z=k^{\prime}|\mathbf{c};\bm{\theta})}
\displaystyle Q_{k}(\mathbf{c},\mathbf{r})
\displaystyle=P(z=k|\mathbf{c},\mathbf{r};\bm{\theta})=\frac{P(\mathbf{r}|z=k,%
\mathbf{c};\bm{\theta})P(z=k|\mathbf{c};\bm{\theta})}{\sum_{k^{\prime}=1}^{K}P%
(\mathbf{r}|z=k^{\prime},\mathbf{c};\bm{\theta})P(z=k^{\prime}|\mathbf{c};\bm{%
\theta})}
\bm{\theta}
\displaystyle\mathbb{E}_{z\sim Q_{k}(\mathbf{c},\mathbf{r})}[\log P(\mathbf{r}%
,z|\mathbf{c};\bm{\theta})]=\sum\nolimits_{k=1}^{K}Q_{k}(\mathbf{c},\mathbf{r}%
)\log P(\mathbf{r},z|\mathbf{c};\bm{\theta})
\displaystyle\mathbb{E}_{z\sim Q_{k}(\mathbf{c},\mathbf{r})}
\displaystyle[\log P(\mathbf{r},z|\mathbf{c};\bm{\theta})]=\sum\nolimits_{k=1}%
^{K}Q_{k}(\mathbf{c},\mathbf{r})\log P(\mathbf{r},z|\mathbf{c};\bm{\theta})
\mathbf{c}
P(z=k|\mathbf{c};\bm{\theta})=1/K
\displaystyle P(z=k|\mathbf{c},\mathbf{r};\bm{\theta})=\frac{P(\mathbf{r}|z=k,%
\mathbf{c};\bm{\theta})}{\sum_{k^{\prime}=1}^{K}P(\mathbf{r}|z=k^{\prime},%
\mathbf{c};\bm{\theta})}
\displaystyle P(z=k|\mathbf{c},\mathbf{r};\bm{\theta})
\displaystyle=\frac{P(\mathbf{r}|z=k,\mathbf{c};\bm{\theta})}{\sum_{k^{\prime}%
=1}^{K}P(\mathbf{r}|z=k^{\prime},\mathbf{c};\bm{\theta})}
\displaystyle k^{*}=\operatorname{argmax}_{k}P(z=k|\mathbf{c},\mathbf{r};\bm{%
\theta})
\displaystyle k^{*}=\operatorname{argmax}_{k}P(z=k|\mathbf{c},\mathbf{r};\bm{%
\theta})
\displaystyle\mathbb{E}_{z\sim Q_{k}(z|\mathbf{c},\mathbf{r};\bm{\theta})}[%
\log P(\mathbf{r},z|\mathbf{c};\bm{\theta})]\approx\log P(\mathbf{r},z=k^{*}|%
\mathbf{c};\bm{\theta})
\displaystyle\mathbb{E}_{z\sim Q_{k}(z|\mathbf{c},\mathbf{r};\bm{\theta})}[%
\log P(\mathbf{r},z|\mathbf{c};\bm{\theta})]\approx\log P(\mathbf{r},z=k^{*}|%
\mathbf{c};\bm{\theta})
\mathbf{A}\in\{0,1\}^{N\times K}
N
K
A_{nk}
n
k
\mathbf{C}\in\mathbb{R}^{N\times K}
C_{nk}=-Q_{k}(\mathbf{r}^{(n)},\mathbf{c}^{(n)})
\displaystyle\operatorname*{minimize}\nolimits_{\mathbf{A}}\quad\textstyle\sum%
_{k=1}^{K}\sum_{n=1}^{N}A_{nk}C_{nk}
\displaystyle\operatorname*{minimize}\nolimits_{\mathbf{A}}\quad
\displaystyle\textstyle\sum_{k=1}^{K}\sum_{n=1}^{N}A_{nk}C_{nk}
\displaystyle\operatorname*{subject\ to}\quad\textstyle\sum_{k=1}^{K}A_{nk}=1,%
\text{\quad for $n=1,\cdots,N$}
n=1,\cdots,N
\displaystyle\operatorname*{subject\ to}\quad
\displaystyle\textstyle\sum_{k=1}^{K}A_{nk}=1,\text{\quad for $n=1,\cdots,N$}
n=1,\cdots,N
\displaystyle\textstyle\sum_{n=1}^{N}A_{nk}=N/K,\text{\quad for $k=1,\cdots,K$}
k=1,\cdots,K
\displaystyle\textstyle\sum_{n=1}^{N}A_{nk}=N/K,\text{\quad for $k=1,\cdots,K$}
k=1,\cdots,K
\displaystyle\textstyle A_{nk}\in\{0,1\}
\displaystyle\textstyle A_{nk}\in\{0,1\}
\frac{N}{K}
N
K
O(N^{3})
\sum_{\textbf{c}}\sum_{\textbf{r}}P(z|\mathbf{r},\mathbf{c})P(\mathbf{r},%
\mathbf{c})=\sum_{\textbf{c}}P(z|\textbf{c})P(\textbf{c})=\sum_{\textbf{c}}(1/%
K)P(\textbf{c})=1/K
z=1,\cdots,K
1-\delta
\displaystyle\bigg{|}\frac{1}{|\mathcal{D}|}\sum_{(\mathbf{r},\mathbf{c})\in%
\mathcal{D}}Q(z|\mathbf{r},\mathbf{c})-\frac{1}{K}\bigg{|}\leq\sqrt{\frac{1}{2%
|\mathcal{D}|}\log\left(\frac{2K}{\delta}\right)}+\mathbb{E}_{\mathbf{c},%
\mathbf{r}}\bigg{[}\big{|}Q(z|\mathbf{c},\mathbf{r})-p(z|\mathbf{c},\mathbf{r}%
)\big{|}\bigg{]}
\displaystyle\bigg{|}\frac{1}{|\mathcal{D}|}\sum_{(\mathbf{r},\mathbf{c})\in%
\mathcal{D}}Q(z|\mathbf{r},\mathbf{c})-\frac{1}{K}\bigg{|}\leq\sqrt{\frac{1}{2%
|\mathcal{D}|}\log\left(\frac{2K}{\delta}\right)}+\mathbb{E}_{\mathbf{c},%
\mathbf{r}}\bigg{[}\big{|}Q(z|\mathbf{c},\mathbf{r})-p(z|\mathbf{c},\mathbf{r}%
)\big{|}\bigg{]}
z\in\{1,\cdots,K\}
Q(z|\mathbf{c},\mathbf{r})
\mathcal{D}
\sum_{(\mathbf{r},\mathbf{c})\in\mathcal{D}}Q(z|\mathbf{r},\mathbf{c})
n
n
n
n>2
n
n
n
k
\bm{e}_{k}
\bm{p}
\sum_{k}p_{k}\bm{e}_{k}
P(\mathbf{r}|\mathbf{c})=\sum_{k}P(z=k|\mathbf{c})P(\mathbf{r}|z=k,\mathbf{c})
P(z|\mathbf{c})
P(\mathbf{r}|z=k,\mathbf{c})
k
P(z=k|\mathbf{c})
\mathbf{c}
z
\mathbf{c}
\mathbf{c}
\mathbf{r}
Q(z|\mathbf{c},\mathbf{r})
\mathcal{D}
(\mathbf{c},\mathbf{r})
z
\epsilon>0
\displaystyle\Pr\bigg{(}\bigg{|}\frac{1}{|\mathcal{D}|}\sum_{(\mathbf{c},%
\mathbf{r})\in\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\mathbb{E}_{\mathbf{c},%
\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r})]\bigg{|}\geq\epsilon\bigg{)}\leq 2\exp%
\left(-2\epsilon^{2}|\mathcal{D}|\right)
\displaystyle\Pr\bigg{(}\bigg{|}\frac{1}{|\mathcal{D}|}\sum_{(\mathbf{c},%
\mathbf{r})\in\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\mathbb{E}_{\mathbf{c},%
\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r})]\bigg{|}\geq\epsilon\bigg{)}\leq 2\exp%
\left(-2\epsilon^{2}|\mathcal{D}|\right)
Q(z|\mathbf{c},\mathbf{r})
z
Q(z|\mathbf{c},\mathbf{r})
P(z|\mathbf{c},\mathbf{r})
\displaystyle\left|\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r%
})]-\frac{1}{K}\right|\leq\mathbb{E}_{\mathbf{c},\mathbf{r}}\bigg{[}\big{|}Q(z%
|\mathbf{c},\mathbf{r})-P(z|\mathbf{c},\mathbf{r})\big{|}\bigg{]}
\displaystyle\left|\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r%
})]-\frac{1}{K}\right|\leq\mathbb{E}_{\mathbf{c},\mathbf{r}}\bigg{[}\big{|}Q(z%
|\mathbf{c},\mathbf{r})-P(z|\mathbf{c},\mathbf{r})\big{|}\bigg{]}
\displaystyle\left|\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r%
})]-\frac{1}{K}\right|=\left|\sum_{\mathbf{c}}\sum_{\mathbf{r}}Q(z|\mathbf{c},%
\mathbf{r})P(\mathbf{c},\mathbf{r})-\frac{1}{K}\right|
\displaystyle\left|\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r%
})]-\frac{1}{K}\right|=
\displaystyle\left|\sum_{\mathbf{c}}\sum_{\mathbf{r}}Q(z|\mathbf{c},\mathbf{r}%
)P(\mathbf{c},\mathbf{r})-\frac{1}{K}\right|
\displaystyle=\left|\sum_{\mathbf{c}}\sum_{\mathbf{r}}Q(z|\mathbf{c},\mathbf{r%
})P(\mathbf{c},\mathbf{r})-\sum_{\mathbf{c}}\sum_{\mathbf{r}}P(z|\mathbf{c},%
\mathbf{r})P(\mathbf{c},\mathbf{r})\right|
\displaystyle=
\displaystyle\left|\sum_{\mathbf{c}}\sum_{\mathbf{r}}Q(z|\mathbf{c},\mathbf{r}%
)P(\mathbf{c},\mathbf{r})-\sum_{\mathbf{c}}\sum_{\mathbf{r}}P(z|\mathbf{c},%
\mathbf{r})P(\mathbf{c},\mathbf{r})\right|
\displaystyle=\left|\sum_{\mathbf{c}}\sum_{\mathbf{r}}P(\mathbf{c},\mathbf{r})%
\left(Q(z|\mathbf{c},\mathbf{r})-P(z|\mathbf{c},\mathbf{r})\right)\right|
\displaystyle=
\displaystyle\left|\sum_{\mathbf{c}}\sum_{\mathbf{r}}P(\mathbf{c},\mathbf{r})%
\left(Q(z|\mathbf{c},\mathbf{r})-P(z|\mathbf{c},\mathbf{r})\right)\right|
\displaystyle\leq\sum_{\mathbf{c}}\sum_{\mathbf{r}}P(\mathbf{c},\mathbf{r})%
\left|Q(z|\mathbf{c},\mathbf{r})-P(z|\mathbf{c},\mathbf{r})\right|
\displaystyle\leq
\displaystyle\sum_{\mathbf{c}}\sum_{\mathbf{r}}P(\mathbf{c},\mathbf{r})\left|Q%
(z|\mathbf{c},\mathbf{r})-P(z|\mathbf{c},\mathbf{r})\right|
\displaystyle=\mathbb{E}_{\mathbf{c},\mathbf{r}}\bigg{[}\big{|}Q(z|\mathbf{c},%
\mathbf{r})-P(z|\mathbf{c},\mathbf{r})\big{|}\bigg{]}
\displaystyle=
\displaystyle\mathbb{E}_{\mathbf{c},\mathbf{r}}\bigg{[}\big{|}Q(z|\mathbf{c},%
\mathbf{r})-P(z|\mathbf{c},\mathbf{r})\big{|}\bigg{]}
1/K
P(z,\mathbf{c},\mathbf{r})
\mathbf{c}
\mathbf{r}
Q(z|\mathbf{c},\mathbf{r})
P(z|\mathbf{c},\mathbf{r})
z
z
\displaystyle\Pr\bigg{(}\forall z\in[K]:\bigg{|}\frac{1}{|\mathcal{D}|}\sum_{(%
\mathbf{c},\mathbf{r})\in\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\mathbb{E}_{%
\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r})]\bigg{|}\geq\epsilon\bigg{)}%
\leq 2K\exp\left(-2\epsilon^{2}|\mathcal{D}|\right)
\displaystyle\Pr\bigg{(}\forall z\in[K]:\bigg{|}\frac{1}{|\mathcal{D}|}\sum_{(%
\mathbf{c},\mathbf{r})\in\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\mathbb{E}_{%
\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r})]\bigg{|}\geq\epsilon\bigg{)}%
\leq 2K\exp\left(-2\epsilon^{2}|\mathcal{D}|\right)
\epsilon
\delta=2K\exp\left(-2\epsilon^{2}|\mathcal{D}|\right)
\displaystyle\Pr\left(\forall z\in[K]:\bigg{|}\frac{1}{|\mathcal{D}|}\sum_{(%
\mathbf{c},\mathbf{r})\in\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\mathbb{E}_{%
\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r})]\bigg{|}\geq\sqrt{\frac{1}{2%
|\mathcal{D}|}\log\left(\frac{2K}{\delta}\right)}\right)\leq\delta
\displaystyle\Pr\left(\forall z\in[K]:\bigg{|}\frac{1}{|\mathcal{D}|}\sum_{(%
\mathbf{c},\mathbf{r})\in\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\mathbb{E}_{%
\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r})]\bigg{|}\geq\sqrt{\frac{1}{2%
|\mathcal{D}|}\log\left(\frac{2K}{\delta}\right)}\right)\leq\delta
1-\delta
\displaystyle\left|\frac{1}{|\mathcal{D}|}\sum_{(\mathbf{c},\mathbf{r})\in%
\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\frac{1}{K}\right|
\displaystyle\left|\frac{1}{|\mathcal{D}|}\sum_{(\mathbf{c},\mathbf{r})\in%
\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\frac{1}{K}\right|
\displaystyle\leq\left|\frac{1}{|\mathcal{D}|}\sum_{(\mathbf{r},\mathbf{c})\in%
\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|%
\mathbf{c},\mathbf{r})]\right|+\left|\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|%
\mathbf{c},\mathbf{r})]-\frac{1}{K}\right|
\displaystyle\leq
\displaystyle\left|\frac{1}{|\mathcal{D}|}\sum_{(\mathbf{r},\mathbf{c})\in%
\mathcal{D}}Q(z|\mathbf{c},\mathbf{r})-\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|%
\mathbf{c},\mathbf{r})]\right|+\left|\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|%
\mathbf{c},\mathbf{r})]-\frac{1}{K}\right|
1-\delta
1-\delta
1-\delta
\displaystyle\leq\sqrt{\frac{1}{2|\mathcal{D}|}\log\left(\frac{2K}{\delta}%
\right)}+\left|\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r})]-%
\frac{1}{K}\right|
\displaystyle\leq
\displaystyle\sqrt{\frac{1}{2|\mathcal{D}|}\log\left(\frac{2K}{\delta}\right)}%
+\left|\mathbb{E}_{\mathbf{c},\mathbf{r}}[Q(z|\mathbf{c},\mathbf{r})]-\frac{1}%
{K}\right|
\displaystyle\leq\sqrt{\frac{1}{2|\mathcal{D}|}\log\left(\frac{2K}{\delta}%
\right)}+\mathbb{E}_{\mathbf{c},\mathbf{r}}\bigg{[}\big{|}Q(z|\mathbf{c},%
\mathbf{r})-P(z|\mathbf{c},\mathbf{r})\big{|}\bigg{]}
\displaystyle\leq
\displaystyle\sqrt{\frac{1}{2|\mathcal{D}|}\log\left(\frac{2K}{\delta}\right)}%
+\mathbb{E}_{\mathbf{c},\mathbf{r}}\bigg{[}\big{|}Q(z|\mathbf{c},\mathbf{r})-P%
(z|\mathbf{c},\mathbf{r})\big{|}\bigg{]}
\bm{\beta}=(0.9,0.999)
p
<
<
p
p
