1-p
p
p
1
0
1
0
1
p
\mathcal{X}=\{\bm{x}_{1},\bm{x}_{2},\cdots\bm{x}_{T}\}
\mathcal{K}=\{k_{1},k_{2},\cdots k_{T}\}
\Theta\stackrel{{\scriptstyle\mathrm{def}}}{{=}}\{\bm{\mathrm{W}}^{(\ell)}\in%
\mathbb{R}^{D^{(\ell)}\times D^{(\ell-1)}},\bm{b}^{(\ell)}\in\mathbb{R}^{D^{(%
\ell)}}|\ell\in\{1,..,L\}\}
L
D^{(\ell)}
\ell
\bm{\mathrm{M}}\stackrel{{\scriptstyle\mathrm{def}}}{{=}}\{\bm{m}^{(\ell)}\in%
\{0,1\}^{D^{(\ell)}}|\ell\in\{0,..,L\}\}
\begin{split}\bm{h}^{(0)}(\bm{x}_{t};\bm{\mathrm{M}})&=\bm{m}^{(0)}\odot\bm{x}%
_{t}\;,\\
\bm{h}^{(\ell)}(\bm{x}_{t};\bm{\mathrm{M}})&=\bm{m}^{(\ell)}\odot\bm{a}^{(\ell%
)}\left(\bm{\mathrm{W}}^{(\ell)}\bm{h}^{(\ell-1)}(\bm{x}_{t};\bm{\mathrm{M}})+%
\bm{b}^{(\ell)}\right)\;,\\
p(k_{t}|\bm{x}_{t},\bm{\mathrm{M}})&=\frac{\exp\left({h}^{(L)}_{k_{t}}(\bm{x}_%
{t};\bm{\mathrm{M}})\right)}{\sum_{j}\exp\left(h^{(L)}_{j}(\bm{x}_{t};\bm{%
\mathrm{M}})\right)}\>,\end{split}
\odot
\bm{a}^{(\ell)}
\ell
h^{(L)}_{j}
j
\bm{h}^{(L)}
p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})=\prod_{\ell,u}(\pi^{(\ell)}_{u})^{m_{u}^{%
(\ell)}}(1-\pi^{(\ell)}_{u})^{1-m_{u}^{(\ell)}}
\bm{\mathrm{\Pi}}\stackrel{{\scriptstyle\mathrm{def}}}{{=}}\{\bm{\pi}^{(\ell)}%
\in[0,1]^{D^{(\ell)}}|\ell\in\{0,..,L\}\}
\pi^{(\ell)}_{u}=\pi^{(\ell)}_{u^{\prime}}
\ell
u
u^{\prime}
\log p(\mathcal{K}|\mathcal{X},\Theta,\bm{\mathrm{\Pi}})
\begin{split}&\log p(\mathcal{K}|\mathcal{X},\Theta,\bm{\mathrm{\Pi}})\\
&=\sum_{t}\log p(k_{t}|\bm{x}_{t},\Theta,\bm{\mathrm{\Pi}})\\
&=\sum_{t}\log\sum_{\bm{\mathrm{M}}\in\mathcal{M}}p(k_{t}|\bm{x}_{t},\bm{%
\mathrm{M}},\Theta)p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})\\
&\geq\sum_{t}\sum_{\bm{\mathrm{M}}\in\mathcal{M}}p(\bm{\mathrm{M}}|\bm{\mathrm%
{\Pi}})\log p(k_{t}|\bm{x}_{t},\bm{\mathrm{M}},\Theta)\;,\end{split}
\mathcal{M}
\bm{\mathrm{M}}
\bm{m}^{(\ell)}
\bm{\pi}^{(\ell)}
\begin{split}\tilde{\bm{h}}^{(0)}(\bm{x}_{t};\bm{\mathrm{\Pi}})&=\bm{\pi}^{(0)%
}\odot\bm{x}_{t},\\
\tilde{\bm{h}}^{(\ell)}(\bm{x}_{t};\bm{\mathrm{\Pi}})&=\bm{\pi}^{(\ell)}\odot%
\bm{a}^{(\ell)}\left(\bm{\mathrm{W}}^{(\ell)}\tilde{\bm{h}}^{(\ell-1)}(\bm{x}_%
{t};\bm{\mathrm{\Pi}})+\bm{b}^{(\ell)}\right).\end{split}
p(k|\bm{x},\bm{\mathrm{\Pi}},{\Theta})
\tilde{p}(k|\bm{x},\bm{\mathrm{\Pi}},{\Theta})
\pi^{(\ell)}_{u}
\log p(\mathcal{K},\bm{\mathrm{\Pi}}|\mathcal{X},\Theta)
0
1
\begin{split}&\log p(\mathcal{K},\bm{\mathrm{\Pi}}|\mathcal{X},\Theta)\\
&=\log p(\mathcal{K}|\bm{\mathrm{\Pi}},\mathcal{X},\Theta)+\log p(\bm{\mathrm{%
\Pi}})\\
&=\sum_{t}\log\sum_{\bm{\mathrm{M}}\in\mathcal{M}}p(k_{t}|\bm{x}_{t},\bm{%
\mathrm{M}},\Theta)p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})+\log p(\bm{\mathrm{\Pi%
}})\\
&\stackrel{{\scriptstyle\mathrm{def}}}{{=}}L(\Theta;\bm{\mathrm{\Pi}})+\log p(%
\bm{\mathrm{\Pi}})\;,\end{split}
p(\bm{\mathrm{\Pi}})
{\Theta}
{\Theta}
L
u
\ell
\begin{split}\frac{\partial L}{\partial\pi^{(\ell)}_{u}}&=\sum_{t}\sum_{\bm{%
\mathrm{M}}\in\mathcal{M}}p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})w_{t}(\bm{%
\mathrm{M}})\left(\frac{\partial}{\partial\pi^{(\ell)}_{u}}\log p(\bm{\mathrm{%
M}}|\bm{\mathrm{\Pi}})\right)\\
&=\sum_{t}\mathrm{E}_{p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})}\left[w_{t}(\bm{%
\mathrm{M}})\left(\frac{\partial}{\partial\pi^{(\ell)}_{u}}\log p(\bm{\mathrm{%
M}}|\bm{\mathrm{\Pi}})\right)\right],\end{split}
w
w_{t}(\bm{\mathrm{M}})=\frac{p(k_{t}|\bm{x}_{t},\bm{\mathrm{M}},\Theta)}{\sum_%
{\bm{\mathrm{M}}^{\prime}\in\mathcal{M}}p(k_{t}|\bm{x}_{t},\bm{\mathrm{M}}^{%
\prime},\Theta)p(\bm{\mathrm{M}}^{\prime}|\bm{\mathrm{\Pi}})}.
w_{t}(\bm{\mathrm{M}})\approx\frac{p(k_{t}|\bm{x}_{t},\bm{\mathrm{M}},\Theta)}%
{\tilde{p}(k_{t}|\bm{x}_{t},\bm{\mathrm{\Pi}},{\Theta})}\stackrel{{%
\scriptstyle\mathrm{def}}}{{=}}\tilde{w}_{t}(\bm{\mathrm{M}})\;.
\log p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})
\begin{split}\frac{\partial}{\partial\pi^{(\ell)}_{u}}\log p(\bm{\mathrm{M}}|%
\bm{\mathrm{\Pi}})&=\frac{m^{(\ell)}_{u}}{\pi^{(\ell)}_{u}}-\frac{1-m^{(\ell)}%
_{u}}{1-\pi^{(\ell)}_{u}}\;.\end{split}
L(\Theta;\bm{\mathrm{\Pi}})
\mathrm{E}_{p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})}\left[\frac{\partial}{%
\partial\pi^{(\ell)}_{u}}\log p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})\right]=0\;,
\frac{\partial L}{\partial\pi^{(\ell)}_{u}}=\sum_{t}\mathrm{E}_{p(\bm{\mathrm{%
M}}|\bm{\mathrm{\Pi}})}\left[\left(w_{t}(\bm{\mathrm{M}})-C\right)\frac{%
\partial}{\partial\pi^{(\ell)}_{u}}\log p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})\right]
C
\bm{\mathrm{M}}
\frac{\partial L}{\partial\pi^{(\ell)}_{u}}\approx\frac{T}{|\mathcal{R}|}\sum_%
{r\in\mathcal{R}}\left(w_{t}(\bm{\mathrm{M}}_{r})-C\right)\left(\frac{\partial%
}{\partial\pi^{(\ell)}_{u}}\log p(\bm{\mathrm{M}}_{r}|\bm{\mathrm{\Pi}})\right%
)\;,
\mathcal{R}
\bm{\mathrm{M}}_{r}
p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})
\mathcal{R}
w_{t}(\bm{\mathrm{M}})\approx\tilde{w}_{t}(\bm{\mathrm{M}})
C
C
C=\mathrm{E}_{p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})}\left[w_{t}(\bm{\mathrm{M}}%
)\right]=1
(x,k)
\bm{\mathrm{\Pi}}
p(k|\bm{x},\bm{\mathrm{M}},{\Theta})\neq\tilde{p}(k|\bm{x},\bm{\mathrm{\Pi}},{%
\Theta})
\pi^{(\ell)}_{u}=1
\pi^{(\ell)}_{u}=0
p(\pi^{(\ell)}_{u}|\alpha,\beta,\gamma)\propto\left(\left(\pi^{(\ell)}_{u}%
\right)^{\alpha-1}\left(1-\pi^{(\ell)}_{u}\right)^{\beta-1}\right)^{\gamma}.
\gamma(\alpha-1)\leq 0
\gamma(\beta-1)\leq 0
\alpha<1
\beta<1
\pi^{(\ell)}_{u}
0
1
\pi^{(\ell)}_{u}=0
\pi^{(\ell)}_{u}=1
\gamma
\gamma
0
1
{\Theta}
\bm{\mathrm{\Pi}}
\mathcal{X},\mathcal{K}
{\Theta}
\bm{\mathrm{\Pi}}
\mathcal{R}
\alpha,\beta,\gamma
\eta
C
\bm{\mathrm{\Pi}}
\log p(\bm{\mathrm{\Pi}})
\ell\in\{0,..,L\},u\in\{1,..,D^{(\ell)}\}
\delta^{(\ell)}_{u}\leftarrow{\frac{\partial}{\partial\pi^{(\ell)}_{u}}\log p(%
\pi^{(\ell)}_{u})}
\log p(k_{r}|\bm{x}_{r},\bm{\mathrm{\Pi}})
r\in\mathcal{R}
\bm{\mathrm{M}}\leftarrow
p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})
\tilde{w}\leftarrow\frac{p(k_{r}|\bm{x}_{r},\bm{\mathrm{M}},{\Theta})}{\tilde{%
p}(k_{r}|\bm{x}_{r},\bm{\mathrm{\Pi}},{\Theta})}
\bm{\delta}\leftarrow\bm{\delta}+(\tilde{w}-C)\bm{\nabla}_{\bm{\mathrm{\Pi}}}%
\left[\log p(\bm{\mathrm{M}}|\bm{\mathrm{\Pi}})\right]
\bm{\mathrm{\Pi}}\leftarrow\mathrm{Clip}\left[\bm{\mathrm{\Pi}}+\eta\bm{%
\mathrm{\delta}}\right]
\max\{0,\min\{1,x\}\}
x
\mathcal{X},\mathcal{K}
{\Theta},\bm{\mathrm{\Pi}}
\bm{\mathrm{\Pi}}
{\Theta}
\Theta
\mathcal{R}
\mathcal{X}
\bm{\mathrm{\Pi}}\leftarrow\mathrm{Algorithm1}(\mathcal{X},\mathcal{K},{\Theta%
},\bm{\mathrm{\Pi}},\mathcal{R})
{\Theta}
\bm{\mathrm{\Pi}}
{\Theta}
\bm{\mathrm{\Pi}}
3.03\pm 0.167
0.156\pm 0.014
3.02\pm 0.181
0.164\pm 0.027
2.99\pm 0.119
0.157\pm 0.015
3.25\pm 0.196
0.138\pm 0.011
2.21\pm 0.161
0.123\pm 0.016
2.55\pm 0.188
0.101\pm 0.011
1.52\pm 0.089
0.0850\pm 0.004
1.50\pm 0.084
0.0818\pm 0.006
1.60\pm 0.091
0.0900\pm 0.005
1.54\pm 0.083
0.0858\pm 0.004
1.50\pm 0.030
0.0771\pm 0.004
1.49\pm 0.039
0.0536\pm 0.003
28{\times}28
128
D^{(\ell)}\in\{25,50,100,200,400,800,1600\}
\beta=\alpha
D^{(\ell)}
\lceil D^{(\ell)}/8\rceil
0.001
0.9
10^{-6}
10^{-4}
0.5
1.0
\pm 1\sigma
\pm 1\sigma
\pm 1\sigma
\to
\to
32\times 17=544
\alpha=\beta=0.9
\gamma=T^{\prime}
T^{\prime}
0.5
0
1
1
n
