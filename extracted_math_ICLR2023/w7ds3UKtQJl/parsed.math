\mathcal{M}=\langle\mathcal{S},\mathcal{A},p_{\text{E}},\rho,r,\gamma\rangle
\mathcal{S}
\mathcal{A}
p_{\text{E}}:\mathcal{S}\times\mathcal{A}\times\mathcal{S}\rightarrow\mathbb{R}
\rho:\mathcal{S}\rightarrow\mathbb{R}
r:\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}
\gamma\in(0,1)
r
r
y
p(y)
q_{\phi}
\phi
\tau\in(\mathcal{S}\times\mathcal{A})^{n}
n\in\mathbb{N}
\pi_{\theta}
\theta
q_{\phi}(y\mid\tau)
y
\tau
y
p(y)
y
y
r_{\text{acc}}=\mathds{1}_{y}\left[\operatorname*{argmax}_{y^{\prime}\in%
\mathcal{Y}}q_{\phi}(y^{\prime}\mid\tau)\right],
\mathcal{Y}
\mathds{1}_{y}[x]
x
y
y
\tau
p(y)
\pi_{\theta}
p(y,\tau)
p(y)p(\tau)
\displaystyle I(y;\tau):=D_{\mathbb{KL}}(p(y,\tau)\mathrel{\|}p(y)p(\tau))
\displaystyle I(y;\tau)
\displaystyle:=D_{\mathbb{KL}}(p(y,\tau)\mathrel{\|}p(y)p(\tau))
\displaystyle=\mathbb{E}_{\tau\sim\pi_{\theta},y\sim p(y)}\left[\log p(y\mid%
\tau)-\log p(y)\right],
\displaystyle=\mathbb{E}_{\tau\sim\pi_{\theta},y\sim p(y)}\left[\log p(y\mid%
\tau)-\log p(y)\right],
y
\tau
y
\tau
p(y\mid\tau)
p(y\mid\tau)
r_{\log}^{*}:=\log p(y\mid\tau)-\log p(y)
\pi_{\theta}
I(y;\tau)
\pi_{\theta}
y
p(y\mid\tau)
p(y\mid\tau)
q_{\phi}(y\mid\tau)
\phi
r_{\log}=\log q_{\phi}(y\mid\tau)-\log p(y),
I(y;\tau)
I_{\text{BA}}(y;\tau):=\mathbb{E}_{\tau\sim\pi_{\theta},y\sim p(y)}[\log q_{%
\phi}(y\mid\tau)-\log p(y)].
q_{\phi}(y\mid\tau)
p(y\mid\tau)
-\mathbb{E}_{\tau\sim\pi_{\theta},y\sim p(y)}\left[p(y\mid\tau)\log q_{\phi}(y%
\mid\tau)\right],
p(y\mid\tau)
-\mathbb{E}_{\tau\sim\pi_{\theta},y\sim p(y)}\log q_{\phi}(y\mid\tau)
p(y\,|\,\tau)=1
\tau
y
q_{\phi}(y\mid\tau)
p(y\mid\tau)
\varepsilon_{\log}
r_{\log}
\varepsilon_{\log}=r_{\log}-r_{\log}^{\star}=\log q_{\phi}(y\mid\tau)-\log p(y%
\mid\tau).
q_{\phi}(y\mid\tau)
q_{\tilde{\phi}}(y\mid\tau)
p(y\mid\tau)
\phi
\tilde{\phi}
\tilde{\delta}
\phi
\tilde{\phi}
\phi
\tilde{\phi}
\tilde{\delta}
\phi
\tilde{\phi}
q_{\phi}(y\mid\tau)
q_{\phi}(y\mid\tau)
r_{g}=g\left[q_{\phi}(y\mid\tau)\right]-g\left[p(y)\right]
r_{g}^{*}=g\left[p(y\mid\tau)\right]-g\left[p(y)\right],
g
\log
g(\cdot)
I(y;\tau)
g(\cdot)
f
r_{g}
\varepsilon_{g}:=r_{g}-r_{g}^{*}=g\left[q_{\phi}(y\mid\tau)\right]-g\left[p(y%
\mid\tau)\right]
p(y\mid\tau)
\delta:=q_{\phi}(y\mid\tau)-p(y\mid\tau)
\begin{split}\mathbb{E}[\varepsilon_{g}]\approx\>&g^{\prime}(p(y\mid\tau))%
\mathbb{E}[\delta]+\frac{1}{2!}g^{\prime\prime}(p(y\mid\tau))\mathbb{E}\left[%
\delta^{2}\right],\end{split}
\displaystyle\mathbb{V}[\varepsilon_{g}]\approx(g^{\prime}(p(y\mid\tau)))^{2}%
\mathbb{V}[\delta]+(\frac{1}{2!}g^{\prime\prime}(p(y\mid\tau)))^{2}\mathbb{V}%
\left[\delta^{2}\right]
\displaystyle\mathbb{V}[\varepsilon_{g}]
\displaystyle\approx(g^{\prime}(p(y\mid\tau)))^{2}\mathbb{V}[\delta]+(\frac{1}%
{2!}g^{\prime\prime}(p(y\mid\tau)))^{2}\mathbb{V}\left[\delta^{2}\right]
\displaystyle\quad+g^{\prime}(p(y\mid\tau))g^{\prime\prime}(p(y\mid\tau))%
\mathrm{Cov}\left[\delta,\delta^{2}\right].
\displaystyle\quad+g^{\prime}(p(y\mid\tau))g^{\prime\prime}(p(y\mid\tau))%
\mathrm{Cov}\left[\delta,\delta^{2}\right].
\delta
\varepsilon_{g}
\delta
\mathbb{E}[\delta]=0
\delta
\tilde{\delta}
\tilde{\delta}
\tilde{\delta}=q_{\phi}(y\mid\tau)-q_{\tilde{\phi}}(y\mid\tau)\approx\delta
\mathbb{E}[\delta]\approx 0
\tilde{\delta}
\tilde{\delta}
g(\cdot)
\mathbb{E}[\varepsilon_{g}]
\mathbb{V}[\varepsilon_{g}]
r_{\text{lin}}=q_{\phi}(y\mid\tau)-p(y),
r_{\log}
\mathbb{E}[\varepsilon_{\text{lin}}]=\mathbb{E}[\delta]=0
\mathbb{V}[\varepsilon_{\text{lin}}]=\mathbb{V}[\delta]
|\mathbb{E}[\varepsilon_{\log}]|\approx\frac{1}{2!\,p^{2}(y\mid\tau)}\mathbb{E%
}[\delta^{2}]>0=|\mathbb{E}[\varepsilon_{\text{lin}}]|.
r_{\text{lin}}
r_{\log}
\mathbb{V}[\varepsilon_{\text{log}}]\approx p^{-2}(y\mid\tau)\mathbb{V}[\delta%
]+(\frac{1}{2!\,p^{2}(y\mid\tau)})^{2}\mathbb{V}[\delta^{2}],
p(y\mid\tau)<1
g
y
p(y\mid\tau)
p(y)
y
\tau
q_{\phi}
q_{\phi}(y\mid\tau)
p(y)
q_{\phi}(y\mid\tau)
p(y\mid\tau)
q_{\phi}(y\mid\tau)
r_{\text{lin}}
\max(q_{\phi}(y\mid\tau),p(y))
\displaystyle\overline{r_{\text{lin}}}:=\max(q_{\phi}(y\mid\tau),p(y))-p(y)
\displaystyle\overline{r_{\text{lin}}}
\displaystyle:=\max(q_{\phi}(y\mid\tau),p(y))-p(y)
\displaystyle\>=\max(q_{\phi}(y\mid\tau)-p(y),0).
\displaystyle\>=\max(q_{\phi}(y\mid\tau)-p(y),0).
r_{\text{acc}}
\overline{r_{\log}}=\max(\log q_{\phi}(y\mid\tau)-\log p(y),0)
p(y\mid\tau)
\tau
\chi^{2}
f
f
f
\chi^{2}
f
f
\varepsilon_{\text{log}}
\begin{split}\mathbb{E}[\varepsilon_{\text{log}}]=\>&g^{\prime}(p(y\mid\tau))%
\mathbb{E}[\delta]+\frac{1}{2!}g^{\prime\prime}(p(y\mid\tau))\mathbb{E}[\delta%
^{2}]+\mathbb{E}[o(\delta^{2})]\\
=\>&\frac{1}{p(y\mid\tau)}\mathbb{E}[\delta]-\frac{1}{2!\,p^{2}(y\mid\tau)}%
\mathbb{E}[\delta^{2}]+\mathbb{E}[o(\delta^{2})]\\
\approx\>&-\frac{1}{2!\,p^{2}(y\mid\tau)}\mathbb{E}[\delta^{2}],\\
\\
\mathbb{V}[\varepsilon_{\text{log}}]=\>&(g^{\prime}(p(y\mid\tau)))^{2}\mathbb{%
V}[\delta]+(\frac{1}{2!}g^{\prime\prime}(p(y\mid\tau)))^{2}\mathbb{V}[\delta^{%
2}]+g^{\prime}(p(y\mid\tau))g^{\prime\prime}(p(y\mid\tau))\mathrm{Cov}[\delta,%
\delta^{2}]\\
&+\mathbb{V}[o(\delta^{2})]+2g^{\prime}(p(y\mid\tau))\mathrm{Cov}[\delta,o(%
\delta^{2})]+g^{\prime\prime}(p(y\mid\tau))\mathrm{Cov}[\delta^{2},o(\delta^{2%
})]\\
\approx\>&(g^{\prime}(p(y\mid\tau)))^{2}\mathbb{V}[\delta]+(\frac{1}{2!}g^{%
\prime\prime}(p(y\mid\tau)))^{2}\mathbb{V}[\delta^{2}]+g^{\prime}(p(y\mid\tau)%
)g^{\prime\prime}(p(y\mid\tau))\mathrm{Cov}[\delta,\delta^{2}]\\
\approx\>&(g^{\prime}(p(y\mid\tau)))^{2}\mathbb{V}[\delta]+(\frac{1}{2!}g^{%
\prime\prime}(p(y\mid\tau)))^{2}\mathbb{V}[\delta^{2}]\\
=\>&\frac{1}{p^{2}(y\mid\tau)}\mathbb{V}[\delta]+(\frac{1}{2!\,p^{2}(y\mid\tau%
)})^{2}\mathbb{V}[\delta^{2}].\\
\end{split}
\mathrm{Cov}[\delta,\delta^{2}]=\mathbb{E}[\delta^{3}]-\mathbb{E}[\delta]%
\mathbb{E}][\delta^{2}]=(\mu^{3}+3\mu\sigma^{2}+\gamma\sigma^{3})-\mu(\mu^{2}+%
\sigma^{2})=2\mu\sigma^{2}+\gamma\sigma^{3}\approx 0
\sigma^{2}=\mathbb{E}[(\delta-\mu)^{2}]
\mu=\mathbb{E}[\delta]
\gamma=\mathbb{E}[(\frac{\delta-\mu}{\sigma})^{3}]
\delta
\chi^{2}
f
\tau
y
\begin{split}I_{f}(y;\tau):=\>&D_{f}({p(y,\tau)}\,||\,p(y)p(\tau))\\
=\>&\mathbb{E}_{\tau\sim\pi_{\theta},y\sim p(y)}F\left(\frac{p(y\mid\tau)}{p(y%
)}\right),\end{split}
D_{f}(P\,||\,Q):=\mathbb{E}_{q(x)}f\left(\frac{p(x)}{q(x)}\right)=\mathbb{E}_{%
p(x)}F\left(\frac{p(x)}{q(x)}\right)
f
P
Q
X
f:\mathbb{R}^{+}\rightarrow\mathbb{R}
f(1)=0
F(x):=f(x)/x
P
Q
p(x)
q(x)
P
Q
f(x)=x\log x
f
f
f
p(x,y)
\chi^{2}
f(x)=(x-1)^{2}
f
\begin{split}I_{f}(y;\tau)=\>&\mathbb{E}_{\tau\sim\pi_{\theta},y\sim p(y)}%
\left[\frac{p(y\mid\tau)}{p(y)}-1\right].\\
\end{split}
y
p(y)
I_{f}(y;\tau)=\>\alpha\;\mathbb{E}_{\tau\sim\pi_{\theta},y\sim p(y)}\left[p(y%
\mid\tau)-p(y)\right]
\alpha=1/p(y)
f
f
f
f(x)
I_{f}(x;y)
x\log x
\mathbb{E}_{p(x,y)}\log\frac{p(y|x)}{p(y)}
\chi^{2}
(x-1)^{2}
\mathbb{E}_{p(x,y)}\frac{p(y|x)}{p(y)}-1
\frac{1}{2}|x-1|
\mathbb{E}_{p(x,y)}\frac{1}{2}\left\lvert 1-\frac{p(y)}{p(y|x)}\right\rvert
(1-\sqrt{x})^{2}
\mathbb{E}_{p(x,y)}\left[2-2\sqrt{\frac{p(y)}{p(y|x)}}\right]
\frac{1-x}{2x+2}
\mathbb{E}_{p(x,y)}\frac{[p(y|x)-p(y)]^{2}}{2p(y|x)+2p(y)}
x\log\frac{2x}{x+1}+\log\frac{2}{x+1}
\mathbb{E}_{p(x,y)}\left[\log\frac{2p(y|x)}{p(y|x)+p(y)}+\frac{p(y)}{p(y|x)}%
\log\frac{2p(y)}{p(y|x)+p(y)}\right]
-\log x
\mathbb{E}_{p(x,y)}\left[\frac{p(y)}{p(y|x)}\log\frac{p(y)}{p(y|x)}\right]
\sim
\sim 3.5\%
\sim 1\%
\sim 1.5\%
\sim 23
g
g
g
g
q_{\phi}(y\mid\tau)=p(y)=0.1
g
g
g(x)=x^{6}
g
g(x)=x^{6}
g
g
g
\times
\times
\times
90\%
\{\textit{left},\textit{right},\textit{up},\textit{down},\textit{no-op}\}
\left[0,127\right]
N
\lambda=4
80\%
N
\times
4\times 4
3\text{e-}4
4\times 4
Q(\lambda)
n
n_{\text{skills}}=2^{\mathbb{E}[\log q_{\phi}(y|\tau)-\log p(y)]},
1\text{e-}4
r=r_{\text{log}}+\lambda r_{\text{DISDAIN}}
r_{\text{log}}
\lambda
r_{\text{DISDAIN}}
r_{\text{DISDAIN}}=\mathbb{H}\left[\frac{1}{N}\sum_{i=1}^{N}q_{\phi_{i}}(y\mid%
\tau)\right]-\frac{1}{N}\sum_{i=1}^{N}\mathbb{H}\left[q_{\phi_{i}}(y\mid\tau)%
\right],
N
\mathbb{H}[X]
X
