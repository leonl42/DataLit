8\%
y\in\mathcal{Y}
x\in\mathcal{X}
\mathbb{D}
P(\mathcal{X},\mathcal{Y})
g(x)
h(x)
\mathbb{D}
\Theta
l:\Theta\times\mathcal{X}\times\mathcal{Y}\rightarrow\mathbb{R}_{+}
\theta\in\Theta
P
\hat{\theta}_{ERM}:=\text{argmin}_{\theta\in\Theta}\mathbb{E}_{(x,y)\sim P}[l(%
x,y;\theta)]
P
m
(x,y)
g\in\mathcal{G}
\hat{\mathcal{R}}(\theta)
m
\hat{\theta}_{DRO}:=\text{arg}\min_{\theta\in\Theta}\{\hat{\mathcal{R}}(\theta%
):=\max_{g\in\mathcal{G}}\mathbb{E}_{(x,y)\sim p(x,y|g)}[l(x,y;\theta)]\},
p(x,y|g)\forall g
\theta
\theta
\hat{\mathcal{R}}(\theta):=\max_{q\in\mathcal{Q}}\mathbb{E}_{g\sim q,(x,y)\sim
p%
(x,y|q)}[l(x,y;\theta)]
Q
\alpha
p_{train}
p_{train}(g):=|\mathbbm{1}(g_{i}=g)\forall i\in\mathbb{D}|/|\mathbb{D}|
Q=\{q:q(g)\leq p_{train}(g)/\alpha\ \forall g\}
\frac{1}{\alpha}
\alpha
\alpha\in(0,1)
\alpha
m
w
W
\hat{L}^{(0)}
\hat{p}^{train(0)}
t=1,...,T_{1}
\vartriangleright
g\in 1\dots m:
\hat{L}^{(t)}(g)\leftarrow\text{EMA}(\sum_{i=1}^{|B|}P^{(t)}_{i,g}l(x_{i},y_{i%
};\theta^{(t-1)}),\hat{L}^{(t-1)}(g))
\hat{p}^{train(t)}(g)\leftarrow\text{EMA}(\sum_{i=1}^{|B|}\frac{P^{(t)}_{i,g}}%
{|B|},\hat{p}^{train(t-1)})
\vartriangleright
\hat{p}^{train(t)}
\hat{L}^{(t)}
\alpha
\mathcal{A}
:
q^{(t)}(g)=\frac{1}{\alpha}
g\in\mathcal{A}
w
\vartriangleright
\theta
:
\theta^{(t)}=\theta^{(t-1)}-\eta\Delta(\sum_{g=1}^{m}q^{(t)}(g)\sum_{i=1}^{|B|%
}P^{(t)}_{i,g}l(x_{i},y_{i},\theta^{(t-1)}))
t=1,...,T_{2}
\vartriangleright
g\in{1\cdot\cdot m}
:
P^{(t-1)}_{i,g}=p(g|f_{i};\phi^{(t-1)}),
L^{(t)}(g)\leftarrow\sum_{i=1}^{|B|}P^{(t-1)}_{i,g}l(x_{i},y_{i};\theta^{(t)}),
p^{train(t)}(g)\leftarrow\sum_{i=1}^{|B|}\frac{P^{(t-1)}_{i,g}}{|B|}
\vartriangleright
p^{train(t)}
L^{(t)}
\alpha
\mathcal{A}
:
q^{(t)}(g)=\alpha
g\in\mathcal{A}
W
\vartriangleright
\phi
:
\phi^{(t)}=\phi^{(t-1)}+\eta\Delta(\sum_{g=1}^{m}q^{(t)}(g)\sum_{i=1}^{|B|}P^{%
(t-1)}_{i,g}l(x_{i},y_{i},\theta^{(t)}))
X
\hat{Y}
Y
\{X,Y,\hat{Y}\}
m
Y=\hat{Y}
g
\mathbbm{1}(g_{i}=g);g\in\mathcal{G}
P_{i,g}:=p(g|f_{i};\phi);g\in\mathcal{G}
P_{i,g}
i
g
q
\phi
q
f_{i}\in\mathcal{F}
i
\theta
\phi
R
\theta
\phi
p_{train}(g):=\sum_{i\in\mathbb{D}}P_{i,g}/|\mathbb{D}|
Q
\hat{\theta},\hat{\phi}_{AGRO}:=\text{argmin}_{\theta\in\Theta}\{\text{argmax}%
_{\phi\in\Phi}\{\hat{\mathcal{R}}(\theta):=\max_{q\in\mathcal{Q}(\phi)}\mathbb%
{E}_{g\sim q,(x,y)\sim p(x,y|q)}[l(x,y;\theta)]\}\},
r
\theta
\phi
r-1
\theta
\alpha
r+1
\phi
\alpha
T_{1}
\theta
r^{\text{th}}
T_{2}
\phi
r+1^{\text{th}}
T_{1},T_{2},\alpha,m
R
\phi
\theta
\phi
\phi
f_{i}\in\mathcal{F}
x_{i}
\mathcal{F}
f_{i}\in\mathcal{F}
x_{i}
k
h(x_{i})
y_{i}
\{p(\hat{y}_{i}|x_{i};\theta_{k})\forall\hat{y}_{i}\in\mathcal{Y}\}
\theta_{k}
g(x_{i})
x_{i}
f_{i}
x_{i}
g(x_{i})
h(x_{i})
y_{i}
\{p(\hat{y_{i}}|\theta_{k})\forall\hat{y_{i}}\in\mathcal{Y}\}
\theta
\phi
m
\alpha
m
\phi
\phi
\phi
\phi
\phi
\alpha
\Delta
h(x_{i})
\mathcal{F}
\mathcal{F}
\rightarrow
\rightarrow
\rightarrow
\rightarrow
\rightarrow
\rightarrow
EMA(v1,v2)=\gamma v_{1}+(1-\gamma)v_{2}
\gamma\in(0,1)
\alpha\in(0,1)
\mathcal{A}
\alpha
\hat{p}_{train}^{(t)}
\mathcal{A}
\alpha
\hat{\theta}_{G-DRO}:=\text{arg}\min_{\theta\in\Theta}\{\hat{\mathcal{R}}(%
\theta):=\max_{q\in\mathcal{Q}}\mathbb{E}_{g\sim q,(x,y)\sim p(x,y|q)}[l(x,y;%
\theta)]\},
Q
\alpha
p_{train}
p_{train}(g)
g
p_{train}(g):=|\mathbbm{1}(g_{i}=g)\forall i\in\mathbb{D}|/|\mathbb{D}|
Q=\{q:q(g)\leq p_{train}(g)/\alpha\ \forall g\}
p_{train}(g)
|\mathbbm{1}(g_{i}=g)\forall i\in\mathbb{D}|
i
p_{train}(g)
\hat{p}_{train}(g)
\hat{p}_{train}(g)\leftarrow\text{EMA}(|\mathbbm{1}(g_{i}=g)\forall i\in%
\mathbb{B}|/|\mathbb{B}|,\hat{p}_{train}(g))
\frac{1}{\alpha}
\alpha
\alpha\in(0,1)
w
w=0.1
\alpha
k
\mathbf{S}\sim\text{Cat}(\mathbf{p}_{S})
\mathbf{p}_{S}\in\{\mathbf{p}\in\mathbb{R}_{+}^{k}:\sum_{i=1}^{k}p_{i}=1\}
j
Z|S^{(j)}=1\sim\mathcal{N}(\mu^{(j)},\Sigma^{(j)})
\mu^{(j)}\in\mathbb{R}^{d}
\Sigma^{(j)}\in\mathbb{S}_{++}^{d}
d\times d
Y|S^{(j)}=1\sim\text{Cat}(\mathbf{p_{(j)}})
\mathbf{p{(j)}}\in\{\mathbf{p}\in\mathbb{R}_{+}^{c}:\sum_{i=1}^{c}p_{i}=1\}
Y|S^{(j)}=1\sim\text{Cat}(\mathbf{\hat{p}_{(j)}})
\mathbf{\hat{p}{(j)}}\in\{\mathbf{\hat{p}}\in\mathbb{R}_{+}^{c}:\sum_{i=1}^{c}%
\hat{p}_{i}=1\}
\phi=[\mathbf{p}_{S},\{\mu^{(j)},\Sigma^{(j)},\mathbf{p_{(j)}},\mathbf{\hat{p}%
_{(j)}}\}_{j=1}^{k}]
D_{v}
l(\phi)=\sum_{i=1}^{n}\log{\sum_{j=1}^{k}}P(S^{(j)}=1)P(Z=z_{i}|S^{(j)}=1)P(Y=%
y_{i}|S^{(j)}=1)^{\gamma}P(\hat{Y}=h_{\theta}(x_{i})|S^{(j)}=1)^{\gamma}
\gamma
h_{\theta}(x_{i})
x_{i}
\gamma
\hat{\theta},\hat{\phi}_{AGRO}:=\text{arg}\max_{\phi\in\Phi}\{\text{arg}\min_{%
\theta\in\Theta}\{\hat{\mathcal{R}}(\theta):=\max_{q\in\mathcal{Q}(\phi)}%
\mathbb{E}_{g\sim q,(x,y)\sim p(x,y|q)}[l(x,y;\theta)]\}\},
Q
\alpha
p_{train}
p_{train}(g)
g
Q=\{q:q(g)\leq p_{train}(g)/\alpha\ \forall g\}
p_{train}(g)
\phi
\mathbb{B}
\hat{p}_{train}(g)\leftarrow\text{EMA}(\sum_{j=1}^{|\mathbb{B}|}\frac{p(g|f_{j%
},\phi^{(t-1)})}{|B|},p_{train}(g))
p(g|f_{j},\phi^{(t-1)})
j
\phi
\theta
\frac{1}{\alpha}
\alpha
\alpha\in(0,1)
w
w=0.1
\alpha
m
i
P^{(t)}_{i}
\phi^{(t-1)}
t
\mathcal{A}
\alpha
\alpha
\mathcal{A}
\alpha
w
W=1.0
R=1
\mathcal{F}
\theta
T1
T2
T1
T2
m
\alpha
\phi
\alpha
\phi
\alpha
\alpha
\phi
\phi
\phi
\mathcal{F}
f_{i}\in\mathcal{F}\forall x_{i}\in\mathbb{D}
\alpha
m
\hat{L}^{(0)}
\hat{p}^{train(0)}
t=1,...,T
\vartriangleright
g\in{1,···,m}
\hat{L}^{(t)}(g)\leftarrow\text{EMA}({l(x_{i},y_{i};\theta^{(t-1)}):\mathbf{g}%
_{i}=g},\hat{L}^{(t-1)}(g))
\hat{p}^{train(t)}\leftarrow\text{EMA}(\text{No. samples of each group in B},%
\hat{p}^{train(t-1)})
\vartriangleright
\hat{p}^{train(t)}
\hat{L}^{(t)}
\pi
\mathcal{A}
\alpha
q^{(t)}(g_{\pi_{i}})=\frac{1}{\alpha}
g\in\mathcal{A}
w
\vartriangleright
\theta
\theta^{(t)}=\theta^{(t-1)}-\frac{\eta}{|B|}\sum_{i=1}^{|B|}q^{(t)}(g_{\pi_{i}%
})\Delta l(x_{i},y_{i},\theta^{(t-1)})
>0.9
62:1
1,387
200K
\alpha
\{0.1,0.2,0.3,0.4,0.5\}
m
4,6,9,12,24,50^{*}
T2
\eta
1e-6,1e-5,2e-5
\lambda
0.0,1.0,2.0
\phi
\phi_{h}
64,128
m
>5\%
m
>5\%
\alpha
m
T_{2}
\eta
\lambda
\phi_{h}
\theta
0.5
m
\alpha
T_{1}
T_{2}
\theta
\phi
\phi_{h}
16\times m
\alpha
\alpha
\alpha
N
6\times m
m
\alpha=0.2
\eta
\eta
\alpha=0.2
\eta
\alpha=0.2
\eta
\alpha
m
\alpha
\alpha
\alpha
m
\alpha
alpha
0.2
m
m
\alpha
m
\alpha
m
\mathcal{F}
\mathcal{F}
m<25
i
i^{\prime}!=i
i
i
i^{\prime}
i
m=500
m
m=500
m
\theta
\phi
\theta
\phi
