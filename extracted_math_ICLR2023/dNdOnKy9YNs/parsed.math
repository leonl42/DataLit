f
X\in\mathbb{R}^{d\times n}
n
\mathbb{R}^{d}
f(QX)=Qf(X)
Q\in\mathbb{R}^{d\times d}
g
f(X)=Xg(X^{T}X).\vspace{-1mm}
f(X,Z)
X\in\mathbb{R}^{d\times n}
Z\in\mathbb{R}^{d\times k}
X
X
f(X,Z)
f(QX,QZ)=Qf(X,Z)
Q
f(X,Z)=Xg_{1}(X^{T}X,Z^{T}X,Z^{T}Z)+Zg_{2}(X^{T}X,Z^{T}X,Z^{T}Z)
Z
f(X,Z)=Xg(X^{T}Z),
Z
g
g_{1}
g_{2}
n
g
X\in\mathbb{R}^{d\times n}
n
W_{Q}\in\mathbb{R}^{d_{1}\times d}
W_{K}\in\mathbb{R}^{d_{1}\times d}
W_{V}\in\mathbb{R}^{d\times d}
X
X
W_{Q}
W_{K}
Q(X)=W_{Q}X\in\mathbb{R}^{d_{1}\times n}
K(X)=W_{K}X\in\mathbb{R}^{d_{1}\times n}
A(X)=Q(X)^{T}K(X)=X^{T}W_{Q}^{T}W_{K}X\in\mathbb{R}^{n\times n}.
A
W_{V}X
A(X)
1/\sqrt{d_{1}}
Attn(X)=X+W_{V}X\mathcal{S}_{r}\left(\frac{1}{\sqrt{d_{1}}}X^{T}W_{Q}^{T}W_{K}%
X\right)^{T}
\mathcal{S}_{r}(\cdot)
X\in\mathbb{R}^{d\times n}
n
\mathbb{R}^{d}
X
n\times d
X
m
m
W_{Q}^{(i)}
W_{K}^{(i)}
W_{V}^{(i)}
W_{Q}^{(i)}
W_{K}^{(i)}
d_{1}\times d
W_{V}^{(i)}
d_{2}\times d
W_{out}^{(i)}\in\mathbb{R}^{d\times d_{2}}
\mathbb{R}^{d_{2}}
\mathbb{R}^{d}
head_{i}(X)=W_{V}^{(i)}X\mathcal{S}_{r}\left(\frac{1}{\sqrt{d_{1}}}X^{T}(W_{Q}%
^{(i)})^{T}W_{K}^{(i)}X\right)^{T},
\displaystyle Attn_{m}(X)=X+\sum\limits_{i=1}^{m}W_{out}^{(i)}head_{i}(X)
\displaystyle Attn_{m}(X)
\displaystyle=X+\sum\limits_{i=1}^{m}W_{out}^{(i)}head_{i}(X)
\displaystyle=X+\sum\limits_{i=1}^{n}W_{out}^{(i)}W_{V}^{(i)}X\mathcal{S}_{r}%
\left(\frac{1}{\sqrt{d_{1}}}X^{T}(W_{Q}^{(i)})^{T}W_{K}^{(i)}X\right)^{T}.
\displaystyle=X+\sum\limits_{i=1}^{n}W_{out}^{(i)}W_{V}^{(i)}X\mathcal{S}_{r}%
\left(\frac{1}{\sqrt{d_{1}}}X^{T}(W_{Q}^{(i)})^{T}W_{K}^{(i)}X\right)^{T}.
\mathcal{X}=\bigcup_{n=1}^{\infty}\mathbb{R}^{d\times n}
\mathbb{R}^{d}
f:\mathcal{X}\rightarrow\mathcal{X}
f
X\in\mathcal{X}
Q\in\mathbb{R}^{d\times d}
f(QX)=Qf(X)
X
X
f:\mathcal{X}\rightarrow\mathcal{X}
g
X^{T}X
X\in\mathcal{X}
f(X)=Xg(X^{T}X).
X
f
f(``2+1")=``3"
f(``2-1")=``1"
0-9
12
``+"\rightarrow\bm{e}_{1},\ \ ``-"\rightarrow\bm{e}_{2},\ \ ``0"\rightarrow\bm%
{e}_{3},\ \ ``1"\rightarrow\bm{e}_{4},\cdots``9"\rightarrow\bm{e}_{12},
\bm{e}_{i}
i
\mathbb{R}^{12}
f(``2+1")=``3"
f([\bm{e}_{5},\bm{e}_{1},\bm{e}_{4}])=[\bm{e}_{6}].
Q_{12}\in\mathbb{R}^{12\times 12}
\mathbb{R}^{12}
Q_{12}
f
f([\bm{e}_{5},\bm{e}_{2},\bm{e}_{4}])=f(Q[\bm{e}_{5},\bm{e}_{1},\bm{e}_{4}])=[%
Q\bm{e}_{6}]=[\bm{e}_{6}].
f(``2-1")=``3"
f
Q
f_{Q}
f_{Q}(QX)=Qf(X).
f_{Q}
f
f_{Q}
Q
\{f_{Q}\}
f
f:\mathcal{X}\times\mathbb{R}^{d\times k}\rightarrow\mathcal{X}
X\in\mathcal{X}
Z\in\mathbb{R}^{d\times k}
X
Z
f
X
Z
f
\{f_{Q}\}
f_{Q}(\cdot)=f(\cdot,QZ)
f:\mathcal{X}\times\mathbb{R}^{d\times k}\rightarrow\mathcal{X}
Z\in\mathbb{R}^{d\times k}
f
Z
X\in\mathcal{X}
Q\in\mathbb{R}^{d\times d}
f(QX,QZ)=Qf(X,Z)
Z\in\mathbb{R}^{d\times k}
f:\mathcal{X}\times\mathbb{R}^{d\times k}\rightarrow\mathcal{X}
Z
g_{1}
g_{2}
Z
X^{T}X,Z^{T}X,Z^{T}Z
X\in\mathcal{X}
f(X,Z)=Xg_{1}(X^{T}X,Z^{T}X,Z^{T}Z)+Zg_{2}(X^{T}X,Z^{T}X,Z^{T}Z).
\tilde{X}=[X,Z]\in\mathbb{R}^{d\times(n+k)}
\tilde{X}
f
f(Q\tilde{X})=Qf(\tilde{X})
Q\in\mathbb{R}^{d\times d}
g
\tilde{X}^{T}\tilde{X}
f(\tilde{X})=\tilde{X}g(\tilde{X}^{T}\tilde{X}).
\tilde{X}
g
X^{T}X
Z^{T}X
Z^{T}Z
g(\tilde{X}^{T}\tilde{X})=g(X^{T}X,Z^{T}X,Z^{T}Z)
\tilde{X}
n+k
g
n+k
g(X^{T}X,Z^{T}X,Z^{T}Z)=\left[\begin{array}[]{c}g_{1}(X^{T}X,Z^{T}X,Z^{T}Z)\\
g_{2}(X^{T}X,Z^{T}X,Z^{T}Z)\end{array}\right]
g_{1}
n
g_{2}
k
f(X,Z)=Xg_{1}(X^{T}X,Z^{T}X,Z^{T}Z)+Zg_{2}(X^{T}X,Z^{T}X,Z^{T}Z).
Z
f(X,Z)
X
Xg(Z^{T}X)
Z=[W_{Q}^{T},W_{K}^{T}]
g
g(Y)=\mathcal{S}_{r}\left(\frac{1}{\sqrt{d_{1}}}Y^{T}\left[\begin{array}[]{cc}%
0&I\\
0&0\end{array}\right]Y\right).
Z
Xg(Z^{T}X)
W_{V}
Z
g_{1}
g_{2}
Z^{T}Z
X^{T}X
Z^{T}X
Z
Zg_{2}(X^{T}X,Z^{T}X,Z^{T}Z)
X
Xg_{1}(X^{T}X,Z^{T}X,Z^{T}Z)
f(X,Z)=Xg_{1}(Z^{T}X)
f(X,Z)=Xg_{1}(Z^{T}X)
g_{1}
g_{2}
f(X,Z)=Xg(Z^{T}X)
X\in\mathbb{R}^{d\times n}
g(Z^{T}X)\in\mathbb{R}^{n\times n}
g
g_{n}:\mathbb{R}^{k\times n}\rightarrow\mathbb{R}^{n\times n}
n
n
g
g
f(X,Z)=Xg(Z^{T}X)
f
X\in\mathbb{R}^{d\times n}
g(Z^{T}X)\in\mathbb{R}^{n\times n}
g
g
n
g
\sigma(X^{T}ZAZ^{T}X)
A\in\mathbb{R}^{k\times k}
Y=Z^{T}X\in\mathbb{R}^{k\times n}
g
Y
g(Y)=\sigma\left(\sum\limits_{i=1}^{N}W_{i,0}\prod\limits_{j=1}^{K_{i}}\tilde{%
Y}W_{i,j}\right),
\tilde{Y}
Y
Y^{T}
N
W_{i,j}
W_{ij}
n
K_{i}\geq 2
K_{i}=0
1
n\times n
n
g(Y)=\sigma(Y^{T}WY)
W\in\mathbb{R}^{k\times k}
n\times n
n
Z
Z=[W_{Q}^{T},W_{K}^{T}]
A=\left[\begin{array}[]{cc}0&I\\
0&0\end{array}\right]
X^{T}ZAZ^{T}X=X^{T}W_{Q}^{T}W_{K}X.
g
Y\in\mathbb{R}^{k\times n}
n
\mathbb{R}^{k}
g
n
n\times n
K(\cdot,\cdot):\mathbb{R}^{k}\times\mathbb{R}^{k}\rightarrow\mathbb{R}
Y=[\bm{y}_{1},...,\bm{y}_{n}]
g(Y)=(K(\bm{y}_{i},\bm{y}_{j}))_{n\times n}
K
K(\mathbf{x},\bm{y})=\sigma(\mathbf{x}^{T}\bm{y})
g
g(Y)=\sigma(Y^{T}Y)
K(\mathbf{x},\bm{y})=f(\|\mathbf{x}-\bm{y}\|)
g
g_{ij}(Y)=f(\|\bm{y}_{i}-\bm{y}_{j}\|)
X\in\mathbb{R}^{d\times n}
n
X
l(X)
f:\mathcal{X}\times\mathbb{R}^{d\times k}\rightarrow\mathcal{X}
l(f(X,Z))=l(X)
Z\in\mathbb{R}^{d\times k}
f
Z
P\in\mathbb{R}^{l(X)\times l(X)}
f(XP,Z)=f(X,Z)P
f(X,Z)=Xg(Z^{T}X)
f
f(X,Z)=Xg(Z^{T}X)
f
Z
n
\rho_{1}
\rho_{2}
\psi_{1}
\psi_{2}
X\in\mathbb{R}^{d\times n}
\displaystyle g_{ii}(Z^{T}X)=\rho_{1}\big{(}\mathbf{x}_{i},Z,\sum\limits_{k=1,%
\ k\neq i}^{n}\psi_{1}(\mathbf{x}_{k};\mathbf{x}_{i},Z)\big{)}
\displaystyle g_{ii}(Z^{T}X)
\displaystyle=\rho_{1}\big{(}\mathbf{x}_{i},Z,\sum\limits_{k=1,\ k\neq i}^{n}%
\psi_{1}(\mathbf{x}_{k};\mathbf{x}_{i},Z)\big{)}
\displaystyle g_{ij}(Z^{T}X)=\rho_{2}\big{(}\mathbf{x}_{i},\mathbf{x}_{j},Z,%
\sum\limits_{k=1,\ k\neq i,j}^{n}\psi_{2}(\mathbf{x}_{k};\mathbf{x}_{i},%
\mathbf{x}_{j},Z)\big{)}
\displaystyle g_{ij}(Z^{T}X)
\displaystyle=\rho_{2}\big{(}\mathbf{x}_{i},\mathbf{x}_{j},Z,\sum\limits_{k=1,%
\ k\neq i,j}^{n}\psi_{2}(\mathbf{x}_{k};\mathbf{x}_{i},\mathbf{x}_{j},Z)\big{)}
i,j=1,2,...,n
j\neq i
g_{ij}
(i,j)
g
g=(g_{ij})_{n\times n}
Z=[W_{Q},W_{K}]
g_{ij}(Z^{T}X)=\frac{e^{\mathbf{x}_{i}^{T}W_{Q}^{T}W_{K}\mathbf{x}_{j}}}{\sum_%
{k=1}^{n}e^{\mathbf{x}_{i}^{T}W_{Q}^{T}W_{K}\mathbf{x}_{k}}}.
g
\displaystyle\psi_{2}(\mathbf{x};\bm{y},\bm{z},Z)=e^{\bm{y}^{T}W_{Q}^{T}W_{K}%
\mathbf{x}},\quad\rho_{2}(\mathbf{x},\bm{y},Z,\psi)=\frac{e^{\mathbf{x}^{T}W_{%
Q}^{T}W_{K}\bm{y}}}{e^{\mathbf{x}^{T}W_{Q}^{T}W_{K}\bm{y}}+\psi},
\displaystyle\psi_{2}(\mathbf{x};\bm{y},\bm{z},Z)
\displaystyle=e^{\bm{y}^{T}W_{Q}^{T}W_{K}\mathbf{x}},\quad\rho_{2}(\mathbf{x},%
\bm{y},Z,\psi)=\frac{e^{\mathbf{x}^{T}W_{Q}^{T}W_{K}\bm{y}}}{e^{\mathbf{x}^{T}%
W_{Q}^{T}W_{K}\bm{y}}+\psi},
\psi_{1}(\mathbf{x};\bm{y},Z)=\psi_{2}(\mathbf{x},\bm{y},\bm{y},Z),\ \ \ \rho_%
{1}(\mathbf{x},Z,\psi)=\rho_{2}(\mathbf{x},\mathbf{x},Z,\psi).
f
f(X,Z)=Xg(Z^{T}X)
\tilde{f}
f
\tilde{f}(X,Z,W)=WXg(Z^{T}X).
\tilde{f}(X,Z,U,V)=V\sigma\big{(}UXg(Z^{T}X)\big{)},
U
V
\sigma
m
\tilde{f}_{m}(X,Z,W)=\sum\limits_{i=1}^{m}W_{i}Xg_{i}(Z_{i}^{T}X),
Z_{1},...,Z_{m}
W_{1},...,W_{m}
Z=[Z_{1},...,Z_{m}]
W=[W_{1},...,W_{m}]
g_{1},...,g_{m}
L
\displaystyle h^{(0)}=X;\ \ \ \ h^{(l)}=\sum\limits_{i=1}^{m}W_{i}^{(l)}h^{(l-%
1)}g((Z^{(l)}_{i})^{T}h^{(l-1)},),1\leq l\leq L;\ \ \ \ f(X,Z,W)=h^{(L)},
\displaystyle h^{(0)}=X;\ \ \ \ h^{(l)}=\sum\limits_{i=1}^{m}W_{i}^{(l)}h^{(l-%
1)}g((Z^{(l)}_{i})^{T}h^{(l-1)},),1\leq l\leq L;\ \ \ \ f(X,Z,W)=h^{(L)},
Z
W
Z_{i}^{(l)}
W_{i}^{(l)}
g
X=[\mathbf{x}_{1},\mathbf{x}_{2},...,\mathbf{x}_{n}]\in\mathbb{R}^{d\times n}%
\subset\mathcal{X}
f(X)
\mathbf{x}_{1},...,\mathbf{x}_{n}
f(X)
f(X)\in\mathbb{R}^{d}
V=\textrm{span}(\mathbf{x}_{1},...,\mathbf{x}_{n})
\bm{v}\in V
\bm{u}\in V^{\perp}
f(X)=\bm{v}+\bm{u}
Q_{\bm{u}}
Q_{\bm{u}}=I-\frac{2}{\|\bm{u}\|^{2}}\bm{u}\bm{u}^{T}.
Q_{\bm{u}}
Q_{\bm{u}}\bm{u}=-\bm{u}
Q_{\bm{u}}\bm{w}=\bm{w}
\bm{w}\perp\bm{u}
Q_{\bm{u}}\bm{v}=\bm{v}
Q_{\bm{u}}\mathbf{x}_{i}=\mathbf{x}_{i}
i=1,2,...,n
f
f(Q_{\bm{u}}X)=Q_{\bm{u}}f(X)=Q_{\bm{u}}(\bm{v}+\bm{u})=\bm{v}-\bm{u}.
Q_{\bm{u}}X=X
f(Q_{\bm{u}}X)=f(X)=\bm{v}+\bm{u}.
\bm{u}=0
f(X)=\bm{v}\in V
g
X
f(X)=Xg(X).
g
X
f(X)
f
Q\in\mathbb{R}^{d\times d}
QXg(QX)=f(QX)=Qf(X)=QXg(X),
Xg(QX)=Xg(X)
g
g(QX)=g(X)
Q
g
X
X^{T}X
g(X,Z)
g
X
Z
g
Z^{T}X
X
X^{\dagger}X=I
g(X,Z)=X^{\dagger}f(X,Z)
P\in\mathbb{R}^{n\times n}
g(XP,Z)=P^{T}X^{\dagger}f(XP,Z)=P^{T}X^{\dagger}f(X,Z)P=P^{T}g(X,Z)P.
X
g(X,Z)
(i,j)
g
g_{ij}
g_{ij}
X
Z
g_{ij}(\mathbf{x}_{1},...,\mathbf{x}_{n},Z)
g_{ij}
P_{1i}
\mathbf{x}_{1}
\mathbf{x}_{i}
g(XP_{1i},Z)_{11}=g(X,Z)_{ii}
g_{ii}(\mathbf{x}_{1},\cdots,\mathbf{x}_{i},\cdots,\mathbf{x}_{n},Z)=g_{11}(%
\mathbf{x}_{i},\cdots,\mathbf{x}_{1},\cdots,\mathbf{x}_{n},Z).
g_{ii}
g_{11}
g_{11}
1
g_{11}
g_{11}
\mathbf{x}_{2},...,\mathbf{x}_{n}
\mathbf{x}_{2},...,\mathbf{x}_{n}
g_{11}
\rho(\sum_{k=2}^{n}\psi(\mathbf{x}_{k}))
\rho
\psi
\mathbf{x}_{1}
Z
\rho
\psi
\mathbf{x}_{1}
Z
\rho_{1}
\psi_{1}
g_{11}(X,Z)=\rho_{1}(\mathbf{x}_{1},Z,\sum_{k=2}^{n}\psi_{1}(\mathbf{x}_{k};%
\mathbf{x}_{1},Z)).
g_{11}
g_{ii}
g_{ii}(X,Z)=\rho_{1}(\mathbf{x}_{i},Z,\sum_{k\neq i}\psi_{1}(\mathbf{x}_{k};%
\mathbf{x}_{i},Z)).
i=1,2,...,n
g_{ij}
i\neq j
i<j
P_{1i,2j}
\mathbf{x}_{1}
\mathbf{x}_{i}
\mathbf{x}_{2}
\mathbf{x}_{j}
g_{ij}(\mathbf{x}_{1},\mathbf{x}_{2},\cdots,\mathbf{x}_{i},\cdots,\mathbf{x}_{%
j},\cdots,\mathbf{x}_{n},Z)=g_{12}(\mathbf{x}_{i},\mathbf{x}_{j},\cdots,%
\mathbf{x}_{1},\cdots,\mathbf{x}_{2},\cdots,\mathbf{x}_{n},Z),
g_{ij}
i\neq j
g_{12}
g_{12}
g_{11}
g_{12}
\mathbf{x}_{3},...,\mathbf{x}_{n}
\rho_{2}
\psi_{2}
g_{12}(X,Z)=\rho_{2}(\mathbf{x}_{1},\mathbf{x}_{2},Z,\sum_{k=3}^{\infty}\psi_{%
2}(\mathbf{x}_{k};\mathbf{x}_{1},\mathbf{x}_{2},Z)).
g_{ij}(X,Z)=\rho_{2}(\mathbf{x}_{i},\mathbf{x}_{j},Z,\sum_{k\neq i,j}\psi_{2}(%
\mathbf{x}_{k};\mathbf{x}_{i},\mathbf{x}_{j},Z)).
