('3.0', '\\mathcal{M}=(\\mathcal{S}, \\mathcal{A}, \\mathcal{T}, r, \\rho_0)')
('3.0', '\\mathcal{S}')
('3.0', '\\mathcal{A}')
('3.0', '\\mathcal{T}')
('3.0', 'r')
('3.0', '\\rho_0')
('3.0', '\\pi_\\theta')
('3.0', '\\mathcal{T}_\\theta')
('3.0', '\\pi^*')
('3.0', '\\mathcal{T}^*')
('3.0', '\\forall s \\in \\mathcal{S}, a \\in \\mathcal{A}: \\mathcal{T}_\\theta(a|s) \\rightarrow \\mathcal{T}^*(a|s)')
('3.0', 'T')
('3.0', "\\forall~ s,s' \\in S: T_\\theta(s'|s) \\rightarrow T^*(s'|s)")
('3.0', 'T')
('3.0', '\\mathcal{T}')
('3.1', '\\mathcal{P}')
('3.1', '\\pi')
('3.1', '\\rho_0')
('3.1', '\\mathcal{P}(\\rho_0): \\rho_0 \\rightarrow [\\pi(\\rho_0), \\pi(s_1), \\pi(s_2), ...]')
('3.1', 's_{i+1}=[s_i, a_i]')
('3.1', 'a_i=\\pi(s_i)')
('3.1', 's_0=\\rho_0')
('3.1', '\\mathcal{P_\\theta}(\\rho_0) \\rightarrow \\mathcal{P^*}(\\rho_0): \\bigg\\{\n    \\begin{aligned}\n        & \\mathcal{P_\\theta}(\\rho_0): \\rho_0 \\rightarrow [\\pi_\\theta(\\rho_0), \\pi_\\theta(s_1^\\theta), \\pi_\\theta(s_2^\\theta), \\ldots] \\\\\n        & \\mathcal{P^*}(\\rho_0): \\rho_0 \\rightarrow [\\pi^*(\\rho_0), \\pi^*(s_1^*), \\pi^*(s_2^*), \\ldots]\n    \\end{aligned}')
('3.1', '\\hat{\\mathcal{P}_\\theta}')
('3.1', '\\mathcal{\\hat{P^*}}')
('3.1', '\\mathcal{P}(\\rho_0) = \\{\\mathcal{T}(a|s) | \\forall a \\in \\mathcal{A}, s \\in \\mathcal{S}_{\\rho_0}\\}')
('3.1', '\\mathcal{S}_{\\rho_0}')
('3.1', '\\rho_0')
('3.1', '\\rho_0')
('3.2', '\\rho_0')
('3.2', '\\forall a \\in \\mathcal{A}, s \\in \\mathcal{S}_{\\rho_0}: \\mathcal{T}_\\theta(a, s) \\rightarrow \\mathcal{T^*}(a, s)')
('3.2', '\\forall s \\in \\mathcal{S}_{\\rho_0}: T_\\theta(s, \\rho_0) \\rightarrow T^*(s, \\rho_0)')
('3.2', '\\mathcal{D}')
('3.2', '\\rho_0')
('3.2', 'N')
('3.2', '\\forall a \\in \\mathcal{A}, n \\in [0, N], \\rho_0\\in\\mathcal{D}, s_n^*\\in\\mathcal{S}_{\\rho_0}^*: \\mathcal{T}_\\theta(a, s_n^*) \\rightarrow \\mathcal{T^*}(a, s_n^*)')
('3.2', '\\forall n \\in [0, N], \\rho_0\\in\\mathcal{D}, s_n^*\\in\\mathcal{S}_{\\rho_0}^*: T_\\theta(s_n^*, \\rho_0) \\rightarrow T^*(s_n^*, \\rho_0)')
('3.2', 'T_\\theta(s_n^*|\\rho_0) = \\prod\\limits_{i=0}^n \\mathcal{T}_\\theta(a_i^*|s_i^*),~ T^*(s_n^*|\\rho_0) = \\prod\\limits_{i=0}^n \\mathcal{T^*}(a_i^*|s_i^*)')
('3.2', 's_0^*=\\rho_0')
('3.2', 'T^*(\\rho_0|\\rho_0)=T_\\theta(\\rho_0|\\rho_0)=1')
('3.2', 's_i^*')
('3.2', '\\hat{s_n^*}')
('3.2', '\\hat{\\mathcal{P^*}}')
('3.2', '\\hat{s_n^\\theta}')
('3.2', '\\hat{\\mathcal{P_\\theta}}')
('3.2', 's_n^*')
('3.2', 's_n^\\theta')
('3.2', 'T_\\theta(s_n^*, \\rho_0) \\rightarrow T^*(s_n^*, \\rho_0)')
('3.2', 's_n^*')
('3.2', 's_n^*')
('3.2', 'T_\\theta(s_{n}^*, s_{n-1}^*) \\rightarrow T^*(s_{n}^*, s_{n-1}^*)')
('3.2', 's_n^\\theta')
('3.2', 's_n^\\theta')
('3.2', 'T_\\theta(\\hat{s_{n}^*}, s_{n-1}^\\theta) \\rightarrow T^*(\\hat{s_{n}^*}, s_{n-1}^\\theta)')
('3.2', 's_n^*')
('3.2', 's_n^\\theta')
('3.2', 'T_\\theta(s_n^*, \\rho_0) \\rightarrow T^*(s_n^*, \\rho_0)')
('3.2', 's_n^*')
('3.2', 's_n^{\\theta^-}')
('3.2', '\\hat{T_\\theta}(s_n^*, \\rho_0) \\rightarrow T^*(s_n^*, \\rho_0)')
('3.3', '\\mathcal{Z}')
('3.3', 'z \\in \\mathcal{Z}')
('3.3', '\\forall z \\in \\mathcal{Z}: 0 \\leq P(z) \\leq 1')
('3.3', '1 = \\sum_{z \\in \\mathcal{Z}}P(z)')
('3.3', 'z^*')
('3.3', '\\forall z \\in \\mathcal{Z}: 0 \\leq P(z) \\leq P(z^*) \\leq 1')
('3.3', '\\forall s \\in S: \\mathcal{T}_\\theta(\\pi^*(s), s) \\leq \\mathcal{T}_\\theta(\\pi_\\theta(s), s) \\leq 1')
('3.3', '\\forall n \\in [0,N], s_n^*\\in\\mathcal{S}_{\\rho_0}^*, s_n^\\theta\\in\\mathcal{S}_{\\rho_0}^\\theta: T_\\theta(s_{n}^*, \\rho_0) \\leq T_\\theta(s_{n}^\\theta, \\rho_0) \\leq 1')
('3.3', 'N')
('3.3', '\\hat{\\mathcal{P_\\theta}}(\\rho_0): \\rho_0 \\rightarrow [\\pi_\\theta(\\rho_0), \\pi_\\theta(s_1^*), \\pi_\\theta(s_2^*), \\ldots]')
('3.3', 'T_\\theta(s_{n}^*, s_{n-1}^*) \\rightarrow T^*(s_{n}^*, s_{n-1}^*)')
('3.3', 'T_\\theta(s_{n-1}^*, \\rho_0)=1')
('3.3', 'T_\\theta(s_{n}^*, \\rho_0)')
('3.3', 'T^*(s_{n}^*, \\rho_0)')
('3.3', '\\hat{\\mathcal{P^*}}(\\rho_0): \\rho_0 \\rightarrow [\\pi^*(\\rho_0), \\pi^*(s_1^\\theta), \\pi^*(s_2^\\theta), \\ldots]')
('3.3', 'T_\\theta(s_n^\\theta, \\rho_0)')
('3.3', 'T_\\theta(s_{n-1}^*, \\rho_0)')
('3.3', 'T_\\theta(\\hat{s_{n}^*}, s_{n-1}) \\rightarrow T^*(\\hat{s_{n}^*}, s_{n-1})')
('3.3', 'T_\\theta(s_n^\\theta, \\rho_0)=1')
('3.3', '\\hat{s_n^*}=\\pi^*(s_{n-1}^\\theta)')
('3.3', '\\pi^*(s_{n-1}^\\theta)')
('4.0', '\\hat{s_i^\\theta}')
('4.0', '\\delta_\\theta')
('4.0', '\\hat{s_i^\\theta} = \\delta_\\theta(s_i^*) \\\\ = (1-\\lambda)s_i^* + \\lambda\\pi_\\theta(s_{i-1}^*)')
('4.0', '\\hat{\\mathcal{P_\\theta}}(\\rho_0) = [(1-\\lambda)\\mathcal{P_\\theta}^{sft} + \\lambda\\mathcal{P_\\theta}^{truly}](\\rho_0)')
('4.1', '\\forall n \\in [0, N], \\rho_0\\in\\mathcal{D}, s_n^*\\in\\mathcal{S}_{\\rho_0}^*:\\hat{T_\\theta}(s_n^*, \\rho_0) \\rightarrow T^*(s_n^*, \\rho_0)')
('4.1', 's_0^*=\\rho_0')
('4.1', '\\hat{T_\\theta}(s_n^*, \\rho_0) = \\prod\\limits_{i=0}^{n-1}T_\\theta(s_{i+1}^*, \\hat{s_i^\\theta})')
('4.1', '\\mathcal{L}(\\hat{T_\\theta};T^*) = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_n^*\\sim\\mathcal{S}_{\\rho_0}^*}\n    \\left[\\sum\\limits_{n=0}^N\\log\\frac{\\hat{T_\\theta}(s_n^*, \\rho_0)}{T^*(s_n^*, \\rho_0)}\\right]')
('4.1', '\\forall n \\in [0, N], \\rho_0\\in\\mathcal{D}, s_n^*\\in\\mathcal{S}_{\\rho_0}^*: T^*(s_n^*, \\rho_0) = 1 = T^*(s_N^*, \\rho_0)')
('4.1', '\\mathcal{L}_{\\text{IFT}}(\\mathcal{T}_\\theta,\\delta_\\theta) \n    = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_i^*\\sim\\mathcal{S}_{\\rho_0}^*}\n    \\left[-\\sum\\limits_{n=0}^N\\sum\\limits_{i=n}^N\\log\\mathcal{T}_\\theta(a_i^*, \\delta_\\theta(s_i^*))\\right]')
('4.1', 'a_i^*=\\pi^*(s_i^*)')
('4.1', 'V_\\theta(\\hat{s_n^\\theta}) = \\exp\\bigg(-\\mathcal{L}\\big(\\hat{T_\\theta}(s_n^*, \\rho_0)\\big)\\bigg)')
('5.1', '\\alpha')
('5.1', '\\beta')
('5.1', '\\alpha')
('5.1', '\\beta')
('7.0', '\\mathcal{M}=(S, A, \\mathcal{T}, r, \\rho_0)')
('7.0', 'A')
('7.0', 'N_A')
('7.0', 'S')
('7.0', 'N_S=(N_A)^N')
('7.0', 'N')
('7.0', '\\rho_0')
('7.0', '\\mathcal{T} \\in R^{N_S \\times N_A}')
('7.0', 'r')
('7.1', 's_n^*')
('7.1', '\\rho_0')
('7.1', 'T^*(s_n^*, \\rho_0) = T^*(s_N^*, \\rho_0) = 1')
('7.1', '\\begin{aligned}\n        \\mathcal{L}(\\hat{T_\\theta}(s_n^*, \\rho_0))\n        &= \\log\\frac{\\hat{T_\\theta}(s_n^*, \\rho_0)}{T^*(s_n^*, \\rho_0)} \\\\\n        &= \\log\\frac{\\hat{T_\\theta}(s_n^*, \\rho_0)}{T^*(s_N^*, \\rho_0)} \\\\\n        &= \\log\\frac{1}{\\hat{T_\\theta}(s_N^*, s_n^*)} \\\\\n        &= -\\log\\prod\\limits_{i=n}^N \\mathcal{T}_\\theta(a_i^*, \\delta_\\theta(s_i^*)) \\\\\n        &= -\\sum\\limits_{i=n}^N\\log\\mathcal{T}_\\theta(a_i^*, \\delta_\\theta(s_i^*))\n    \\end{aligned}')
('7.1', '\\begin{aligned}\n        \\mathcal{L}_{\\text{IFT}}(\\mathcal{T}_\\theta,\\delta_\\theta)\n        & = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_n^*\\sim\\mathcal{S}_{\\rho_0}^*}\n        \\left[\\sum\\limits_{n=0}^N\\mathcal{L}\\big(\\hat{T_\\theta}(s_n^*, \\rho_0)\\big)\\right] \\\\\n        & = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_i^*\\sim\\mathcal{S}_{\\rho_0}^*}\n        \\left[-\\sum\\limits_{n=0}^N\\sum\\limits_{i=n}^N\\log\\mathcal{T}_\\theta(a_i^*, \\delta_\\theta(s_i^*))\\right]\n    \\end{aligned}')
('7.1', 's_0^*=\\rho_0')
('7.1', '\\mathcal{S}_{\\rho_0}^*')
('7.1', '\\rho_0')
('7.2', 's_n^*')
('7.2', '\\rho_0')
('7.2', '\\begin{aligned}\n        \\exp\\big(-\\mathcal{L}(\\hat{T_\\theta}(s_n^*, \\rho_0))\\big)\n        &=\\mathcal{T}_\\theta(a_n^*, \\delta_\\theta(s_n^*))\\bigg(\\sum\\limits_{n+1}^N\\mathcal{T}_\\theta(a_i^*, \\delta_\\theta(s_i^*))\\bigg) \\\\\n        &=\\max\\limits_{a}\\bigg[\\mathcal{T}_\\theta(a, s_n^*)\\big(r+\\gamma V(\\hat{s^\\theta_{n+1}})\\big)\\bigg] \\\\\n        &= V_\\theta(\\hat{s_n^\\theta})\n    \\end{aligned}')
('7.2', 'r=(1-\\gamma) V(\\hat{s^\\theta_{n+1}})')
('7.3', '\\mathcal{L}_{\\text{SFT}} \n    = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_i^*\\sim\\mathcal{S}_{\\rho_0}^*}\n    \\left[-\\sum\\limits_{i=0}^N\\log\\mathcal{T}_\\theta(\\pi^*(s_i^*), s_i^*)\\right]')
('7.3', 's_i^*')
('7.3', '\\mathcal{L}_{\\text{PPO}}\n    = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_i^*\\sim\\mathcal{S}_{\\rho_0}^*}\n    \\left[-\\sum\\limits_{i=0}^N \\mathcal{R}(\\pi_\\theta(s_i^\\theta),s_i^\\theta)\\right]')
('7.3', '\\mathcal{R} \\in (-\\infty, 0]')
('7.3', '\\pi^*')
('7.3', '\\mathcal{R}=\\pi_\\mathcal{R} \\leftarrow \\min\\limits_\\pi \\mathcal{L_R}')
('7.3', '\\mathcal{L_R}\n    = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_i^+\\sim\\mathcal{S}_{\\rho_0}^+, s_i^-\\sim\\mathcal{S}_{\\rho_0}^-}\n    \\left[-\\log\\sigma \\bigg(\\sum\\limits_{i=0}^N\\log\\mathcal{T_R}(\\pi^+(s_i^+)|s_i^+) - \\sum\\limits_{i=0}^N\\log\\mathcal{T_R}(\\pi^-(s_i^-)|s_i^-)\\bigg)\\right]')
('7.3', '\\mathcal{L}_{\\text{DPO}}\n    = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_i^*\\sim\\mathcal{S}_{\\rho_0}^*, s_i^\\theta\\sim\\mathcal{S}_{\\rho_0}^\\theta}\n    \\left[-\\log\\sigma\\bigg(\\sum\\limits_{i=0}^N\\log\\mathcal{T}_\\theta(\\pi^*(s_i^*), s_i^*)-\\sum\\limits_{i=0}^N\\log\\mathcal{T}_\\theta(\\pi_\\theta(s_i^\\theta),s_i^\\theta)\\bigg)\\right]')
('7.3', '\\mathcal{L}_{\\text{DPO}}\n    = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_i^+\\sim\\mathcal{S}_{\\rho_0}^+, s_i^-\\sim\\mathcal{S}_{\\rho_0}^-}\n    \\left[-\\log\\sigma\\bigg(\\sum\\limits_{i=0}^N\\log\\mathcal{T}_\\theta(\\pi^+(s_i^+), s_i^+)-\\sum\\limits_{i=0}^N\\log\\mathcal{T}_\\theta(\\pi^-(s_i^-),s_i^-)\\bigg)\\right]')
('7.3', 's^+')
('7.3', 's^*')
('7.3', 's^-')
('7.3', 's^\\theta')
('7.3', '\\mathcal{L}_{\\text{IFT}}\n    = \\mathbb{E}_{\\rho_0\\sim\\mathcal{D}}\\mathbb{E}_{s_i^*\\sim\\mathcal{S}_{\\rho_0}^*}\n    \\left[-\\sum\\limits_{n=0}^N\\sum\\limits_{i=n}^N\\log\\mathcal{T}_\\theta(a_i^*, \\delta_\\theta(s_i^*))\\right]')
('7.3', '\\delta_\\theta(s_i^*) = (1-\\lambda)s_i^* + \\lambda\\pi_\\theta(s_{i-1}^*)')
('8.0', '\\beta')
('8.0', '\\lambda')
('8.2', '\\rho_0')
('8.2', 's^*')
('8.2', 'N')
('8.2', 's^*[1], \\ldots, s^*[N]')
('8.2', 't')
('8.2', "P_t' = \\mathcal{\\pi_\\theta}(s^*[0:t-1])")
('8.2', "s^\\theta[t] = \\arg\\max P_t'")
('8.2', 's^*')
('8.2', 's^\\theta')
('8.2', 'E')
('8.2', 'e = (1-\\lambda)E(s^*) + \\lambda E(s^\\theta)')
('8.2', 't')
('8.2', "P_t'' = (\\mathcal{\\pi_\\theta}/E)(e[0:t-1])")
('8.2', "\\mathcal{L}_t = \\log(P_t'', s^*[t])")
('8.2', 'w_t = \\sum\\limits_{i=t}^N \\alpha^{N-t}\\mathcal{L}_i')
('8.2', '\\mathcal{L}_{\\text{IFT}} = w\\cdot\\mathcal{L}')
