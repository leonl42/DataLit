('2', 'L')
('2', '\\mathit{arity}: L \\rightarrow \\mathbb{Z}_{\\geq 0}')
('2', '(V, E, \\mathit{lab}, \\mathit{att}, \\mathit{ext})')
('2', 'V')
('2', 'E')
('2', '\\mathit{lab}: E \\rightarrow L')
('2', '\\mathit{att}: E \\rightarrow V^\\ast')
('2', 'e')
('2', '\\mathit{arity}(\\mathit{lab}(e))')
('2', '\\mathit{ext}\\in V^\\ast')
('2', '(V, E, \\mathit{lab}, \\mathit{att}, \\mathit{ext})')
('2', 'D')
('2', 'F')
('2', 'D')
('2', 'D')
('2', 'F')
('2', '\\ell')
('2', 'F(\\ell) : D^{\\mathit{arity}(\\ell)} \\rightarrow \\mathbb{R}_{\\geq 0}')
('2', 'F(e)')
('2', 'F(\\mathit{lab}(e))')
('2', 'e')
('2', 'F(e)')
('2', 'S')
('2', '\\mathbf{N}')
('2', '\\mathbf{W}')
('2', 'e')
('2', 'F(e)')
('2', '1')
('2', '0')
('2', 'H = (V, E, \\mathit{lab}, \\mathit{att}, \\mathit{ext})')
('2', '\\xi: V \\rightarrow D')
('2', '\\Xi_H')
('2', 'H')
('2', '\\xi')
('2', 'w_H(\\xi) = \\prod_{e\\in E} F(e)\\bigl(\\xi(\\mathit{att}(e)_1), \\ldots, \\xi(\\mathit{att}(e)_{|\\mathit{att}(e)|})\\bigr).')
('2', '\\xi: \\mathit{ext}\\rightarrow D')
('2', "w_{\\mathit{ext}}(\\xi) = \\sum_{\\mathclap{\\substack{\\xi' \\in \\Xi_H \\\\ \\left.\\xi'\\right|_{\\mathit{ext}} = \\xi}}} w_H(\\xi').")
('2', '(N, T, P, S)')
('2', 'N \\subseteq L')
('2', 'T \\subseteq L')
('2', 'N')
('2', 'P')
('2', '(X \\rightarrow R)')
('2', 'X \\in N')
('2', 'R')
('2', 'N \\cup T')
('2', '\\mathit{arity}(X)')
('2', 'S \\in N')
('2', '\\mathit{arity}(S) = 0')
('2', 'G')
('2', 'X')
('2', 'X')
('2', 'G')
('2', '\\mathcal{D}_G(X)')
('2', '(R, s)')
('2', '(X \\rightarrow R) \\in G')
('2', 's')
('2', 'e')
('2', 'R')
('2', '\\mathit{lab}(e)')
('2', 'G')
('2', 'G')
('2', '\\mathcal{D}_G = \\mathcal{D}_G(S)')
('2', 'X')
('2', 'T = (R, s)')
('2', '\\mathit{arity}(X)')
('2', 'R')
('2', 'T')
('2', 'e \\in R')
('2', 'H_e')
('2', 's(e)')
('2', 'e')
('2', 'H_e')
('2', '\\mathit{att}(e)_i')
('2', 'e')
('2', 'i')
('2', 'H_e')
('2', '\\mathit{att}(e)_i')
('2', 'D')
('2', 'F')
('2', 'F')
('2', "\\mathsf{S'}")
('2', 'X')
('2', 'X')
('2', 'D')
('2', 'F')
('2', 'X')
('2', '\\xi\\in D^{\\mathit{arity}(X)}')
('2', '\\xi')
('2', 'w_{X}(\\xi) =\n    \\sum_{T \\in \\mathcal{D}(X)}\n    w_{\\mathit{ext}_T}(\\xi),')
('2', '\\mathit{ext}_T')
('2', 'T')
('2', 'S')
('2', 'w_S')
('2', 'w_S')
('2', 'w_S')
('3', 'x')
('3', 'f')
('3', '\\begin{aligned}\n&\\text{Programs} & q &\\mathrel{::=}e\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textbf{fun}~f(x_1, \\ldots, x_n) = e ; q \\\\\n&\\text{Expressions} & e &\\mathrel{::=}x\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textbf{let}~x_1 = e_2~\\textbf{in}~e_3\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}f(e_1, \\ldots, e_n)\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textbf{sample}~e_1\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textbf{observe}~e_1 \\leftarrow e_2\n    \\\\\n&&& \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textbf{if}~e_1~\\textbf{then}~e_2~\\textbf{else}~e_3\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textbf{case}~e_1~\\textbf{of}~\\ensuremath{\\textit{inl\\/}(x_2)} \\Rightarrow e_2 \\mathrel{|}\\ensuremath{\\textit{inr\\/}(x_3)} \\Rightarrow e_3\n\\end{aligned}')
('3', '\\mathord=')
('3', '\\mathord{\\neq}')
('3', '\\mathit{true}')
('3', '\\mathit{false}')
('3', '\\textbf{and}')
('3', '\\textbf{or}')
('3', '\\begin{aligned}\ne_1~\\textbf{and}~e_2 &\\equiv \\textbf{if}~e_1~\\textbf{then}~e_2~\\textbf{else}~\\textit{false} &\ne_1~\\textbf{or}~e_2 &\\equiv \\textbf{if}~e_1~\\textbf{then}~\\textit{true}~\\textbf{else}~e_2\n\\end{aligned}')
('3', '\\textbf{sample}~e_1')
('3', 'e_1')
('3', '\\textbf{observe}~e_1 \\leftarrow e_2')
('3', 'e_2')
('3', 'e_1')
('3', '\\textbf{observe}')
('3', 'e_2')
('3', 'D')
('3', 'e')
('3', 'e')
('3', 'f')
('3', 'f')
('4', 'e')
('4', 'f')
('4', 'e')
('4', 'f')
('4', 'e')
('4', 'k')
('4', 'f')
('4', 'k')
('4', 'k+1')
('4', 'x_1, \\ldots, x_k')
('4', 'v')
('4', 'i=1, \\ldots, k')
('4', 'e')
('4', 'f')
('4', '(k+1)')
('4', 'w_e')
('4', 'w_f')
('4.0', '\\begin{aligned}\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$\\textbf{sample}~e_1$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f1) {$e_1$} edge (xi);\n\\node[var,right=of f1](v1) {$v_1$} edge (f1);\n\\node[fac,right=of v1,label={[overlay]above:$v_1(v)$}](f2) {} edge (v1);\n\\node[ext,right=of f2](v) {$v$} edge (f2);\n\\end{tikzpicture} \\\\\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$\\textbf{observe}~e_1 \\leftarrow e_2$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f1) {$e_2$} edge (xi);\n\\node[var,right=of f1](v1) {$v_2$} edge (f1);\n\\node[fac,right=of v1,label=below:{$v_2(v)$}](f3) {} edge (v1);\n\\node[ext,right=of f3](v) {$v$} edge (f3);\n\\node[fac,above right=of xi.east](f2) {$e_1$} edge (xi) edge[out=0,in=135] (v);\n\\end{tikzpicture}\n\\end{aligned}')
('4.1', '\\begin{aligned}\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$\\textbf{if}~e_1~\\textbf{then}~e_2~\\textbf{else}~e_3$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,above right=of xi.east](f1) {$e_1$} edge (xi);\n\\node[var,right=of f1](v1) {$v_1$} edge (f1);\n\\node[fac,right=of v1,label=above:{$v_1=\\textit{true}$}] {} edge (v1);\n\\node[fac,right=of xi](f2) {$e_2$} edge (xi);\n\\node[ext,right=of f2](v2) {$v$} edge (f2);\n\\end{tikzpicture} \\\\\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$\\textbf{if}~e_1~\\textbf{then}~e_2~\\textbf{else}~e_3$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,above right=of xi.east](f1) {$e_1$} edge (xi);\n\\node[var,right=of f1](v1) {$v_1$} edge (f1);\n\\node[fac,right=of v1,label=above:{$v_1=\\textit{false}$}] {} edge (v1);\n\\node[fac,right=of xi](f2) {$e_3$} edge (xi);\n\\node[ext,right=of f2](v2) {$v$} edge (f2);\n\\end{tikzpicture}\n\\end{aligned}')
('4.1', '\\textbf{case}')
('4.1', '\\textbf{case}')
('4.1', '\\textbf{if}')
('4.1', '\\begin{aligned}\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$\\begin{aligned}\\textbf{case}~e_1~\\textbf{of}~&\\ensuremath{\\textit{inl\\/}(y_2)} \\Rightarrow e_2 \\\\ \\mathrel{|}{} &\\ensuremath{\\textit{inr\\/}(y_3)} \\Rightarrow e_3\\end{aligned}$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,below right=of xi.east](f1) {$e_1$} edge (xi);\n\\node[var,right=of f1](v1) {$v_1$} edge (f1);\n\\node[fac,right=of v1,label=below:{$v_1=\\ensuremath{\\textit{inl\\/}(y_2)}$}](f1a) {} edge (v1);\n\\node[var,right=of f1a](y2) {$y_2$} edge (f1a);\n\\node[fac,above right=of y2.east](f2) {$e_2$} edge (xi) edge (y2);\n\\node[ext,right=of f2](v2) {$v$} edge (f2);\n\\end{tikzpicture} \\\\\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$\\begin{aligned}\\textbf{case}~e_1~\\textbf{of}~&\\ensuremath{\\textit{inl\\/}(y_2)} \\Rightarrow e_2 \\\\ \\mathrel{|}{} &\\ensuremath{\\textit{inr\\/}(y_3)} \\Rightarrow e_3\\end{aligned}$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,below right=of xi.east](f1) {$e_1$} edge (xi);\n\\node[var,right=of f1](v1) {$v_1$} edge (f1);\n\\node[fac,right=of v1,label=below:{$v_1=\\ensuremath{\\textit{inr\\/}(y_3)}$}](f1a) {} edge (v1);\n\\node[var,right=of f1a](y2) {$y_3$} edge (f1a);\n\\node[fac,above right=of y2.east](f2) {$e_3$} edge (xi) edge (y2);\n\\node[ext,right=of f2](v2) {$v$} edge (f2);\n\\end{tikzpicture}\n\\end{aligned}')
('4.2', '\\textbf{fun}~f(x_1, \\ldots, x_n) = e')
('4.2', '\\begin{aligned}\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$f$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$e$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n\\\\\n\\intertext{Inside the function body, variables evaluate to their value in the environment:}\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$x_j$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[ext,right=of xi](xj) {$x_j$};\n\\node[plate,fit=(xi),label=below:{$i\\neq j$}] {};\n\\node[fac,right=of xj,label=below:{$v=x_j$}](f) {} edge (xj);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture} \\\\\n\\intertext{And function calls become:}\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$f(e_1, \\ldots, e_n)$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f1) {$e_j$} edge (xi);\n\\node[var,right=of f1](v1) {$v_j$} edge (f1);\n\\node[plate,fit=(f1)(v1),label=below:{$j=1, \\ldots, n$}] {};\n\\node[fac,right=of v1](f) {$f$} edge (v1);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n\\end{aligned}')
('4.2', 'f')
('4.2', 'f')
('4.2', '\\textbf{let}')
('4.2', '\\begin{aligned}\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$\\textbf{let}~x=e_1~\\textbf{in}~e_2$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,below right=of xi](f1) {$e_1$} edge (xi);\n\\node[var,right=of f1](v1) {$x$} edge (f1);\n\\node[right=of f1.east](c) {$\\phantom{e_2}$};\n\\node[fac,right=of v1](f2) at (xi-|c) {$e_2$} edge (v1) edge (xi);\n\\node[ext,right=of f2](v) {$v$} edge (f2);\n\\end{tikzpicture}\n\\end{aligned}')
('4.3', '\\begin{aligned}\n  c &\\mathrel{::=}\\mathord{=} \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\mathord{\\neq}\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textit{true} \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textit{false}\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}(,) \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textit{fst} \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textit{snd}\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textit{inl} \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textit{inr}\n    \\mathrel{\\makebox[\\widthof{$\\mathrel{::=}$}]{$|$}}\\textit{unit}\n\\end{aligned}')
('4.3', '\\begin{aligned}\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f) {$c(e_1, \\ldots, e_n)$} edge (xi);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[ext](xi) {$x_i$};\n\\node[plate,fit=(xi)] {};\n\\node[fac,right=of xi](f1) {$e_j$} edge (xi);\n\\node[var,right=of f1](v1) {$v_j$} edge (f1);\n\\node[plate,fit=(f1)(v1),label=below:{$j=1, \\ldots, n$}] {};\n\\node[fac,right=of v1,label={[xshift=1cm]below:$v=c(v_1, \\ldots, v_n)$}](f) {} edge (v1);\n\\node[ext,right=of f](v) {$v$} edge (f);\n\\end{tikzpicture}\n\\end{aligned}')
('4.4', 'e')
('4.4', 'q')
('4.4', '\\begin{aligned}\n\\begin{tikzpicture}\n\\node[fac](s) {$S$};\n\\node[ext,right=of s] {$v$} edge (s);\n\\end{tikzpicture}\n&\\longrightarrow\n\\begin{tikzpicture}\n\\node[fac](e) {$e$};\n\\node[ext,right=of e] {$v$} edge (e);\n\\end{tikzpicture}\n\\end{aligned}')
('4.4', 'S')
('5', 'X')
('5', 'p[X]')
('5', '\\ensuremath{\\textit{inl\\/}(a)}')
('5', 'a')
('5', '\\ensuremath{\\textit{inr\\/}(Y, Z)}')
('5', 'Y')
('5', 'Z')
('5', 'v = x_j')
('5', 'x_j')
('5', 'v')
('5', 'w')
('5', 'w')
('5', 'w_S')
('5', 'w')
('5', "w'")
('5', 'v_{25}')
('5', 'O(n^3)')
