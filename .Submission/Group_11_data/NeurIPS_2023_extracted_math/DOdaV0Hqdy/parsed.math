('1', 'n')
('1', 'n')
('1', 'K')
('1', 'K = 2')
('1', 'K')
('1', 'K')
('2', 'n')
('2', 't \\in [n]')
('2', 'K')
('2', 'A_t')
('2', 't')
('2', 'A_t')
('2', 'A_{t, *}')
('2', 'A_t')
('2', 't')
('2', 'A_t')
('2', 'A_{t, *}')
('2', 't')
('2', 'x_t \\in \\mathcal{X}')
('2', '\\mathcal{X}')
('2', 'L')
('2', '\\mathcal{A}= [L]')
('2', 'L')
('2', '\\pi_0')
('2', 'K')
('2', 'A_t = (a_{t, i})_{i = 1}^K')
('2', '\\mathcal{A}')
('2', 'a_{t, i} \\in \\mathcal{A}')
('2', 'i')
('2', 'A_t')
('2', 'A_{t, *} = (a_{t, *, i})_{i = 1}^K')
('2', 'K < L')
('2', 'L')
('2', 'K = 2')
('2', 'K > 2')
('2', 'K')
('2', '\\pi(a \\mid x)')
('2', '\\pi')
('2', 'a \\in \\mathcal{A}')
('2', 'x \\in \\mathcal{X}')
('2', 'K')
('2', 'A = (a_i)_{i = 1}^K')
('2', '\\pi(\\cdot \\mid x)')
('2', '\\begin{aligned}\n  \\pi(A \\mid x)\n  = \\prod_{i = 1}^K \\frac{\\pi(a_i \\mid x)}\n  {\\sum_{j = i}^L \\pi(a_j \\mid x)}\\,,\n  \\label{eq:policy}\n\\end{aligned}')
('2', 'a_{k + 1}, \\dots, a_L')
('2', '\\mathcal{A}\\setminus A')
('2', '\\pi(a_1 \\mid x)')
('2', '\\pi(a_2 \\mid x) / \\sum_{j = 2}^L \\pi(a_j \\mid x)')
('2', 'i')
('2', '\\pi(a_i \\mid x) / \\sum_{j = i}^L \\pi(a_j \\mid x)')
('2', 'L')
('2', 'x')
('2', '\\tilde{\\pi}(a \\mid x)')
('2', 'a')
('2', "\\pi(a \\mid x) = \\tilde{\\pi}(a \\mid x) / \\sum_{a' \\in \\mathcal{A}} \\tilde{\\pi}(a' \\mid x)")
('2', 't')
('2', 'A_t')
('2', 'A_{t, *}')
('2', 't')
('2', '\\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\}')
('2', '\\begin{aligned}\n  r(x_t, A_t)\n  = \\mathbb{P} \\left(a_{t, 1} = a_{t, *, 1} \\,\\middle|\\, x_t, A_t\\right)\\,,\n  \\label{eq:reward}\n\\end{aligned}')
('2', 'A_{t, *}')
('2', 'A_t')
('2', 'A_{t, *}')
('2', 'A_t')
('2', 'x_t')
('2', 'a_{t, *, 1}')
('2', 'a_{t, 1}')
('2', 'K')
('2', 'K = 1')
('2', '\\begin{aligned}\n  r(x, A; w)\n  = \\frac{\\exp[\\phi(x, a_1)^\\top w]}{\\sum_{i = 1}^K \\exp[\\phi(x, a_i)^\\top w]}\\,,\n  \\label{eq:reward model}\n\\end{aligned}')
('2', 'A = (a_i)_{i = 1}^K')
('2', 'K')
('2', '\\phi: \\mathcal{X}\\times \\mathcal{A}\\to \\mathbb{R}^d')
('2', 'w \\in \\mathbb{R}^d')
('2', 'w_*')
('2', 'A_1')
('2', 'w')
('2', 'A')
('2', '\\pi')
('2', 'n')
('2', '(x_t)_{t = 1}^n')
('2', '\\begin{aligned}\n  V(\\pi)\n  = \\frac{1}{n} \\sum_{t = 1}^n \\mathbb{E}_{A_t \\sim \\pi(\\cdot \\mid x_t)} \\left[r(x_t, A_t)\\right]\\,.\n  \\label{eq:policy value}\n\\end{aligned}')
('2', '\\pi_0')
('2', 'x_t \\sim p')
('2', 'p')
('3', '\\pi')
('3', 'V(\\pi)')
('3', 'A_t')
('3', 'A_{t, *}')
('3', '\\begin{aligned}\n  \\hat{V}(\\pi)\n  = \\frac{1}{n} \\sum_{t = 1}^n \\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\}\\,.\n  \\label{eq:counter}\n\\end{aligned}')
('3', 'A_t \\sim \\pi_0(\\cdot \\mid x_t)')
('3', '\\pi_0')
('3', 'V(\\pi)')
('3.0', 'w')
('3.0', '\\begin{aligned}\n  \\hat{w}\n  = \\mathop{\\mathrm{arg\\,max\\,}}_w \\sum_{t = 1}^n \\sum_{i = 1}^K\n  \\log\\left(\\frac{\\exp[\\phi(x_t, a_{t, *, i})^\\top w]}\n  {\\sum_{j = i}^K \\exp[\\phi(x_t, a_{t, *, j})^\\top w]}\\right)\\,.\n  \\label{eq:reward model estimation}\n\\end{aligned}')
('3.0', 'K')
('3.0', '\\pi')
('3.0', '\\begin{aligned}\n  \\hat{V}_\\textsc{dm}(\\pi)\n  = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{A \\sim \\pi(\\cdot \\mid x_t)} \\left[r(x_t, A; \\hat{w})\\right]\\,,\n  \\label{eq:dm}\n\\end{aligned}')
('3.0', 'r(x, A; \\hat{w})')
('3.0', 'a_1')
('3.0', 'A')
('3.0', 'a')
('3.0', 'A')
('3.0', '\\pi')
('3.0', '\\pi(A \\mid x_t)')
('3.0', 'L')
('3.1', '\\pi_0')
('3.1', '\\pi')
('3.1', 'A_t \\sim \\pi(\\cdot \\mid x_t)')
('3.1', '\\begin{aligned}\n  \\hat{V}_\\textsc{ips}(\\pi)\n  = \\frac{1}{n} \\sum_{t = 1}^n\n  \\frac{\\pi(A_t \\mid x_t)}{\\pi_0(A_t \\mid x_t)}\n  \\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\}\\,.\n  \\label{eq:ips}\n\\end{aligned}')
('3.1', '\\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\}')
('3.1', '\\pi(A_t \\mid x_t) / \\pi_0(A_t \\mid x_t)')
('3.1', '\\pi')
('3.1', '\\pi_0')
('3.1', '\\pi(A_t \\mid x_t) / \\pi_0(A_t \\mid x_t)')
('3.1', '\\pi(A \\mid x_t)')
('3.1', 'L')
('3.1', 'L')
('3.1', '\\begin{aligned}\n  \\hat{V}_\\textsc{dr}(\\pi)\n  = \\frac{1}{n} \\sum_{t = 1}^n\n  \\frac{\\pi(A_t \\mid x_t)}{\\pi_0(A_t \\mid x_t)}\n  (\\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\} - r(x_t, A_t; \\hat{w})) + \\hat{V}_\\textsc{dm}(\\pi)\\,.\n  \\label{eq:dr}\n\\end{aligned}')
('3.1', '\\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\}')
('3.1', '\\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\} - r(x_t, A_t; \\hat{w})')
('3.1', 'L')
('3.2', 'S_t')
('3.2', 'A_t')
('3.2', '\\nu(S_t \\mid x_t)')
('3.2', 'S_t')
('3.2', 't')
('3.2', '\\pi')
('3.2', '\\pi(A \\mid x)')
('3.2', '\\nu(S \\mid x)')
('3.2', '\\begin{aligned}\n  \\textstyle\n  \\nu(S \\mid x)\n  = \\sum_{A \\in \\Pi(S)} \\pi(A \\mid x)\\,,\n  \\label{eq:lists to sets}\n\\end{aligned}')
('3.2', 'x')
('3.2', 'S')
('3.2', '\\Pi(S)')
('3.2', 'S')
('3.2', "\\begin{aligned}\n  \\pi(a \\mid S, x)\n  = \\frac{\\pi(a \\mid x)}{\\sum_{a' \\in S} \\pi(a' \\mid x)}\n\\end{aligned}")
('3.2', '\\pi')
('3.2', 'a')
('3.2', 'S')
('3.2', 'x')
('3.2', 'A_t')
('3.2', 'x_t')
('3.2', 'S_t')
('3.2', '\\mathcal{S}')
('3.2', '\\mathcal{A}')
('3.2', 'K')
('3.2', '\\pi')
('3.2', '\\begin{aligned}\n  V(\\pi)\n  & = \\frac{1}{n} \\sum_{t = 1}^n \\sum_{S_t \\in \\mathcal{S}} \\sum_{A_t \\in \\Pi(S_t)}\n  \\pi(A_t \\mid x_t) \\, r(x_t, A_t) \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n \\sum_{S_t \\in \\mathcal{S}} \\nu(S_t \\mid x_t)\n  \\sum_{A_t \\in \\Pi(S_t)} \\frac{\\pi(A_t \\mid x_t)}{\\nu(S_t \\mid x_t)} \\, r(x_t, A_t) \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n \\sum_{S_t \\in \\mathcal{S}} \\nu(S_t \\mid x_t) \\,\n  \\mathbb{E} \\left[\\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\} \\,\\middle|\\, x_t, S_t\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n \\sum_{S_t \\in \\mathcal{S}} \\nu(S_t \\mid x_t) \\,\n  \\mathbb{E} \\left[\\sum_{a \\in \\mathcal{A}} \\pi(a \\mid S_t, x_t) \\, \\mathds{1} \\! \\left\\{a_{t, *, 1} = a\\right\\} \\,\\middle|\\, x_t, S_t\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n \\sum_{S_t \\in \\mathcal{S}} \\nu(S_t \\mid x_t) \\,\n  \\mathbb{E} \\left[\\pi(a_{t, *, 1} \\mid S_t, x_t) \\,\\middle|\\, x_t, S_t\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{S_t \\sim \\nu(\\cdot \\mid x_t)} \\left[\\pi(a_{t, *, 1} \\mid S_t, x_t)\\right]\\,.\n\\end{aligned}')
('3.2', 'A_{t, *}')
('3.2', 'S_t')
('3.2', 'A_{t, *}')
('3.2', 'S_t \\sim \\nu(\\cdot \\mid x_t)')
('3.2', 'V(\\pi)')
('3.2', '\\begin{aligned}\n  \\hat{V}_\\textsc{set}(\\pi)\n  = \\frac{1}{n} \\sum_{t = 1}^n \\pi(a_{t, *, 1} \\mid S_t, x_t)\\,.\n  \\label{eq:soft counter}\n\\end{aligned}')
('3.2', 'A_t \\mid S_t')
('3.2', 'S_t \\sim \\nu_0(\\cdot \\mid x_t)')
('3.2', '\\begin{aligned}\n  \\hat{V}_\\textsc{set-ips}(\\pi)\n  = \\frac{1}{n} \\sum_{t = 1}^n\n  \\frac{\\nu(S_t \\mid x_t)}{\\nu_0(S_t \\mid x_t)}\n  \\pi(a_{t, *, 1} \\mid S_t, x_t)\\,.\n  \\label{eq:set ips}\n\\end{aligned}')
('3.2', '\\tt SetIPS')
('3.2', 'K')
('3.2', 'K')
('3.2', 'K \\to L')
('3.2', 'K = L')
('3.2', '\\nu(S_t \\mid x_t) = \\nu_0(S_t \\mid x_t) = 1')
('3.2', '\\tt SetIPS')
('3.2', 'L')
('3.2', '\\tt SetDR')
('3.2', '\\pi')
('3.2', 'S')
('3.2', 'r(x, A; w)')
('3.2', '\\begin{aligned}\n  r(x, S; \\pi, w)\n  = \\sum_{A \\in \\Pi(S)} \\frac{\\pi(A \\mid x)}{\\nu(S \\mid x)} r(x, A; w)\\,.\n\\end{aligned}')
('3.2', '\\tt SetIPS')
('3.2', '\\begin{aligned}\n  \\hat{V}_\\textsc{set-dr}(\\pi)\n  = \\frac{1}{n} \\sum_{t = 1}^n\n  \\frac{\\nu(S_t \\mid x_t)}{\\nu_0(S_t \\mid x_t)}\n  (\\pi(a_{t, *, 1} \\mid S_t, x_t) - r(x_t, S_t; \\pi, \\hat{w})) +\n  \\hat{V}_\\textsc{dm}(\\pi)\\,.\n  \\label{eq:set dr}\n\\end{aligned}')
('4', '\\pi(a \\mid x; \\theta)')
('4', '\\pi')
('4', '\\theta \\in \\mathbb{R}^d')
('4', '\\begin{aligned}\n  \\hat{V}(\\pi) - \\gamma \\frac{1}{n} \\sum_{t = 1}^n\n  d(\\pi(\\cdot \\mid x_t; \\theta), \\pi_0(\\cdot \\mid x_t))\\,,\n  \\label{eq:optimized objective}\n\\end{aligned}')
('4', 'd(p, q)')
('4', 'p')
('4', 'q')
('4', '\\mathcal{A}')
('4', '\\gamma > 0')
('4', '\\pi')
('4', '\\pi_0')
('4', '\\theta')
('4', '\\begin{aligned}\n  \\nabla \\hat{V}(\\pi) - \\gamma \\frac{1}{n} \\sum_{t = 1}^n\n  \\nabla d(\\pi(\\cdot \\mid x_t; \\theta), \\pi_0(\\cdot \\mid x_t))\\,.\n  \\label{eq:optimized gradient}\n\\end{aligned}')
('4', '\\nabla \\hat{V}(\\pi)')
('4', '\\tilde{A}_t \\sim \\pi(\\cdot \\mid x_t; \\theta)')
('4', '\\nabla d(\\pi(\\cdot \\mid x_t; \\theta), \\pi_0(\\cdot \\mid x_t))')
('4', '\\begin{aligned}\n  (\\nabla \\log \\pi(\\tilde{A}_t \\mid x_t; \\theta))\n  (1 + \\log \\pi(\\tilde{A}_t \\mid x_t; \\theta) - \\log \\pi_0(\\tilde{A}_t \\mid x_t))\\,.\n\\end{aligned}')
('4', 'L')
('5.0', 'L = 7')
('5.0', '7! = 5\\,040')
('5.0', 'K = L')
('5.0', 'x \\in \\mathcal{X}')
('5.0', 'u_x \\in [-1, 1]^4')
('5.0', 'a \\in \\mathcal{A}')
('5.0', 'v_a \\in [-1, 1]^4')
('5.0', 'x')
('5.0', 'a')
('5.0', '\\phi(x, a) = \\mathrm{vec}(u_x v_a^\\top)')
('5.0', 'd = 16')
('5.0', 'w_* \\sim \\mathcal{N}(\\mathbf{0}_d, 10^2 I_d)')
('5.0', '\\begin{aligned}\n  \\pi(a \\mid x; \\theta)\n  = \\frac{\\exp[\\phi(x, a)^\\top\\theta]}{\\sum_{i = 1}^L \\exp[\\phi(x, i)^\\top\\theta]}\\,.\n  \\label{eq:parametric policy}\n\\end{aligned}')
('5.0', '\\theta_0 = w_* + \\varepsilon_0')
('5.0', '\\varepsilon_0 \\sim \\mathcal{N}(\\mathbf{0}_d, 5^2 I_d)')
('5.0', '5^2')
('5.0', 'w_*')
('5.0', 'N = 5')
('5.0', '\\theta_i = \\theta_0 + \\varepsilon_i')
('5.0', '\\varepsilon_i \\sim \\mathcal{N}(\\mathbf{0}, \\sigma_e^2 I)')
('5.0', '\\sigma_e > 0')
('5.0', '\\theta_i')
('5.0', '\\theta_0')
('5.0', '\\sigma_e = 5')
('5.0', '\\frac{1}{N} \\sum_{i = 1}^N |V(\\theta_i) - \\hat{V}(\\theta_i)|')
('5.0', '50')
('5.0', 'w_*')
('5.0', '\\theta_0')
('5.0', '\\theta_i')
('5.0', 'K = 2')
('5.0', 'n = 3\\,000')
('5.0', 'K')
('5.0', 'n')
('5.0', '\\sigma_\\phi')
('5.0', 'K')
('5.0', '\\tt SetDR')
('5.0', 'K = L')
('5.0', '\\tt SetIPS')
('5.0', 'K = L')
('5.0', 'n')
('5.0', '\\mathcal{N}(0, \\sigma_\\phi^2)')
('5.0', '\\phi(x, a)')
('5.0', '\\sigma_\\phi')
('5.0', '\\sigma_\\phi = 1')
('5.0', 'K')
('5.0', '\\tt SetIPS')
('5.0', 'K > 4')
('5.0', 'n')
('5.0', '\\sigma_\\phi')
('5.0', 'K = 6')
('5.1', '\\begin{aligned}\n  \\frac{2}{N (N - 1)} \\sum_{i = 1}^N \\sum_{j = i + 1}^N\n  \\mathds{1} \\! \\left\\{\\mathop{\\mathrm{sgn}}(\\hat{V}(\\theta_i) - \\hat{V}(\\theta_j)) \\neq \\mathop{\\mathrm{sgn}}(V(\\theta_i) - V(\\theta_j))\\right\\}\\,.\n\\end{aligned}')
('5.1', '\\tt SetDR')
('5.1', 'K')
('5.1', 'n')
('5.1', '\\sigma_\\phi')
('5.2', '500')
('5.2', '7')
('5.2', 'n = 500')
('5.2', 'L = 7')
('5.2', '768')
('5.2', '\\pi_L(a \\mid x)')
('5.2', '\\pi_P(a \\mid x)')
('5.2', '\\pi_P(a \\mid x)')
('5.2', '\\begin{aligned}\n  \\pi_\\alpha(a \\mid x)\n  = (1 - \\alpha) \\pi_P(a \\mid x) + \\alpha \\pi_L(a \\mid x)\n\\end{aligned}')
('5.2', '\\alpha \\in [0, 1]')
('5.2', '\\alpha = 0')
('5.2', '\\alpha = 1')
('5.2', '\\alpha \\to 1')
('5.2', '\\pi_L(a \\mid x)')
('5.2', '\\pi_P(a \\mid x)')
('5.2', '\\alpha \\in [0, 1]')
('5.2', 'K > 2')
('5.2', '\\tt SetIPS')
('5.2', '\\tt SetDR')
('5.2', 'K')
('5.2', 'K = 2')
('5.2', '0.5')
('5.2', '0.5')
('5.2', '\\alpha \\to 1')
('5.3', 'K = 2')
('5.3', '\\theta_0 = \\mathbf{0}_d')
('5.3', 'K = 2')
('5.3', 'K = 4')
('5.3', '\\gamma = 0.001')
('5.3', 'n = 1\\,000')
('5.3', '50')
('5.3', '\\tt SetDR')
('6', 'K')
('6', 'L > K')
('6', 'L \\gg K')
('6', '\\begin{aligned}\n  \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{a \\sim \\pi(\\cdot \\mid x_t; \\theta)} \\left[r_\\textsc{rlhf}(x_t, a)\\right] -\n  \\gamma d(\\pi(\\cdot \\mid x_t; \\theta), \\pi_0(\\cdot \\mid x_t))\\,,\n  \\label{eq:rlhf}\n\\end{aligned}')
('6', 'r_\\textsc{rlhf}(x, a)')
('6', 'a')
('6', 'x')
('6', 'd(p, q)')
('6', 'p')
('6', 'q')
('6', '\\mathcal{A}')
('6', '\\gamma > 0')
('6', '\\theta')
('6', 'r_\\textsc{rlhf}(x, a) = \\phi(x, a)^\\top w')
('6', '\\phi')
('6', 'w')
('6', '\\theta')
('6', '\\phi(x, a)^\\top w_\\textsc{rlhf}')
('6', '\\begin{aligned}\n  \\sum_{t = 1}^n \\log \\sigma\\left(\n  \\gamma \\log\\left(\\frac{\\pi(A_{t, *, 1} \\mid x_t; \\theta)}\n  {\\pi(A_{t, *, 1} \\mid x_t; \\theta_0)}\\right) -\n  \\gamma \\log\\left(\\frac{\\pi(A_{t, *, 2} \\mid x_t; \\theta)}\n  {\\pi_0(A_{t, *, 2} \\mid x_t)}\\right)\\right)\\,,\n  \\label{eq:dpo}\n\\end{aligned}')
('6', 'A_{t, *} = (A_{t, *, 1}, A_{t, *, 2})')
('6', '\\sigma(v) = 1 / (1 + \\exp[v])')
('8', '\\hat{V}(\\pi)')
('8', '\\mathbb{E} \\left[\\hat{V}(\\pi)\\right] = V(\\pi)')
('8', '\\begin{aligned}\n  \\mathbb{E} \\left[\\hat{V}(\\pi)\\right]\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{A_t \\sim \\pi(\\cdot \\mid x_t), \\, A_{t, *} \\sim \\cdot \\mid x_t, A_t} \\left[\\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\}\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{A_t \\sim \\pi(\\cdot \\mid x_t)} \\left[\\mathbb{P} \\left(a_{t, 1} = a_{t, *, 1} \\,\\middle|\\, x_t, A_t\\right)\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{A_t \\sim \\pi(\\cdot \\mid x_t)} \\left[r(x_t, A_t)\\right]\n  = V(\\pi)\\,.\n\\end{aligned}')
('8', '\\hat{V}_\\textsc{ips}(\\pi)')
('8', '\\mathbb{E} \\left[\\hat{V}_\\textsc{ips}(\\pi)\\right] = V(\\pi)')
('8', '\\begin{aligned}\n  \\mathbb{E} \\left[\\hat{V}_\\textsc{ips}(\\pi)\\right]\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{A_t \\sim \\pi_0(\\cdot \\mid x_t), \\, A_{t, *} \\sim \\cdot \\mid x_t, A_t} \\left[\\frac{\\pi(A_t \\mid x_t)}{\\pi_0(A_t \\mid x_t)}\n  \\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\}\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{A_t \\sim \\pi_0(\\cdot \\mid x_t)} \\left[\\frac{\\pi(A_t \\mid x_t)}{\\pi_0(A_t \\mid x_t)}\n  \\mathbb{P} \\left(a_{t, 1} = a_{t, *, 1} \\,\\middle|\\, x_t, A_t\\right)\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{A_t \\sim \\pi(\\cdot \\mid x_t)} \\left[\\mathbb{P} \\left(a_{t, 1} = a_{t, *, 1} \\,\\middle|\\, x_t, A_t\\right)\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{A_t \\sim \\pi(\\cdot \\mid x_t)} \\left[r(x_t, A_t)\\right]\n  = V(\\pi)\\,.\n\\end{aligned}')
('8', '\\hat{V}_\\textsc{dr}(\\pi)')
('8', '\\mathbb{E} \\left[\\hat{V}_\\textsc{dr}(\\pi)\\right] = V(\\pi)')
('8', '\\begin{aligned}\n  \\mathbb{E} \\left[\\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\} - r(x_t, A_t; \\hat{w}) \\,\\middle|\\, x_t, A_t\\right]\n  = r(x_t, A_t) - r(x_t, A_t; \\hat{w})\n  = 0\\,,\n\\end{aligned}')
('8', '\\begin{aligned}\n  \\mathbb{E}_{A_t \\sim \\pi_0(\\cdot \\mid x_t)} \\left[\\frac{\\pi(A_t \\mid x_t)}{\\pi_0(A_t \\mid x_t)}{r(x_t, A_t; \\hat{w})}\\right]\n  = \\mathbb{E}_{A_t \\sim \\pi(\\cdot \\mid x_t)} \\left[r(x_t, A_t; \\hat{w})\\right]\\,.\n\\end{aligned}')
('8', 'r(x_t, A_t; \\hat{w})')
('8', '\\hat{V}_\\textsc{dm}(\\pi)')
('8', '\\hat{V}_\\textsc{set}(\\pi)')
('8', '\\mathbb{E} \\left[\\hat{V}_\\textsc{set}(\\pi)\\right] = V(\\pi)')
('8', '\\begin{aligned}\n  \\mathbb{E} \\left[\\hat{V}_\\textsc{set}(\\pi)\\right]\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{S_t \\sim \\nu(\\cdot \\mid x_t), \\, A_{t, *} \\sim \\cdot \\mid x_t, S_t} \\left[\\pi(a_{t, *, 1} \\mid S_t, x_t)\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{S_t \\sim \\nu(\\cdot \\mid x_t)} \\left[\\mathbb{E} \\left[\\pi(a_{t, *, 1} \\mid S_t, x_t) \\,\\middle|\\, x_t, S_t\\right]\\right]\n  = V(\\pi)\\,.\n\\end{aligned}')
('8', '\\hat{V}_\\textsc{set-ips}(\\pi)')
('8', '\\mathbb{E} \\left[\\hat{V}_\\textsc{set-ips}(\\pi)\\right] = V(\\pi)')
('8', '\\begin{aligned}\n  \\mathbb{E} \\left[\\hat{V}_\\textsc{set-ips}(\\pi)\\right]\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{S_t \\sim \\nu_0(\\cdot \\mid x_t), \\, A_{t, *} \\sim \\cdot \\mid x_t, S_t} \\left[\\frac{\\nu(S_t \\mid x_t)}{\\nu_0(S_t \\mid x_t)}\n  \\pi(a_{t, *, 1} \\mid S_t, x_t)\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{S_t \\sim \\nu_0(\\cdot \\mid x_t)} \\left[\\frac{\\nu(S_t \\mid x_t)}{\\nu_0(S_t \\mid x_t)}\n  \\mathbb{E} \\left[\\pi(a_{t, *, 1} \\mid S_t, x_t) \\,\\middle|\\, x_t, S_t\\right]\\right] \\\\\n  & = \\frac{1}{n} \\sum_{t = 1}^n\n  \\mathbb{E}_{S_t \\sim \\nu(\\cdot \\mid x_t)} \\left[\\mathbb{E} \\left[\\pi(a_{t, *, 1} \\mid S_t, x_t) \\,\\middle|\\, x_t, S_t\\right]\\right]\n  = V(\\pi)\\,.\n\\end{aligned}')
('8', '\\hat{V}_\\textsc{set-dr}(\\pi)')
('8', '\\mathbb{E} \\left[\\hat{V}_\\textsc{set-dr}(\\pi)\\right] = V(\\pi)')
('8', '\\begin{aligned}\n  \\mathbb{E} \\left[\\pi(a_{t, *, 1} \\mid S_t, x_t) \\,\\middle|\\, x_t, S_t\\right]\n  = \\sum_{A \\in \\Pi(S_t)} \\frac{\\pi(A \\mid x_t)}{\\nu(S_t \\mid x_t)} \\, r(x_t, A)\n\\end{aligned}')
('8', '\\begin{aligned}\n  r(x_t, S_t; \\pi, \\hat{w})\n  = \\sum_{A \\in \\Pi(S_t)} \\frac{\\pi(A \\mid x_t)}{\\nu(S_t \\mid x_t)} r(x_t, A; \\hat{w})\\,.\n\\end{aligned}')
('8', '\\begin{aligned}\n  \\mathbb{E} \\left[\\pi(a_{t, *, 1} \\mid S_t, x_t) - r(x_t, S_t; \\pi, \\hat{w}) \\,\\middle|\\, x_t, S_t\\right]\n  = 0\\,,\n\\end{aligned}')
('8', '\\begin{aligned}\n  \\mathbb{E}_{S_t \\sim \\nu_0(\\cdot \\mid x_t)} \\left[\\frac{\\nu(S_t \\mid x_t)}{\\nu_0(S_t \\mid x_t)}{r(x_t, S_t; \\pi, \\hat{w})}\\right]\n  & = \\mathbb{E}_{S_t \\sim \\nu(\\cdot \\mid x_t)} \\left[r(x_t, S_t; \\pi, \\hat{w})\\right] \\\\\n  & = \\mathbb{E}_{S_t \\sim \\nu(\\cdot \\mid x_t)} \\left[\\sum_{A \\in \\Pi(S_t)} \\frac{\\pi(A \\mid x_t)}{\\nu(S_t \\mid x_t)} r(x_t, A; \\hat{w})\\right] \\\\\n  & = \\mathbb{E}_{A \\sim \\pi(\\cdot \\mid x_t)} \\left[r(x_t, A; \\hat{w})\\right]\\,.\n\\end{aligned}')
('8', 'r(x_t, S_t; \\pi, \\hat{w})')
('8', '\\hat{V}_\\textsc{dm}(\\pi)')
('9', 't \\in [n]')
('9', 't')
('9', 'x_t')
('9', '\\pi(\\cdot; \\theta)')
('9', '\\pi(\\cdot; x_t, \\theta)')
('9', '\\begin{aligned}\n  & \\nabla d(\\pi(\\cdot; \\theta), \\pi_0) \\\\\n  & = \\sum_{a \\in \\mathcal{A}} \\nabla [\\pi(a; \\theta)\n  (\\log \\pi(a; \\theta) - \\log \\pi_0(a))] \\\\\n  & = \\sum_{a \\in \\mathcal{A}} [\\nabla \\pi(a; \\theta)] \\log \\pi(a; \\theta) +\n  \\pi(a; \\theta) \\nabla \\log \\pi(a; \\theta) -\n  [\\nabla \\pi(a; \\theta)] \\log \\pi_0(a) \\\\\n  & = \\sum_{a \\in \\mathcal{A}} \\pi(a; \\theta) [\\nabla \\log \\pi(a; \\theta)]\n  [1 + \\log \\pi(a; \\theta) - \\log \\pi_0(a)]\\,.\n\\end{aligned}')
('9', 'a \\sim \\pi(\\cdot; \\theta)')
('9', '\\begin{aligned}\n  \\nabla d(\\pi(\\cdot; \\theta), \\pi_0)\n  = \\mathbb{E} \\left[(\\nabla \\log \\pi(a; \\theta)) (1 + \\log \\pi(a; \\theta) - \\log \\pi_0(a))\\right]\\,.\n\\end{aligned}')
('9', '(\\nabla \\log \\pi(a; \\theta)) (1 + \\log \\pi(a; \\theta) - \\log \\pi_0(a))')
('9', '\\tilde{A}_t \\sim \\pi(\\cdot \\mid x_t; \\theta)')
('9', '\\begin{aligned}\n  \\frac{1}{n} \\sum_{t = 1}^n\n  \\nabla \\log \\pi(\\tilde{A}_t \\mid x_t; \\theta) \\,\n  r(x_t, \\tilde{A}_t; \\hat{w})\\,.\n  \\label{eq:dm gradient}\n\\end{aligned}')
('9', '\\nabla \\hat{V}_\\textsc{dm}(\\pi)')
('9', '\\begin{aligned}\n  \\nabla \\hat{V}_\\textsc{ips}(\\pi)\n  = \\frac{1}{n} \\sum_{t = 1}^n\n  \\frac{\\nabla \\pi(A_t \\mid x_t; \\theta)}{\\pi_0(A_t \\mid x_t)}\n  \\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\}\\,.\n  \\label{eq:ips gradient}\n\\end{aligned}')
('9', '\\tilde{A}_t \\sim \\pi(\\cdot \\mid x_t; \\theta)')
('9', '\\begin{aligned}\n  \\frac{1}{n} \\sum_{t = 1}^n\n  \\frac{\\nabla \\pi(A_t \\mid x_t; \\theta)}{\\pi_0(A_t \\mid x_t)}\n  (\\mathds{1} \\! \\left\\{a_{t, 1} = a_{t, *, 1}\\right\\} - r(x_t, A_t; \\hat{w})) +\n  \\nabla \\hat{V}_\\textsc{dm}(\\pi)\\,.\n  \\label{eq:dr gradient}\n\\end{aligned}')
('9', '\\nabla \\hat{V}_\\textsc{dr}(\\pi)')
